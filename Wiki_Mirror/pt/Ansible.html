<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Ansible (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Ansible_Português rootpage-Ansible_Português skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Ansible (Português)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Ansible.html" title="Ansible">Ansible</a>. Data da última tradução: 2020-04-11. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Ansible&amp;diff=0&amp;oldid=605736">alterações</a> na versão em inglês.</div>
<p>Do <a rel="nofollow" class="external text" href="https://www.ansible.com/how-ansible-works">www.ansible.com</a>:
</p>
<dl><dd>Ansible é um mecanismo de automação de TI radicalmente simples que automatiza o provisionamento em nuvem, o gerenciamento de configurações, a implantação de aplicativos, a orquestração intrasserviço e muitas outras necessidades de TI.</dd></dl>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Instala%C3%A7%C3%A3o"><span class="tocnumber">1</span> <span class="toctext">Instalação</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Uso_b%C3%A1sico"><span class="tocnumber">2</span> <span class="toctext">Uso básico</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Configura%C3%A7%C3%A3o"><span class="tocnumber">2.1</span> <span class="toctext">Configuração</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Invent%C3%A1rio"><span class="tocnumber">2.2</span> <span class="toctext">Inventário</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Ping"><span class="tocnumber">2.3</span> <span class="toctext">Ping</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Playbook"><span class="tocnumber">2.4</span> <span class="toctext">Playbook</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Vault"><span class="tocnumber">2.5</span> <span class="toctext">Vault</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#Gerenciamento_de_pacotes"><span class="tocnumber">2.6</span> <span class="toctext">Gerenciamento de pacotes</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Reposit%C3%B3rios_oficiais"><span class="tocnumber">2.6.1</span> <span class="toctext">Repositórios oficiais</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#AUR"><span class="tocnumber">2.6.2</span> <span class="toctext">AUR</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Dicas_e_truques"><span class="tocnumber">3</span> <span class="toctext">Dicas e truques</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Cria%C3%A7%C3%A3o_de_conta_de_usu%C3%A1rio"><span class="tocnumber">3.1</span> <span class="toctext">Criação de conta de usuário</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Localiza%C3%A7%C3%A3o_do_bin%C3%A1rio_do_Python"><span class="tocnumber">3.2</span> <span class="toctext">Localização do binário do Python</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14">
<a href="#Solu%C3%A7%C3%A3o_de_problemas"><span class="tocnumber">4</span> <span class="toctext">Solução de problemas</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#Unarchive"><span class="tocnumber">4.1</span> <span class="toctext">Unarchive</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Veja_tamb%C3%A9m"><span class="tocnumber">5</span> <span class="toctext">Veja também</span></a></li>
</ul>
</div>

<h2>
<span id="Instala.C3.A7.C3.A3o"></span><span class="mw-headline" id="Instalação">Instalação</span>
</h2>
<p>Na máquina de controle (mestre), <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instale">instale</a> o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ansible">ansible</a></span>.
</p>
<p>Nas máquinas gerenciadas (nós), nas quais você deseja automatizar tarefas de implantação ou configuração, é necessário ter <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python">python</a></span> e pode ser necessário indicar o <a href="#Localiza%C3%A7%C3%A3o_do_bin%C3%A1rio_do_Python">#Localização do binário do Python</a> específico em algumas circunstâncias. Uma maneira de se comunicar com o nó também é necessária, isso geralmente é <a href="../pt/Secure_Shell.html" class="mw-redirect" title="SSH (Português)">SSH</a>. Observe que uma configuração funcional <a href="../en/SSH_keys.html#Copying_the_public_key_to_the_remote_server" title="SSH keys">chave SSH key</a> facilita o uso do Ansible, mas não é necessária.
</p>
<h2>
<span id="Uso_b.C3.A1sico"></span><span class="mw-headline" id="Uso_básico">Uso básico</span>
</h2>
<h3>
<span id="Configura.C3.A7.C3.A3o"></span><span class="mw-headline" id="Configuração">Configuração</span>
</h3>
<p>Os parâmetros do Ansible são configurados no arquivo de configuração que pode ser <code>ansible.cfg</code> no diretório atual, <code>.ansible.cfg</code> no diretório inicial ou <code>/etc/ansible/ansible.cfg</code>, o que encontrar primeiro.
</p>
<p>Um modelo está disponível no <a rel="nofollow" class="external text" href="https://raw.githubusercontent.com/ansible/ansible/devel/examples/ansible.cfg">ansible.cfg exemplo no GitHub</a>.
</p>
<h3>
<span id="Invent.C3.A1rio"></span><span class="mw-headline" id="Inventário">Inventário</span>
</h3>
<p>A infraestrutura está listada no arquivo de inventário Ansible, cujo padrão é ser salvo no local <code>/etc/ansible/hosts</code> ou é possível especificar um arquivo de inventário diferente usando a opção de linha de comando <code>-i</code>. Por exemplo, o inventário a seguir define um cluster com 7 nós organizados em dois grupos:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ansible/hosts</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[control]
192.168.12.1
foo-[a:c].example.org
localhost ansible_connection=local

[managed]
192.168.12.2
192.168.12.3</pre>
<p>Pode-se atribuir atributos específicos para cada nó no arquivo de infraestrutura na linha correspondente ou no arquivo de configuração <code>ansible.cfg</code>. Por padrão, o Ansible executa playbooks no SSH, o parâmetro <code>ansible_connection</code> estende a conexão para:
</p>
<ul>
<li>
<code>local</code> para implantar o playbook na própria máquina de controle</li>
<li>
<code>docker</code> implanta o playbook diretamente nos contêineres do Docker</li>
</ul>
<p>Confira <a rel="nofollow" class="external text" href="http://docs.ansible.com/ansible/latest/intro_inventory.html">Ansible - intro inventory</a> par detalhes.
</p>
<h3><span class="mw-headline" id="Ping">Ping</span></h3>
<p>Você pode verificar se todos os nós listados no inventário estão ativos com
</p>
<pre>$ ansible all -m ping
</pre>
<h3><span class="mw-headline" id="Playbook">Playbook</span></h3>
<p>Playbooks são a principal unidade organizacional para configurar e implantar toda a infraestrutura. Consulte <a rel="nofollow" class="external text" href="http://docs.ansible.com/ansible/latest/playbooks.html">a documentação oficial</a> para obter mais detalhes. Aqui está uma demonstração extremamente simples, na qual o administrador do inventário acima deseja executar uma atualização completa do sistema em um conjunto de hosts do Arch Linux. Primeiro, crie um arquivo de playbook, com formatação YAML (<i>sempre</i> com recuo de 2 espaços):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">syu.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">---
- name: All hosts up-to-date
  hosts: control managed
  become: yes
  
  tasks:
    - name: full system upgrade
      pacman:
        update_cache: yes
        upgrade: yes
</pre>
<p>Em seguida, execute o script do playbook:
</p>
<pre>$ ansible-playbook --ask-become-pass syu.yml
</pre>
<h3><span class="mw-headline" id="Vault">Vault</span></h3>
<p>Um <a rel="nofollow" class="external text" href="http://docs.ansible.com/ansible/latest/playbooks_vault.html#using-vault-in-playbooks">vault</a> ("cofre") pode ser usado para manter dados confidenciais de forma criptografada em playbooks ou funções, em vez de em texto sem formatação. A senha do cofre pode ser armazenada em texto sem formatação em um arquivo, por exemplo, <code><i>senhavault.txt</i></code> contendo <code><i>senhadovault</i></code>, para ser usada posteriormente como parâmetro de comando:
</p>
<pre>$ ansible-playbook <i>site.yml</i> --vault-id <i>senhavault.txt</i>
</pre>
<p>Para criptografar o conteúdo <code><i>o conteúdo da variável</i></code> de uma variável chamada <code><i>nomevar</i></code> usando a senha armazenada em <code><i>senha_vault.txt</i></code>, o seguinte comando deve ser usado:
</p>
<pre>$ ansible-vault encrypt_string --vault-id <i>senhavault.txt</i> '<i>o conteúdo da variável</i>' --name <i>nomevar</i>
</pre>
<p>Com mais segurança, para evitar a inserção do conteúdo da variável na linha de comando e ser solicitado, em vez disso, é possível usar:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ansible-vault encrypt_string --vault-id <i>senhavault.txt</i> --stdin-name <i>nomevar</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Reading plaintext input from stdin. (ctrl-d to end input)</pre>
<p>O comando retorna diretamente a variável protegida que pode ser inserida em um manual. Variáveis criptografadas e não criptografadas podem coexistir em um arquivo YAML, conforme ilustrado abaixo:
</p>
<pre><i>nãosecreto</i>: <i>meuvalor</i>

<i>meusegredo</i>: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66386439653236336462626566653063336164663966303231363934653561363964363833313662
          6431626536303530376336343832656537303632313433360a626438346336353331386135323734
          62656361653630373231613662633962316233633936396165386439616533353965373339616234
          3430613539666330390a313736323265656432366236633330313963326365653937323833366536
          3462

<i>outronãosecreto</i>: <i>outrovalor</i></pre>
<h3><span class="mw-headline" id="Gerenciamento_de_pacotes">Gerenciamento de pacotes</span></h3>
<h4>
<span id="Reposit.C3.B3rios_oficiais"></span><span class="mw-headline" id="Repositórios_oficiais">Repositórios oficiais</span>
</h4>
<p>Ansible possui um <a rel="nofollow" class="external text" href="https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html">módulo do pacman</a> para lidar com a instalação, remoção e atualização do sistema com o <a href="../pt/Pacman.html" title="Pacman (Português)">pacman</a>.
</p>
<h4><span class="mw-headline" id="AUR">AUR</span></h4>
<p>Para o <a href="../pt/Arch_User_Repository.html" title="Arch User Repository (Português)">Arch User Repository</a> <i>(AUR)</i>, é necessário usar o módulo externo <a rel="nofollow" class="external text" href="https://github.com/kewlfft/ansible-aur">ansible-aur</a>, o qual pode ser instalado com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ansible-aur-git/">ansible-aur-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>Enquanto o Ansible espera um acesso ssh como root, os auxiliares do AUR não permitem a execução de operações como root, mas todos falham com "você não pode executar esta operação como root". Para automação Ansible, é recomendável criar um usuário, por exemplo chamado <i>aur_builder</i>, que não precise de senha com pacman em <a href="../pt/Sudo.html#Configura%C3%A7%C3%A3o" class="mw-redirect" title="Sudoers (Português)">sudoers</a>. Isso pode ser feito no Ansible com as seguintes ações:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">task.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">- user: name=<i>aur_builder</i>

- lineinfile:
     path: /etc/sudoers.d/<i>aur_builder-allow-to-sudo-pacman</i>
     state: present
     line: "<i>aur_builder</i> ALL=(ALL) NOPASSWD: /usr/bin/pacman"
     validate: /usr/sbin/visudo -cf %s
     create: yes</pre>
<p>Em seguida, os auxiliares do AUR ou <a href="../pt/Makepkg.html" title="Makepkg (Português)">makepkg</a> podem ser usados associados aos parâmetros <code>become: yes</code> e <code>become_user: aur_builder</code> do Ansible.
</p>
<h2><span class="mw-headline" id="Dicas_e_truques">Dicas e truques</span></h2>
<h3>
<span id="Cria.C3.A7.C3.A3o_de_conta_de_usu.C3.A1rio"></span><span class="mw-headline" id="Criação_de_conta_de_usuário">Criação de conta de usuário</span>
</h3>
<p>O Ansible pode gerenciar contas de usuário e, em particular, é capaz de criar novas. Isso é obtido em playbooks com o <a rel="nofollow" class="external text" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html">módulo de usuário</a>, que utiliza um argumento opcional <code>password</code> para definir a senha do usuário. É o valor <b>hash da senha</b> que precisa ser fornecido ao módulo.
</p>
<p>O hash pode simplesmente ser executado instantaneamente no Ansible usando um de seus filtros internos <a rel="nofollow" class="external text" href="http://docs.ansible.com/ansible/latest/playbooks_filters.html#hash-filters">hash-filter</a>:
</p>
<pre>- user:
  name: <i>nome_do_usuário</i>
  password: "{{ '<i>senha_do_usuário</i>' | password_hash('sha512', '<i>saltdasenha</i>') }}"
  shell: /usr/bin/nologin
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> O salt deve ser corrigido e fornecido explicitamente como um segundo parâmetro da função hash para que a operação seja idempotente (pode ser repetida sem alterar o estado do sistema).</div>
<p>Com essa abordagem, é recomendável criptografar <i>senha_do_usuário</i> com vault para que não apareça em texto sem formatação, consulte <a href="#Vault">#Vault</a>. No entanto, uma variável criptografada não pode ser canalizada diretamente e precisará primeiro ser atribuída a outra que será passada com pipe.
</p>
<p>Como alternativa, o hash pode ser realizado fora do Ansible. Os comandos a seguir retornam respectivamente os valores <a href="https://en.wikipedia.org/wiki/pt:MD5" class="extiw" title="wikipedia:pt:MD5">MD5</a> e <a href="https://en.wikipedia.org/wiki/pt:SHA-2" class="extiw" title="wikipedia:pt:SHA-2">SHA512</a> com hash de <i>senha_do_usuário</i>:
</p>
<pre>$ openssl passwd -1 <i>senha_do_usuário</i>
</pre>
<pre>$ python -c 'import crypt; print(crypt.crypt("<i>senha_do_usuário</i>", crypt.mksalt(crypt.METHOD_SHA512)))'
</pre>
<h3>
<span id="Localiza.C3.A7.C3.A3o_do_bin.C3.A1rio_do_Python"></span><span class="mw-headline" id="Localização_do_binário_do_Python">Localização do binário do Python</span>
</h3>
<p>O Ansible requer <a href="../pt/Python.html" title="Python (Português)">Python</a> na máquina de destino. Por padrão, o Ansible supõe que ele pode encontrar um <code>/usr/bin/python</code> no sistema remoto que é uma versão 2.X ou 3.X, especificamente 2.6 ou superior.
</p>
<p>Se alguns de seus módulos exigirem especificamente o Python2, você precisará informar o Ansible sobre sua localização, configurando a variável <code>ansible_python_interpreter</code> no arquivo de inventário. Isso pode ser feito usando grupos de hosts no inventário:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ansible/hosts</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[archlinux]
servidor1
servidor2

[debian]
servidor3

[archlinux:vars]
ansible_python_interpreter=/usr/bin/python2</pre>
<p>Mais informações sobre o suporte à versão Python no Ansible estão disponíveis em <a rel="nofollow" class="external autonumber" href="https://docs.ansible.com/ansible/python_3_support.html">[1]</a>, <a rel="nofollow" class="external autonumber" href="http://docs.ansible.com/faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">[2]</a> e <a rel="nofollow" class="external autonumber" href="http://docs.ansible.com/intro_inventory.html#list-of-behavioral-inventory-parameters">[3]</a>.
</p>
<h2>
<span id="Solu.C3.A7.C3.A3o_de_problemas"></span><span class="mw-headline" id="Solução_de_problemas">Solução de problemas</span>
</h2>
<h3><span class="mw-headline" id="Unarchive">Unarchive</span></h3>
<p>O módulo <code>unarchive</code> descompacta um arquivo. No entanto, os arquivos <i>tar</i> não são bem suportados e vários problemas pendentes são relatados em <a rel="nofollow" class="external text" href="https://github.com/ansible/ansible/labels/m%3Aunarchive">GitHub - unarchive</a>. Em particular, quando o parâmetro <code>keep_newer</code> é definido como <code>yes</code>, a idempotência não é observada. Caso encontre um problema com o módulo, você pode usar o formato <i>zip</i>, que é melhor integrado ao Ansible.
</p>
<h2>
<span id="Veja_tamb.C3.A9m"></span><span class="mw-headline" id="Veja_também">Veja também</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external free" href="https://www.ansible.com/quick-start-video">https://www.ansible.com/quick-start-video</a> - Conceito do Ansible em 12 minutos</li>
<li>
<a rel="nofollow" class="external free" href="https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/pacman_module.html</a> - Documentação oficial do módulo do pacman</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../pt/Category:System_administration.html" title="Category:System administration (Português)">System administration (Português)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Ansible_(Portugu%C3%AAs)&amp;oldid=655883">https://wiki.archlinux.org/index.php?title=Ansible_(Português)&amp;oldid=655883</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 24 March 2021, at 00:00.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
