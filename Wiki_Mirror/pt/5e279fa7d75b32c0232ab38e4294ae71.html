<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Português)/System configuration (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Português_System_configuration_Português rootpage-Dm-crypt_Português skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">dm-crypt (Português)/System configuration (Português)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../pt/Dm-crypt.html" title="Dm-crypt (Português)">Dm-crypt (Português)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Agregar aqui todas informações genéricas relacionadas a configuração do sistema de outros sub-artigos do <a href="../pt/Dm-crypt.html" title="Dm-crypt (Português)">dm-crypt</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt/System_configuration">talk:dm-crypt/System configuration</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Dm-crypt/System_configuration.html" title="Dm-crypt/System configuration">Dm-crypt/System configuration</a>. Data da última tradução: 2021-02-15. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/System_configuration&amp;diff=0&amp;oldid=651788">alterações</a> na versão em inglês.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>Se precisa desbloquear remotamente o sistema de arquivos da partição raiz ou de outras partições na inicialização (máquinas sem monitor, servidores distantes...), siga instruções específicas em <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Abrir_remotamente_a_parti%C3%A7%C3%A3o_raiz_(ou_outra)" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Abrir remotamente a partição raiz (ou outra)</a>.</li>
<li>Para facilitar a inserção de UUIDs, PARTUUIDs, etc. nos arquivos de configuração, você pode instalar e usar um <a href="../en/List_of_applications.html#Text_editors" class="mw-redirect" title="Text editor">editor de texto</a> que suporta a inserção de saída de comandos () (e.x. <a href="../en/Nano.html" title="Nano">nano</a> com <code>Ctrl+t</code>, <a href="../pt/Vim.html" title="Vim (Português)">Vim</a> ou <a href="../pt/Neovim.html" title="Neovim (Português)">Neovim</a> com <code>:read</code> ou <a href="../en/Midnight_Commander.html#Modules" class="mw-redirect" title="Mcedit">mcedit</a> com <code>Alt+u</code>) e passar <a href="../pt/Persistent_block_device_naming.html#M%C3%A9todos_de_nomea%C3%A7%C3%A3o_persistente" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">o comando lsblk ou blkid adequado</a>. Alternativamente, você pode instalar um <a href="../en/List_of_applications/Utilities.html#Terminal_multiplexers" title="List of applications/Utilities">multiplexador de terminal</a> e usar a sua funcionalidade de cópia e cola.</li>
</ul>
</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#mkinitcpio"><span class="tocnumber">1</span> <span class="toctext">mkinitcpio</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Exemplos"><span class="tocnumber">1.1</span> <span class="toctext">Exemplos</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3">
<a href="#Gerenciador_de_boot"><span class="tocnumber">2</span> <span class="toctext">Gerenciador de boot</span></a>
<ul>
<li class="toclevel-2 tocsection-4">
<a href="#Par%C3%A2metros_do_Kernel"><span class="tocnumber">2.1</span> <span class="toctext">Parâmetros do Kernel</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#root"><span class="tocnumber">2.1.1</span> <span class="toctext">root</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#resume"><span class="tocnumber">2.1.2</span> <span class="toctext">resume</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7">
<a href="#Usando_o_hook_encrypt"><span class="tocnumber">2.2</span> <span class="toctext">Usando o hook encrypt</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#cryptdevice"><span class="tocnumber">2.2.1</span> <span class="toctext">cryptdevice</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#cryptkey"><span class="tocnumber">2.2.2</span> <span class="toctext">cryptkey</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#crypto"><span class="tocnumber">2.2.3</span> <span class="toctext">crypto</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11">
<a href="#Usando_o_hook_sd-encrypt"><span class="tocnumber">2.3</span> <span class="toctext">Usando o hook sd-encrypt</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#rd.luks.uuid"><span class="tocnumber">2.3.1</span> <span class="toctext">rd.luks.uuid</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#rd.luks.name"><span class="tocnumber">2.3.2</span> <span class="toctext">rd.luks.name</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#rd.luks.options"><span class="tocnumber">2.3.3</span> <span class="toctext">rd.luks.options</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#rd.luks.key"><span class="tocnumber">2.3.4</span> <span class="toctext">rd.luks.key</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Timeout"><span class="tocnumber">2.3.5</span> <span class="toctext">Timeout</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#crypttab"><span class="tocnumber">3</span> <span class="toctext">crypttab</span></a>
<ul>
<li class="toclevel-2 tocsection-18">
<a href="#Montando_na_inicializa%C3%A7%C3%A3o"><span class="tocnumber">3.1</span> <span class="toctext">Montando na inicialização</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#Desbloqueando_com_uma_keyfile"><span class="tocnumber">3.1.1</span> <span class="toctext">Desbloqueando com uma keyfile</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Montando_um_dispositivo_de_bloco_empilhado"><span class="tocnumber">3.1.2</span> <span class="toctext">Montando um dispositivo de bloco empilhado</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Montando_em_demanda"><span class="tocnumber">3.2</span> <span class="toctext">Montando em demanda</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22">
<a href="#Solu%C3%A7%C3%A3o_de_problemas"><span class="tocnumber">4</span> <span class="toctext">Solução de problemas</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#Sistema_travado_no_prompt_de_inicializa%C3%A7%C3%A3o/senha_n%C3%A3o_aparece"><span class="tocnumber">4.1</span> <span class="toctext">Sistema travado no prompt de inicialização/senha não aparece</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="mkinitcpio">mkinitcpio</span></h2>
<p>Em alguns cenários, um subconjunto dos seguintes hooks do <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio</a> terão que ser habilitados:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>busybox</th>
<th>systemd</th>
<th>Caso de uso
</th>
</tr>
<tr>
<td style="text-align: center;white-space:nowrap;">
<code>encrypt</code>
</td>
<td style="text-align: center;white-space:nowrap;">
<code>sd-encrypt</code>
</td>
<td>Sempre necessário quando a partição raiz, ou outra partição que precisa ser montada <i>antes</i> dela, é criptografada. Não é necessário em todos os casos, scripts de inicialização de sistema como <code>crypttab</code> cuidam do desbloqueio de outras partições criptografadas. Deve ser colocado depois do hook <code>udev</code> ou <code>systemd</code>.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;white-space:nowrap;">
<code>keyboard</code>
</td>
<td>Necessário para o funcionamento do teclado no estágio inicial do espaço do usuário.
</td>
</tr>
<tr>
<td style="text-align: center;white-space:nowrap;">
<code>keymap</code>
</td>
<td rowspan="2" style="text-align: center;white-space:nowrap;">
<code>sd-vconsole</code>
</td>
<td>Trás suporte a teclados que não são do padrão US; deve ser colocado <i>antes</i> do hook <code>encrypt</code>. Defina seu padrão do seu teclado em <code>/etc/vconsole.conf</code>, veja <a href="../pt/6fb8afc91a56605ff4ff89503a29bd82.html#Configura%C3%A7%C3%A3o_persistente" class="mw-redirect" title="Configuração de teclado no console">Configuração de teclado no console#Configuração persistente</a>.
</td>
</tr>
<tr>
<td style="text-align: center;white-space:nowrap;">
<code>consolefont</code>
</td>
<td>Carrega uma fonte alternativa para o console no estágio inicial do espaço do usuário. Defina sua fonte em <code>/etc/vconsole.conf</code>, veja <a href="../pt/Linux_console.html#Configura%C3%A7%C3%A3o_persistente" class="mw-redirect" title="Console do Linux">Console do Linux#Configuração persistente</a>.
</td>
</tr>
</tbody>
</table>
<p><a href="../pt/Mkinitcpio.html#Hooks_comuns" title="Mkinitcpio (Português)">Outros hooks</a> necessários devem ser claramente especificados durante a instalação do sistema.
</p>
<p><a href="../pt/Mkinitcpio.html#Cria%C3%A7%C3%A3o_e_ativa%C3%A7%C3%A3o_de_imagem" class="mw-redirect" title="Gere novamente o initramfs">Gere novamente o initramfs</a> depois de salvar as mudanças.
</p>
<h3><span class="mw-headline" id="Exemplos">Exemplos</span></h3>
<p>Uma configuração típica em <code>/etc/mkinitcpio.conf</code> quando se usa o hook <code>encrypt</code> é:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
HOOKS=(base udev autodetect keyboard keymap consolefont modconf block encrypt lvm2 filesystems fsck)
...</pre>
<p>Já uma configuração com o initramfs baseado no systemd, fazendo uso do hook <code>sd-encrypt</code>, seria semelhante a:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
HOOKS=(base systemd autodetect keyboard sd-vconsole modconf block sd-encrypt lvm2 filesystems fsck)
...</pre>
<h2><span class="mw-headline" id="Gerenciador_de_boot">Gerenciador de boot</span></h2>
<p>Para habilitar a inicialização em uma partição raiz criptografada, um subconjunto dos seguintes parâmetros do kernel terão que ser configurados. Veja <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">Parâmetros do kernel</a> para instruções específicas para seu <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">Gerenciador de boot</a>.
</p>
<p>Por exemplo, se está usando o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a>, os parâmetros relevantes são adicionados no <code>/etc/default/grub</code>, antes de <a href="../pt/GRUB.html#Gerar_o_arquivo_de_configura%C3%A7%C3%A3o_principal" title="GRUB (Português)">gerar o arquivo de configuração principal</a>. Veja também <a href="../pt/GRUB.html#Aviso_ao_instalar_em_chroot" title="GRUB (Português)">GRUB#Aviso ao instalar em chroot</a> como outro ponto a se atentar.
</p>
<p>Os parâmetros do kernel irão variar de acordo com qual hook (<code>encrypt</code> ou <code>sd-encrypt</code>) você vai usar.
</p>
<h3>
<span id="Par.C3.A2metros_do_Kernel"></span><span class="mw-headline" id="Parâmetros_do_Kernel">Parâmetros do Kernel</span>
</h3>
<p><a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">Parâmetros do kernel</a> como <code>root</code> e <code>resume</code> são especificados da mesma forma para os hooks <code>encrypt</code> e <code>sd-encrypt</code>.
</p>
<h4><span class="mw-headline" id="root">root</span></h4>
<p>O parâmetro <code>root=</code> especifica o <code><i>dispositivo</i></code> do sistema de arquivos raiz (descriptografado):
</p>
<pre>root=<i>dispositivo</i>
</pre>
<ul>
<li>Se o sistema de arquivos foi colocado diretamente no dispositivo descriptografado, o caminho será <code>/dev/mapper/<i>dmnome</i></code>.</li>
<li>Se LVM vai ser ativado primeiro e contém um <a href="../pt/bd347841f13524ba6da3458e094be74d.html#LUKS_dentro_do_LVM" class="mw-redirect" title="Volume lógico raiz criptografado">volume lógico raiz criptografado</a>, a forma acima também é aplicável.</li>
<li>Se o sistema de arquivos raiz está no volume lógico de uma <a href="../pt/bd347841f13524ba6da3458e094be74d.html#LVM_dentro_do_LUKS" class="mw-redirect" title="LVM criptografada">LVM criptografada</a>, o mapeador de dispositivos vai estar em sua forma genérica <code>root=/dev/<i>grupoDoVolume</i>/<i>volumeLógico</i></code>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se usa o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> e está gerando o arquivo <code>grub.cfg</code> com <i>grub-mkconfig</i>, este parâmetro não precisa se especificado manualmente. <i>grub-mkconfig</i> determinará o UUID correto do sistema de arquivos raiz e automaticamente vai colocá-lo no <code>grub.cfg</code>.</div>
<h4><span class="mw-headline" id="resume">resume</span></h4>
<pre>resume=<i>dispositivo</i>
</pre>
<ul><li>
<code><i>dispositivo</i></code> nesse caso é a swap descriptografada, este parâmetro é utilizado com o objetivo de <a href="../en/Power_management/Suspend_and_hibernate.html#Hibernation" title="Power management/Suspend and hibernate">suspender para o disco</a>. Se a swap está em uma partição separada, ela estará na forma de <code>/dev/mapper/partição_swap</code>. Veja também <a href="../pt/e48c704551cc17f65bac6e6f991e0c3f.html" class="mw-redirect" title="Dm-crypt/Swap criptografada">dm-crypt/Swap criptografada</a>.</li></ul>
<h3><span class="mw-headline" id="Usando_o_hook_encrypt">Usando o hook encrypt</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Comparado com o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, o hook <code>encrypt</code> não suporta:
<ul>
<li>Abrir <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#O_hook_encrypt_e_m%C3%BAltiplos_discos" class="mw-redirect" title="Dm-crypt/Especificidades">múltiplos discos criptografados</a> (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/23182">FS#23182</a>). Somente <b>um</b> dispositivo pode ser aberto no initramfs.</li>
<li>Usar um <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Sistema_criptografado_usando_um_cabe%C3%A7alho_LUKS_desanexado" class="mw-redirect" title="Dm-crypt/Especificidades">cabeçalho LUKS desanexado</a> (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/42851">FS#42851</a>).</li>
</ul>
</div>
<h4><span class="mw-headline" id="cryptdevice">cryptdevice</span></h4>
<p>Este parâmetro fará o sistema solicitar a senha para abrir o dispositivo contendo a raiz criptografada na primeira inicialização (cold boot). Ele é utilizado para o hook <code>encrypt</code> identificar o dispositivo que contém o sistema criptografado:
</p>
<pre>cryptdevice=<i>dispositivo</i>:<i>nomedm</i>
</pre>
<ul>
<li>
<code><i>dispositivo</i></code> é o caminho para o container criptografado que contém o sistema. É fortemente recomendado o uso de <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">nomeação persistente de dispositivo de bloco</a>.</li>
<li>
<code><i>nomedm</i></code> é o nome do <b>d</b>ispositivo <b>m</b>apeado que será dado ao container descriptografado, que estará disponível como <code>/dev/mapper/nomedm</code>.</li>
<li>Se possui um <a href="../pt/bd347841f13524ba6da3458e094be74d.html#LUKS_dentro_do_LVM" class="mw-redirect" title="Volume lógico raiz criptografado">volume lógico raiz criptografado</a>, LVM vai ser ativado primeiro, o grupo de volumes e o volume lógico raiz serão o <i>dispositivo</i>. Coloque da seguinte forma <code>cryptdevice=<i>/dev/grupo_de_volumes/volume_lógico_raiz</i>:<i>nomedm</i></code>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Você pode querer <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Suporte_a_discard/TRIM_para_unidades_de_estado_s%C3%B3lido_(SSD)" class="mw-redirect" title="Dm-crypt/Especificidades">habilitar suporte ao Discard/TRIM</a> para unidades de estado sólido (SSD).</div>
<h4><span class="mw-headline" id="cryptkey">cryptkey</span></h4>
<p>Este parâmetro especifica a localização de uma keyfile, o hook <code><i>encrypt</i></code> é necessário para ler e abrir o <code><i>cryptdevice</i></code> (a menos que a chave está em um caminho padrão,  veja abaixo). Três parâmetros podem ser definidos, dependendo de como a keyfile existe, pode ser um arquivo no dispositivo, uma bitstream que começa em uma localização específica ou um arquivo incluido no initramfs.
</p>
<p>Para um arquivo no dispositivo o formato é:
</p>
<pre>cryptkey=<i>dispositivo</i>:<i>tipo_do_sistema_de_arquivos</i>:<i>caminho</i>
</pre>
<ul>
<li>
<code><i>dispositivo</i></code> é o dispositivo de bloco onde a keyfile se encontra. Uso de <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">nomeação persistente de dispositivo de bloco</a> é fortemente recomendado.</li>
<li>
<code><i>tipo_do_sistema_de_arquivos</i></code> é o tipo do sistema de arquivos do <code><i>dispositivo</i></code> (ou auto).</li>
<li>
<code><i>caminho</i></code> é o caminho absoluto da keyfile dentro do dispositivo.</li>
</ul>
<p>Exemplo: <code>cryptkey=LABEL=pendrive:vfat:/chave_secreta</code>
</p>
<p>Para uma bitstream no dispositivo, a localização é especificada com: 
</p>
<pre>cryptkey=<i>dispositivo</i>:<i>início</i>:<i>tamanho</i> 
</pre>
<p>Onde início e tamanho estão em bytes. Por exemplo, <code>cryptkey=UUID=<i>ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ</i>:0:512</code> lê uma keyfile de 512 byte no começo do dispositivo. 
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se o caminho do dispositivo que você quer acessar contém o caracter <code>:</code>, terá que escapar isto com <code>\</code>. Neste caso o parâmetro cryptkey deve ser semelhante a: <code>cryptkey=/dev/disk/by-id/usb-123456-0\:0:0:512</code>, este exemplo é de um pendrive com o id <code>usb-123456-0:0</code>.</div>
<p>Para um arquivo <a href="../pt/Mkinitcpio.html#BINARIES_e_FILES" title="Mkinitcpio (Português)">incluído</a> no initramfs o formato é<a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/svntogit-packages/blob/packages/cryptsetup/trunk/hooks-encrypt#L14">[1]</a>:
</p>
<pre>cryptkey=rootfs:<i>caminho</i>
</pre>
<p>Exemplo: <code>cryptkey=rootfs:/chave_secreta</code>
</p>
<p>Também note que se <code>cryptkey</code> não é especificada, o padrão <code>/crypto_keyfile.bin</code> (arquivo incluído no initramfs) será utilizado.<a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/svntogit-packages/blob/packages/cryptsetup/trunk/hooks-encrypt#L8">[2]</a>
</p>
<p>Veja também <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Keyfiles</a>.
</p>
<h4><span class="mw-headline" id="crypto">crypto</span></h4>
<p>Este parâmetro é especifíco para passar opções do modo plain do <i>dm-crypt</i> para o hook <i>encrypt</i>. 
</p>
<p>Sua forma é:
</p>
<pre>crypto=&lt;hash&gt;:&lt;cifra&gt;:&lt;tamanho_da_chave&gt;:&lt;início&gt;:&lt;pule&gt;
</pre>
<p>Os argumentos são relacionados diretamente a opções do <i>cryptsetup</i>. Veja <a href="../en/Dm-crypt/Device_encryption.html#Encryption_options_for_plain_mode" title="Dm-crypt/Device encryption">dm-crypt/Encriptação de dispositivo#Opções de encriptação para o modo plain</a>.
</p>
<p>Para um disco criptografado com somente as opções padrão do modo <i>plain</i>, o argumento <code>crypto</code> deve ser especificado, mas cada entrada pode ser vazia: 
</p>
<pre>crypto=::::
</pre>
<p>Um exemplo especifíco é:
</p>
<pre>crypto=sha512:twofish-xts-plain64:512:0:
</pre>
<h3><span class="mw-headline" id="Usando_o_hook_sd-encrypt">Usando o hook sd-encrypt</span></h3>
<p>Todos os seguintes <code>rd.luks</code> podem ser trocados por <code>luks</code>. Os parâmetros <code>rd.luks</code> são somente reconhecidos pelo initrd, enquanto <code>luks</code> são reconhecidos tanto pelo sistema quanto pelo initrd. A menos que você queira controlar os dispositivos com argumentos dados ao kernel enquanto o sistema é inicializado, use <code>rd.luks</code>. Veja <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup-generator.8">systemd-cryptsetup-generator(8)</a></span> para mais informações e detalhes.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>Se o arquivo <code>/etc/crypttab.initramfs</code> existe, <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio</a> o adicionará ao initramfs como <code>/etc/crypttab</code>, você pode especificar nele dispositivos que precisam ser desbloqueados durante a inicialização. Sintaxe é documentada em <a href="#crypttab">#crypttab</a> e <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span>.</li>
<li>
<code>/etc/crypttab.initramfs</code> não é limitado somente ao uso do UUID como o <code>rd.luks</code>. Você pode usar qualquer um dos <a href="../pt/Persistent_block_device_naming.html#M%C3%A9todos_de_nomea%C3%A7%C3%A3o_persistente" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">métodos de nomeação persistente de dispositivo de bloco</a>.</li>
<li>Senhas entradas durante a inicialização são salvas em cache no chaveiro do kernel pelo <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup.8">systemd-cryptsetup(8)</a></span>, então se multiplos dispositivos podem ser abertos com a mesma senha (isto inclui os dispositivos no <a href="#crypttab">crypttab</a> que são abertos depois da inicialização), então você precisará entrar cada senha somente uma vez.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Todos os parâmetros do <code>rd.luks</code> podem ser especificados múltiplas vezes para múltiplos volumes criptografados LUKS.</li>
<li>Os parâmetros do <code>rd.luks</code> somente suportam dispositivos LUKS detectáveis. Para abrir um dispositivo dm-crypt plain ou com cabeçalho do LUKS desanexado,  você deve especificá-lo em <code>/etc/crypttab.initramfs</code>. Veja <a href="#crypttab">#crypttab</a> para a sintaxe.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Se você está usando o <code>/etc/crypttab</code> ou <code>/etc/crypttab.initramfs</code> junto com os parâmetros <code>luks.*</code> ou <code>rd.luks.*</code>, somente os dispositivos especificados na linha de comando do kernel serão ativados e você verá <code>Not creating device 'devicename' because it was not specified on the kernel command line.</code>. Para ativar todos os dispositivos em <code>/etc/crypttab</code> não especifique nenhum parâmetro <code>luks.*</code> e use <code>rd.luks.*</code>. Para ativar todos os dispositivos em <code>/etc/crypttab.initramfs</code> não especifique nenhum parâmetro <code>luks.*</code> or <code>rd.luks.*</code>.</div>
<h4><span class="mw-headline" id="rd.luks.uuid">rd.luks.uuid</span></h4>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> <code>rd.luks.uuid</code> pode ser omitido ao usar <code>rd.luks.name</code>.</div>
<pre>rd.luks.uuid=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>
</pre>
<p>Especifique o <a href="../pt/Persistent_block_device_naming.html#by-uuid" title="Persistent block device naming (Português)">UUID</a> do dispositivo a ser aberto na inicialização com este parâmetro. Se o UUID está em <code>/etc/crypttab.initramfs</code>, as opções listadas lá serão utilizadas. Para opções do <code>luks.uuid</code>, o <code>/etc/crypttab.initramfs</code> ou <code>/etc/crypttab</code> será usado.
</p>
<p>Por padrão o dispositivo mapeado estará localizado en <code>/dev/mapper/luks-<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i></code> onde <i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i> é o UUID da partição LUKS.
</p>
<h4><span class="mw-headline" id="rd.luks.name">rd.luks.name</span></h4>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Ao usar este parâmetro, você pode omitir <code>rd.luks.uuid</code>.</div>
<pre>rd.luks.name=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>=<i>nome</i>
</pre>
<p>Especifique o nome do dispositivo mapeado depois que a partição LUKS é aberta, onde <i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i> é o  UUID dela. É equivalente ao segundo parâmetro do <code>encrypt</code>, <code>cryptdevice</code>.
</p>
<p>Exemplo, especificar <code>rd.luks.name=12345678-9ABC-DEF0-1234-56789ABCDEF0=cryptraiz</code> faz o dispositivo LUKS aberto do UUID <code>12345678-9ABC-DEF0-1234-56789ABCDEF0</code> estar localizado em <code>/dev/mapper/cryptroot</code>.
</p>
<h4><span class="mw-headline" id="rd.luks.options">rd.luks.options</span></h4>
<pre>rd.luks.options=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>=<i>opções</i>
</pre>
<p>ou
</p>
<pre>rd.luks.options=<i>opções</i>
</pre>
<p>Defina as opções para um dispositivo especificado com o UUID ou, se não especificado, para todos os UUIDs especificados em outro lugar (e.g., crypttab).
</p>
<p>É relativamente equivalente ao terceiro parâmetro do <code>encrypt</code>, <code>cryptdevice</code>.
</p>
<p>Segue um formato similar às opções usadas no crypttab - opções são separadas por vírgulas, opções com valores são especificados com <code><i>opção</i>=<i>valor</i></code>.
</p>
<p>Exemplo:
</p>
<pre>rd.luks.options=timeout=10s,swap,cipher=aes-cbc-essiv:sha256,size=256
</pre>
<h4><span class="mw-headline" id="rd.luks.key">rd.luks.key</span></h4>
<p>Especifique a localização da keyfile que será utilizada para abrir o dispositivo especificado com o UUID. Não há uma localização padrão para a keyfile, como existe com o parâmetro do hook <code>encrypt</code>, <code>cryptkey</code>.
</p>
<p>Se a keyfile está <a href="../pt/Mkinitcpio.html#BINARIES_e_FILES" title="Mkinitcpio (Português)">incluída no initramfs</a>:
</p>
<pre>rd.luks.key=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>=<i>/caminho/para/keyfile</i>
</pre>
<p>ou
</p>
<pre>rd.luks.key=<i>/caminho/para/keyfile</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Todo o parâmetro <code>rd.luks.key</code> pode ser omitido se a keyfile está incluída em <code>/etc/cryptsetup-keys.d/<i>nome</i>.key</code>.</div>
<p>Se a keyfile está em outro dispositivo:
</p>
<pre>rd.luks.key=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>=<i>/caminho/para/keyfile</i>:UUID=<i>ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ</i>
</pre>
<p>Substitua <code>UUID=<i>ZZZZZZZZ-ZZZZ-ZZZZ-ZZZZ-ZZZZZZZZZZZZ</i></code> com o identificador do dispositivo que a keyfile está localizada. Se o sistema de arquivos utilizado não é o mesmo do sistema raiz, você deve <a href="../pt/Mkinitcpio.html#MODULES" title="Mkinitcpio (Português)">incluir o módulo dele no initramfs</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> <code>rd.luks.key</code> com uma keyfile em outro dispositivo por padrão não vai pedir a senha caso este não estiver disponível. Para solicitar a senha, especifique a opção <code>keyfile-timeout=</code> no <code>rd.luks.options</code>. Exemplo, para uma espera de 10 secondos:
<pre>rd.luks.options=<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i>=keyfile-timeout=10s</pre>
</div>
<h4><span class="mw-headline" id="Timeout">Timeout</span></h4>
<p>Existem duas opções que irão afetar o tempo de espera até a senha ser solicitada durante a inicialização:
</p>
<ul>
<li>
<code>rd.luks.options=timeout=<i>tempo_limite</i></code> especifica o tempo máximo para achar a senha</li>
<li>
<code>rootflags=x-systemd.device-timeout=<i>tempo_limite</i></code> especifica o quanto systemd deve esperar pelo dispositivo até desistir (padrão 90 segundos)</li>
</ul>
<p>Se deseja desabilitar os tempos de espera, então defina ambos para zero:
</p>
<pre>rd.luks.options=timeout=0 rootflags=x-systemd.device-timeout=0
</pre>
<h2><span class="mw-headline" id="crypttab">crypttab</span></h2>
<p>O arquivo <code>/etc/crypttab</code> (tabela de dispositivos criptografados) é similar ao arquivo <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a> e contém uma lista de dispositivos criptografados que serão abertos durante a inicialização. Este arquivo pode ser usado para montar automaticamente dispositivos swap ou sistemas de arquivos não raiz.
</p>
<p><code>crypttab</code> é lido <i>antes</i> do <code>fstab</code>, então os containers do dm-crypt podem ser abertos antes que o sistema de arquivos seja montado. Note que <code>crypttab</code> é lido  <i>depois</i> que o sistema inicia, logo não é um substituto para abrir partições criptografadas com os hooks do <a href="#mkinitcpio">mkinitcpio</a> e <a href="#Gerenciador_de_boot">opções do gerenciador de boot</a> como no caso de <a href="../pt/bd347841f13524ba6da3458e094be74d.html" class="mw-redirect" title="Dm-crypt/Criptografando todo um sistema">criptografar a partição raiz</a>. A leitura do <code>crypttab</code> é feita na inicialização pelo <code>systemd-cryptsetup-generator</code> automaticamente.
</p>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span> para detalhes, veja abaixo alguns exemplos, e a seção <a href="#Montando_na_inicializa%C3%A7%C3%A3o">#Montando na inicialização</a> para instruções de como usar UUIDs para montar um dispositivo criptografado.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> 
<ul>
<li>Se a opção <i>nofail</i> é especificada, a tela de entrada da senha pode desaparecer enquanto digita. <i>nofail</i> deve então somente ser usada junto com keyfiles.</li>
<li>Existem problemas no <a href="../en/Systemd.html" title="Systemd">systemd</a> quando ele processa entradas do <code>crypttab</code> para o <a href="../en/Dm-crypt/Device_encryption.html#Encryption_options_for_plain_mode" title="Dm-crypt/Device encryption">modo plain</a> (<code>--type plain</code>)  do <i>dm-crypt</i>:
<ul>
<li>Para dispositivos <code>--type plain</code> com uma keyfile, é necessário adicionar a opção <code>hash=plain</code> para o crypttab devido a uma <a rel="nofollow" class="external text" href="https://bugs.freedesktop.org/show_bug.cgi?id=52630">incompatibilidade do systemd</a>. <b>Não</b> use <code>systemd-cryptsetup</code> manualmente para a criação do dispositivo como medida provisória.</li>
<li>Pode ser necessário adicionar a opção <code>plain</code> explicitamente para forçar <code>systemd-cryptsetup</code> a reconhecer o dispositivo (<code>--type plain</code>) na inicialização. Veja <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/442">issue do systemd 442</a>.</li>
</ul>
</li>
</ul>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Exemplo de um arquivo crypttab. campos são: nome, dispositivo criptografado, senha, opções do cryptsetup.

# Monte /dev/lvm/swap criptografando-a com uma nova chave a cada inicialização.
 swap	/dev/lvm/swap	/dev/urandom	swap,cipher=aes-xts-plain64,size=256

# Monte /dev/lvm/tmp como /dev/mapper/tmp usando o modo plain do dm-crypt com uma senha randômica, fazendo seu conteúdo não recuperável depois de desmontada.
tmp	/dev/lvm/tmp	/dev/urandom	tmp,cipher=aes-xts-plain64,size=256 

# Monte /dev/lvm/home como /dev/mapper/home usando LUKS, solicite a senha durante a inicialização.
home   /dev/lvm/home

# Monte /dev/sdb1 como /dev/mapper/backup usando LUKS, com uma senha guardada em um arquivo.
backup /dev/sdb1       /home/alice/backup.key</pre>
<p>Para testar seu crypttab imediatamente depois de editá-lo, recarregue o gerenciador de configuração do systemd com:
</p>
<pre># systemctl daemon-reload
</pre>
<p>e <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Inicie">inicie</a> o recentemente gerado <code>systemd-cryptsetup@<i>nome</i>.service</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup status <i>name</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/<i>name</i> is active.
  type:    ...
  cipher:  ...
  keysize: ... bits
  key location: ...
  device:  /dev/sdxN
  sector size:  ...
  offset:  ... sectors
  size:    ... sectors
  mode:    ...
  flags:   ...</pre>
<p>Para mais informações sobre <code>systemd-cryptsetup@<i>nome</i>.service</code>, veja <a href="#Montando_em_demanda">#Montando em demanda</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se você usa GPT e tipo específico de partição UUIDs, você pode evitar crypttab e fstab para alguns pontos de montagem com systemd. Para mais informações veja <a href="../pt/Systemd.html#Automontagem_de_parti%C3%A7%C3%A3o_GPT" title="Systemd (Português)">systemd#Automontagem de partição GPT</a><sup>[<a href="../pt/Help:Procedures.html#Corrigir_links_quebrados_de_se%C3%A7%C3%B5es" class="mw-redirect" title="Help:Procedimentos">link quebrado</a>: seção inválida]</sup>.</div>
<h3>
<span id="Montando_na_inicializa.C3.A7.C3.A3o"></span><span class="mw-headline" id="Montando_na_inicialização">Montando na inicialização</span>
</h3>
<p>Se você quer montar uma unidade de armazenamento criptografada na inicialização, você pode colocar o UUID do dispositivo em <code>/etc/crypttab</code>. Para descobrir o UUID (da partição) pode usar o comando <code>lsblk -f</code> e adicioná-lo ao <code>crypttab</code> desse jeito:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">disco_externo         UUID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX        none    luks,timeout=180</pre>
<p>O primeiro parâmetro é o nome que o dispositivo criptografado vai receber quando aberto(que fica a sua preferência). A opção <code>none</code> fará a senha ser solicitada durante a inicialização. A opção <code>timeout</code> define um tempo de espera máximo em segundos para entrar com a senha.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Senhas entradas no prompt de senha são salvas no chaveiro do kernel pelo <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup.8">systemd-cryptsetup(8)</a></span> (quando <a href="#Usando_o_hook_sd-encrypt">usar o hook sd-encrypt</a>, isto também inclui senhas entradas no estágio do initramfs). Se um dispositivo no <code>crypttab</code> usa uma senha já entrada, o terceiro parâmetro pode ser definido para <code>none</code> e a senha salva em cache será automaticamente usada.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Tenha em mente que a opção <code>timeout</code> em <code>crypttab</code> somente determina a quantidade de tempo permitida para <i>entrar com a senha</i>. Adicionalmente, <a href="../en/Systemd.html" title="Systemd">systemd</a> também tem um tempo de espera máximo para o <i>dispositivo estar disponível</i> (90 segundos por padrão), que é independente do temporarizador da senha. Consequentemente, até quando a opção <code>timeout</code> em <code>crypttab</code> é definida para um valor maior que 90 segundos (ou está no seu valor padrão 0, sem limite de tempo), <i>systemd</i> esperará no máximo 90 segundos para o dispositivo ser aberto. Para mudar isso, a opção <code>x-systemd.device-timeout</code> (veja <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.mount"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.mount.5">systemd.mount(5)</a></span>) pode ser definida no <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a> para tal dispositivo. Provavelmente é desejado que a quantidade de tempo da opção <code>timeout</code> no <code>crypttab</code> é igual a presente na opção <code>x-systemd.device-timeout</code> no <code>fstab</code> para cada dispositivo montado na inicialização.</div>
<h4><span class="mw-headline" id="Desbloqueando_com_uma_keyfile">Desbloqueando com uma keyfile</span></h4>
<p>Se a <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">keyfile</a> para um sistema de arquivos não raiz está guardada dentro do sistema criptografado, ela está segura quando o sistema está desligado e pode ser automaticamente aberto durante a inicialização via <a href="#crypttab">crypttab</a>. Por exemplo, abrir um dispositivo especificado com <a href="../pt/Persistent_block_device_naming.html#by-uuid" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">UUID</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">home    UUID=&lt;identificador UUID&gt;    /etc/cryptsetup-keys.d/home-crypt.key</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>Se uma keyfile não é especificada, <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup.8">systemd-cryptsetup(8)</a></span> irá automaticamente tentar carregá-la de <code>/etc/cryptsetup-keys.d/<i>nome</i>.key</code> e <code>/run/cryptsetup-keys.d/<i>nome</i>.key</code>.<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/pull/15637">[3]</a>
</li>
<li>Se você prefere usar o modo <code>--plain</code>, as opções de encriptação necessárias para abrir o dispositivo deverão ser especificadas no <code>/etc/crypttab</code>. Tome cuidado ao fazer a medida provisória mencionada no <a href="#crypttab">crypttab</a>.</li>
</ul>
</div>
<p>Use o nome do dispositivo mapeado (definido no <code>/etc/crypttab</code>) para fazer a entrada no <code>/etc/fstab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/home        /home   ext4        defaults        0       2
</pre>
<p>Desde que <code>/dev/mapper/home</code> já é uma mapeação única, não existe a necessidade de especificar o UUID dele. Em qualquer caso, o sistema de arquivos mapeado vai ter um UUID diferente da partição criptografada.
</p>
<h4><span class="mw-headline" id="Montando_um_dispositivo_de_bloco_empilhado">Montando um dispositivo de bloco empilhado</span></h4>
<p>Os geradores do systemd também processam automaticamente os dispositivos de bloco empilhados na inicialização. 
</p>
<p>Por exemplo, você pode usar o cryptsetup numa configuração do <a href="../en/RAID.html" title="RAID">RAID</a> e criar um volume lógico <a href="../pt/LVM.html" title="LVM (Português)">LVM</a> com o sistema de arquivos dentro de um dispositivo de bloco criptografado. Resultando em: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk -f</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">─sdXX                  linux_raid_member    
│ └─md0                 crypto_LUKS   
│   └─cryptedbackup     LVM2_member 
│     └─vgraid-lvraid   ext4              /mnt/backup
└─sdYY                  linux_raid_member    
  └─md0                 crypto_LUKS       
    └─cryptedbackup     LVM2_member 
      └─vgraid-lvraid   ext4              /mnt/backup
</pre>
<p>A senha será solicitada e ele será montado na inicialização. 
</p>
<p>Ao especificar corretamente as entradas do crypttab (exemplo, UUID para o dispositivo <code>crypto_LUKS</code>) e fstab (<code>/dev/vgraid/lvraid</code>), não há necessidade para configurações/hooks adicionais no mkinitcpio, devido ao processamento do <code>/etc/crypttab</code> aplicado às partições não raiz somente. Existe uma exceção, quando o hook <code>mdadm_udev</code> <i>já</i> é usado (exemplo, o dispositivo raiz). Neste caso é necessário atualizar o <code>/etc/madadm.conf</code> e o initramfs para que a raid raiz correta seja selecionada.
</p>
<h3><span class="mw-headline" id="Montando_em_demanda">Montando em demanda</span></h3>
<p>Ao invés de:
</p>
<pre># cryptsetup luksOpen UUID=... disco_externo
</pre>
<p>Você pode <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Inicia">iniciar</a> o <code>systemd-cryptsetup@disco_externo.service</code>, quando você tem uma entrada como a seguir em seu <code>/etc/crypttab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">disco_externo UUID=... none noauto</pre>
<p>Desta maneira você não precisa se lembrar exatamente das opções do crypttab. A senha será solicitada se necessário.
</p>
<p>O arquivo correspondente unit é gerada automaticamente pelo <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup-generator.8">systemd-cryptsetup-generator(8)</a></span>. Você pode listar todos os arquivos unit gerados usando:
</p>
<pre>$ systemctl list-unit-files | grep systemd-cryptsetup
</pre>
<h2>
<span id="Solu.C3.A7.C3.A3o_de_problemas"></span><span class="mw-headline" id="Solução_de_problemas">Solução de problemas</span>
</h2>
<h3>
<span id="Sistema_travado_no_prompt_de_inicializa.C3.A7.C3.A3o.2Fsenha_n.C3.A3o_aparece"></span><span class="mw-headline" id="Sistema_travado_no_prompt_de_inicialização/senha_não_aparece">Sistema travado no prompt de inicialização/senha não aparece</span>
</h3>
<p>Se você está usando <a href="../pt/Plymouth.html" title="Plymouth (Português)">Plymouth</a>, tenha certeza de usar os módulos corretos (veja <a href="../pt/Plymouth.html#O_hook_do_plymouth" title="Plymouth (Português)">Plymouth#O hook do plymouth</a>) ou desabilite isso. De outra forma, Plymouth irá atrapalhar o prompt de senha, impedindo o sistema de inicializar.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../pt/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Português)">Data-at-rest encryption (Português)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Portugu%C3%AAs)/System_configuration_(Portugu%C3%AAs)&amp;oldid=655639">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Português)/System_configuration_(Português)&amp;oldid=655639</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 21 March 2021, at 16:14.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
