<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Português)/Encrypting an entire system (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Português_Encrypting_an_entire_system_Português rootpage-Dm-crypt_Português skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">dm-crypt (Português)/Encrypting an entire system (Português)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../pt/Dm-crypt.html" title="Dm-crypt (Português)">Dm-crypt (Português)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">Dm-crypt/Encrypting an entire system</a>. Data da última tradução: 2021-02-16. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Encrypting_an_entire_system&amp;diff=0&amp;oldid=615820">alterações</a> na versão em inglês.</div>
<p>Os exemplos a seguir são cenários comuns de um sistema criptografado com <i>dm-crypt</i>. Eles explicam todas as adaptações que serão realizadas do <a href="../pt/Installation_guide.html" class="mw-redirect" title="Guia de instalação">processo de instalação</a>. Todas as ferramentas necessárias estão disponíveis na <a rel="nofollow" class="external text" href="https://archlinux.org/download/">imagem de instalação</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Vis%C3%A3o_geral"><span class="tocnumber">1</span> <span class="toctext">Visão geral</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#LUKS_em_uma_parti%C3%A7%C3%A3o"><span class="tocnumber">2</span> <span class="toctext">LUKS em uma partição</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Preparando_o_disco"><span class="tocnumber">2.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Preparando_parti%C3%A7%C3%B5es_que_n%C3%A3o_s%C3%A3o_de_boot"><span class="tocnumber">2.2</span> <span class="toctext">Preparando partições que não são de boot</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Preparando_a_parti%C3%A7%C3%A3o_de_boot"><span class="tocnumber">2.3</span> <span class="toctext">Preparando a partição de boot</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Mountando_os_dispositivos"><span class="tocnumber">2.4</span> <span class="toctext">Mountando os dispositivos</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Configurando_o_mkinitcpio"><span class="tocnumber">2.5</span> <span class="toctext">Configurando o mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Configurando_o_gerenciador_de_boot"><span class="tocnumber">2.6</span> <span class="toctext">Configurando o gerenciador de boot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#LVM_dentro_do_LUKS"><span class="tocnumber">3</span> <span class="toctext">LVM dentro do LUKS</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Preparando_o_disco_2"><span class="tocnumber">3.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Preparando_os_volumes_l%C3%B3gicos"><span class="tocnumber">3.2</span> <span class="toctext">Preparando os volumes lógicos</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Preparando_a_parti%C3%A7%C3%A3o_de_inicializa%C3%A7%C3%A3o"><span class="tocnumber">3.3</span> <span class="toctext">Preparando a partição de inicialização</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Configurando_o_mkinitcpio_2"><span class="tocnumber">3.4</span> <span class="toctext">Configurando o mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Configurando_o_gerenciador_de_boot_2"><span class="tocnumber">3.5</span> <span class="toctext">Configurando o gerenciador de boot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#LUKS_dentro_do_LVM"><span class="tocnumber">4</span> <span class="toctext">LUKS dentro do LVM</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Preparando_o_disco_3"><span class="tocnumber">4.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Preparando_os_volumes_l%C3%B3gicos_2"><span class="tocnumber">4.2</span> <span class="toctext">Preparando os volumes lógicos</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Preparando_a_parti%C3%A7%C3%A3o_de_boot_2"><span class="tocnumber">4.3</span> <span class="toctext">Preparando a partição de boot</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Configurando_o_mkinitcpio_3"><span class="tocnumber">4.4</span> <span class="toctext">Configurando o mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Configurando_o_gerenciador_de_boot_3"><span class="tocnumber">4.5</span> <span class="toctext">Configurando o gerenciador de boot</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Configurando_o_fstab_e_crypttab"><span class="tocnumber">4.6</span> <span class="toctext">Configurando o fstab e crypttab</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Criptografando_o_volume_l%C3%B3gico_/home"><span class="tocnumber">4.7</span> <span class="toctext">Criptografando o volume lógico /home</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#LUKS_dentro_do_RAID_de_software"><span class="tocnumber">5</span> <span class="toctext">LUKS dentro do RAID de software</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Preparando_os_discos"><span class="tocnumber">5.1</span> <span class="toctext">Preparando os discos</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Fazendo_o_arranjo_RAID"><span class="tocnumber">5.2</span> <span class="toctext">Fazendo o arranjo RAID</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Preparando_os_dispositivos_de_bloco"><span class="tocnumber">5.3</span> <span class="toctext">Preparando os dispositivos de bloco</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Configurando_o_GRUB"><span class="tocnumber">5.4</span> <span class="toctext">Configurando o GRUB</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Criando_as_keyfiles"><span class="tocnumber">5.5</span> <span class="toctext">Criando as keyfiles</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Configurando_o_sistema"><span class="tocnumber">5.6</span> <span class="toctext">Configurando o sistema</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30">
<a href="#dm-crypt_plain"><span class="tocnumber">6</span> <span class="toctext">dm-crypt plain</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#Preparando_o_disco_4"><span class="tocnumber">6.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#Preparando_a_parti%C3%A7%C3%A3o_que_n%C3%A3o_%C3%A9_de_boot"><span class="tocnumber">6.2</span> <span class="toctext">Preparando a partição que não é de boot</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Preparando_a_parti%C3%A7%C3%A3o_de_boot_3"><span class="tocnumber">6.3</span> <span class="toctext">Preparando a partição de boot</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Configurando_mkinitcpio"><span class="tocnumber">6.4</span> <span class="toctext">Configurando mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Configurando_o_gerenciador_de_boot_4"><span class="tocnumber">6.5</span> <span class="toctext">Configurando o gerenciador de boot</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#P%C3%B3s-instala%C3%A7%C3%A3o"><span class="tocnumber">6.6</span> <span class="toctext">Pós-instalação</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-37">
<a href="#Parti%C3%A7%C3%A3o_de_boot_criptografada_(GRUB)"><span class="tocnumber">7</span> <span class="toctext">Partição de boot criptografada (GRUB)</span></a>
<ul>
<li class="toclevel-2 tocsection-38"><a href="#Preparando_o_disco_5"><span class="tocnumber">7.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Preparando_os_volumes_l%C3%B3gicos_3"><span class="tocnumber">7.2</span> <span class="toctext">Preparando os volumes lógicos</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Configurando_o_mkinitcpio_4"><span class="tocnumber">7.3</span> <span class="toctext">Configurando o mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#Configurando_o_GRUB_2"><span class="tocnumber">7.4</span> <span class="toctext">Configurando o GRUB</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Evite_digitar_a_senha_duas_vezes"><span class="tocnumber">7.5</span> <span class="toctext">Evite digitar a senha duas vezes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-43">
<a href="#Subvolumes_do_Btrfs_com_swap"><span class="tocnumber">8</span> <span class="toctext">Subvolumes do Btrfs com swap</span></a>
<ul>
<li class="toclevel-2 tocsection-44"><a href="#Preparando_o_disco_6"><span class="tocnumber">8.1</span> <span class="toctext">Preparando o disco</span></a></li>
<li class="toclevel-2 tocsection-45">
<a href="#Preparando_a_parti%C3%A7%C3%A3o_do_sistema"><span class="tocnumber">8.2</span> <span class="toctext">Preparando a partição do sistema</span></a>
<ul>
<li class="toclevel-3 tocsection-46"><a href="#Crie_o_container_LUKS"><span class="tocnumber">8.2.1</span> <span class="toctext">Crie o container LUKS</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="#Abra_o_container_LUKS"><span class="tocnumber">8.2.2</span> <span class="toctext">Abra o container LUKS</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#Formate_o_dispositivo_mapeado"><span class="tocnumber">8.2.3</span> <span class="toctext">Formate o dispositivo mapeado</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="#Monte_o_dispositivo_mapeado"><span class="tocnumber">8.2.4</span> <span class="toctext">Monte o dispositivo mapeado</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-50">
<a href="#Criando_subvolumes_do_btrfs"><span class="tocnumber">8.3</span> <span class="toctext">Criando subvolumes do btrfs</span></a>
<ul>
<li class="toclevel-3 tocsection-51"><a href="#Esbo%C3%A7o"><span class="tocnumber">8.3.1</span> <span class="toctext">Esboço</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#Crie_os_subvolumes_de_n%C3%ADvel_superior"><span class="tocnumber">8.3.2</span> <span class="toctext">Crie os subvolumes de nível superior</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#Monte_os_subvolumes_de_n%C3%ADvel_superior"><span class="tocnumber">8.3.3</span> <span class="toctext">Monte os subvolumes de nível superior</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#Crie_os_subvolumes_aninhados"><span class="tocnumber">8.3.4</span> <span class="toctext">Crie os subvolumes aninhados</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#Monte_a_ESP"><span class="tocnumber">8.3.5</span> <span class="toctext">Monte a ESP</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-56">
<a href="#Configurando_o_mkinitcpio_5"><span class="tocnumber">8.4</span> <span class="toctext">Configurando o mkinitcpio</span></a>
<ul>
<li class="toclevel-3 tocsection-57"><a href="#Crie_a_keyfile"><span class="tocnumber">8.4.1</span> <span class="toctext">Crie a keyfile</span></a></li>
<li class="toclevel-3 tocsection-58"><a href="#Edite_o_mkinitcpio.conf"><span class="tocnumber">8.4.2</span> <span class="toctext">Edite o mkinitcpio.conf</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-59"><a href="#Configurando_o_gerenciador_de_boot_5"><span class="tocnumber">8.5</span> <span class="toctext">Configurando o gerenciador de boot</span></a></li>
<li class="toclevel-2 tocsection-60"><a href="#Configurando_a_swap"><span class="tocnumber">8.6</span> <span class="toctext">Configurando a swap</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id="Vis.C3.A3o_geral"></span><span class="mw-headline" id="Visão_geral">Visão geral</span>
</h2>
<p><i>dm-crypt</i> se destaca, tanto em funcionalidades quanto em velocidade, quando o assunto é proteger o sistema de arquivos principal. Diferente da encriptação seletiva de sistemas de arquivos secundários, a criptografia de todo um sistema pode proteger informações como quais programas estão instalados, os nomes de usuários de todas as contas, e vetores comuns de vazamento de dados tais como <a href="../en/Locate.html" class="mw-redirect" title="Mlocate">mlocate</a> e <code>/var/log</code>. E, é bem mais difícil fazer alterações em um sistema criptografado, exceto o <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">gerenciador de boot</a> e (geralmente) o kernel que não são criptografados.
</p>
<p>Todos os cenários ilustrados a seguir compartilham as vantagens supracitadas, prós e contras que os diferenciam estão resumidos abaixo:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Cenários
</th>
<th>Vantagens
</th>
<th>Desvantagens
</th>
</tr>
<tr>
<td>
<a href="#LUKS_em_uma_parti%C3%A7%C3%A3o">#LUKS em uma partição</a>
<p>Mostra uma configuração básica e direta para uma partição principal criptografada com LUKS.
</p>
</td>
<td>
<ul><li>Simples particionamento e configuração</li></ul>
</td>
<td>
<ul><li>Inflexível; o espaço em disco precisa ser alocado antes de criptografar</li></ul>
</td>
</tr>
<tr>
<td>
<a href="#LVM_dentro_do_LUKS">#LVM dentro do LUKS</a>
<p>Consegue flexibilidade no particionamento ao usar LVM dentro de uma partição criptografada com LUKS.
</p>
</td>
<td>
<ul>
<li>Simples particionamento se sabe como usar LVM</li>
<li>Somente uma chave para desbloquear todos os volumes (exemplo, configuração simples de resume-from-disk)</li>
<li>design de volumes não é visível quando bloqueado</li>
<li>Método mais fácil para <a href="../pt/e48c704551cc17f65bac6e6f991e0c3f.html#Com_suporte_a_suspender_para_o_disco" class="mw-redirect" title="Dm-crypt/Swap criptografada">suspensão para o disco</a>
</li>
</ul>
</td>
<td>
<ul>
<li>LVM adiciona mais uma camada adicional de mapeamento e hook</li>
<li>Menos útil, se um volume deve receber uma chave separada</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#LUKS_dentro_do_LVM">#LUKS dentro do LVM</a>
<p>usa dm-crypt somente depois de configurar o LVM.
</p>
</td>
<td>
<ul>
<li>LVM pode ser usado para volumes criptografados em múltiplos discos</li>
<li>Fácil de usar com grupos de volumes criptografados ou não</li>
</ul>
</td>
<td>
<ul>
<li>Complexo; para mudar volumes precisa modificar também os mapeadores de encriptação</li>
<li>Volumes precisam de chaves individuais</li>
<li>design de volumes não é visível quando bloquead</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#LUKS_dentro_do_RAID_de_software">#LUKS dentro do RAID de software</a>
<p>usa dm-crypt somente depois de configurar RAID.
</p>
</td>
<td>
<ul><li>Análogo ao LUKS dentro do LVM</li></ul>
</td>
<td>
<ul><li>Análogo ao LUKS dentro do LVM</li></ul>
</td>
</tr>
<tr>
<td>
<a href="#dm-crypt_plain">#dm-crypt plain</a>
<p>usa o modo plain (plano) do dm-crypt, sem cabeçalho do LUKS e suas opções para múltiplas chaves. <br>Este cenário também permite que dispositivos USB possam ser usados no <code>/boot</code> e como depósito de chaves, que pode ser aplicado para outros cenários.
</p>
</td>
<td>
<ul>
<li>Melhor  em relação aos dados para casos onde um cabeçalho do LUKS é danificado</li>
<li>Permite <a href="https://en.wikipedia.org/wiki/Disk_encryption#Full_disk_encryption" class="extiw" title="wikipedia:Disk encryption">encriptação total de disco</a>
</li>
<li>Ajuda a solucionar <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Suporte_a_discard/TRIM_para_unidades_de_estado_s%C3%B3lido_(SSD)" class="mw-redirect" title="Dm-crypt/Especificidades">problemas</a> com SSDs</li>
</ul>
</td>
<td>
<ul>
<li>Necessário grande atenção a todos os parâmetros</li>
<li>Encriptação de chave única e sem opção de mudança</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#Parti%C3%A7%C3%A3o_de_boot_criptografada_(GRUB)">#Partição de boot criptografada (GRUB)</a>
<p>Mostra como criptografar a partição de boot usando o gerenciador de boot GRUB. <br> Este cenário também usa uma partição de sistema EFI, que pode ser aplicado para outros cenários.
</p>
</td>
<td>
<ul>
<li>Mesmas vantagens do cenário de instalação em que é baseado (LVM dentro do LUKS neste particular exemplo)</li>
<li>Menos dados são deixados sem criptografia, exemplo o gerenciador de boot e a partição de sistema EFI, se presente</li>
</ul>
</td>
<td>
<ul>
<li>Mesmas desvantagens do cenário de instalação em que é baseado (LVM dentro do LUKS neste particular exemplo)</li>
<li>Configuração mais complicada</li>
<li>Não é suportado por outros gerenciadores de boot</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#Subvolumes_do_Btrfs_com_swap">#Subvolumes do Btrfs com swap</a>
<p>Mostra como criptografar um sistema <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>, incluindo o diretório <code>/boot</code>, também é possível adicionar uma partição para swap, em um hardware com suporte a UEFI.
</p>
</td>
<td>
<ul>
<li>similar a <a href="#Parti%C3%A7%C3%A3o_de_boot_criptografada_(GRUB)">#Partição de boot criptografada (GRUB)</a>
</li>
<li>Disponibilidade das funcionalidades do Btrfs</li>
</ul>
</td>
<td>
<ul><li>Similar a <a href="#Parti%C3%A7%C3%A3o_de_boot_criptografada_(GRUB)">#Partição de boot criptografada (GRUB)</a>
</li></ul>
</td>
</tr>
</tbody>
</table>
<p>Enquanto todos os cenários acima oferecem maior proteção contra ameaças externas do que somente criptografar sistemas de arquivos não raiz, eles também possuem uma desvantagem comum: qualquer usuário que possui a chave pode abrir todo o disco, e assim, acessar os dados de outro usuário. Se isto é uma preocupação, é possível fazer uma combinação de dispositivo de blocos e sistema de arquivos criptografados empilhados e adquirir as vantagens de ambos. Veja <a href="../pt/Data-at-rest_encryption.html" class="mw-redirect" title="Criptografia de dados em repouso">Criptografia de dados em repouso</a> para lhe ajudar no planejamento.
</p>
<p>Veja <a href="../pt/ad45d25565fc10042af3fc980f15016f.html#Particionamento" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">Dm-crypt/Preparando a unidade de armazenamento#Particionamento</a> para uma visão geral das estratégias de particionamento usadas nos cenários.
</p>
<p>Outra coisa a considerar é se deve usar uma partição swap criptografada e de qual forma. Veja <a href="../pt/e48c704551cc17f65bac6e6f991e0c3f.html" class="mw-redirect" title="Dm-crypt/Swap criptografada">dm-crypt/Swap criptografada</a> para alternativas.
</p>
<p>Se você antecipa a proteção de dados do sistema não somente contra roubo físico, como também contra adulteração lógica, veja <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Protegendo_a_parti%C3%A7%C3%A3o_de_boot_n%C3%A3o_criptografada" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Protegendo a partição de boot não criptografada</a> para possibilidades futuras após seguir um dos cenários.
</p>
<p>Para <a href="../en/Solid_state_drive.html" title="Solid state drive">SSDs</a>, você pode considerar habilitar suporte ao TRIM, mas esteja ciente que, isto tem potenciais problemas de segurança. Veja <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Suporte_a_discard/TRIM_para_unidades_de_estado_s%C3%B3lido_(SSD)" class="mw-redirect" title="Dm-crypt/Especificidades">Dm-crypt/Especificidades#Suporte a discard/TRIM para unidades de estado sólido (SSD)</a> para mais informações.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> 
<ul>
<li>Em qualquer cenário, nunca diretamente repare um volume criptografado com ferramentas de reparação de sistema de arquivos como <a href="../pt/Fsck.html" title="Fsck (Português)">fsck</a>, ou isto destruirá qualquer chance de recuperar a chave usada para abrir seus arquivos. Tais ferramentas devem ser usadas no dispositivo desbloqueado (aberto).</li>
<li>para o formato LUKS2:
<ul>
<li>Nenhuma versão liberada do <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> suporta LUKS2; veja <a rel="nofollow" class="external autonumber" href="https://savannah.gnu.org/bugs/?55093">[1]</a> e <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a> para detalhes. Use LUKS1 em partições que o GRUB precisa ter acesso.</li>
<li>o formato LUKS2 tem grande uso de RAM por escolha de design, o padrão é 1GB por mapeador criptografado. Máquinas com pouca RAM e/ou múltiplas partições LUKS2 abertas em paralelo podem falhar na inicialização. Veja a opção <code>--pbkdf-memory</code> para controlar o uso de memória.<a rel="nofollow" class="external autonumber" href="https://gitlab.com/cryptsetup/cryptsetup/issues/372">[2]</a>
</li>
</ul>
</li>
</ul>
</div>
<h2>
<span id="LUKS_em_uma_parti.C3.A7.C3.A3o"></span><span class="mw-headline" id="LUKS_em_uma_partição">LUKS em uma partição</span>
</h2>
<p>Este exemplo demonstra um sistema criptografado com <i>dm-crypt</i> + LUKS em uma partição:
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+--------------------+-------------------------------+-----------------------+
| Partição de boot   | Sistema criptogrado com LUKS2 | Espaço livre opcional |
|                    | partição                      | para outras partições |
|                    |                               |                       |
| /boot              | /                             |                       |
|                    |                               |                       |
|                    | /dev/mapper/cryptraiz         |                       |
|                    |-------------------------------|                       |
| /dev/sda1          | /dev/sda2                     |                       |
+--------------------+-------------------------------+-----------------------+
</pre>
<p>Os primeiros passos podem ser executados imediatamente após iniciar a imagem de instalação do Arch Linux.
</p>
<h3><span class="mw-headline" id="Preparando_o_disco">Preparando o disco</span></h3>
<p>Antes de criar qualquer partição, você deveria saber a importância e também métodos de como apagar o disco com segurança, descritos em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>.
</p>
<p>Crie as partições necessárias, ao menos uma para <code>/</code> (exemplo <code>/dev/sda2</code>) e <code>/boot</code> (<code>/dev/sda1</code>). Veja <a href="../pt/Partitioning.html" class="mw-redirect" title="Particionamento">Particionamento</a>.
</p>
<h3>
<span id="Preparando_parti.C3.A7.C3.B5es_que_n.C3.A3o_s.C3.A3o_de_boot"></span><span class="mw-headline" id="Preparando_partições_que_não_são_de_boot">Preparando partições que não são de boot</span>
</h3>
<p>Os comandos a seguir criam e montam a partição raiz criptografada. Eles correspondem ao detalhado procedimento descrito em <a href="../pt/76b2f1bc94005618aa69324c7701dbfd.html#Parti%C3%A7%C3%A3o" class="mw-redirect" title="Dm-crypt/Criptografando um sistema de arquivos não raiz">dm-crypt/Criptografando um sistema de arquivos não raiz#Partição</a> (que, apesar do título, <i>pode</i> ser aplicado a partições raiz, contanto que <a href="#Configurando_o_mkinitcpio">mkinitcpio</a> e o <a href="#Configurando_o_gerenciador_de_boot">gerenciador de boot</a> sejam corretamente configurados).
Se você deseja usar opções de encriptação que não são padrão (exemplo, cifras criptográficas, tamanho da chave), veja as <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">opções de encriptação</a> antes de executar o primeiro comando:
</p>
<pre># cryptsetup -y -v luksFormat /dev/sda2
# cryptsetup open /dev/sda2 cryptraiz
# mkfs.ext4 /dev/mapper/cryptraiz
# mount /dev/mapper/cryptraiz /mnt
</pre>
<p>Verifique se o mapeamento funcionou como esperado:
</p>
<pre># umount /mnt
# cryptsetup close cryptraiz
# cryptsetup open /dev/sda2 cryptraiz
# mount /dev/mapper/cryptraiz /mnt
</pre>
<p>Se você criou partições separadas (exemplo, <code>/home</code>), estes passos têm que ser adaptados e repetidos para todos eles, <i>exceto</i> para <code>/boot</code>. Veja <a href="../pt/76b2f1bc94005618aa69324c7701dbfd.html#Desbloqueio_e_montagem_automatizados" class="mw-redirect" title="Dm-crypt/Criptografando um sistema de arquivos não raiz">dm-crypt/Criptografando um sistema de arquivos não raiz#Desbloqueio e montagem automatizados</a> para como manusear partições adicionais na inicialização.
</p>
<p>Note que cada dispositivo de bloco precisa de sua própria senha. Isto pode ser inconveniente, por ser necessário inserir senhas separadas durante a inicialização. Uma alternativa é usar uma keyfile guardada na partição do sistema para desbloquear a partição separada por meio do <code>crypttab</code>. Veja <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Formatando_uma_parti%C3%A7%C3%A3o_com_LUKS_e_uma_keyfile" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Formatando uma partição com LUKS e uma keyfile</a> para instruções.
</p>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_de_boot"></span><span class="mw-headline" id="Preparando_a_partição_de_boot">Preparando a partição de boot</span>
</h3>
<p>O que você vai precisar fazer é uma partição para <code>/boot</code> não criptografada, que é necessária pelo sistema. Para uma partição ordinária em sistemas BIOS, por exemplo, execute:
</p>
<pre># mkfs.ext4 /dev/sda1
</pre>
<p>Ou para uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">Partição de sistema EFI</a> em sistemas UEFI:
</p>
<pre># mkfs.fat -F32 /dev/sda1
</pre>
<p>Depois crie o diretório e monte a partição:
</p>
<pre># mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
</pre>
<h3><span class="mw-headline" id="Mountando_os_dispositivos">Mountando os dispositivos</span></h3>
<p>no <a href="../pt/Installation_guide.html#Montar_os_sistemas_de_arquivos" class="mw-redirect" title="Guia de instalação">Guia de instalação#Montar os sistemas de arquivos</a> você vai precisar montar os dispositivos criptografados, não as partições. Claro <code>/boot</code>, que não é criptografado, ainda precisará ser montado diretamente.
</p>
<h3><span class="mw-headline" id="Configurando_o_mkinitcpio">Configurando o mkinitcpio</span></h3>
<p>Adicione os hooks <code>keyboard</code>, <code>keymap</code> e <code>encrypt</code> em <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a>. Se deseja padrão de teclado US, você pode omitir o hook <code>keymap</code>.
</p>
<pre>HOOKS=(base <b>udev</b> autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt</b> filesystems fsck)
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a> com o initramfs baseado no systemd, o seguinte precisa ser definido ao invês:
</p>
<pre>HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> filesystems fsck)
</pre>
<p>Dependendo de quais hooks estão sendo usados, a ordem pode ser relevante. Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes e outros hooks que você pode precisar.
</p>
<h3><span class="mw-headline" id="Configurando_o_gerenciador_de_boot">Configurando o gerenciador de boot</span></h3>
<p>Para desbloquear a partição raiz criptografada na inicialização, os seguintes <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">parâmetros do kernel</a> devem ser adicionados ao gerenciador de boot:
</p>
<pre>cryptdevice=UUID=<i>UUID-da-partição-raiz</i>:cryptraiz root=/dev/mapper/cryptraiz
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, o seguinte precisa ser definido ao invês:
</p>
<pre>rd.luks.name=<i>UUID-da-partição-raiz</i>=cryptraiz root=/dev/mapper/cryptraiz
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> para detalhes.
</p>
<p>o <code><i>UUID-da-partição-raiz</i></code> é para ser substituído pelo UUID da partição raiz, nesse caso <code>/dev/sda2</code>. Veja <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">Nomeação persistente de dispositivo de bloco</a> para detalhes.
</p>
<h2><span class="mw-headline" id="LVM_dentro_do_LUKS">LVM dentro do LUKS</span></h2>
<p>O método mais direto é configurar o <a href="../pt/LVM.html" title="LVM (Português)">LVM</a> em cima da partição criptografada, e não o contrário. Tecnicamente o LVM está dentro de um grande dispositivo de bloco criptografado. Em razão disso, o LVM não é visível até que o dispositivo de bloco seja aberto e o volume estruturado abaixo seja escaneado e montado durante a inicialização.
</p>
<p>O design do disco neste exemplo é::
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+-----------------------------------------------------------------------+ +------------------+
| volume lógico 1       | volume lógico 2       | volume Lógico 3       | | Partição de boot |
|                       |                       |                       | |                  |
| [SWAP]                | /                     | /home                 | | /boot            |
|                       |                       |                       | |                  |
| /dev/MeuGrupoVol/swap | /dev/MeuGrupoVol/raiz | /dev/MeuGrupoVol/home | | (pode ser        |
|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _| | em outro         |
|                                                                       | | dispositivo)     |
|                         Partição criptografada com LUKS2              | |                  |
|                           /dev/sda1                                   | | /dev/sdb1        |
+-----------------------------------------------------------------------+ +------------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Ao usar o hook <code>encrypt</code>, você não poderá utilizar volumes lógicos espalhados em múltiplos discos; use o <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a> ou veja <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Modificando_o_hook_encrypt_para_m%C3%BAltiplas_parti%C3%A7%C3%B5es" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Modificando o hook encrypt para múltiplas partições</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Duas variações dessa configuração:
<ul>
<li>Instruções em <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Sistema_criptografado_usando_um_cabe%C3%A7alho_LUKS_desanexado" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Sistema criptografado usando um cabeçalho LUKS desanexado</a> para usar um cabeçalho do LUKS em um dispositivo USB, e assim conseguindo autentificação de dois fatores com este método.</li>
<li>Instruções em <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Encrypted_/boot_and_a_detached_LUKS_header_on_USB" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#/boot criptografado e um cabeçalho do LUKS desanexado dentro de um USB</a>]] para usar um cabeçalho do LUKS, partição <code>/boot</code> criptografada, e keyfile criptografada tudo em um dispositivo USB.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Preparando_o_disco_2">Preparando o disco</span></h3>
<p>Antes de criar qualquer partição, você deveria saber a importância e também métodos de como apagar o disco com segurança, descritos em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se usa o gerenciador de boot <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> para inicialização com BIOS de um disco <a href="../pt/Partitioning.html#Tabela_de_Parti%C3%A7%C3%A3o_GUID" class="mw-redirect" title="Particionamento">GPT</a>, crie uma <a href="../pt/GRUB.html#Instru%C3%A7%C3%B5es_espec%C3%ADficas_de_Tabela_de_Parti%C3%A7%C3%A3o_GUID_(GPT)" class="mw-redirect" title="Partição de inicialização de BIOS">Partição de inicialização de BIOS</a>.</div>
<p>Crie uma partição que será montada em <code>/boot</code> com o tamanho de 200 MiB ou mais.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> sistemas UEFI podem usar a <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">Partição de sistema EFI</a> para a <code>/boot</code>.</div>
<p>Crie uma partição que depois irá conter o container criptografado.
</p>
<p>Crie o container criptografado com LUKS na partição do <i>sistema</i>. Enter com a senha escolhida duas vezes.
</p>
<pre># cryptsetup luksFormat /dev/sda1
</pre>
<p>Para mais informações sobre as opções disponíveis do cryptsetup veja as <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">opções de encriptação</a> antes de executar o comando acima.
</p>
<p>abra o container:
</p>
<pre># cryptsetup open /dev/sda1 cryptlvm
</pre>
<p>o container estará disponível em <code>/dev/mapper/cryptlvm</code>.
</p>
<h3>
<span id="Preparando_os_volumes_l.C3.B3gicos"></span><span class="mw-headline" id="Preparando_os_volumes_lógicos">Preparando os volumes lógicos</span>
</h3>
<p>Crie um volume físico em cima do container LUKS aberto:
</p>
<pre># pvcreate /dev/mapper/cryptlvm
</pre>
<p>Crie um grupo de volumes nomeado <code>MeuGrupoVol</code> (ou o que você desejar), e adicione ao, anteriormente criado, volume físico:
</p>
<pre># vgcreate MeuGrupoVol /dev/mapper/cryptlvm
</pre>
<p>Crie todos os seus volumes lógicos no grupo de volumes:
</p>
<pre># lvcreate -L 8G MeuGrupoVol -n swap
# lvcreate -L 32G MeuGrupoVol -n raiz
# lvcreate -l 100%FREE MeuGrupoVol -n home
</pre>
<p>Formate cada volume lógico para os sistemas de arquivos desejados:
</p>
<pre># mkfs.ext4 /dev/MeuGrupoVol/raiz
# mkfs.ext4 /dev/MeuGrupoVol/home
# mkswap /dev/MeuGrupoVol/swap
</pre>
<p>Monte eles:
</p>
<pre># mount /dev/MeuGrupoVol/raiz /mnt
# mkdir /mnt/home
# mount /dev/MeuGrupoVol/home /mnt/home
# swapon /dev/MeuGrupoVol/swap
</pre>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_de_inicializa.C3.A7.C3.A3o"></span><span class="mw-headline" id="Preparando_a_partição_de_inicialização">Preparando a partição de inicialização</span>
</h3>
<p>O gerenciador de boot carrega o kernel, <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, e seus arquivos de configuração do diretório <code>/boot</code>. Qualquer sistema de arquivos em um disco que pode ser lido pelo gerenciador de boot é elegível para uso.
</p>
<p>Coloque um <a href="../pt/File_systems.html" class="mw-redirect" title="Sistema de arquivos">sistema de arquivos</a> na partição escolhida como <code>/boot</code>:
</p>
<pre># mkfs.ext4 /dev/sdb1
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se optar por manter o <code>/boot</code> em uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">Partição de sistema EFI</a> a formatação recomendada é
<pre># mkfs.fat -F32 /dev/sdb1
</pre>
</div>
<p>Crie o diretório <code>/mnt/boot</code>:
</p>
<pre># mkdir /mnt/boot
</pre>
<p>Monte a partição para <code>/mnt/boot</code>:
</p>
<pre># mount /dev/sdb1 /mnt/boot
</pre>
<h3><span class="mw-headline" id="Configurando_o_mkinitcpio_2">Configurando o mkinitcpio</span></h3>
<p>Tenha certeza que o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> está <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instalado</a>, e adicione os hooks <code>keyboard</code>, <code>encrypt</code> e <code>lvm2</code> em <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a>:
</p>
<pre>HOOKS=(base <b>udev</b> autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a> com o initramfs baseado no systemd, o seguinte precisa ser definido ao invês:
</p>
<pre>HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes e outros hooks que você pode precisar.
</p>
<h3><span class="mw-headline" id="Configurando_o_gerenciador_de_boot_2">Configurando o gerenciador de boot</span></h3>
<p>Para desbloquear a partição raiz criptografada na inicialização, os seguintes parâmetros do kernel devem ser adicionados ao gerenciador de boot:
</p>
<pre>cryptdevice=UUID=<i>UUID-do-dispositivo</i>:cryptlvm root=/dev/MeuGrupoVol/raiz
</pre>
<p>Se você está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, o seguinte precisa ser definido ao invês:
</p>
<pre>rd.luks.name=<i>UUID-do-dispositivo</i>=cryptlvm root=/dev/MeuGrupoVol/raiz
</pre>
<p>o <code><i>UUID-do-dispositivo</i></code> precisa ser substituído pelo UUID da partição raiz, nesse caso <code>/dev/sda1</code>. Veja <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">Nomeação persistente de dispositivo de bloco</a> para mais detalhes.
</p>
<p>Se está usando <a href="../pt/Dracut.html" title="Dracut (Português)">dracut</a>, você pode precisar usar uma extensiva lista de parâmetros, tente:
</p>
<pre>kernel_cmdline="rd.luks.uuid=luks-<i>UUIDdoDispositivo</i> rd.lvm.lv=<i>MeuGrupoVol</i>/root  rd.lvm.lv=<i>MeuGrupoVol</i>/swap  root=/dev/mapper/<i>MeuGrupoVol</i>-root rootfstype=ext4 rootflags=rw,relatime"
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> para mais informação sobre.
</p>
<h2><span class="mw-headline" id="LUKS_dentro_do_LVM">LUKS dentro do LVM</span></h2>
<p>Você deve configurar os volumes do <a href="../pt/LVM.html" title="LVM (Português)">LVM</a> primeiro antes de usá-los como base para as partições criptografadas. Desta maneira, é possível fazer uma mistura de volumes/partições que são criptografadas ou não.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Diferente do <a href="#LVM_dentro_do_LUKS">#LVM dentro do LUKS</a>, este método permite usar volumes lógicos espalhados em múltiplos discos.</div>
<p>O texto a seguir exemplifica uma configuração do LUKS dentro do LVM que também faz uso de uma keyfile para o volume lógico /home e volumes temporários criptografados para <code>/tmp</code> e <code>/swap</code>. O último é desejável caso se preocupe com segurança, devido a evitar que dados temporários sensíveis sobrevivam durante a inicialização do sistema. Se tem experiência com LVM, você vai ser capaz de ignorar/trocar alguns dos passos relacionados com ele e outras coisas específicas de acordo com sua vontade.
</p>
<p>Se quer usar volumes lógicos espalhados por múltiplos discos que já foram configurados, ou expandir o <code>/home</code> (ou qualquer outro volume), um dos jeitos de como fazer isto é descrito em <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Expandindo_LVM_em_m%C3%BAltiplos_discos" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Expandindo LVM em múltiplos discos</a>. Vale notar que o container criptografado com LUKS precisa ser redimensionado também.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> A introdução desse cenário precisa de alguns ajustes, já que agora existem comparações em <a href="#Vis%C3%A3o_geral">#Visão geral</a>. Uma estrutura sugerida é a introdução presente em <a href="#LUKS_em_uma_parti%C3%A7%C3%A3o">#LUKS em uma partição</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt/Encrypting_an_entire_system">talk:dm-crypt/Encrypting an entire system</a>)</div>
</div>
<h3><span class="mw-headline" id="Preparando_o_disco_3">Preparando o disco</span></h3>
<p>Esquema de particionamento:
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+------------------+------------------------------------------------------------------------------------------------+
| Partição de boot | Volume criptografado com o   | Volume criptografado com LUKS2 | Volume criptografado com LUKS2 |
|                  | modo plain do dm-crypt       |                                |                                |
|                  |                              |                                |                                |
| /boot            | [SWAP]                       | /                              | /home                          |
|                  |                              |                                |                                |
|                  | /dev/mapper/swap             | /dev/mapper/raiz               | /dev/mapper/home               |
|                  |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |
|                  | Volume lógico 1              | Volume lógico 2                | Volume lógico 3                |
|                  | /dev/MeuGrupoVol/cryptswap   | /dev/MeuGrupoVol/cryptraiz     | /dev/MeuGrupoVol/crypthome     |
|                  |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ |
|   /dev/sda1      |                                   /dev/sda2                                                    |
+------------------+------------------------------------------------------------------------------------------------+
</pre>
<p>sobrescreva <code>/dev/sda2</code> de acordo com <a href="../pt/ad45d25565fc10042af3fc980f15016f.html#dm-crypt_limpa_o_disco_vazio_ou_parti%C3%A7%C3%A3o" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento#dm-crypt limpa o disco vazio ou partição</a>.
</p>
<h3>
<span id="Preparando_os_volumes_l.C3.B3gicos_2"></span><span class="mw-headline" id="Preparando_os_volumes_lógicos_2">Preparando os volumes lógicos</span>
</h3>
<pre># pvcreate /dev/sda2
# vgcreate MeuGrupoVol /dev/sda2
# lvcreate -L 32G -n raiz MeuGrupoVol
# lvcreate -L 500M -n cryptswap MeuGrupoVol
# lvcreate -L 500M -n crypttmp MeuGrupoVol
# lvcreate -l 100%FREE -n crypthome MeuGrupoVol
</pre>
<pre># cryptsetup luksFormat /dev/MeuGrupoVol/cryptraiz
# cryptsetup open /dev/MeuGrupoVol/cryptraiz raiz
# mkfs.ext4 /dev/mapper/raiz
# mount /dev/mapper/raiz /mnt
</pre>
<p>Mais informações sobre opções de encriptação podem ser encontradas em <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Opções de encriptação para o modo LUKS</a>.
Note que <code>/home</code> será criptografada em <a href="#Criptografando_o_volume_l%C3%B3gico_/home">#Criptografando o volume lógico /home</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se você precisar acessar a raiz criptografada pelo archiso, a ação <code>open</code> vai possibilitar a execução de comandos para <a href="../pt/LVM.html#Volumes_l%C3%B3gicos_n%C3%A3o_s%C3%A3o_exibidos" title="LVM (Português)">mostrar volumes do LVM</a>.</div>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_de_boot_2"></span><span class="mw-headline" id="Preparando_a_partição_de_boot_2">Preparando a partição de boot</span>
</h3>
<pre># dd if=/dev/zero of=/dev/sda1 bs=1M status=progress
# mkfs.ext4 /dev/sda1
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
</pre>
<h3><span class="mw-headline" id="Configurando_o_mkinitcpio_3">Configurando o mkinitcpio</span></h3>
<p>Tenha certeza que o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> está <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instalado</a>, e adicione os hooks <code>keyboard</code>, <code>lvm2</code> e <code>encrypt</code> em <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a>:
</p>
<pre>HOOKS=(base <b>udev</b> autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>lvm2</b> <b>encrypt</b> filesystems fsck)
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a> com o initramfs baseado no systemd, o seguinte precisa ser definido ao invês:
</p>
<pre>HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes e outros hooks que você pode precisar.
</p>
<h3><span class="mw-headline" id="Configurando_o_gerenciador_de_boot_3">Configurando o gerenciador de boot</span></h3>
<p>Para abrir a partição raiz criptografada na inicialização, os seguintes <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">parâmetros do kernel</a> precisam ser adicionados ao gerenciador de boot:
</p>
<pre>cryptdevice=UUID=<i>UUID-do-dispositivo</i>:raiz root=/dev/mapper/raiz
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, o seguinte precisa ser definido ao invés:
</p>
<pre>rd.luks.name=<i>UUID-do-dispositivo</i>=raiz root=/dev/mapper/raiz
</pre>
<p>O <code><i>UUID-do-dispositivo</i></code> precisa ser substituído pelo UUID do <code>/dev/MeuGrupoVol/cryptraiz</code>. Veja <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">Nomeação persistente de dispositivo de bloco</a> para detalhes.
</p>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> para mais informação sobre.
</p>
<h3><span class="mw-headline" id="Configurando_o_fstab_e_crypttab">Configurando o fstab e crypttab</span></h3>
<p>Ambas as entradas do <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#crypttab" class="mw-redirect" title="Crypttab (Português)">crypttab</a> e <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a> são necessárias para abrir o dispositivo e montar os sistemas de arquivos, respectivamente. As seguintes linhas irão criptografar os sistemas de arquivos temporários a cada inicialização:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">swap	/dev/MeuGrupoVol/cryptswap	/dev/urandom	swap,cipher=aes-xts-plain64,size=256
tmp	/dev/MeuGrupoVol/crypttmp	/dev/urandom	tmp,cipher=aes-xts-plain64,size=256</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/raiz        /       ext4            defaults        0       1
/dev/sda1               /boot   ext4            defaults        0       2
/dev/mapper/tmp         /tmp    tmpfs           defaults        0       0
/dev/mapper/swap        none    swap            sw              0       0
</pre>
<h3>
<span id="Criptografando_o_volume_l.C3.B3gico_.2Fhome"></span><span class="mw-headline" id="Criptografando_o_volume_lógico_/home">Criptografando o volume lógico /home</span>
</h3>
<p>Devido a este cenário usar LVM como mapeador primário e dm-crypt como secundário, cada volume lógico precisa ser criptografado separadamente. Apesar disso, diferente dos sistemas de arquivos temporários que foram configurados acima para serem voláteis, o volume lógico para <code>/home</code> vai ser persistente. O seguinte assume que você reiniciou o seu sistema criptografado, se você não fez isto, precisará adaptar os caminhos.
Para não digitar uma segunda senha na inicialização, uma <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">keyfile</a> é criada:
</p>
<pre># mkdir -m 700 /etc/luks-keys
# dd if=/dev/random of=/etc/luks-keys/home bs=1 count=256 status=progress
</pre>
<p>O volume lógico é criptografado com:
</p>
<pre># cryptsetup luksFormat -v /dev/MeuGrupoVol/crypthome /etc/luks-keys/home
# cryptsetup -d /etc/luks-keys/home open /dev/MeuGrupoVol/crypthome home
# mkfs.ext4 /dev/mapper/home
# mount /dev/mapper/home /home
</pre>
<p>A montagem dos volumes criptografados é feita tanto no <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#crypttab" class="mw-redirect" title="Crypttab (Português)">crypttab</a> como no <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">home	/dev/MeuGrupoVol/crypthome   /etc/luks-keys/home
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/home        /home   ext4        defaults        0       2
</pre>
<h2><span class="mw-headline" id="LUKS_dentro_do_RAID_de_software">LUKS dentro do RAID de software</span></h2>
<p>Este exemplo é baseado em uma configuração real para um notebook empresarial equipado com dois SSDs de tamanho igual, e um HDD adicional para guardar dados. O resultado é uma encriptação total de disco com LUKS1 (incluindo <code>/boot</code>) para todos as unidades de armazenamento, Os SSDs em um arranjo <a href="../en/RAID.html" title="RAID">RAID0</a>, e são usadas keyfiles para abrir todos os dispositivos criptografados, depois que o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> recebe a senha correta na inicialização.
</p>
<p>Esta configuração usa um esquema de partições muito simples, com as unidades de armazenamento RAID sendo montadas em <code>/</code> (sem partição <code>/boot</code> separada), e o HDD montado em <code>/data</code>.
</p>
<p>Por favor note que <a href="../pt/System_backup.html" class="mw-redirect" title="Backup do sistema">backups</a> regulares são muito importantes. Se qualquer um dos SSDs falharem, os dados contidos no arranjo RAID serão praticamente impossíveis de recuperar. Você pode querer um diferente <a href="../en/RAID.html#Standard_RAID_levels" title="RAID">nível de RAID</a> se a tolerância a falhas é considerada importante. 
</p>
<p>A encriptação não é negável nesta configuração.
</p>
<p>Os seguintes dispositivos de bloco são usados:
</p>
<pre>/dev/sda = primeiro SSD
/dev/sdb = segundo SSD
/dev/sdc = HDD
</pre>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+---------------+----------------+-----------------------+ +---------------+----------------+-----------------------+ +---------------------+
| Partição de   | Partição de    | Volume LUKS1          | | Partição de   | Partição de    | Volume LUKS1          | | volume LUKS2        |
| inicialização | sistema EFI    | criptografado         | | inicialização | sistema EFI    | criptografado         | | criptografado       |
| de BIOS       |                |                       | | de BIOS       |                |                       | |                     |
|               |                |                       | |               |                |                       | |                     |
|               | /efi           | /                     | |               | /efi           | /                     | | /data               |
|               |                |                       | |               |                |                       | |                     |
|               |                | /dev/mapper/cryptraiz | |               |                | /dev/mapper/cryptraiz | |                     |
|               +----------------+-----------------------+ |               +----------------+-----------------------+ |                     |
|               | arranjo RAID1  | arranjo RAID0         | |               | arranjo RAID1  | arranjo RAID0         | |                     |
|               | (parte 1 de 2) | (parte 1 de 2)        | |               | (parte 2 de 2) | (parte 2 de 2)        | |                     |
|               |                |                       | |               |                |                       | |                     |
|               | /dev/md/ESP    | /dev/md/raiz          | |               | /dev/md/ESP    | /dev/md/raiz          | |/dev/mapper/cryptdata|
|               +----------------+-----------------------+ |               |+---------------+-----------------------+ +---------------------+
| /dev/sda1     | /dev/sda2      | /dev/sda3             | | /dev/sdb1     | /dev/sdb2      | /dev/sdb3             | | /dev/sdc1           |
+---------------+----------------+-----------------------+ +---------------+----------------+-----------------------+ +---------------------+
</pre>
<p>Tenha certeza de substituir eles com os dispositivos apropriados para sua situação, eles podem ser diferentes.
</p>
<h3><span class="mw-headline" id="Preparando_os_discos">Preparando os discos</span></h3>
<p>Antes de criar qualquer partição, você deve se informar sobre a importância e também métodos de como apagar o disco com segurança, descritos em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>.
</p>
<p>Para <a href="../pt/GRUB.html#Sistemas_BIOS" title="GRUB (Português)">sistemas BIOS</a> com GPT, crie uma <a href="../pt/GRUB.html#Instru%C3%A7%C3%B5es_espec%C3%ADficas_de_Tabela_de_Parti%C3%A7%C3%A3o_GUID_(GPT)" class="mw-redirect" title="Partição de inicialização de BIOS">Partição de inicialização de BIOS</a> com o tamanho de 1 MiB para o GRUB poder utilizá-lo no segundo estágio da inicialização da BIOS. Não monte a partição. Para sistemas BIOS/MBR isto não é necessário.
</p>
<p>Para <a href="../pt/GRUB.html#Sistemas_UEFI" title="GRUB (Português)">sistemas UEFI</a> crie uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">Partição de sistema EFI</a> com um tamanho apropriado, ela mais tarde será montada em <code>/efi</code>.
</p>
<p>No restante do espaço disponível no dispositivo, crie uma partição (<code>/dev/sda3</code> neste exemplo) "Linux RAID". Coloque o ID do tipo da partição: <code>fd</code> para MBR ou GUID <code>A19D880F-05FC-4D3B-A006-743F0F84911E</code> para GPT.
</p>
<p>Uma vez que as partições forem criadas em <code>/dev/sda</code>, os seguintes comandos podem ser usados para clonar elas para <code>/dev/sdb</code>.
</p>
<pre># sfdisk -d /dev/sda &gt; sda.dump
# sfdisk /dev/sdb &lt; sda.dump
</pre>
<p>O HDD é preparado com um única partição Linux (<code>/dev/sdc1</code>) para todo o disco.
</p>
<h3><span class="mw-headline" id="Fazendo_o_arranjo_RAID">Fazendo o arranjo RAID</span></h3>
<p>Crie o arranjo RAID para os SSDs.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Todas as partes de uma partição de sistema EFI de arranjo RAID devem ser individualmente usáveis, isto significa que ela pode ser somente colocada em um arranjo RAID1.</li>
<li>O superbloco RAID deve ser colocado no fim da partição de sistema EFI usando <code>--metadata=1.0</code>, de outro modo, o firmware não conseguirá acessar a partição.</li>
</ul>
</div>
<pre># mdadm --create --verbose --level=1 --metadata=1.0 --raid-devices=2 /dev/md/ESP /dev/sda2 /dev/sdb2
</pre>
<p>Este exemplo utiliza RAID0 para a raiz, você pode desejar substituir para um nível diferente baseado em suas preferências ou necessidades.
</p>
<pre># mdadm --create --verbose --level=0 --metadata=1.2 --raid-devices=2 /dev/md/raiz /dev/sda3 /dev/sdb3
</pre>
<h3><span class="mw-headline" id="Preparando_os_dispositivos_de_bloco">Preparando os dispositivos de bloco</span></h3>
<p>Como explicado em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>, os dispositivos são apagados com dados randômicos utilizando <code>/dev/zero</code> e um dispositivo criptografado com uma chave randômica. Alternativamente, você pode usar <code>dd</code> com <code>/dev/random</code> ou <code>/dev/urandom</code>, apesar que será muito mais lento.
</p>
<pre># cryptsetup open --type plain /dev/md/raiz container --key-file /dev/random
# dd if=/dev/zero of=/dev/mapper/container bs=1M status=progress
# cryptsetup close container
</pre>
<p>e faça o mesmo para o HDD (<code>/dev/sdc1</code> neste exemplo).
</p>
<p>Encripte <code>/dev/md/raiz</code>:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Nenhuma versão liberada do <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> suporta LUKS2; veja <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a> para detalhes. Use LUKS1 (<code>--type luks1</code>) nas partições que o GRUB precisa acessar.</div>
<pre># cryptsetup -y -v luksFormat --type luks1 /dev/md/raiz
# cryptsetup open /dev/md/raiz cryptraiz
# mkfs.ext4 /dev/mapper/cryptraiz
# mount /dev/mapper/cryptraiz /mnt
</pre>
<p>e faça o mesmo para o HDD:
</p>
<pre># cryptsetup -y -v luksFormat /dev/sdc1
# cryptsetup open /dev/sdc1 cryptdata
# mkfs.ext4 /dev/mapper/cryptdata
# mkdir /mnt/data
# mount /dev/mapper/cryptdata /mnt/data
</pre>
<p>Para sistemas UEFI, defina a ESP (partição de sistema EFI):
</p>
<pre># mkfs.fat -F32 /dev/md/ESP
# mount /dev/md/ESP /mnt/efi
</pre>
<h3><span class="mw-headline" id="Configurando_o_GRUB">Configurando o GRUB</span></h3>
<p>Configure <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> para o sistema criptogrado com LUKS1, editando <code>/etc/default/grub</code> com o seguinte:
</p>
<pre>GRUB_CMDLINE_LINUX="cryptdevice=/dev/md/raiz:cryptraiz"
GRUB_ENABLE_CRYPTODISK=y
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> e <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a> para detalhes.
</p>
<p>Complete a instalação do GRUB para ambos os SSDs (em realidade, instalando somente em <code>/dev/sda</code> irá funcionar).
</p>
<pre># grub-install --target=i386-pc /dev/sda
# grub-install --target=i386-pc /dev/sdb
# grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3><span class="mw-headline" id="Criando_as_keyfiles">Criando as keyfiles</span></h3>
<p>Os próximos passos evitarão que você digite a senha duas vezes quando você inicializar o sistema (uma vez quando o grub pede ela para abrir o dispositivo LUKS1, outra quando o mkinitcpio assume o controle do sistema). Isto é feito ao criar uma <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">keyfile</a> e adicionando ela na imagem intramfs, fazendo com que o hook encrypt abra o dispositivo raiz. Veja <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Com_uma_keyfile_no_initramfs" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Com uma keyfile no initramfs</a> para detalhes.
</p>
<ul>
<li>Crie a <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">keyfile</a> e adicione a chave para <code>/dev/md/raiz</code>.</li>
<li>Crie outra keyfile para o HDD (<code>/dev/sdc1</code>) para que ele seja decriptografado na inicialização. Para conveniência, deixe a senha criada acima em um lugar onde você consiga recuperar facilmente se precisar. Edite o <code>/etc/crypttab</code> para decriptografar o HDD na inicialização. Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Desbloqueando_com_uma_keyfile" class="mw-redirect" title="Dm-crypt/Configuração do sistema">Dm-crypt/Configuração do sistema#Desbloqueando com uma keyfile</a>.</li>
</ul>
<h3><span class="mw-headline" id="Configurando_o_sistema">Configurando o sistema</span></h3>
<p>Edite o <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a> para montar os dispositivos de bloco <i>cryptraiz</i> e <i>cryptdata</i> e o ESP:
</p>
<pre>/dev/mapper/cryptraiz  /           ext4    rw,noatime  0   1
/dev/mapper/cryptdata  /data       ext4    defaults            0   2
/dev/md/ESP            /efi        vfat    rw,relatime,codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,tz=UTC,errors=remount-ro  0   2
</pre>
<p>Save a configuração do RAID:
</p>
<pre># mdadm --detail --scan &gt;&gt; /etc/mdadm.conf
</pre>
<p>Edite o <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a> e inclua sua keyfile, também coloque os hooks apropriados:
</p>
<pre>FILES=(/crypto_keyfile.bin)
HOOKS=(base udev autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>mdadm_udev</b> <b>encrypt</b> filesystems fsck)
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes.
</p>
<h2><span class="mw-headline" id="dm-crypt_plain">dm-crypt plain</span></h2>
<p>Diferente do LUKS, o modo <i>plain</i> do dm-crypt não precisa de um cabeçalho no dispositivo criptografado: Este cenário explora isso para configurar um sistema em uma partição não criptografada, o disco criptografado não será diferenciável de um disco cheio de dados randômicos, isto possibilita a <a href="https://en.wikipedia.org/wiki/pt:criptografia_neg%C3%A1vel" class="extiw" title="wikipedia:pt:criptografia negável">criptografia negável</a>. Veja também <a href="https://en.wikipedia.org/wiki/Disk_encryption#Full_disk_encryption" class="extiw" title="wikipedia:Disk encryption">wikipedia:Disk encryption#Full disk encryption</a>.
</p>
<p>Se a encriptação total de disco não é necessária, os métodos usando LUKS descritos nas seções acima são mais recomendados, tanto para a encriptação de sistema quanto partições. Funcionalidades do LUKS como gerenciamento de chaves com múltiplas senhas/keyfiles ou re-criptografar um dispositivo prontamente não estão disponiveis com o modo <i>plain</i>.
</p>
<p>O modo <i>plain</i> pode ser mais resiliente a danos que o LUKS, devido a não depender de um chave mestre de encriptação, que se danificada resulta em falhas. No entanto, usar esse modo requer mais configuração manual de opções de encriptação para se chegar a mesma força criptográfica. Veja também <a href="../pt/Data-at-rest_encryption.html#Metadados_criptogr%C3%A1ficos" class="mw-redirect" title="Criptografia de dados em repouso">Criptografia de dados em repouso#Metadados criptográficos</a>. O uso desse modo também pode ser considerado se está preocupado com os problemas explicados em <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Suporte_a_discard/TRIM_para_unidades_de_estado_s%C3%B3lido_(SSD)" class="mw-redirect" title="Dm-crypt/Especificidades">dm-crypt/Especificidades#Suporte a discard/TRIM para unidades de estado sólido (SSD)</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se deseja encriptação sem cabeçalho mas não está com certeza sobre a falta de derivação de chaves com o modo <i>plain</i>, pode usar uma destas duas alternativas:
<ul>
<li>
<a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#Sistema_criptografado_usando_um_cabe%C3%A7alho_LUKS_desanexado" class="mw-redirect" title="Dm-crypt/Especificidades">modo LUKS do dm-crypt com um cabeçalho desanexado</a>, usando a opção <code>--header</code>. Este método não pode ser usado com o hook <i>encrypt</i> padrão, mas sim com um modificado.</li>
<li>
<a href="../en/Tcplay.html" title="Tcplay">tcplay</a> que oferece a encriptação sem cabeçalho mas com a função PBKDF2.</li>
</ul>
</div>
<p>O cenário usa dois pendrives USB:
</p>
<ul>
<li>um para o dispositivo de boot, que permite  guardar as opções necessárias para abrir/desbloquear o dispositivo criptografado com o modo plain nas configurações do gerenciador de boot, desde que digitar eles a cada inicialização deve possivelemente resultar em erros;</li>
<li>outro para a keyfile (arquivo chave), assumindo que esta está guardada em bits normais, o atacante desatento pode conseguir o pendrive com ela e pensar que a keyfile é um dado randômico ao invês de ser visível como um arquivo normal. Veja também <a href="https://en.wikipedia.org/wiki/pt:Seguran%C3%A7a_por_obscurantismo" class="extiw" title="wikipedia:pt:Segurança por obscurantismo">Segurança por obscurantismo</a>, siga <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Keyfiles" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Keyfiles</a> para prepará-la.</li>
</ul>
<p>O exemplo de particionamento é:
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+-----------------------+-----------------------+-----------------------+ +----------------+ +---------------+
| Volume lógico 1       | Volume lógico 2       | Volume lógico 3       | | Dispositivo de | | Lugar onde a  |
|                       |                       |                       | | boot           | | keyfile será  |
|                       |                       |                       | |                | | guardada (não |
| /                     | [SWAP]                | /home                 | | /boot          | | particionada  |
|                       |                       |                       | |                | | no exemplo)   |
|                       |                       |                       | |                | |               |
| /dev/MeuVolGrupo/raiz | /dev/MeuVolGrupo/swap | /dev/MeuVolGrupo/home | | /dev/sdb1      | | /dev/sdc      |
|-------------------------+----------------------+----------------------| |----------------| |---------------|
| O disco /dev/sda é criptografado com o modo plain e usa LVM           | | Pendrive 1     | | Pendrive 2    |
+-----------------------------------------------------------------------+ +----------------+ +---------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>É possível usar somente um pendrive:
<ul>
<li>Ao colocar a chave em outra partição (por exemplo, /dev/sdb2).</li>
<li>Ao copiar a keyfile para o initramfs diretamente. Por exemplo, uma keyfile é copiada para a imagem initramfs ao colocar <code>FILES=(/etc/keyfile)</code> em <code>/etc/mkinitcpio.conf</code>. Para fazer o hook <code>encrypt</code> ler a keyfile na imagem initramfs, use o prefixo <code>rootfs:</code> antes do nome do arquivo, exemplo <code>cryptkey=rootfs:/etc/keyfile</code>.</li>
</ul>
</li>
<li>Outra opção é usar uma senha com uma boa <a href="../pt/Security.html#Escolhendo_senhas_seguras" class="mw-redirect" title="Segurança">entropia</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Preparando_o_disco_4">Preparando o disco</span></h3>
<p>É vital que o dispositivo mapeado tenha dados randômicos. Em particular nesse cenário.
</p>
<p>Veja <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a> e <a href="../pt/ad45d25565fc10042af3fc980f15016f.html#M%C3%A9todos_espec%C3%ADficos_do_dm-crypt" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento#Métodos específicos do dm-crypt</a>
</p>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_que_n.C3.A3o_.C3.A9_de_boot"></span><span class="mw-headline" id="Preparando_a_partição_que_não_é_de_boot">Preparando a partição que não é de boot</span>
</h3>
<p>Veja <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_plain" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Opções de encriptação para o modo plain</a> para detalhes.
</p>
<p>Usando o dispositivo <code>/dev/sda</code>, com a cifra aes-xts, tamanho de chave de 512 bit e uma keyfile, temos as seguintes opções para esse cenário:
</p>
<pre># cryptsetup --cipher=aes-xts-plain64 --offset=0 --key-file=/dev/sdc --key-size=512 open --type plain /dev/sda cryptlvm
</pre>
<p>Diferente da encriptação com LUKS, o comando acima deve ser executado <i>completamente</i> toda vez que o mapeamento precisa ser restabelecido, então é importante lembrar da cifra e detalhes da keyfile.
</p>
<p>Podemos agora checar se a entrada de mapeamento foi feita para <code>/dev/mapper/cryptlvm</code>:
</p>
<pre># fdisk -l
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Uma alternativa simples para o LVM, em casos do FAQ do cryptsetup onde ele não é necessário, é somente criar um sistema de arquivos com todo o dispositivo mapeado.</div> 
<p>Agora, configure os volumes lógicos do 	Volumes lógicos não são exibidos no dispositivo mapeado. Veja <a href="../pt/Install_Arch_Linux_on_LVM.html" class="mw-redirect" title="Instalar Arch Linux no LVM">Instalar Arch Linux no LVM</a> para maiores detalhes:
</p>
<pre># pvcreate /dev/mapper/cryptlvm
# vgcreate MeuVolGrupo /dev/mapper/cryptlvm
# lvcreate -L 32G MeuVolGrupo -n raiz
# lvcreate -L 10G MeuVolGrupo -n swap
# lvcreate -l 100%FREE MeuVolGrupo -n home
</pre>
<p>Formate e monte eles além de ativar a swap. Veja <a href="../pt/File_systems.html#Criar_um_sistema_de_arquivos" class="mw-redirect" title="Sistemas de arquivos">Sistemas de arquivos#Criar um sistema de arquivos</a> para mais detalhes:
</p>
<pre># mkfs.ext4 /dev/MeuVolGrupo/raiz
# mkfs.ext4 /dev/MeuVolGrupo/home
# mount /dev/MeuVolGrupo/raiz /mnt
# mkdir /mnt/home
# mount /dev/MeuVolGrupo/home /mnt/home
# mkswap /dev/MeuVolGrupo/swap
# swapon /dev/MeuVolGrupo/swap
</pre>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_de_boot_3"></span><span class="mw-headline" id="Preparando_a_partição_de_boot_3">Preparando a partição de boot</span>
</h3>
<p>A partição <code>/boot</code> pode ser instalada na partição vfat de um pendrive, se necessário. Mas se o particionamento manual é desejado, criar uma partição de 200 MiB é necessário. Crie a partição usando uma <a href="../pt/Partitioning.html#Ferramentas_de_particionamento" class="mw-redirect" title="Particionamento">ferramenta de particionamento</a> de sua escolha.
</p>
<p>Coloque um <a href="../pt/File_systems.html" class="mw-redirect" title="Sistema de arquivos">sistema de arquivos</a> na partição <code>/boot</code>:
</p>
<pre># mkfs.ext4 /dev/sdb1
# mkdir /mnt/boot
# mount /dev/sdb1 /mnt/boot
</pre>
<h3><span class="mw-headline" id="Configurando_mkinitcpio">Configurando mkinitcpio</span></h3>
<p>Tenha certeza que o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> está <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instalado</a>, e adicione os hooks <code>keyboard</code>, <code>encrypt</code> e <code>lvm2</code> no <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a>:
</p>
<pre>HOOKS=(base udev autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes e outros hooks que você pode precisar.
</p>
<h3><span class="mw-headline" id="Configurando_o_gerenciador_de_boot_4">Configurando o gerenciador de boot</span></h3>
<p>Para inicializar a partição raiz criptografada, os seguintes <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">parâmetros do kernel</a> precisma ser definidos no gerenciador de boot (note que 64 é o número de bytes em 512 bits):
</p>
<pre>cryptdevice=/dev/disk/by-id/<i>ID-do-sda</i>:cryptlvm cryptkey=/dev/disk/by-id/<i>ID-do-sdc</i>:0:64 crypto=:aes-xts-plain64:512:0:
</pre>
<p><code><i>ID-do-<b>disco</b></i></code> significa o id do disco referenciado. Veja <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">Nomeação persistente de dispositivo de bloco</a> para detalhes.
</p>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> para mais detalhes e outros parâmetros que você pode precisar.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se está usando o GRUB, você pode instalar no mesmo pendrive da partição /boot com:
<pre># grub-install --recheck /dev/sdb
</pre>
</div>
<h3>
<span id="P.C3.B3s-instala.C3.A7.C3.A3o"></span><span class="mw-headline" id="Pós-instalação">Pós-instalação</span>
</h3>
<p>Você pode remover os pendrives depois da inicialização. Já que a partição <code>/boot</code> não é normalmente necessária, a opção <code>noauto</code> pode ser adicionada na linha relevante em <code>/etc/fstab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># /dev/sdb1
/dev/sdb1 /boot ext4 <b>noauto</b>,rw,noatime 0 2
</pre>
<p>No entanto, quando uma atualização é feita para o initramfs, kernel ou gerenciador de boot é necessário que ela esteja montada. Como uma entrada no <code>fstab</code> já existe, ela pode ser montada simplesmente com:
</p>
<pre># mount /boot
</pre>
<h2>
<span id="Parti.C3.A7.C3.A3o_de_boot_criptografada_.28GRUB.29"></span><span class="mw-headline" id="Partição_de_boot_criptografada_(GRUB)">Partição de boot criptografada (GRUB)</span>
</h2>
<p>Esta configuração utiliza o mesmo particionamento que a seção <a href="#LVM_dentro_do_LUKS">#LVM dentro do LUKS</a>, com diferença que o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> é usado por ser capaz de inicializar de um volume lógico LVM e um <code>/boot</code> criptografado com LUKS1. Veja também <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a>.
</p>
<p>O Particionamento deste exemplo é:
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+--------------------+---------------------+-----------------------+-----------------------+-----------------------+
| Partição de        | Partição de sistema | Volume Lógico 1       | volume lógico 2       | volume lógico 3       |
| inicialização BIOS | EFI                 |                       |                       |                       |
|                    |                     |                       |                       |                       |
|                    | /efi                | /                     | [SWAP]                | /home                 |
|                    |                     |                       |                       |                       |
|                    |                     | /dev/MeuVolGrupo/raiz | /dev/MeuVolGrupo/swap | /dev/MeuVolGrupo/home |
| /dev/sda1          | /dev/sda2           |-----------------------+-----------------------+-----------------------+
| não criptografado  | não criptografado   | /dev/sda3 criptografado usando LVM dentro do LUKS1                    |
+--------------------+---------------------+-----------------------------------------------------------------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>Todos os cenários são exemplos. É possível utilizar os conceitos de distintos cenários na sua instalação, claro adaptando o que for necessário. Veja também uma variação desse cenário em <a href="#LVM_dentro_do_LUKS">#LVM dentro do LUKS</a>.</li>
<li>Você pode usar o script <code>cryptboot</code> do pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup> para um gerenciamento simplificado da inicialização com partição de boot criptografada (montar, desmontar, atualizar pacotes) e como uma defesa contra o ataque <a rel="nofollow" class="external text" href="https://www.schneier.com/blog/archives/2009/10/evil_maid_attac.html">Evil Maid</a> com <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html#Using_your_own_keys" class="mw-redirect" title="Secure Boot">UEFI Secure Boot</a>. Para mais detalhes e limitações veja a página do <a rel="nofollow" class="external text" href="https://github.com/xmikos/cryptboot">projeto cryptboot</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Preparando_o_disco_5">Preparando o disco</span></h3>
<p>Antes de criar qualquer partição, você deve saber a importância e métodos de como apagar o disco com segurança, descrito em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>.
</p>
<p>Para <a href="../pt/GRUB.html#Instru%C3%A7%C3%B5es_espec%C3%ADficas_de_Tabela_de_Parti%C3%A7%C3%A3o_GUID_(GPT)" title="GRUB (Português)">sistemas BIOS/GPT</a> crie uma <a href="../pt/GRUB.html#Instru%C3%A7%C3%B5es_espec%C3%ADficas_de_Tabela_de_Parti%C3%A7%C3%A3o_GUID_(GPT)" class="mw-redirect" title="Partição de inicialização de BIOS">partição de inicialização de BIOS</a> com o tamanho de 1 MiB para que o GRUB guarde o segundo estágio da inicialização BIOS. não monte a partição. Para sistemas BIOS/MBR isto não é necessário.
</p>
<p>Para <a href="../pt/GRUB.html#Sistemas_UEFI" title="GRUB (Português)">sistemas UEFI</a> crie uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">partição de sistema EFI</a> com tamanho apropriado, será montada em <code>/efi</code>.
</p>
<p>Crie uma partição do tipo <code>8309</code>, que mais tarde conterá o container criptografado para a LVM.
</p>
<p>Crie o container criptografado com LUKS:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> GRUB não suporta LUKS2. Use LUKS1 (<code>--type luks1</code>) em partições que o GRUB precisa acessar  (e.x. a partição que contém o gerenciador de boot). Se seu sistema de arquivos raiz é separado, ele pode ainda usar o LUKS2. Existe suporte experimental do LUKS2 no <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-git/">grub-git</a></span><sup><small>AUR</small></sup>, veja os comentários para instruções.</div>
<pre># cryptsetup luksFormat --type luks1 /dev/sda3
</pre>
<p>Para mais informações sobre as opções do cryptsetup disponíveis, veja <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Opções de encriptação para o modo LUKS</a> antes do comando acima.
</p>
<p>Seu particionamento deve ser similar a:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># gdisk -l /dev/sda</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048            4095   1024.0 KiB  EF02  BIOS boot partition
   2            4096         1130495   550.0 MiB   EF00  EFI System
   3         1130496        68239360   32.0 GiB    8309  Linux LUKS
</pre>
<p>Abra o container:
</p>
<pre># cryptsetup open /dev/sda3 cryptlvm
</pre>
<p>o container aberto agora está disponível em <code>/dev/mapper/cryptlvm</code>.
</p>
<h3>
<span id="Preparando_os_volumes_l.C3.B3gicos_3"></span><span class="mw-headline" id="Preparando_os_volumes_lógicos_3">Preparando os volumes lógicos</span>
</h3>
<p>Os volumes lógicos do LVM neste exemplo seguem o particionamento acima como o cenário <a href="#LVM_dentro_do_LUKS">#LVM dentro do LUKS</a>. Siga <a href="#Preparando_os_volumes_l%C3%B3gicos">#Preparando os volumes lógicos</a> acima, ajuste o que desejar e precisar.
</p>
<p>Se você planeja inicializar no modo UEFI, crie um ponto de montagem para <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">partição de sistema EFI</a> em <code>/efi</code> para compatibilidade com <code>grub-install</code> e monte:
</p>
<pre># mkdir /mnt/efi
# mount /dev/sda2 /mnt/efi
</pre>
<p>Neste ponto, você deve ter as seguintes partições e volumes lógicos dentro de <code>/mnt</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME                   MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda                      8:0    0   200G  0 disk
├─sda1                   8:1    0     1M  0 part
├─sda2                   8:2    0   550M  0 part  /mnt/efi
└─sda3                   8:3    0   100G  0 part
  └─cryptlvm           254:0    0   100G  0 crypt
    ├─MeuVolGrupo-swap 254:1    0     8G  0 lvm   [SWAP]
    ├─MeuVolGrupo-root 254:2    0    32G  0 lvm   /mnt
    └─MeuVolGrupo-home 254:3    0    60G  0 lvm   /mnt/home
</pre>
<h3><span class="mw-headline" id="Configurando_o_mkinitcpio_4">Configurando o mkinitcpio</span></h3>
<p>Tenha certeza que o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> está <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instalado</a>, e adicione os hooks <code>keyboard</code>, <code>encrypt</code> e <code>lvm2</code> no <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a>:
</p>
<pre>HOOKS=(base <b>udev</b> autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Se está usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a> com o initramfs baseado no systemd, o seguinte precisa ser definido ao invês:
</p>
<pre>HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> <b>lvm2</b> filesystems fsck)
</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para detalhes e outros hooks que você pode precisar.
</p>
<h3><span class="mw-headline" id="Configurando_o_GRUB_2">Configurando o GRUB</span></h3>
<p>Para permitir a inicialização, configure o GRUB para que ele consiga acessar o <code>/boot</code> que está dentro de uma partição criptografada com LUKS1:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/grub</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">GRUB_ENABLE_CRYPTODISK=y</pre>
<p>Defina os parâmetros do kernel, para que o initramfs possa abrir a partição raiz criptografada. Se for usar o hook <code>encrypt</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/grub</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">GRUB_CMDLINE_LINUX="... cryptdevice=UUID=<i>UUID-do-dispositivo</i>:cryptlvm ..."</pre>
<p>Se for usar o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, o seguinte precisa ser definido:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/grub</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">GRUB_CMDLINE_LINUX="... rd.luks.name=<i>UUID-do-dipositivo</i>=cryptlvm ..."</pre>
<p>Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Gerenciador_de_boot" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Gerenciador de boot</a> e <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a> for details. <code><i>UUID-do-dispositivo</i></code> faz referência ao UUID do <code>/dev/sda3</code> (a partição que tem o sistema de arquivos raiz contido no LVM). Veja <a href="../pt/Persistent_block_device_naming.html" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">Nomeação persistente de dispositivo de bloco</a>.
</p>
<p><a href="../pt/GRUB.html#Instala%C3%A7%C3%A3o_2" title="GRUB (Português)">instale o GRUB</a> na ESP montada para inicialização UEFI:
</p>
<pre># grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB --recheck
</pre>
<p><a href="../pt/GRUB.html#Instala%C3%A7%C3%A3o" title="GRUB (Português)">instale o GRUB</a> no disco para inicialização BIOS:
</p>
<pre># grub-install --target=i386-pc --recheck /dev/sda
</pre>
<p>Gere o arquivo de <a href="../pt/GRUB.html#Gerar_o_arquivo_de_configura%C3%A7%C3%A3o_principal" title="GRUB (Português)">configuração</a> do GRUB:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>Se todos os comandos foram executados sem erros, GRUB deve solicitar a senha para abrir a partição <code>/dev/sda3</code> na próxima inicialização.
</p>
<h3><span class="mw-headline" id="Evite_digitar_a_senha_duas_vezes">Evite digitar a senha duas vezes</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Com_uma_keyfile_no_initramfs" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">Dm-crypt/Encriptação de dispositivo#Com uma keyfile no initramfs</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> Muito conteudo replicado, detalhes demais para uma página de visão geral. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt/Encrypting_an_entire_system#Security_Issue_with_Grub_Keyfile">Talk:Dm-crypt/Encrypting an entire system#Security Issue with Grub Keyfile</a>)</div>
</div>
<p>apesar do GRUB solicitar a senha para abrir a partição criptografada com LUKS1, isso não é passado para o initramfs. Consequentemente, você vai precisa digitar a senha duas vezes: uma vez para o GRUB e outra para o initramfs.
</p>
<p>Esta seção lida com uma configuração extra para digitar a senha somente uma vez, no GRUB. Para isso é utilizado <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Com_uma_keyfile_no_initramfs" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">uma keyfile dentro do initramfs</a>.
</p>
<p>Primeiro crie uma keyfile e a adicione como uma chave do LUKS:
</p>
<pre># dd bs=512 count=4 if=/dev/random of=/root/cryptlvm.keyfile iflag=fullblock
# chmod 000 /root/cryptlvm.keyfile
# cryptsetup -v luksAddKey /dev/sda3 /root/cryptlvm.keyfile
</pre>
<p>Adicione a keyfile para a imagem do initramfs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">FILES=(/root/cryptlvm.keyfile)</pre>
<p>Crie novamente a imagem initramfs e proteja a keyfile dentro dela:
</p>
<pre># chmod 600 /boot/initramfs-linux*
</pre>
<p>Defina o seguinte parâmetro do kernel para abrir a partição criptografada com a keyfile. Se está usando o hook <code>encrypt</code>:
</p>
<pre>GRUB_CMDLINE_LINUX="... cryptkey=rootfs:/root/cryptlvm.keyfile"
</pre>
<p>Ou, usando o hook <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>:
</p>
<pre>GRUB_CMDLINE_LINUX="... rd.luks.key=<i>device-UUID</i>=/root/cryptlvm.keyfile"
</pre>
<p>Se por algum motivo a keyfile falhar, systemd solicitará a senha para abrir e, em caso dela estar correta, continuar a inicialização.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Se quer criptografar a partição <code>/boot</code> para proteger contra ameaças de adulteração offline (offline tampering threats), o hook <a href="../pt/8aeceb416a4d3c4653be7ffd279afda1.html#mkinitcpio-chkcryptoboot" class="mw-redirect" title="Dm-crypt/Especificidades">mkinitcpio-chkcryptoboot</a> têm sido desenvolvido para isso.</div>
<h2><span class="mw-headline" id="Subvolumes_do_Btrfs_com_swap">Subvolumes do Btrfs com swap</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Btrfs <a href="../en/Btrfs.html#Swap_file" title="Btrfs">supports swapfile</a> since 5.0 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt/Encrypting_an_entire_system#Complete_guide_of_Btrfs_on_LUKS_full_disk_encryption">Talk:Dm-crypt/Encrypting_an_entire_system#Complete_guide_of_Btrfs_on_LUKS_full_disk_encryption</a>)</div>
</div>
<p>O seguinte exemplo cria todo um sistema criptografado com LUKS1, <a href="../en/Btrfs.html#Mounting_subvolumes" title="Btrfs">simulando partições</a> com subvolumes do <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>.
</p>
<p>Ao usar UEFI, uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">Partição de sistema EFI</a> (ESP) é necessária. <code>/boot</code> pode estar em <code>/</code> e ser criptografada; no entanto, a ESP não pode ser criptografada. Neste exemplo, a ESP é <code>/dev/sda1</code> e está montada em <code>/efi</code>. <code>/boot</code> está localizada na partição do sistema, <code>/dev/sda2</code>.
</p>
<p>Desde que <code>/boot</code> reside na <code>/</code> criptografada com LUKS1, <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> deve ser usado como o gerenciador de boot porque somente ele pode carregar os módulos para decriptografar <code>/boot</code> (exemplo, crypto.mod, cryptodisk.mod e luks.mod).
</p>
<p>Também é mostrada uma partição <a href="../pt/Swap.html" title="Swap (Português)">swap</a> criptografada.
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">+-----------------------+-------------------------+------------------+
| Partição de sistema   | Partição do sistema     | Partição swap    |
| EFI não criptografada | criptografada com LUKS1 | criptografada    |
|                       |                         |                  |
| /efi                  | /                       | [SWAP]           |
| /dev/sda1             | /dev/sda2               | /dev/sda3        |
|-----------------------+-------------------------+------------------+
</pre>
<h3><span class="mw-headline" id="Preparando_o_disco_6">Preparando o disco</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Não é possível utilizar o btrfs como descrito em <a href="../en/Btrfs.html#Partitionless_Btrfs_disk" title="Btrfs">Btrfs#Partitionless Btrfs disk</a> ao usar o LUKS. Particionamento tradicional deve ser usado, mesmo se é somente para criar uma partição.</div>
<p>Antes de criar qualquer partição, você deveria saber a importância e também métodos de como apagar o disco com segurança, descritos em <a href="../pt/ad45d25565fc10042af3fc980f15016f.html" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">dm-crypt/Preparando a unidade de armazenamento</a>. Se você está usando <a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> crie uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="Partição de sistema EFI">partição de sistema EFI</a> com o tamanho apropriado. Ela será montada em <code>/efi</code>. Se você vai criar uma partição swap criptografada, crie ela, mas <i>não</i> marque isso como swap, desde que ela será usada no modo plain do <i>dm-crypt</i>.
</p>
<p>Crie as partições, ao menos uma para <code>/</code> (exemplo, <code>/dev/sda2</code>). Veja o artigo <a href="../pt/Partitioning.html" class="mw-redirect" title="Particionamento">Particionamento</a>.
</p>
<h3>
<span id="Preparando_a_parti.C3.A7.C3.A3o_do_sistema"></span><span class="mw-headline" id="Preparando_a_partição_do_sistema">Preparando a partição do sistema</span>
</h3>
<h4><span class="mw-headline" id="Crie_o_container_LUKS">Crie o container LUKS</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> GRUB não suporta LUKS2. Use LUKS1 (<code>--type luks1</code>) em partições que ele precisa acessar.</div>
<p>Siga <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Criptografando_dispositivos_com_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Criptografando dispositivos com o modo LUKS</a> para configurar o <code>/dev/sda2</code> para LUKS. Veja o <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Opções de encriptação para o modo LUKS</a> para uma lista de opções de encriptação.
</p>
<h4><span class="mw-headline" id="Abra_o_container_LUKS">Abra o container LUKS</span></h4>
<p>Siga <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Abrindo/Mapeando_containers_LUKS_com_o_mapeador_de_dispositivos" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Abrindo/Mapeando containers LUKS com o mapeador de dispositivos</a> para abrir e mapear o container LUKS.
</p>
<h4><span class="mw-headline" id="Formate_o_dispositivo_mapeado">Formate o dispositivo mapeado</span></h4>
<p>Formate o dispositivo mapeado como descrito em <a href="../en/Btrfs.html#File_system_on_a_single_device" title="Btrfs">Btrfs#File system on a single device</a>, onde <code><i>/dev/partition</i></code> é o nome do dispositivo mapeado (i.e., <code>cryptraiz</code>) e <b>não</b> <code>/dev/sda2</code>.
</p>
<h4><span class="mw-headline" id="Monte_o_dispositivo_mapeado">Monte o dispositivo mapeado</span></h4>
<p>Finalmente, <a href="../pt/File_systems.html#Montar_um_sistema_de_arquivos" class="mw-redirect" title="Monte">monte</a> o agora formatado dispositivo mapeado (i.e., <code>/dev/mapper/cryptraiz</code>) para <code>/mnt</code>.
</p>
<h3><span class="mw-headline" id="Criando_subvolumes_do_btrfs">Criando subvolumes do btrfs</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for merging with <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>.</b><a href="../File:Merge-arrows-2.png" class="image"><img alt="Merge-arrows-2.png" src="../File:Merge-arrows-2.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> O esboço do subvolume não é específico para um sistema criptografado. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt/Encrypting_an_entire_system">talk:dm-crypt/Encrypting an entire system</a>)</div>
</div>
<h4>
<span id="Esbo.C3.A7o"></span><span class="mw-headline" id="Esboço">Esboço</span>
</h4>
<p><a href="../en/Btrfs.html#Subvolumes" title="Btrfs">Subvolumes</a> serão usados como partições simuladas, mas outros subvolumes (aninhados) serão criados. A seguir uma representação parcial do que este seguinte exemplo vai gerar:
</p>
<pre style="white-space: pre !important; font-variant-ligatures: no-common-ligatures;">subvolid=5 (/dev/sda2)
   |
   ├── @ (montado como /)
   |       |
   |       ├── /bin (diretório)
   |       |
   |       ├── /home (subvolume @home montado)
   |       |
   |       ├── /usr (diretório)
   |       |
   |       ├── /.snapshots (subvolume @snapshots montado)
   |       |
   |       ├── /var/cache/pacman/pkg (subvolume aninhado)
   |       |
   |       ├── ... (outros diretórios e subvolumes aninhados)
   |
   ├── @snapshots (montado como /.snapshots)
   |
   ├── @home (montado como /home)
   |
   └── @... (subvolumes adicionais que você deseja usar como ponto de montagem)
</pre>
<p>Este seção segue <a href="../en/Snapper.html#Suggested_filesystem_layout" title="Snapper">Snapper#Suggested filesystem layout</a> que é mais útil quando usado com o <a href="../en/Snapper.html" title="Snapper">snapper</a>. Você também deveria consultar <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Layout">Btrfs Wiki SysadminGuide#Layout</a>.
</p>
<h4>
<span id="Crie_os_subvolumes_de_n.C3.ADvel_superior"></span><span class="mw-headline" id="Crie_os_subvolumes_de_nível_superior">Crie os subvolumes de nível superior</span>
</h4>
<p>Será utilizada a convenção do prefixo <code>@</code> para os nomes do subvolume que serão usados como ponto de montagem, e<code>@</code> será o subvolume montado como <code>/</code>.
</p>
<p>Seguindo o artigo <a href="../en/Btrfs.html#Creating_a_subvolume" title="Btrfs">Btrfs#Creating a subvolume</a>, crie os subvolumes em <code>/mnt/@</code>, <code>/mnt/@snapshots</code>, e <code>/mnt/@home</code>.
</p>
<p>Crie qualquer subvolume adicional que desejar como ponto de montagem.
</p>
<h4>
<span id="Monte_os_subvolumes_de_n.C3.ADvel_superior"></span><span class="mw-headline" id="Monte_os_subvolumes_de_nível_superior">Monte os subvolumes de nível superior</span>
</h4>
<p>Desmonte a partição do sistema em <code>/mnt</code>.
</p>
<p>Agora monte os subvolumes <code>@</code> que irão servir como <code>/</code> para <code>/mnt</code> usando a opção de montagem <code>subvol=</code>. Assumindo que o nome do dispositivo mapeado é <code>cryptraiz</code>, o comando deve se parecer com:
</p>
<pre># mount -o compress=zstd,subvol=@ /dev/mapper/cryptraiz /mnt
</pre>
<p>Veja <a href="../en/Btrfs.html#Mounting_subvolumes" title="Btrfs">Btrfs#Mounting subvolumes</a> para mais detalhes.
</p>
<p>Também monte outros subvolumes para seus respectivos pontos de montagem: <code>@home</code> para <code>/mnt/home</code> e <code>@snapshots</code> para <code>/mnt/.snapshots</code>.
</p>
<h4><span class="mw-headline" id="Crie_os_subvolumes_aninhados">Crie os subvolumes aninhados</span></h4>
<p>Crie quaisquer subvolumes que você <i>não</i> deseja ter snapshots quando tirar uma snapshot do <code>/</code>. Por exemplo, você provavelmente não quer tirar snapshots do <code>/var/cache/pacman/pkg</code>. estes subvolumes serão aninhados dentro do subvolume <code>@</code>, mas facilmente você conseguiria criar no mesmo nível do <code>@</code> se for de acordo com sua preferência.
</p>
<p>Desde que o subvolume <code>@</code> está montado em <code>/mnt</code> será necessário <a href="../en/Btrfs.html#Creating_a_subvolume" class="mw-redirect" title="Create a subvolume">criar um subvolume</a> em <code>/mnt/var/cache/pacman/pkg</code> para este exemplo. você pode ser necessário criar diretórios anteriores ao <i>pkg</i>.
</p>
<p>Outros diretórios que você pode desejar fazer isso são <code>/var/abs</code>, <code>/var/tmp</code>, e <code>/srv</code>.
</p>
<h4><span class="mw-headline" id="Monte_a_ESP">Monte a ESP</span></h4>
<p>Se preparou uma partição de sistema EFI anteriormente, crie seu ponto de montagem e monte-a.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> As snapshots do btrfs não irão incluir o <code>/efi</code>, desde que este não faz parte de um sistema de arquivos btrfs.</div>
<p>No passo do guia de instalação onde tem o <a href="../pt/Installation_guide.html#Instalar_os_pacotes_essenciais" class="mw-redirect" title="Guia de instalação">pacstrap</a>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> deve ser instalado em adição com o <a href="../pt/Meta_package_and_package_group.html#Diferen%C3%A7a_entre_um_metapacote_e_um_grupo_de_pacotes" class="mw-redirect" title="Metapacote">metapacote</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span>.
</p>
<h3><span class="mw-headline" id="Configurando_o_mkinitcpio_5">Configurando o mkinitcpio</span></h3>
<h4><span class="mw-headline" id="Crie_a_keyfile">Crie a keyfile</span></h4>
<p>Para o GRUB abrir a partição LUKS sem que o usuário digite a senha duas vezes, coloque uma keyfile no initramfs. Siga <a href="../pt/32a9ef2a5038cdf95d792b1a87067cba.html#Com_uma_keyfile_no_initramfs" class="mw-redirect" title="Dm-crypt/Encriptação de dispositivo">dm-crypt/Encriptação de dispositivo#Com uma keyfile no initramfs</a>, tenha certeza de adicionar a chave para <code>/dev/sda2</code> do passo <i>luksAddKey</i>.
</p>
<h4><span class="mw-headline" id="Edite_o_mkinitcpio.conf">Edite o mkinitcpio.conf</span></h4>
<p>Depois de criar, adicionar e colocar a chave como descrito acima, adicione o hook <code>encrypt</code> no <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a> e também outros hooks que precise. Veja <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#mkinitcpio" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#mkinitcpio</a> para informações detalhadas.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Você pode querer adicionar <code>BINARIES=(/usr/bin/btrfs)</code> para sua <code>mkinitcpio.conf</code>. Veja o artigo <a href="../en/Btrfs.html#Corruption_recovery" title="Btrfs">Btrfs#Corruption recovery</a>.</div>
<h3><span class="mw-headline" id="Configurando_o_gerenciador_de_boot_5">Configurando o gerenciador de boot</span></h3>
<p>Instale o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> em <code>/dev/sda</code>. Então, edite <code>/etc/default/grub</code> como sugerido em <a href="../pt/GRUB.html#Argumentos_adicionais" title="GRUB (Português)">GRUB#Argumentos adicionais</a>, <a href="../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB#/boot criptografado</a> e <a href="../pt/5e279fa7d75b32c0232ab38e4294ae71.html#Usando_o_hook_encrypt" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Usando o hook encrypt</a>, siga ambas as instruções para o sistema criptografado e a partição de boot. Depois, gere o arquivo de configuração do GRUB.
</p>
<h3><span class="mw-headline" id="Configurando_a_swap">Configurando a swap</span></h3>
<p>Se você criou uma partição para ser usada como swap criptografada, siga as instruções em <a href="../pt/e48c704551cc17f65bac6e6f991e0c3f.html" class="mw-redirect" title="Dm-crypt/Swap criptografada">dm-crypt/Swap criptografada</a> para configurá-la.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../pt/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Português)">Data-at-rest encryption (Português)</a></li>
<li><a href="../pt/Category:Installation_process.html" title="Category:Installation process (Português)">Installation process (Português)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Portugu%C3%AAs)/Encrypting_an_entire_system_(Portugu%C3%AAs)&amp;oldid=652603">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Português)/Encrypting_an_entire_system_(Português)&amp;oldid=652603</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 17 February 2021, at 00:36.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
