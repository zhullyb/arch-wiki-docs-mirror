<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Ext4 (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Ext4_Português rootpage-Ext4_Português skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Ext4 (Português)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Ext4.html" title="Ext4">Ext4</a>. Data da última tradução: 2020-03-26. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Ext4&amp;diff=0&amp;oldid=602673">alterações</a> na versão em inglês.</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Artigos relacionados</p>
<ul>
<li><a href="../pt/File_systems.html" class="mw-redirect" title="Sistemas de arquivos">Sistemas de arquivos</a></li>
<li><a href="../en/Ext3.html" title="Ext3">Ext3</a></li>
</ul>
</div>
<p>De <a rel="nofollow" class="external text" href="https://kernelnewbies.org/Ext4">Ext4 - Linux Kernel Newbies</a> (traduzido):
</p>
<dl><dd>Ext4 é a evolução do sistema de arquivos mais usado no Linux, o Ext3. De diversas formas, o Ext4 é uma melhoria mais profunda sobre Ext3 do que o Ext3 foi sobre Ext2. O Ext3 foi principalmente sobre adicionar <i>journaling</i> ao Ext2, mas o Ext4 modifica estruturas de dados importantes do sistema de arquivos como aqueles projetados para armazenar os dados de arquivos. O resultado é um sistema de arquivos com um desenho melhorado, melhor desempenho, confiabilidade e recursos.</dd></dl>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Criando_um_novo_sistema_de_arquivos_ext4"><span class="tocnumber">1</span> <span class="toctext">Criando um novo sistema de arquivos ext4</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Propor%C3%A7%C3%A3o_de_bytes_por_n%C3%B3-i"><span class="tocnumber">1.1</span> <span class="toctext">Proporção de bytes por nó-i</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Blocos_reservados"><span class="tocnumber">1.2</span> <span class="toctext">Blocos reservados</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Migrando_de_ext2/ext3_para_ext4"><span class="tocnumber">2</span> <span class="toctext">Migrando de ext2/ext3 para ext4</span></a>
<ul>
<li class="toclevel-2 tocsection-5">
<a href="#Montando_parti%C3%A7%C3%B5es_ext2/ext3_como_ext4_sem_convers%C3%A3o"><span class="tocnumber">2.1</span> <span class="toctext">Montando partições ext2/ext3 como ext4 sem conversão</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Motivo"><span class="tocnumber">2.1.1</span> <span class="toctext">Motivo</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Procedimento"><span class="tocnumber">2.1.2</span> <span class="toctext">Procedimento</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8">
<a href="#Convertendo_parti%C3%A7%C3%B5es_ext2/ext3_para_ext4"><span class="tocnumber">2.2</span> <span class="toctext">Convertendo partições ext2/ext3 para ext4</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Motivo_2"><span class="tocnumber">2.2.1</span> <span class="toctext">Motivo</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Procedimento_2"><span class="tocnumber">2.2.2</span> <span class="toctext">Procedimento</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Melhorando_o_desempenho"><span class="tocnumber">3</span> <span class="toctext">Melhorando o desempenho</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#E4rat"><span class="tocnumber">3.1</span> <span class="toctext">E4rat</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Desabilitando_atualiza%C3%A7%C3%A3o_de_tempo_de_acesso"><span class="tocnumber">3.2</span> <span class="toctext">Desabilitando atualização de tempo de acesso</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Aumentando_o_intervalo_de_commit"><span class="tocnumber">3.3</span> <span class="toctext">Aumentando o intervalo de commit</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Desligando_barreiras"><span class="tocnumber">3.4</span> <span class="toctext">Desligando barreiras</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Desabilitando_journaling"><span class="tocnumber">3.5</span> <span class="toctext">Desabilitando journaling</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Use_journal_externo_para_otimizar_o_desempenho"><span class="tocnumber">3.6</span> <span class="toctext">Use journal externo para otimizar o desempenho</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18">
<a href="#Dicas_e_truques"><span class="tocnumber">4</span> <span class="toctext">Dicas e truques</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#Usando_criptografia_baseada_em_arquivos"><span class="tocnumber">4.1</span> <span class="toctext">Usando criptografia baseada em arquivos</span></a></li>
<li class="toclevel-2 tocsection-20">
<a href="#Habilitando_somas_de_verifica%C3%A7%C3%A3o_de_metadados"><span class="tocnumber">4.2</span> <span class="toctext">Habilitando somas de verificação de metadados</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#Novo_sistema_de_arquivos"><span class="tocnumber">4.2.1</span> <span class="toctext">Novo sistema de arquivos</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#Converter_arquivo_de_sistema_existente"><span class="tocnumber">4.2.2</span> <span class="toctext">Converter arquivo de sistema existente</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#Veja_tamb%C3%A9m"><span class="tocnumber">5</span> <span class="toctext">Veja também</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Criando_um_novo_sistema_de_arquivos_ext4">Criando um novo sistema de arquivos ext4</span></h2>
<p>Para formatar uma partição, faça:
</p>
<pre># mkfs.ext4 /dev/<i>partição</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> 
<ul>
<li>Veja <span class="plainlinks archwiki-template-man" title="$ man 8 mke2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mke2fs.8">mke2fs(8)</a></span> para mais opções; edite <code>/etc/mke2fs.conf</code> para ver/configurar as opções padrões.</li>
<li>Se houver suporte, você pode querer habilitar suporte a 64-bits e <a href="#Habilitando_somas_de_verifica%C3%A7%C3%A3o_de_metadados">metadados de somas de verificação</a> (também conhecidos como <i>checksums</i>).</li>
</ul>
</div>
<h3>
<span id="Propor.C3.A7.C3.A3o_de_bytes_por_n.C3.B3-i"></span><span class="mw-headline" id="Proporção_de_bytes_por_nó-i">Proporção de bytes por nó-i</span>
</h3>
<p>Traduzido de <span class="plainlinks archwiki-template-man" title="$ man 8 mke2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mke2fs.8">mke2fs(8)</a></span>:
</p>
<dl><dd>
<i><b>mke2fs</b> cria um nó-i para todos os </i>bytes por nó-i<i> de espaço no disco. Quanto maior proporção de </i>bytes por nó-i<i>, menos nós-i serão criados.</i>
</dd></dl>
<p>A criação de um novo arquivo, diretório, link simbólico etc. exige pelo menos um <a href="https://en.wikipedia.org/wiki/pt:N%C3%B3-i" class="extiw" title="wikipedia:pt:Nó-i">nó-i</a> livre. Se a contagem de nós-i for pequena demais, nenhum arquivo pode ser criado no sistema de arquivos mesmo se ainda houver espaço restante nele. 
</p>
<p>Porque não é possível alterar a proporção de bytes por nó-i ou a contagem de nós-i após o sistema de arquivos ser criado, o <code>mkfs.ext4</code> usa, por padrão, uma proporção relativamente baixa de um nó-i a cada 16384 bytes (16 KB) para evitar essa situação.
</p>
<p>Porém, para partições com tamanho em centenas ou milhares de  GB e tamanho de arquivo médio na faixa de megabytes, isso geralmente resulta em um número muito grande de nós-i porque o número de arquivos criados nunca alcança o número de nós-i.
</p>
<p>Isso resulta em um desperdício de espaço em disco, porque todos arquivos nós-i não usados ocupam até 256 bytes no sistema de arquivos (isso também é definido em <code>/etc/mke2fs.conf</code>, mas não deve ser alterado). 256 * vários milhões = alguns poucos gigabytes desperdiçados em nós-i não usados.
</p>
<p>Essa situação pode ser avaliada comparando as figuras <code>{I}Uso%</code> fornecidas pelo <code>df</code> e <code>df -i</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ df -h /home</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Sist. Arq.              Tam.   Usado   Dispo.  <b>Uso%</b>  Montado em
/dev/mapper/lvm-home    115G    56G    59G     <b>49%</b>   /home
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ df -hi /home</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Sist. Arq.              Inodes IUsado ILivre <b>IUso%</b>   Montado em
/dev/mapper/lvm-home    1.8M    1.1K   1.8M   <b>1%</b>     /home
</pre>
<p>Para especificar uma proporção de bytes por nó-i diferente, você pode usar a opção <code>-T <i>tipo-de-uso</i></code> que sugere o uso esperado do sistema de arquivos usando tipos definidos em <code>/etc/mke2fs.conf</code>. Além daqueles tipos estão os <code>largefile</code> e <code>largefile4</code> maiores, que oferecem proporções mais relevantes de um nó-i a cada  1 MB e 4 MB, respectivamente. Pode-se usar da seguinte forma:
</p>
<pre># mkfs.ext4 -T largefile /dev/<i>dispositivo</i>
</pre>
<p>A proporção de bytes por nó-i também pode ser definida diretamente via a opção <code>-i</code>: <i>p.ex.:</i> use <code>-i 2097152</code> para uma proporção 2 MB e  <code>-i 6291456</code> para uma proporção 6 MB.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Por outro lado, se você está configurando uma partição dedicada a hospedar milhões de arquivos pequenos, como e-mails e itens de newsgroups, você pode usar valores menores de <i>tipo-de-uso</i> como <code>news</code> (um nó-i para cada 4096 bytes) ou <code>small</code> (idem, somado a tamanhos de bloco e nó-i menores).</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Se você faz uso intenso de links simbólicos, certifique-se de manter a contagem de nós-i alta o suficiente com uma proporção baixa de bytes por nó-i, porque, apesar de não usar muito espaço, todo novo link simbólico consume um novo nó-i e, portanto, o sistema de arquivos pode esgotá-los rapidamente.</div>
<h3><span class="mw-headline" id="Blocos_reservados">Blocos reservados</span></h3>
<p>Por padrão, 5% dos blocos de sistema de arquivos serão reservados para o superusuário, para evitar fragmentação e "<i>permitir daemons do root continuarem a funcionar corretamente após processos sem privilégios serem impedidos de escrever no sistema de arquivos</i>" (traduzido de <span class="plainlinks archwiki-template-man" title="$ man 8 mke2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mke2fs.8">mke2fs(8)</a></span>).
</p>
<p>Para discos modernos de alta capacidade, isso é mais alto do que necessário se a partição for usada como um arquivo de longo prazo ou não crucial para operações do sistema (como <code>/home</code>). Veja <a rel="nofollow" class="external text" href="https://www.redhat.com/archives/ext3-users/2009-January/msg00026.html">esse e-mail</a> para a opinião do desenvolvedor do ext4 Ted Ts'o sobre blocos reservados.
</p>
<p>Geralmente é seguro reduzir a percentagem de blocos reservados para liberar espaço de disco quando a partição é:
</p>
<ul>
<li>Grande demais (por exemplo &gt; 50G); ou</li>
<li>Usado como arquivo de longo prazo, isto é, onde arquivos não serão excluídos e criados com muita frequência</li>
</ul>
<p>A opção <code>-m</code> de utilitários relacionados ao ext4 permitem especificar a percentagem de blocos reservados.
</p>
<p>Para impedir totalmente de reservar blocos na criação do sistema de arquivos, use:
</p>
<pre># mkfs.ext4 -m 0 /dev/<i>dispositivo</i>
</pre>
<p>Para alterá-lo para 1% posteriormente, use:
</p>
<pre># tune2fs -m 1 /dev/<i>dispositivo</i>
</pre>
<p>Você pode usar <span class="plainlinks archwiki-template-man" title="$ man 8 findmnt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/findmnt.8">findmnt(8)</a></span> para localizar o nome do dispositivo:
</p>
<pre>$ findmnt <i>/o/ponto/de/montagem</i>
</pre>
<h2>
<span id="Migrando_de_ext2.2Fext3_para_ext4"></span><span class="mw-headline" id="Migrando_de_ext2/ext3_para_ext4">Migrando de ext2/ext3 para ext4</span>
</h2>
<h3>
<span id="Montando_parti.C3.A7.C3.B5es_ext2.2Fext3_como_ext4_sem_convers.C3.A3o"></span><span class="mw-headline" id="Montando_partições_ext2/ext3_como_ext4_sem_conversão">Montando partições ext2/ext3 como ext4 sem conversão</span>
</h3>
<h4><span class="mw-headline" id="Motivo">Motivo</span></h4>
<p>Um compromisso entre a conversão total para ext4 e simplesmente permanecer com ext2/ext3 é montar as partições como ext4.
</p>
<p><b>Vantagens:</b>
</p>
<ul>
<li>Compatibilidade (o sistema de arquivos pode continuar sendo montado como ext3) – Isso permite que os usuários ainda leiam o sistema de arquivos de outros sistemas operacionais sem suporte a ext4 (por exemplo, o Windows com drivers ext2/ext3)</li>
<li>Melhor desempenho (embora não tanto como uma partição ext4 totalmente convertida).<a rel="nofollow" class="external autonumber" href="https://kernelnewbies.org/Ext4">[1]</a> <a rel="nofollow" class="external autonumber" href="https://events.static.linuxfound.org/slides/2010/linuxcon_japan/linuxcon_jp2010_fujita.pdf">[2]</a>
</li>
</ul>
<p><b>Desvantagens:</b>
</p>
<ul><li>Menos recursos do ext4 são usados (apenas aqueles que não alteram o formato do disco, como a alocação de múltiplos blocos e a alocação atrasada)</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Exceto pela novidade relativa do ext4 (que pode ser visto como um risco), <b>não há nenhuma desvantagem importante para esta técnica</b>.</div>
<h4><span class="mw-headline" id="Procedimento">Procedimento</span></h4>
<ol>
<li>Edite <code>/etc/fstab</code> e altere o 'type' de ext2/ext3 para ext4 para quaisquer partições você gostaria de montar como ext4.</li>
<li>Monte novamente as partições afetadas.</li>
</ol>
<h3>
<span id="Convertendo_parti.C3.A7.C3.B5es_ext2.2Fext3_para_ext4"></span><span class="mw-headline" id="Convertendo_partições_ext2/ext3_para_ext4">Convertendo partições ext2/ext3 para ext4</span>
</h3>
<h4><span class="mw-headline" id="Motivo_2">Motivo</span></h4>
<p>Para experimentar os benefícios do ext4, um processo de conversão irreversível deve ser concluído.
</p>
<p><b>Vantagens:</b>
</p>
<ul><li>Desempenho melhorado e novos recursos.<a rel="nofollow" class="external autonumber" href="https://kernelnewbies.org/Ext4">[3]</a> <a rel="nofollow" class="external autonumber" href="https://events.static.linuxfound.org/slides/2010/linuxcon_japan/linuxcon_jp2010_fujita.pdf">[4]</a>
</li></ul>
<p><b>Desvantagens:</b>
</p>
<ul>
<li>As partições que contêm principalmente arquivos estáticos, como uma partição <code>/boot</code>, podem não se beneficiar dos novos recursos. Além disso, adicionar um journal (que está implícito ao mover uma partição ext2 para ext3/4) sempre incorre em despesas extras ao custo de desempenho.</li>
<li>Irreversível (as partições ext4 não podem ser "rebaixadas" para ext2/ext3. No entanto, é compatível com versões anteriores até que a extensão e outras opções exclusivas estejam habilitadas)</li>
</ul>
<h4><span class="mw-headline" id="Procedimento_2">Procedimento</span></h4>
<p>Essas instruções foram adaptadas da <a rel="nofollow" class="external text" href="https://ext4.wiki.kernel.org/index.php/Ext4_Howto">documentação do Kernel</a> e um <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=61602">tópico do BBS</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> 
<ul>
<li>Se você converter o sistema de arquivos raiz do sistema, certifique-se de que o initramfs reserva ('fallback') está disponível na reinicialização. Alternativamente, adicione <code>ext4</code> de acordo com <a href="../pt/Mkinitcpio.html#MODULES" title="Mkinitcpio (Português)">Mkinitcpio#MODULES</a> e <a href="../pt/Mkinitcpio.html#Cria%C3%A7%C3%A3o_e_ativa%C3%A7%C3%A3o_de_imagem" class="mw-redirect" title="Gere novamente o initramfs">gere novamente o initramfs</a> antes de iniciar.</li>
<li>Se você decidir converter uma partição <code>/boot</code> separada, certifique-se que o <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">gerenciador de boot</a> oferece inicialização do ext4.</li>
</ul>
</div>
<p>Nas etapas a seguir, <code>/dev/sdxX</code> denota o caminho para a partição a ser convertida, tal como <code>/dev/sda1</code>. 
</p>
<ol>
<li>
<b><a href="../en/Synchronization_and_backup_programs.html" class="mw-redirect" title="Backup programs">Faça backup</a></b> de todos os dados em quaisquer partições ext3 que serão convertidas para ext4. Um pacote útil, especialmente para partições raiz, é o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clonezilla">clonezilla</a></span>.</li>
<li>Edite <code>/etc/fstab</code> e altere o 'type' de ext3 para ext4 para quaisquer partições que serão convertidos para ext4.</li>
<li>Inicialize uma mídia <i>Live</i> (se necessário). O processo de conversão com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=e2fsprogs">e2fsprogs</a></span> deve ser feito quando a unidade não está montada. Se estiver convertendo uma partição raiz, a forma mais simples de alcançar isso é inicializar de alguma outra mídia <i>Live</i>.</li>
<li>Certifique-se que a partição <i>não</i> está montada.</li>
<li>Se você quiser converter uma partição ext2, a primeira etapa de conversão é adicionar um <a href="../pt/File_systems.html#Journaling" class="mw-redirect" title="Sistemas de arquivos">journal</a> executando <code>tune2fs -j /dev/sdxX</code> como root; fazendo dela uma partição ext3.</li>
<li>Execute <code>tune2fs -O extent,uninit_bg,dir_index /dev/sdxX</code> como root. Esse comando converte o sistema de arquivos ext3 para ext4 (irreversivelmente).</li>
<li>Execute <code>fsck -f /dev/sdxX</code> como root.
<ul><li>Esta etapa é necessária, do contrário o sistema de arquivos <b>ficará ilegível</b>. A execução de <i>fsck</i> é necessária para retornar o sistema de arquivos para um estado consistente. Ele vai encontrar erros de soma de verificação nos descritores de grupo - isso é esperado. A opção <code>-f</code> pede que o <i>fsck</i> verifique mesmo se o sistema de arquivos parecer limpo. A opção <code>-p</code> pode ser usada sobre a "reparação automática" (do contrário, o usuário será solicitado a intervir em cada erro).</li></ul>
</li>
<li>Recomendado: monte a partição e execute <code>e4defrag -c -v /dev/sdxX</code> como root.
<ul><li>Mesmo que o sistema de arquivos agora esteja convertido em ext4, todos os arquivos que foram escritos antes da conversão ainda não aproveitam a opção de extensão do ext4, que melhorará o desempenho de arquivos grandes e reduzirá a fragmentação e o tempo de verificação do sistema de arquivos. Para aproveitar plenamente o ext4, todos os arquivos teriam que ser reescritos no disco. Use <i>e4defrag</i> para cuidar desse problema.</li></ul>
</li>
<li>Reinicie.</li>
</ol>
<h2><span class="mw-headline" id="Melhorando_o_desempenho">Melhorando o desempenho</span></h2>
<h3><span class="mw-headline" id="E4rat">E4rat</span></h3>
<p><a href="../en/E4rat.html" title="E4rat">E4rat</a> é um aplicativo de pré-carregamento projetado para o sistema de arquivos ext4. Ele monitora os arquivos abertos durante a inicialização, otimiza seu posicionamento na partição para melhorar o tempo de acesso e os pré-carrega no começo do processo de inicialização. <i>E4rat</i> não oferece melhorias com <a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSDs</a>, cujo tempo de acesso é insignificante em comparação com discos rígidos.
</p>
<h3>
<span id="Desabilitando_atualiza.C3.A7.C3.A3o_de_tempo_de_acesso"></span><span class="mw-headline" id="Desabilitando_atualização_de_tempo_de_acesso">Desabilitando atualização de tempo de acesso</span>
</h3>
<p>O sistema de arquivos <i>ext4</i> registra informações sobre quando um arquivo foi acessado pela última vez e há um custo associado ao registro dele. Com a opção <code>noatime</code>, os timestamps de acesso no sistema de arquivos não são atualizados.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/sda5    /    ext4    defaults,<b>noatime</b>    0    1
</pre>
<p>Fazer isso quebra aplicativos que dependem do tempo de acesso, veja <a href="../pt/Fstab.html#Op%C3%A7%C3%B5es_atime" title="Fstab (Português)">fstab#Opções atime</a> para soluções possíveis.
</p>
<h3><span class="mw-headline" id="Aumentando_o_intervalo_de_commit">Aumentando o intervalo de commit</span></h3>
<p>O intervalo de sincronização para dados e metadados pode ser aumentado, proporcionando um maior atraso de tempo para a opção <code>commit</code>.
</p>
<p>O 5 segundos padrão significa que, se a energia for perdida, será perdido tanto quanto os últimos 5 segundos de trabalho.
Isso força uma sincronia completa de todos os dados/journals para mídia física a cada 5 segundos. O sistema de arquivos não será danificado, graças ao registro no journaling.
O seguinte <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a> ilustra o uso de <code>commit</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/sda5    /    ext4   defaults,noatime,<b>commit=60</b>    0    1</pre>
<h3><span class="mw-headline" id="Desligando_barreiras">Desligando barreiras</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Desabilitar as barreiras para discos sem cache com respaldo de bateria não é recomendado e pode levar à corrupção severa do sistema de arquivos e perda de dados.</div>
<p><i>Ext4</i> permite barreiras de gravação por padrão. Isso garante que os metadados do sistema de arquivos sejam corretamente escritos e ordenados no disco, mesmo quando os caches de gravação perdem energia. Isso ocorre com um custo de desempenho especialmente para aplicativos que usam <i>fsync</i> intensamente ou criam e excluem muitos pequenos arquivos. Para discos que tenham um cache de gravação com respaldo de bateria de uma forma ou de outra, desabilitar as barreiras pode melhorar o desempenho com segurança.
</p>
<p>Para desligar as barreiras, adicione a opção <code>barrier=0</code> ao sistema de arquivos desejado. Por exemplo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/sda5    /    ext4    noatime,<b>barrier=0</b>   0    1</pre>
<h3><span class="mw-headline" id="Desabilitando_journaling">Desabilitando journaling</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Usar um sistema de arquivos sem o journal pode resultar em perda de dados em caso de desmontagem repentina, como falha de energia ou bloqueio do kernel.</div>
<p>Desabilitar o journal do <i>ext4</i> pode ser feito com o seguinte comando em um disco desmontado:
</p>
<pre># tune2fs -O "^has_journal" /dev/sdXN
</pre>
<h3><span class="mw-headline" id="Use_journal_externo_para_otimizar_o_desempenho">Use journal externo para otimizar o desempenho</span></h3>
<p>Para aqueles com preocupações sobre integridade e desempenho de dados, o registro no jornal pode ser significativamente acelerado com a opção de montagem <code>journal_async_commit</code>. Note que <a rel="nofollow" class="external text" href="https://patchwork.ozlabs.org/patch/414750/">não funciona</a> com o padrão balanceado de <code>data=ordered</code>, então isso é recomendado apenas quando o sistema de arquivos já estiver usando <code>data=journal</code> cautelosamente.
</p>
<p>Você pode formatar um dispositivo dedicado para o journal com <code>mke2fs -O journal_dev /dev/journal_device</code>. Use <code>tune2fs -J device=/dev/journal_device /dev/ext4_fs</code> para atribuir o journal a um dispositivo existente ou substitua <code>tune2fs</code> por <code>mkfs.ext4</code> se você estiver criando um novo sistema de arquivos.
</p>
<h2><span class="mw-headline" id="Dicas_e_truques">Dicas e truques</span></h2>
<h3><span class="mw-headline" id="Usando_criptografia_baseada_em_arquivos">Usando criptografia baseada em arquivos</span></h3>
<p>Desde o Linux 4.1, o ext4 possui suporte nativo a criptografia de arquivos — consulte o artigo <a href="../en/Fscrypt.html" title="Fscrypt">fscrypt</a>. A criptografia é aplicada no nível do diretório, e diretórios diferentes podem usar chaves de criptografia diferentes. Isso é diferente de <a href="../pt/Dm-crypt.html" title="Dm-crypt (Português)">dm-crypt</a>, que é a criptografia em nível de dispositivo de bloco, e de <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a>, que é um sistema de arquivos criptográficos empilhados.
</p>
<h3>
<span id="Habilitando_somas_de_verifica.C3.A7.C3.A3o_de_metadados"></span><span class="mw-headline" id="Habilitando_somas_de_verificação_de_metadados">Habilitando somas de verificação de metadados</span>
</h3>
<p>Quando um sistema de arquivos foi criado com o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=e2fsprogs">e2fsprogs</a></span> 1.44 ou posterior, as somas de verificação de metadados já devem estar ativadas por padrão. Os sistemas de arquivos existentes podem ser convertidos para permitir o suporte à soma de verificação de metadados.
</p>
<p>Se o seu CPU tem suporte a SSE 4.2, certifique-se que o <a href="../pt/Kernel_module.html" class="mw-redirect" title="Módulo de kernel">módulo de kernel</a> <code>crc32c_intel</code> esteja carregado para habilitar o algoritmo CRC32C acelerado por hardware <a rel="nofollow" class="external autonumber" href="https://ext4.wiki.kernel.org/index.php/Ext4_Metadata_Checksums#Benchmarking">[5]</a>. Caso contrário, você precisará carregar o módulo <code>crc32c_generic</code>.
</p>
<p>Para ler mais sobre metadados de somas de verificação, veja o <a rel="nofollow" class="external text" href="https://ext4.wiki.kernel.org/index.php/Ext4_Metadata_Checksums">wiki do ext4</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Use <code>dumpe2fs</code> para verificar os recursos que estão habilitados no sistema de arquivos:
<pre># dumpe2fs <i>/dev/caminho/para/disco</i>
</pre>
</div>
<h4><span class="mw-headline" id="Novo_sistema_de_arquivos">Novo sistema de arquivos</span></h4>
<p>Para habilitar o suporte a somas de verificação de metadados ext4 ao criar um novo sistema de arquivos.
</p>
<pre># mkfs.ext4 -O metadata_csum <i>/dev/caminho/para/disco</i>
</pre>
<h4><span class="mw-headline" id="Converter_arquivo_de_sistema_existente">Converter arquivo de sistema existente</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> O sistema de arquivos não deve estar montado.</div>
<p>Primeiro, a partição precisa ser verificada e otimizada usando <code>e2fsck</code>:
</p>
<pre># e2fsck -Df <i>/dev/caminho/para/disco</i>
</pre>
<p>Converta o sistema de arquivos para 64 bits:
</p>
<pre># resize2fs -b <i>/dev/caminho/para/disco</i>
</pre>
<p>Finalmente, habilite suporte a somas de verificação:
</p>
<pre># tune2fs -O metadata_csum <i>/dev/caminho/para/disco</i>
</pre>
<h2>
<span id="Veja_tamb.C3.A9m"></span><span class="mw-headline" id="Veja_também">Veja também</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://ext4.wiki.kernel.org/">Wiki oficial do Ext4</a></li>
<li>
<a rel="nofollow" class="external text" href="https://ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout">Layout de disco com Ext4</a> descrito no seu wiki</li>
<li>
<a rel="nofollow" class="external text" href="https://lwn.net/Articles/639427/">Criptografia no Ext4</a> - artigo do LWN</li>
<li>Commits do kernel para criptografia no ext4 <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=6162e4b0bedeb3dac2ba0a5e1b1f56db107d97ec">[6]</a> <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8663da2c0919896788321cd8a0016af08588c656">[7]</a>
</li>
<li><a rel="nofollow" class="external text" href="http://e2fsprogs.sourceforge.net/e2fsprogs-release.html">Changelog do e2fsprogs</a></li>
<li><a rel="nofollow" class="external text" href="https://ext4.wiki.kernel.org/index.php/Ext4_Metadata_Checksums">Somas de verificação de metadados do Ext4</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../pt/Category:File_systems.html" title="Category:File systems (Português)">File systems (Português)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Ext4_(Portugu%C3%AAs)&amp;oldid=661035">https://wiki.archlinux.org/index.php?title=Ext4_(Português)&amp;oldid=661035</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 17 April 2021, at 06:51.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
