<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>USB 3G Modem - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-USB_3G_Modem rootpage-USB_3G_Modem skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">USB 3G Modem</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a><b>This article or section is a candidate for moving to <a href="/index.php?title=Mobile_broadband_modem&amp;action=edit&amp;redlink=1" class="new" title="Mobile broadband modem (page does not exist)">Mobile broadband modem</a>.</b><a href="../File:Tango-go-next.png" class="image"><img alt="Tango-go-next.png" src="../File:Tango-go-next.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> The modem does not need to be USB nor 3G. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:USB_3G_Modem">Talk:USB 3G Modem#</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> does not conform to <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:USB_3G_Modem">Talk:USB 3G Modem#</a>)</div>
</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Wvdial.html" title="Wvdial">wvdial</a></li>
<li><a href="../en/Direct_modem_connection.html" class="mw-redirect" title="Direct Modem Connection">Direct Modem Connection</a></li>
<li><a href="../en/3G_and_GPRS_modems_with_pppd.html" title="3G and GPRS modems with pppd">3G and GPRS modems with pppd</a></li>
<li><a href="../en/Category:Modems.html" title="Category:Modems">Category:Modems</a></li>
</ul>
</div>
<p>A number of mobile telephone networks around the world offer mobile internet connections over UMTS (or EDGE or GSM) using a portable USB modem device.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Remove_the_PIN"><span class="tocnumber">1</span> <span class="toctext">Remove the PIN</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Device_identification"><span class="tocnumber">2</span> <span class="toctext">Device identification</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Mode_switching"><span class="tocnumber">3</span> <span class="toctext">Mode switching</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#Connection"><span class="tocnumber">4</span> <span class="toctext">Connection</span></a>
<ul>
<li class="toclevel-2 tocsection-5">
<a href="#Serial_like_interface"><span class="tocnumber">4.1</span> <span class="toctext">Serial like interface</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#ModemManager"><span class="tocnumber">4.1.1</span> <span class="toctext">ModemManager</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#NetworkManager"><span class="tocnumber">4.1.2</span> <span class="toctext">NetworkManager</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#pppd"><span class="tocnumber">4.1.3</span> <span class="toctext">pppd</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#wvdial"><span class="tocnumber">4.1.4</span> <span class="toctext">wvdial</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#netctl"><span class="tocnumber">4.1.5</span> <span class="toctext">netctl</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#libmbim"><span class="tocnumber">4.1.6</span> <span class="toctext">libmbim</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#sakis3g"><span class="tocnumber">4.1.7</span> <span class="toctext">sakis3g</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#Ethernet_like_interface"><span class="tocnumber">4.2</span> <span class="toctext">Ethernet like interface</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Connection_halts_after_few_minutes_running"><span class="tocnumber">4.3</span> <span class="toctext">Connection halts after few minutes running</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#Tips_and_tricks"><span class="tocnumber">5</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-16">
<a href="#Disable_mode_switching"><span class="tocnumber">5.1</span> <span class="toctext">Disable mode switching</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#By_the_configuration_file"><span class="tocnumber">5.1.1</span> <span class="toctext">By the configuration file</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#With_a_udev_rule"><span class="tocnumber">5.1.2</span> <span class="toctext">With a udev rule</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#AT_commands"><span class="tocnumber">5.2</span> <span class="toctext">AT commands</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Low_connection_speed"><span class="tocnumber">5.3</span> <span class="toctext">Low connection speed</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Monitor_used_bandwidth"><span class="tocnumber">5.4</span> <span class="toctext">Monitor used bandwidth</span></a></li>
<li class="toclevel-2 tocsection-22">
<a href="#Reading_SMS"><span class="tocnumber">5.5</span> <span class="toctext">Reading SMS</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#With_dedicated_software"><span class="tocnumber">5.5.1</span> <span class="toctext">With dedicated software</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#With_email_like_web_interface"><span class="tocnumber">5.5.2</span> <span class="toctext">With email like web interface</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Writing_SMS"><span class="tocnumber">5.6</span> <span class="toctext">Writing SMS</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Fix_image_quality"><span class="tocnumber">5.7</span> <span class="toctext">Fix image quality</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Remove_the_PIN">Remove the PIN</span></h2>
<p>First of all use your SIM card in a normal phone and disable the PIN request if present. If the SIM card asks the PIN wvdial will not work.
</p>
<p>Failing that, you can also use <i>mmcli</i>, which is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span>, to unlock the SIM card:
</p>
<p>First, list the modems and find the modem's index:
</p>
<pre>$ mmcli -L
</pre>
<p>Look for <code>/org/freedesktop/ModemManager1/Modem/<i><b>MODEM_INDEX</b></i></code>.
</p>
<p>Find the SIM card index:
</p>
<pre>$ mmcli -m <i>MODEM_INDEX</i>
</pre>
<p>Just as with the modem index, look for <code>primary sim path: /org/freedesktop/ModemManager1/SIM/<i><b>SIM_INDEX</b></i></code>.
</p>
<p>Unlock the SIM card:
</p>
<pre>$ mmcli --sim=<i>SIM_INDEX</i> --pin=<i>PIN</i>
</pre>
<p>Remove the requirement for PIN:
</p>
<pre>$ mmcli --sim=<i>SIM_INDEX</i> --pin=<i>PIN</i> --disable-pin
</pre>
<h2><span class="mw-headline" id="Device_identification">Device identification</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usbutils">usbutils</a></span>.
</p>
<p>Examine the output of:
</p>
<pre>$ lsusb
</pre>
<p>which will show the vendor and product IDs of the device. Note that some devices will show <i>two</i> different product IDs at different times as explained below.
</p>
<h2><span class="mw-headline" id="Mode_switching">Mode switching</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Some USB modems have router functionality, i.e. they are configured from a web interface and provide a Wi-Fi connection. Mention these devices and add instructions for switching them to "modem mode" (serial interface). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:USB_3G_Modem">Talk:USB 3G Modem#</a>)</div>
</div>
<p>Often these devices will have two modes (1) USB flash memory storage (2) USB Modem. The first mode, sometimes known as ZeroCD, is often used to deliver an internet communications program for another operating system and is generally of no interest to Linux users. Additionally some have a slot into which the user can insert an additional flash memory card.
</p>
<p>A useful utility for switching these devices into modem mode is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span>, available in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>. Udev rules are supplied with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span> in <code>/lib/udev/rules.d/40-usb_modeswitch.rules</code>. It contains entries for many devices, which it will switch to modem mode upon insertion.
</p>
<p>When a device is switched, its product ID may change to a different value. The vendor ID will remain unchanged. This can be seen in the output of <code>lsusb</code>.
</p>
<p>Some devices are supported in the USB serial kernel module called "option" (after the Option devices, but not limited to just those) and may be used without usb_modeswitch.
</p>
<p>Udev itself included a utility called <code>/lib/udev/modem-modeswitch</code>. In udev 157 this was renamed to <code>/lib/udev/mobile-action-modeswitch</code> and morphed into a tool that only switches Mobile Action cables. For other devices use <code>usb_modeswitch</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can find an alternative way to do this base on eject command <a href="../en/ZTE_MF110/MF190.html#Switch_from_CD_mode_to_modem_mode_on_the_device" title="ZTE MF110/MF190">here</a>.</div>
<h2><span class="mw-headline" id="Connection">Connection</span></h2>
<p>In general, at this point you should note if <a href="#Mode_switching">mode switching</a> left you with additional <code>/dev/ttyUSB*</code> serial like device, or an Ethernet like device, such as <code>en*</code> interface. You can do that by shell commands such as 
</p>
<pre>$ ls /dev/ttyUSB*
$ ip link
</pre>
<p>, or with <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journalctl">journalctl</a>. And follow <a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a> accordingly. Some further notes are:
</p>
<h3><span class="mw-headline" id="Serial_like_interface">Serial like interface</span></h3>
<h4><span class="mw-headline" id="ModemManager">ModemManager</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span>.
</p>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>ModemManager.service</code>.
</p>
<p>Use <span class="plainlinks archwiki-template-man" title="$ man 1 mmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mmcli.1">mmcli(1)</a></span> to communicating with the modem.
</p>
<p>The simplest way to establish a connection is to use <i>mmcli'</i>s <code>--simple-connect</code> option.
</p>
<p>First, list the modems and find the modem's index:
</p>
<pre>$ mmcli -L
</pre>
<p>Look for <code>/org/freedesktop/ModemManager1/Modem/<i><b>MODEM_INDEX</b></i></code>.
</p>
<p>Next connect to the mobile network. For example:
</p>
<pre>$ mmcli -m <i>MODEM_INDEX</i> --simple-connect="apn=internet.myisp.example"
</pre>
<p>Replace <code>internet.myisp.example</code> with your ISP's provided <a href="https://en.wikipedia.org/wiki/Access_Point_Name" class="extiw" title="wikipedia:Access Point Name">APN</a>. If a user name and password is required, set them accordingly:
</p>
<pre>$ mmcli -m <i>MODEM_INDEX</i> --simple-connect="apn=internet.myisp.example,user=<i>user_name</i>,password=<i>password</i>"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>ModemManager only establishes a connection to the mobile network. To access the Internet, you will still need use a <a href="../en/Network_configuration.html#Network_managers" class="mw-redirect" title="Network manager">network manager</a> or <a href="../en/Network_configuration.html#DHCP" class="mw-redirect" title="DHCP">DHCP</a> client.</li>
<li>Following <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.net-naming-scheme"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.net-naming-scheme.7">systemd.net-naming-scheme(7)</a></span>, the network interface name will start with <code>ww</code> (e.g. <code>wwp0s20u8i2</code>). Run <code>ip link</code> to find out the exact name.</li>
</ul>
</div>
<p>To disconnect from the mobile network run:
</p>
<pre>$ mmcli -m <i>MODEM_INDEX</i> --simple-disconnect
</pre>
<p>See also <span class="plainlinks archwiki-template-man" title="$ man 1 mmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mmcli.1#EXAMPLES">mmcli(1) § EXAMPLES</a></span>.
</p>
<h4><span class="mw-headline" id="NetworkManager">NetworkManager</span></h4>
<p><a href="../en/NetworkManager.html" title="NetworkManager">NetworkManager</a> uses ModemManager to work with mobile broadband modems.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span>. Afterwards <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>ModemManager.service</code>.
</p>
<p>A system restart might be necessary for ModemManager to detect the USB modem. After you restart the NetworkManager-applet and plug the modem in again NetworkManager should recognize the modem in the menu without further configuration. 
</p>
<p>Setting up the modem in NetworkManager is self-explanatory. NetworkManager's graphical frontends (e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nm-connection-editor">nm-connection-editor</a></span>) will use information from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mobile-broadband-provider-info">mobile-broadband-provider-info</a></span> to allow you to choose your ISP and billing plan without needing to manually specify the <a href="https://en.wikipedia.org/wiki/Access_Point_Name" class="extiw" title="wikipedia:Access Point Name">APN</a> or other settings.
</p>
<p>In case NetworkManager does not recognize the modem, check the output of:
</p>
<pre># systemctl status ModemManager.service
</pre>
<p>If you get error messages such as <code>Couldn't check support for device</code> and <code>not supported by any plugin</code>, you may have to whitelist your device using the ModemManager filter rules <a rel="nofollow" class="external free" href="https://www.freedesktop.org/software/ModemManager/api/latest/ref-overview-modem-filter.html">https://www.freedesktop.org/software/ModemManager/api/latest/ref-overview-modem-filter.html</a>
</p>
<p>Whilst running ModemManager gammu will not work. SMS and USSD codes can be still used with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modem-manager-gui">modem-manager-gui</a></span>.
</p>
<h4><span class="mw-headline" id="pppd">pppd</span></h4>
<p><a href="../en/Ppp.html" class="mw-redirect" title="Pppd">pppd</a> can be used to configure 3g connections. Step by step instruction is available on <a href="../en/3G_and_GPRS_modems_with_pppd.html" title="3G and GPRS modems with pppd">3G and GPRS modems with pppd</a>. Optionally, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pppconfig/">pppconfig</a></span><sup><small>AUR</small></sup> can be used to simplify the pppd configuration using dialog interface.
</p>
<h4><span class="mw-headline" id="wvdial">wvdial</span></h4>
<p>See main article: <a href="../en/Wvdial.html" title="Wvdial">wvdial</a>
</p>
<h4><span class="mw-headline" id="netctl">netctl</span></h4>
<p>Netctl can be used to establish a connection using a USB modem. An example configuration file provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=netctl">netctl</a></span> is located at <code>/etc/netctl/examples/mobile_ppp</code>. Minimally you will probably have to specify
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/mobile_ppp</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Interface=cdc-wdmX
Connection=mobile_ppp
PhoneNumber=XxxxXXXX
AccessPointName=Broadband</pre>
<p>See the <a href="../en/Netctl.html" title="Netctl">netctl</a> article and <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile</a> for more information.
</p>
<h4><span class="mw-headline" id="libmbim">libmbim</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libmbim">libmbim</a></span> from the official repositories. To bring up the modem you can use <code>mbim-network</code> which is a wrapper for <code>mmcli</code> calls. First create a profile for mbim-network.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mbim-network.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">APN=Broadband</pre>
<p>
Now connect to the network with </p>
<pre># mbim-network /dev/cdc-wdmX start</pre>
<p>. Then bring up the interface and get an IP address:
</p>
<pre># ip link set wwanY up
# dhcpcd wwanY
</pre>
<h4><span class="mw-headline" id="sakis3g">sakis3g</span></h4>
<p>There may be the chance that the modem stick is supported by <a rel="nofollow" class="external text" href="http://www.sakis3g.com/">sakis3g</a> which is an all in one command line script and automates all the steps above. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sakis3g/">sakis3g</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> from the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<h3><span class="mw-headline" id="Ethernet_like_interface">Ethernet like interface</span></h3>
<p>In that case you will need to have the <a href="../en/Network_configuration.html#Enabling_and_disabling_network_interfaces" title="Network configuration">interface up</a>. If the device has a <a href="../en/Network_configuration.html#DHCP" class="mw-redirect" title="DHCP">DHCP</a> server, you can use a DHCP client to match it. Otherwise, you will have to have some knowledge about the network the device expects. Such information might be obtained from its behavior in another OS. Or by searching the web. Or from the drivers, and other information, stored in the initial USB flash memory storage (ZeroCD). Some Huawei HiLink devices, for example, sometime operate at 192.168.8.0/24, with a gateway at 192.168.8.1. They also might have a web interface at 192.168.8.1.
</p>
<h3><span class="mw-headline" id="Connection_halts_after_few_minutes_running">Connection halts after few minutes running</span></h3>
<p>This problem commonly occurs on some modems which locked by a mobile operator. You can successfully connect to the internet but after few minutes connection halts and your modem reboots. That happens because an operator built a some checks into modem firmware so a modem checks if a branded software is running on your pc, but usually that software is Windows-only, and obviously you do not use it. Fix (it works on ZTE-mf190 at least) is simple - send this command through serial port (use minicom or similar soft):
</p>
<pre>AT+ZCDRUN=E\r\n
</pre>
<p>This command will delete a <code>NODOWNLOAD.FLG</code> file in the modem's filesystem - it will disable such checks.
</p>
<p>Another possibility for such disconnections is to help the customer save bandwidth, which might be expensive. With Huawei HiLink devices with a web interface, there might be an option there to set a longer period of inactivity before the connection hangs up.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Disable_mode_switching">Disable mode switching</span></h3>
<p>Some ways to disable <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span> from operating on a device before the device was inserted, for example to be able to read the initial flash memory (ZeroCD), are:
</p>
<h4><span class="mw-headline" id="By_the_configuration_file">By the configuration file</span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/usb_modeswitch.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DisableSwitching=1</pre>
<h4><span class="mw-headline" id="With_a_udev_rule">With a udev rule</span></h4>
<p>Masking the udev rule the package is using can be achieved with 
</p>
<pre># ln -s /dev/null /etc/udev/rules.d/40-usb_modeswitch.rules
</pre>
<h3><span class="mw-headline" id="AT_commands">AT commands</span></h3>
<p>There are some useful commands:
</p>
<ul>
<li>
<code>AT^U2DIAG=0</code> - the device is only Modem</li>
<li>
<code>AT^U2DIAG=1</code> - device is in modem mode + CD ROM</li>
<li>
<code>AT^U2DIAG=255</code> - the device in modem mode + CD ROM + Card Reader</li>
<li>
<code>AT^U2DIAG=256</code> - the device in modem mode + Card Reader</li>
<li>
<code>AT+CPIN=<i>PIN-CODE</i></code> - enter PIN-code</li>
<li>
<code>AT+CUSD=1,<i>PDU-encoded-USSD-code</i>,15</code> - USSD request, result can be found (probably) in <code>/dev/ttyUSB2</code>.</li>
</ul>
<p>Encode <code>*100#</code> to PDU format:
</p>
<pre>$ perl -e '@a=split(//,unpack("b*","*100#")); for ($i=7; $i &lt; $#a; $i+=8) { $a[$i]="" } print uc(unpack("H*", pack("b*", join("", @a))))."\n"'
</pre>
<p>Decode <code>AA180C3602</code> from PDU format:
</p>
<pre>$ perl -e '@a=split(//,unpack("b*", pack("H*","AA180C3602"))); for ($i=6; $i &lt; $#a; $i+=7) {$a[$i].="0" } print pack("b*", join("", @a)).""'
</pre>
<p>Answer decoding (this example is balance response: <code>151.25</code>):
</p>
<pre>$ perl -e 'print pack("H*", "003100350031002C003200350020044004430431002E0020");'
</pre>
<p>Some operators return USSD result in PDU encoding, so you should check proper decoding method.
</p>
<ul>
<li>
<code>AT+CSQ</code> - get signal quality (<code>AT+CSQ=?</code>)</li>
<li>
<code>AT+GMI</code> - get manufacturer</li>
<li>
<code>AT+GMM</code> - get model</li>
<li>
<code>AT+GMR</code> - get revision</li>
<li>
<code>AT+GMN</code> - get IMEI</li>
<li>
<code>AT+COPS?</code> - get operator info</li>
<li>
<code>AT^CARDLOCK="<i>NCK-code</i>"</code> - unlock modem. NCK-code should be calculated by IMEI. After that modem can work with any GSM-provider.</li>
<li>
<code>AT^SYSCFG=<i>mode</i>, <i>order</i>, <i>band</i>, <i>roaming</i>, <i>domain</i></code> - System Config</li>
</ul>
<p>Mode:
</p>
<ul>
<li>
<code>2</code> Automatic search</li>
<li>
<code>13</code> 2G ONLY</li>
<li>
<code>14</code> 3G ONLY</li>
<li>
<code>16</code> No change</li>
</ul>
<p>Order:
</p>
<ul>
<li>
<code>0</code> Automatic search</li>
<li>
<code>1</code> 2G first, then 3G</li>
<li>
<code>2</code> 3G first, then 2G</li>
<li>
<code>3</code> No change</li>
</ul>
<p>Band:
</p>
<ul>
<li>
<code>80</code> GSM DCS systems</li>
<li>
<code>100</code> Extended GSM 900</li>
<li>
<code>200</code> Primary GSM 900</li>
<li>
<code>200000</code> GSM PCS</li>
<li>
<code>400000</code> WCDMA IMT 2000</li>
<li>
<code>3FFFFFFF</code> Any band</li>
<li>
<code>40000000</code> No change of band</li>
</ul>
<p>Roaming:
</p>
<ul>
<li>
<code>0</code> Not supported</li>
<li>
<code>1</code> Roaming is supported</li>
<li>
<code>2</code> No change</li>
</ul>
<p>Domain:
</p>
<ul>
<li>
<code>0</code> CS_ONLY</li>
<li>
<code>1</code> PS_ONLY</li>
<li>
<code>2</code> CS_PS</li>
<li>
<code>3</code> ANY</li>
<li>
<code>4</code> No change</li>
</ul>
<h3><span class="mw-headline" id="Low_connection_speed">Low connection speed</span></h3>
<p>Someone claims that the connection speed under Linux is lower than Windows <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=111513">[1]</a>. This is a short summary for possible solutions which are not fully verified.
</p>
<p>In most of conditions, the low speed is caused by bad receiver signals and too many people in cell. But you still could use the following method to try to improve the connection speed:
</p>
<ul><li>QoS parameter can be set with the <code>AT+CGEQMIN</code> and <code>AT+CGEQREQ</code> commands. It should also be possible to decrease and limit the connection speed. Add the following <code>Init</code> command in <code>/etc/wvdial.conf</code>:</li></ul>
<pre>Init6 = AT+CGEQMIN=1,4,64,640,64,640
Init7 = AT+CGEQREQ=1,4,64,640,64,640
</pre>
<ul><li>Baud parameter in <code>/etc/wvdial.conf</code> could be used to increase the connection speed:</li></ul>
<pre>Baud = 460800
</pre>
<p>It is advisable to see the baud rate set by the official modem application for Windows (possibly <code>9600</code> on Vista).
</p>
<h3><span class="mw-headline" id="Monitor_used_bandwidth">Monitor used bandwidth</span></h3>
<p>Frequently a 3G connection obtained via a mobile phone operator comes with restricted bandwidth, so that you are only allowed to use a certain bandwidth per time (e.g. 1GB per month). While it is quite straight-forward to know which type of network applications are pretty bandwidth extensive (e.g. video streaming, gaming, torrent, etc.), it may be difficult to keep an overview about overall consumed bandwidth. 
</p>
<p>A number of tools are available to help with that. Two console tools are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vnstat">vnstat</a></span>, which allows to keep track of bandwith over time, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iftop">iftop</a></span> to monitor bandwidth of individual sessions. If you are a <a href="../en/KDE.html" title="KDE">KDE</a> user, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/knemo/">knemo</a></span><sup><small>AUR</small></sup> might help. All are available in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.
</p>
<p>The internal web server found in some devices, such as some Huawei HiLink, might also show information about bandwidth usage.
</p>
<h3><span class="mw-headline" id="Reading_SMS">Reading SMS</span></h3>
<h4><span class="mw-headline" id="With_dedicated_software">With dedicated software</span></h4>
<p>This was tested on a Huawei EM770W (GTM382E) 3g card integrated into an Acer Aspire AS3810TG laptop. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnokii">gnokii</a></span>, then:
</p>
<pre>$ mkdir -p $XDG_CONFIG_HOME/gnokii
</pre>
<p>Usually the configuration directory is <code>~/.config/gnokii</code>. 
</p>
<pre>$ cp /etc/gnokiirc ~/.config/gnokii/config
</pre>
<p>Edit <code>~/.config/gnokii/config</code> as follows:
</p>
<pre>port = /dev/ttyUSB0
</pre>
<p>You may have to use a different port depending on your configuration, for example <code>/dev/ttyUSB1</code> or something else:
</p>
<pre>model = AT
connection = serial</pre>
<p>You need to be part of the <code>uucp</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">group</a> to use <code>/dev/ttyUSB0</code>.
</p>
<p>Then launch gnokii:
</p>
<pre>$ xgnokii
</pre>
<p>Click on the "SMS" icon button, a window opens up. Then click: "messages-&gt;activate sms reading". Your messages will show up in the window.
</p>
<p><b>Command line script</b>:
</p>
<p>A small command line script using gnokii to read SMS on your SIM card (not phone memory) without having to start a GUI:
</p>
<pre>$ gnokii --getsms SM 0 end 2&gt;&amp;1|grep Text -A1 -B3|grep -v Text
</pre>
<p>What it does:
</p>
<pre>gnokii # invoke gnokii
--getsms SM 0 end # read SMS from SM-memory location (=SIM card) starting at 0 and reading all occupied memory locations ("end")
2&gt;&amp;1 # connect STDERR to STDOUT to make sure the output from the --getsms command can be piped to grep
|grep Text # pipe output from gnokii to grep, anchoring at output containing "Text"
-A1 -B3 # print one line after the matched pattern and three lines before the matched pattern
|grep -v Text # grep result to another grep to exclude the "Text" line (-v for inverting the pattern)
</pre>
<p>Granted this does not work very well if your SMS contains the word "Text", but you may adapt the script to your liking.
</p>
<p>Another option is to use <code>mmcli</code>
</p>
<pre>#!/bin/bash
#get modem number
MODEMNO=$(mmcli -L | grep -o "Modem/[0-9]" | grep -o [0-9]$)
#list newest SMS
SMSNO=$(mmcli -m ${MODEMNO} --messaging-list-sms | awk '/received/{split($1, ar, /\//); print ar[6]; exit}')
#read message
mmcli -m ${MODEMNO} -s /org/freedesktop/ModemManager1/SMS/${SMSNO}
</pre>
<h4><span class="mw-headline" id="With_email_like_web_interface">With email like web interface</span></h4>
<p>Some Devices, such as some Huawei HiLink, include an email like web interface for SMS. It is included in the device internal web server, which is used for other purposes too.
</p>
<h3><span class="mw-headline" id="Writing_SMS">Writing SMS</span></h3>
<pre>#!/bin/bash
#get modem number
MODEMNO=$(mmcli -L | grep -o "Modem/[0-9]" | grep -o [0-9]$)
#create sms in modem and get number
SMSNO=$(mmcli -m ${MODEMNO} --messaging-create-sms="text='$1',number=+$2" |  grep -o [0-9]*$)
#send message
mmcli -s ${SMSNO} --send
# delete all sent messages
for i in $(mmcli -m ${MODEMNO} --messaging-list-sms | grep " (sent)" | cut -f5 -d' ') ; do
    mmcli -m ${MODEMNO} --messaging-delete-sms=$i
done
</pre>
<p>You may need give permission by creating file with content like
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/polkit-1/rules.d/49-nopasswd_mmcli.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">polkit.addRule(function(action, subject) {
    if (action.id == "org.freedesktop.ModemManager1.Messaging" &amp;&amp;
        subject.isInGroup("uucp"))
    {
        return polkit.Result.YES;
    }
});
</pre>
<h3><span class="mw-headline" id="Fix_image_quality">Fix image quality</span></h3>
<p>If you are getting low quality images while browsing the web over a mobile broadband connection with the hints <code>shift+r improves the quality of this image</code> and <code>shift+a improves the quality of all images on this page</code>, follow these instructions:
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyproxy">tinyproxy</a></span>.
</p>
<p>Edit <code>/etc/tinyproxy/tinyproxy.conf</code> and insert the following two lines:
</p>
<pre>AddHeader "Pragma" "No-Cache"
AddHeader "Cache-Control" "No-Cache"
</pre>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">Start</a> <code>tinyproxy.service</code>
</p>
<p>Configure your browser to use <code>localhost:8888</code> as a <a href="../en/Proxy_server.html" title="Proxy server">proxy server</a> and you are all done. This is especially useful if you are using, for example, Google <a href="../en/Chromium.html" class="mw-redirect" title="Chrome">Chrome</a> which, unlike Firefox, does not allow you to modify the Pragma and Cache-Control headers.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Modems.html" title="Category:Modems">Modems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=USB_3G_Modem&amp;oldid=656152">https://wiki.archlinux.org/index.php?title=USB_3G_Modem&amp;oldid=656152</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 March 2021, at 08:46.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
