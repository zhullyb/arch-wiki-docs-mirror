<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Whonix - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Whonix rootpage-Whonix skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Whonix</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><a rel="nofollow" class="external text" href="https://www.whonix.org">Whonix</a> is a desktop operating system setup designed for advanced security and privacy. This page describes how an Arch user may use a Whonix Gateway to route all traffic through <a href="/title/Tor" title="Tor">Tor</a> and receive many other the security benefits from compartmentalization as described below. 
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Background_on_Whonix_and_Tor"><span class="tocnumber">1</span> <span class="toctext">Background on Whonix and Tor</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Downloading_and_Installing_Whonix_Gateway"><span class="tocnumber">2</span> <span class="toctext">Downloading and Installing Whonix Gateway</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Download_and_install_the_Whonix_Gateway"><span class="tocnumber">2.1</span> <span class="toctext">Download and install the Whonix Gateway</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Update_the_Whonix_Gateway"><span class="tocnumber">2.2</span> <span class="toctext">Update the Whonix Gateway</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#Installation_of_Arch_as_a_Whonix_Workstation"><span class="tocnumber">3</span> <span class="toctext">Installation of Arch as a Whonix Workstation</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Starting_Arch_inside_VirtualBox"><span class="tocnumber">3.1</span> <span class="toctext">Starting Arch inside VirtualBox</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Connecting_to_internet_during_Arch_install"><span class="tocnumber">3.2</span> <span class="toctext">Connecting to internet during Arch install</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Mapping_files_over_to_your_arch-chroot_installation_environment"><span class="tocnumber">3.3</span> <span class="toctext">Mapping files over to your arch-chroot installation environment</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Tor_Check"><span class="tocnumber">3.4</span> <span class="toctext">Tor Check</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#(Optional)_Post-Installation_considerations"><span class="tocnumber">4</span> <span class="toctext">(Optional) Post-Installation considerations</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Installing_Tor_Browser"><span class="tocnumber">4.1</span> <span class="toctext">Installing Tor Browser</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#DNS_Leak_Tests"><span class="tocnumber">4.2</span> <span class="toctext">DNS Leak Tests</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Familiarize_yourself_with_the_strengths_and_weaknesses_of_both_the_Whonix_model_and_Tor"><span class="tocnumber">4.3</span> <span class="toctext">Familiarize yourself with the strengths and weaknesses of both the Whonix model and Tor</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Keeping_time_synced_between_Workstation_and_Gateway"><span class="tocnumber">4.4</span> <span class="toctext">Keeping time synced between Workstation and Gateway</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Background_on_Whonix_and_Tor">Background on Whonix and Tor</span></h2>
<p>The Whonix setup works by compartmentalizing two separate operating systems running inside of two separate virtual machines for greater security, while simultaneously routing all traffic through <a href="/title/Tor" title="Tor">Tor</a>.  This greater security model <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Main_Page">provides several benifits</a>:
</p>
<ul>
<li>Only connections through <a href="/title/Tor" title="Tor">Tor</a> are permitted.</li>
<li>Servers can be run, and applications used, anonymously over the internet.</li>
<li>DNS leaks are impossible.</li>
<li>Malware with root privileges cannot discover the user's real IP address.</li>
<li>Threats posed by misbehaving applications and user error are minimized.</li>
</ul>
<p><a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Comparison_with_Others">The Whonix wiki</a> provides many specific examples of attacks and software flaws that would normally pose a security and/or privacy problem, but are thwarted by this compartmentalization model.  It also describes where this model may still fail so it's an important page to understand. 
</p>
<p>The first operating system is "The Workstation" and is the OS you perform your normal everyday tasks in. The second is "The Gateway" that forces all traffic from the Workstation through Tor while providing the additional security benefits listed above.
</p>
<p>The main Whonix team provides both a Gateway and Workstation running on top of Debian, but Arch users may enjoy using Arch as their main Workstation OS. This page describes how that can to be done.  
</p>
<h2><span class="mw-headline" id="Downloading_and_Installing_Whonix_Gateway">Downloading and Installing Whonix Gateway</span></h2>
<p>You will not use the Gateway for everyday tasks.  It only serves to compartmentalize your Workstation activity from the internet while routing all traffic through Tor. 
</p>
<h3><span class="mw-headline" id="Download_and_install_the_Whonix_Gateway">Download and install the Whonix Gateway</span></h3>
<p>Go to the <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/VirtualBox">Whonix VirtualBox page</a>, download the "Whonix-Gateway" using one of the download options available, then verify download using one of the methods described on that page.  Make sure you also have <a href="/title/VirtualBox" title="VirtualBox">VirtualBox</a> installed. 
</p>
<p>Next, import the Whonix-Gateway inside VirtualBox by going to, <i>File &gt; Import Appliance &gt; Whonix-Gateway-&lt;version&gt;.ova</i>, to select the Gateway file just downloaded, then agree to the conditions that describe system requirements and security considerations for using Whonix. It may be helpful to follow the instructions provided on the Whonix download page previously linked . There are also <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Videos">video tutorials available</a> demonstrating this process. 
</p>
<p>After the appliance has been installed, start the Gateway using the start icon.
</p>
<h3><span class="mw-headline" id="Update_the_Whonix_Gateway">Update the Whonix Gateway</span></h3>
<p>Before we start Arch, we need to agree to the terms and ensure our Whonix Gateway has all up-to-date security patches. As with importing the appliance above, the terms you must agree to state that you understand the security considerations for running Whonix. After booting up the Gateway agree to these terms, state that you intend on using the stable repository and check "I am ready to enable TOR". After this, open a terminal. It will present you with information how to login as either root or a normal user.  
</p>
<p>Log in inside of this terminal as root and run:
</p>
<pre># apt-get update
</pre>
<pre># apt-get dist-upgrade
</pre>
<p>Then reboot your Whonix Gateway.  After rebooting, open a terminal and this time log in as the normal user.  Run the whonix check:
</p>
<pre>$ whonixcheck
</pre>
<p>You may also run nyx:
</p>
<pre>$ nyx
</pre>
<p>To monitor traffic through the gateway.
</p>
<h2><span class="mw-headline" id="Installation_of_Arch_as_a_Whonix_Workstation">Installation of Arch as a Whonix Workstation</span></h2>
<h3><span class="mw-headline" id="Starting_Arch_inside_VirtualBox">Starting Arch inside VirtualBox</span></h3>
<p>After you have installed the Whonix-Gateway, and while the Gateway is running, install an instance of Arch inside a separate <a href="/title/VirtualBox" title="VirtualBox">VirtualBox</a> instance. This is installation process is done as normal, save a few important steps described below, and so one should follow the <a href="/title/Installation_guide" title="Installation guide">Installation guide</a>.
</p>
<p>After creating the Arch instance, and before starting, three important settings need to be selected.  First, the network has to point to the running Whoinx-Gateway. To do this, select <i>Settings &gt; Network &gt; Attached to &gt; Internal Network &gt; Whonix</i> to select networking through Whonix.
</p>
<p>Also it is best if PAE is enabled so select <i>Settings &gt; System &gt; Processor &gt; Extended Features &gt; Enable PAE/NX</i>.
</p>
<p>Lastly, select the Arch installation iso you downloaded as your boot storage by going to <i>Settings &gt; Storage &gt; Empty &gt; Optical Drive &gt; Choose Virtual Optical Disk File &gt; archlinux-&lt;version&gt;.iso</i>.
</p>
<p>After these three settings have been selected, start your Arch VirtualBox instance.
</p>
<h3><span class="mw-headline" id="Connecting_to_internet_during_Arch_install">Connecting to internet during Arch install</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="/title/Help:Style" title="Help:Style">Help:Style</a> for reference.</b><a href="/title/File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Duplicates <a href="/title/Network_configuration" title="Network configuration">Network configuration</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Whonix">Talk:Whonix#</a>)</div>
</div>
<p>When connecting a non-preset Workstation to the internet through a Whonix Gateway a few settings must be set manually <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Ubuntu">as described here</a>.  The address must be set to 10.152.152.50, the netmask to 255.255.192.0, the gateway to 10.152.152.10 and the nameserver to 10.152.152.10.  First, find your interface by running:
</p>
<pre># ip a
</pre>
<p>and look for your ethernet interface.  Something like eth0 or enp0s3 is common. Next, deactivate the interface with:
</p>
<pre># ip link set <i>interface</i> down
</pre>
<p>Where <code><i>interface</i></code> is replaced with the name of the interface found above.  Next we must configure the static network connection to use the values shown above.  Perhaps the easiest way is to copy the static example file:
</p>
<pre># cp /etc/netctl/examples/ethernet-static /etc/netctl/whonix
</pre>
<p>Then replace the contents of that file with:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/whonix</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='Whonix static ethernet connection'
Interface=enp0s3
Connection=ethernet
IP=static
Address=('10.152.152.50/18')
Gateway='10.152.152.10'
</pre>
<p>Where you should use replace enp0s3 with your <code><i>interface</i></code> found above. The /18 is <a rel="nofollow" class="external text" href="https://saloperie.com/docs/mask.html">CIDR notation</a> for the above netmask. Then edit <code>/etc/resolv.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolv.conf:</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver 10.152.152.10
</pre>
<p>Then edit <code>/etc/environment</code> to prevent potential <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Tor_Browser/Advanced_Users#Whonix-Custom-Linux-Workstation">tor over tor problems</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/environment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">TOR_SKIP_LAUNCH=1
TOR_NO_DISPLAY_NETWORK_SETTINGS=1
TOR_SKIP_CONTROLPORTTEST=1</pre>
<p>Now enable the Whonix network connection:
</p>
<pre># netctl start whonix
</pre>
<p>And bring your interface back up:
</p>
<pre># ip link set <i>interface</i> up
</pre>
<p>Where once again <code><i>interface</i></code> should be replaced with your interface. Next, confirm that the address 10.152.152.50/18 now shows up under your interface using:
</p>
<pre># ip a
</pre>
<p>If this is checks out, try pinging your favorite website such as:
</p>
<pre># ping -c3 www.google.com
</pre>
<p>If this ping successfully shows bytes of data transferred than internet is working through Whonix.  Running "nyx" inside the Gateway as described above will further confirm that the packets are being sent across the Gateway.
</p>
<h3><span class="mw-headline" id="Mapping_files_over_to_your_arch-chroot_installation_environment">Mapping files over to your arch-chroot installation environment</span></h3>
<p>Once these files have been edited and your internet is working, proceed with the normal Arch installation process. Preparing drives, formatting, etc. Then after you run pacstrap, but before you arch-chroot into your installation chroot, you need to copy the files you created above over.
</p>
<pre># cp /etc/netctl/whonix /mnt/etc/netctl/whonix
</pre>
<pre># cp /etc/resolv.conf /mnt/etc/resolv.conf
</pre>
<pre># cp /etc/environment /mnt/etc/environment
</pre>
<p>Then perform the standard arch-chroot and enable your network settings there:
</p>
<pre># arch-chroot /mnt
</pre>
<pre># netctl enable whonix
</pre>
<p>Make sure you are still connected to the internet, and complete your Arch installation as you would normally. Set up root password, boot loader, etc. It is important that you set your timezone to UTC to match the Gateway.  Once the installation is done, reboot.
</p>
<h3><span class="mw-headline" id="Tor_Check">Tor Check</span></h3>
<p>Once your installation is completed, you have rebooted into Arch, and verified the Whonix Gateway is running, you should be able to access the internet routed through Tor.  You can verify traffic is being routed through Tor by installing your favorite web browser and <a rel="nofollow" class="external text" href="https://check.torproject.org/">performing the Tor Check</a>.  This Tor Check should explicitly say you are using Tor.
</p>
<h2>
<span id=".28Optional.29_Post-Installation_considerations"></span><span class="mw-headline" id="(Optional)_Post-Installation_considerations">(Optional) Post-Installation considerations</span>
</h2>
<h3><span class="mw-headline" id="Installing_Tor_Browser">Installing Tor Browser</span></h3>
<p>The standard web-browsers one would install in Arch will be forced to route all traffic through Tor and will receive all the benefits of Whonix compartmentalization.  This can easily easily be checked by <a rel="nofollow" class="external text" href="https://check.torproject.org/">performing the Tor Check</a> as well as other DNS tests described below.  
</p>
<p>However, some might like to use the official Tor browser that comes with extra add-ons and security audits for use with Tor.  To install the Tor browser, <a rel="nofollow" class="external text" href="https://www.torproject.org/download/download.html">download the browser from here</a> and extract it into ~/.tb as follows. 
</p>
<pre>$ mkdir -p ~/.tb
</pre>
<pre>$ tar -xf tor-browser-<i>version</i>.tar.xz
</pre>
<pre>$ mv tor-browser_<i>version</i> ~/.tb/tor-browser
</pre>
<p>After the Tor Browser is installed we need to set the configuration to access Tor properly through the Whonix Gateway which is done by editing the following file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.tb/tor-browser/Browser/TorBrowser/Data/Browser/profile.default/user.js</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">user_pref("extensions.torbutton.use_privoxy", false);
user_pref("extensions.torbutton.settings_method", "custom");
user_pref("extensions.torbutton.socks_host", "10.152.152.10");
user_pref("extensions.torbutton.socks_port", 9100);
user_pref("network.proxy.socks", "10.152.152.10");
user_pref("network.proxy.socks_port", 9100);
user_pref("extensions.torbutton.custom.socks_host", "10.152.152.10");
user_pref("extensions.torbutton.custom.socks_port", 9100);
user_pref("extensions.torlauncher.control_host", "10.152.152.10");
user_pref("extensions.torlauncher.control_port", 9052);
</pre>
<p>Now start the Tor Browser.
</p>
<pre>$ cd ~/.tb/tor-browser
</pre>
<pre>$ ./start-tor-browser.desktop
</pre>
<p>The <a rel="nofollow" class="external text" href="https://check.torproject.org/">Tor Check</a> should verify both that you are using Tor and the Tor Browser.
</p>
<h3><span class="mw-headline" id="DNS_Leak_Tests">DNS Leak Tests</span></h3>
<p>There are several Leak Tests one can preform to verify no traffic is leaking outside of tor:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.dnsleaktest.com">DNS Leak Test</a></li>
<li><a rel="nofollow" class="external text" href="https://dns-leak.com/">DNS Data</a></li>
<li><a rel="nofollow" class="external text" href="http://check2ip.com">Check 2 IP</a></li>
</ul>
<p>These are also helpful for verifying that no location or other identifying information is being leaked.  
</p>
<p>The <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Dev/Leak_Tests">Whonix DNS Leak Test Wiki</a> has other helpful leak tests that can be performed in addition to checking websites.
</p>
<h3><span class="mw-headline" id="Familiarize_yourself_with_the_strengths_and_weaknesses_of_both_the_Whonix_model_and_Tor">Familiarize yourself with the strengths and weaknesses of both the Whonix model and Tor</span></h3>
<p>As suggested above, familiarize yourself with <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Main_Page">how the Whonix model works</a>, <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Comparison_with_Others">the specific cases</a> it provides extra security and privacy benefits in comparison with other approaches, <a rel="nofollow" class="external text" href="https://www.torproject.org/about/overview.html.en">how Tor works</a> along with the benefits it provides,  and the <a rel="nofollow" class="external text" href="https://www.torproject.org/download/download.html#warning">Tor project suggestions</a> for making Tor work more reliably. 
</p>
<p>There is no silver bullet to security and privacy, but understanding these concepts may bring many additional benefits when used properly. 
</p>
<h3><span class="mw-headline" id="Keeping_time_synced_between_Workstation_and_Gateway">Keeping time synced between Workstation and Gateway</span></h3>
<p>It is helpful to keep the exact time between the Workstation and Gateway in sync.  If they are not, an attacker may suspect you are running a Whonix setup through time mis-matches. The official Whonix Workstation comes with software to force these to be in sync but as of yet I have not figured out how to implement this with Arch.  Any suggestions here are welcome.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Virtualization" title="Category:Virtualization">Virtualization</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Style" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Whonix&amp;oldid=669526">https://wiki.archlinux.org/index.php?title=Whonix&amp;oldid=669526</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 8 May 2021, at 11:55.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
