<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Dual boot with Windows - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dual_boot_with_Windows rootpage-Dual_boot_with_Windows skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Dual boot with Windows</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p>This is an article detailing different methods of Arch/Windows coexistence.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Important_information"><span class="tocnumber">1</span> <span class="toctext">Important information</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Windows_UEFI_vs_BIOS_limitations"><span class="tocnumber">1.1</span> <span class="toctext">Windows UEFI vs BIOS limitations</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Install_media_limitations"><span class="tocnumber">1.2</span> <span class="toctext">Install media limitations</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Bootloader_UEFI_vs_BIOS_limitations"><span class="tocnumber">1.3</span> <span class="toctext">Bootloader UEFI vs BIOS limitations</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#UEFI_Secure_Boot"><span class="tocnumber">1.4</span> <span class="toctext">UEFI Secure Boot</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#Fast_Startup_and_hibernation"><span class="tocnumber">1.5</span> <span class="toctext">Fast Startup and hibernation</span></a>
<ul>
<li class="toclevel-3 tocsection-7">
<a href="#Windows_settings"><span class="tocnumber">1.5.1</span> <span class="toctext">Windows settings</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#Disable_Fast_Startup_and_disable_hibernation"><span class="tocnumber">1.5.1.1</span> <span class="toctext">Disable Fast Startup and disable hibernation</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#Disable_Fast_Startup_and_enable_hibernation"><span class="tocnumber">1.5.1.2</span> <span class="toctext">Disable Fast Startup and enable hibernation</span></a></li>
<li class="toclevel-4 tocsection-10"><a href="#Enable_Fast_Startup_and_enable_hibernation"><span class="tocnumber">1.5.1.3</span> <span class="toctext">Enable Fast Startup and enable hibernation</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Windows_filenames_limitations"><span class="tocnumber">1.6</span> <span class="toctext">Windows filenames limitations</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-13">
<a href="#Windows_before_Linux"><span class="tocnumber">2.1</span> <span class="toctext">Windows before Linux</span></a>
<ul>
<li class="toclevel-3 tocsection-14">
<a href="#BIOS_systems"><span class="tocnumber">2.1.1</span> <span class="toctext">BIOS systems</span></a>
<ul>
<li class="toclevel-4 tocsection-15"><a href="#Using_a_Linux_boot_loader"><span class="tocnumber">2.1.1.1</span> <span class="toctext">Using a Linux boot loader</span></a></li>
<li class="toclevel-4 tocsection-16">
<a href="#Using_Windows_boot_loader"><span class="tocnumber">2.1.1.2</span> <span class="toctext">Using Windows boot loader</span></a>
<ul>
<li class="toclevel-5 tocsection-17"><a href="#Windows_Vista/7/8/8.1_boot_loader"><span class="tocnumber">2.1.1.2.1</span> <span class="toctext">Windows Vista/7/8/8.1 boot loader</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-18"><a href="#UEFI_systems"><span class="tocnumber">2.1.2</span> <span class="toctext">UEFI systems</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19">
<a href="#Linux_before_Windows"><span class="tocnumber">2.2</span> <span class="toctext">Linux before Windows</span></a>
<ul>
<li class="toclevel-3 tocsection-20"><a href="#UEFI_firmware"><span class="tocnumber">2.2.1</span> <span class="toctext">UEFI firmware</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21">
<a href="#Troubleshooting"><span class="tocnumber">2.3</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#Couldn't_create_a_new_partition_or_locate_an_existing_one"><span class="tocnumber">2.3.1</span> <span class="toctext">Couldn't create a new partition or locate an existing one</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#Cannot_boot_Linux_after_installing_Windows"><span class="tocnumber">2.3.2</span> <span class="toctext">Cannot boot Linux after installing Windows</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Restoring_a_Windows_boot_record"><span class="tocnumber">2.3.3</span> <span class="toctext">Restoring a Windows boot record</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#The_EFI_system_partition_created_by_Windows_Setup_is_too_small"><span class="tocnumber">2.3.4</span> <span class="toctext">The EFI system partition created by Windows Setup is too small</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#Time_standard"><span class="tocnumber">3</span> <span class="toctext">Time standard</span></a></li>
<li class="toclevel-1 tocsection-27"><a href="#See_also"><span class="tocnumber">4</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Important_information">Important information</span></h2>
<h3><span class="mw-headline" id="Windows_UEFI_vs_BIOS_limitations">Windows UEFI vs BIOS limitations</span></h3>
<p>Microsoft imposes limitations on which firmware boot mode and partitioning style can be supported based on the version of Windows used:
</p>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> UEFI/MBR is not supported by the Windows installer, but Windows can be manually deployed and booted in UEFI/MBR (at least Windows 10 can). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Dual_boot_with_Windows">Talk:Dual boot with Windows#</a>)</div>
</div>
<ul>
<li>
<b>Windows XP</b> both <b>x86 32-bit</b> and <b>x86_64</b> (also called x64) (RTM and all Service Packs) versions do not support booting in <a href="/title/UEFI" class="mw-redirect" title="UEFI">UEFI</a> mode (IA32 or x86_64) from any disk (<a href="/title/MBR" class="mw-redirect" title="MBR">MBR</a> or <a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a>) OR in BIOS mode from GPT disk. They support only BIOS boot and only from MBR disk.</li>
<li>
<b>Windows Vista</b> or <b>7</b> <b>x86 32-bit</b> (RTM and all Service Packs) versions support booting in BIOS mode from MBR disks only, not from GPT disks. They do not support x86_64 UEFI or IA32 (x86 32-bit) UEFI boot. They support only BIOS boot and only from MBR disk.</li>
<li>
<b>Windows Vista RTM x86_64</b> (only RTM) version support booting in BIOS mode from MBR disks only, not from GPT disks. It does not support x86_64 UEFI or IA32 (x86 32-bit) UEFI boot. It supports only BIOS boot and only from MBR disk.</li>
<li>
<b>Windows Vista</b> (SP1 and above, not RTM) and <b>Windows 7</b> <b>x86_64</b> versions support booting in x86_64 UEFI mode from GPT disk only, OR in BIOS mode from MBR disk only. They do not support IA32 (x86 32-bit) UEFI boot from GPT/MBR disk, x86_64 UEFI boot from MBR disk, or BIOS boot from GPT disk.</li>
<li>
<b>Windows 8/8.1 x86 32-bit</b> support booting in IA32 UEFI mode from GPT disk only, OR in BIOS mode from MBR disk only. They do not support x86_64 UEFI boot from GPT/MBR disk, x86_64 UEFI boot from MBR disk, or BIOS boot from GPT disk. On market, the only systems known to ship with IA32 (U)EFI are some old Intel Macs (pre-2010 models?) and Intel Atom System-on-Chip (Clover trail and Bay Trail) Windows Tablets. in which it boots ONLY in IA32 UEFI mode and ONLY from GPT disk.</li>
<li>
<b>Windows 8/8.1</b> <b>x86_64</b> versions support booting in x86_64 UEFI mode from GPT disk only, OR in BIOS mode from MBR disk only. They do not support IA32  UEFI boot, x86_64 UEFI boot from MBR disk, or BIOS boot from GPT disk.</li>
</ul>
<p>In case of pre-installed Systems:
</p>
<ul>
<li>All systems pre-installed with Windows XP, Vista or 7 32-bit, irrespective of Service Pack level, bitness, edition (SKU) or presence of UEFI support in firmware, boot in BIOS/MBR mode by default.</li>
<li>MOST of the systems pre-installed with Windows 7 x86_64, irrespective of Service Pack level, bitness or edition (SKU), boot in BIOS/MBR mode by default. Very few recent systems pre-installed with Windows 7 are known to boot in x86_64 UEFI/GPT mode by default.</li>
<li>ALL systems pre-installed with Windows 8/8.1 boot in UEFI/GPT mode. The firmware bitness matches the bitness of Windows, ie. x86_64 Windows 8/8.1 boot in x86_64 UEFI mode and 32-bit Windows 8/8.1 boot in IA32 UEFI mode.</li>
</ul>
<p>The best way to detect the boot mode of Windows is to do the following<a rel="nofollow" class="external autonumber" href="https://www.eightforums.com/tutorials/29504-bios-mode-see-if-windows-boot-uefi-legacy-mode.html">[1]</a>:
</p>
<ul>
<li>Boot into Windows</li>
<li>Press <code>Win+R</code> keys to start the Run dialog</li>
<li>In the Run dialog type <code>msinfo32.exe</code> and press Enter</li>
<li>In the <b>System Information</b> windows, select <i>System Summary</i> on the left and check the value of <b>BIOS mode</b> item on the right</li>
<li>If the value is <code>UEFI</code>, Windows boots in UEFI/GPT mode. If the value is <code>Legacy</code>, Windows boots in BIOS/MBR mode.</li>
</ul>
<p>In general, Windows forces type of partitioning depending on the firmware mode used, i.e. if Windows is booted in UEFI mode, it can be installed only to a GPT disk. If Windows is booted in Legacy BIOS mode, it can be installed only to an MBR disk. This is a limitation enforced by Windows installer, and as of April 2014 there is no officially (Microsoft) supported way of installing Windows in UEFI/MBR or BIOS/GPT configuration. Thus Windows only supports either UEFI/GPT boot or BIOS/MBR configuration.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Windows 10 version 1703 and newer supports converting from BIOS/MBR to UEFI/GPT using <a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/windows/deployment/mbr-to-gpt">MBR2GPT.EXE</a>.</div>
<p>Such a limitation is not enforced by the Linux kernel, but can depend on which <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> is used and/or how the boot loader is configured. The Windows limitation should be considered if the user wishes to boot Windows and Linux from the same disk, since installation procedure of boot loader depends on the firmware type and disk <a href="/title/Partitioning" title="Partitioning">partitioning</a> configuration. In case where Windows and Linux dual boot from the same disk, it is advisable to follow the method used by Windows, ie. either go for UEFI/GPT boot or BIOS/MBR boot. See <a rel="nofollow" class="external free" href="https://support.microsoft.com/kb/2581408">https://support.microsoft.com/kb/2581408</a> for more information.
</p>
<h3><span class="mw-headline" id="Install_media_limitations">Install media limitations</span></h3>
<p>Intel Atom System-on-Chip Tablets (Clover trail and Bay Trail) provide only IA32 UEFI firmware without Legacy BIOS (CSM) support (unlike most of the x86_64 UEFI systems), due to Microsoft Connected Standby Guidelines for OEMs. Due to lack of Legacy BIOS support in these systems, and the lack of 32-bit UEFI boot in Arch Official Install ISO (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/53182">FS#53182</a>), the official install media cannot boot on these systems. See <a href="/title/Unified_Extensible_Firmware_Interface#UEFI_firmware_bitness" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#UEFI firmware bitness</a> for more information and available workarounds.
</p>
<h3><span class="mw-headline" id="Bootloader_UEFI_vs_BIOS_limitations">Bootloader UEFI vs BIOS limitations</span></h3>
<p>Most of the linux bootloaders installed for one firmware type cannot launch or chainload bootloaders of the other firmware type. That is, if Arch is installed in UEFI/GPT or UEFI/MBR mode in one disk and Windows is installed in BIOS/MBR mode in another disk, the UEFI bootloader used by Arch cannot chainload the BIOS installed Windows in the other disk. Similarly if Arch is installed in BIOS/MBR or BIOS/GPT mode in one disk and Windows is installed in UEFI/GPT in another disk , the BIOS bootloader used by Arch cannot chainload UEFI installed Windows in the other disk. 
</p>
<p>The only exceptions to this are <a href="/title/GRUB" title="GRUB">GRUB</a> in Apple Macs in which GRUB in UEFI mode can boot BIOS installed OS via <code>appleloader</code> command (does not work in non-Apple systems), and <a href="/title/REFInd" title="REFInd">rEFInd</a> which technically supports booting legacy BIOS OS from UEFI systems, but <a rel="nofollow" class="external text" href="https://rodsbooks.com/refind/using.html#legacy">does not always work in non-Apple UEFI systems</a> as per its author Rod Smith. 
</p>
<p>However if Arch is installed in BIOS/GPT in one disk and Windows is installed in BIOS/MBR mode in another disk, then the BIOS boot loader used by Arch CAN boot the Windows in the other disk, if the boot loader itself has the ability to chainload from another disk. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To dual-boot with Windows on same disk, Arch should follow the same firmware boot mode and partitioning combination used by the Windows installation.</div>
<p><a href="https://en.wikipedia.org/wiki/Windows_Setup" class="extiw" title="wikipedia:Windows Setup">Windows Setup</a> creates a 100 MiB <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a> (except for <a href="/title/Advanced_Format" title="Advanced Format">Advanced Format</a> 4K native drives where it creates a 300 MiB ESP), so multiple <a href="/title/Kernel" title="Kernel">kernel</a> usage is limited. Workarounds include:
</p>
<ul>
<li>Mount ESP to <code>/efi</code> and use a <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> that has file system drivers and is capable of launching kernels that reside on other partitions.</li>
<li>Expand the EFI system partition, typically either by decreasing the Recovery partition size or moving the Windows partition (<b>UUIDs will change</b>).</li>
<li>Backup and delete unneeded fonts in <code><i>esp</i>/EFI/Microsoft/Boot/Fonts/</code> <a rel="nofollow" class="external autonumber" href="https://support.microsoft.com/en-us/help/3086249/we-couldn-t-update-system-reserved-partition-error-installing-windows">[2]</a>.</li>
<li>Backup and delete unneeded language directories in <code><i>esp</i>/EFI/Microsoft/Boot/</code> (e.g. to only keep <code>en-US</code>).</li>
</ul>
<h3><span class="mw-headline" id="UEFI_Secure_Boot">UEFI Secure Boot</span></h3>
<p>All pre-installed Windows 8/8.1 systems by default boot in UEFI/GPT mode and have UEFI Secure Boot enabled by default. This is mandated by Microsoft for all OEM pre-installed systems.
</p>
<p>Arch Linux install media does not support Secure Boot. See <a href="/title/Secure_Boot#Booting_an_installation_medium" class="mw-redirect" title="Secure Boot">Secure Boot#Booting an installation medium</a>. 
</p>
<p>It is advisable to disable UEFI Secure Boot in the firmware setup manually before attempting to boot Arch Linux. Windows 8/8.1 SHOULD continue to boot fine even if Secure boot is disabled. The only issue with regards to disabling UEFI Secure Boot support is that it requires physical access to the system to disable secure boot option in the firmware setup, as Microsoft has explicitly forbidden presence of any method to remotely or programmatically (from within OS) disable secure boot in all Windows 8/8.1 pre-installed systems
</p>
<h3><span class="mw-headline" id="Fast_Startup_and_hibernation">Fast Startup and hibernation</span></h3>
<p>There are two OSs that can be hibernated, you can hibernate Windows and boot Linux (or another OS), or you can hibernate Linux and boot Windows, or hibernate both OSs.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Data loss can occur if Windows hibernates and you dual boot into another OS and make changes to files on a filesystem (such as NTFS) that can be read and written to by Windows and Linux, and that has been mounted by Windows <a rel="nofollow" class="external autonumber" href="https://superuser.com/questions/39532/hibernating-and-booting-into-another-os-will-my-filesystems-be-corrupted/136814#136814">[3]</a>. Similarly, data loss can occur if Linux hibernates, and you dual boot into another OS etc. Windows may hibernate even when you press shutdown, see section <a href="#Windows_settings">#Windows settings</a>.</div>
<p>For the same reason, if you share one EFI System Partition between Windows and Linux, then the EFI System Partition may be damaged if you hibernate (or shutdown with Fast Startup enabled) and then start Linux, or hibernate Linux and then start Windows.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ntfs-3g">ntfs-3g</a></span> added a <a rel="nofollow" class="external text" href="https://sourceforge.net/p/ntfs-3g/ntfs-3g/ci/559270a8f67c77a7ce51246c23d2b2837bcff0c9/">safe-guard</a> to prevent read-write mounting of hibernated NTFS filesystems, but the NTFS driver within the Linux kernel has no such safeguard.
</p>
<p>Windows cannot read filesystems such as ext4 by default that are commonly used for Linux. These filesystems do not have to be considered, unless you install a Windows driver for them.
</p>
<h4><span class="mw-headline" id="Windows_settings">Windows settings</span></h4>
<p>Fast Startup is a feature in Windows 8 and above that hibernates the computer rather than actually shutting it down to speed up boot times.
</p>
<p>There are multiple options regarding the Windows settings for Fast Startup and hibernation that are covered in the next sections.
</p>
<ul>
<li>disable Fast Startup and disable hibernation</li>
<li>disable Fast Startup and enable hibernation</li>
<li>enable Fast Startup and enable hibernation</li>
</ul>
<p>The procedure of disabling Fast Startup is described <a rel="nofollow" class="external text" href="https://www.eightforums.com/tutorials/6320-fast-startup-turn-off-windows-8-a.html">here for Windows 8</a> and <a rel="nofollow" class="external text" href="http://www.tenforums.com/tutorials/4189-fast-startup-turn-off-windows-10-a.html">here for Windows 10</a>. In any case if you disable a setting, make sure to disable the setting and then shut down Windows, before installing Linux; note that rebooting is not sufficient.
</p>
<h5><span class="mw-headline" id="Disable_Fast_Startup_and_disable_hibernation">Disable Fast Startup and disable hibernation</span></h5>
<p>This is the safest option, and recommended if you are unsure about the issue, as it requires the least amount of user awareness when rebooting from one OS into the other. You may share the same EFI System Partition between Windows and Linux.
</p>
<h5><span class="mw-headline" id="Disable_Fast_Startup_and_enable_hibernation">Disable Fast Startup and enable hibernation</span></h5>
<p>This option requires user awareness when rebooting from one OS into the other.
If you want to start Linux while Windows is hibernated, which is a common use case, then
</p>
<ul>
<li>you must use a separate EFI System Partition (ESP) for Windows and Linux, and ensure that Windows does not mount the ESP used for Linux. As there can only be one ESP per drive, the ESP used for Linux must be located on a separate drive than the ESP used for Windows. In this case Windows and Linux can still be installed on the same drive in different partitions, if you place the ESP used by linux on another drive than the Linux root partition.</li>
<li>you can not read-write mount any filesystem in Linux, that is mounted by Windows while Windows is hibernated. You should be extremely careful about this, and also consider <a href="/title/Automount" class="mw-redirect" title="Automount">Automount</a> behaviour.</li>
<li>If you shut down Windows fully, rather than hibernating, then you can read-write mount the filesystem.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can avoid this issue for a drive by mounting a drive as an external drive in Windows and ejecting the drive in Windows before hibernating.</div>
<h5><span class="mw-headline" id="Enable_Fast_Startup_and_enable_hibernation">Enable Fast Startup and enable hibernation</span></h5>
<p>The same considerations apply as in case "Disable Fast Startup and enable hibernation", but since Windows can not be shut down fully, only hibernated, you can never read-write mount any filesystem that was mounted by Windows while Windows is hibernated.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Windows updates may re-enable Fast Startup, as reported in <a rel="nofollow" class="external autonumber" href="https://tedstechshack.com/2017/07/03/warning-multi-booting-uefi-system-windows-10-fast-startup-doubt-reboot/">[4]</a>.</div>
<h3><span class="mw-headline" id="Windows_filenames_limitations">Windows filenames limitations</span></h3>
<p>Windows is limited to filepaths being shorter than <a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file#maximum-path-length-limitation">260 characters</a>.
</p>
<p>Windows also puts <a rel="nofollow" class="external text" href="https://msdn.microsoft.com/en-us/library/aa365247(VS.85).aspx#naming_conventions">certain characters off limits</a> in filenames for reasons that run all the way back to DOS:
</p>
<ul>
<li>
<code>&lt;</code> (less than)</li>
<li>
<code>&gt;</code> (greater than)</li>
<li>
<code>:</code> (colon)</li>
<li>
<code>"</code> (double quote)</li>
<li>
<code>/</code> (forward slash)</li>
<li>
<code>\</code> (backslash)</li>
<li>
<code>|</code> (vertical bar or pipe)</li>
<li>
<code>?</code> (question mark)</li>
<li>
<code>*</code> (asterisk)</li>
</ul>
<p>These are limitations of Windows and not NTFS: any other OS using the NTFS partition will be fine. Windows will fail to detect these files and running <code>chkdsk</code> will most likely cause them to be deleted. This can lead to potential data-loss.
</p>
<p><a href="/title/NTFS-3G" title="NTFS-3G">NTFS-3G</a> applies Windows restrictions to new file names through the <code>windows_names</code> option: <span class="plainlinks archwiki-template-man" title="$ man 8 ntfs-3g"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ntfs-3g.8#Windows_Filename_Compatibility">ntfs-3g(8) § Windows_Filename_Compatibility</a></span> (see <a href="/title/Fstab" title="Fstab">fstab</a>).
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>The recommended way to setup a Linux/Windows dual booting system is to first install Windows, only using part of the disk for its partitions. When you have finished the Windows setup, boot into the Linux install environment where you can create and resize partitions for Linux while leaving the existing Windows partitions untouched. The Windows installation will create the <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a> which can be used by your Linux <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>.
</p>
<h3><span class="mw-headline" id="Windows_before_Linux">Windows before Linux</span></h3>
<h4><span class="mw-headline" id="BIOS_systems">BIOS systems</span></h4>
<h5><span class="mw-headline" id="Using_a_Linux_boot_loader">Using a Linux boot loader</span></h5>
<p>You may use any multi-boot supporting BIOS <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>.
</p>
<h5><span class="mw-headline" id="Using_Windows_boot_loader">Using Windows boot loader</span></h5>
<p>With this setup the Windows bootloader loads GRUB which then boots Arch.
</p>
<h6>
<span id="Windows_Vista.2F7.2F8.2F8.1_boot_loader"></span><span class="mw-headline" id="Windows_Vista/7/8/8.1_boot_loader">Windows Vista/7/8/8.1 boot loader</span>
</h6>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="/title/Help:Style" title="Help:Style">Help:Style</a> for reference.</b><a href="/title/File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Contains personal comments. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Dual_boot_with_Windows">Talk:Dual boot with Windows#</a>)</div>
</div>
<p>The following section contains excerpts from <a rel="nofollow" class="external free" href="https://www.iceflatline.com/2009/09/how-to-dual-boot-windows-7-and-linux-using-bcdedit/">https://www.iceflatline.com/2009/09/how-to-dual-boot-windows-7-and-linux-using-bcdedit/</a>.
</p>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Using ext3 formatted /boot partition, windows bootloader works just fine (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Dual_boot_with_Windows">Talk:Dual boot with Windows#</a>)</div>
</div>
<p>In order to have the Windows boot loader see the Linux partition, one of the Linux partitions created needs to be FAT32 (in this case, <code>/dev/sda3</code>). The remainder of the setup is similar to a typical installation. Some documents state that the partition being loaded by the Windows boot loader must be a primary partition but I have used this without problem on an extended partition.
</p>
<ul><li>When installing the GRUB boot loader, install it on your <code>/boot</code> partition rather than the MBR. <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For instance, my <code>/boot</code> partition is <code>/dev/sda5</code>. So I installed GRUB at <code>/dev/sda5</code> instead of <code>/dev/sda</code>. For help on doing this, see <a href="/title/GRUB/Tips_and_tricks#Install_to_partition_or_partitionless_disk" title="GRUB/Tips and tricks">GRUB/Tips and tricks#Install to partition or partitionless disk</a>.</div>
</li></ul>
<ul><li>Under Linux make a copy of the boot info by typing the following at the command shell:</li></ul>
<pre>my_windows_part=/dev/sda3
my_boot_part=/dev/sda5
mkdir /media/win
mount $my_windows_part /media/win
dd if=$my_boot_part of=/media/win/linux.bin bs=512 count=1
</pre>
<ul><li>Boot to Windows and open up and you should be able to see the linux.bin file at <code>C:\</code>. Now run <b>cmd</b> with administrator privileges (navigate to <i>Start &gt; All Programs &gt; Accessories</i>, right-click on <i>Command Prompt</i> and select <i>Run as administrator</i>):</li></ul>
<pre>bcdedit /create /d "Linux" /application BOOTSECTOR
</pre>
<ul><li>BCDEdit will return a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" class="extiw" title="wikipedia:Universally unique identifier">UUID</a> for this entry that I will refer to as {ID} in the remaining steps. You will need to replace {ID} by the actual returned identifier. An example of {ID} is {d7294d4e-9837-11de-99ac-f3f3a79e3e93}.</li></ul>
<pre>bcdedit /set {ID} device partition=c:
bcdedit /set {ID}  path \linux.bin
bcdedit /displayorder {ID} /addlast
bcdedit /timeout 30
</pre>
<p>Reboot and enjoy. In my case I'm using the Windows boot loader so that I can map my Dell Precision M4500's second power button to boot Linux instead of Windows.
</p>
<h4><span class="mw-headline" id="UEFI_systems">UEFI systems</span></h4>
<p>If you already have Windows installed, it will already have created some partitions on a <a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a>-formatted disk:
</p>
<ul>
<li>a <a href="https://en.wikipedia.org/wiki/Windows_Recovery_Environment" class="extiw" title="wikipedia:Windows Recovery Environment">Windows Recovery Environment</a> partition, generally of size 499 MiB, containing the files required to boot Windows (i.e. the equivalent of Linux's <code>/boot</code>),</li>
<li>an <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a> with a <a href="/title/FAT32" class="mw-redirect" title="FAT32">FAT32</a> filesystem,</li>
<li>a <a href="https://en.wikipedia.org/wiki/Microsoft_Reserved_Partition" class="extiw" title="wikipedia:Microsoft Reserved Partition">Microsoft Reserved Partition</a>, generally of size 128 MiB,</li>
<li>a Microsoft basic data partition with a NTFS filesystem, which corresponds to <code>C:</code>,</li>
<li>potentially system recovery and backup partitions and/or secondary data partitions (corresponding often to <code>D:</code> and above).</li>
</ul>
<p>Using the Disk Management utility in Windows, check how the partitions are labelled and which type gets reported. This will help you understand which partitions are essential to Windows, and which others you might repurpose. The Windows Disk Management utility can also be used to shrink Windows (NTFS) partitions to free up disk space for additional partitions for Linux.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The first 4 partitions in the above list are essential, do not delete them.</div>
<p>You can then proceed with <a href="/title/Partitioning" title="Partitioning">partitioning</a>, depending on your needs.
</p>
<p>Mind that an additional EFI system partition should not be created, as it may <a rel="nofollow" class="external text" href="https://support.microsoft.com/en-us/help/2879602/unable-to-boot-if-more-than-one-efi-system-partition-is-present">prevent Windows from booting</a>. Simply <a href="/title/EFI_system_partition#Mount_the_partition" title="EFI system partition">mount the existing partition</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It only appears when Linux is installed on the second hard disk and a new EFI system partition is created on the second hard disk.</div>
<p>The boot loader needs to support chainloading other EFI applications to do dual boot Windows / Linux.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a href="/title/REFInd" title="REFInd">rEFInd</a> and <a href="/title/Systemd-boot" title="Systemd-boot">systemd-boot</a> will autodetect <i>Windows Boot Manager</i> (<code>\EFI\Microsoft\Boot\bootmgfw.efi</code>) and show it in their boot menu automatically. For <a href="/title/GRUB" title="GRUB">GRUB</a> follow either <a href="/title/GRUB#Windows_installed_in_UEFI/GPT_mode" title="GRUB">GRUB#Windows installed in UEFI/GPT mode</a> to add boot menu entry manually or <a href="/title/GRUB#Detecting_other_operating_systems" title="GRUB">GRUB#Detecting other operating systems</a> for a generated configuration file.</div>
<p>Computers that come with newer versions of Windows often have <a href="/title/Secure_Boot" class="mw-redirect" title="Secure Boot">Secure Boot</a> enabled. You will need to take extra steps to either disable Secure Boot or to make your installation media compatible with secure boot (see above and in the linked page).
</p>
<h3><span class="mw-headline" id="Linux_before_Windows">Linux before Windows</span></h3>
<p>Even though the recommended way to setup a Linux/Windows dual booting system is to first install Windows, it can be done the other way around. In contrast to installing Windows before Linux, you will have to set aside a partition for Windows, say 40GB or larger, in advance. Or have some unpartitioned disk space, or create and resize partitions for Windows from within the Linux installation, before launching the Windows installation.
</p>
<h4><span class="mw-headline" id="UEFI_firmware">UEFI firmware</span></h4>
<p>Windows will use the already existing <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a>. In contrast to what was <a href="#UEFI_systems">stated earlier</a>, it is unclear if a single partition for Windows, without the Windows Recovery Environment and without Microsoft Reserved Partition, will not do.
</p>
<p>Follows an outline, assuming <a href="/title/Secure_Boot" class="mw-redirect" title="Secure Boot">Secure Boot</a> is disabled in the firmware.
</p>
<ol>
<li>Boot into windows installation. Watch to let it use only the intend partition, but otherwise let it do its work as if there is no Linux installation.</li>
<li>Follow the <a href="#Fast_Startup_and_hibernation">#Fast Startup and hibernation</a> section.</li>
<li>Fix the ability to load Linux at start up, perhaps by following <a href="#Cannot_boot_Linux_after_installing_Windows">#Cannot boot Linux after installing Windows</a>. It was already mentioned in <a href="#UEFI_systems">#UEFI systems</a> that some Linux boot managers will autodetect <i>Windows Boot Manager</i>. Even though newer Windows installations have an advanced restart option, from which you can boot into Linux, it is advised to have other means to boot into Linux, such as an arch installation media or a live CD.</li>
</ol>
<h3><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h3>
<h4>
<span id="Couldn.27t_create_a_new_partition_or_locate_an_existing_one"></span><span class="mw-headline" id="Couldn't_create_a_new_partition_or_locate_an_existing_one">Couldn't create a new partition or locate an existing one</span>
</h4>
<p>See <a href="#Windows_UEFI_vs_BIOS_limitations">#Windows UEFI vs BIOS limitations</a>.
</p>
<h4><span class="mw-headline" id="Cannot_boot_Linux_after_installing_Windows">Cannot boot Linux after installing Windows</span></h4>
<p>See <a href="/title/Unified_Extensible_Firmware_Interface#Windows_changes_boot_order" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Windows changes boot order</a>.
</p>
<h4><span class="mw-headline" id="Restoring_a_Windows_boot_record">Restoring a Windows boot record</span></h4>
<p>By convention (and for ease of installation), Windows is usually installed on the first partition and installs its partition table and reference to its bootloader to the first sector of that partition.  If you accidentally install a bootloader like GRUB to the Windows partition or damage the boot record in some other way, you will need to use a utility to repair it.  Microsoft includes a boot sector fix utility <code>FIXBOOT</code> and an MBR fix utility called <code>FIXMBR</code> on their recovery discs, or sometimes on their install discs.  Using this method, you can fix the reference on the boot sector of the first partition to the bootloader file and fix the reference on the MBR to the first partition, respectively.  After doing this you will have to <a href="/title/GRUB#Installation" title="GRUB">reinstall GRUB</a> to the MBR as was originally intended (that is, the GRUB bootloader can be assigned to chainload the Windows bootloader).
</p>
<p>If you wish to revert back to using Windows, you can use the <code>FIXBOOT</code> command which chains from the MBR to the boot sector of the first partition to restore normal, automatic loading of the Windows operating system.
</p>
<p>Of note, there is a Linux utility called <code>ms-sys</code> (package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ms-sys/">ms-sys</a></span><sup><small>AUR</small></sup> in AUR) that can install MBR's.  However, this utility is only currently capable of writing new MBRs (all OS's and file systems supported) and boot sectors (a.k.a. boot record; equivalent to using <code>FIXBOOT</code>) for FAT file systems.  Most LiveCDs do not have this utility by default, so it will need to be installed first, or you can look at a rescue CD that does have it, such as <a rel="nofollow" class="external text" href="https://partedmagic.com/">Parted Magic</a>.
</p>
<p>First, write the partition info (table) again by:
</p>
<pre># ms-sys --partition /dev/sda1
</pre>
<p>Next, write a Windows 2000/XP/2003 MBR:
</p>
<pre># ms-sys --mbr /dev/sda  # Read options for different versions
</pre>
<p>Then, write the new boot sector (boot record):
</p>
<pre># ms-sys -(1-6)          # Read options to discover the correct FAT record type
</pre>
<p><code>ms-sys</code> can also write Windows 98, ME, Vista, and 7 MBRs as well, see <code>ms-sys -h</code>.
</p>
<h4><span class="mw-headline" id="The_EFI_system_partition_created_by_Windows_Setup_is_too_small">The EFI system partition created by Windows Setup is too small</span></h4>
<p><a href="https://en.wikipedia.org/wiki/Windows_Setup" class="extiw" title="wikipedia:Windows Setup">Windows Setup</a> creates a 100 MiB <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a> (except for <a href="/title/Advanced_Format" title="Advanced Format">Advanced Format</a> 4K native drives where it creates a 300 MiB ESP). This is generally too small to fit everything you need. You can try different tools to resize this partition, but there are usually other partitions in the way, making it, at the very least, difficult. One option is to use the Arch install media to create a single <a href="/title/EFI_system_partition" title="EFI system partition">EFI system partition</a> of your preferred size <b>before</b> you install Windows on the drive. Windows Setup will use the EFI system partition you made instead of creating its own.
</p>
<h2><span class="mw-headline" id="Time_standard">Time standard</span></h2>
<ul>
<li>Recommended: Set both Arch Linux and Windows to use UTC, following <a href="/title/System_time#UTC_in_Microsoft_Windows" title="System time">System time#UTC in Microsoft Windows</a>. Some versions of Windows revert the hardware clock back to <i>localtime</i> if they are set to synchronize the time online. This issue appears to be fixed in Windows 10.</li>
<li>Not recommended: Set Arch Linux to <i>localtime</i> and disable all <a href="/title/System_time#Time_synchronization" title="System time">time synchronization daemons</a>. This will let Windows take care of hardware clock corrections and you will need to remember to boot into Windows at least two times a year (in Spring and Autumn) when <a href="https://en.wikipedia.org/wiki/Daylight_saving_time" class="extiw" title="wikipedia:Daylight saving time">DST</a> kicks in. So please do not ask on the forums why the clock is one hour behind or ahead if you usually go for days or weeks without booting into Windows.</li>
</ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=140049">Booting Windows from a desktop shortcut</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/kaipee/grub-reboot2win">One-time boot into Windows partition from desktop shortcut</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/ValdikSS/windows2usb">Windows 7/8/8.1/10 ISO to Flash Drive burning utility for Linux (MBR/GPT, BIOS/UEFI, FAT32/NTFS)</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Categories</a>: <ul>
<li><a href="/title/Category:Boot_process" title="Category:Boot process">Boot process</a></li>
<li><a href="/title/Category:Installation_process" title="Category:Installation process">Installation process</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Style" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Accuracy" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dual_boot_with_Windows&amp;oldid=670267">https://wiki.archlinux.org/index.php?title=Dual_boot_with_Windows&amp;oldid=670267</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 10 May 2021, at 18:38.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
