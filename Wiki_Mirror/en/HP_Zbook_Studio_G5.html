<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>HP Zbook Studio G5 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-HP_Zbook_Studio_G5 rootpage-HP_Zbook_Studio_G5 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">HP Zbook Studio G5</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> First-person comments, shouldn't be used in articles; content shouldn't be added with "Edit:" prefixes. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:HP_Zbook_Studio_G5">Talk:HP Zbook Studio G5#</a>)</div>
</div>
<p>The HP Zbook Studio G5 is a workstation replacement laptop.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Booting_from_live_media"><span class="tocnumber">1.1</span> <span class="toctext">Booting from live media</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3">
<a href="#Configuration"><span class="tocnumber">2</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Thunderbolt"><span class="tocnumber">2.1</span> <span class="toctext">Thunderbolt</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Graphics_rendering"><span class="tocnumber">2.2</span> <span class="toctext">Graphics rendering</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#External_monitors"><span class="tocnumber">2.3</span> <span class="toctext">External monitors</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Bumblebee"><span class="tocnumber">2.3.1</span> <span class="toctext">Bumblebee</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#Suspend/Hibernate/Resume"><span class="tocnumber">2.4</span> <span class="toctext">Suspend/Hibernate/Resume</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#Troubleshooting"><span class="tocnumber">3</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#CPU_throttling_down_under_load"><span class="tocnumber">3.1</span> <span class="toctext">CPU throttling down under load</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Framerate_drops_to_1_fps_on_discrete_graphics"><span class="tocnumber">3.2</span> <span class="toctext">Framerate drops to 1 fps on discrete graphics</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Framerate_drops_to_1_fps_when_using_external_display"><span class="tocnumber">3.3</span> <span class="toctext">Framerate drops to 1 fps when using external display</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Microphone_not_detected"><span class="tocnumber">3.4</span> <span class="toctext">Microphone not detected</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Brightness_keys_don't_work"><span class="tocnumber">3.5</span> <span class="toctext">Brightness keys don't work</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>Installation is generally pretty straight forward, however, there are some things to consider.
Follow the general instructions of the <a href="../en/Installation_guide.html" title="Installation guide">installation|guide</a>
</p>
<h3><span class="mw-headline" id="Booting_from_live_media">Booting from live media</span></h3>
<p>The laptop does not boot with Nouveau graphics therefore, add this to the grub options
</p>
<pre> i915.modeset=1
 nouveau.modeset=0
</pre>
<p>Edit: I (a different user) found that laptop booted fine with no tweaks for the Manjaro live media, and also had an initially functional display  without these options, when using Discrete graphics mode in BIOS per the original recommendation on this page. That led to nVidia being only GPU visible to OS, and nouveau the selected driver. But then the problem is OS can't see Intel GPU, no i915, etc... ultimately no functionality for video after resuming from suspend/hibernate. So if you want Intel GPU, it first must be enabled in BIOS (Hybrid graphics) and it seems modeset must be enabled for i915, and disabled for nouveau. In short, the recommended configs here are good for regular install too- not just live media. But Nouveau can be made to work with major caveats (e.g. no video after resume).
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Thunderbolt">Thunderbolt</span></h3>
<p>Since the Zbook does not allow a no security option for Thunderbolt in the bios, a thunderbolt manager has
to be installed see <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bolt">bolt</a></span>.
</p>
<h3><span class="mw-headline" id="Graphics_rendering">Graphics rendering</span></h3>
<p>Use "Discrete" graphics in the bios. Auto and Hybrid was showing a blank screen. Installing nvidia drivers on discrete graphics worked flawlessly.
</p>
<p>Edit: "Discrete" graphics in BIOS disables the onboard Intel GPU, so it's not seen in output of inxi -Gxx, and any features you are intending to configure with the i915 module won't work. To get around this, try using "Hybrid" graphics mode in BIOS (which leaves both Intel GPU and vNvidia GPU visible to the OS). This works perfectly (and fixed a problem I had with black screen after resume from suspend or hibernate) when only using the laptop screen. Wanted to get the bare laptop working correctly before I delve into tuning bumblebee and the nVidia driver for external monitors. I will update my recommendation in this section if I have problems there.
</p>
<h3><span class="mw-headline" id="External_monitors">External monitors</span></h3>
<p>All external displays are routed to the Nvidia gpu. The internal display is routed to the internal Intel gpu
therefore, Nvidia drivers or nouveau has to be installed to use external displays. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia">nvidia</a></span>.
</p>
<h4><span class="mw-headline" id="Bumblebee">Bumblebee</span></h4>
<p>To make use of both the onboard graphics and the Nvidia gpu, install bumblebee (and add user to bumblebee group and systemctl start bumblebeed.service).
For an output on the ports connected to the Nvidia chip, the chip always needs to be powered on. To do this change the following options in bumblebee.conf file in /etc/bumblebee.
</p>
<pre> KeepUnusedXServer=true
</pre>
<pre> [driver-nvidia]
 PMMethod=none
</pre>
<p>This prevents the nvidia chip from powering off after turning on.
Next in xorg.conf.nvidia edit the following:
</p>
<pre> Option      "AutoAddDevices" "true"
</pre>
<pre> Option "UseEDID" "true"
 Option "AllowEmptyInitialConfiguration"
 #Option "UseDisplayDevice" "none"
</pre>
<p>Next a virtual output needs to be added to the intel gpu.
Change to the /etc/X11/xorg.conf.d folder and edit or create an entry for the intel gpu (e.g. 20-intel.conf).
</p>
<pre> Section "Device"
     Identifier "intelgpu0"
     Driver "intel"
     Option "VirtualHeads" "1"
 EndSection
</pre>
<p>Thats all the configuration, now to enable external monitor:
</p>
<pre> $ optirun true
 $ intel-virtual-output
</pre>
<ul><li>Recommended to put this in a script and create a desktop entry or similar to quickly enable the external display(s).</li></ul>
<h3>
<span id="Suspend.2FHibernate.2FResume"></span><span class="mw-headline" id="Suspend/Hibernate/Resume">Suspend/Hibernate/Resume</span>
</h3>
<p>Make sure that BIOS has Hybrid enabled (not Discrete) if you want to use the onboard Intel GPU with i915 module.
Follow guidance to enable early KMS for Intel (i915) module. I didn't test without it, but a recommendation to also include intel_agp is functional on my laptop. I didn't test without it. So I have the following line in /etc/mkinitcpio.conf:
MODULES="intel_agp i915"
</p>
<p>This appears to have resolved my issues with suspend/hibernate/resume, at least when external monitors are not part of the picture.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="CPU_throttling_down_under_load">CPU throttling down under load</span></h3>
<p>If your CPU throttles down under high load without reaching critical temperatures (e.g. &gt;95°C) and you're absolutely sure the laptop is not overheating, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=throttled">throttled</a></span> package by <a rel="nofollow" class="external text" href="https://github.com/erpalma/throttled">erpalma on GitHub</a>. Start and enable the service
</p>
<pre>$ lenovo_fix.service
</pre>
<p>This service overrides the package power limit every 5 seconds (30 on battery) by overriding default values in MSR and MCHBAR. A static fix for this problem has not been tested thoroughly. The default configuration works fine, refer to the GitHub page for more information.
</p>
<h3><span class="mw-headline" id="Framerate_drops_to_1_fps_on_discrete_graphics">Framerate drops to 1 fps on discrete graphics</span></h3>
<p>Refer to the <a href="../en/Bumblebee.html#Framerate_drops_to_1_FPS_after_a_fixed_period_of_time" title="Bumblebee">Bumblebee troubleshooting</a> page.
</p>
<h3><span class="mw-headline" id="Framerate_drops_to_1_fps_when_using_external_display">Framerate drops to 1 fps when using external display</span></h3>
<p>In certain applications, eg. Discord, Zoom and Steam, the fps drops to an unusable level when connected to an external display. This is an issue with vsync not working correctly. Try to <a href="../en/Intel_graphics.html#Disable_Vertical_Synchronization_(VSYNC)" title="Intel graphics">disable vsync on the intgrated GPU</a>. If that doesn't work you can try to <a href="../en/PRIME.html#Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME" title="PRIME">disable vsync on the dGPU</a>.
</p>
<h3><span class="mw-headline" id="Microphone_not_detected">Microphone not detected</span></h3>
<p>If your internal microphone is not detected on boot you can force pulseaudio to detect it.
See <a href="../en/PulseAudio/Troubleshooting.html#Microphone_not_detected_by_PulseAudio" title="PulseAudio/Troubleshooting">microphone not detected by Pulseaudio</a>.
</p>
<h3>
<span id="Brightness_keys_don.27t_work"></span><span class="mw-headline" id="Brightness_keys_don't_work">Brightness keys don't work</span>
</h3>
<p>On some bios versions some of your functions keys, namely the brightness up, down and microphone mute keys, produce identical scan codes. You can try to update your bios to fix this. See <a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1784008">[1]</a> for the bug report. If this does not work you can try to perform a <a rel="nofollow" class="external text" href="https://support.hp.com/ph-en/document/c01684768">power reset</a> (see <a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/oem-priority/+bug/1852071/comments/19">[2]</a>). This problem seems to be related to the HP Hotkey Service in Windows, that changes how the keys are handled (see <a rel="nofollow" class="external autonumber" href="https://h30434.www3.hp.com/t5/Notebook-Operating-System-and-Recovery/Brightness-keys-not-working-in-Linux/td-p/7549927">[3]</a>), so after you boot to Windows it might reappear.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:HP.html" title="Category:HP">HP</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=HP_Zbook_Studio_G5&amp;oldid=645746">https://wiki.archlinux.org/index.php?title=HP_Zbook_Studio_G5&amp;oldid=645746</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 16 December 2020, at 16:14.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
