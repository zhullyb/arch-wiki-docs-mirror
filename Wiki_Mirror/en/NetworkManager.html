<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>NetworkManager - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-NetworkManager rootpage-NetworkManager skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">NetworkManager</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li><a href="../en/Network_configuration/Wireless.html" class="mw-redirect" title="Wireless network configuration">Wireless network configuration</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://wiki.gnome.org/Projects/NetworkManager/">NetworkManager</a> is a program for providing detection and configuration for systems to automatically connect to networks. NetworkManager's functionality can be useful for both wireless and wired networks. For wireless networks, NetworkManager prefers known wireless networks and has the ability to switch to the most reliable network.  NetworkManager-aware applications can switch from online and offline mode.  NetworkManager also prefers wired connections over wireless ones, has support for modem connections and certain types of VPN. NetworkManager was originally developed by Red Hat and now is hosted by the <a href="../en/GNOME.html" title="GNOME">GNOME</a> project.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Clear text storage of secrets is not limited to just Wi-Fi passwords. The secrets are stored in files (and folder) only accesible to root. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> By default, Wi-Fi passwords are stored in clear text, see <a href="#Encrypted_Wi-Fi_passwords">#Encrypted Wi-Fi passwords</a>.</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Enable_NetworkManager"><span class="tocnumber">1.1</span> <span class="toctext">Enable NetworkManager</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Additional_interfaces"><span class="tocnumber">1.2</span> <span class="toctext">Additional interfaces</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Mobile_broadband_support"><span class="tocnumber">1.3</span> <span class="toctext">Mobile broadband support</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#PPPoE_/_DSL_support"><span class="tocnumber">1.4</span> <span class="toctext">PPPoE / DSL support</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#VPN_support"><span class="tocnumber">1.5</span> <span class="toctext">VPN support</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#Usage"><span class="tocnumber">2</span> <span class="toctext">Usage</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#nmcli_examples"><span class="tocnumber">2.1</span> <span class="toctext">nmcli examples</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Edit_a_connection"><span class="tocnumber">2.2</span> <span class="toctext">Edit a connection</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#Front-ends"><span class="tocnumber">3</span> <span class="toctext">Front-ends</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#GNOME"><span class="tocnumber">3.1</span> <span class="toctext">GNOME</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#KDE_Plasma"><span class="tocnumber">3.2</span> <span class="toctext">KDE Plasma</span></a></li>
<li class="toclevel-2 tocsection-13">
<a href="#nm-applet"><span class="tocnumber">3.3</span> <span class="toctext">nm-applet</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Appindicator"><span class="tocnumber">3.3.1</span> <span class="toctext">Appindicator</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#networkmanager-dmenu"><span class="tocnumber">3.4</span> <span class="toctext">networkmanager-dmenu</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16">
<a href="#Configuration"><span class="tocnumber">4</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Enable_NetworkManager_Wait_Online"><span class="tocnumber">4.1</span> <span class="toctext">Enable NetworkManager Wait Online</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Set_up_PolicyKit_permissions"><span class="tocnumber">4.2</span> <span class="toctext">Set up PolicyKit permissions</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Proxy_settings"><span class="tocnumber">4.3</span> <span class="toctext">Proxy settings</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Checking_connectivity"><span class="tocnumber">4.4</span> <span class="toctext">Checking connectivity</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Captive_portals"><span class="tocnumber">4.5</span> <span class="toctext">Captive portals</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#DHCP_client"><span class="tocnumber">4.6</span> <span class="toctext">DHCP client</span></a></li>
<li class="toclevel-2 tocsection-23">
<a href="#DNS_management"><span class="tocnumber">4.7</span> <span class="toctext">DNS management</span></a>
<ul>
<li class="toclevel-3 tocsection-24">
<a href="#DNS_caching_and_conditional_forwarding"><span class="tocnumber">4.7.1</span> <span class="toctext">DNS caching and conditional forwarding</span></a>
<ul>
<li class="toclevel-4 tocsection-25">
<a href="#dnsmasq"><span class="tocnumber">4.7.1.1</span> <span class="toctext">dnsmasq</span></a>
<ul>
<li class="toclevel-5 tocsection-26"><a href="#Custom_dnsmasq_configuration"><span class="tocnumber">4.7.1.1.1</span> <span class="toctext">Custom dnsmasq configuration</span></a></li>
<li class="toclevel-5 tocsection-27"><a href="#IPv6"><span class="tocnumber">4.7.1.1.2</span> <span class="toctext">IPv6</span></a></li>
<li class="toclevel-5 tocsection-28"><a href="#DNSSEC"><span class="tocnumber">4.7.1.1.3</span> <span class="toctext">DNSSEC</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-29"><a href="#systemd-resolved"><span class="tocnumber">4.7.1.2</span> <span class="toctext">systemd-resolved</span></a></li>
<li class="toclevel-4 tocsection-30"><a href="#DNS_resolver_with_an_openresolv_subscriber"><span class="tocnumber">4.7.1.3</span> <span class="toctext">DNS resolver with an openresolv subscriber</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-31">
<a href="#Custom_DNS_servers"><span class="tocnumber">4.7.2</span> <span class="toctext">Custom DNS servers</span></a>
<ul>
<li class="toclevel-4 tocsection-32"><a href="#Setting_custom_global_DNS_servers"><span class="tocnumber">4.7.2.1</span> <span class="toctext">Setting custom global DNS servers</span></a></li>
<li class="toclevel-4 tocsection-33">
<a href="#Setting_custom_DNS_servers_in_a_connection"><span class="tocnumber">4.7.2.2</span> <span class="toctext">Setting custom DNS servers in a connection</span></a>
<ul>
<li class="toclevel-5 tocsection-34"><a href="#Setting_custom_DNS_servers_in_a_connection_(GUI)"><span class="tocnumber">4.7.2.2.1</span> <span class="toctext">Setting custom DNS servers in a connection (GUI)</span></a></li>
<li class="toclevel-5 tocsection-35"><a href="#Setting_custom_DNS_servers_in_a_connection_(nmcli_/_connection_file)"><span class="tocnumber">4.7.2.2.2</span> <span class="toctext">Setting custom DNS servers in a connection (nmcli / connection file)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-36">
<a href="#/etc/resolv.conf"><span class="tocnumber">4.7.3</span> <span class="toctext">/etc/resolv.conf</span></a>
<ul>
<li class="toclevel-4 tocsection-37"><a href="#Unmanaged_/etc/resolv.conf"><span class="tocnumber">4.7.3.1</span> <span class="toctext">Unmanaged /etc/resolv.conf</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#Use_openresolv"><span class="tocnumber">4.7.3.2</span> <span class="toctext">Use openresolv</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-39"><a href="#Firewall"><span class="tocnumber">4.8</span> <span class="toctext">Firewall</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-40">
<a href="#Network_services_with_NetworkManager_dispatcher"><span class="tocnumber">5</span> <span class="toctext">Network services with NetworkManager dispatcher</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="#Avoiding_the_dispatcher_timeout"><span class="tocnumber">5.1</span> <span class="toctext">Avoiding the dispatcher timeout</span></a></li>
<li class="toclevel-2 tocsection-42">
<a href="#Dispatcher_examples"><span class="tocnumber">5.2</span> <span class="toctext">Dispatcher examples</span></a>
<ul>
<li class="toclevel-3 tocsection-43"><a href="#Mount_remote_folder_with_sshfs"><span class="tocnumber">5.2.1</span> <span class="toctext">Mount remote folder with sshfs</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="#Mounting_of_SMB_shares"><span class="tocnumber">5.2.2</span> <span class="toctext">Mounting of SMB shares</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#Mounting_of_NFS_shares"><span class="tocnumber">5.2.3</span> <span class="toctext">Mounting of NFS shares</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="#Use_dispatcher_to_automatically_toggle_wireless_depending_on_LAN_cable_being_plugged_in"><span class="tocnumber">5.2.4</span> <span class="toctext">Use dispatcher to automatically toggle wireless depending on LAN cable being plugged in</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="#Use_dispatcher_to_connect_to_a_VPN_after_a_network_connection_is_established"><span class="tocnumber">5.2.5</span> <span class="toctext">Use dispatcher to connect to a VPN after a network connection is established</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#Use_dispatcher_to_disable_IPv6_on_VPN_provider_connections"><span class="tocnumber">5.2.6</span> <span class="toctext">Use dispatcher to disable IPv6 on VPN provider connections</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="#OpenNTPD"><span class="tocnumber">5.2.7</span> <span class="toctext">OpenNTPD</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="#Testing"><span class="tocnumber">6</span> <span class="toctext">Testing</span></a></li>
<li class="toclevel-1 tocsection-51">
<a href="#Tips_and_tricks"><span class="tocnumber">7</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-52">
<a href="#Encrypted_Wi-Fi_passwords"><span class="tocnumber">7.1</span> <span class="toctext">Encrypted Wi-Fi passwords</span></a>
<ul>
<li class="toclevel-3 tocsection-53"><a href="#Using_GNOME_Keyring"><span class="tocnumber">7.1.1</span> <span class="toctext">Using GNOME Keyring</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#Using_KDE_Wallet"><span class="tocnumber">7.1.2</span> <span class="toctext">Using KDE Wallet</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-55"><a href="#Sharing_internet_connection_over_Wi-Fi"><span class="tocnumber">7.2</span> <span class="toctext">Sharing internet connection over Wi-Fi</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="#Sharing_internet_connection_over_Ethernet"><span class="tocnumber">7.3</span> <span class="toctext">Sharing internet connection over Ethernet</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="#Checking_if_networking_is_up_inside_a_cron_job_or_script"><span class="tocnumber">7.4</span> <span class="toctext">Checking if networking is up inside a cron job or script</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#Connect_to_network_with_secret_on_boot"><span class="tocnumber">7.5</span> <span class="toctext">Connect to network with secret on boot</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="#OpenConnect_with_password_in_KWallet"><span class="tocnumber">7.6</span> <span class="toctext">OpenConnect with password in KWallet</span></a></li>
<li class="toclevel-2 tocsection-60"><a href="#Ignore_specific_devices"><span class="tocnumber">7.7</span> <span class="toctext">Ignore specific devices</span></a></li>
<li class="toclevel-2 tocsection-61"><a href="#Configuring_MAC_address_randomization"><span class="tocnumber">7.8</span> <span class="toctext">Configuring MAC address randomization</span></a></li>
<li class="toclevel-2 tocsection-62"><a href="#Enable_IPv6_Privacy_Extensions"><span class="tocnumber">7.9</span> <span class="toctext">Enable IPv6 Privacy Extensions</span></a></li>
<li class="toclevel-2 tocsection-63"><a href="#Working_with_wired_connections"><span class="tocnumber">7.10</span> <span class="toctext">Working with wired connections</span></a></li>
<li class="toclevel-2 tocsection-64"><a href="#Using_iwd_as_the_Wi-Fi_backend"><span class="tocnumber">7.11</span> <span class="toctext">Using iwd as the Wi-Fi backend</span></a></li>
<li class="toclevel-2 tocsection-65"><a href="#Running_in_a_network_namespace"><span class="tocnumber">7.12</span> <span class="toctext">Running in a network namespace</span></a></li>
<li class="toclevel-2 tocsection-66"><a href="#Automatically_connect_to_VPN"><span class="tocnumber">7.13</span> <span class="toctext">Automatically connect to VPN</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-67">
<a href="#Troubleshooting"><span class="tocnumber">8</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-68"><a href="#No_prompt_for_password_of_secured_Wi-Fi_networks"><span class="tocnumber">8.1</span> <span class="toctext">No prompt for password of secured Wi-Fi networks</span></a></li>
<li class="toclevel-2 tocsection-69"><a href="#Network_management_disabled"><span class="tocnumber">8.2</span> <span class="toctext">Network management disabled</span></a></li>
<li class="toclevel-2 tocsection-70"><a href="#Problems_with_internal_DHCP_client"><span class="tocnumber">8.3</span> <span class="toctext">Problems with internal DHCP client</span></a></li>
<li class="toclevel-2 tocsection-71"><a href="#DHCP_problems_with_dhclient"><span class="tocnumber">8.4</span> <span class="toctext">DHCP problems with dhclient</span></a></li>
<li class="toclevel-2 tocsection-72"><a href="#3G_modem_not_detected"><span class="tocnumber">8.5</span> <span class="toctext">3G modem not detected</span></a></li>
<li class="toclevel-2 tocsection-73"><a href="#Switching_off_WLAN_on_laptops"><span class="tocnumber">8.6</span> <span class="toctext">Switching off WLAN on laptops</span></a></li>
<li class="toclevel-2 tocsection-74"><a href="#Static_IP_address_settings_revert_to_DHCP"><span class="tocnumber">8.7</span> <span class="toctext">Static IP address settings revert to DHCP</span></a></li>
<li class="toclevel-2 tocsection-75"><a href="#Cannot_edit_connections_as_normal_user"><span class="tocnumber">8.8</span> <span class="toctext">Cannot edit connections as normal user</span></a></li>
<li class="toclevel-2 tocsection-76"><a href="#Forget_hidden_wireless_network"><span class="tocnumber">8.9</span> <span class="toctext">Forget hidden wireless network</span></a></li>
<li class="toclevel-2 tocsection-77"><a href="#VPN_not_working_in_GNOME"><span class="tocnumber">8.10</span> <span class="toctext">VPN not working in GNOME</span></a></li>
<li class="toclevel-2 tocsection-78"><a href="#Unable_to_connect_to_visible_European_wireless_networks"><span class="tocnumber">8.11</span> <span class="toctext">Unable to connect to visible European wireless networks</span></a></li>
<li class="toclevel-2 tocsection-79"><a href="#Automatic_connect_to_VPN_on_boot_is_not_working"><span class="tocnumber">8.12</span> <span class="toctext">Automatic connect to VPN on boot is not working</span></a></li>
<li class="toclevel-2 tocsection-80"><a href="#Systemd_Bottleneck"><span class="tocnumber">8.13</span> <span class="toctext">Systemd Bottleneck</span></a></li>
<li class="toclevel-2 tocsection-81"><a href="#Regular_network_disconnects,_latency_and_lost_packets_(WiFi)"><span class="tocnumber">8.14</span> <span class="toctext">Regular network disconnects, latency and lost packets (WiFi)</span></a></li>
<li class="toclevel-2 tocsection-82"><a href="#Unable_to_turn_on_wi-fi_with_Lenovo_laptop_(IdeaPad,_Legion,_etc.)"><span class="tocnumber">8.15</span> <span class="toctext">Unable to turn on wi-fi with Lenovo laptop (IdeaPad, Legion, etc.)</span></a></li>
<li class="toclevel-2 tocsection-83"><a href="#Turn_off_hostname_sending"><span class="tocnumber">8.16</span> <span class="toctext">Turn off hostname sending</span></a></li>
<li class="toclevel-2 tocsection-84"><a href="#nm-applet_disappears_in_i3wm"><span class="tocnumber">8.17</span> <span class="toctext">nm-applet disappears in i3wm</span></a></li>
<li class="toclevel-2 tocsection-85"><a href="#nm-applet_tray_icons_display_wrongly"><span class="tocnumber">8.18</span> <span class="toctext">nm-applet tray icons display wrongly</span></a></li>
<li class="toclevel-2 tocsection-86"><a href="#Unit_dbus-org.freedesktop.resolve1.service_not_found"><span class="tocnumber">8.19</span> <span class="toctext">Unit dbus-org.freedesktop.resolve1.service not found</span></a></li>
<li class="toclevel-2 tocsection-87"><a href="#Secrets_were_required,_but_not_provided"><span class="tocnumber">8.20</span> <span class="toctext">Secrets were required, but not provided</span></a></li>
<li class="toclevel-2 tocsection-88"><a href="#WPA_Enterprise_connection_with_NetworkManager"><span class="tocnumber">8.21</span> <span class="toctext">WPA Enterprise connection with NetworkManager</span></a></li>
<li class="toclevel-2 tocsection-89"><a href="#Failed_to_request_VPN_secrets"><span class="tocnumber">8.22</span> <span class="toctext">Failed to request VPN secrets</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-90"><a href="#See_also"><span class="tocnumber">9</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>NetworkManager can be <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">installed</a> with the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span>, which contains a daemon, a command line interface (<code>nmcli</code>) and a curses‐based interface (<code>nmtui</code>). 
</p>
<h3><span class="mw-headline" id="Enable_NetworkManager">Enable NetworkManager</span></h3>
<p>After installation, you should <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>NetworkManager.service</code>. Once the NetworkManager daemon is started, it will automatically connect to any available "system connections" that have already been configured. Any "user connections" or unconfigured connections will need <i>nmcli</i> or an applet to configure and connect.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> is not <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Started">started</a>, an error message will start flooding your logs. See <a href="#Unit_dbus-org.freedesktop.resolve1.service_not_found">#Unit dbus-org.freedesktop.resolve1.service not found</a> for more info.</div>
<h3><span class="mw-headline" id="Additional_interfaces">Additional interfaces</span></h3>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nm-connection-editor">nm-connection-editor</a></span> for a graphical user interface,</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span> for a system tray applet (<code>nm-applet</code>).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You must ensure that no other service that wants to configure the network is running; in fact, multiple networking services will conflict. You can find a list of the currently running services with <code>systemctl --type=service</code> and then <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Stop">stop</a> them. See <a href="#Configuration">#Configuration</a> to enable the NetworkManager service.</div>
<h3><span class="mw-headline" id="Mobile_broadband_support">Mobile broadband support</span></h3>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=modemmanager">modemmanager</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mobile-broadband-provider-info">mobile-broadband-provider-info</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=usb_modeswitch">usb_modeswitch</a></span> packages for mobile broadband connection support. See <a href="../en/USB_3G_Modem.html#NetworkManager" title="USB 3G Modem">USB 3G Modem#NetworkManager</a> for details.
</p>
<h3>
<span id="PPPoE_.2F_DSL_support"></span><span class="mw-headline" id="PPPoE_/_DSL_support">PPPoE / DSL support</span>
</h3>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rp-pppoe">rp-pppoe</a></span> package for PPPoE / DSL connection support. To actually add PPPoE connection, use <code>nm-connection-editor</code> and add new DSL/PPPoE connection.
</p>
<h3><span class="mw-headline" id="VPN_support">VPN support</span></h3>
<p>NetworkManager since version 1.16 has native support for <a href="../en/WireGuard.html" title="WireGuard">WireGuard</a>, all it needs is the <code>wireguard</code> kernel module. Read the <a rel="nofollow" class="external text" href="https://blogs.gnome.org/thaller/2019/03/15/wireguard-in-networkmanager/">WireGuard in NetworkManager blog post</a> for details.
</p>
<p>Support for other VPN types is based on a plug-in system. They are provided in the following packages:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openconnect">networkmanager-openconnect</a></span> for <a href="../en/OpenConnect.html" title="OpenConnect">OpenConnect</a>
</li>
<li>
<a href="../en/Networkmanager-openvpn.html" title="Networkmanager-openvpn">networkmanager-openvpn</a> for <a href="../en/OpenVPN.html" title="OpenVPN">OpenVPN</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-pptp">networkmanager-pptp</a></span> for <a href="../en/PPTP_Client.html" title="PPTP Client">PPTP Client</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-vpnc">networkmanager-vpnc</a></span> for <a href="../en/Vpnc.html" title="Vpnc">Vpnc</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-strongswan">networkmanager-strongswan</a></span> for <a href="../en/StrongSwan.html" title="StrongSwan">strongSwan</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-fortisslvpn-git/">networkmanager-fortisslvpn-git</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-iodine-git/">networkmanager-iodine-git</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-libreswan/">networkmanager-libreswan</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-l2tp/">networkmanager-l2tp</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-ssh-git/">networkmanager-ssh-git</a></span><sup><small>AUR</small></sup>
</li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-sstp">network-manager-sstp</a></span></li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> There are a lot of <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues?search=VPN&amp;state=opened">bugs</a> (and <a rel="nofollow" class="external text" href="https://bugzilla.gnome.org/buglist.cgi?bug_status=__open__&amp;content=VPN&amp;product=NetworkManager">old bugs</a>) related to VPN support. Check the daemon processes options set via the GUI correctly and double-check with each package release.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To have fully functioning DNS resolution when using VPN, you should set up <a href="#DNS_caching_and_conditional_forwarding">conditional forwarding</a>.</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>NetworkManager comes with <span class="plainlinks archwiki-template-man" title="$ man 1 nmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmcli.1">nmcli(1)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 nmtui"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmtui.1">nmtui(1)</a></span>.
</p>
<h3><span class="mw-headline" id="nmcli_examples">nmcli examples</span></h3>
<p>List nearby wifi networks:
</p>
<pre>$ nmcli device wifi list
</pre>
<p>Connect to a wifi network:
</p>
<pre>$ nmcli device wifi connect <i>SSID_or_BSSID</i> password <i>password</i>
</pre>
<p>Connect to a hidden network:
</p>
<pre>$ nmcli device wifi connect <i>SSID_or_BSSID</i> password <i>password</i> hidden yes
</pre>
<p>Connect to a wifi on the <code>wlan1</code> wifi interface:
</p>
<pre>$ nmcli device wifi connect <i>SSID_or_BSSID</i> password <i>password</i> ifname wlan1 <i>profile_name</i>
</pre>
<p>Disconnect an interface:
</p>
<pre>$ nmcli device disconnect ifname eth0
</pre>
<p>Reconnect an interface marked as disconnected:
</p>
<pre>$ nmcli connection up uuid <i>UUID</i>
</pre>
<p>Get a list of UUIDs:
</p>
<pre>$ nmcli connection show
</pre>
<p>See a list of network devices and their state:
</p>
<pre>$ nmcli device
</pre>
<p>Turn off wifi:
</p>
<pre>$ nmcli radio wifi off
</pre>
<h3><span class="mw-headline" id="Edit_a_connection">Edit a connection</span></h3>
<p>For a comprehensive list of settings, see <span class="plainlinks archwiki-template-man" title="$ man 5 nm-settings"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nm-settings.5">nm-settings(5)</a></span>.
</p>
<p>Firstly you need to get list of connections:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nmcli connection</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME                UUID                                  TYPE      DEVICE
Wired connection 2  e7054040-a421-3bef-965d-bb7d60b7cecf  ethernet  enp5s0
Wired connection 1  997f2782-f0fc-301d-bfba-15421a2735d8  ethernet  enp0s25
MY-HOME-WIFI-5G     92a0f7b3-2eba-49ab-a899-24d83978f308  wifi       --
</pre>
<p>Here you can use the first column as connection-id used later. In this example we pick <code>Wired connection 2</code> as a connection-id.
</p>
<p>You have three methods to configure a connection <code>Wired connection 2</code> after it has been created:
</p>
<dl>
<dt>nmcli interactive editor</dt>
<dd>
<code>nmcli connection edit 'Wired connection 2'</code>.<br> Usage is well documented from the editor.</dd>
</dl>
<dl>
<dt>nmcli command line interface</dt>
<dd>
<code>nmcli connection modify 'Wired connection 2' <i>setting</i>.<i>property</i> <i>value</i></code>. See <span class="plainlinks archwiki-template-man" title="$ man 1 nmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmcli.1">nmcli(1)</a></span> for usage. For example you can change its IPv4 route metric to 200 using <code>nmcli connection modify 'Wired connection 2' ipv4.route-metric 200</code> command.</dd>
</dl>
<p>To remove a setting pass an empty field ("") to it like this:
</p>
<dl><dd><code>nmcli connection modify 'Wired connection 2' <i>setting</i>.<i>property</i> ""</code></dd></dl>
<dl>
<dt>Connection file</dt>
<dd>In <code>/etc/NetworkManager/system-connections/</code>, modify the corresponding <code>Wired connection 2.nmconnection</code> file .<br> Do not forget to reload the configuration file with <code>nmcli connection reload</code>.</dd>
</dl>
<h2><span class="mw-headline" id="Front-ends">Front-ends</span></h2>
<p>To configure and have easy access to NetworkManager, most users will want to install an applet. This GUI front-end usually resides in the system tray (or notification area) and allows network selection and configuration of NetworkManager. Various desktop environments have their own applet. Otherwise you can use <a href="#nm-applet">#nm-applet</a>.
</p>
<h3><span class="mw-headline" id="GNOME">GNOME</span></h3>
<p><a href="../en/GNOME.html" title="GNOME">GNOME</a> has a built-in tool, accessible from the Network settings.
</p>
<h3><span class="mw-headline" id="KDE_Plasma">KDE Plasma</span></h3>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plasma-nm">plasma-nm</a></span> package. After that, add it to the KDE taskbar via the <i>Panel options &gt; Add widgets &gt; Networks</i> menu.
</p>
<h3><span class="mw-headline" id="nm-applet">nm-applet</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span> is a GTK 3 front-end which works under Xorg environments with a systray.
</p>
<p>To store connection secrets install and configure <a href="../en/GNOME/Keyring.html" title="GNOME/Keyring">GNOME/Keyring</a>.
</p>
<p>Be aware that after enabling the tick-box option <code>Make available to other users</code> for a connection, NetworkManager stores the password in plain-text, though the respective file is accessible only to root (or other users via <code>nm-applet</code>). See <a href="#Encrypted_Wi-Fi_passwords">#Encrypted Wi-Fi passwords</a>.
</p>
<p>In order to run <code>nm-applet</code> without a systray, you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=trayer">trayer</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=stalonetray">stalonetray</a></span>. For example, you can add a script like this one in your path:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">nmgui</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
nm-applet    2&gt;&amp;1 &gt; /dev/null &amp;
stalonetray  2&gt;&amp;1 &gt; /dev/null
killall nm-applet
</pre>
<p>When you close the <i>stalonetray</i> window, it closes <code>nm-applet</code> too, so no extra memory is used once you are done with network settings.
</p>
<p>The applet can show notifications for events such as connecting to or disconnecting from a WiFi network. For these notifications to display, ensure that you have a notification server installed - see <a href="../en/Desktop_notifications.html" title="Desktop notifications">Desktop notifications</a>. If you use the applet without a notification server, you might see some messages in stdout/stderr, and the app might hang. See <a rel="nofollow" class="external autonumber" href="https://bugzilla.gnome.org/show_bug.cgi?id=788313">[1]</a>.
</p>
<p>In order to run <code>nm-applet</code> with such notifications disabled, start the applet with the following command:
</p>
<pre>$ nm-applet --no-agent
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <code>nm-applet</code> might be started automatically with a <a href="../en/XDG_Autostart.html" title="XDG Autostart">autostart desktop file</a>, to add the --no-agent option modify the Exec line there, i.e.
<pre>Exec=nm-applet --no-agent</pre>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> On <a href="../en/I3.html" title="I3">i3</a>, if nm-applet is started with the <code>--no-agent</code> option, it is not possible to connect to a new encrypted WiFi network by clicking on the item list because no password input dialogue window will pop out. <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a> will show <code>no secrets: No agents were available for this request</code>.</div>
<h4><span class="mw-headline" id="Appindicator">Appindicator</span></h4>
<p>As of version 1.18.0 Appindicator support is <a rel="nofollow" class="external text" href="https://github.com/archlinux/svntogit-packages/commit/7640a2bd557fe84813207ef4d5e35bb5aece6c54">available</a> in the official <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=network-manager-applet">network-manager-applet</a></span> package. To use nm-applet in an Appindicator environment start the applet with the following command:
</p>
<pre>$ nm-applet --indicator
</pre>
<h3><span class="mw-headline" id="networkmanager-dmenu">networkmanager-dmenu</span></h3>
<p>Alternatively there is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dmenu-git/">networkmanager-dmenu-git</a></span><sup><small>AUR</small></sup> which is a small script to manage NetworkManager connections with <a href="../en/Dmenu.html" title="Dmenu">dmenu</a> or <a href="../en/Rofi.html" title="Rofi">rofi</a> instead of <code>nm-applet</code>. It provides all essential features such as connection to existing NetworkManager wifi or wired connections, connect to new wifi connections, requests passphrase if required, connect to existing VPN connections, enable/disable networking, launch <i>nm-connection-editor</i> GUI, connect to Bluetooth networks.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>NetworkManager will require some additional steps to be able run properly. Make sure you have configured <code>/etc/hosts</code> as described in <a href="../en/Network_configuration.html#Set_the_hostname" title="Network configuration">Network configuration#Set the hostname</a> section.
</p>
<p>NetworkManager has a global configuration file at <code>/etc/NetworkManager/NetworkManager.conf</code>. Additional configuration files can be placed in <code>/etc/NetworkManager/conf.d/</code>. Usually no configuration needs to be done to the global defaults.
</p>
<p>After editing a configuration file, the changes can be applied by running:
</p>
<pre># nmcli general reload
</pre>
<h3><span class="mw-headline" id="Enable_NetworkManager_Wait_Online">Enable NetworkManager Wait Online</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>NetworkManager.service</code> has <code>Also=NetworkManager-wait-online.service</code> in the <code>[Install]</code> section.<a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/commit/167e42a87e97ed7fb26a4263c22f1774716ac51b">[2]</a> If <code>NetworkManager.service</code> was <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enabled</a> before the change, it needs to be <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">reenabled</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p>If you have services which fail if they are started before the network is up, you may use <code>NetworkManager-wait-online.service</code> in addition to <code>NetworkManager.service</code>. This is, however, rarely necessary because most networked daemons start up okay, even if the network has not been configured yet.
</p>
<p>In some cases, the service will still fail to start successfully on boot due to the timeout setting in <code>/usr/lib/systemd/system/NetworkManager-wait-online.service</code> being too short. Change the default timeout from 30 to a higher value.
</p>
<h3><span class="mw-headline" id="Set_up_PolicyKit_permissions">Set up PolicyKit permissions</span></h3>
<p>See <a href="../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">General troubleshooting#Session permissions</a> for setting up a working session.
</p>
<p>With a working session, you have several options for granting the necessary privileges to NetworkManager:
</p>
<ul>
<li>
<i>Option 1.</i> Run a <a href="../en/Polkit.html" title="Polkit">Polkit</a> authentication agent when you log in, such as <code>/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1</code> (part of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=polkit-gnome">polkit-gnome</a></span>).  You will be prompted for your password whenever you add or remove a network connection.</li>
<li>
<i>Option 2.</i> <a href="../en/Users_and_groups.html#Group_management" title="Users and groups">Add</a> yourself to the <code>wheel</code> group.  You will not have to enter your password, but your user account may be granted other permissions as well, such as the ability to use <a href="../en/Sudo.html" title="Sudo">sudo</a> without entering the root password.</li>
<li>
<i>Option 3.</i> <a href="../en/Users_and_groups.html#Group_management" title="Users and groups">Add</a> yourself to the <code>network</code> group and create the following file:</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/polkit-1/rules.d/50-org.freedesktop.NetworkManager.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">polkit.addRule(function(action, subject) {
  if (action.id.indexOf("org.freedesktop.NetworkManager.") == 0 &amp;&amp; subject.isInGroup("network")) {
    return polkit.Result.YES;
  }
});
</pre>
<dl><dd>All users in the <code>network</code> group will be able to add and remove networks without a password. This will not work under <a href="../en/Systemd.html" title="Systemd">systemd</a> if you do not have an active session with <i>systemd-logind</i>.</dd></dl>
<h3><span class="mw-headline" id="Proxy_settings">Proxy settings</span></h3>
<p>NetworkManager does not directly handle proxy settings, but if you are using <a href="../en/GNOME.html" title="GNOME">GNOME</a> or <a href="../en/KDE.html" title="KDE">KDE</a>, you could use <a rel="nofollow" class="external text" href="http://marin.jb.free.fr/proxydriver/">proxydriver</a> which handles proxy settings using NetworkManager's information. proxydriver is found in the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/proxydriver/">proxydriver</a></span><sup><small>AUR</small></sup>.
</p>
<p>In order for <i>proxydriver</i> to be able to change the proxy settings, you would need to execute this command, as part of the GNOME startup process (see <a href="../en/GNOME.html#Autostart" title="GNOME">GNOME#Autostart</a>).
</p>
<pre>xhost +si:localuser:<i>username</i>
</pre>
<p>See also <a href="../en/Proxy_server.html" class="mw-redirect" title="Proxy settings">Proxy settings</a>.
</p>
<h3><span class="mw-headline" id="Checking_connectivity">Checking connectivity</span></h3>
<p>NetworkManager can try to reach a page on Internet when connecting to a network. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span> is configured by default in <code>/usr/lib/NetworkManager/conf.d/20-connectivity.conf</code> to check connectivity to archlinux.org. To use a different webserver or disable connectivity checking create <code>/etc/NetworkManager/conf.d/20-connectivity.conf</code>, see <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5#CONNECTIVITY_SECTION">NetworkManager.conf(5) § CONNECTIVITY SECTION</a></span>. Below is an example of using GNOME servers (it does not require the use of <a href="../en/GNOME.html" title="GNOME">GNOME</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/20-connectivity.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[connectivity]
uri=http://nmcheck.gnome.org/check_network_status.txt
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Although automatic connectivity checks are a potential privacy leak, the official archlinux.org default connectivity URL is committed to not logging any access. See <a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/archlinux/infrastructure/-/commit/68fbaca2ef9f31f624f117899848f4288d6b39d1">[3]</a>.</div>
<h3><span class="mw-headline" id="Captive_portals">Captive portals</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Complex scripts should not be maintained on the wiki. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p>For those behind a <a href="https://en.wikipedia.org/wiki/Captive_portal" class="extiw" title="wikipedia:Captive portal">captive portal</a>, the desktop manager may automatically open a window asking for credentials. If your desktop does not, you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=capnet-assist">capnet-assist</a></span> package (however, it currently it has a broken NetworkManager dispatcher script). Alternatively, you can create a NetworkManager dispatcher script with the following content:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/90-open_captive_portal</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh -e
# Script to dispatch NetworkManager events
#
# Runs shows a login webpage on walled garden networks.
# See NetworkManager(8) for further documentation of the dispatcher events.

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

if [ -x "/usr/bin/logger" ]; then
    logger="/usr/bin/logger -s -t captive-portal"
else
    logger=":"
fi

wait_for_process() {
    PNAME=$1
    while [ -z "$(/usr/bin/pgrep $PNAME)" ]; do
        sleep 3;
    done
}

#launch the browser, but on boot we need to wait that nm-applet starts
start_browser() {
    local user="$1"
    local display="$2"

    export DISPLAY="$display"
    wait_for_process nm-applet

    export XAUTHORITY="/home/$user/.Xauthority"

    $logger "Running browser as '$user' with display '$display' to login in captive portal"
    sudo -u "$user" --preserve-env=DISPLAY,XAUTHORITY -H xdg-open http://capnet.elementary.io 2&gt;&amp;1 &gt; /dev/null
}

# Run the right scripts
case "$2" in
    connectivity-change)
    $logger -p user.debug "dispatcher script triggered on connectivity change: $CONNECTIVITY_STATE"
    if [ "$CONNECTIVITY_STATE" = "PORTAL" ]; then
        # Match last column of who's output with ' :[at least one digit] '
        who | awk '$NF ~ /\(:[0-9]+\)/ { print $1 " " substr($NF, 2, length($NF)-2) };' | \
        while read user display; do
            start_browser $user $display || $logger -p user.err "Failed for user: '$user' display: '$display'"
        done
    fi
    ;;
    *)
    # In a down phase
    exit 0
    ;;
esac
</pre>
<p>You will need to <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>NetworkManager.service</code> or reboot for this to start working. Once you do, the dispatcher script should open a login window once it detects you are behind a captive portal.
</p>
<p>Another solution is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/captive-browser-git/">captive-browser-git</a></span><sup><small>AUR</small></sup> based on Google Chrome.
</p>
<h3><span class="mw-headline" id="DHCP_client">DHCP client</span></h3>
<p>By default NetworkManager uses its internal DHCP client. The internal DHCPv4 plugin is based on the <a rel="nofollow" class="external text" href="https://nettools.github.io/n-dhcp4/">nettools' n-dhcp4</a> library, while the internal DHCPv6 plugin is made from code based on systemd-networkd.
</p>
<p>To use ISC’s DHCP client, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>. To change the DHCP client backend, set the option <code>main.dhcp=<i>dhcp_client_name</i></code> with a configuration file in <code>/etc/NetworkManager/conf.d/</code>. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/dhcp-client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
dhcp=dhclient</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Do not enable the systemd units shipped with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> packages. They will conflict with NetworkManager, see the note in <a href="#Installation">#Installation</a> for details.</li>
<li>NetworkManger does not support dhcpcd ≥ 9.0.0. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/66231">FS#66231</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="DNS_management">DNS management</span></h3>
<p>NetworkManager's DNS management is described in the GNOME project's wiki page—<a rel="nofollow" class="external text" href="https://wiki.gnome.org/Projects/NetworkManager/DNS">Projects/NetworkManager/DNS</a>.
</p>
<h4><span class="mw-headline" id="DNS_caching_and_conditional_forwarding">DNS caching and conditional forwarding</span></h4>
<p>NetworkManager has a plugin to enable DNS caching and conditional forwarding (<a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/merge_requests/143">previously</a> called "split DNS" in NetworkManager's documentation) using <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> or <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a>. The advantages of this setup is that DNS lookups will be cached, shortening resolve times, and DNS lookups of VPN hosts will be routed to the relevant VPN's DNS servers. This is especially useful if you are connected to more than one VPN.
</p>
<h5><span class="mw-headline" id="dnsmasq">dnsmasq</span></h5>
<p>Make sure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span> has been installed. Then set <code>main.dns=dnsmasq</code> with a configuration file in <code>/etc/NetworkManager/conf.d/</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/dns.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
dns=dnsmasq</pre>
<p>Now run <code>nmcli general reload</code> as root. NetworkManager will automatically start dnsmasq and add <code>127.0.0.1</code> to <code>/etc/resolv.conf</code>. The original DNS servers can be found in <code>/run/NetworkManager/no-stub-resolv.conf</code>. You can verify dnsmasq is being used by doing the same DNS lookup twice with <code>drill example.com</code> and verifying the server and query times.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>You do not need to start <code>dnsmasq.service</code> or edit <code>/etc/dnsmasq.conf</code>. NetworkManager will start dnsmasq without using the systemd service and without reading the dnsmasq's default configuration file(s).</li>
<li>The dnsmasq instance started by NetworkManager will bind to <code>127.0.0.1:53</code>, you cannot run any other software (including <code>dnsmasq.service</code>) on the same address and port.</li>
</ul>
</div>
<h6><span class="mw-headline" id="Custom_dnsmasq_configuration">Custom dnsmasq configuration</span></h6>
<p>Custom configurations can be created for <i>dnsmasq</i> by creating configuration files in <code>/etc/NetworkManager/dnsmasq.d/</code>. For example, to change the size of the DNS cache (which is stored in RAM):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dnsmasq.d/cache.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cache-size=1000</pre>
<p>You can check the configuration file syntax with:
</p>
<pre>dnsmasq --test --conf-file=/dev/null --conf-dir=/etc/NetworkManager/dnsmasq.d
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 dnsmasq"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dnsmasq.8">dnsmasq(8)</a></span> for all available options.
</p>
<h6><span class="mw-headline" id="IPv6">IPv6</span></h6>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This does not solve the issue because NetworkManager does not add <code>::1</code> to <code>/etc/resolv.conf</code>. Unless <code>@::1</code> is manually passed to drill, it will still fail with <code>Error: error sending query: No (valid) nameservers defined in the resolver</code>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p>Enabling <code>dnsmasq</code> in NetworkManager may break IPv6-only DNS lookups (i.e. <code>drill -6 [hostname]</code>) which would otherwise work. In order to resolve this, creating the following file will configure <i>dnsmasq</i> to also listen to the IPv6 loopback:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dnsmasq.d/ipv6-listen.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen-address=::1</pre>
<p>In addition, <code>dnsmasq</code> also does not prioritize upstream IPv6 DNS. Unfortunately NetworkManager does not do this (<a rel="nofollow" class="external text" href="https://bugs.launchpad.net/ubuntu/+source/network-manager/+bug/936712">Ubuntu Bug</a>). A workaround would be to disable IPv4 DNS in the NetworkManager config, assuming one exists.
</p>
<h6><span class="mw-headline" id="DNSSEC">DNSSEC</span></h6>
<p>The dnsmasq instance started by NetworkManager by default will not validate <a href="../en/DNSSEC.html" title="DNSSEC">DNSSEC</a> since it is started with the <code>--proxy-dnssec</code> option. It will trust whatever DNSSEC information it gets from the upstream DNS server.
</p>
<p>For dnsmasq to properly validate DNSSEC, thus breaking DNS resolution with name servers that do not support it, create the following configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dnsmasq.d/dnssec.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">conf-file=/usr/share/dnsmasq/trust-anchors.conf
dnssec</pre>
<h5><span class="mw-headline" id="systemd-resolved">systemd-resolved</span></h5>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> NetworkManager 1.16 adds a new setting <code>main.systemd-resolved</code><a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/commit/d4eb4cb45f41b1751cacf71da558bf8f0988f383">[4]</a> (enabled by default). It unconditionally sends DNS configuration to systemd-resolved. Related to "Preserving resolv.conf" from <a href="../en/Systemd-resolved.html#DNS" title="Systemd-resolved">systemd-resolved#DNS</a>? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p>NetworkManager can use <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> as a DNS resolver and cache. Make sure that <i>systemd-resolved</i> is properly configured and that <code>systemd-resolved.service</code> is <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Started">started</a> before using it.
</p>
<p>systemd-resolved will be used automatically if <code>/etc/resolv.conf</code> is a <a href="../en/Systemd-resolved.html#DNS" title="Systemd-resolved">symlink</a> to <code>/run/systemd/resolve/stub-resolv.conf</code>, <code>/run/systemd/resolve/resolv.conf</code> or <code>/usr/lib/systemd/resolv.conf</code>.
</p>
<p>You can enable it explicitly by setting <code>main.dns=systemd-resolved</code> with a configuration file in <code>/etc/NetworkManager/conf.d/</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/dns.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
dns=systemd-resolved</pre>
<h5><span class="mw-headline" id="DNS_resolver_with_an_openresolv_subscriber">DNS resolver with an openresolv subscriber</span></h5>
<p>If <a href="../en/Openresolv.html" title="Openresolv">openresolv</a> has a subscriber for your local <a href="../en/Domain_name_resolution.html#DNS_servers" class="mw-redirect" title="DNS resolver">DNS resolver</a>, set up the subscriber and <a href="#Use_openresolv">configure NetworkManager to use openresolv</a>.
</p>
<p>Because NetworkManager advertises a single "interface" to <i>resolvconf</i>, it is not possible to implement conditional forwarding between two NetworkManager connections. See <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues/153">NetworkManager issue 153</a>.
</p>
<p>This can be partially mitigated if you set <code>private_interfaces="*"</code> in <code>/etc/resolvconf.conf</code><a rel="nofollow" class="external autonumber" href="https://roy.marples.name/projects/openresolv/configuration/">[5]</a>. Any queries for domains that are not in search domain list will not get forwarded. They will be handled according to the local resolver's configuration, for example, forwarded to another DNS server or resolved recursively from the DNS root.
</p>
<h4><span class="mw-headline" id="Custom_DNS_servers">Custom DNS servers</span></h4>
<h5><span class="mw-headline" id="Setting_custom_global_DNS_servers">Setting custom global DNS servers</span></h5>
<p>To set DNS servers for all connections, specify them in <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5">NetworkManager.conf(5)</a></span> using the syntax <code>servers=<i>serveripaddress1</i>,<i>serveripaddress2</i>,<i>serveripaddress3</i></code> in a section named <code>[global-dns-domain-*]</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/dns-servers.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global-dns-domain-*]
servers=::1,127.0.0.1</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you use <a href="#DNS_caching_and_conditional_forwarding">NetworkManager's dnsmasq or systemd-resolved plugin</a> or <a href="#DNS_resolver_with_an_openresolv_subscriber">openresolv subscribers</a>, then do not specify loopback addresses with the <code>servers=</code> option, it can break DNS resolution.</li>
<li>The specified servers do not get sent to <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a>, the connection's DNS servers are used instead.</li>
</ul>
</div>
<h5><span class="mw-headline" id="Setting_custom_DNS_servers_in_a_connection">Setting custom DNS servers in a connection</span></h5>
<h6>
<span id="Setting_custom_DNS_servers_in_a_connection_.28GUI.29"></span><span class="mw-headline" id="Setting_custom_DNS_servers_in_a_connection_(GUI)">Setting custom DNS servers in a connection (GUI)</span>
</h6>
<p>Setup will depend on the type of front-end used; the process usually involves right-clicking on the applet, editing (or creating) a profile, and then choosing DHCP type as <i>Automatic (specify addresses)</i>. The DNS addresses will need to be entered and are usually in this form: <code>127.0.0.1, <i>DNS-server-one</i>, ...</code>.
</p>
<h6>
<span id="Setting_custom_DNS_servers_in_a_connection_.28nmcli_.2F_connection_file.29"></span><span class="mw-headline" id="Setting_custom_DNS_servers_in_a_connection_(nmcli_/_connection_file)">Setting custom DNS servers in a connection (nmcli / connection file)</span>
</h6>
<p>To setup DNS Servers per connection, you can use the <code>dns</code> field (and the associated <code>dns-search</code> and <code>dns-options</code>) in the <a href="#Edit_a_connection">connection settings</a>. 
</p>
<p>If <code>method</code> is set to <code>auto</code> (when you use DHCP), you need to set <code>ignore-auto-dns</code> to <code>yes</code>.
</p>
<h4>
<span id=".2Fetc.2Fresolv.conf"></span><span class="mw-headline" id="/etc/resolv.conf">/etc/resolv.conf</span>
</h4>
<p>NetworkManager's <code>/etc/resolv.conf</code> management mode is configured with the <code>main.rc-manager</code> setting. The default <code>auto</code> mode chooses how <code>/etc/resolv.conf</code> is managed in the following order:
</p>
<ul>
<li>If <code>/etc/resolv.conf</code> is <a href="../en/File_permissions_and_attributes.html#File_attributes" title="File permissions and attributes">immutable</a>, then the file <a href="#Unmanaged_/etc/resolv.conf">is not touched at all</a>. This is the equivalent of <code>main.rc-manager=unmanaged</code>.</li>
<li>If <code>/etc/resolv.conf</code> is a symlink to <code>/run/systemd/resolve/stub-resolv.conf</code>, <code>/run/systemd/resolve/resolv.conf</code> or <code>/usr/lib/systemd/resolv.conf</code>, then <a href="#systemd-resolved">systemd-resolved is used</a>. This is the equivalent of <code>main.rc-manager=systemd-resolved</code>.</li>
<li>If <code>/usr/bin/resolvconf</code> exists, then <a href="#Use_openresolv">resolvconf is used</a>. This is the equivalent of <code>main.rc-manager=resolvconf</code>.</li>
<li>If <code>/etc/resolv.conf</code> is a regular file, then NetworkManager writes to it directly. This is the equivalent of <code>main.rc-manager=file</code>.</li>
</ul>
<p>Further details are provided in the <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.5">NetworkManager(5)</a></span> man page.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Using openresolv allows NetworkManager to coexists with other <i>resolvconf</i> supporting software or, for example, to run a local DNS caching and split-DNS resolver for which openresolv has a <a href="../en/Openresolv.html#Subscribers" title="Openresolv">subscriber</a>. Note that conditional forwarding is <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues/153">not yet fully supported</a> when using NetworkManager with openresolv.</div>
<p><i>NetworkManager</i> also offers hooks via so called dispatcher scripts that can be used to alter the <code>/etc/resolv.conf</code> after network changes. See <a href="#Network_services_with_NetworkManager_dispatcher">#Network services with NetworkManager dispatcher</a> and <span class="plainlinks archwiki-template-man" title="$ man 8 NetworkManager"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.8">NetworkManager(8)</a></span> for more information.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If NetworkManager is configured to use either <a href="#dnsmasq">dnsmasq</a> or <a href="#systemd-resolved">systemd-resolved</a>, then the appropriate loopback addresses will be written to <code>/etc/resolv.conf</code>.</li>
<li>The <code>resolv.conf</code> file NetworkManager writes or would write to <code>/etc/resolv.conf</code> can be found at <code>/run/NetworkManager/resolv.conf</code>.</li>
<li>A <code>resolv.conf</code> file with the acquired name servers and search domains can be found at <code>/run/NetworkManager/no-stub-resolv.conf</code>.</li>
</ul>
</div>
<h5>
<span id="Unmanaged_.2Fetc.2Fresolv.conf"></span><span class="mw-headline" id="Unmanaged_/etc/resolv.conf">Unmanaged /etc/resolv.conf</span>
</h5>
<p>To stop NetworkManager from touching <code>/etc/resolv.conf</code>, set <code>main.dns=none</code> with a configuration file in <code>/etc/NetworkManager/conf.d/</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/dns.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
dns=none</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You might also want to set <code>main.systemd-resolved=false</code>, so that NetworkManager does not send the DNS configuration to <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="#DNS_caching_and_conditional_forwarding">#DNS caching and conditional forwarding</a>, to configure NetworkManager using other DNS backends like <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> and <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a>, instead of using <code>main.dns=none</code>.</div>
<p>After that <code>/etc/resolv.conf</code> might be a broken symlink that you will need to remove. Then, just create a new <code>/etc/resolv.conf</code> file.
</p>
<h5><span class="mw-headline" id="Use_openresolv">Use openresolv</span></h5>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> NetworkManager will automatically use <i>resolvconf</i> unless <code>/etc/resolv.conf</code> is immutable or a symlink to one of systemd-resolved's <code>resolv.conf</code> files.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> NetworkManager does not support using systemd-resolved's <i>resolvconf</i> interface (<span class="plainlinks archwiki-template-man" title="$ man 1 resolvectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/resolvectl.1#COMPATIBILITY_WITH_RESOLVCONF(8)">resolvectl(1) § COMPATIBILITY WITH RESOLVCONF(8)</a></span>) which is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-resolvconf">systemd-resolvconf</a></span>.
<ul>
<li>Do not set <code>main.rc-manager=resolvconf</code> when using <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a>, instead make sure to <a href="../en/Systemd-resolved.html#DNS" title="Systemd-resolved">correctly create the /etc/resolv.conf symlink</a> or <a href="#systemd-resolved">configure NetworkManager to use systemd-resolved explicitly</a>.</li>
<li>Make sure the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-resolvconf">systemd-resolvconf</a></span> package is not installed when systemd-resolved is not used. Unless <code>systemd-resolved.service</code> started, it will break all networking software (not just NetworkManager) that use resolvconf.</li>
</ul>
</div>
<p>To explicitly configure NetworkManager to use <a href="../en/Openresolv.html" title="Openresolv">openresolv</a>, set <code>main.rc-manager=resolvconf</code> with a configuration file in <code>/etc/NetworkManager/conf.d/</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/rc-manager.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
rc-manager=resolvconf</pre>
<h3><span class="mw-headline" id="Firewall">Firewall</span></h3>
<p>You can assign a <a href="../en/Firewalld.html" title="Firewalld">firewalld</a> zone based on your current connection. For example a restrictive firewall when at work, and a less restrictive one when at home.
</p>
<p>This can also be done with <a href="#Network_services_with_NetworkManager_dispatcher">NetworkManager dispatcher</a>.
</p>
<h2><span class="mw-headline" id="Network_services_with_NetworkManager_dispatcher">Network services with NetworkManager dispatcher</span></h2>
<p>There are quite a few network services that you will not want running until NetworkManager brings up an interface. NetworkManager has the ability to start services when you connect to a network and stop them when you disconnect (e.g. when using <a href="../en/NFS.html" title="NFS">NFS</a>, <a href="../en/Samba.html" class="mw-redirect" title="SMB">SMB</a> and <a href="../en/Network_Time_Protocol_daemon.html" class="mw-redirect" title="NTPd">NTPd</a>).
</p>
<p>To activate the feature you need to <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> the <code>NetworkManager-dispatcher.service</code>.
</p>
<p>Once the service is active, scripts can be added to the <code>/etc/NetworkManager/dispatcher.d</code> directory.
</p>
<p>Scripts must be owned by <b>root</b>, otherwise the dispatcher will not execute them. For added security, set group <a href="../en/File_permissions_and_attributes.html#Changing_ownership" class="mw-redirect" title="Ownership">ownership</a> to root as well:
</p>
<pre># chown root:root /etc/NetworkManager/dispatcher.d/<i>10-script.sh</i>
</pre>
<p>Make sure the file has correct permissions:
</p>
<pre># chmod 755 /etc/NetworkManager/dispatcher.d/<i>10-script.sh</i>
</pre>
<p>The scripts will be run in alphabetical order at connection time, and in reverse alphabetical order at disconnect time. To ensure what order they come up in, it is common to use numerical characters prior to the name of the script (e.g. <code>10-portmap</code> or <code>30-netfs</code> (which ensures that the <i>portmapper</i> is up before NFS mounts are attempted).
</p>
<p>Scripts will receive the following arguments:
</p>
<ul>
<li>
<b>Interface name:</b> e.g. <code>eth0</code>
</li>
<li>
<b>Interface status:</b> <i>up</i> or <i>down</i>
</li>
<li>
<b>VPN status:</b> <i>vpn-up</i> or <i>vpn-down</i>
</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you connect to foreign or public networks, be aware of what services you are starting and what servers you expect to be available for them to connect to. You could make a security hole by starting the wrong services while connected to a public network.</div>
<h3><span class="mw-headline" id="Avoiding_the_dispatcher_timeout">Avoiding the dispatcher timeout</span></h3>
<p>If the above is working, then this section is not relevant. However, there is a general problem related to running dispatcher scripts which take longer to be executed. Initially an internal timeout of three seconds only was used. If the called script did not complete in time, it was killed. Later the timeout was extended to about 20 seconds (see the <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=982734">Bugtracker</a> for more information). If the timeout still creates the problem, a work around may be to modify the dispatcher service file <code>/usr/lib/systemd/system/NetworkManager-dispatcher.service</code> to remain active after exit: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/NetworkManager-dispatcher.service.d/remain_after_exit.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
RemainAfterExit=yes</pre>
<p>Now start and enable the modified <code>NetworkManager-dispatcher</code> service.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Adding the <code>RemainAfterExit</code> line to it will prevent the dispatcher from closing. Unfortunately, the dispatcher <b>has</b> to close before it can run your scripts again. With it the dispatcher will not time out but it also will not close, which means that the scripts will only run once per boot. Therefore, do not add the line unless the timeout is definitely causing a problem.</div>
<h3><span class="mw-headline" id="Dispatcher_examples">Dispatcher examples</span></h3>
<h4><span class="mw-headline" id="Mount_remote_folder_with_sshfs">Mount remote folder with sshfs</span></h4>
<p>As the script is run in a very restrictive environment, you have to export <code>SSH_AUTH_SOCK</code> in order to connect to your SSH agent. There are different ways to accomplish this, see <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1042030#p1042030">this message</a> for more information. The example below works with <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a>, and will ask you for the password if not unlocked already. In case NetworkManager connects automatically on login, it is likely <i>gnome-keyring</i> has not yet started and the export will fail (hence the sleep). The <code>UUID</code> to match can be found with the command <code>nmcli connection status</code> or <code>nmcli connection list</code>.     
</p>
<pre>#!/bin/sh
USER='username'
REMOTE='user@host:/remote/path'
LOCAL='/local/path'

interface=$1 status=$2
if [ "$CONNECTION_UUID" = "<i>uuid</i>" ]; then
  case $status in
    up)
      SSH_AUTH_SOCK=$(find /tmp -maxdepth 1 -type s -user "$USER" -name 'ssh')
      export SSH_AUTH_SOCK
      su "$USER" -c "sshfs $REMOTE $LOCAL"
      ;;
    down)
      fusermount -u "$LOCAL"
      ;;
  esac
fi
</pre>
<h4><span class="mw-headline" id="Mounting_of_SMB_shares">Mounting of SMB shares</span></h4>
<p>Some <a href="../en/Samba.html" class="mw-redirect" title="SMB">SMB</a> shares are only available on certain networks or locations (e.g. at home). You can use the dispatcher to only mount SMB shares that are present at your current location.
</p>
<p>The following script will check if we connected to a specific network and mount shares accordingly:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/30-mount-smb.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

# Find the connection UUID with "nmcli connection show" in terminal.
# All NetworkManager connection types are supported: wireless, VPN, wired...
if [ "$2" = "up" ]; then
  if [ "$CONNECTION_UUID" = "uuid" ]; then
    mount /your/mount/point &amp; 
    # add more shares as needed
  fi
fi
</pre>
<p>The following script will unmount all SMB shares before a software initiated disconnect from a specific network:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/pre-down.d/30-umount-smb.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

if [ "$CONNECTION_UUID" = "uuid" ]; then
  umount -a -l -t cifs
fi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure this script is located in the <code>pre-down.d</code> sub-directory as shown above, otherwise it will unmount all shares on any connection state change.</div>
<p>The following script will attempt to unmount all SMB shares following an unexpected disconnect from a specific network:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/40-umount-smb.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

if [ "$CONNECTION_UUID" = "uuid" ]; then
  if [ "$2" = "down" ]; then
    umount -a -l -t cifs
  fi
fi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Since NetworkManager 0.9.8, the <i>pre-down</i> and <i>down</i> events are not executed on shutdown or restart, see <a rel="nofollow" class="external text" href="https://bugzilla.gnome.org/show_bug.cgi?id=701242">this bug report</a> for more info.</li>
<li>The previous <i>umount</i> scripts are still prone to leaving applications actually accessing the mount to 'hang'.</li>
</ul>
</div>
<p>An alternative is to use the script as seen in <a href="../en/NFS.html#Using_a_NetworkManager_dispatcher" title="NFS">NFS#Using a NetworkManager dispatcher</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/30-smb.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

# Find the connection UUID with "nmcli con show" in terminal.
# All NetworkManager connection types are supported: wireless, VPN, wired...
WANTED_CON_UUID="CHANGE-ME-NOW-9c7eff15-010a-4b1c-a786-9b4efa218ba9"

if [[ "$CONNECTION_UUID" == "$WANTED_CON_UUID" ]]; then
    
    # Script parameter $1: NetworkManager connection name, not used
    # Script parameter $2: dispatched event
    
    case "$2" in
        "up")
            mount -a -t cifs
            ;;
        "pre-down");&amp;
        "vpn-pre-down")
            umount -l -a -t cifs &gt;/dev/null
            ;;
    esac
fi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This script ignores mounts with the <code>noauto</code> option, remove this mount option or use <code>auto</code> to allow the dispatcher to manage these mounts.</div>
<p>Create a symlink inside <code>/etc/NetworkManager/dispatcher.d/pre-down/</code> to catch the <code>pre-down</code> events:
</p>
<pre># ln -s ../30-smb.sh /etc/NetworkManager/dispatcher.d/pre-down.d/30-smb.sh
</pre>
<h4><span class="mw-headline" id="Mounting_of_NFS_shares">Mounting of NFS shares</span></h4>
<p>See <a href="../en/NFS.html#Using_a_NetworkManager_dispatcher" title="NFS">NFS#Using a NetworkManager dispatcher</a>.
</p>
<h4><span class="mw-headline" id="Use_dispatcher_to_automatically_toggle_wireless_depending_on_LAN_cable_being_plugged_in">Use dispatcher to automatically toggle wireless depending on LAN cable being plugged in</span></h4>
<p>The idea is to only turn Wi-Fi on when the LAN cable is unplugged (for example when detaching from a laptop dock), and for Wi-Fi to be automatically disabled, once a LAN cable is plugged in again. 
</p>
<p>Create the following dispatcher script<a rel="nofollow" class="external autonumber" href="https://superuser.com/questions/233448/disable-wlan-if-wired-cable-network-is-available">[6]</a>, replacing <code>LAN_interface</code> with yours.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/wlan_auto_toggle.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

if [ "$1" = "LAN_interface" ]; then
    case "$2" in
        up)
            nmcli radio wifi off
            ;;
        down)
            nmcli radio wifi on
            ;;
    esac
fi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can get a list of interfaces using <a href="#nmcli_examples">nmcli</a>. The ethernet (LAN) interfaces start with <code>en</code>, e.g. <code>enp0s5</code>
</div>
<h4><span class="mw-headline" id="Use_dispatcher_to_connect_to_a_VPN_after_a_network_connection_is_established">Use dispatcher to connect to a VPN after a network connection is established</span></h4>
<p>In this example we want to connect automatically to a previously defined VPN connection after connecting to a specific Wi-Fi network. First thing to do is to create the dispatcher script that defines what to do after we are connected to the network.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This script will require <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wireless_tools">wireless_tools</a></span> in order to use <code>iwgetid</code>.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/vpn-up</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
VPN_NAME="name of VPN connection defined in NetworkManager"
ESSID="Wi-Fi network ESSID (not connection name)"

interface=$1 status=$2
case $status in
  up|vpn-down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      nmcli connection up id "$VPN_NAME"
    fi
    ;;
  down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      if nmcli connection show --active | grep "$VPN_NAME"; then
        nmcli connection down id "$VPN_NAME"
      fi
    fi
    ;;
esac
</pre>
<p>If you would like to attempt to automatically connect to VPN for all Wi-Fi networks, you can use the following definition of the ESSID: <code>ESSID=$(iwgetid -r)</code>. Remember to set the script's permissions <a href="#Network_services_with_NetworkManager_dispatcher">accordingly</a>. 
</p>
<p>Trying to connect with the above script may still fail with <code>NetworkManager-dispatcher.service</code> complaining about 'no valid VPN secrets', because of <a rel="nofollow" class="external text" href="https://developer.gnome.org/NetworkManager/0.9/secrets-flags.html">the way VPN secrets are stored</a>. Fortunately, there are different options to give the above script access to your VPN password.
</p>
<p>1: One of them requires editing the VPN connection configuration file to make NetworkManager store the secrets by itself rather than inside a keyring <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=710552">that will be inaccessible for root</a>: open up <code>/etc/NetworkManager/system-connections/<i>name of your VPN connection</i></code> and change the <code>password-flags</code> and <code>secret-flags</code> from <code>1</code> to <code>0</code>.
</p>
<p>If that alone does not work, you may have to create a <code>passwd-file</code> in a safe location with the same permissions and ownership as the dispatcher script, containing the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/path/to/passwd-file</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vpn.secrets.password:YOUR_PASSWORD
</pre>
<p>The script must be changed accordingly, so that it gets the password from the file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/vpn-up</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
VPN_NAME="name of VPN connection defined in NetworkManager"
ESSID="Wi-Fi network ESSID (not connection name)"

interface=$1 status=$2
case $status in
  up|vpn-down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      nmcli connection up id "$VPN_NAME" passwd-file /path/to/passwd-file
    fi
    ;;
  down)
    if iwgetid | grep -qs ":\"$ESSID\""; then
      if nmcli connection show --active | grep "$VPN_NAME"; then
        nmcli connection down id "$VPN_NAME"
      fi
    fi
    ;;
esac
</pre>
<p>2: Alternatively, change the <code>password-flags</code> and put the password directly in the configuration file adding the section <code>vpn-secrets</code>:
</p>
<pre> [vpn]
 ....
 password-flags=0
 
 [vpn-secrets]
 password=<i>your_password</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It may now be necessary to re-open the NetworkManager connection editor and save the VPN passwords/secrets again.</div>
<h4><span class="mw-headline" id="Use_dispatcher_to_disable_IPv6_on_VPN_provider_connections">Use dispatcher to disable IPv6 on VPN provider connections</span></h4>
<p>Many <a href="../en/Category:VPN_providers.html" title="Category:VPN providers">commercial VPN providers</a> support only IPv4. That means all IPv6 traffic bypasses the VPN and renders it virtually useless. To avoid this, dispatcher can be used to disable all IPv6 traffic for the time a VPN connection is up.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/10-vpn-ipv6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

case "$2" in
	vpn-up)
		echo 1 &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6
		;;
	vpn-down)
		echo 0 &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6
		;;
esac
</pre>
<h4><span class="mw-headline" id="OpenNTPD">OpenNTPD</span></h4>
<p>See <a href="../en/OpenNTPD.html#Using_NetworkManager_dispatcher" title="OpenNTPD">OpenNTPD#Using NetworkManager dispatcher</a>.
</p>
<h2><span class="mw-headline" id="Testing">Testing</span></h2>
<p>NetworkManager applets are designed to load upon login so no further configuration should be necessary for most users.  If you have already disabled your previous network settings and disconnected from your network, you can now test if NetworkManager will work. The first step is to <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>NetworkManager.service</code>.
</p>
<p>Some applets will provide you with a <code>.desktop</code> file so that the NetworkManager applet can be loaded through the application menu.  If it does not, you are going to either have to discover the command to use or logout and login again to start the applet.  Once the applet is started, it will likely begin polling network connections with for auto-configuration with a DHCP server.
</p>
<p>To start the GNOME applet in non-xdg-compliant window managers like <a href="../en/Awesome.html" title="Awesome">awesome</a>:
</p>
<pre>nm-applet --sm-disable &amp;
</pre>
<p>For static IP addresses, you will have to configure NetworkManager to understand them.  The process usually involves right-clicking the applet and selecting something like 'Edit Connections'.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Encrypted_Wi-Fi_passwords">Encrypted Wi-Fi passwords</span></h3>
<p>By default, NetworkManager stores passwords in clear text in the connection files at <code>/etc/NetworkManager/system-connections/</code>. To print the stored passwords, use the following command:
</p>
<pre># grep -r '^psk=' /etc/NetworkManager/system-connections/
</pre>
<p>The passwords are accessible to the root user in the filesystem and to users with access to settings via the GUI (e.g. <code>nm-applet</code>). 
</p>
<p>It is preferable to save the passwords in encrypted form in a keyring instead of clear text. The downside of using a keyring is that the connections have to be set up for each user.
</p>
<h4><span class="mw-headline" id="Using_GNOME_Keyring">Using GNOME Keyring</span></h4>
<p>The keyring daemon has to be started and the keyring needs to be unlocked for the following to work.
</p>
<p>Furthermore, NetworkManager needs to be configured not to store the password for all users. Using GNOME <code>nm-applet</code>, run <code>nm-connection-editor</code> from a terminal, select a network connection,  click <code>Edit</code>, select the <code>Wifi-Security</code> tab and click on the right icon of password and check <code>Store the password only for this user</code>.
</p>
<h4><span class="mw-headline" id="Using_KDE_Wallet">Using KDE Wallet</span></h4>
<p>Using KDE's <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plasma-nm">plasma-nm</a></span>, click the applet, click on the top right <code>Settings</code> icon, click on a network connection, in the <code>General settings</code> tab, untick <code>all users may connect to this network</code>. If the option is ticked, the passwords will still be stored in clear text, even if a keyring daemon is running.
</p>
<p>If the option was selected previously and you un-tick it, you may have to use the <code>reset</code> option first to make the password disappear from the file. Alternatively, delete the connection first and set it up again.
</p>
<h3><span class="mw-headline" id="Sharing_internet_connection_over_Wi-Fi">Sharing internet connection over Wi-Fi</span></h3>
<p>You can share your internet connection (e.g. 3G or wired) with a few clicks.  Please note that a <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> may interfere with internet sharing.
</p>
<p>You will need a Wi-Fi card which supports AP mode, see <a href="../en/Software_access_point.html#Wi-Fi_device_must_support_AP_mode" title="Software access point">Software access point#Wi-Fi device must support AP mode</a> for details.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span> package to be able to actually share the connection.
</p>
<p>Create the shared connection:
</p>
<ul>
<li>Click on applet and choose <i>Create new wireless network</i>.</li>
<li>Follow wizard (choose WPA2 or higher, be sure to use at least 8 character long password, lower lengths will fail).
<ul><li>Choose either <a href="https://fedoraproject.org/wiki/Features/RealHotspot" class="extiw" title="fedora:Features/RealHotspot">Hotspot</a> or Ad-hoc as Wi-Fi mode.</li></ul>
</li>
</ul>
<p>The connection will be saved and remain stored for the next time you need it.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Android does not support connecting to Ad-hoc networks. To share a connection with Android use infrastructure mode (i.e. set Wi-Fi mode to "Hotspot").</div>
<h3><span class="mw-headline" id="Sharing_internet_connection_over_Ethernet">Sharing internet connection over Ethernet</span></h3>
<p>Scenario: your device has internet connection over wi-fi and you want to share the internet connection to other devices over ethernet.
</p>
<p>Requirements:
</p>
<ul>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span> package to be able to actually share the connection.</li>
<li>Your internet connected device and the other devices are connected over a suitable ethernet cable (this usually means a cross over cable or a switch in between).</li>
<li>Internet sharing is not blocked by a <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a>.</li>
</ul>
<p>Steps:
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nm-connection-editor">nm-connection-editor</a></span> is not a dependency of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span> and needs to be installed separately. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<ul>
<li>Run <code>nm-connection-editor</code> from terminal.</li>
<li>Add a new ethernet connection.</li>
<li>Give it some sensible name. For example "Shared Internet"</li>
<li>Go to "IPv4 Settings".</li>
<li>For "Method:" select "Shared to other computers".</li>
<li>Save</li>
</ul>
<p>Now you should have a new option "Shared Internet" under the Wired connections in NetworkManager.
</p>
<h3><span class="mw-headline" id="Checking_if_networking_is_up_inside_a_cron_job_or_script">Checking if networking is up inside a cron job or script</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <i>nm-tool</i> was remove from NetworkManager for long time now<a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/commit/bb8c75bd536d4f8fb80a4366025a279078f0ec81">[7]</a>. <i>nmcli</i> should be used instead. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p>Some <i>cron</i> jobs require networking to be up to succeed. You may wish to avoid running these jobs when the network is down. To accomplish this, add an <b>if</b> test for networking that queries NetworkManager's <i>nm-tool</i> and checks the state of networking. The test shown here succeeds if any interface is up, and fails if they are all down. This is convenient for laptops that might be hardwired, might be on wireless, or might be off the network.
</p>
<pre>if [ $(nm-tool|grep State|cut -f2 -d' ') == "connected" ]; then
    #Whatever you want to do if the network is online
else
    #Whatever you want to do if the network is offline - note, this and the else above are optional
fi
</pre>
<p>This useful for a <code>cron.hourly</code> script that runs <i>fpupdate</i> for the F-Prot virus scanner signature update, as an example. Another way it might be useful, with a little modification, is to differentiate between networks using various parts of the output from <i>nm-tool</i>; for example, since the active wireless network is denoted with an asterisk, you could grep for the network name and then grep for a literal asterisk.
</p>
<h3><span class="mw-headline" id="Connect_to_network_with_secret_on_boot">Connect to network with secret on boot</span></h3>
<p>By default, NetworkManager will not connect to networks requiring a secret automatically on boot. This is because it locks such connections to the user who makes it by default, only connecting after they have logged in. To change this, do the following:
</p>
<ol>
<li>Right click on the <code>nm-applet</code> icon in your panel and select Edit Connections and open the Wireless tab</li>
<li>Select the connection you want to work with and click the Edit button</li>
<li>Check the boxes “Connect Automatically” and “Available to all users”</li>
<li>Additionally, ensure that under "Wi-Fi Security", "Store password for all users (not encrypted)" is selected</li>
</ol>
<p>Log out and log back in to complete.
</p>
<h3><span class="mw-headline" id="OpenConnect_with_password_in_KWallet">OpenConnect with password in KWallet</span></h3>
<p>While you may type both values at connection time, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plasma-nm">plasma-nm</a></span> 0.9.3.2-1 and above are capable of retrieving OpenConnect username and password directly from <a href="../en/KDE_Wallet.html" class="mw-redirect" title="KWallet">KWallet</a>.
</p>
<p>Open "KDE Wallet Manager" and look up your OpenConnect VPN connection under "Network Management|Maps". Click "Show values" and 
enter your credentials in key "VpnSecrets" in this form (replace <i>username</i> and <i>password</i> accordingly):
</p>
<pre>form:main:username%SEP%<i>username</i>%SEP%form:main:password%SEP%<i>password</i>
</pre>
<p>Next time you connect, username and password should appear in the "VPN secrets" dialog box.
</p>
<h3><span class="mw-headline" id="Ignore_specific_devices">Ignore specific devices</span></h3>
<p>Sometimes it may be desired that NetworkManager ignores specific devices and does not try to configure addresses and routes for them. You can quickly and easily ignore devices by MAC or interface-name by using the following in <code>/etc/NetworkManager/conf.d/unmanaged.conf</code>:
</p>
<pre>[keyfile]
unmanaged-devices=mac:00:22:68:1c:59:b1;mac:00:1E:65:30:D1:C4;interface-name:eth0
</pre>
<p>After editing the file, run <code>nmcli general reload</code> as root. Afterwards you should be able to configure interfaces without NetworkManager altering what you have set.
</p>
<h3><span class="mw-headline" id="Configuring_MAC_address_randomization">Configuring MAC address randomization</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Disabling MAC address randomization may be needed to get (stable) link connection <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=220101">[8]</a> and/or networks that restrict devices based on their MAC Address or have a limit network capacity.</div>
<p>MAC randomization can be used for increased privacy by not disclosing your real MAC address to the network.
</p>
<p>NetworkManager supports two types MAC Address Randomization: randomization during scanning, and for network connections. Both modes can be configured by modifying <code>/etc/NetworkManager/NetworkManager.conf</code> or by creating a separate configuration file in <code>/etc/NetworkManager/conf.d/</code> which is recommended since the aforementioned config file may be overwritten by NetworkManager.
</p>
<p>Randomization during Wi-Fi scanning is enabled by default, but it may be disabled by adding the following lines to <code>/etc/NetworkManager/NetworkManager.conf</code> or a dedicated configuration file under <code>/etc/NetworkManager/conf.d</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/wifi_rand_mac.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[device]
wifi.scan-rand-mac-address=no</pre>
<p>MAC randomization for network connections can be set to different modes for both wireless and ethernet interfaces. See the <a rel="nofollow" class="external text" href="https://blogs.gnome.org/thaller/2016/08/26/mac-address-spoofing-in-networkmanager-1-4-0/">GNOME blog post</a> for more details on the different modes. 
</p>
<p>In terms of MAC randomization the most important modes are <code>stable</code> and <code>random</code>. <code>stable</code> generates a random MAC address when you connect to a new network and associates the two permanently. This means that you will use the same MAC address every time you connect to that network. In contrast, <code>random</code> will generate a new MAC address every time you connect to a network, new or previously known. You can configure the MAC randomization by adding the desired configuration under <code>/etc/NetworkManager/conf.d</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/wifi_rand_mac.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[device-mac-randomization]
# "yes" is already the default for scanning
wifi.scan-rand-mac-address=yes
 
[connection-mac-randomization]
# Randomize MAC for every ethernet connection
ethernet.cloned-mac-address=random
# Generate a random MAC for each WiFi and associate the two permanently.
wifi.cloned-mac-address=stable</pre>
<p>See the following <a rel="nofollow" class="external text" href="https://blogs.gnome.org/thaller/2016/08/26/mac-address-spoofing-in-networkmanager-1-4-0/">GNOME blog post</a> for more details.
</p>
<h3><span class="mw-headline" id="Enable_IPv6_Privacy_Extensions">Enable IPv6 Privacy Extensions</span></h3>
<p>See <a href="../en/IPv6.html#NetworkManager" title="IPv6">IPv6#NetworkManager</a>.
</p>
<h3><span class="mw-headline" id="Working_with_wired_connections">Working with wired connections</span></h3>
<p>By default, NetworkManager generates a connection profile for each wired ethernet connection it finds. At the point when generating the connection, it does not know whether there will be more ethernet adapters available. Hence, it calls the first wired connection "Wired connection 1". You can avoid generating this connection, by configuring <code>no-auto-default</code> (see <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5">NetworkManager.conf(5)</a></span>), or by simply deleting it. Then NetworkManager will remember not to generate a connection for this interface again.
</p>
<p>You can also edit the connection (and persist it to disk) or delete it. NetworkManager will not re-generate a new connection. Then you can change the name to whatever you want. You can use something like nm-connection-editor for this task.
</p>
<h3><span class="mw-headline" id="Using_iwd_as_the_Wi-Fi_backend">Using iwd as the Wi-Fi backend</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Consider <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/-/issues?scope=all&amp;utf8=%E2%9C%93&amp;state=opened&amp;search=iwd">existing issues</a> before switching to iwd.</div>
<p>Enable the <a rel="nofollow" class="external text" href="https://iwd.wiki.kernel.org/networkmanager">experimental</a> <a href="../en/Iwd.html" title="Iwd">iwd</a> backend creating the following configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/wifi_backend.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[device]
wifi.backend=iwd</pre>
<p>Alternatively, you can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-iwd/">networkmanager-iwd</a></span><sup><small>AUR</small></sup>, a modified package configured to build <i>NetworkManager</i> working exclusively with <i>iwd</i>, with the main difference being that <i>iwd</i> is required and <i>wpa_supplicant</i> can be uninstalled after building.
</p>
<h3><span class="mw-headline" id="Running_in_a_network_namespace">Running in a network namespace</span></h3>
<p>If you would like to run NetworkManager inside a network namespace (e.g., to manage a specific device which should be use by selected applications), bring the device down before moving it to the namespace:
</p>
<pre>$ ip link set dev <i>MY_DEVICE</i> down
$ ip link set dev <i>MY_DEVICE</i> netns <i>MY_NAMESPACE</i>
$ ip netns exec <i>MY_NAMESPACE</i> NetworkManager
...
$ ip netns exec <i>MY_NAMESPACE</i> killall NetworkManager
</pre>
<p>otherwise NetworkManager will later fail to establish the connection with a <code>device is strictly unmanaged</code> error.
</p>
<h3><span class="mw-headline" id="Automatically_connect_to_VPN">Automatically connect to VPN</span></h3>
<p>NetworkManager can be set to automatically connect to a VPN when connecting to the internet, on a per network basis. The VPN connection itself can be added in GNOME's NetworkManager font-end, but to make it automatically use the VPN <code>nmcli</code> must be used. Other front-ends might not have this limitation.
</p>
<p>First, make sure to make the VPN connection available to all users. In the GNOME this is a matter of checking a box under the <code>details</code> tab. Under the <code>Identity</code> tab, in the password field, click the icon on the right side in the field, and set it to <code>Store the password for all users</code>.
</p>
<p>Then find the UUID of the VPN connection, and add that to <code>connection.secondaries</code> of the Internet connection:
</p>
<pre># UUID=$(nmcli --get-values connection.uuid connection show <i>name-of-VPN-connection</i>)
# nmcli connection modify <i>name-of-Internet-connection</i> connection.secondaries "$UUID"
</pre>
<p>Now when NetworkManager is restarted and you connect to the Internet connection you have configured, you should automatically get connected to the VPN.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="No_prompt_for_password_of_secured_Wi-Fi_networks">No prompt for password of secured Wi-Fi networks</span></h3>
<p>When trying to connect to a secured Wi-Fi network, no prompt for a password is shown and no connection is established. This happens when no keyring package is installed. An easy solution is to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span>. If you want the passwords to be stored in encrypted form, follow <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a> to set up the <i>gnome-keyring-daemon</i>.
</p>
<h3><span class="mw-headline" id="Network_management_disabled">Network management disabled</span></h3>
<p>When NetworkManager shuts down but the pid (state) file is not removed, you will see a <code>Network management disabled</code> message. If this happens, remove the file manually:
</p>
<pre># rm /var/lib/NetworkManager/NetworkManager.state
</pre>
<h3><span class="mw-headline" id="Problems_with_internal_DHCP_client">Problems with internal DHCP client</span></h3>
<p>If you have problems with getting an IP address using the internal DHCP client, consider using another DHCP client, see <a href="#DHCP_client">#DHCP client</a> for instructions. This workaround might solve problems in big wireless networks like eduroam.
</p>
<h3><span class="mw-headline" id="DHCP_problems_with_dhclient">DHCP problems with dhclient</span></h3>
<p>If you have problems with getting an IP address via DHCP, try to add the following to your <code>/etc/dhclient.conf</code>:
</p>
<pre> interface "eth0" {
   send dhcp-client-identifier 01:<i>aa:bb:cc:dd:ee:ff</i>;
 }
</pre>
<p>Where <code><i>aa:bb:cc:dd:ee:ff</i></code> is the MAC address of this NIC. The MAC address can be found using the <code>ip link show <i>interface</i></code> command from the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span> package.
</p>
<h3><span class="mw-headline" id="3G_modem_not_detected">3G modem not detected</span></h3>
<p>See <a href="../en/USB_3G_Modem.html#NetworkManager" title="USB 3G Modem">USB 3G Modem#NetworkManager</a>.
</p>
<h3><span class="mw-headline" id="Switching_off_WLAN_on_laptops">Switching off WLAN on laptops</span></h3>
<p>Sometimes NetworkManager will not work when you disable your Wi-Fi adapter with a switch on your laptop and try to enable it again afterwards. This is often a problem with <i>rfkill</i>. To check if the driver notifies <i>rfkill</i> about the wireless adapter's status, use:
</p>
<pre>$ watch -n1 rfkill list all
</pre>
<p>If one identifier stays blocked after you switch on the adapter you could try to manually unblock it with (where X is the number of the identifier provided by the above output):
</p>
<pre># rfkill event unblock X
</pre>
<h3><span class="mw-headline" id="Static_IP_address_settings_revert_to_DHCP">Static IP address settings revert to DHCP</span></h3>
<p>Due to an unresolved bug, when changing default connections to a static IP address, <code>nm-applet</code> may not properly store the configuration change, and will revert to automatic DHCP.
</p>
<p>To work around this issue you have to edit the default connection (e.g. "Auto eth0") in <code>nm-applet</code>, change the connection name (e.g. "my eth0"), uncheck the "Available to all users" checkbox, change your static IP address settings as desired, and click <b>Apply</b>.  This will save a new connection with the given name.
</p>
<p>Next, you will want to make the default connection not connect automatically.  To do so, run <code>nm-connection-editor</code> (<b>not</b> as root). In the connection editor, edit the default connection (e.g. "Auto eth0") and uncheck "Connect automatically".  Click <b>Apply</b> and close the connection editor.
</p>
<h3><span class="mw-headline" id="Cannot_edit_connections_as_normal_user">Cannot edit connections as normal user</span></h3>
<p>See <a href="#Set_up_PolicyKit_permissions">#Set up PolicyKit permissions</a>.
</p>
<h3><span class="mw-headline" id="Forget_hidden_wireless_network">Forget hidden wireless network</span></h3>
<p>Since hidden networks are not displayed in the selection list of the Wireless view, they cannot be forgotten (removed) with the GUI. You can delete one with the following command:
</p>
<pre># rm /etc/NetworkManager/system-connections/<i>SSID</i>
</pre>
<p>This works for any other connection.
</p>
<h3><span class="mw-headline" id="VPN_not_working_in_GNOME">VPN not working in GNOME</span></h3>
<p>When setting up OpenConnect or vpnc connections in NetworkManager while using GNOME, you will sometimes never see the dialog box pop up and the following error appears in <code>/var/log/errors.log</code>:
</p>
<pre>localhost NetworkManager[399]: &lt;error&gt; [1361719690.10506] [nm-vpn-connection.c:1405] get_secrets_cb(): Failed to request VPN secrets #3: (6) No agents were available for this request.
</pre>
<p>This is caused by the GNOME NM Applet expecting dialog scripts to be at <code>/usr/lib/gnome-shell</code>, when NetworkManager's packages put them in <code>/usr/lib/networkmanager</code>.
As a "temporary" fix (this bug has been around for a while now), make the following symlink(s):
</p>
<ul>
<li>For OpenConnect: <code>ln -s /usr/lib/networkmanager/nm-openconnect-auth-dialog /usr/lib/gnome-shell/</code>
</li>
<li>For VPNC (i.e. Cisco VPN): <code>ln -s /usr/lib/networkmanager/nm-vpnc-auth-dialog /usr/lib/gnome-shell/</code>
</li>
</ul>
<p>This may need to be done for any other NM VPN plugins as well, but these are the two most common.
</p>
<h3><span class="mw-headline" id="Unable_to_connect_to_visible_European_wireless_networks">Unable to connect to visible European wireless networks</span></h3>
<p>WLAN chips are shipped with a default <a href="../en/Network_configuration/Wireless.html#Respecting_the_regulatory_domain" class="mw-redirect" title="Wireless network configuration">regulatory domain</a>. If your access point does not operate within these limitations, you will not be able to connect to the network. Fixing this is easy:
</p>
<ol>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=crda">crda</a></span>
</li>
<li>Uncomment the correct Country Code in <code>/etc/conf.d/wireless-regdom</code>
</li>
<li>Reboot the system, because the setting is only read on boot</li>
</ol>
<h3><span class="mw-headline" id="Automatic_connect_to_VPN_on_boot_is_not_working">Automatic connect to VPN on boot is not working</span></h3>
<p>The problem occurs when the system (i.e. NetworkManager running as the root user) tries to establish a VPN connection, but the password is not accessible because it is stored in the GNOME keyring of a particular user. 
</p>
<p>A solution is to keep the password to your VPN in plaintext, as described in step (2.) of <a href="#Use_dispatcher_to_connect_to_a_VPN_after_a_network_connection_is_established">#Use dispatcher to connect to a VPN after a network connection is established</a>. 
</p>
<p>You do not need to use the dispatcher described in step (1.) to auto-connect anymore, if you use the new "auto-connect VPN" option from the <code>nm-applet</code> GUI.
</p>
<h3><span class="mw-headline" id="Systemd_Bottleneck">Systemd Bottleneck</span></h3>
<p>Over time the log files (<code>/var/log/journal</code>) can become very large. This can have a big impact on boot performance when using NetworkManager, see: <a href="../en/Systemd.html#Boot_time_increasing_over_time" title="Systemd">Systemd#Boot time increasing over time</a>.
</p>
<h3>
<span id="Regular_network_disconnects.2C_latency_and_lost_packets_.28WiFi.29"></span><span class="mw-headline" id="Regular_network_disconnects,_latency_and_lost_packets_(WiFi)">Regular network disconnects, latency and lost packets (WiFi)</span>
</h3>
<p>NetworkManager does a scan every 2 minutes.
</p>
<p>Some WiFi drivers have issues when scanning for base stations whilst connected/associated. Symptoms include VPN disconnects/reconnects and lost packets, web pages failing to load and then refresh fine.
</p>
<p>Running <code>journalctl -f</code> will indicate that this is taking place, messages like the following will be contained in the logs at regular intervals.
</p>
<pre>NetworkManager[410]: &lt;info&gt;  (wlp3s0): roamed from BSSID 00:14:48:11:20:CF (my-wifi-name) to (none) ((none))
</pre>
<p>There is a patched version of NetworkManager which should prevent this type of scanning: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-noscan/">networkmanager-noscan</a></span><sup><small>AUR</small></sup>.
</p>
<p>Alternatively, if roaming is not important, the periodic scanning behavior can be disabled by locking the BSSID of the access point in the WiFi connection profile.
</p>
<h3>
<span id="Unable_to_turn_on_wi-fi_with_Lenovo_laptop_.28IdeaPad.2C_Legion.2C_etc..29"></span><span class="mw-headline" id="Unable_to_turn_on_wi-fi_with_Lenovo_laptop_(IdeaPad,_Legion,_etc.)">Unable to turn on wi-fi with Lenovo laptop (IdeaPad, Legion, etc.)</span>
</h3>
<p>There is an issue with the <code>ideapad_laptop</code> module on some Lenovo models due to the wi-fi driver incorrectly reporting a soft block. The card can still be manipulated with <code>netctl</code>, but managers like NetworkManager break. You can verify that this is the problem by checking the output of <code>rfkill list</code> after toggling your hardware switch and seeing that the soft block persists.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Try to use <code>rfkill.default_state</code> and <code>rfkill.master_switch_mode</code> (see <a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/kernel-parameters.txt">kernel-parameters.txt</a>) to fix the rfkill problem. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:NetworkManager">Talk:NetworkManager#</a>)</div>
</div>
<p><a href="../en/Kernel_module.html" class="mw-redirect" title="Modprobe">Unloading</a> the <code>ideapad_laptop</code> module should fix this. (<b>warning</b>: this may disable the laptop keyboard and touchpad also!).
</p>
<h3><span class="mw-headline" id="Turn_off_hostname_sending">Turn off hostname sending</span></h3>
<p>NetworkManager by default sends the hostname to the DHCP server. Hostname sending can only be disabled per connection not globally (<a rel="nofollow" class="external text" href="https://bugzilla.gnome.org/show_bug.cgi?id=768076">GNOME Bug 768076</a>).
</p>
<p>To disable sending your hostname to the DHCP server for a specific connection, add the following to your network connection file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/system-connections/<i>your_connection_file</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[ipv4]
dhcp-send-hostname=false
...
[ipv6]
dhcp-send-hostname=false
...</pre>
<h3><span class="mw-headline" id="nm-applet_disappears_in_i3wm">nm-applet disappears in i3wm</span></h3>
<p>If you use the <code>xfce4-notifyd.service</code> for notifications you must <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the unit and add the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/user/xfce4-notifyd.service.d/display_env.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment="DISPLAY=:0.0"</pre>
<p>After reloading the daemons <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>xfce4-notifyd.service</code>. Exit i3 and start it back up again and the applet should show on the tray.
</p>
<h3><span class="mw-headline" id="nm-applet_tray_icons_display_wrongly">nm-applet tray icons display wrongly</span></h3>
<p>Currently the tray icons of nm-applet are drawn on top of one another, i.e. the icon displaying wireless strength might show on top of the icon indicating no wired connection.
This is apparently a GTK3 bug/problem: <a rel="nofollow" class="external free" href="https://gitlab.gnome.org/GNOME/gtk/issues/1280">https://gitlab.gnome.org/GNOME/gtk/issues/1280</a> .
</p>
<p>A patched version of GTK3 exists in AUR, which apparently fixes the tray icon bug: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gtk3-mushrooms/">gtk3-mushrooms</a></span><sup><small>AUR</small></sup> .
</p>
<h3><span class="mw-headline" id="Unit_dbus-org.freedesktop.resolve1.service_not_found">Unit dbus-org.freedesktop.resolve1.service not found</span></h3>
<p>If <code>systemd-resolved.service</code> is not started, NetworkManager will try to start it using D-Bus and fail:
</p>
<pre>dbus-daemon[991]: [system] Activating via systemd: service name='org.freedesktop.resolve1' unit='dbus-org.freedesktop.resolve1.service' requested by ':1.23' (uid=0 pid=1012 comm="/usr/bin/NetworkManager --no-daemon ")
dbus-daemon[991]: [system] Activation via systemd failed for unit 'dbus-org.freedesktop.resolve1.service': Unit dbus-org.freedesktop.resolve1.service not found.
dbus-daemon[991]: [system] Activating via systemd: service name='org.freedesktop.resolve1' unit='dbus-org.freedesktop.resolve1.service' requested by ':1.23' (uid=0 pid=1012 comm="/usr/bin/NetworkManager --no-daemon ")
</pre>
<p>This is because NetworkManager will try to send DNS information to <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> regardless of the <code>main.dns=</code> setting in <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5">NetworkManager.conf(5)</a></span>.<a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/commit/d4eb4cb45f41b1751cacf71da558bf8f0988f383">[9]</a>
</p>
<p>This can be disabled with a configuration file in <code>/etc/NetworkManager/conf.d/</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/no-systemd-resolved.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[main]
systemd-resolved=false</pre>
<p>See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/62138">FS#62138</a>.
</p>
<h3>
<span id="Secrets_were_required.2C_but_not_provided"></span><span class="mw-headline" id="Secrets_were_required,_but_not_provided">Secrets were required, but not provided</span>
</h3>
<p>If you attempt to connect to a network using <code>nmcli device wifi connect <i>SSID</i> password <i>password</i></code> and received the following error:
</p>
<pre>Error: Connection activation failed: (7) Secrets were required, but not provided
</pre>
<p>The error can be resolved by deleting the connection profile and creating a new one:
</p>
<pre>$ nmcli connection delete <i>SSID</i>
$ nmcli device wifi connect <i>SSID</i> password <i>password</i>
</pre>
<h3><span class="mw-headline" id="WPA_Enterprise_connection_with_NetworkManager">WPA Enterprise connection with NetworkManager</span></h3>
<p>If you try to connect to an WPA Enterprise network like 'eduroam' with NetworkManager with the <a href="../en/Iwd.html" title="Iwd">iwd</a> backend then you will get the following error from NetworkManager:
</p>
<pre> Connection 'eduroam' is not avialable on device wlan0 because profile is not compatible with device (802.1x connections must have IWD provisioning files)
</pre>
<p>This is because NetworkManager can not configure a WPA Enterprise network. Therefore you have to configure it using an iwd config file <code>/var/lib/iwd/<i>essid</i>.8021x</code> like described in <a href="../en/Iwd.html#WPA_Enterprise" title="Iwd">iwd#WPA Enterprise</a>.
</p>
<h3><span class="mw-headline" id="Failed_to_request_VPN_secrets">Failed to request VPN secrets</span></h3>
<p>If you get this error:
</p>
<pre>Failed to request VPN secrets #1: No agents were available for this request.
</pre>
<p>It is either because the password is empty or you have to <a href="#Set_up_PolicyKit_permissions">set up PolicyKit permissions</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://blogs.gnome.org/dcbw/2015/02/16/networkmanager-for-administrators-part-1/">NetworkManager for Administrators Part 1</a></li>
<li><a href="https://en.wikipedia.org/wiki/NetworkManager" class="extiw" title="wikipedia:NetworkManager">Wikipedia:NetworkManager</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Network_managers.html" title="Category:Network managers">Network managers</a></li>
<li><a href="../en/Category:Red_Hat.html" title="Category:Red Hat">Red Hat</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NetworkManager&amp;oldid=649036">https://wiki.archlinux.org/index.php?title=NetworkManager&amp;oldid=649036</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 16 January 2021, at 13:04.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
