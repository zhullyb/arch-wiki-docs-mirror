<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Nextcloud - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Nextcloud rootpage-Nextcloud skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Nextcloud</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a></li>
<li><a href="../en/Nginx.html" title="Nginx">Nginx</a></li>
<li><a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a></li>
<li><a href="../en/WebDAV.html" title="WebDAV">WebDAV</a></li>
</ul>
</div>
<p>From <a href="https://en.wikipedia.org/wiki/Nextcloud" class="extiw" title="wikipedia:Nextcloud">Wikipedia:Nextcloud</a>:
</p>
<dl><dd>Nextcloud is a suite of client-server software for creating and using file hosting services. It is functionally similar to Dropbox, although Nextcloud is free and open-source, allowing anyone to install and operate it on a private server. In contrast to proprietary services like Dropbox, the open architecture allows adding additional functionality to the server in form of applications.</dd></dl>
<p>Nextcloud is a fork of ownCloud. For differences between the two, see <a href="https://en.wikipedia.org/wiki/Nextcloud#Differences_from_ownCloud" class="extiw" title="wikipedia:Nextcloud">wikipedia:Nextcloud#Differences from ownCloud</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Prerequisites"><span class="tocnumber">1</span> <span class="toctext">Prerequisites</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Pacman_hook"><span class="tocnumber">2.1</span> <span class="toctext">Pacman hook</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Setup"><span class="tocnumber">3</span> <span class="toctext">Setup</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#PHP_setup"><span class="tocnumber">3.1</span> <span class="toctext">PHP setup</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#Database_setup"><span class="tocnumber">3.2</span> <span class="toctext">Database setup</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#MariaDB"><span class="tocnumber">3.2.1</span> <span class="toctext">MariaDB</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#PostgreSQL"><span class="tocnumber">3.2.2</span> <span class="toctext">PostgreSQL</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9">
<a href="#Web_server_setup"><span class="tocnumber">3.3</span> <span class="toctext">Web server setup</span></a>
<ul>
<li class="toclevel-3 tocsection-10">
<a href="#Apache"><span class="tocnumber">3.3.1</span> <span class="toctext">Apache</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="#WebDAV"><span class="tocnumber">3.3.1.1</span> <span class="toctext">WebDAV</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-12"><a href="#Nginx"><span class="tocnumber">3.3.2</span> <span class="toctext">Nginx</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#lighttpd"><span class="tocnumber">3.3.3</span> <span class="toctext">lighttpd</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14"><a href="#Create_data_storage_directory"><span class="tocnumber">3.4</span> <span class="toctext">Create data storage directory</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Fix_apps_directory_permissions"><span class="tocnumber">3.5</span> <span class="toctext">Fix apps directory permissions</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Explicitly_permit_Nextcloud_directories_for_php-fpm"><span class="tocnumber">3.6</span> <span class="toctext">Explicitly permit Nextcloud directories for php-fpm</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#Initialize"><span class="tocnumber">4</span> <span class="toctext">Initialize</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Configure_caching"><span class="tocnumber">4.1</span> <span class="toctext">Configure caching</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-19">
<a href="#Security_Hardening"><span class="tocnumber">5</span> <span class="toctext">Security Hardening</span></a>
<ul>
<li class="toclevel-2 tocsection-20">
<a href="#uWSGI"><span class="tocnumber">5.1</span> <span class="toctext">uWSGI</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#Activation"><span class="tocnumber">5.1.1</span> <span class="toctext">Activation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="#Setting_strong_permissions_for_the_filesystem"><span class="tocnumber">5.2</span> <span class="toctext">Setting strong permissions for the filesystem</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#Synchronization"><span class="tocnumber">6</span> <span class="toctext">Synchronization</span></a>
<ul>
<li class="toclevel-2 tocsection-24">
<a href="#Desktop"><span class="tocnumber">6.1</span> <span class="toctext">Desktop</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="#Calendar"><span class="tocnumber">6.1.1</span> <span class="toctext">Calendar</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Contacts"><span class="tocnumber">6.1.2</span> <span class="toctext">Contacts</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Mounting_files_with_davfs2"><span class="tocnumber">6.1.3</span> <span class="toctext">Mounting files with davfs2</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-28"><a href="#Mounting_files_in_GNOME_Files_(Nautilus)"><span class="tocnumber">6.2</span> <span class="toctext">Mounting files in GNOME Files (Nautilus)</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Android"><span class="tocnumber">6.3</span> <span class="toctext">Android</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#iOS"><span class="tocnumber">6.4</span> <span class="toctext">iOS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31">
<a href="#Tips_and_tricks"><span class="tocnumber">7</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="#Running_Nextcloud_in_a_subdirectory"><span class="tocnumber">7.1</span> <span class="toctext">Running Nextcloud in a subdirectory</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Docker"><span class="tocnumber">7.2</span> <span class="toctext">Docker</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Upload_and_share_from_File_Manager"><span class="tocnumber">7.3</span> <span class="toctext">Upload and share from File Manager</span></a></li>
<li class="toclevel-2 tocsection-35">
<a href="#Defining_Background_Jobs"><span class="tocnumber">7.4</span> <span class="toctext">Defining Background Jobs</span></a>
<ul>
<li class="toclevel-3 tocsection-36"><a href="#Manual_install"><span class="tocnumber">7.4.1</span> <span class="toctext">Manual install</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="#Activate_timer"><span class="tocnumber">7.4.2</span> <span class="toctext">Activate timer</span></a></li>
<li class="toclevel-3 tocsection-38"><a href="#AUR_package"><span class="tocnumber">7.4.3</span> <span class="toctext">AUR package</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-39">
<a href="#Collabora_Online_Office_integration"><span class="tocnumber">7.5</span> <span class="toctext">Collabora Online Office integration</span></a>
<ul>
<li class="toclevel-3 tocsection-40"><a href="#Solution_with_Docker"><span class="tocnumber">7.5.1</span> <span class="toctext">Solution with Docker</span></a></li>
<li class="toclevel-3 tocsection-41"><a href="#Solution_without_Docker"><span class="tocnumber">7.5.2</span> <span class="toctext">Solution without Docker</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-42"><a href="#Using_the_ownCloud_console"><span class="tocnumber">7.6</span> <span class="toctext">Using the ownCloud console</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Disabling_app_recommendations"><span class="tocnumber">7.7</span> <span class="toctext">Disabling app recommendations</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-44">
<a href="#Troubleshooting"><span class="tocnumber">8</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-45"><a href="#Environment_variables_not_available"><span class="tocnumber">8.1</span> <span class="toctext">Environment variables not available</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="#Self-signed_certificate_not_accepted"><span class="tocnumber">8.2</span> <span class="toctext">Self-signed certificate not accepted</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#Self-signed_certificate_for_Android_devices"><span class="tocnumber">8.3</span> <span class="toctext">Self-signed certificate for Android devices</span></a></li>
<li class="toclevel-2 tocsection-48"><a href="#Cannot_write_into_config_directory!"><span class="tocnumber">8.4</span> <span class="toctext">Cannot write into config directory!</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="#Cannot_create_data_directory"><span class="tocnumber">8.5</span> <span class="toctext">Cannot create data directory</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="#CSync_failed_to_find_a_specific_file."><span class="tocnumber">8.6</span> <span class="toctext">CSync failed to find a specific file.</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="#Seeing_white_page_after_login"><span class="tocnumber">8.7</span> <span class="toctext">Seeing white page after login</span></a></li>
<li class="toclevel-2 tocsection-52"><a href="#GUI_sync_client_fails_to_connect"><span class="tocnumber">8.8</span> <span class="toctext">GUI sync client fails to connect</span></a></li>
<li class="toclevel-2 tocsection-53"><a href="#GUI_tray_icon_disappears,_but_client_still_running_in_the_background"><span class="tocnumber">8.9</span> <span class="toctext">GUI tray icon disappears, but client still running in the background</span></a></li>
<li class="toclevel-2 tocsection-54"><a href="#Some_files_upload,_but_give_an_error_'Integrity_constraint_violation...'"><span class="tocnumber">8.10</span> <span class="toctext">Some files upload, but give an error 'Integrity constraint violation...'</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="#%22Cannot_write_into_apps_directory%22"><span class="tocnumber">8.11</span> <span class="toctext">"Cannot write into apps directory"</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="#Installed_apps_get_blocked_because_of_MIME_type_error"><span class="tocnumber">8.12</span> <span class="toctext">Installed apps get blocked because of MIME type error</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="#CSS_and_JS_resources_blocked_due_to_MIME_type_error"><span class="tocnumber">8.13</span> <span class="toctext">CSS and JS resources blocked due to MIME type error</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#Security_warnings_even_though_the_recommended_settings_have_been_included_in_nginx.conf"><span class="tocnumber">8.14</span> <span class="toctext">Security warnings even though the recommended settings have been included in nginx.conf</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="#%22Reading_from_keychain_failed_with_error:_'No_keychain_service_available'%22"><span class="tocnumber">8.15</span> <span class="toctext">"Reading from keychain failed with error: 'No keychain service available'"</span></a></li>
<li class="toclevel-2 tocsection-60"><a href="#FolderSync:_%22Method_Not_Allowed%22"><span class="tocnumber">8.16</span> <span class="toctext">FolderSync: "Method Not Allowed"</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-61"><a href="#See_also"><span class="tocnumber">9</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Prerequisites">Prerequisites</span></h2>
<p>Nextcloud requires several components:<a rel="nofollow" class="external autonumber" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/system_requirements.html#server">[1]</a>
</p>
<ul>
<li>A web server: <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a> or <a href="../en/Nginx.html" title="Nginx">nginx</a>
</li>
<li>A database: <a href="../en/MariaDB.html" title="MariaDB">MariaDB</a>/MySQL, <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>, <a href="../en/SQLite.html" title="SQLite">SQLite</a> or <a href="../en/Oracle_Database.html" title="Oracle Database">Oracle Database</a>
</li>
<li>
<a href="../en/PHP.html" title="PHP">PHP</a> with <a href="#PHP_setup">additional modules</a>
</li>
</ul>
<p>These will be configured in <a href="#Setup">#Setup</a>.
</p>
<p>Make sure the required components are installed before proceeding.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package.
</p>
<h3><span class="mw-headline" id="Pacman_hook">Pacman hook</span></h3>
<p>To upgrade the Nextcloud database automatically on updates, you may want to create a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/nextcloud.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Install
Operation = Upgrade
Type = Package
Target = nextcloud
Target = nextcloud-app-*
  
[Action]
Description = Update Nextcloud installation
When = PostTransaction
Exec = /usr/bin/runuser -u http -- /usr/bin/php /usr/share/webapps/nextcloud/occ upgrade</pre>
<h2><span class="mw-headline" id="Setup">Setup</span></h2>
<p>As stated above, in order to set up Nextcloud, you must set up the appropriate PHP requirements;
additionally, you must configure a database and a webserver.
</p>
<h3><span class="mw-headline" id="PHP_setup">PHP setup</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> For all prerequisite PHP modules, see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/source_installation.html#prerequisites-label">upstream documentation</a>.</div>
<p>Make sure that <code>session.save_path</code> is configured. Install <a href="../en/PHP.html#gd" title="PHP">PHP#gd</a> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-intl">php-intl</a></span> as additional modules. Configure <a href="../en/PHP.html#OPCache" title="PHP">OPcache</a> as recommended by <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/server_tuning.html#enable-php-opcache">the documentation</a>.
</p>
<p>Some apps (e.g. <i>News</i>) require the <code>iconv</code> extension. If you wish to use these apps, uncomment the extension in <code>/etc/php/php.ini</code>.
</p>
<p>Depending on which database backend will be used:
</p>
<ul>
<li>For <a href="../en/MySQL.html" title="MySQL">MySQL</a>, see <a href="../en/PHP.html#MySQL/MariaDB" title="PHP">PHP#MySQL/MariaDB</a>.</li>
<li>For <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>, see <a href="../en/PHP.html#PostgreSQL" title="PHP">PHP#PostgreSQL</a>.</li>
<li>For <a href="../en/SQLite.html" title="SQLite">SQLite</a>, see <a href="../en/PHP.html#Sqlite" title="PHP">PHP#Sqlite</a>.</li>
</ul>
<p>Performance may be improved through the implementation of <a href="../en/PHP.html#Caching" title="PHP">caching</a>, see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/caching_configuration.html">Configuring Memory Caching</a> on the official documentation for details.
</p>
<h3><span class="mw-headline" id="Database_setup">Database setup</span></h3>
<p>An SQL database must be set up and used for your Nextcloud installation. After setting up the database here,
you will be prompted for its information when you first create an administrator account.
</p>
<h4><span class="mw-headline" id="MariaDB">MariaDB</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Create or convert the database with MySQL 4-byte support in order to use Emojis (textbased smilies) on your Nextcloud server <a rel="nofollow" class="external autonumber" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_database/mysql_4byte_support.html">[2]</a>.</div>
<p>If you want to use Emojis, replace the following CREATE DATABASE... with:
</p>
<pre>mysql&gt; CREATE DATABASE <b>nextcloud</b> DEFAULT CHARACTER SET 'utf8mb4' COLLATE 'utf8mb4_general_ci';</pre>
<p>It is recommended to set up an own database and user when using <a href="../en/MariaDB.html" title="MariaDB">MariaDB</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ mysql -u root -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mysql&gt; CREATE DATABASE <b>nextcloud</b> DEFAULT CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci';
mysql&gt; GRANT ALL PRIVILEGES ON <b>nextcloud</b>.* TO '<b>nextcloud'</b>@'localhost' IDENTIFIED BY '<b>password'</b>;
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; \q</pre>
<h4><span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h4>
<p>The following is an example of setting up a <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> user and database:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">[postgres]$ createuser -h localhost -P nextcloud</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter password for new role:
Enter it again:</pre>
<pre>[postgres]$ createdb -O nextcloud nextcloud
</pre>
<h3><span class="mw-headline" id="Web_server_setup">Web server setup</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is recommended to use HTTPS instead of plain HTTP, see <a href="../en/Apache_HTTP_Server.html#TLS" title="Apache HTTP Server">Apache HTTP Server#TLS</a> or <a href="../en/Nginx.html#TLS" title="Nginx">Nginx#TLS</a> for examples and implement this in the examples given below.</div>
<p>Depending on which <a href="../en/List_of_applications/Internet.html#Web_servers" class="mw-redirect" title="Web server">web server</a> you are using, further setup is required, indicated below.
</p>
<h4><span class="mw-headline" id="Apache">Apache</span></h4>
<p>If you have not already, install <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a> and install and enable <a href="../en/Apache_HTTP_Server.html#PHP" title="Apache HTTP Server">Apache's PHP module</a>
</p>
<p>Copy the Apache configuration file to the configuration directory:
</p>
<pre># cp /etc/webapps/nextcloud/apache.example.conf /etc/httpd/conf/extra/nextcloud.conf
</pre>
<p>Modify the file according to your preferences. By default it includes an alias for <code>/nextcloud</code> pointing to <code>/usr/share/webapps/nextcloud</code>.
</p>
<p>And include it in <code>/etc/httpd/conf/httpd.conf</code>:
</p>
<pre>Include conf/extra/nextcloud.conf
</pre>
<p>Ensure that the root location of your Nextcloud installation (e.g., <code>/usr/share/webapps/nextcloud</code>) is accessible by the webserver's user <code>http</code>.
</p>
<p>Now restart Apache (<code>httpd.service</code>).
</p>
<h5><span class="mw-headline" id="WebDAV">WebDAV</span></h5>
<p>Nextcloud comes with its own <a href="../en/WebDAV.html" title="WebDAV">WebDAV</a> implementation enabled, which may conflict with the one shipped with Apache. If you have enabled WebDAV in Apache (not enabled by default), disable the modules <code>mod_dav</code> and <code>mod_dav_fs</code> in <code>/etc/httpd/conf/httpd.conf</code>. See <a rel="nofollow" class="external autonumber" href="https://forum.owncloud.org/viewtopic.php?f=17&amp;t=7240">[3]</a> for details.
</p>
<h4><span class="mw-headline" id="Nginx">Nginx</span></h4>
<p>Make sure PHP-FPM has been configured correctly as described in <a href="../en/Nginx.html#FastCGI" title="Nginx">Nginx#FastCGI</a>. Uncomment <code>env[PATH]</code> in <code>/etc/php/php-fpm.d/www.conf</code> as it is required by Nextcloud.
</p>
<p>Remember to set up <code>env[TMP]</code> in <code>/etc/php/php-fpm.d/www.conf</code> and make sure the directory is writable from the Nginx user.
</p>
<p>Create a <a href="../en/Nginx.html#Server_blocks" title="Nginx">server block</a> and add the content according to the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html">Nextcloud documentation</a>:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Use <code>unix:/run/php-fpm/php-fpm.sock;</code> as <code>server</code> in the <code>upstream php-handler</code> block if you use the default configuration of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-fpm">php-fpm</a></span>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Use <code>/usr/share/webapps/nextcloud</code> as <code>root</code> location when using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span>.</div>
<h4><span class="mw-headline" id="lighttpd">lighttpd</span></h4>
<p>Enable <a href="../en/Lighttpd.html#FastCGI" title="Lighttpd">lighttpd#FastCGI</a>, e.g. by adding <code>server.modules += ( "mod_fastcgi" )</code> to <code>/etc/lighttpd/lighttpd.conf</code>.
</p>
<p>Create a link to <code>/usr/share/webapps/nextcloud</code> in your <code>/srv/http/</code> directory (or configured root).
</p>
<h3><span class="mw-headline" id="Create_data_storage_directory">Create data storage directory</span></h3>
<p>Nextcloud needs a directory to store all user files, which has to be writable for the web server. It is recommended to put this directory somewhere outside of <code>/usr</code>, e.g. <code>/var/nextcloud</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Replace <code>http</code> when using a different <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a>/<a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> for the web server.</div>
<pre># mkdir /var/nextcloud
# chown http:http /var/nextcloud
# chmod 750 /var/nextcloud
</pre>
<h3><span class="mw-headline" id="Fix_apps_directory_permissions">Fix apps directory permissions</span></h3>
<p>To give the web server read/write access to the <i>apps</i> directory (e.g. on "Cannot write into "apps" directory"), setup the correct permissions:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Replace <code>http</code> when using a different <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a>/<a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> for the web server.</div>
<pre># mkdir -p /usr/share/webapps/nextcloud/data
# chown -R http:http /usr/share/webapps/nextcloud/{apps,data}
# chmod 750 /usr/share/webapps/nextcloud/{apps,data}
</pre>
<h3><span class="mw-headline" id="Explicitly_permit_Nextcloud_directories_for_php-fpm">Explicitly permit Nextcloud directories for php-fpm</span></h3>
<p>Since version 7.4 php-fpm is hardened per default and revokes read/write access on <code>/usr</code> (and sub-directories). Therefore it is also necessary to explicitly give permissions on <code>/usr/share/webapps/nextcloud</code> directories and the Nextcloud data directory (<code>/var/nextcloud</code> in the example above).
</p>
<p>Create an <code>override.conf</code> for <code>php-fpm</code>:
</p>
<pre># systemctl edit php-fpm.service
</pre>
<p>Add and save following content.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/php-fpm.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ReadWritePaths = /usr/share/webapps/nextcloud/apps
ReadWritePaths = /usr/share/webapps/nextcloud/data
ReadWritePaths = /etc/webapps/nextcloud/config

# Replace the following path with the Nextcloud data directory
ReadWritePaths = /var/nextcloud</pre>
<p>Afterwards <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> the <code>php-fpm</code> service. <code>ReadWritePaths = /usr/share/webapps/nextcloud/</code> is also required for the internal Nextcloud update process.
</p>
<h2><span class="mw-headline" id="Initialize">Initialize</span></h2>
<p>Open the address where you have installed Nextcloud in a web browser (e.g., <a rel="nofollow" class="external free" href="https://www.example.com/nextcloud">https://www.example.com/nextcloud</a>). Enter the database details and the location of the data directory (e.g. <code>/var/nextcloud</code>) set up above.
</p>
<p>If you get the error message "Cannot write into "apps" directory", make sure you followed <a href="#Fix_apps_directory_permissions">#Fix apps directory permissions</a> above.
</p>
<h3><span class="mw-headline" id="Configure_caching">Configure caching</span></h3>
<p>It is recommended to <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/caching_configuration.html">enable caching</a>. The Nextcloud documentation provides instructions on <a href="../en/Redis.html" title="Redis">Redis</a>, Memcached and <a href="../en/PHP.html#APCu" title="PHP">APCu</a>.
</p>
<h2><span class="mw-headline" id="Security_Hardening">Security Hardening</span></h2>
<p>See the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/harden_server.html">Nextcloud documentation</a> and <a href="../en/Security.html" title="Security">Security</a>. Nextcloud additionally provides a <a rel="nofollow" class="external text" href="https://scan.nextcloud.com/">Security scanner</a>.
</p>
<h3><span class="mw-headline" id="uWSGI">uWSGI</span></h3>
<p>You can run Nextcloud in its own process and service by using the <a href="../en/UWSGI.html" title="UWSGI">uWSGI</a> application server with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi-plugin-php">uwsgi-plugin-php</a></span>. This allows you to define a <a href="../en/PHP.html#Configuration" title="PHP">PHP  configuration</a> only for this instance of PHP, without the need to edit the global <code>php.ini</code> and thus keeping your web application configurations compartmentalized. <i>uWSGI</i> itself has a wealth of features to limit the resource use and to harden the security of the application, and by being a separate process it can run under its own user.
</p>
<p>The only part that differs from <a href="#Nginx">#Nginx</a> is the <code>location ~ \.php(?:$|/) {}</code> block:
</p>
<pre>  location ~ \.php(?:$|/) {
    include uwsgi_params;
    uwsgi_modifier1 14;
    # Avoid duplicate headers confusing OC checks
    uwsgi_hide_header X-Frame-Options;
    uwsgi_hide_header X-XSS-Protection;
    uwsgi_hide_header X-Content-Type-Options;
    uwsgi_hide_header X-Robots-Tag;
    uwsgi_pass unix:/run/uwsgi/nextcloud.sock;
    }
</pre>
<p>Then create a config file for <i>uWSGI</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/nextcloud.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[uwsgi]
; load the required plugins
plugins = php
; force the sapi name to 'apache', this will enable the opcode cache  
php-sapi-name = apache

; set master process name and socket
; '%n' refers to the name of this configuration file without extension
procname-master = uwsgi %n
master = true
socket = /run/uwsgi/%n.sock

; drop privileges
uid    = http
gid    = http
umask  = 027

; run with at least 1 process but increase up to 4 when needed
processes = 4
cheaper = 1

; reload whenever this config file changes
; %p is the full path of the current config file
touch-reload = %p

; disable uWSGI request logging
;disable-logging = true

; enforce a DOCUMENT_ROOT
php-docroot     = /usr/share/webapps/%n
; limit allowed extensions
php-allowed-ext = .php
; and search for index.php if required
php-index = index.php

; set php configuration for this instance of php, no need to edit global php.ini
php-set = date.timezone=Etc/UTC
;php-set = open_basedir=/tmp/:/usr/share/webapps/nextcloud:/etc/webapps/nextcloud:/dev/urandom
php-set = expose_php=false
; avoid security risk of leaving sessions in world-readable /tmp
php-set = session.save_path=/usr/share/webapps/nextcloud/data

; port of php directives set upstream in /usr/share/webapps/nextcloud/.user.ini for use with PHP-FPM
php-set = upload_max_filesize=513M
php-set = post_max_size=513M
php-set = memory_limit=512M
php-set = output_buffering=off

; load all extensions only in this instance of php, no need to edit global php.ini
;; required core modules
php-set = extension=gd
php-set = extension=iconv
;php-set = extension=zip     # enabled by default in global php.ini

;; database connectors
;; uncomment your selected driver
;php-set = extension=pdo_sqlite
;php-set = extension=pdo_mysql
;php-set = extension=pdo_pgsql

;; recommended extensions
;php-set = extension=curl    # enabled by default in global php.ini
php-set = extension=bz2
php-set = extension=intl

;; required for specific apps
;php-set = extension=ldap    # for LDAP integration
;php-set = extension=ftp     # for FTP storage / external user authentication
;php-set = extension=imap    # for external user authentication, requires php-imap

;; recommended for specific apps
;php-set = extension=exif    # for image rotation in pictures app, requires exiv2
;php-set = extension=gmp     # for SFTP storage

;; for preview generation
;; provided by packages in AUR
; php-set = extension=imagick

; opcache
php-set = zend_extension=opcache

; user cache
; provided by php-acpu, to be enabled **either** here **or** in /etc/php/conf.d/apcu.ini
php-set = extension=apcu
; per https://github.com/krakjoe/apcu/blob/simplify/INSTALL
php-set = apc.ttl=7200
php-set = apc.enable_cli=1

; web server is already handling URL rewriting, so tell NextCloud not to repeat this
env = front_controller_active=true

cron2 = minute=-15,unique=1 /usr/bin/php -f /usr/share/webapps/nextcloud/cron.php 1&gt;/dev/null
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> * Do not forget to set your timezone and uncomment the required database connector in the uWSGI config file
<ul>
<li>The <a href="../en/PHP.html#Configuration" title="PHP">open_basedir</a> directive is optional and commented out. You can uncomment to harden security. Be aware that it may <a rel="nofollow" class="external text" href="https://github.com/owncloud/core/search?q=open_basedir&amp;type=Issues">occasionally break things</a>.</li>
<li>Use <code>php-docroot = /usr/share/webapps</code> if placing nextcloud in /nextcloud subdirectory.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The way the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/background_jobs_configuration.html">Nextcloud background job</a> is currently set up with <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.org/en/latest/Cron.html">uWSGI cron</a> will make use of the default global configuration from <code>/etc/php/php.ini</code>. This means that none of the specific parameters defined (e.g. required modules) will be enabled, <a rel="nofollow" class="external text" href="https://github.com/owncloud/core/issues/12678#issuecomment-66114448">leading to various issues</a>. One solution is to copy <code>/etc/php/php.ini</code> to e.g. <code>/etc/uwsgi/cron-php.ini</code>, make the required modifications there (mirroring <code>/etc/uwsgi/nextcloud.ini</code> parameters) and referencing it in the cron directive by adding the <code>-c /etc/uwsgi/cron-php.ini</code> option to <i>php</i> invocation.</div>
<h4><span class="mw-headline" id="Activation">Activation</span></h4>
<p><a href="../en/UWSGI.html" title="UWSGI">uWSGI</a> provides a <a href="../en/Systemd.html#Using_units" title="Systemd">template unit</a> that allows to start and enable application using their configuration file name as instance identifier. For example, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">starting</a> <code>uwsgi@nextcloud.socket</code> would start it on demand referencing the configuration file <code>/etc/uwsgi/nextcloud.ini</code>. 
</p>
<p>To enable the uwsgi service by default at start-up, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>uwsgi@nextcloud.socket</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Here we make use of <a rel="nofollow" class="external text" href="http://0pointer.de/blog/projects/socket-activation.html">systemd socket activation</a> to prevent unnecessary resources consumption when no connections are made to the instance. If you would rather have it constantly active, simply remove the <code>.socket</code> part to start and enable the service instead.</div>
<p>See also <a href="../en/UWSGI.html#Running_uWSGI" title="UWSGI">UWSGI#Running uWSGI</a>.
</p>
<h3><span class="mw-headline" id="Setting_strong_permissions_for_the_filesystem">Setting strong permissions for the filesystem</span></h3>
<p>You should set the permissions for <code>config/</code>, <code>data/</code> and <code>apps/</code> as strict possible. That means that your HTTP user (<i>http</i> in case of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span>) should own them, and the should have <code>700</code> permissions. You can use the following script to achieve this.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Complex script for trivial one-time task. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Nextcloud">Talk:Nextcloud#</a>)</div>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">oc-perms</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
ocpath='/usr/share/webapps/nextcloud'
htuser='http'
htgroup='http'
rootuser='root'

printf "Creating possible missing Directories\n"
mkdir -p $ocpath/data
mkdir -p $ocpath/assets

printf "chmod Files and Directories\n"
find ${ocpath}/ -type f -print0 | xargs -0 chmod 0640
find ${ocpath}/ -type d -print0 | xargs -0 chmod 0750

printf "chown Directories\n"
chown -R ${rootuser}:${htgroup} ${ocpath}/
chown -R ${htuser}:${htgroup} ${ocpath}/apps/
chown -R ${htuser}:${htgroup} ${ocpath}/assets/
chown -R ${htuser}:${htgroup} ${ocpath}/config/
chown -R ${htuser}:${htgroup} ${ocpath}/data/
chown -R ${htuser}:${htgroup} ${ocpath}/themes/
chown -R ${htuser}:${htgroup} ${ocpath}/updater/

chmod +x ${ocpath}/occ

printf "chmod/chown .htaccess\n"
if [ -f ${ocpath}/.htaccess ]
 then
  chmod 0644 ${ocpath}/.htaccess
  chown ${rootuser}:${htgroup} ${ocpath}/.htaccess
fi
if [ -f ${ocpath}/data/.htaccess ]
 then
  chmod 0644 ${ocpath}/data/.htaccess
  chown ${rootuser}:${htgroup} ${ocpath}/data/.htaccess
fi
</pre>
<p>If you have customized your Nextcloud installation and your filepaths are different than the standard installation, then modify this script accordingly.
</p>
<h2><span class="mw-headline" id="Synchronization">Synchronization</span></h2>
<h3><span class="mw-headline" id="Desktop">Desktop</span></h3>
<p>The official client can be installed with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=owncloud-client">owncloud-client</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-client">nextcloud-client</a></span> package.
Alternative versions are available in the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/owncloud-client-git/">owncloud-client-git</a></span><sup><small>AUR</small></sup>. Additional packages are needed for some features:
</p>
<ul>
<li>
<b>Auto-login:</b> All of them use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qtkeychain">qtkeychain</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qtkeychain-qt5">qtkeychain-qt5</a></span>]</sup> to store and retrieve account-specific access tokens. To achieve auto-login when the client starts, one of optional dependencies of <i>qtkeychain</i> should be installed as well. Moreover, if you choose <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libsecret">libsecret</a></span> as the backend for <i>qtkeychain</i>, a service that provides <a rel="nofollow" class="external text" href="https://archlinux.org/packages/?q=org.freedesktop.secrets">org.freedesktop.secrets</a> should be running when the client starts.</li>
<li>
<b>File manager integration:</b> for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-client">nextcloud-client</a></span>, integration with file managers (e.g., show Nextcloud folders in GTK+ file dialogs) requires another package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-client-cloudproviders">nextcloud-client-cloudproviders</a></span>. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=owncloud-client">owncloud-client</a></span> already includes cloudproviders supports by default.</li>
</ul>
<h4><span class="mw-headline" id="Calendar">Calendar</span></h4>
<p>To access your Nextcloud calendars using Mozilla <a href="../en/Thunderbird.html" title="Thunderbird">Thunderbird</a>'s Lightning calendar you would use the following URL:
</p>
<pre>https://ADDRESS/remote.php/caldav/calendars/USERNAME/CALENDARNAME
</pre>
<p>To access your Nextcloud calendars using CalDAV-compatible programs like Kontact or <a href="../en/GNOME/Evolution.html" class="mw-redirect" title="Evolution">Evolution</a>, you would use the following URL:
</p>
<pre>https://ADDRESS/remote.php/caldav
</pre>
<p>For details see the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/user_manual/en/pim/index.html">official documentation</a>.
</p>
<h4><span class="mw-headline" id="Contacts">Contacts</span></h4>
<p>To sync contacts with <a href="../en/Thunderbird.html" title="Thunderbird">Thunderbird</a>, see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/user_manual/pim/sync_thunderbird.html">these instructions</a> from the official doc.
</p>
<h4><span class="mw-headline" id="Mounting_files_with_davfs2">Mounting files with davfs2</span></h4>
<p>If you want to mount your Nextcloud using WebDAV, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=davfs2">davfs2</a></span> (as described in <a href="../en/Davfs2.html" title="Davfs2">davfs2</a>).
</p>
<p>To mount your Nextcloud, use:
</p>
<pre># mount -t davfs https://<i>your_domain</i>/nextcloud/remote.php/dav/files/<i>username</i>/ /path/to/mount
</pre>
<p>You can also create an entry for this in <code>/etc/fstab</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">https://<i>your_domain</i>/nextcloud/remote.php/dav/files/<i>username</i>/ /path/to/mount davfs rw,user,noauto 0 0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In order to allow automount you can also store your username (and password if you like) in a file as described in <a href="../en/Davfs2.html#Storing_credentials" title="Davfs2">davfs2#Storing credentials</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If creating/copying files is not possible, while the same operations work on directories, see <a href="../en/Davfs2.html#Creating/copying_files_not_possible_and/or_freezes" title="Davfs2">davfs2#Creating/copying files not possible and/or freezes</a>.</div>
<h3>
<span id="Mounting_files_in_GNOME_Files_.28Nautilus.29"></span><span class="mw-headline" id="Mounting_files_in_GNOME_Files_(Nautilus)">Mounting files in GNOME Files (Nautilus)</span>
</h3>
<p>You can access the files directly in Nautilus ('+ Other Locations') through WebDAV protocol - use the link as shown in your Nextcloud installation Web GUI (typically: <a rel="nofollow" class="external free" href="https://example.org/remote.php/webdav/">https://example.org/remote.php/webdav/</a>) but replace the protocol name from 'https' to 'davs'. Nautilus will ask for user name and password when trying to connect.
</p>
<h3><span class="mw-headline" id="Android">Android</span></h3>
<p>Download the official Nextcloud app from <a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=com.nextcloud.client">Google Play</a> or <a rel="nofollow" class="external text" href="https://f-droid.org/packages/com.nextcloud.client/">F-Droid</a>.
</p>
<p>To enable contacts and calendar sync (Android 4+):
</p>
<ol>
<li>download <a rel="nofollow" class="external text" href="https://www.davx5.com/">DAVx<sup>5</sup></a> (<a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=at.bitfire.davdroid">Play Store</a>, <a rel="nofollow" class="external text" href="https://f-droid.org/app/at.bitfire.davdroid">F-Droid</a>)</li>
<li>Enable mod_rewrite.so in httpd.conf</li>
<li>create a new DAVdroid account in the <i>Account</i> settings, and specify your "short" server address and login/password couple, e.g. <code>https://cloud.example.com</code> (there is no need for the <code>/remote.php/{carddav,webdav}</code> part if you configured your web server with the proper redirections, as illustrated previously in the article; <i>DAVdroid</i> will find itself the right URLs)</li>
</ol>
<h3><span class="mw-headline" id="iOS">iOS</span></h3>
<p>Download the official Nextcloud app from the <a rel="nofollow" class="external text" href="https://itunes.apple.com/us/app/nextcloud/id1125420102">App Store</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Running_Nextcloud_in_a_subdirectory">Running Nextcloud in a subdirectory</span></h3>
<p>By including the default <code>nextcloud.conf</code> in <code>httpd.conf</code>, Nextcloud will take control of port 80 and your localhost domain. 
</p>
<p>If you would like to have Nextcloud run in a subdirectory, then 
</p>
<p>For apache, edit the <code>/etc/httpd/conf/extra/nextcloud.conf</code> you included and comment out the <code>&lt;VirtualHost *:80&gt; ... &lt;/VirtualHost&gt;</code> part of the include file.
</p>
<p>For nginx, you can use the following config when using Nextcloud with uwsgi:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/conf.d/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">location = /.well-known/carddav {
  return 301 $scheme://$host/nextcloud/remote.php/dav;
}

location = /.well-known/caldav {
  return 301 $scheme://$host/nextcloud/remote.php/dav;
}

location /.well-known/acme-challenge { }

location ^~ /nextcloud {

  root /usr/share/webapps;

  # set max upload size
  client_max_body_size 512M;
  fastcgi_buffers 64 4K;

  # Disable gzip to avoid the removal of the ETag header
  gzip off;

  # Uncomment if your server is build with the ngx_pagespeed module
  # This module is currently not supported.
  #pagespeed off;

  location /nextcloud {
    rewrite ^ /nextcloud/index.php$uri;
  }

  location ~ ^/nextcloud/(?:build|tests|config|lib|3rdparty|templates|data)/ {
    deny all;
  }

  location ~ ^/nextcloud/(?:\.|autotest|occ|issue|indie|db_|console) {
    deny all;
  }

  location ~ ^/nextcloud/(?:updater|ocs-provider)(?:$|/) {
    try_files $uri/ =404;
    index index.php;
  }

  location ~ ^/nextcloud/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\.php(?:$|/) {
    include uwsgi_params;
    uwsgi_modifier1 14;
    # Avoid duplicate headers confusing OC checks
    uwsgi_hide_header X-Frame-Options;
    uwsgi_hide_header X-XSS-Protection;
    uwsgi_hide_header X-Content-Type-Options;
    uwsgi_hide_header X-Robots-Tag;
    uwsgi_pass unix:/run/uwsgi/owncloud.sock;
  }

  # Adding the cache control header for js and css files
  # Make sure it is BELOW the PHP block
  location ~* \.(?:css|js) {
    try_files $uri /nextcloud/index.php$uri$is_args$args;
    add_header Cache-Control "public, max-age=7200";
    # Add headers to serve security related headers  (It is intended
    # to have those duplicated to the ones above)
    # Before enabling Strict-Transport-Security headers please read
    # into this topic first.
    # add_header Strict-Transport-Security "max-age=15768000;
    # includeSubDomains; preload;";
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Robots-Tag none;
    add_header X-Download-Options noopen;
    add_header X-Permitted-Cross-Domain-Policies none;
    # Optional: Do not log access to assets
    access_log off;
  }

  location ~* \.(?:svg|gif|png|html|ttf|woff|ico|jpg|jpeg) {
    try_files $uri /nextcloud/index.php$uri$is_args$args;
    # Optional: Do not log access to other assets
    access_log off;
  }
}
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Do not forget to configure the <code>.well-known</code> URLs for service discovery. For more information please see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/18/admin_manual/issues/general_troubleshooting.html#service-discovery">General troubleshooting and service discovery section of Nextcloud documentation</a>. </div>
<h3><span class="mw-headline" id="Docker">Docker</span></h3>
<p>See the <a rel="nofollow" class="external text" href="https://hub.docker.com/_/owncloud/">ownCloud</a> or <a rel="nofollow" class="external text" href="https://github.com/nextcloud/docker">Nextcloud</a> repository for <a href="../en/Docker.html" title="Docker">Docker</a>.
</p>
<h3><span class="mw-headline" id="Upload_and_share_from_File_Manager">Upload and share from File Manager</span></h3>
<p><a rel="nofollow" class="external text" href="https://github.com/schiesbn/shareLinkCreator">shareLinkCreator</a> provides the ability to upload a file to
OwnCloud via a supported file manager and receive a link to the uploaded file which can then be emailed or shared in another way.
</p>
<h3><span class="mw-headline" id="Defining_Background_Jobs">Defining Background Jobs</span></h3>
<p>Nextcloud requires scheduled execution of some tasks, and by default it achieves this by using AJAX,
however AJAX is the least reliable method, and it is recommended to use <a href="../en/Cron.html" title="Cron">Cron</a> instead. However,
ArchLinux ships with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span>, so the preferred way of executing scheduled tasks is a <a href="../en/Systemd/Timers.html" class="mw-redirect" title="Systemd timer">systemd timer</a>. 
</p>
<h4><span class="mw-headline" id="Manual_install">Manual install</span></h4>
<p>First create a service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nextcloudcron.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Nextcloud cron.php job

[Service]
User=http
ExecStart=/usr/bin/php -f /usr/share/webapps/nextcloud/cron.php

[Install]
WantedBy=basic.target
</pre>
<p>Then create a timer for that service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nextcloudcron.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Run Nextcloud cron.php every 5 minutes

[Timer]
OnBootSec=5min
OnUnitActiveSec=5min
Unit=nextcloudcron.service

[Install]
WantedBy=timers.target
</pre>
<h4><span class="mw-headline" id="Activate_timer">Activate timer</span></h4>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>nextcloudcron.timer</code>.
</p>
<p>Confirm that it is running by running
</p>
<pre># systemctl list-timers
</pre>
<h4><span class="mw-headline" id="AUR_package">AUR package</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nextcloud-systemd-timers/">nextcloud-systemd-timers</a></span><sup><small>AUR</small></sup>.
</p>
<p>Provided services can be checked with:
</p>
<pre>$ pacman -Ql nextcloud-systemd-timers
</pre>
<p>For instance, to run the <code>cron.php</code> script every 5 minutes:
</p>
<pre># systemctl start nextcloud-cron.timer
# systemctl enable nextcloud-cron.timer
</pre>
<h3><span class="mw-headline" id="Collabora_Online_Office_integration">Collabora Online Office integration</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> What is the correct <code>domain</code> (or <code>server_name</code> in the config) when <a href="#Running_NextCloud_in_a_subdirectory">Nextcloud runs in a subdirectory</a>? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Nextcloud">Talk:Nextcloud#</a>)</div>
</div>
<h4><span class="mw-headline" id="Solution_with_Docker">Solution with Docker</span></h4>
<p>The first, install a <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker">docker</a></span> package to provide collabora files and setup a Collabora server.
</p>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>docker.service</code>.
</p>
<p>Then, download the official Docker image:
</p>
<pre># docker pull collabora/code
</pre>
<p>And, installing a Collabora server. Make sure <code>cloud//.example//.com</code> is your nextcloud's domain, not a collabora :
</p>
<pre># docker run -t -d -p 127.0.0.1:9980:9980 -e "domain=cloud\\.example\\.com" --restart always --cap-add MKNOD collabora/code
</pre>
<p>Also make sure to escape all dots with double backslashes (\), since this string will be evaluated as a regular expression (and your bash 'eats' the first backslash.) If you want to use the docker container with more than one Nextcloud, you will need to use 'domain=cloud\\.example\\.com\|second\\.example\\.com' instead. (All hosts are separated by \|.) When using `localhost` as domain for testing you need to add <code>--net host</code> to ensure the docker container can access your Nextcloud server. 
</p>
<p>If you need to delete or reinstall Collabora server use:
</p>
<p>For recognition CONTAINER_ID of server
</p>
<pre># docker ps
</pre>
<p>Stop and delete
</p>
<pre># docker stop CONTAINER_ID
# docker rm CONTAINER_ID
</pre>
<p>Futher, follow the instruction of webserver you are using:
</p>
<p><b>Nginx setup example:</b>
</p>
<p>Add following to your nextcloud domain config or add new config file in /etc/nginx/conf.d/ directory, (Do not forget to change <code>office.example.com</code> and <code>ssl_certificate</code> to the right values. If you are using docker image, change <code>http</code> to <code>https</code>.)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/conf.d/example.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> upstream office.example.com {
    server 127.0.0.1:9980;
}

server {
    listen 443 ssl;
    server_name office.example.com;
 
    ssl_certificate /etc/letsencrypt/live/office.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/office.example.com/privkey.pem;

    # static files
    location ^~ /loleaflet {
        proxy_pass http://127.0.0.1:9980;
        proxy_set_header Host $host;
    }

    # WOPI discovery URL
    location ^~ /hosting/discovery {
        proxy_pass http://127.0.0.1:9980;
        proxy_set_header Host $host;
    }

    # Main websocket
    location ~ /lool/(.*)/ws$ {
        proxy_pass http://127.0.0.1:9980;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 36000s;
    }

    # Admin Console websocket
    location ^~ /lool/adminws {
	proxy_buffering off;
        proxy_pass http://127.0.0.1:9980;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 36000s;
    }

    # download, presentation and image upload
    location ~ /lool {
        proxy_pass http://127.0.0.1:9980;
        proxy_set_header Host $host;
    }
}
</pre>
<p>Restart a nginx:
</p>
<pre># nginx -s reload
</pre>
<p>or <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> <code>nginx.service</code>.
</p>
<p><b>Apache setup example:</b>
</p>
<p>Add following to nextcloud config file. Do not forget to change to the right values
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;VirtualHost *:443&gt;
ServerName office.nextcloud.com:443

# SSL configuration, you may want to take the easy route instead and use Lets Encrypt!
SSLEngine on
SSLCertificateFile /path/to/signed_certificate
SSLCertificateChainFile /path/to/intermediate_certificate
SSLCertificateKeyFile /path/to/private/key
SSLProtocol             all -SSLv2 -SSLv3
SSLCipherSuite ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS
SSLHonorCipherOrder     on

# Encoded slashes need to be allowed
AllowEncodedSlashes NoDecode

# Container uses a unique non-signed certificate
SSLProxyEngine On
SSLProxyVerify None
SSLProxyCheckPeerCN Off
SSLProxyCheckPeerName Off

# keep the host
ProxyPreserveHost On

# static html, js, images, etc. served from loolwsd
# loleaflet is the client part of LibreOffice Online
ProxyPass           /loleaflet https://127.0.0.1:9980/loleaflet retry=0
ProxyPassReverse    /loleaflet https://127.0.0.1:9980/loleaflet

# WOPI discovery URL
ProxyPass           /hosting/discovery https://127.0.0.1:9980/hosting/discovery retry=0
ProxyPassReverse    /hosting/discovery https://127.0.0.1:9980/hosting/discovery

# Main websocket
ProxyPassMatch "/lool/(.*)/ws$" wss://127.0.0.1:9980/lool/$1/ws nocanon

# Admin Console websocket
ProxyPass   /lool/adminws wss://127.0.0.1:9980/lool/adminws

# Download as, Fullscreen presentation and Image upload operations
ProxyPass           /lool https://127.0.0.1:9980/lool
ProxyPassReverse    /lool https://127.0.0.1:9980/lool
&lt;/VirtualHost&gt;
</pre>
<p>After configuring these do restart your apache by <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restarting</a> <code>httpd.service</code>.
</p>
<p><b>Install the Nextcloud app</b>
</p>
<p>Go to the Apps section and choose “Office &amp; Text”, install the “Collabora Online” app. In admin panel select Collabora Online tab and specific the server's domain you have setup before.
</p>
<h4><span class="mw-headline" id="Solution_without_Docker">Solution without Docker</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/collabora-online-server-nodocker/">collabora-online-server-nodocker</a></span><sup><small>AUR</small></sup> package provides the Collabora Office (the desktop suite) and the “CODE” (Collabora Online Development Edition) server, which is based on “lool” (LibreOffice OnLine).
</p>
<p>Alter the <code>/etc/loolwsd/loolwsd.xml</code> file, so that:
</p>
<ul>
<li>
<code>config &gt; server_name</code> contains the host and port of the public Nextcloud address, separated by a colon (e.g. <code>example.org:443</code>),</li>
<li>
<code>config &gt; ssl &gt; enable</code> is false (i.e. web browser —HTTPS→ proxy —HTTP→ loolwsd),</li>
<li>
<code>config &gt; ssl &gt; termination</code> is true (I suppose you’ll manage TLS at the proxy level),</li>
<li>
<code>config &gt; storage &gt; wopi &gt; host</code> reflects the actual hostname (or pattern) of the proxy server (e.g. <code>(?:.*\.)?example\.org</code>),</li>
<li>
<code>config &gt; admin_console &gt; username</code> and <code>config &gt; admin_console &gt; password</code> are set to values of your choice.</li>
</ul>
<p>Then:
</p>
<ul>
<li>
<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>loolwsd.service</code>;</li>
<li>configure Nginx by creating a <a href="../en/Nginx.html#Server_blocks" title="Nginx">server block</a> including <code>/etc/nginx/snippets/loolwsd.conf</code>, and restart it. Example with SSL (change <code>office.example.com</code> and <code>ssl_certificate</code> to the right values):</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/conf.d/example.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server {
    listen 443 ssl;
    server_name office.example.com;

    ssl_certificate /etc/letsencrypt/live/office.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/office.example.com/privkey.pem;

    include snippets/loolwsd.conf;
}
</pre>
<ul><li>in Nextcloud, install the "Collabora Online" app. In the admin panel select the Collabora Online tab and specify the server domain name you have just set up.</li></ul>
<h3><span class="mw-headline" id="Using_the_ownCloud_console">Using the ownCloud console</span></h3>
<p>A useful tool for server administration is <code>occ</code>, documented <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/20/admin_manual/configuration_server/occ_command.html">here</a>. You can perform many common server operations with occ, such as managing users and configuring apps.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Ensure you run the occ command as your nextcloud user (such as <code>http</code>), to prevent permission issues.</div>
<h3><span class="mw-headline" id="Disabling_app_recommendations">Disabling app recommendations</span></h3>
<p>By default, nextcloud reccomends apps to new clients, which can result in a lot of notifications. To disable this, disable the recommendation app using <code>occ</code>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> A lot of references to OwnCloud, are these still valid with Nextcloud? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Nextcloud">Talk:Nextcloud#</a>)</div>
</div>
<p>By default, the <code>nextcloud.log</code> is available in <code>/usr/share/webapps/nextcloud/data/</code>.
</p>
<h3><span class="mw-headline" id="Environment_variables_not_available">Environment variables not available</span></h3>
<p>Uncomment the line in <code>/etc/php/php-fpm.d/www.conf</code> as per <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/source_installation.html#php-fpm-tips-label">Nextcloud documentation</a>:
</p>
<pre> env[PATH] = /usr/local/bin:/usr/bin:/bin
</pre>
<h3><span class="mw-headline" id="Self-signed_certificate_not_accepted">Self-signed certificate not accepted</span></h3>
<p>ownCloud uses <a href="https://en.wikipedia.org/wiki/cURL" class="extiw" title="wikipedia:cURL">Wikipedia:cURL</a> and <a href="https://en.wikipedia.org/wiki/SabreDAV" class="extiw" title="wikipedia:SabreDAV">Wikipedia:SabreDAV</a> to check if WebDAV is enabled.
If you use SSL/TLS with a self-signed certificate, e.g. as shown in <a href="../en/Category:Web_applications.html" class="mw-redirect" title="LAMP">LAMP</a>, and access ownCloud's admin panel, you will see the following error message:
</p>
<pre>Your web server is not yet properly setup to allow files synchronization because the WebDAV interface seems to be broken.
</pre>
<p>Assuming that you followed the <a href="../en/Category:Web_applications.html" class="mw-redirect" title="LAMP">LAMP</a> tutorial, execute the following steps:
</p>
<p>Create a local directory for non-distribution certificates and copy <a href="../en/Category:Web_applications.html" class="mw-redirect" title="LAMP">LAMPs</a> certificate there. This will prevent <code>ca-certificates</code>-updates from overwriting it.
</p>
<pre># cp /etc/httpd/conf/server.crt /usr/share/ca-certificates/<i>WWW.EXAMPLE.COM.crt</i>
</pre>
<p>Add <i>WWW.EXAMPLE.COM.crt</i> to <code>/etc/ca-certificates.conf</code>:
</p>
<pre><i>WWW.EXAMPLE.COM.crt</i>
</pre>
<p>Now, regenerate your certificate store:
</p>
<pre># update-ca-certificates
</pre>
<p>Restart the httpd service to activate your certificate.
</p>
<h3><span class="mw-headline" id="Self-signed_certificate_for_Android_devices">Self-signed certificate for Android devices</span></h3>
<p>Once you have followed the setup for SSL, as on <a href="../en/Apache_HTTP_Server.html#TLS" title="Apache HTTP Server">Apache HTTP Server#TLS</a> for example, early versions of DAVdroid will
reject the connection because the certificate is not trusted. A certificate can be made as follows on your server:
</p>
<pre># openssl x509 -req -days 365 -in /etc/httpd/conf/server.csr -signkey /etc/httpd/conf/server.key -extfile android.txt -out CA.crt
# openssl x509 -inform PEM -outform DER -in CA.crt -out CA.der.crt 
</pre>
<p>The file <code>android.txt</code> should contain the following:
</p>
<pre>basicConstraints=CA:true
</pre>
<p>Then import <code>CA.der.crt</code> to your Android device:
</p>
<p>Put the <code>CA.der.crt</code> file onto the sdcard of your Android device (usually to the internal one, e.g. save from a mail attachment).
It should be in the root directory. Go to <i>Settings &gt; Security &gt; Credential storage</i> and select <i>Install from device storage</i>.
The <code>.crt</code> file will be detected and you will be prompted to enter a certificate name. After importing the certificate,
you will find it in <i>Settings &gt; Security &gt; Credential storage &gt; Trusted credentials &gt; User</i>.
</p>
<p>Thanks to: <a rel="nofollow" class="external autonumber" href="http://www.leftbrainthings.com/2013/10/13/creating-and-importing-self-signed-certificate-to-android-device/">[4]</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup>
</p>
<p>Another way is to import the certificate directly from your server via <a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=at.bitfire.cadroid">CAdroid</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup> and follow the instructions there.
</p>
<h3>
<span id="Cannot_write_into_config_directory.21"></span><span class="mw-headline" id="Cannot_write_into_config_directory!">Cannot write into config directory!</span>
</h3>
<p>If you have set <code>open_basedir</code> in your PHP/web server configuration file (e.g. <code>/etc/httpd/conf/extra/nextcloud.conf</code>), make sure that it includes <code>/etc/webapps</code>.
</p>
<p>Restart the web server to apply the change.
</p>
<p>If you are getting this error after an upgrade from Nextcloud 17 to Nextcloud 18, also see <a href="#Explicitly_permit_Nextcloud_directories_for_php-fpm">#Explicitly permit Nextcloud directories for php-fpm</a>.
</p>
<h3><span class="mw-headline" id="Cannot_create_data_directory">Cannot create data directory</span></h3>
<p>If you have set <code>open_basedir</code> in your PHP/web server configuration file (e.g. <code>/etc/httpd/conf/extra/nextcloud.conf</code>), make sure that it includes the data directory.
</p>
<p>Restart the web server to apply the change.
</p>
<h3><span class="mw-headline" id="CSync_failed_to_find_a_specific_file.">CSync failed to find a specific file.</span></h3>
<p>This is most likely a certificate issue. Recreate it, and do not leave the common name empty or you will see the error again.
</p>
<pre># openssl req -new -x509 -nodes -newkey rsa:4096 -keyout server.key -out server.crt
</pre>
<h3><span class="mw-headline" id="Seeing_white_page_after_login">Seeing white page after login</span></h3>
<p>The cause is probably a new app that you installed. To fix that, you can use the occ command as described
<a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html">here</a>. So with
</p>
<pre>sudo -u http php /usr/share/webapps/nextcloud/occ app:list
</pre>
<p>you can list all apps (if you installed nextcloud in the standard directory), and with 
</p>
<pre>sudo -u http php /usr/share/webapps/nextcloud/occ app:disable &lt;nameOfExtension&gt;
</pre>
<p>you can disable the troubling app.
</p>
<p>Alternatively, you can either use <a href="../en/PhpMyAdmin.html" title="PhpMyAdmin">phpMyAdmin</a> to edit the <code>oc_appconfig</code> table (if you got lucky and the table has an edit option), or do it by hand with mysql:
</p>
<pre>mysql -u root -p owncloud
MariaDB [owncloud]&gt; <b>delete from</b> oc_appconfig <b>where</b> appid='&lt;nameOfExtension&gt;' <b>and</b> configkey='enabled' <b>and</b> configvalue='yes';
MariaDB [owncloud]&gt; <b>insert into</b> oc_appconfig (appid,configkey,configvalue) <b>values</b> ('&lt;nameOfExtension&gt;','enabled','no');
</pre>
<p>This should delete the relevant configuration from the table and add it again.
</p>
<h3><span class="mw-headline" id="GUI_sync_client_fails_to_connect">GUI sync client fails to connect</span></h3>
<p>If using HTTP basic authentication, make sure to exclude "status.php", which must be publicly accessible. <a rel="nofollow" class="external autonumber" href="https://github.com/owncloud/mirall/issues/734">[5]</a>
</p>
<h3>
<span id="GUI_tray_icon_disappears.2C_but_client_still_running_in_the_background"></span><span class="mw-headline" id="GUI_tray_icon_disappears,_but_client_still_running_in_the_background">GUI tray icon disappears, but client still running in the background</span>
</h3>
<p>After waking up from a suspended state, the Nextcloud client tray icon may disappear from the system tray. A workaround is to delay the startup of the client, as noted <a rel="nofollow" class="external text" href="https://github.com/nextcloud/desktop/issues/203#issuecomment-463957811">here</a>. This can be done with the .desktop file, for example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">.local/share/applications/nextcloud.desktop</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Exec=bash -c 'sleep 5 &amp;&amp; nextcloud'
...
</pre>
<h3>
<span id="Some_files_upload.2C_but_give_an_error_.27Integrity_constraint_violation....27"></span><span class="mw-headline" id="Some_files_upload,_but_give_an_error_'Integrity_constraint_violation...'">Some files upload, but give an error 'Integrity constraint violation...'</span>
</h3>
<p>You may see the following error in the ownCloud sync client:
</p>
<pre>   SQLSTATE[23000]: Integrity constraint violation: ... Duplicate entry '...' for key 'fs_storage_path_hash')...
</pre>
<p>This is caused by an issue with the File Locking app, which is often not sufficient to keep conflicts from occurring on some webserver configurations.
A more complete <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_files/files_locking_transactional.html">Transactional File Locking</a>
is available that rids these errors, but you must be using the Redis php-caching method. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=redis">redis</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-redis">php-redis</a></span>, comment out
your current php-cache mechanism, and then in <code>/etc/php/conf.d/redis.ini</code> uncomment <code>extension=redis</code>.
Then in <code>config.php</code> make the following changes:
</p>
<pre>   'memcache.local' =&gt; '\OC\Memcache\Redis',
   'filelocking.enabled' =&gt; 'true',
   'memcache.locking' =&gt; '\OC\Memcache\Redis',
   'redis' =&gt; array(
        'host' =&gt; 'localhost',
        'port' =&gt; 6379,
        'timeout' =&gt; 0.0,
         ),
</pre>
<p>and <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>redis.service</code>.
</p>
<p>Finally, disable the File Locking App, as the Transational File Locking will take care of it (and would conflict).
</p>
<p>If everything is working, you should see 'Transactional File Locking Enabled' under Server Status on the Admin page, and syncs should no longer cause issues.
</p>
<h3>
<span id=".22Cannot_write_into_apps_directory.22"></span><span class="mw-headline" id='"Cannot_write_into_apps_directory"'>"Cannot write into apps directory"</span>
</h3>
<p>As mentioned in the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/apps_management.html">official admin manual</a>,
either you need an apps directory that is writable by the http user, or you need to set <code>appstoreenabled</code> to <code>false</code>. 
</p>
<p>If you have set <code>open_basedir</code> in your PHP/web server configuration file (e.g. <code>/etc/httpd/conf/extra/nextcloud.conf</code>), it may be necessary to add your <i>/path/to/data</i> directory to the string on the line starting with <code>php_admin_value open_basedir </code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">php_admin_value open_basedir "<i>/path/to/data/</i>:/srv/http/:/dev/urandom:/tmp/:/usr/share/pear/:/usr/share/webapps/nextcloud/:/etc/webapps/nextcloud"</pre>
<h3><span class="mw-headline" id="Installed_apps_get_blocked_because_of_MIME_type_error">Installed apps get blocked because of MIME type error</span></h3>
<p>If you are putting your apps folder outside of the nextcloud installation directory make sure your webserver serves it properly.
</p>
<p>In nginx this is accomplished by adding a location block to the nginx configuration as the folder will not be included in it by default.
</p>
<pre>location ~ /apps2/(.*)$ {
    alias /var/www/nextcloud/apps/$1;
}
</pre>
<h3><span class="mw-headline" id="CSS_and_JS_resources_blocked_due_to_MIME_type_error">CSS and JS resources blocked due to MIME type error</span></h3>
<p>If you load your Nextcloud web gui and it's missing styles etc. check the browser's console logs for lines like:
</p>
<pre>The resource from “https://example.com/core/css/guest.css?v=72c34c37-0” was blocked due to MIME type (“text/plain”) mismatch (X-Content-Type-Options: nosniff).
</pre>
<p>There are a few possible reasons, possibly you have <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#javascript-js-or-css-css-files-not-served-properly">not included any mime types</a> in your <code>nginx.conf</code> add the following to <code>nginx.conf</code>
</p>
<pre>types_hash_max_size 2048;
types_hash_bucket_size 128;
include mime.types;
</pre>
<p>Here we use the <code>mime.types</code> provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mailcap">mailcap</a></span>, due to the large number of types included we increase the allowed size of the types hash.
</p>
<p>Other possible reasons for these errors are missing permissions on the files. Make sure the files are owned by <code>http:http</code> and can be read and written to by this user.
</p>
<h3><span class="mw-headline" id="Security_warnings_even_though_the_recommended_settings_have_been_included_in_nginx.conf">Security warnings even though the recommended settings have been included in nginx.conf</span></h3>
<p>At the top of the admin page there might be a warning to set the <code>Strict-Transport-Security</code>, <code>X-Content-Type-Options</code>,
<code>X-Frame-Options</code>, <code>X-XSS-Protection</code> and <code>X-Robots-Tag</code> according to <a rel="nofollow" class="external free" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/harden_server.html">https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/harden_server.html</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-04-01 ⓘ]</sup>
even though they are already set like that.
</p>
<p>A possible cause could be that because owncloud sets those settings, uwsgi passed them along and nginx added them again:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ curl -I <a rel="nofollow" class="external free" href="https://domain.tld">https://domain.tld</a></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
X-Frame-Options: Sameorigin
X-Robots-Tag: none
Strict-Transport-Security: max-age=15768000; includeSubDomains; preload;
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Robots-Tag: none
</pre>
<p>While the fast_cgi sample config has a parameter to avoid that ( <code>fastcgi_param modHeadersAvailable true; #Avoid sending the security headers twice</code> ), when using uwsgi and nginx the following modification of the uwsgi part in nginx.conf could help:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"> /etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
        # pass all .php or .php/path urls to uWSGI
        location ~ ^(.+\.php)(.*)$ {
            include uwsgi_params;
            uwsgi_modifier1 14;
            # hode following headers received from uwsgi, because otherwise we would send them twice since we already add them in nginx itself
            uwsgi_hide_header X-Frame-Options;
            uwsgi_hide_header X-XSS-Protection;
            uwsgi_hide_header X-Content-Type-Options;
            uwsgi_hide_header X-Robots-Tag;
            uwsgi_hide_header X-Frame-Options;
            #Uncomment line below if you get connection refused error. Remember to commet out line with "uwsgi_pass 127.0.0.1:3001;" below
            uwsgi_pass unix:/run/uwsgi/owncloud.sock;
            #uwsgi_pass 127.0.0.1:3001;
        }
...
</pre>
<h3>
<span id=".22Reading_from_keychain_failed_with_error:_.27No_keychain_service_available.27.22"></span><span class="mw-headline" id="&quot;Reading_from_keychain_failed_with_error:_'No_keychain_service_available'&quot;">"Reading from keychain failed with error: 'No keychain service available'"</span>
</h3>
<p>Can be fixed for Gnome by installing the following 2 packages, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libgnome-keyring">libgnome-keyring</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span>.
Or the following for KDE, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libgnome-keyring">libgnome-keyring</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qtkeychain">qtkeychain</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qtkeychain-qt5">qtkeychain-qt5</a></span>]</sup>.
</p>
<h3>
<span id="FolderSync:_.22Method_Not_Allowed.22"></span><span class="mw-headline" id='FolderSync:_"Method_Not_Allowed"'>FolderSync: "Method Not Allowed"</span>
</h3>
<p>FolderSync needs access to  <code>/owncloud/remote.php/webdav</code>, so you could create another alias for owncloud in your  <code>/etc/httpd/conf/extra/nextcloud.conf</code>
</p>
<pre>  &lt;IfModule mod_alias.c&gt;
    Alias /nextcloud /usr/share/webapps/nextcloud/
    Alias /owncloud /usr/share/webapps/nextcloud/
  &lt;/IfModule&gt;
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.nextcloud.com/">Nextcloud Documentation Overview</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/">Nextcloud Admin Manual</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:File_sharing.html" title="Category:File sharing">File sharing</a></li>
<li><a href="../en/Category:Web_applications.html" title="Category:Web applications">Web applications</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Nextcloud&amp;oldid=649178">https://wiki.archlinux.org/index.php?title=Nextcloud&amp;oldid=649178</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 January 2021, at 07:44.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
