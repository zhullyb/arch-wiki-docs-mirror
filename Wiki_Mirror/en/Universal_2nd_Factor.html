<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Universal 2nd Factor - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Universal_2nd_Factor rootpage-Universal_2nd_Factor skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Universal 2nd Factor</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><br>
<a href="https://en.wikipedia.org/wiki/Universal_2nd_Factor" class="extiw" title="wikipedia:Universal 2nd Factor">Universal 2nd Factor (U2F)</a> is an open standard that strengthens and simplifies two-factor authentication (2FA) using specialized USB or NFC devices based on similar security technology found in smart cards.
</p>
<p>While initially developed by Google and Yubico, with contribution from NXP Semiconductors, the standard is now hosted by the FIDO Alliance.
</p>
<p>For all articles on U2F and U2F-devices see: <a href="../en/Category:Universal_2nd_Factor.html" title="Category:Universal 2nd Factor">Category:Universal 2nd Factor</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Authentication_for_websites"><span class="tocnumber">1</span> <span class="toctext">Authentication for websites</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Firefox"><span class="tocnumber">1.1</span> <span class="toctext">Firefox</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Chromium/Chrome"><span class="tocnumber">1.2</span> <span class="toctext">Chromium/Chrome</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Authentication_for_Arch_Linux"><span class="tocnumber">2</span> <span class="toctext">Authentication for Arch Linux</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Installing_the_PAM_module"><span class="tocnumber">2.1</span> <span class="toctext">Installing the PAM module</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Adding_a_key"><span class="tocnumber">2.2</span> <span class="toctext">Adding a key</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Passwordless_sudo"><span class="tocnumber">2.3</span> <span class="toctext">Passwordless sudo</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#GDM_login"><span class="tocnumber">2.4</span> <span class="toctext">GDM login</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Other_authentication_methods"><span class="tocnumber">2.5</span> <span class="toctext">Other authentication methods</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Troubleshooting"><span class="tocnumber">2.6</span> <span class="toctext">Troubleshooting</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#OpenSSH"><span class="tocnumber">3</span> <span class="toctext">OpenSSH</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Authentication_for_websites">Authentication for websites</span></h2>
<p>U2F is supported by major sites like Google, Facebook, Twitter, or GitHub. Check out <a rel="nofollow" class="external text" href="https://twofactorauth.org/">twofactorauth.org</a> or <a rel="nofollow" class="external text" href="https://www.dongleauth.info/">dongleauth.info</a> to find other websites and links to setup documentation. For all browsers which support it, likely the only action required is to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libfido2">libfido2</a></span>. Yubico offers a <a rel="nofollow" class="external text" href="https://demo.yubico.com/">demo page</a> for testing.
</p>
<h4><span class="mw-headline" id="Firefox">Firefox</span></h4>
<p><a href="../en/Firefox/Tweaks.html#Fido_U2F_authentication" title="Firefox/Tweaks">Firefox/Tweaks#Fido U2F authentication</a>
</p>
<h4>
<span id="Chromium.2FChrome"></span><span class="mw-headline" id="Chromium/Chrome">Chromium/Chrome</span>
</h4>
<p><a href="../en/Chromium.html#U2F_authentication" class="mw-redirect" title="Chromium/Tips and tricks">Chromium/Tips and tricks#U2F authentication</a>
</p>
<h2><span class="mw-headline" id="Authentication_for_Arch_Linux">Authentication for Arch Linux</span></h2>
<p>Yubico, the company creating the YubiKey, develops an U2F <a href="../en/PAM.html" title="PAM">PAM</a> module. It can be used to act as a second factor during login or replace the need for a password entirely.
</p>
<h3><span class="mw-headline" id="Installing_the_PAM_module">Installing the PAM module</span></h3>
<p>The module is part of the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-u2f">pam-u2f</a></span>.
</p>
<h3><span class="mw-headline" id="Adding_a_key">Adding a key</span></h3>
<p>Keys need to be added with the tool <code>pamu2fcfg</code>:
</p>
<pre>$ mkdir ~/.config/Yubico
$ pamu2fcfg -o pam://hostname -i pam://hostname &gt; ~/.config/Yubico/u2f_keys</pre>
<p>Click the button of your U2F key to confirm the key.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the hostname of your system changes, e.g. because of DHCP in different networks, you would be unable to login. In order to prevent that, it is recommended to specify the abovementioned options and replace <code>hostname</code> with the actual hostname.</div>
<p>If you own multiple keys, append them with
</p>
<pre>$ pamu2fcfg -o pam://hostname -i pam://hostname -n &gt;&gt; ~/.config/Yubico/u2f_keys</pre>
<h3><span class="mw-headline" id="Passwordless_sudo">Passwordless sudo</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Before making any changes to your configuration, create a separate terminal window with superuser permissions (<code>sudo -s</code>). This way you can revert any changes if something goes wrong.</div>
<p>Open <code>/etc/pam.d/sudo</code> and add
</p>
<pre>auth            sufficient      pam_u2f.so origin=pam://hostname appid=pam://hostname</pre>
<p>as the first line. Be sure to replace the <code>hostname</code> as mentioned above. Then create a new terminal and type <code>sudo ls</code>. Your key's LED should flash and after clicking it the command is executed.
</p>
<h3><span class="mw-headline" id="GDM_login">GDM login</span></h3>
<p>Open <code>/etc/pam.d/gdm-password</code> and add
</p>
<pre>auth            required      pam_u2f.so nouserok origin=pam://hostname appid=pam://hostname</pre>
<p>after the existing <code>auth</code> lines. Please note the use of the <code>nouserok</code> option which allows the rule to fail if the user did not configure a key. This way setups with multiple users where only some of them use a U2F key are supported.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This method will not work with encrypted home partitions because the decryption is not done before the login process completed, so the <code>u2f_keys</code> file is unavailable. In this case use a central mapping file as explained in the <a rel="nofollow" class="external text" href="https://developers.yubico.com/pam-u2f/">official documentation of pam-u2f</a>.</div>
<h3><span class="mw-headline" id="Other_authentication_methods">Other authentication methods</span></h3>
<p>Enable the PAM module for other services like explained above. For example, to secure the screensaver of <a href="../en/Cinnamon.html" title="Cinnamon">Cinnamon</a>, edit <code>/etc/pam.d/cinnamon-screensaver</code>.
</p>
<h3><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h3>
<p>If you managed to lock yourself out of the system, boot into recovery mode or from a USB pen drive. Then revert the changes in the PAM config and reboot.
</p>
<h2><span class="mw-headline" id="OpenSSH">OpenSSH</span></h2>
<p>OpenSSH supports FIDO/U2F hardware tokens natively since 8.2 <a rel="nofollow" class="external autonumber" href="https://www.openssh.com/txt/release-8.2">[1]</a>. Both the client and server must support the ed25519-sk key types. Generate a security key backed key pair with:
</p>
<pre>$ ssh-keygen -t ecdsa-sk
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are using a Yubikey, firmware version 5.2.3 is needed for the ed25519-sk key type.</div>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Universal_2nd_Factor.html" title="Category:Universal 2nd Factor">Universal 2nd Factor</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Universal_2nd_Factor&amp;oldid=640619">https://wiki.archlinux.org/index.php?title=Universal_2nd_Factor&amp;oldid=640619</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 4 November 2020, at 15:54.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
