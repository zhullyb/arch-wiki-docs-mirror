<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>OfflineIMAP - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-OfflineIMAP rootpage-OfflineIMAP skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">OfflineIMAP</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Isync.html" title="Isync">isync</a></li>
<li><a href="../en/Notmuch.html" title="Notmuch">notmuch</a></li>
<li><a href="../en/Msmtp.html" title="Msmtp">msmtp</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://offlineimap.org/">OfflineIMAP</a> is a Python utility to sync mail from IMAP servers. It does not work with the POP3 protocol or mbox, and is usually paired with a MUA such as <a href="../en/Mutt.html" title="Mutt">Mutt</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Python 2 is past EOL as of 2020-01-01. Consider <a rel="nofollow" class="external text" href="https://github.com/OfflineIMAP/offlineimap/issues/670">supporting the current efforts to port to Python 3</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The development of imapfw has stopped, while OfflineIMAP is still actively developed. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:OfflineIMAP#imapfw">Talk:OfflineIMAP#imapfw</a>)</div>
</div>
<p><a rel="nofollow" class="external text" href="http://www.offlineimap.org/development/2015/10/08/imapfw-is-made-public.html">imapfw</a> is intended to replace offlineimap in the future, but it is not yet in a working state.
</p>
</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Configuration"><span class="tocnumber">2</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Minimal"><span class="tocnumber">2.1</span> <span class="toctext">Minimal</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Selective_folder_synchronization"><span class="tocnumber">2.2</span> <span class="toctext">Selective folder synchronization</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Custom_port"><span class="tocnumber">2.3</span> <span class="toctext">Custom port</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Usage"><span class="tocnumber">3</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-7">
<a href="#Tips_and_tricks"><span class="tocnumber">4</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-8">
<a href="#Running_offlineimap_in_the_background"><span class="tocnumber">4.1</span> <span class="toctext">Running offlineimap in the background</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#systemd_timer"><span class="tocnumber">4.1.1</span> <span class="toctext">systemd timer</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Automatic_mailbox_generation_for_mutt"><span class="tocnumber">4.2</span> <span class="toctext">Automatic mailbox generation for mutt</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Gmail_configuration"><span class="tocnumber">4.3</span> <span class="toctext">Gmail configuration</span></a></li>
<li class="toclevel-2 tocsection-12">
<a href="#Password_management"><span class="tocnumber">4.4</span> <span class="toctext">Password management</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#.netrc"><span class="tocnumber">4.4.1</span> <span class="toctext">.netrc</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Using_GPG"><span class="tocnumber">4.4.2</span> <span class="toctext">Using GPG</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Using_pass"><span class="tocnumber">4.4.3</span> <span class="toctext">Using pass</span></a></li>
<li class="toclevel-3 tocsection-16">
<a href="#Gnome_keyring"><span class="tocnumber">4.4.4</span> <span class="toctext">Gnome keyring</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="#Option_1:_python2-gnomekeyring_script"><span class="tocnumber">4.4.4.1</span> <span class="toctext">Option 1: python2-gnomekeyring script</span></a></li>
<li class="toclevel-4 tocsection-18"><a href="#Option_2:_gnome-keyring-query_script"><span class="tocnumber">4.4.4.2</span> <span class="toctext">Option 2: gnome-keyring-query script</span></a></li>
<li class="toclevel-4 tocsection-19"><a href="#Option_3:_gkgetsecret.py"><span class="tocnumber">4.4.4.3</span> <span class="toctext">Option 3: gkgetsecret.py</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-20"><a href="#python2-keyring"><span class="tocnumber">4.4.5</span> <span class="toctext">python2-keyring</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Emacs_EasyPG"><span class="tocnumber">4.4.6</span> <span class="toctext">Emacs EasyPG</span></a></li>
<li class="toclevel-3 tocsection-22">
<a href="#KeePass_/_KeePassX"><span class="tocnumber">4.4.7</span> <span class="toctext">KeePass / KeePassX</span></a>
<ul>
<li class="toclevel-4 tocsection-23"><a href="#Old_kdb_format"><span class="tocnumber">4.4.7.1</span> <span class="toctext">Old kdb format</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-24"><a href="#Kerberos_authentication"><span class="tocnumber">4.5</span> <span class="toctext">Kerberos authentication</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25">
<a href="#Troubleshooting"><span class="tocnumber">5</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#Overriding_UI_and_autorefresh_settings"><span class="tocnumber">5.1</span> <span class="toctext">Overriding UI and autorefresh settings</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Folder_could_not_be_created"><span class="tocnumber">5.2</span> <span class="toctext">Folder could not be created</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#SSL_fingerprint_does_not_match"><span class="tocnumber">5.3</span> <span class="toctext">SSL fingerprint does not match</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Copying_message,_connection_closed"><span class="tocnumber">5.4</span> <span class="toctext">Copying message, connection closed</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#See_also"><span class="tocnumber">6</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=offlineimap">offlineimap</a></span> package or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/offlineimap-git/">offlineimap-git</a></span><sup><small>AUR</small></sup> for the development version.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Offlineimap is distributed with two default configuration files, which are both located in <code>/usr/share/offlineimap/</code>. <code>offlineimap.conf</code> contains every setting and is thoroughly documented. Alternatively, <code>offlineimap.conf.minimal</code> is not commented and only contains a small number of settings; see: <a href="#Minimal">#Minimal</a>.
</p>
<p>Copy one of the default configuration files to <code>~/.offlineimaprc</code> or <code>$XDG_CONFIG_HOME/offlineimap/config</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Writing a comment after an option/value on the same line is invalid syntax, hence take care that comments are placed on their own separate line.</div>
<h3><span class="mw-headline" id="Minimal">Minimal</span></h3>
<p>The following file is a commented version of <code>offlineimap.conf.minimal</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[general]
# List of accounts to be synced, separated by a comma.
accounts = main

[Account main]
# Identifier for the local repository; e.g. the maildir to be synced via IMAP.
localrepository = main-local
# Identifier for the remote repository; i.e. the actual IMAP, usually non-local.
remoterepository = main-remote

[Repository main-local]
# OfflineIMAP supports Maildir, GmailMaildir, and IMAP for local repositories.
type = Maildir
# Where should the mail be placed?
localfolders = ~/mail

[Repository main-remote]
# Remote repos can be IMAP or Gmail, the latter being a preconfigured IMAP.
type = IMAP
remotehost = host.domain.tld
remoteuser = username
</pre>
<h3><span class="mw-headline" id="Selective_folder_synchronization">Selective folder synchronization</span></h3>
<p>For synchronizing only certain folders, you can use a <a rel="nofollow" class="external text" href="http://offlineimap.org/doc/nametrans.html#folderfilter">folderfilter</a> in the <b>remote</b> section of the account in <code>~/.offlineimaprc</code>. For example, the following configuration will only synchronize the folders <code>Inbox</code> and <code>Sent</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Repository main-remote]
# Synchronize only the folders Inbox and Sent:
folderfilter = lambda foldername: foldername in ["Inbox", "Sent"]
...</pre>
<p>For more options, see the <a rel="nofollow" class="external text" href="http://offlineimap.org/doc/nametrans.html#folderfilter">official documentation</a>.
</p>
<h3><span class="mw-headline" id="Custom_port">Custom port</span></h3>
<p>Some IMAP servers might require you to connect on a custom port, instead of the default 993 port. To do so, add a <i>remoteport</i> option to the <b>remote</b> section in <code>~/.offlineimaprc</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Repository main-remote]
remoteport=<i>1234</i></pre>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Before running offlineimap, create any parent directories that were allocated to local repositories:
</p>
<pre>$ mkdir ~/mail
</pre>
<p>Now, run the program:
</p>
<pre>$ offlineimap
</pre>
<p>Mail accounts will now be synced. If anything goes wrong, take a closer look at the error messages. OfflineIMAP is usually very verbose about problems; partly because the developers did not bother with taking away tracebacks from the final product.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Running_offlineimap_in_the_background">Running offlineimap in the background</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Maybe do not use a configuration file with comments as documentation, but describe them in the text? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:OfflineIMAP">Talk:OfflineIMAP#</a>)</div>
</div>
<p>Most other mail transfer agents assume that the user will be using the tool as a <a href="../en/Daemons.html" class="mw-redirect" title="Daemon">daemon</a> by making the program sync periodically by default. In offlineimap, there are a few settings that control backgrounded tasks.
</p>
<p>Confusingly, they are spread thin all-over the configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># In the general section
[general]
# Controls how many accounts may be synced simultaneously
maxsyncaccounts = 1

# In the account identifier
[Account main]
# Minutes between syncs
autorefresh = 0.5
# Quick-syncs do not update if the only changes were to IMAP flags.
# autorefresh=0.5 together with quick=10 yields
# 10 quick refreshes between each full refresh, with 0.5 minutes between every 
# refresh, regardless of type.
quick = 10

# In the remote repository identifier
[Repository main-remote]
# Instead of closing the connection once a sync is complete, offlineimap will
# send empty data to the server to hold the connection open. A value of 60
# attempts to hold the connection for a minute between syncs (both quick and
# autorefresh).This setting has no effect if autorefresh and holdconnectionopen
# are not both set.
keepalive = 60
# OfflineIMAP normally closes IMAP server connections between refreshes if
# the global option autorefresh is specified.  If you wish it to keep the
# connection open, set this to true. This setting has no effect if autorefresh
# is not set.
holdconnectionopen = yes</pre>
<p>To start the daemon automatically on login, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a>/<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> the <a href="../en/Systemd/User.html" title="Systemd/User">systemd/User</a> service <code>offlineimap.service</code> using the <code>--user</code> flag. 
</p>
<p>In case you have more than one account configured, it is advised to use <code>offlineimap@.service</code> instead of increasing maxsyncaccounts parameter<a rel="nofollow" class="external autonumber" href="http://www.offlineimap.org/configuration/2016/01/29/why-i-m-not-using-maxconnctions.html">[1]</a>. Simply <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>offlineimap@youraccountname.service</code>.
</p>
<h4><span class="mw-headline" id="systemd_timer">systemd timer</span></h4>
<p>Alternatively, it is possible to manage OfflineIMAP completely using systemd-user <a href="../en/Systemd/Timers.html" title="Systemd/Timers">timers</a>, start/enable <code>offlineimap-oneshot.timer</code> with the <code>--user</code> flag.
</p>
<p>This timer by default runs OfflineIMAP every 15 minutes. This can be easily changed by creating a <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Drop-in snippet">drop-in snippet</a>. For example, the following modifies the timer to check every 5 minutes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/offlineimap-oneshot.timer.d/timer.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Timer]
OnUnitInactiveSec=5m</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This can lead to inconsistencies in the OfflineIMAP's local database. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:OfflineIMAP">Talk:OfflineIMAP#</a>)</div>
</div>
<p>For more robust solution it is possible to set a watchdog which will kill OfflineIMAP in case of freeze:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/offlineimap-oneshot.service.d/service.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
WatchdogSec=300</pre>
<h3><span class="mw-headline" id="Automatic_mailbox_generation_for_mutt">Automatic mailbox generation for mutt</span></h3>
<p><a href="../en/Mutt.html" title="Mutt">Mutt</a> cannot be simply pointed to an IMAP or maildir directory and be expected to guess which subdirectories happen to be the mailboxes, yet offlineimap can generate a muttrc fragment containing the mailboxes that it syncs.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mbnames]
enabled = yes
filename = ~/.mutt/mailboxes
header = "mailboxes "
peritem = "+%(accountname)s/%(foldername)s"
sep = " "
footer = "\n"
</pre>
<p>Then add the following lines to <code>~/.mutt/muttrc</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mutt/muttrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># IMAP: offlineimap
set folder = "~/mail"
source ~/.mutt/mailboxes
set spoolfile = "+account/INBOX"
set record = "+account/Sent\ Items"
set postponed = "+account/Drafts"
</pre>
<p><code>account</code> is the name you have given to your IMAP account in <code>~/.offlineimaprc</code>.
</p>
<h3><span class="mw-headline" id="Gmail_configuration">Gmail configuration</span></h3>
<p>This remote repository is configured specifically for Gmail support, substituting folder names in uppercase for lowercase, among other small additions. Keep in mind that this configuration does not sync the <i>All Mail</i> folder, since it is usually unnecessary and skipping it prevents bandwidth costs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Repository gmail-remote]
type = Gmail
remoteuser = user@gmail.com
remotepass = password
nametrans = lambda foldername: re.sub ('^\[gmail\]', 'bak',
                               re.sub ('sent_mail', 'sent',
                               re.sub ('starred', 'flagged',
                               re.sub (' ', '_', foldername.lower()))))
folderfilter = lambda foldername: foldername not in ['[Gmail]/All Mail']
# Necessary as of OfflineIMAP 6.5.4
sslcacertfile = /etc/ssl/certs/ca-certificates.crt
# Necessary to work around https://github.com/OfflineIMAP/offlineimap/issues/573 (versions 7.0.12, 7.2.1)
ssl_version = tls1_2
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you have Gmail set to another language, the folder names may appear translated too, e.g. "verzonden_berichten" instead of "sent_mail".</li>
<li>After version 6.3.5, offlineimap also creates remote folders to match your local ones. Thus you may need a nametrans rule for your local repository too that reverses the effects of this nametrans rule. If you do not want to make a reverse nametrans rule, you can disable remote folder creation by putting this in your remote configuration: <code>createfolders = False</code>
</li>
<li>As of 1 October 2012 gmail SSL certificate fingerprint is not always the same. This prevents from using <code>cert_fingerprint</code> and makes the <code>sslcacertfile</code> way a better solution for the SSL verification (see <a href="#SSL_fingerprint_does_not_match">#SSL fingerprint does not match</a>).</li>
</ul>
</div>
<h3><span class="mw-headline" id="Password_management">Password management</span></h3>
<h4><span class="mw-headline" id=".netrc">.netrc</span></h4>
<p>Add the following lines to your <code>~/.netrc</code>:
</p>
<pre>machine hostname.tld
    login [your username]
    password [your password]
</pre>
<p>Do not forget to give the file appropriate rights like 600 or 700:
</p>
<pre>$ chmod 600 ~/.netrc
</pre>
<h4><span class="mw-headline" id="Using_GPG">Using GPG</span></h4>
<p>GNU Privacy Guard can be used for storing a password in an encrypted file. First set up <a href="../en/GnuPG.html" title="GnuPG">GnuPG</a> and then follow the steps in this section. It is assumed that you can use your GPG private key <a href="../en/GnuPG.html#gpg-agent" title="GnuPG">without entering a password</a> all the time.
</p>
<p>First type in the password for the email account in a plain text file. Do this in a secure directory with <code>700</code> permissions located on a <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a> to avoid writing the unencrypted password to the disk. Then <a href="../en/GnuPG.html#Encrypt_and_decrypt" class="mw-redirect" title="Encrypt">encrypt</a> the file with GnuPG setting yourself as the recipient.
</p>
<p>Remove the plain text file since it is no longer needed. Move the encrypted file to the final location, e.g. <code>~/.offlineimappass.gpg</code>.
</p>
<p>Now create a python function that will decrypt the password:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimap.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#! /usr/bin/env python2
from subprocess import check_output

def get_pass():
    return check_output("gpg -dq ~/.offlineimappass.gpg", shell=True).strip("\n")</pre>
<p>Load this file from <code>~/.offlineimaprc</code> and specify the defined function:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[general]
# Path to file with arbitrary Python code to be loaded
pythonfile = ~/.offlineimap.py
...

[Repository <i>example</i>]
# Decrypt and read the encrypted password
remotepasseval = get_pass()
...</pre>
<h4><span class="mw-headline" id="Using_pass">Using pass</span></h4>
<p><a href="../en/Pass.html" title="Pass">pass</a> is a simple password manager from the command line based on GPG.
</p>
<p>First create a password for your email account(s):
</p>
<pre>$ pass insert Mail/<i>account</i>
</pre>
<p>Now create a python function that will decrypt the password:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimap.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#! /usr/bin/env python2
from subprocess import check_output

def get_pass(account):
    return check_output("pass Mail/" + account, shell=True).splitlines()[0]</pre>
<p>This is an example for a multi-account setup. You can customize the argument to <i>pass</i> as defined previously.
</p>
<p>Load this file from <code>~/.offlineimaprc</code> and specify the defined function: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[general]
# Path to file with arbitrary Python code to be loaded
pythonfile = ~/.offlineimap.py
...

[Repository Gmail]
# Decrypt and read the encrypted password
remotepasseval = get_pass("Gmail")
...</pre>
<h4><span class="mw-headline" id="Gnome_keyring">Gnome keyring</span></h4>
<p>In configuration for remote repositories the remoteusereval/remotepasseval fields can be set to custom python code that evaluates to the username/password. The code can be a call to a function defined in a Python script pointed to by 'pythonfile' config field. Create <code>~/.offlineimap.py</code> according to either of the two options below and use it in the configuration:
</p>
<pre>[general]
pythonfile = ~/.offlineimap.py

[Repository examplerepo]
type = IMAP
remotehost = mail.example.com
remoteusereval = get_username("examplerepo")
remotepasseval = get_password("examplerepo")
</pre>
<h5><span class="mw-headline" id="Option_1:_python2-gnomekeyring_script">Option 1: python2-gnomekeyring script</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This script relies upon <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libgnome-keyring">libgnome-keyring</a></span> which has been deprecated. <a rel="nofollow" class="external autonumber" href="https://gitlab.gnome.org/GNOME/libgnome-keyring/commit/6a5adea4aec93">[2]</a>
</div>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python2-gnomekeyring/">python2-gnomekeyring</a></span><sup><small>AUR</small></sup>. Then:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimap.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#! /usr/bin/env python2

import gnomekeyring as gkey

def set_credentials(repo, user, pw):
    KEYRING_NAME = "offlineimap"
    attrs = { "repo": repo, "user": user }
    keyring = gkey.get_default_keyring_sync()
    gkey.item_create_sync(keyring, gkey.ITEM_NETWORK_PASSWORD,
        KEYRING_NAME, attrs, pw, True)

def get_credentials(repo):
    keyring = gkey.get_default_keyring_sync()
    attrs = {"repo": repo}
    items = gkey.find_items_sync(gkey.ITEM_NETWORK_PASSWORD, attrs)
    return (items[0].attributes["user"], items[0].secret)

def get_username(repo):
    return get_credentials(repo)[0]
def get_password(repo):
    return get_credentials(repo)[1]

if __name__ == "__main__":
    import sys
    import os
    import getpass
    if len(sys.argv) != 3:
        print "Usage: %s &lt;repository&gt; &lt;username&gt;" \
            % (os.path.basename(sys.argv[0]))
        sys.exit(0)
    repo, username = sys.argv[1:]
    password = getpass.getpass("Enter password for user '%s': " % username)
    password_confirmation = getpass.getpass("Confirm password: ")
    if password != password_confirmation:
        print "Error: password confirmation does not match"
        sys.exit(1)
    set_credentials(repo, username, password)
</pre>
<p>To set the credentials, run this script from a shell.
</p>
<h5><span class="mw-headline" id="Option_2:_gnome-keyring-query_script">Option 2: gnome-keyring-query script</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This script relies upon <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libgnome-keyring">libgnome-keyring</a></span> which has been deprecated. <a rel="nofollow" class="external autonumber" href="https://gitlab.gnome.org/GNOME/libgnome-keyring/commit/6a5adea4aec93">[3]</a>
</div>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gnome-keyring-query/">gnome-keyring-query</a></span><sup><small>AUR</small></sup>. Then create the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimap.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#! /usr/bin/env python2
# executes gnome-keyring-query get passwd
# and returns the output

import locale
from subprocess import Popen, PIPE

encoding = locale.getdefaultlocale()[1]

def get_password(p):
    (out, err) = Popen(["gnome-keyring-query", "get", p], stdout=PIPE).communicate()
    return out.decode(encoding).strip()
</pre>
<h5><span class="mw-headline" id="Option_3:_gkgetsecret.py">Option 3: gkgetsecret.py</span></h5>
<p>Ensure that <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python2">python2</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python2-gobject">python2-gobject</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libsecret">libsecret</a></span> are installed. Then create <code>~/.offlineimap.py</code> with the following contents: <a rel="nofollow" class="external text" href="https://github.com/charlesbos/my-scripts/blob/master/gkgetsecret.py">gkgetsecret.py</a> and set <code>pythonfile = ~/.offlineimap.py</code> in <code>~/.offlineimaprc</code> as described above.
</p>
<p>If you created a password using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=seahorse">seahorse</a></span>, you can retrieve it from its description. For instance, the password for a repository <i>Work</i> which is stored in gnome-keyring with the description <i>Password for me@myworkemail.com</i> can be retrieved by adding the following to <code>~/.offlineimaprc</code>:
</p>
<pre>[Repository Work]
...
remotepasseval = get_pw_from_desc("Password for me@myworkemail.com")
</pre>
<p>For configurations where you wish to store the username as well, it is better if the password is created using <i>secret-tool</i> as this can be used to set attributes such as the username and repository name. Consider a password created with the following command:
</p>
<pre>$ secret-tool store --label "Password for Work Email" username me@myworkemail.com repo Work
</pre>
<p>The username and password for this account can be retrieved by adding the following to <code>~/.offlineimaprc</code>:
</p>
<pre>[Repository Work]
...
remoteusereval = get_val_from_attrs("username", "repo", "Work")
remotepasseval = get_pw_from_attrs("repo", "Work")
</pre>
<h4><span class="mw-headline" id="python2-keyring">python2-keyring</span></h4>
<p>There is a general solution that should work for any keyring. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python2-keyring">python2-keyring</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> and then change  your ~/.offlineimaprc to say something like:
</p>
<pre>[general]
pythonfile = /home/user/offlineimap.py
...
[Repository RemoteEmail]
remoteuser = username@host.net
remotepasseval = keyring.get_password("offlineimap","username@host.net")
...
</pre>
<p>and somewhere in ~/offlineimap.py add <code>import keyring</code>. Now all you have to do is set your password, like so:
</p>
<pre>$ python2 
&gt;&gt;&gt; import keyring
&gt;&gt;&gt; keyring.set_password("offlineimap","username@host.net", "MYPASSWORD")</pre>
<p>and it will grab the password from your (kwallet/gnome-) keyring instead of having to keep it in plaintext or enter it each time.
</p>
<h4><span class="mw-headline" id="Emacs_EasyPG">Emacs EasyPG</span></h4>
<p>See <a rel="nofollow" class="external free" href="http://www.emacswiki.org/emacs/OfflineIMAP#toc2">http://www.emacswiki.org/emacs/OfflineIMAP#toc2</a>
</p>
<h4>
<span id="KeePass_.2F_KeePassX"></span><span class="mw-headline" id="KeePass_/_KeePassX">KeePass / KeePassX</span>
</h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python2-libkeepass/">python2-libkeepass</a></span><sup><small>AUR</small></sup> from the AUR, then add the following to your offlineimap.py file:
</p>
<pre>#! /usr/bin/env python2
import os, getpass
import libkeepass

def get_keepass_pw(dbpath, title="", username=""):
    if os.path.isfile(dbpath):
        with libkeepass.open(
                os.path.expanduser(dbpath),
                password=getpass.getpass("Master password for '" + dbpath +    "': ")) as kdb:
            entry = kdb.tree.xpath(
                './/Entry'
                '/String/Key[.="Title"]/../Value[.="{title}"]/../..'
                '/String/Key[.="UserName"]/../Value[.="{username}"]/../..'
                '/String/Key[.="Password"]/../Value'.format(
                    title=title,
                    username=username
                )
            )[0]
            return entry.text
    else:
        print "Error: '" + dbpath + "' does not exist."
        return
</pre>
<p>Next, edit your ~/.offlineimaprc:
</p>
<pre>[general]
# VVV Set this path correctly VVV
pythonfile = /home/user/offlineimap.py
...
[Repository RemoteEmail]
remoteuser = username@host.net
# Set the DB path as well as the title and username of the specific entry you would like to use.
# This will prompt you on STDIN at runtime for the kdb master password.
remotepasseval = get_keepass_pw("/path/to/database.kdb", title="&lt;entry title&gt;", username="&lt;entry username&gt;")
...
</pre>
<p>Note that as-is, this does not support KDBs with keyfiles, only KDBs with password-only auth.
</p>
<h5><span class="mw-headline" id="Old_kdb_format">Old kdb format</span></h5>
<p>If your key database is stored in an old format, you the xpath strings may not be correct. This method should work in that case, but it is not compatible with the current default format (v4)
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python2-keepass-git/">python2-keepass-git</a></span><sup><small>AUR</small></sup> from the AUR, then add the following to your offlineimap.py file:
</p>
<pre>#! /usr/bin/env python2
import os, getpass
from keepass import kpdb
 
def get_keepass_pw(dbpath, title="", username=""):
    if os.path.isfile(dbpath):
        db = kpdb.Database(dbpath, getpass.getpass("Master password for '" + dbpath +    "': "))
        for entry in db.entries:
            if (entry.title == title) and (entry.username == username):
                return entry.password
    else:
        print "Error: '" + dbpath + "' does not exist."
        return

</pre>
<h3><span class="mw-headline" id="Kerberos_authentication">Kerberos authentication</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python2-kerberos/">python2-kerberos</a></span><sup><small>AUR</small></sup> from <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> and do not specify remotepass in your .offlineimaprc. 
OfflineImap figure out the reset all if have a valid Kerberos TGT. 
If you have 'maxconnections', it will fail for some connection. Comment 'maxconnections' out will solve this problem.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Overriding_UI_and_autorefresh_settings">Overriding UI and autorefresh settings</span></h3>
<p>For the sake of troubleshooting, it is sometimes convenient to launch offlineimap with a more verbose UI, no background syncs and perhaps even a debug level:
</p>
<pre>$ offlineimap [ -o ] [ -d &lt;debug_type&gt; ] [ -u &lt;ui&gt; ]
</pre>
<dl>
<dt>-o</dt>
<dd>Disable autorefresh, keepalive, etc.</dd>
</dl>
<dl>
<dt>-d &lt;debug_type&gt;</dt>
<dd>Where <i>&lt;debug_type&gt;</i> is one of <code>imap</code>, <code>maildir</code> or <code>thread</code>. Debugging imap and maildir are, by far, the most useful.</dd>
</dl>
<dl>
<dt>-u &lt;ui&gt;</dt>
<dd>Where <i>&lt;ui&gt;</i> is one of <code>CURSES.BLINKENLIGHTS</code>, <code>TTY.TTYUI</code>, <code>NONINTERACTIVE.BASIC</code>, <code>NONINTERACTIVE.QUIET</code> or <code>MACHINE.MACHINEUI</code>. TTY.TTYUI is sufficient for debugging purposes.</dd>
</dl>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> More recent versions use the following for &lt;ui&gt;: <code>blinkenlights</code>, <code>ttyui</code>, <code>basic</code>, <code>quiet</code> or <code>machineui</code>.</div>
<h3><span class="mw-headline" id="Folder_could_not_be_created">Folder could not be created</span></h3>
<p>In version 6.5.3, offlineimap gained the ability to create folders in the remote repository, as described <a rel="nofollow" class="external text" href="http://comments.gmane.org/gmane.mail.imap.offlineimap.general/4784">here</a>.
</p>
<p>This can lead to errors of the following form when using <code>nametrans</code> on the remote repository:
</p>
<pre>ERROR: Creating folder bar on repository foo-remote
  Folder 'bar'[foo-remote] could not be created. Server responded: ('NO', ['[ALREADYEXISTS] Duplicate folder name bar (Failure)'])
</pre>
<p>The solution is to provide an inverse <code>nametrans</code> lambda for the local repository, e.g.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.offlineimaprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Repository foo-local]
nametrans = lambda foldername: foldername.replace('bar', 'BAR')

[Repository foo-remote]
nametrans = lambda foldername: foldername.replace('BAR', 'bar')
</pre>
<ul>
<li>For working out the correct inverse mapping. the output of <code>offlineimap --info</code> should help.</li>
<li>After updating the mapping, it may be necessary to remove all of the folders under <code>$HOME/.offlineimap/</code> for the affected accounts.</li>
</ul>
<h3><span class="mw-headline" id="SSL_fingerprint_does_not_match">SSL fingerprint does not match</span></h3>
<pre>ERROR: Server SSL fingerprint 'keykeykey' for hostname 'example.com' does not match configured fingerprint. Please verify and set 'cert_fingerprint' accordingly if not set yet.
</pre>
<p>To solve this, add to <code>~/.offlineimaprc</code> (in the same section as <code>ssl = yes</code>) one of the following:
</p>
<ul>
<li>either add <code>cert_fingerprint</code>, with the certificate fingerprint of the remote server. This checks whether the remote server certificate matches the given fingerprint. <pre>cert_fingerprint = keykeykey</pre>
</li>
<li>or add <code>sslcacertfile</code> with the path to the system CA certificates file. Needs <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ca-certificates">ca-certificates</a></span> installed. This validates the remote ssl certificate chain against the Certification Authorities in that file. <pre>sslcacertfile = /etc/ssl/certs/ca-certificates.crt</pre>
</li>
</ul>
<h3>
<span id="Copying_message.2C_connection_closed"></span><span class="mw-headline" id="Copying_message,_connection_closed">Copying message, connection closed</span>
</h3>
<pre>ERROR: Copying message -2 [acc: email] connection closed
Folder sent [acc: email]: ERROR: while syncing sent [account email] connection closed
</pre>
<p>Cause of this can be creation of same message both locally and on server. This happens if your email provider automatically saves sent mails to same folder as your local client. If you encounter this, disable save of sent messages in your local client.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://lists.alioth.debian.org/mailman/listinfo/offlineimap-project">Official OfflineIMAP mailing list</a></li>
<li>
<a rel="nofollow" class="external text" href="https://pbrisbin.com/posts/mutt_gmail_offlineimap/">Mutt + Gmail + Offlineimap</a> - An outline of brisbin's simple gmail/mutt setup using cron to keep offlineimap syncing.</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Mail_retrieval_agents.html" title="Category:Mail retrieval agents">Mail retrieval agents</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=OfflineIMAP&amp;oldid=635005">https://wiki.archlinux.org/index.php?title=OfflineIMAP&amp;oldid=635005</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 12 September 2020, at 06:43.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
