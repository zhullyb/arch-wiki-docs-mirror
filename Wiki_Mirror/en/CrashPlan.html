<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>CrashPlan - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-CrashPlan rootpage-CrashPlan skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">CrashPlan</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><a rel="nofollow" class="external text" href="https://www.crashplan.com/en-us/">CrashPlan</a> is a <a href="/title/Backup_program" class="mw-redirect" title="Backup program">backup program</a> that backs up data to remote servers, other computers, or hard drives. Backing up to the cloud servers requires a monthly subscription.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Basic_Usage"><span class="tocnumber">2</span> <span class="toctext">Basic Usage</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Running_Crashplan_on_a_headless_server"><span class="tocnumber">3</span> <span class="toctext">Running Crashplan on a headless server</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#X11_forwarding_over_SSH"><span class="tocnumber">3.1</span> <span class="toctext">X11 forwarding over SSH</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Local_client"><span class="tocnumber">3.2</span> <span class="toctext">Local client</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#Troubleshooting"><span class="tocnumber">4</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Waiting_for_Backup"><span class="tocnumber">4.1</span> <span class="toctext">Waiting for Backup</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Restore_stuck_preparing"><span class="tocnumber">4.2</span> <span class="toctext">Restore stuck preparing</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Desktop_GUI_Crashes_on_startup"><span class="tocnumber">4.3</span> <span class="toctext">Desktop GUI Crashes on startup</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Out_of_Memory"><span class="tocnumber">4.4</span> <span class="toctext">Out of Memory</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Real_time_protection"><span class="tocnumber">4.5</span> <span class="toctext">Real time protection</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#JRE_Version_Update"><span class="tocnumber">4.6</span> <span class="toctext">JRE Version Update</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>There are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/crashplan-pro/">crashplan-pro</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/crashplan-proe/">crashplan-proe</a></span><sup><small>AUR</small></sup> available which are the paid enterprise packages.
</p>
<h2><span class="mw-headline" id="Basic_Usage">Basic Usage</span></h2>
<p>Before accessing CrashPlan's graphical user interface, you should <a href="/title/Start" class="mw-redirect" title="Start">start</a> the <code>crashplan-pro.service</code> unit.
</p>
<p>CrashPlan can be configured entirely through its graphical user interface. To start the graphical interface:
</p>
<pre>$ CrashPlanDesktop
</pre>
<p>To make CrashPlan automatically start upon system startup, <a href="/title/Enable" class="mw-redirect" title="Enable">enable</a> the systemd unit.
</p>
<h2><span class="mw-headline" id="Running_Crashplan_on_a_headless_server">Running Crashplan on a headless server</span></h2>
<p>Running CrashPlan on a headless server is not officially supported. However, it is possible to do so.
</p>
<p>The CrashPlan daemon's configuration files (in <code>/opt/crashplan/conf</code>) are in an obscure XML format, and they are meant to be edited programmatically by the CrashPlan client.
</p>
<p>CrashPlan 5 introduced a new client app which unfortunately dropped support for configuring a remote server with a local client, so you will need to use X11 forwarding.
</p>
<h3><span class="mw-headline" id="X11_forwarding_over_SSH">X11 forwarding over SSH</span></h3>
<p>Ensure that <code>X11Forwarding</code> is set to <code>yes</code> in the headless server's <code>/etc/ssh/sshd_config</code> and from another machine running X11, SSH to the headless machine with <code>-Y</code>, and from the remote shell run <code>CrashPlanDesktop</code>. The headless machine's windows will appear on the local X11 server. If you have problems, check <code>/opt/crashplan/log/ui_error.log</code>.
</p>
<h3><span class="mw-headline" id="Local_client">Local client</span></h3>
<p>On CrashPlan v4.x and below, the client and daemon communicate on port 4243 by default. Thus, an easy way of configuring the CrashPlan daemon on a headless server is to create an SSH tunnel:
</p>
<ol>
<li>
<a href="/title/Start" class="mw-redirect" title="Start">Start</a> the CrashPlan daemon on the server.</li>
<li>Create an SSH tunnel. On the client: <code>ssh -N -L 4243:localhost:4243 headless.example.com</code>.</li>
<li>Start the CrashPlan client. (Again, the executable is named <code>CrashPlanDesktop</code>.)</li>
</ol>
<p>Note that the authentication token (located in <code>/var/lib/crashplan/.ui_info</code>) on the local and remote servers must match. More ideas can be found on these websites:
</p>
<ul>
<li>The CrashPlan support site <a rel="nofollow" class="external text" href="https://web.archive.org/web/20210224184059/https://support.code42.com/CrashPlan/4/Configuring/Use_CrashPlan_on_a_headless_computer">details</a> a slightly more complicated method of tunneling traffic from the client (CrashPlan Desktop) to the daemon (CrashPlan Engine) through an SSH tunnel.</li>
<li>A <a rel="nofollow" class="external text" href="https://www.liquidstate.net/how-to-manage-your-crashplan-server-remotely/">post by Bryan Ross</a> details how to make CrashPlan Desktop connect directly to CrashPlan Engine. Note that this method can be less secure than tunneling traffic through an SSH tunnel.</li>
</ul>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Waiting_for_Backup">Waiting for Backup</span></h3>
<p>If the backup is stuck on «Waiting for Backup» even after you engage it manually, it might be that CrashPlan cannot access the tempdir or it is mounted as <code>noexec</code>. It uses the default Java tmp dir which is normally <code>/tmp</code>. You can either remove the <code>noexec</code> mount option (not recommended) or change the tmpdir CrashPlan is using.
</p>
<p>To change the tmpdir CrashPlan uses, open <code>/opt/crashplan/bin/run.conf</code> and insert <code>-Djava.io.tmpdir=/new-tempdir</code> to <code>SRV_JAVA_OPTS</code>, for example:
</p>
<pre>SRV_JAVA_OPTS="-Djava.io.tmpdir=/var/tmp/crashplan -Dfile.encoding=UTF-8 …
</pre>
<p>Make sure to create the new tmpdir and verify CrashPlan's user has access to it.
</p>
<pre># mkdir /var/tmp/crashplan
</pre>
<p><a href="/title/Restart" class="mw-redirect" title="Restart">Restart</a> CrashPlan.
</p>
<h3><span class="mw-headline" id="Restore_stuck_preparing">Restore stuck preparing</span></h3>
<p>If a restore gets stuck at «Preparing», it may be due to a permission restriction on <code>/tmp</code> that causes communication between the restore tool and backup engine to fail. This can be caused by the sysctl variable <code>fs.protected_fifos</code> restricting the engine (running as <code>root</code>) from connecting to a named pipe owned by the desktop user contained in <code>/tmp</code> (similar to <a href="/title/Tmpfs#Opening_symlinks_in_tmpfs_as_root_fails" title="Tmpfs">tmpfs#Opening symlinks in tmpfs as root fails</a>).
</p>
<p>The protection can be disabled to permit the restore to occur with
</p>
<pre># sysctl fs.protected_fifos=0
</pre>
<p>systemd since version 241 sets this option to 1 by default; refer to  <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/blob/2732587540035227fe59e4b64b60127352611b35/NEWS#L32">the systemd documentation</a> for how to correctly change it, and see <a href="/title/Sysctl" title="Sysctl">Sysctl</a> for more information.
</p>
<h3><span class="mw-headline" id="Desktop_GUI_Crashes_on_startup">Desktop GUI Crashes on startup</span></h3>
<p>On systems with Gnome 3 installed, or with libwebkit-gtk installed, there may be an issue where the GUI crashes on launch. This can be fixed by following the instructions <a rel="nofollow" class="external text" href="https://support.code42.com/CrashPlan/Latest/Troubleshooting/CrashPlan_Client_Closes_In_Some_Linux_Installations">here</a>.
</p>
<h3><span class="mw-headline" id="Out_of_Memory">Out of Memory</span></h3>
<p>For backup sets containing large numbers of files, the default maximum heap size may not be large enough because the memory required scales with the number of files to back up. If the server runs out of memory it will silently restart, and usually get stuck restarting as it continually reaches the memory limit. To increase the heap size limit, adjust the <code>-Xmx</code> option in <code>/opt/crashplan/bin/run.conf</code> to a reasonable value for your system.
</p>
<h3><span class="mw-headline" id="Real_time_protection">Real time protection</span></h3>
<p>If you use real time protection for your backup set and have a lot of files to backup, the default system configuration might not be able to allocate all required handles to follow all files in real time. This issue can manifest itself with logs like "inotify_add_watch: No space left on device" in the syslog journal. 
CrashPlan Support has instructions <a rel="nofollow" class="external text" href="https://support.crashplan.com/Troubleshooting/Real-Time_Backup_For_Network-Attached_Drives">here</a> describing how to modify inotify max_user_watches to a bigger value to fix the issue. <b>You cannot follow their instructions directly though</b>, you need to create a new file in /etc/sysctl.d as /etc/sysctl.conf is now ignored by systemd. See <a href="/title/Sysctl#Configuration" title="Sysctl">sysctl#Configuration</a> for more information.
</p>
<h3><span class="mw-headline" id="JRE_Version_Update">JRE Version Update</span></h3>
<p>If, during upgrade, CrashPlan is attempting to upgrade the self-installed JRE version and the upgrade never gets passed downloading the JRE from CrashPlan (checking in logs/upgrade&lt;unique_number&gt;.log, the last message is a curl/wget for the "latest" JRE tgz), it's possible to stop CrashPlan, download the JRE (from the ugprade log) manually and replace the jre folder in the CrashPlan install with the upgrade version. This should allow CrashPlan to get past being stuck trying to upgrade the JRE.
</p>
<pre> cd &lt;crashplan/install/dir&gt;
 ./bin/CrashPlanEngine stop
 rm -rf jre
 curl &lt;jre url from crashplan log&gt;
 tar xzvf &lt;jre.tgz&gt;
 ./bin/CrashPlanEngine start
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.code42.com/crashplan/">CrashPlan home page</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20210224184059/https://support.code42.com/CrashPlan/4/Configuring/Use_CrashPlan_on_a_headless_computer">CrashPlan On A Headless Server - Code42Support</a></li>
<li><a href="https://en.wikipedia.org/wiki/CrashPlan" class="extiw" title="wikipedia:CrashPlan">Wikipedia:CrashPlan</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Backup" title="Category:Backup">Backup</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=CrashPlan&amp;oldid=670542">https://wiki.archlinux.org/index.php?title=CrashPlan&amp;oldid=670542</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 11 May 2021, at 21:41.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
