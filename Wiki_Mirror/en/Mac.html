<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Mac - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Mac rootpage-Mac skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Mac</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a></li>
<li><a href="../en/General_recommendations.html" title="General recommendations">General recommendations</a></li>
<li><a href="../en/MacBook5,2_(early-mid_2009).html" title="MacBook5,2 (early-mid 2009)">MacBook5,2 (early-mid 2009)</a></li>
<li><a href="../en/MacBookPro7,1.html" title="MacBookPro7,1">MacBookPro7,1</a></li>
<li><a href="../en/MacBookPro8,1/8,2/8,3_(2011).html" title="MacBookPro8,1/8,2/8,3 (2011)">MacBookPro8,1/8,2/8,3 (2011)</a></li>
<li><a href="../en/MacBookPro9,2_(Mid-2012).html" title="MacBookPro9,2 (Mid-2012)">MacBookPro9,2 (Mid-2012)</a></li>
<li><a href="../en/MacBookPro10,x.html" title="MacBookPro10,x">MacBookPro10,x</a></li>
<li><a href="../en/MacBookPro11,x.html" title="MacBookPro11,x">MacBookPro11,x</a></li>
<li><a href="../en/IMac_Aluminum.html" title="IMac Aluminum">iMac Aluminum</a></li>
<li><a href="../en/IMac_(21.5-inch,_Mid_2010).html" title="IMac (21.5-inch, Mid 2010)">iMac (21.5-inch, Mid 2010)</a></li>
<li><a href="../en/Apple_Fusion_Drive.html" title="Apple Fusion Drive">Apple Fusion Drive</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This does not apply to more recent macbooks. These are very poorly supported. See <a rel="nofollow" class="external text" href="https://github.com/Dunedan/mbp-2016-linux">here</a> for more information.</div>
<p>Installing Arch Linux on a MacBook (12"/Air/Pro) or an iMac is quite similar to installing it on any other computer. However, due to the specific hardware configuration of a Mac, there are a few deviations and special considerations which warrant a separate guide. For more background information, please see the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a> and <a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a>. This guide contains installation-instructions that can be used on any Apple computer whose hardware is supported by the Linux kernel. Please see 'related' pages (on the top right of this page) for model-specific tips and troubleshooting.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Firmware_updates"><span class="tocnumber">2</span> <span class="toctext">Firmware updates</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Partitions"><span class="tocnumber">3</span> <span class="toctext">Partitions</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Arch_Linux_only"><span class="tocnumber">3.1</span> <span class="toctext">Arch Linux only</span></a></li>
<li class="toclevel-2 tocsection-5">
<a href="#Arch_Linux_with_OS_X_or_other_operating_systems"><span class="tocnumber">3.2</span> <span class="toctext">Arch Linux with OS X or other operating systems</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Option_1:_EFI"><span class="tocnumber">3.2.1</span> <span class="toctext">Option 1: EFI</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Option_2:_BIOS-compatibility"><span class="tocnumber">3.2.2</span> <span class="toctext">Option 2: BIOS-compatibility</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#OS_X,_Windows_XP,_and_Arch_Linux_triple_boot"><span class="tocnumber">3.3</span> <span class="toctext">OS X, Windows XP, and Arch Linux triple boot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#Setup_bootloader"><span class="tocnumber">4</span> <span class="toctext">Setup bootloader</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Using_the_native_Apple_bootloader_with_systemd-boot_(Recommended)"><span class="tocnumber">4.1</span> <span class="toctext">Using the native Apple bootloader with systemd-boot (Recommended)</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Using_the_native_Apple_bootloader_with_GRUB"><span class="tocnumber">4.2</span> <span class="toctext">Using the native Apple bootloader with GRUB</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Other_methods"><span class="tocnumber">4.3</span> <span class="toctext">Other methods</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Installing_GRUB_to_EFI_partition_directly"><span class="tocnumber">4.4</span> <span class="toctext">Installing GRUB to EFI partition directly</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Using_blessing"><span class="tocnumber">4.5</span> <span class="toctext">Using blessing</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Compilation"><span class="tocnumber">4.6</span> <span class="toctext">Compilation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#Installation"><span class="tocnumber">5</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-17">
<a href="#Post-installation"><span class="tocnumber">6</span> <span class="toctext">Post-installation</span></a>
<ul>
<li class="toclevel-2 tocsection-18">
<a href="#Video"><span class="tocnumber">6.1</span> <span class="toctext">Video</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#NVIDIA_note"><span class="tocnumber">6.1.1</span> <span class="toctext">NVIDIA note</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#iMac_2020_(with_AMDGPU_and_5k_retina_resolution)"><span class="tocnumber">6.1.2</span> <span class="toctext">iMac 2020 (with AMDGPU and 5k retina resolution)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Touchpad"><span class="tocnumber">6.2</span> <span class="toctext">Touchpad</span></a></li>
<li class="toclevel-2 tocsection-22">
<a href="#Keyboard"><span class="tocnumber">6.3</span> <span class="toctext">Keyboard</span></a>
<ul>
<li class="toclevel-3 tocsection-23">
<a href="#Keyboard_Backlight"><span class="tocnumber">6.3.1</span> <span class="toctext">Keyboard Backlight</span></a>
<ul>
<li class="toclevel-4 tocsection-24"><a href="#NVIDIA_note_2"><span class="tocnumber">6.3.1.1</span> <span class="toctext">NVIDIA note</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Wi-Fi"><span class="tocnumber">6.4</span> <span class="toctext">Wi-Fi</span></a></li>
<li class="toclevel-2 tocsection-26">
<a href="#Power_management"><span class="tocnumber">6.5</span> <span class="toctext">Power management</span></a>
<ul>
<li class="toclevel-3 tocsection-27"><a href="#Disabling_Thunderbolt"><span class="tocnumber">6.5.1</span> <span class="toctext">Disabling Thunderbolt</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Suspend_and_Hibernate"><span class="tocnumber">6.5.2</span> <span class="toctext">Suspend and Hibernate</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-29"><a href="#Wake_Up_After_Suspend"><span class="tocnumber">6.6</span> <span class="toctext">Wake Up After Suspend</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Light_sensor"><span class="tocnumber">6.7</span> <span class="toctext">Light sensor</span></a></li>
<li class="toclevel-2 tocsection-31">
<a href="#Sound"><span class="tocnumber">6.8</span> <span class="toctext">Sound</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#USB_audio_interface"><span class="tocnumber">6.8.1</span> <span class="toctext">USB audio interface</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-33"><a href="#Bluetooth"><span class="tocnumber">6.9</span> <span class="toctext">Bluetooth</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Magic_Mouse"><span class="tocnumber">6.10</span> <span class="toctext">Magic Mouse</span></a></li>
<li class="toclevel-2 tocsection-35">
<a href="#Webcam"><span class="tocnumber">6.11</span> <span class="toctext">Webcam</span></a>
<ul>
<li class="toclevel-3 tocsection-36"><a href="#iSight"><span class="tocnumber">6.11.1</span> <span class="toctext">iSight</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-37"><a href="#Temperature_Sensors"><span class="tocnumber">6.12</span> <span class="toctext">Temperature Sensors</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#Color_Profile"><span class="tocnumber">6.13</span> <span class="toctext">Color Profile</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Apple_Remote"><span class="tocnumber">6.14</span> <span class="toctext">Apple Remote</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#HFS_partition_sharing"><span class="tocnumber">6.15</span> <span class="toctext">HFS partition sharing</span></a></li>
<li class="toclevel-2 tocsection-41">
<a href="#HFS+_Partitions"><span class="tocnumber">6.16</span> <span class="toctext">HFS+ Partitions</span></a>
<ul>
<li class="toclevel-3 tocsection-42"><a href="#Journaling"><span class="tocnumber">6.16.1</span> <span class="toctext">Journaling</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#Yosemite_and_later"><span class="tocnumber">6.16.2</span> <span class="toctext">Yosemite and later</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-44">
<a href="#Home_Sharing"><span class="tocnumber">6.17</span> <span class="toctext">Home Sharing</span></a>
<ul>
<li class="toclevel-3 tocsection-45">
<a href="#In_OS_X"><span class="tocnumber">6.17.1</span> <span class="toctext">In OS X</span></a>
<ul>
<li class="toclevel-4 tocsection-46"><a href="#Step_1:_change_UID_and_GID(s)"><span class="tocnumber">6.17.1.1</span> <span class="toctext">Step 1: change UID and GID(s)</span></a></li>
<li class="toclevel-4 tocsection-47"><a href="#Step_2:_change_%22Home%22_permissions"><span class="tocnumber">6.17.1.2</span> <span class="toctext">Step 2: change "Home" permissions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-48"><a href="#In_Arch"><span class="tocnumber">6.17.2</span> <span class="toctext">In Arch</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-49"><a href="#Avoid_long_EFI_wait_before_booting"><span class="tocnumber">6.18</span> <span class="toctext">Avoid long EFI wait before booting</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="#Mute_startup_chime"><span class="tocnumber">6.19</span> <span class="toctext">Mute startup chime</span></a></li>
<li class="toclevel-2 tocsection-51"><a href="#kworker_using_high_CPU"><span class="tocnumber">6.20</span> <span class="toctext">kworker using high CPU</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-52">
<a href="#rEFIt"><span class="tocnumber">7</span> <span class="toctext">rEFIt</span></a>
<ul>
<li class="toclevel-2 tocsection-53">
<a href="#Problems_with_rEFIt"><span class="tocnumber">7.1</span> <span class="toctext">Problems with rEFIt</span></a>
<ul>
<li class="toclevel-3 tocsection-54"><a href="#Mavericks_upgrade_breaks_Arch_boot_option"><span class="tocnumber">7.1.1</span> <span class="toctext">Mavericks upgrade breaks Arch boot option</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-55">
<a href="#Model-specific_information"><span class="tocnumber">8</span> <span class="toctext">Model-specific information</span></a>
<ul>
<li class="toclevel-2 tocsection-56">
<a href="#MacBook"><span class="tocnumber">8.1</span> <span class="toctext">MacBook</span></a>
<ul>
<li class="toclevel-3 tocsection-57"><a href="#April_2016_12%22_-_Version_9,1"><span class="tocnumber">8.1.1</span> <span class="toctext">April 2016 12" - Version 9,1</span></a></li>
<li class="toclevel-3 tocsection-58"><a href="#Mid_2007_13%22_-_Version_2,1"><span class="tocnumber">8.1.2</span> <span class="toctext">Mid 2007 13" - Version 2,1</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-59">
<a href="#MacBook_Pro"><span class="tocnumber">8.2</span> <span class="toctext">MacBook Pro</span></a>
<ul>
<li class="toclevel-3 tocsection-60">
<a href="#Early_2015_13%22/15%22_-_Version_12,x/11,4+"><span class="tocnumber">8.2.1</span> <span class="toctext">Early 2015 13"/15" - Version 12,x/11,4+</span></a>
<ul>
<li class="toclevel-4 tocsection-61"><a href="#Wireless"><span class="tocnumber">8.2.1.1</span> <span class="toctext">Wireless</span></a></li>
<li class="toclevel-4 tocsection-62"><a href="#Bluetooth_2"><span class="tocnumber">8.2.1.2</span> <span class="toctext">Bluetooth</span></a></li>
<li class="toclevel-4 tocsection-63"><a href="#Suspend_&amp;_Power_Off_(11,4+)"><span class="tocnumber">8.2.1.3</span> <span class="toctext">Suspend &amp; Power Off (11,4+)</span></a></li>
<li class="toclevel-4 tocsection-64"><a href="#Keyboard_&amp;_Trackpad"><span class="tocnumber">8.2.1.4</span> <span class="toctext">Keyboard &amp; Trackpad</span></a></li>
<li class="toclevel-4 tocsection-65"><a href="#Graphics"><span class="tocnumber">8.2.1.5</span> <span class="toctext">Graphics</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-66"><a href="#2012_-_2014_models"><span class="tocnumber">8.2.2</span> <span class="toctext">2012 - 2014 models</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-67">
<a href="#MacBook_Air"><span class="tocnumber">8.3</span> <span class="toctext">MacBook Air</span></a>
<ul>
<li class="toclevel-3 tocsection-68"><a href="#Early_2014_11%22_-_Version_6,1"><span class="tocnumber">8.3.1</span> <span class="toctext">Early 2014 11" - Version 6,1</span></a></li>
<li class="toclevel-3 tocsection-69">
<a href="#Mid_2013_13%22_-_Version_6,2"><span class="tocnumber">8.3.2</span> <span class="toctext">Mid 2013 13" - Version 6,2</span></a>
<ul>
<li class="toclevel-4 tocsection-70"><a href="#Installing_and_booting"><span class="tocnumber">8.3.2.1</span> <span class="toctext">Installing and booting</span></a></li>
<li class="toclevel-4 tocsection-71"><a href="#Arch_Only_Installation"><span class="tocnumber">8.3.2.2</span> <span class="toctext">Arch Only Installation</span></a></li>
<li class="toclevel-4 tocsection-72"><a href="#Stability_problems"><span class="tocnumber">8.3.2.3</span> <span class="toctext">Stability problems</span></a></li>
<li class="toclevel-4 tocsection-73"><a href="#Marvell_ATA_suspend_bugs"><span class="tocnumber">8.3.2.4</span> <span class="toctext">Marvell ATA suspend bugs</span></a></li>
<li class="toclevel-4 tocsection-74"><a href="#Suspend/Resume"><span class="tocnumber">8.3.2.5</span> <span class="toctext">Suspend/Resume</span></a></li>
<li class="toclevel-4 tocsection-75"><a href="#WiFi"><span class="tocnumber">8.3.2.6</span> <span class="toctext">WiFi</span></a></li>
<li class="toclevel-4 tocsection-76"><a href="#Touchpad_2"><span class="tocnumber">8.3.2.7</span> <span class="toctext">Touchpad</span></a></li>
<li class="toclevel-4 tocsection-77"><a href="#Audio"><span class="tocnumber">8.3.2.8</span> <span class="toctext">Audio</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-78"><a href="#Mid_2012_13%22_%E2%80%94_version_5,2"><span class="tocnumber">8.3.3</span> <span class="toctext">Mid 2012 13" — version 5,2</span></a></li>
<li class="toclevel-3 tocsection-79"><a href="#Mid_2012_11.5%22_%E2%80%94_Version_5,1"><span class="tocnumber">8.3.4</span> <span class="toctext">Mid 2012 11.5" — Version 5,1</span></a></li>
<li class="toclevel-3 tocsection-80"><a href="#Mid_2011_%E2%80%94_version_4,x"><span class="tocnumber">8.3.5</span> <span class="toctext">Mid 2011 — version 4,x</span></a></li>
<li class="toclevel-3 tocsection-81"><a href="#Mid_2009_%E2%80%94_version_2,1"><span class="tocnumber">8.3.6</span> <span class="toctext">Mid 2009 — version 2,1</span></a></li>
<li class="toclevel-3 tocsection-82"><a href="#Early_2008_%E2%80%94_version_1,1"><span class="tocnumber">8.3.7</span> <span class="toctext">Early 2008 — version 1,1</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-83"><a href="#See_also"><span class="tocnumber">9</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>Specifically, the procedure for installing Arch Linux on a MacBook is:
</p>
<ol>
<li>
<b><a href="#Firmware_updates">Firmware updates</a></b>: It always helps to start from a clean, backed up, and up-to-date install of OS X.</li>
<li>
<b><a href="#Partitions">Partition</a></b>: Resizing or deleting the OS X partition to create partitions for Arch Linux.</li>
<li>
<b><a href="#Setup_bootloader">Setup bootloader</a></b>: Making sure that the new partition is bootable.</li>
<li>
<b><a href="#Installation">Install Arch Linux</a></b>: Actually installing Arch Linux.</li>
<li>
<b><a href="#Post-installation">Post-installation</a></b>: MacBook-specific configuration.</li>
</ol>
<h2><span class="mw-headline" id="Firmware_updates">Firmware updates</span></h2>
<p>Before proceeding with the installation of Arch Linux, it is important to ensure that the latest firmware updates for your MacBook are installed. This procedure requires OS X.
In OS X, open the App Store and check for updates. If your mac finds and installs any updates, make sure to <b>reboot</b> your computer, and then check again for updates to make sure that you installed everything.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you uninstalled OS X or want to reinstall it, <a rel="nofollow" class="external text" href="https://support.apple.com/en-us/HT204904">Apple</a> has great instructions.</div>
<p>It is advisable to keep OS X installed, because MacBook firmware updates can only be installed using OS X. However, if you plan to remove OS X completely, make backups of these files, which you will need in Linux for adjusting the <a href="#Color_Profile">color profile</a>:
</p>
<pre>/Library/ColorSync/Profiles/Displays/*
</pre>
<p>Continue to <a href="#Partitions">#Partitions</a>
</p>
<h2><span class="mw-headline" id="Partitions">Partitions</span></h2>
<p>Partitioning of the storage drive is no different from any other PC or laptop. However, if you plan on keeping OS X for dual booting, you should consider that, by default, a MacBook's drive is formatted using GPT and contains at least 3 partitions:
</p>
<ul>
<li>
<b>EFI</b>: the ~200 MB <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>.</li>
<li>
<b>OS X</b>: the main partition containing your OS X installation. It is formatted using <a href="../en/File_systems.html" title="File systems">HFS+</a>.</li>
<li>
<b>Recovery</b>: A recovery partition present in almost all MacBooks running OS X 10.7 or newer. It is usually hidden from OS X but can be viewed with partitioning tools.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> In Macs that use the <a href="../en/Apple_Fusion_Drive.html" title="Apple Fusion Drive">Apple Fusion Drive</a>, the partition scheme could be different.</div>
<p>How to partition depends on how many operating systems you want install. The following options will be explained:
</p>
<ul>
<li>Single boot: <a href="#Arch_Linux_only">#Arch Linux only</a>
</li>
<li>Dual boot: <a href="#Arch_Linux_with_OS_X_or_other_operating_systems">#Arch Linux with OS X or other operating systems</a> <i>(recommended so you can still return to OS X when needed)</i>
</li>
<li>Triple boot: <a href="#OS_X,_Windows_XP,_and_Arch_Linux_triple_boot">#OS X, Windows XP, and Arch Linux triple boot</a>
</li>
</ul>
<h3><span class="mw-headline" id="Arch_Linux_only">Arch Linux only</span></h3>
<p>This situation is the easiest to deal with. Partitioning is the same as any other hardware that Arch Linux can be installed on. Please refer to the standard <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is advisable to <b>disable</b> the MacBook startup sound before proceeding with partitioning. Just boot in OS X, mute your system sound and reboot again to the Arch Linux Installation media. Please keep in mind that the volume of the startup sound can only be modified reliably in OS X.</div>
<p>If you want to configure your system in order to have full-disk encryption, please look at the <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">Dm-crypt/Encrypting an entire system</a> page for details.
</p>
<p>An example for a very basic partitioning, that does not consider a separate <code>/home</code> partition nor encryption or LVM, is the following:
</p>
<pre>partition  mountpoint  size    type  label
/dev/sda1  /boot       200MiB  vfat  EFI
/dev/sda2  /swap       adjust  swap  swap
/dev/sda3  /           remain  ext4  root
</pre>
<ul><li>Done, you can continue to <a href="#Installation">#Installation</a>
</li></ul>
<h3><span class="mw-headline" id="Arch_Linux_with_OS_X_or_other_operating_systems">Arch Linux with OS X or other operating systems</span></h3>
<p>You need to partition your hard drive while keeping the partitions used for OS X/Windows. If you wish to keep OS X, the easiest way is to use partitioning tools in OS X and then finish with Arch Linux tools.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  If your OS X partition is encrypted with FileVault 2, you <b>must</b> disable the disk encryption before proceeding. After the OS X partition has been resized, FileVault 2 can be re-enabled.</div>
<p><b>Procedure</b>:
</p>
<ul>
<li>In OS X, run <i>Disk Utility.app</i> (located in <code>/Applications/Utilities</code>)</li>
<li>Select the drive to be partitioned in the left-hand column (not the partitions!). Click on the <b>Partition</b> button.</li>
<li>Add a new partition by pressing the <b>+</b> button and choose how much space you want to leave for OS X, and how much for the new partition. Keep in mind the new partition will be formatted in Arch Linux, so you can choose any partition type you want.</li>
<li>If the above completed successfully, then you can continue. If not, then you may need to fix your partitions from within OS X first.</li>
<li>Boot the Arch installation media or <a href="../en/USB_flash_installation_medium.html" class="mw-redirect" title="USB flash installation media">LiveUSB</a> by holding down the <code>Alt</code> <b>during boot</b>. Proceed with <a href="#Installation">#Installation</a>.</li>
</ul>
<p>It is possible to resize the newly created partition from within the Arch installation media, or delete it in order to proceed with the creation of other partitions (eg. swap).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Instead of cluttering your drive with different partition, it is possible to use a <a href="../en/Swap.html#Swap_file" class="mw-redirect" title="Swapfile">swapfile</a> instead of a dedicated partition. Another solution can be setting up <a href="../en/LVM.html" title="LVM">LVM</a> in order to use the newly-created partition as a container. Please refer to the linked articles.</div>
<h4><span class="mw-headline" id="Option_1:_EFI">Option 1: EFI</span></h4>
<ul><li>Run <i>cgdisk</i>
</li></ul>
<ul><li>Delete the partition you made in <i>Disk Utility.app</i> and create the necessary partitions for Arch Linux. OS X likes to see a 128 MiB gap after partitions, so when you create the first partition after the last OS X-partition, type in <b>+128M</b> when cgdisk asks for the first sector for the partition. More information about Apple's partitioning policy can be read  <a rel="nofollow" class="external text" href="https://developer.apple.com/library/mac/technotes/tn2166/_index.html#//apple_ref/doc/uid/DTS10003927-CH1-SUBSECTION5">here</a>. A simple example (no LVM, crypto):</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The swap partition is optional on machines with 4GB of RAM or more. A <b><a href="../en/Swap.html#Swap_file" class="mw-redirect" title="Swap file">swap file</a></b> can be created later.</li>
<li>The easiest dual-boot option is to install rEFInd from inside OS X, to its root directory (default for <code>install.sh</code>). Following that, copy the driver folder from the installation tarball into the new rEFInd location, and uncomment the lines <i>"scan_all_linux_kernels"</i> and <i>"also_scan_dirs"</i> options in <code>refind.conf</code>. Configuration of boot options can then be done from a <code>refind_linux.conf</code> in Arch's <code>/boot</code> directory.</li>
<li>If you want to be able to boot GRUB from the Apple boot loader, you can create a small hfs+ partition (for convenience, use OS X to format it in <i>Disk Utility.app</i> afterwards). Follow the GRUB EFI install procedure, and mount your <code>/boot/efi</code> directory to the hfs+ partition you created. Finally, finish up again in OS X by blessing the partition. This will set GRUB as the default boot option (holding alt at startup goes to the mac boot options screen still. See <a rel="nofollow" class="external free" href="http://mjg59.dreamwidth.org/7468.html">http://mjg59.dreamwidth.org/7468.html</a>).,</li>
<li>OS X's EFI partition can be shared with Arch Linux, making the creation of an additional EFI partition dedicated to Arch completely optional.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For more information on partitioning, see <a href="../en/Partitioning.html" title="Partitioning">Partitioning</a>
</div>
<pre>partition  mountpoint  size          type  label
/dev/sda1  /boot/efi   200MiB        vfat  EFI
/dev/sda2  -           ?             hfs+  OS X
/dev/sda3  -           ?             hfs+  Recovery
/dev/sda4  -           100MiB        hfs+  Boot Arch Linux from the Apple boot loader (optional)
/dev/sda5  /boot       100MiB        boot  boot
/dev/sda6  -           ?             swap  swap (optional)
/dev/sda7  /           15-20GiB      ext4  root
/dev/sda8  /home       remaining     ext4  home
</pre>
<ul><li>Done, you can continue to <a href="#Installation">#Installation</a>
</li></ul>
<h4><span class="mw-headline" id="Option_2:_BIOS-compatibility">Option 2: BIOS-compatibility</span></h4>
<ul><li>Run <i>parted</i> as root.</li></ul>
<ul><li>Delete the empty space partition and partition the space as you would for any other installation. Note that MBR is limited to 4 primary partitions (including the efi partition). That leaves 2 primary partitions for Arch. One strategy is to have a system and home partition, and use a swap file (I have not tried to use logical partitions). Another is to dedicate one partition to a shared partition (see below).</li></ul>
<ul><li>Next, create new filesystems on those partitions which need them, especially the partition which will contain <code>/boot</code>. If you are not sure how to do this using <code>mkfs.ext2</code> (or whatever), run <code>/arch/setup</code> and work through until you get to Prepare Hard Drive and use the <i>"Manually configure block devices..."</i> option, then exit the installer. This is necessary so that rEFIt will set the right partition type in the MBR in the next step (without an existing filesystem, it seems to ignore the partition type set by parted), without which GRUB will refuse to install to the right partition.</li></ul>
<ul><li>At this point you should reboot your computer and have rEFIt fix the partition tables on your hard drive.  (If you do not do this, you may have to reinstall GRUB later on in order to have your Mac recognize the Linux partition.)  When you are into the rEFIt menu, select <b>update partition table</b>, then press <code>y</code>. Reboot.</li></ul>
<ul><li>Done, you can continue with <a href="#Installation">#Installation</a>.</li></ul>
<h3>
<span id="OS_X.2C_Windows_XP.2C_and_Arch_Linux_triple_boot"></span><span class="mw-headline" id="OS_X,_Windows_XP,_and_Arch_Linux_triple_boot">OS X, Windows XP, and Arch Linux triple boot</span>
</h3>
<p>This may not work for everyone but it has been successfully tested on a MacBook from late 2009.
</p>
<p>The easiest way to partition your hard drive, so that all these operating systems can co-exist, is to use disk utility in OS X, use the formatter on windows XP, install XP and then finish with Arch Linux tools.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is highly recommended that this only be attempted after a clean install of OS X. Using these methods on a pre-existing system may have undesired results. At least back your stuff up with timemachine or clonezilla before you begin.</div>
<p><b>Procedure</b>:
</p>
<ul><li>In OS X, run <b>Disk Utility</b> (located in <code>/Applications/Utilities</code>).</li></ul>
<ul><li>Select the drive to be partitioned in the left-hand column (not the partitions!). Click on the <b>partition</b> tab on the right.</li></ul>
<ul><li>Select the volume to be resized in the <b>volume scheme.</b>
</li></ul>
<ul><li>Decide how much space you wish to have for your OS X partition, how much for XP, and how much for Arch Linux. Remember that a typical installation of OS X requires around 15-20 GiB, and XP about the same, depending on the number of software applications and files. Something like OS X 200Gb, XP 25Gb, Arch 25Gb should be fine.</li></ul>
<ul><li>Put your decisions into action by pressing the + button and adding the new partitions, Label them as you like and make sure that your XP partition is the last one on the disk and is formatted for FAT32. It is probably best to have Arch formatted in HFS format as to not confuse you later, it will be reformatted anyway.</li></ul>
<p>So in linux terms your partitions will be something like:
</p>
<dl><dd><ul>
<li>sda (disk)</li>
<li>sda1 (Mac boot partition - you cannot see this one in OS X)</li>
<li>sda2 (OS X install in HFS+)</li>
<li>sda3 (Arch install temporarly in HFS)</li>
<li>sda4 (XP install in FAT32)</li>
</ul></dd></dl>
<ul><li>Finally, click <b>apply</b>. This will create a new partition out of the empty space.</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using this method you may not be able to have a shared partition between OS X and Arch Linux, this is because the mac will only allow for 4 active partitions. You will however be able to mount a HFS partition in Arch for one workaround. There are other workarounds possible also.</div>
<ul><li>If the above completed successfully, you can continue. If not, then you may need to fix your partitions from within OS X first.</li></ul>
<ul><li>You will not be needing boot camp this way, the program rEFIt is much more flexible (though not as flexible as GRUB). Download and install rEFIt <a rel="nofollow" class="external autonumber" href="http://refit.sourceforge.net/">[1]</a>
</li></ul>
<ul><li>Go into a terminal in OS X and perform the following, this will enable the rEFIt boot manager.</li></ul>
<pre>cd /efi/refit
./enable.sh
</pre>
<ul><li>Reboot to check the rEFIt is working, it should appear on boot. When it comes up go to the rEFIt partition manager and agree to the changes.</li></ul>
<ul><li>Put your XP install CD and boot it with rEFIt - You may have to reboot a few times until it is recognized by the boot loader. Install XP and once it is installed use the OS X installation CD to get your drivers running nicely in XP.
<ul><li>Note: when installing XP make sure you select your XP partition and format it again inside the XP installer. If you do not reformat it will not work.</li></ul>
</li></ul>
<ul><li>Boot the Arch install CD, log in as root and run <code># /arch/setup</code>.</li></ul>
<ul><li>Follow the install as normal but note that you will have to tell that arch installer to mount sda3 as the root partition and format it as ext3, there will not be a /boot or swap partition so ignore those warnings.</li></ul>
<ul><li>At this point, if you are dual booting, you should reboot your computer and have rEFIt fix the partition tables on your hard drive.  (If you do not do this, you may have to reinstall GRUB later on in order to have your Mac recognize the Linux partition.)  When you are into the rEFIt menu, select <b>update partition table</b>, then press Y.</li></ul>
<pre># reboot
</pre>
<ul><li>Done! You can continue to <a href="#Installation">#Installation</a>.</li></ul>
<h2><span class="mw-headline" id="Setup_bootloader">Setup bootloader</span></h2>
<h3>
<span id="Using_the_native_Apple_bootloader_with_systemd-boot_.28Recommended.29"></span><span class="mw-headline" id="Using_the_native_Apple_bootloader_with_systemd-boot_(Recommended)">Using the native Apple bootloader with systemd-boot (Recommended)</span>
</h3>
<p>Apple's native EFI bootloader reads <code>.efi</code> files located inside the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> at <code>/EFI/BOOT/BOOTX64.EFI</code>. Luckily, this is also the default install location for the <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> binary. This means that booting linux using <i>systemd-boot</i> is very simple.
</p>
<ul>
<li>First, make sure you mounted the EFI System Partition at <code>/boot</code>
</li>
<li>Proceed with <a href="#Installation">#Installation</a> normally</li>
<li>Once inside the chrooted enviroment, type the following command to install <i>systemd-boot</i>:</li>
</ul>
<pre># bootctl --path=/boot install</pre>
<p>The above command will copy the <i>systemd-boot</i> binary to <code>/boot/EFI/BOOT/BOOTX64.EFI</code> and add <i>systemd-boot</i> itself as the default EFI application (default boot entry) loaded by the EFI Boot Manager. 
</p>
<ul><li>Proceed to <a href="../en/Systemd-boot.html#Configuration" title="Systemd-boot">systemd-boot#Configuration</a> in order to correctly set up the bootloader</li></ul>
<p>At the next reboot, the Apple Boot Manager, shown when holding down the option key when booting the MacBook, should display Arch Linux (it will be displayed as <code>EFI Boot</code> as a possible boot option.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you installed Arch Linux alongside OS X, you will be able to change the default boot location from  system Settings inside OS X. If Arch Linux does not show up as a possible boot option, you will have to mount the EFI System Partition inside OS X before selecting your boot option:
<pre>$ diskutil mount disk0s1</pre>
</div>
<h3><span class="mw-headline" id="Using_the_native_Apple_bootloader_with_GRUB">Using the native Apple bootloader with GRUB</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Uses <a href="../en/System_maintenance.html#Partial_upgrades_are_unsupported" class="mw-redirect" title="Partial upgrade">partial upgrade</a> procedure and explicitly lists many basic commands. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mac">Talk:Mac#</a>)</div>
</div>
<p>Despite using UEFI, the MacBook's native EFI bootloader <a rel="nofollow" class="external text" href="http://refit.sourceforge.net/myths/">does not use the EFI partition for booting</a>. Instead, it looks for .efi files inside all the partitions in internal and external drives and shows them as possible boot options if certain conditions are satisfied. For example, MacBooks can detect an existing OSX installation after checking that:
</p>
<ul>
<li>there is a partition formatted as HFS+</li>
<li>the partition contains the partition id <code>af00</code>
</li>
<li>in the root of that partition, there is a file called <code>mach_kernel</code>
</li>
<li>inside that partition, there a <code>boot.efi</code> file inside <code>/System/Library/CoreServices</code>
</li>
</ul>
<p>This means that configuring an Arch installation to be automatically recognized by the MacBook bootloader is possible. Moreover, it simply requires a properly-formatted HFS+ <code>/boot</code> partition and does not require meddling with the EFI system partition. The advantage of this method is that it can coexist with OS X nicely and allows to avoid other bootloaders such as rEFInd. However, this requires manual configuration. The following steps will illustrate how to perform this configuration using GRUB.
</p>
<ul>
<li>First, while configuring a new Arch installation, create a separate <code>/boot</code> partition. Many tools are available in the Arch ISO, for example <b>cgdisk</b>.</li>
<li>Make sure the partition is at least ~250 MB in size, since it will be used to store the kernel as well as any custom kernel you will install in the future. Moreover, make sure the partition type is set as Apple HFS/HFS+ (it will appear as <code>Apple HFS/HFS+</code> in fdisk/cgdisk or <code>af00</code> in gdisk)</li>
<li>Since the Arch installation ISO does not include the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/hfsprogs/">hfsprogs</a></span><sup><small>AUR</small></sup> package, we need to install it in the installation environment before proceeding with formatting the new partition as HFS+, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/hfsprogs/">hfsprogs</a></span><sup><small>AUR</small></sup>, then:</li>
</ul>
<pre> # modprobe hfsplus
 # mkfs.hfsplus /dev/sd<b>X</b> -v "Arch Linux"
</pre>
<p>Note: replace /dev/sd<b>X</b> with the correct device as appropriate
</p>
<ul><li>Done, proceed with <a href="#Installation">#Installation</a>
</li></ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<p>Once inside the chrooted enviroment, don’t forget to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/hfsprogs/">hfsprogs</a></span><sup><small>AUR</small></sup> package on the newly installed system as well. After the installation of the package, regenerate the initramfs while chrooted
</p>
<pre> # mkinitcpio -p linux
</pre>
</div>
<ul>
<li>Once inside the chrooted enviroment, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span> packages.</li>
<li>Also, create a dummy <code>mach_kernel</code> file</li>
</ul>
<pre> # touch /boot/mach_kernel
 # mkdir -p /boot/EFI/arch &amp;&amp; touch /boot/EFI/arch/mach_kernel
</pre>
<ul><li>The following steps install the GRUB UEFI application to <code>/boot/EFI/arch/System/Library/CoreServices/boot.efi</code> and install its modules to <code>/boot/grub/x86_64-efi</code>.</li></ul>
<pre> # grub-install --target=x86_64-efi --efi-directory=/boot
</pre>
<p>After that, remember to create a standard configuration file:
</p>
<pre> # grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>As you can see, the directory structure of the <code>boot.efi</code> is not correct, as the <code>/System/Library/CoreServices</code> directory is not supposed to be a subdirectory of the <code>/boot/EFI/</code> folder. For this reason, we need to relocate the <code>boot.efi</code> stub in a location the MacBook bootloader is able to recognize:
</p>
<pre> # mv /boot/EFI/arch/System/ /boot/
 # rm -r /boot/EFI/
</pre>
<p>After that, you need to create the following file 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nano /boot/System/Library/CoreServices/SystemVersion.plist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;plist version="1.0"&gt;
 &lt;dict&gt;
        &lt;key&gt;ProductBuildVersion&lt;/key&gt;
        &lt;string&gt;&lt;/string&gt;
        &lt;key&gt;ProductName&lt;/key&gt;
        &lt;string&gt;Linux&lt;/string&gt;
        &lt;key&gt;ProductVersion&lt;/key&gt;
        &lt;string&gt;Arch Linux&lt;/string&gt;
 &lt;/dict&gt;
 &lt;/plist&gt;</pre>
<p>At the next reboot, the Apple Boot Manager, shown when holding down the option key when booting the MacBook, should display Arch Linux as a possible boot option. Selecting that option will boot GRUB.
</p>
<p>Done! GRUB can now be selected on the standard MacBook bootloader and you can boot into your newly installed Arch Linux.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  After the installation, it is optionally possible to set a custom icon that will be displayed in the MacBook boot loader. In order to do that, you need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wget">wget</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=librsvg">librsvg</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libicns">libicns</a></span> packages. After that, just follow the following commands:
<pre> $ wget -O /tmp/archlinux.svg <a rel="nofollow" class="external free" href="https://archlinux.org/logos/archlinux-icon-crystal-64.svg">https://archlinux.org/logos/archlinux-icon-crystal-64.svg</a>
 $ rsvg-convert -w 128 -h 128 -o /tmp/archlogo.png /tmp/archlinux.svg
 # png2icns /boot/.VolumeIcon.icns /tmp/archlogo.png
 $ rm /tmp/archlogo.png
 $ rm /tmp/archlinux.svg
</pre>
<p>Obviously, you can replace the Arch logo with any other icon you like.
</p>
</div>
<h3><span class="mw-headline" id="Other_methods">Other methods</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b>  Section that describes bootloader setup for other setups should be revised and re-structured into more readable way (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mac">Talk:Mac#</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> rEFIt is a popular bootloader for EFI-firmware computers (including Macs). It can be installed at any time during the installation. For instructions, please see <a href="#rEFIt">#rEFIt</a>. </div>
<p>If you are going for an Arch Linux-only setup, installing the bootloader is no different than on any other machine: Install <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>, <a href="../en/REFInd.html" title="REFInd">rEFInd</a> or other bootloader of your choice.
</p>
<p>If, on the other hand, you are dual/triple booting, then read on.
</p>
<h3><span class="mw-headline" id="Installing_GRUB_to_EFI_partition_directly">Installing GRUB to EFI partition directly</span></h3>
<ul><li>If you would like to use GRUB as your main bootloader and use the "boot while holding the Alt/Option key" method to go back to OS X rather than using alternatives such as rEFIt (<a rel="nofollow" class="external free" href="http://refit.sourceforge.net/">http://refit.sourceforge.net/</a>, mentioned previously in <a href="#Option_2:_BIOS-compatibility">#Option 2: BIOS-compatibility</a> and <a href="#OS_X,_Windows_XP,_and_Arch_Linux_triple_boot">#OS X, Windows XP, and Arch Linux triple boot</a>) then you must install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> to your Mac's <b>already-existing</b> EFI partition (see below).</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  These instructions are known to work on a MacBook Pro (Early 2011). Please read the procedure carefully <b>as well as the details following it</b>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  With a new MacBook Pro (Mid 2014), this procedure worked only after installing the
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span> package.</div>
<p><b>Procedure</b>:
</p>
<ul><li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span>
</li></ul>
<ul><li>Make a directory named <code>efi</code> in <code>/boot</code>
</li></ul>
<ul><li>Mount the <b>already-existing</b> EFI partition on your Mac to this <code>/boot/efi</code> directory</li></ul>
<ul><li>Install GRUB to this directory</li></ul>
<ul><li>Make a directory named <code> locale</code> in <code> /boot/grub</code>
</li></ul>
<ul><li>Copy <code> grub.mo</code> from <code> /usr/share/locale/en\@quot/LC_MESSAGES/</code> to <code> /boot/grub/locale</code>
</li></ul>
<ul><li>Generate a configuration for GRUB</li></ul>
<ul><li>Done! GRUB will now start on reboot and you can boot into your newly installed Arch Linux.</li></ul>
<ul><li>Remember to hold ALT/Option key <b>while</b> starting your computer if you want to boot back into OS X.</li></ul>
<p><b>Details (quoted from <a href="../en/GRUB/EFI_examples.html#M5A97" class="mw-redirect" title="GRUB EFI Examples">GRUB EFI Examples#M5A97</a>):</b>
</p>
<p>Finish the standard Arch install procedures, making sure that you install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> and partition your boot hard disk as GPT.
</p>
<p>From <a href="../en/GRUB.html#UEFI_systems" title="GRUB">GRUB#UEFI systems</a>:
</p>
<p>The UEFI system partition will need to be mounted at <code>/boot/efi/</code> for the GRUB install script to detect it:
</p>
<pre># mkdir -p /boot/efi
# mount -t vfat /dev/sdXY /boot/efi
</pre>
<p>Where X is your boot hard disk and Y is the efi partition you created earlier.
</p>
<p>Install GRUB UEFI application to  and its modules to <code>/boot/grub/x86_64-efi</code> using:
</p>
<pre># modprobe dm-mod
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch_grub --recheck --debug
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
</pre>
<p>Generate a configuration for GRUB
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3><span class="mw-headline" id="Using_blessing">Using blessing</span></h3>
<p>It is possible to boot directly from GRUB in EFI mode without using rEFIt through what is known as "blessing" after placing GRUB on a <b>separate partition</b>.  These instructions are known to work on a MacBook7,1. It is advisable to host GRUB on either a FAT32 or HFS+ partition, but ext2 or ext3 may also work. GRUB's appleloader command does not currently work with the 7,1, but support can be added with the patch available <a rel="nofollow" class="external text" href="https://savannah.gnu.org/bugs/index.php?33185">here</a>.
</p>
<p>After the GRUB install is in the desired location, the firmware needs to be instructed to boot from that location.  This can be done from either an existing OS X install or an OS X install disk.  The following command assumes that the GRUB install is in <code>/efi/grub</code> on an existing OS X partition:
</p>
<pre> # bless --folder /efi/grub --file /efi/grub/grub.efi
</pre>
<h3><span class="mw-headline" id="Compilation">Compilation</span></h3>
<p>Some models may need EFI_ARCH set to i386.
</p>
<pre> bzr branch --revision -2 bzr://bzr.savannah.gnu.org/grub/trunk/grub grub
 cd grub
 ./autogen.sh
 patch -p1 &lt; appleloader_macbook_7_1.patch
 export EFI_ARCH=x86_64
 ./configure --with-platform=efi --target=${EFI_ARCH} --program-prefix=""
 make
 cd grub-core
 ../grub-mkimage -O ${EFI_ARCH}-efi -d . -o grub.efi -p "" part_gpt part_msdos ntfs ntfscomp hfsplus fat ext2 normal chain boot configfile linux multiboot
 cp grub.efi *.mod *.lst yourinstalllocation
</pre>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
 <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This section is only required if you want to have OS X installed along with Arch Linux. If not, follow the steps in the official install guide, then skip to <a href="#Post-installation">#Post-installation</a>.</div>
<ul><li>Boot from the Arch Linux install CD, or from a <a href="../en/USB_flash_installation_medium.html#Using_manual_formatting" class="mw-redirect" title="USB flash installation media">manually created</a> bootable USB drive.</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>On a MacBookPro7,1, I had an error booting the installation media Version 2012.12.01: "unable to handle kernel NULL pointer dereference at 0000000000000010" during pacpi_set_dmamode. To fix this problem, boot with the option: acpi=off. After chrooting, add MODULES="ata_generic" into /etc/mkinitcpio.conf and execute mkinitcpio -p linux, see: <a href="../en/Installation_guide.html#Configure_the_system" title="Installation guide">Installation Guide, 9 Configure the system</a>.</li>
<li>Some MacBook users report strange keyboard output such as long delays and character doubling. To fix this problem, boot with the following options: arch noapic irqpoll acpi=force</li>
</ul>
</div>
<ul><li>Proceed through the installation as described in the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a> <b>except</b> in the following areas:
<ul>
<li>Skip the <a href="../en/Installation_guide.html#Partition_the_disks" title="Installation guide">partition the disks</a> stage, do only the <a href="../en/Installation_guide.html#Format_the_partitions" title="Installation guide">partition formatting</a> and <a href="../en/Installation_guide.html#Mount_the_file_systems" title="Installation guide">mounting</a> steps, taking care to assign the correct partitions. Partitions have already been created if you followed <a href="#Partitions">#Partitions</a>
</li>
<li>When at the <a href="../en/Installation_guide.html#Boot_loader" title="Installation guide">install bootloader</a> stage, follow <a href="#Setup_bootloader">#Setup bootloader</a>
</li>
<li>
<b>(for booting with BIOS-compatibility)</b> Edit the menu.lst file of Grub and add <b>reboot=pci</b> to the end of the <b>kernel</b> lines, for example: <pre>kernel /vmlinuz-linux root=/dev/sda5 ro reboot=pci</pre> This will allow your MacBook to reboot correctly from Arch.</li>
<li>In the <a href="../en/Installation_guide.html#Configure_the_system" title="Installation guide">configure system</a> stage, edit /etc/mkinitcpio.conf and ensure the <b>keyboard</b> hook is in the <b>HOOKS</b> line somewhere after the <b>autodetect</b> hook.  This will load the drivers for your keyboard in case you need to use it before Arch boots (e.g. entering a <a href="../en/Dm-crypt.html" class="mw-redirect" title="LUKS">LUKS</a> password or using the troubleshooting shell).</li>
</ul>
</li></ul>
<ul><li>When the install process is complete, reboot your computer.</li></ul>
<ul><li>If using optical media, hold down the eject key as your MacBook starts, this should eject the Arch Linux install disk.</li></ul>
<ul><li>If dual-booting OS X and Arch Linux, hold down the alt (option) key while the system boots to use the Mac bootloader to select which OS to boot.</li></ul>
<h2><span class="mw-headline" id="Post-installation">Post-installation</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Duplicated information, does not comply with <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mac">Talk:Mac#</a>)</div>
</div>
<p>See <a href="../en/General_recommendations.html" title="General recommendations">General recommendations</a> for system management directions and post-installation tutorials like setting up a graphical user interface, sound or a touchpad.
</p>
<h4><span class="mw-headline" id="Video">Video</span></h4>
<p>Different MacBook models have different graphic cards.
To see which graphics card you have type:
</p>
<pre>$ lspci | grep VGA
</pre>
<ul><li>If it returns a string containing <code>Intel</code>, read <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a>.</li></ul>
<ul><li>If it returns <code>NVIDIA</code>, read <a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a>.</li></ul>
<ul><li>If it returns two lines, with both <code>NVIDIA</code> and <code>Intel</code>, your mac has dual graphics. See <a href="../en/MacBookPro10,x.html#Graphics" title="MacBookPro10,x">MacBookPro10,x#Graphics</a> for an example of one such setup that might apply in other cases.</li></ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Despite lots of confusion in online forums, the dual graphics on MacBooks are <a rel="nofollow" class="external text" href="https://arstechnica.com/gadgets/2010/04/inside-apples-automatic-gpu-switching/">not</a> <a href="../en/NVIDIA_Optimus.html" class="mw-redirect" title="Optimus">Optimus</a>-based, and treating them as such will break your graphics. See instead <a href="../en/MacBookPro10,x.html#Switching_to/from_GPUs_with_gpu-switch" title="MacBookPro10,x">MacBookPro10,x#Switching to/from GPUs with gpu-switch</a> or your laptop's specific article for instructions on setting up graphics switching.</div>
<ul><li>Otherwise if it returns <code>ATI</code> or <code>AMD</code>, read <a href="../en/ATI.html" title="ATI">ATI</a>.</li></ul>
<h5><span class="mw-headline" id="NVIDIA_note">NVIDIA note</span></h5>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you have installed OS in EFI mode and NVIDIA binary drivers are working only in BIOS mode (e.g. you get black screen on EFI boot), try this approach: <a rel="nofollow" class="external free" href="https://askubuntu.com/a/613573">https://askubuntu.com/a/613573</a> </div>
<p>For MacBooks with NVIDIA graphics, for the backlight to work properly you may need the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-bl/">nvidia-bl</a></span><sup><small>AUR</small></sup> package.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>If backlight control does not work after installing nvidia-bl, you should <a href="../en/Kernel_module.html#Blacklisting" class="mw-redirect" title="Blacklist">blacklist</a> apple_bl kernel module.</li>
<li>If backlight control does not work even this way, try setting module parameters. Uncommenting <code>options nvidia_bl max_level=0x1ffff shift=11</code> in <code>/etc/modprobe.d/nvidia_bl.conf</code> should do the trick.</li>
<li>Alternatively, you can choose to use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pommed-light/">pommed-light</a></span><sup><small>AUR</small></sup> package. If you do so, you may wish to change the step settings in <code>/etc/pommed.conf.mactel</code> to something around 5000-10000 depending on how many levels of brightness you desire.  The max brightness is around 80000, so take that into account.</li>
</ul>
</div>
<h5>
<span id="iMac_2020_.28with_AMDGPU_and_5k_retina_resolution.29"></span><span class="mw-headline" id="iMac_2020_(with_AMDGPU_and_5k_retina_resolution)">iMac 2020 (with AMDGPU and 5k retina resolution)</span>
</h5>
<p>It seems amdgpu driver has problems to set the native 5k resolution. If the display gets corrupted during boot when amdgpu driver module is loaded, try forcing a lower resolution. Add e.g. "video=2560x1440@60" to your bootloader's <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel_parameters</a>.
</p>
<h4><span class="mw-headline" id="Touchpad">Touchpad</span></h4>
<p>The touchpad should have basic functionality by default. A true multitouch driver which behaves very similarly to native OS X is included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xf86-input-mtrack-git/">xf86-input-mtrack-git</a></span><sup><small>AUR</small></sup> package.  Configuration options are documented in the <a rel="nofollow" class="external text" href="https://github.com/p2rkw/xf86-input-mtrack">readme</a>.
</p>
<p>The following mtrack options work well on a MacBook7,1:
</p>
<pre> Option "Thumbsize" "50"
 Option "ScrollDistance" "100"
</pre>
<p>Probably, you also need to add:
</p>
<pre> MatchDevicePath "/dev/input/event10"
</pre>
<p>To disable tap-to-click (that is, to press down to click) by default, add the following to your mtrack configuration section
</p>
<pre>   Option          "TapButton1" "0"  
   Option          "TapButton2" "0"
   Option          "TapButton3" "0"
</pre>
<p><b>Natural scrolling:</b> To configure natural two finger scrolling similar to <a rel="nofollow" class="external text" href="https://support.apple.com/en-us/HT204895">OS X</a>, refer to <a href="../en/Touchpad_Synaptics.html#Natural_scrolling" title="Touchpad Synaptics">Touchpad Synaptics#Natural scrolling</a>.
</p>
<p>If you are using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xf86-input-mtrack-git/">xf86-input-mtrack-git</a></span><sup><small>AUR</small></sup>, you can simply swap the scroll up and scroll down buttons (along with the scroll left and scroll right):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/10-mtrack.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  ...
  Option "ScrollUpButton" "5"
  Option "ScrollDownButton" "4"
  Option "ScrollLeftButton" "7"
  Option "ScrollRightButton" "6"
  ...</pre>
<p><b>Special Note About Older Macbook Models (confirmed on MacBook2,1):</b> On older Macbook models (pre-multitouch), the touchpad will not function properly until you install the xf86-input-synaptics package. Please see <a href="../en/Touchpad_Synaptics.html" title="Touchpad Synaptics">Touchpad Synaptics</a> for more information on installing and configuring this package.
</p>
<p><b>Note on MacBookPro5,5:</b> I found it is much simpler to use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-input-synaptics">xf86-input-synaptics</a></span> in Extra. Although it does not have much function as 3 finger swipe, this driver provides faster response. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gpointing-device-settings/">gpointing-device-settings</a></span><sup><small>AUR</small></sup> also provides a simple GUI config. Below is a Xorg config file /etc/X11/xorg.conf.d/60-synaptics.conf for reference only.
</p>
<pre> Section "InputClass"
       Identifier "touchpad catchall"
       Driver "synaptics"
       MatchIsTouchpad "on"
       MatchDevicePath "/dev/input/event*"
       Option "SHMConfig" "on"
       Option "TapButton1" "1"
       Option "TapButton2" "3"
       Option "TapButton3" "2"
       Option "PalmDetect" "on"
       Option "VertEdgeScroll" "off"
       Option "HorizEdgeScroll" "off"
       Option "CornerCoasting" "off"
       Option "EdgeMotionUseAlways" "off"
       Option "AreaLeftEdge" "10"
       Option "AreaRightEdge" "1270"
 EndSection
</pre>
<p><b>For some users, the two-finger right-click may not work correctly and trackpad may also become less responsive after these settings. For me, removing the 'AreaLeftEdge' and 'AreaRightEdge', solved that problem.</b>
<b>OS X like MultiTouch Gestures</b> <i>currently broken due to newer synaptic drivers!</i> For users looking to add more of OS X's multitouch gestures to Arch, <a rel="nofollow" class="external text" href="https://github.com/iberianpig/xSwipe">xSwipe</a> is a highly customisable, light weight perl script, which does just that. Once installed and configured (see xSwipe wiki on Github) I would recommend adding xSwipe as a <a href="../en/Autostarting.html" title="Autostarting">start up item</a>.
</p>
<h4><span class="mw-headline" id="Keyboard">Keyboard</span></h4>
<p>MacBook keyboards work by default. For swaping fn keys with Fx keys see <a href="../en/Apple_Keyboard.html" title="Apple Keyboard">Apple Keyboard</a>.
</p>
<p>To enable it you can map with right application like <b>xbindkeys</b> or through DE preferences; but another very good way, that we recommend, is to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pommed-light/">pommed-light</a></span><sup><small>AUR</small></sup> package.
</p>
<p>Edit the <code>/etc/pommed.conf</code> according to your hardware on MacBook, building it from <code>/etc/pommed.conf.mac</code> or <code>/etc/pommed.conf.ppc</code> example files.
</p>
<p>Note that you can also run it without a configuration file, the defaults may work for you. Then <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> and start <code>pommed.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> if you are using Gnome or KDE you can easily configure <i>3rd level functionality</i>, <i>multimedia key</i>, etc. in Keyboard Preferences.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See the <a href="../en/Xorg.html" class="mw-redirect" title="Xorg input hotplugging">Xorg input hotplugging</a> page for other configuration information.</div>
<h5><span class="mw-headline" id="Keyboard_Backlight">Keyboard Backlight</span></h5>
<p>The keyboard backlight is controlled by <code>/sys/class/leds/smc::kbd_backlight</code>.  Write the desired value to <code>brightness</code> in that directory.
</p>
<p>Both <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=acpilight">acpilight</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kbdlight/">kbdlight</a></span><sup><small>AUR</small></sup> (stalled since 2015) allow to control keyboard backlight though scripts. With the appropriate udev rules or <a href="../en/Sxhkd.html" title="Sxhkd">sxhkd</a> they allow light-level changes without being root.
</p>
<p>As of 2017-11-12, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=acpilight">acpilight</a></span> provides a "just-works" solution tested on a MacbookPro 8,1. 
</p>
<p>Alternatively you might want to check out the <a href="../en/Keyboard_backlight.html" title="Keyboard backlight">Keyboard backlight</a> wiki page.
</p>
<h6><span class="mw-headline" id="NVIDIA_note_2">NVIDIA note</span></h6>
<p>If the brightness does not function correctly through pommed, make sure you have installed the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-bl/">nvidia-bl</a></span><sup><small>AUR</small></sup> package and insert
</p>
<pre>find . -name "*" -exec sed -i 's/mbp_backlight/nvidia_backlight/' '{}' \;
</pre>
<p>into the second line of the pommed PKGBUILD build() function and remake the package. From <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=105091">this forum post</a>.
</p>
<p>Another possible solution is to modify the pommed PKGBUILD build():
</p>
<pre>find . -name "*" -exec sed -i 's/nvidia_backlight/apple_backlight/' '{}' \;
</pre>
<p>If the previous does not work try the following,
</p>
<p>run nvidia-settings, edit  the file '/etc/X11/xorg.conf' and add this line into the Device section:
</p>
<pre>Option "RegistryDwords" "EnableBrightnessControl=1"
</pre>
<p>Save and reboot and check backlight buttons work.
More information available at <a rel="nofollow" class="external text" href="https://help.ubuntu.com/community/MacBookPro5-5/Precise#LCD">Ubuntu MacBookPro5,5</a>
</p>
<h3><span class="mw-headline" id="Wi-Fi">Wi-Fi</span></h3>
<p>Different MacBook models have different wireless cards.
</p>
<p>You can easily check what card do your MacBook have by:
</p>
<pre># lspci | grep Network
</pre>
<ul><li>If you have an Atheros card, all should work out-of-the-box.</li></ul>
<ul><li>If you have a Broadcom card, follow the <a href="../en/Broadcom_wireless.html" title="Broadcom wireless">Broadcom wireless</a> page.</li></ul>
<ul><li>5.0 and 6.0 generation MacBooks may have a BCM43xx, follow the instructions for the broadcom-wl driver on the <a href="../en/Broadcom_wireless.html" title="Broadcom wireless">Broadcom wireless</a> page. The interfaces can swap during reboot so its best to define them in a udev rule (instructions on the <a href="../en/Broadcom_wireless.html" title="Broadcom wireless">Broadcom wireless</a> page).</li></ul>
<ul><li>If you have the correct broadcom DKMS driver (i.e. broadcom-wl-dkms) installed and your wifi card is still not being recognised, try rebuilding the driver (See <a href="../en/Dynamic_Kernel_Module_Support.html" title="Dynamic Kernel Module Support">Dynamic Kernel Module Support</a>).</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If your connection frequently drops, you may have to turn off Wi-Fi power management.</li>
<li>Eduroam or similar may crash your network manager. Simply delaying the connection after login should do the trick</li>
</ul>
</div>
<h3><span class="mw-headline" id="Power_management">Power management</span></h3>
<p><a href="../en/TLP.html" class="mw-redirect" title="Powerdown">Powerdown</a> is a very simple to set up set of scripts what will maximize your battery duration. A MacBook Air 2013 with powerdown provides about 11 hours of light usage with just powerdown installed.
All the usual <a href="../en/Power_management.html" title="Power management">power management</a> recomendations apply as well.
</p>
<h4><span class="mw-headline" id="Disabling_Thunderbolt">Disabling Thunderbolt</span></h4>
<p>Linux still has poor power management for Thunderbolt adapters on Macs. This can cause the TB adapter(s) to be always-on and prevent the CPU from going into the deepest power-saving states <a rel="nofollow" class="external autonumber" href="https://bugzilla.kernel.org/show_bug.cgi?id=92111">[2]</a>, drawing ca. 2W additional power even when not in use <a rel="nofollow" class="external autonumber" href="https://github.com/Dunedan/mbp-2016-linux/issues/24#issuecomment-310952415">[3]</a>. An easy way to see the CPU states is using powertop. The problem arises when the CPU does not go below C3 as a package (Pkg%pc3).
</p>
<p>One workaround is to add
</p>
<pre>   acpi_osi=!Darwin
</pre>
<p>to the kernel parameters in your bootloader, thereby telling the firmware that the system is not compatible with macOS <a rel="nofollow" class="external autonumber" href="https://www.kernel.org/doc/html/latest/firmware-guide/acpi/osi.html">[4]</a>. This should disable the TB adapter (at least on older Macs), and thus reduce power consumption greatly, but will probably come with side-effects (e.g. no Thunderbolt, maybe others?).
</p>
<p>It is also possible to <a href="../en/Kernel_module.html#Blacklisting" class="mw-redirect" title="Blacklist">blacklist</a> the thunderbolt module and then putting the controllers to sleep with
</p>
<pre>   echo auto &gt; /sys/bus/pci/devices/0000:07:00.0/power/control
</pre>
<p>Check the correct device number with lspci. This can also be <a href="../en/Systemd.html#systemd-tmpfiles_-_temporary_files" title="Systemd">automated</a>. This method reduces power consumption slightly, but still consumes 0.9 W more than the previous method on a Macbook Air 2013.
</p>
<h4><span class="mw-headline" id="Suspend_and_Hibernate">Suspend and Hibernate</span></h4>
<p>Suspending (suspend to ram) and hibernating (suspend to disk) work fine out of the box:
</p>
<pre>   systemctl suspend
</pre>
<p>Issues were reported where the machine would "suspend immediately after resume" in certain conditions when suspending by closing the lid. This was solved by setting the option "sleep-inactive-ac-type" to "nothing" using dconf-editor, option path: org → gnome → settings-daemon → plugins → power).
</p>
<p>See <a href="../en/Power_management/Suspend_and_hibernate.html" class="mw-redirect" title="Suspend and hibernate">Suspend and hibernate</a> for details on how to configure hibernation. Noticably, you will need a swap partition or file (see the mentioned article for further instructions).
</p>
<p>If after suspend laptop is woken up after few seconds, may help to disable all stuff in /proc/acpi/wakeup, exclude LID0:
</p>
<pre># echo XHC1 &gt; /proc/acpi/wakeup
$ cat /proc/acpi/wakeup
Device	S-state	  Status   Sysfs node
P0P2	  S3	*disabled
EC	  S3	*disabled
HDEF	  S3	*disabled  pci:0000:00:1b.0
RP01	  S3	*disabled  pci:0000:00:1c.0
RP02	  S3	*disabled  pci:0000:00:1c.1
RP03	  S3	*disabled  pci:0000:00:1c.2
ARPT	  S4	*disabled  pci:0000:03:00.0
RP05	  S3	*disabled  pci:0000:00:1c.4
RP06	  S3	*disabled  pci:0000:00:1c.5
SPIT	  S3	*disabled
XHC1	  S3	*disabled  pci:0000:00:14.0
ADP1	  S3	*disabled
LID0	  S3	*enabled
</pre>
<p>And for permanent disabling:
</p>
<pre>$ cat /etc/udev/rules.d/90-xhc_sleep.rules 

# disable wake from S3 on XHC1
SUBSYSTEM=="pci", KERNEL=="0000:00:14.0", ATTR{power/wakeup}="disabled"
</pre>
<p>If this does not work, check that ARPT is disabled, and add a corresponding rule to udev, like this:
</p>
<pre>SUBSYSTEM=="pci", KERNEL=="0000:03:00.0", ATTR{power/wakeup}="disabled"
</pre>
<p>If this still does not work, try disabling LID0.
This way suspending via lid-closing should be made impossible, so you might want to follow the instructions in <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1556046#p1556046">this forum post</a> to make suspending via both lid-closing and systemd possible, by using systemd services.
</p>
<h3><span class="mw-headline" id="Wake_Up_After_Suspend">Wake Up After Suspend</span></h3>
<p>Occasionally the Macboook Air may wake up immediately after suspend.
</p>
<p>In <code>/proc/acpi/wakeup</code> check to see that XHC1 and LID0 are enabled. If they are, disabling them will fix the problem. After disabling them, the only way to wake up your computer from suspend is by using the power button.
</p>
<p>To do this type to following command, edit <code>/etc/systemd/system/suspend-fix.service</code>.
</p>
<p>Then add the following text and save:
</p>
<pre>[Unit]
Description=Fix for the suspend issue
[Service]
Type=oneshot
ExecStart=/bin/sh -c "echo XHC1 &gt; /proc/acpi/wakeup &amp;&amp; echo LID0 &gt; /proc/acpi/wakeup"
[Install]
WantedBy=multi-user.target
</pre>
<p>And then run the following:
</p>
<pre>systemctl enable suspend-fix.service
systemctl start suspend-fix.service
</pre>
<p>Disabling only XHC1 is not recommended if you have this bug, since it may result in glitchy behavior.
</p>
<h3><span class="mw-headline" id="Light_sensor">Light sensor</span></h3>
<p>The values can be read from:
</p>
<pre> /sys/devices/platform/applesmc.768/light
</pre>
<p>A "cat" on this path returns two-tuples like (4,0). The below referenced lighter script ignores the second value - which always seems to be 0 - and uses the first number as measured environment lighting brightness value.
</p>
<p>If you want to use the built in light sensor to automatically adjust screen and keyboard backlight brightness check out
<b>Lighter</b> <a rel="nofollow" class="external autonumber" href="https://github.com/Janhouse/lighter">[5]</a> (simple perl script, easy to fine-tune) and <b>Lightum</b> <a rel="nofollow" class="external autonumber" href="https://github.com/poliva/lightum">[6]</a> (Requires Gnome or KDE but is older and more complete than Lighter).
</p>
<h3><span class="mw-headline" id="Sound">Sound</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  If using <a href="../en/Advanced_Linux_Sound_Architecture.html" class="mw-redirect" title="ALSA">ALSA</a>, the internal speaker might not be disabled when using the headphone jack. To solve this, enable "Auto-mute" using <code>alsamixer</code>
</div>
<p>First of all follow <a href="../en/Advanced_Linux_Sound_Architecture.html" class="mw-redirect" title="ALSA">ALSA</a> wiki page, then if something does not work correctly, continue reading this part.
</p>
<p>Edit your <code>/etc/modprobe.d/50-sound.conf</code> or <code>/etc/modprobe.d/modprobe.conf</code> appending this line:
</p>
<pre>options snd_hda_intel model=intel-mac-auto
</pre>
<p>This should automatically specify the codec in your MacBook. If you have a MacBookPro12,1, you might need
</p>
<pre> options snd-hda-intel index=1,0
</pre>
<p>instead. Alternatively, for MacBookPro5,X, you can use:
</p>
<pre>options snd_hda_intel model=mb5
</pre>
<p>(note that the jack output is controlled with "HP").
</p>
<p>If you have an iMac8,1, you should instead use
</p>
<pre>options snd-hda-intel model=mbp3 position_fix=2
</pre>
<p>For Aluminium iMacs, see <a href="../en/IMac_Aluminum.html#Getting_sound_to_work_right" class="mw-redirect" title="IMac Aluminium">iMac Aluminium#Getting sound to work right</a>
</p>
<p>You can try to specify other options, that depend on your hardware. All other possible settings are listed in Kernel Documentation, avaible online:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/sound/alsa-configuration.html">Advanced Linux Sound Architecture - Driver Configuration guide</a></li>
<li><a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/sound/hd-audio/index.html">HD-Audio</a></li>
<li><a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/sound/hd-audio/models.html">HD-Audio Codec-Specific Models</a></li>
</ul>
<p>Then, reboot.
</p>
<h4><span class="mw-headline" id="USB_audio_interface">USB audio interface</span></h4>
<p>In some cases, it can actually be easier to set up sound using a USB audio interface rather than the jack directly.
</p>
<p>For example, after plugging in a Focusrite Scarlett Solo, open <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pavucontrol">pavucontrol</a></span>, go to <code>Configuration</code>, choose <code>Off</code> for all devices and choose <code>Analog Stereo Duplex</code> for <code>Scarlett Solo USB</code>. You can then use the headphone jack on the Focusrite device for speakers or headphones. This should work immediately and on startup. This does not require any Focusrite software to be installed.
</p>
<h3><span class="mw-headline" id="Bluetooth">Bluetooth</span></h3>
<p>Bluetooth should work out-of-the box. See the article on <a href="../en/Bluetooth.html" title="Bluetooth">Bluetooth</a> to install and configure all software needed.
</p>
<h3><span class="mw-headline" id="Magic_Mouse">Magic Mouse</span></h3>
<p>If you use a magic mouse you will find it works nicely out of the box. You might want to tweak some settings such as <i>scroll-speed</i> or <i>acceleration</i>. There is no GUI for this at this time. The only way to set these settings is to instruct the kernel driver (<code>hid_magicmouse</code>) with parameters. Create a modprobe config file for your mouse.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/magicmouse.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options hid_magicmouse scroll-speed=55 scroll-acceleration=1 emulate_3button=0</pre>
<p><br>
This will instruct the driver to have a fast scroll-speed, do exponential acceleration and do not emulate a 3 button mouse. You can find an overview of all parameters and their current settings in <code>/sys/module/hid_magicmouse/parameters</code>.
</p>
<p>To play with the settings without rebooting you can also set them through the command line, like so: 
</p>
<pre># echo 55 &gt; /sys/module/hid_magicmouse/parameters/scroll_speed
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using kernel <i>4.10.10-1-macbook</i> the Magic Mouse (<i>hid_magicmouse</i>) will cause a lot of system lock ups. If you experience random lock ups, try a different, wired, mouse to see if this is the case for you as well.</div>
<h3><span class="mw-headline" id="Webcam">Webcam</span></h3>
<h4><span class="mw-headline" id="iSight">iSight</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Linux kernel from 2.6.26 includes the Linux UVC driver natively. <b>MBP 6,2+ (Kernel ~2.6.37+) iSight works out of the box</b> without the need to use firmware from OS X. Only use <code>isight-firmware-tools</code> if it does not work normally.</div>
<p>iSight webcams on MacBooks or pre 6,2 MacBook Pros (6,2 came out around 2010) require the Apple's proprietary firmware that cannot be redistributed. It must be extracted from OS X and loaded onto Arch.
</p>
<p>You will need to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/isight-firmware-tools/">isight-firmware-tools</a></span><sup><small>AUR</small></sup> to extract the firmware. This package also includes a udev rule and ELF binary that are necessary, even once you have extracted the firmware file into <code>/lib/firmware/isight.fw</code>, for the file to be loaded every time you boot your computer (namely <code>/etc/udev/rules.d/isight.rules</code> which uses <code>/usr/lib/udev/ift-load</code>).
</p>
<p>Instructions:
</p>
<p>First you need to get the firmware out of a particular file located on your OS X install. It is located in <code>/System/Library/Extensions/IOUSBFamily.kext/Contents/PlugIns/AppleUSBVideoSupport.kext/Contents/MacOS/AppleUSBVideoSupport</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  The <code>AppleUSBVideoSupport</code> file from a OS X 10.6 (Snow Leopard) installation may not work properly. If possible, use the file from OS X 10.5 or earlier.</div>
<p>To mount the OS X drive if multi-booting:
</p>
<pre># mkdir /media/OSX
# mount -t hfsplus /dev/sda2 /media/OSX
</pre>
<p>Then, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/isight-firmware-tools/">isight-firmware-tools</a></span><sup><small>AUR</small></sup> package.
</p>
<p>Locate the <code>AppleUSBVideoSupport</code> file in the OS X directory listed above. Either copy it over to your Arch system (Any OS X installation should do, such as an iMac, not just one specific to your system) or, if multi-booting, mount the OS X drive and navigate to the directory. (On 10.6 (Snow Leopard) and 10.7 (Lion) the directory is <code>/System/Library/Extensions/IOUSBFamily.kext/Contents/PlugIns/AppleUSBVideoSupport.kext/Contents/MacOS</code>.) In that directory you can go ahead and extract the driver:
</p>
<pre># ift-extract --apple-driver AppleUSBVideoSupport
</pre>
<p>When it's done, check that the firmware has been found:
</p>
<pre># ls /lib/firmware/isight.fw
</pre>
<p>Once successful, completely <b>SHUTDOWN</b> your Mac and start it back up again (to clear the hardware state of the webcam). Do <i>not</i> reboot.
</p>
<p>It should be automatically loaded at boot; if it is not you can load the <b>uvcvideo</b> module <a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">manually or load it at boot</a>.
</p>
<p>You can use many applications to test the webcam:
</p>
<ul><li>MPlayer</li></ul>
<pre># mplayer tv:// -tv driver=v4l2:width=320:height=240:device=/dev/video0 -fps 30
</pre>
<ul>
<li>Cheese</li>
<li>Skype</li>
<li>Ekiga</li>
</ul>
<p>A simple solution to take snapshots is:
</p>
<pre># mplayer tv:// -vf screenshot
</pre>
<p>and the pressing the s key to take a snapshot. Files are of the format <code>shot\d\d\d\d.png</code> and are reported in the standard output.
</p>
<h3><span class="mw-headline" id="Temperature_Sensors">Temperature Sensors</span></h3>
<p>For reading temperature just install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lm_sensors">lm_sensors</a></span>. See the <a href="../en/Lm_sensors.html" title="Lm sensors">lm_sensors</a> page for more information.
</p>
<h3><span class="mw-headline" id="Color_Profile">Color Profile</span></h3>
<p>We can use color profiles from OS X.
</p>
<p>First, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xcalib">xcalib</a></span> package.
</p>
<p>Second copy pre-saved color profiles placed in <code>/Library/ColorSync/Profiles/Displays/</code> on OS X partition to <code>~/colorprofiles/</code> for example.
</p>
<p>There are color profile files agree with in MacBook models; select the right one:
</p>
<ul>
<li>
<b>Color LCD-4271800.icc</b> for MacBook Pro with CoreDuo CPU</li>
<li>
<b>Color LCD-4271880.icc</b> for MacBook with Core2Duo</li>
<li>
<b>Color LCD-4271780.icc</b> for MacBook (non-Pro) based on CoreDuo or Core2Duo.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Also OS X allows to save current color profile from <i>Displays &gt; Color</i> section of the <i>Mac OS System Preferences</i>, in this case file is saved to <code>/Users/&lt;username&gt;/Library/ColorSync/Profiles</code>.</div>
<p>Finally you can activate it by running
</p>
<pre># xcalib ~/colorprofile.icc
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Previous command set the color profile only for the current session; this mean that you must run it every time you login in your system. For automating it you can execute the command by <b>Autostart Application</b>, concording with your DE (or add the command to your login manager's initialization script, e.g. /etc/gdm/Init/Default).</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> GNOME will revert the profile set by xcalib. It's preferable to set the profile using <b>Color</b> in settings.</div>
<h3><span class="mw-headline" id="Apple_Remote">Apple Remote</span></h3>
<p>First, to correctly install and configure the <b>lirc</b> software that control IR see <a href="../en/LIRC.html" title="LIRC">LIRC</a> wiki.
</p>
<p>Then make LIRC use <code>/dev/usb/hiddev0</code> (or <code>/dev/hiddev0</code>) by editing <code>/etc/conf.d/lircd</code>. Here is how mine look:
</p>
<pre>#
# Parameters for lirc daemon
#
LIRC_DEVICE="/dev/usb/hiddev0"
LIRC_DRIVER="macmini"
LIRC_EXTRAOPTS=""
LIRC_CONFIGFILE="/etc/lirc/lircd.conf"
</pre>
<p>Use <b>irrecord</b> (available when installing <b>lirc</b>) to create a configuration file matching your remote control signals (alternatively, you can try to use the <code>lircd.conf</code> below):
</p>
<pre># irrecord -d /dev/usb/hiddev0 -H macmini output_conf_file
</pre>
<p>Start <b>lircd</b> and use <b>irw</b> to check if it works.
</p>
<p>Example of an <code>/etc/lirc/lircd.conf</code>:
</p>
<pre>begin remote

  name  lircd.conf.macbook
  bits            8
  eps            30
  aeps          100

  one             0     0
  zero            0     0
  pre_data_bits   24
  pre_data       0x87EEFD
  gap          211994
  toggle_bit_mask 0x87EEFD01

      begin codes
          Repeat                   0x01
          Menu                     0x03
          Play                     0x05
          Prev                     0x09
          Next                     0x06
          Up                       0x0A
          Down                     0x0C
      end codes

end remote
</pre>
<h3><span class="mw-headline" id="HFS_partition_sharing">HFS partition sharing</span></h3>
<p>First, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/hfsprogs/">hfsprogs</a></span><sup><small>AUR</small></sup> package. 
</p>
<p>we have to list our partitions. Use
</p>
<pre>fdisk -l /dev/sda
</pre>
<p>example output:
</p>
<pre># fdisk -l /dev/sda
    Device  Boot     Start         End      Blocks   Id  Type
 /dev/sda1               1          26      204819   ee  GPT
 /dev/sda2              26       13602   109051903+  af  Unknown
 /dev/sda3   *       13602       14478     7031250   83  Linux
 /dev/sda4           14478       14594      932832+  82  Linux swap / Solaris
</pre>
<p>As we see, the "Unknown" partition is our OS X partition, which is located in <code>/dev/sda2</code>.
</p>
<p>Create a "mac" folder in /media:
</p>
<pre># mkdir /media/mac
</pre>
<p>Add at the end of <i>/etc/fstab</i> this line:
</p>
<pre>/dev/sda2    /media/mac     hfsplus auto,user,rw,exec   0 0
</pre>
<p>Mount it :
</p>
<pre>mount /media/mac
</pre>
<p>and check it:
</p>
<pre>ls /media/mac
</pre>
<h3>
<span id="HFS.2B_Partitions"></span><span class="mw-headline" id="HFS+_Partitions">HFS+ Partitions</span>
</h3>
<h4><span class="mw-headline" id="Journaling">Journaling</span></h4>
<p>HFS+ partitions, now the default in OS X, are not fully supported by Linux and are mounted as read-only by default. In order to write to an HFS+ partition, the safe way is to disable journaling. This can be accomplished using the OS X Disk Utility. Refer to this <a rel="nofollow" class="external text" href="http://support.apple.com/kb/ht2355">Apple support page</a> for more information or try to do it from the command line:
</p>
<p>Find your partition:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># diskutil list</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/disk0
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *750.2 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:                  Apple_HFS OSX                     149.5 GB   disk0s2
   3:                  Apple_HFS Macintosh HD            599.2 GB   disk0s3
   4:                 Apple_Boot Recovery HD             650.0 MB   disk0s4
</pre>
<p>In this example we will use <i>disk0s3</i> partition named as <i>Macintosh HD</i>. To know if journaling is activate or not you could execute:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># diskutil info /dev/disk0s3 | grep -i journal</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">    File System Personality:  Journaled HFS+
    Name (User Visible):      Mac OS Extended (Journaled)
    Journal:                  Journal size 49152 KB at offset 0x1176000
</pre>
<p>As you can read the journaling is active. To turn off the journaling you could execute:
</p>
<pre># diskutil disableJournal disk0s3
</pre>
<p>To verify it is done execute the info command again.
</p>
<p>If you get noting as output, then journaling is disabled.
</p>
<p>However, if you fail to disable journaling. You can change "auto,user,rw,exec" in <code>/etc/fstab</code> to "auto,user,force,rw,exec" and mount it.
</p>
<h4><span class="mw-headline" id="Yosemite_and_later">Yosemite and later</span></h4>
<p>Since Yosemite, HFS+ partitions are now wrapped a CoreStorage volume. Verify that you have an CoreStorage volume.
</p>
<pre># fdisk -l /dev/sdX
 Disk /dev/sdX: 298.1 GiB, 320072933376 bytes, 625142448 sectors
 Units: sectors of 1* 512 = 512 bytes
 Sector size (logical/physical): 512 bytes / 4096 bytes
 I/O size (minimum/optimal): 4096 bytes / 4096 bytes
 Disklabel type: gpt
 Device      Start      End         Sectors    Size     Type
 /dev/sdX1   40         409639      409600     200M     EFI System
 /dev/sdX2   409640     623872871   623463232  297.3G   Apple Core storage
 /dev/sdX3   623872872  625142407   1269536    916.0M   Apple boot
</pre>
<p>HFS+ uses two volume headers, one 1024 bytes into the device and one 1024 from the end of the device. With the HFS+ partition wrapped in the CoreStorage volume the end of the partition is not actually 1024 bytes from the end of the <code>/dev/sdX2</code> partition.
To fix this you need to specify <code>sizelimit=X</code> when mounting.
</p>
<p>To determine <code>sizelimit</code> do the following:
</p>
<ol>
<li>Run <code>testdisk /dev/sdX</code> and select your drive</li>
<li>Select <code>EFI GPT</code>
</li>
<li>Select <code>Analyse</code> and then <code>Quick Search</code>
</li>
</ol>
<p>Sample output:
</p>
<pre> TestDisk 7.0, Data Recovery Utility, April 2015
 Christophe GRENIER &lt;grenier@cgsecurity.org&gt;
 <a rel="nofollow" class="external free" href="http://www.cgsecurity.org">http://www.cgsecurity.org</a>
 
 Disk /dev/sdX  - 320 GB / 298 GiB - CHS 38913 255 63
     Partition     Start      End        Size in sectors
 P  EFI System     40         409639     409600  [EFI]
 P  Mac HFS        409640     623147815  622738176
 P  Mac HFS        623872872  625142407  1269536
</pre>
<p>What you see now is the output of the HFS partition itself without the CoreStorage volume. Take the size in sectors (622738176 in this example) and multiply by the number of bytes in your logical sector size (512 in this example).
</p>
<p>622738176 * 512 = 318841946112
</p>
<p>Finally, mount your disk with the <code>sizelimit=X</code> option.
</p>
<pre> mount /dev/sdX -t hfsplus -o ro,sizelimit=318841946112
</pre>
<h3><span class="mw-headline" id="Home_Sharing">Home Sharing</span></h3>
<p><i><b>UID Synchronization</b></i>
</p>
<h4><span class="mw-headline" id="In_OS_X">In OS X</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is strongly recommended that UID/GID manipulation be done immediately after a new user account is created, in OS X as well as in Arch Linux.  If you installed OS X from scratch, then this operation is guaranteed to work after logging into your account for the first time.</div>
<h5>
<span id="Step_1:_change_UID_and_GID.28s.29"></span><span class="mw-headline" id="Step_1:_change_UID_and_GID(s)">Step 1: change UID and GID(s)</span>
</h5>
<p><i><b>Pre-Leopard</b></i>
</p>
<ol>
<li>Open <b>NetInfo Manager</b> located in the <i>/Applications/Utilities</i> folder.</li>
<li>If not done for you already, enable access to user account transactions by clicking on the closed lock at the bottom of the window, and entering your account password, or root password if you have created a root account.</li>
<li>Navigate to <i>/users/&lt;new user name&gt;</i> where &lt;new user name&gt; is the name of the account that will have read/write access to the folder that will be shared with the primary user in Arch.</li>
<li>Change the <b>UID</b> value to 1000 (the value used by default for first user created in Arch).</li>
<li>Also change the <b>GID</b> value to 1000 (the value used by default for user account creation in Arch).</li>
<li>Navigate to <code>/groups/&lt;new user name&gt;</code>, automatically saving the changes you have made so far.</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you get an error message that the transaction is not allowed, log out and log back in.</div>
<p><i><b>Leopard</b></i>
</p>
<p>In Leopard, the <b>NetInfo Manager</b> application is not present. A different set of steps is required for UID synchronization:
</p>
<ol>
<li>Open <b>System Preferences</b>.</li>
<li>Click on <b>Users &amp; Groups</b>.</li>
<li>Unlock the pane if not already done so.</li>
<li>Right-click on the desired user and select <b>Advanced Options</b>.</li>
<li>Write down the value of the <b>User ID</b> field, you will need it later on. Change both the UID and GID to match the UID and GID of the account wished to be shared with in Arch (1000 by default for the first user created in Arch).</li>
</ol>
<h5>
<span id="Step_2:_change_.22Home.22_permissions"></span><span class="mw-headline" id='Step_2:_change_"Home"_permissions'>Step 2: change "Home" permissions</span>
</h5>
<ol><li>Open up <b>Terminal</b> in the <code>/Applications/Utilities</code> folder.</li></ol>
<ol><li>Enter the following command to reclaim the permission settings of your home folder, replacing &lt;your user name&gt;, &lt;your user group&gt; and &lt;your old UID&gt; with the user name whose UID and GID values you just changed, the group name whose GID value you just changed and the old UID number, respectively.</li></ol>
<pre># find /User/&lt;your user name&gt; -user &lt;your old UID&gt; -exec chown &lt;your user name&gt;:&lt;your user group&gt; {} \;
</pre>
<h4><span class="mw-headline" id="In_Arch">In Arch</span></h4>
<p>To synchronize your UID in Arch Linux, you are advised to perform this operation <i>while creating a new user account</i>.
It is therefore recommended that you do this as soon as you install Arch Linux.
</p>
<p>Now you must substitute Arch's home with OS X's home, by modify entries of <code>/etc/fstab</code>.
</p>
<h3><span class="mw-headline" id="Avoid_long_EFI_wait_before_booting">Avoid long EFI wait before booting</span></h3>
<p>If your MacBook spends 30 seconds with "white screen" before booting you need to tell the firmware where the booting partition is.
</p>
<p>Boot OS X, if you do not have it installed, you can use the install DVD (select language, then click Utilities-&gt;Terminal) or another MacBook with OS X (connect the two computers via firewire or thunderbolt, start the other MacBook while holding the T button, boot your MacBook while holding the Options button (alt)).
</p>
<p>Either way, once you have got a OS X terminal running on your MacBook you need to execute a different command (as root) depending on if you use EFI or not:
</p>
<pre># bless --device /dev/disk0s1 --setBoot            # if the booting partition is EFI
</pre>
<p>or
</p>
<pre># bless --device /dev/disk0s1 --setBoot --legacy   # if the booting partition is not EFI
</pre>
<p>(given that if your GRUB or EFI is on sda1, /dev/disk1s2 if it is on sdb2, etc). See also <a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=833215">https://bbs.archlinux.org/viewtopic.php?pid=833215</a>.
</p>
<h3><span class="mw-headline" id="Mute_startup_chime">Mute startup chime</span></h3>
<p>The startup chime volume is controlled by the EFI variable <i>SystemAudioVolume-7c436110-ab2a-4bbb-a880-fe41995c9f82</i>. So it can be muted with
</p>
<pre># printf "\x07\x00\x00\x00\x00" &gt; /sys/firmware/efi/efivars/SystemAudioVolume-7c436110-ab2a-4bbb-a880-fe41995c9f82
</pre>
<p>Bear in mind that the file may have the immutable bit set by default, which will prevent even root from overwriting the file. See <a href="../en/File_permissions_and_attributes.html#chattr_and_lsattr" title="File permissions and attributes">File permissions and attributes#chattr and lsattr</a>. To remove it, issue the following:
</p>
<pre># chattr -i /sys/firmware/efi/efivars/SystemAudioVolume-7c436110-ab2a-4bbb-a880-fe41995c9f82
</pre>
<p>After that, run the <code>printf</code> command and it should overwrite the file properly. Verify the file's contents and then set the immutable bit again with <code>chattr +i</code> once satisfied.
</p>
<p>Alternatively, you can use a OS X install disk to mute the chime. Boot from it, select language, then click <i>Utilities &gt; Terminal</i>, and enter
</p>
<pre># /usr/sbin/nvram SystemAudioVolume=%01
</pre>
<p>(or whatever volume you want).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Required formatting of the value provided for key SystemAudioVolume may differ depending on MacBook model and perhaps the version of OS X install media. If the above command fails to work, try enclosing the value in double quotes.</div>
<h3><span class="mw-headline" id="kworker_using_high_CPU">kworker using high CPU</span></h3>
<p>Sometime with the addition of Yosemite, some users found that kworker CPU usage will spike, as disccused <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=171883&amp;p=11">here</a>. This is sometimes the result of runaway ACPI interrupts.
</p>
<p>To check and see, you can count the number of recent ACPI interrupts and see if any of them are out of control.
</p>
<pre>   grep . -r /sys/firmware/acpi/interrupts/
</pre>
<p>If you see that one particular interrupt is out of control (possibly GPE66), i.e., registering hundreds of thousands of lines, you can try disabling it (replace XX with the runaway interrupt):
</p>
<pre>   echo "disable" &gt; /sys/firmware/acpi/interrupts/gpeXX
</pre>
<p>Disabling random ACPI interrupts could cause all kinds of problems, so do this at your own risk. If this fixes the problem, there is discussion about how to make a systemd service that automatically disables an interrupt at every boot <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1488371">here</a>.
</p>
<h2><span class="mw-headline" id="rEFIt">rEFIt</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>You probably want to have a look at <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/">rEFInd</a>, which is some type of successor of rEFIt.</li>
<li>This is not a requirement.  It only gives you a menu to choose between OS X and Arch Linux upon every boot.</li>
</ul>
</div>
<p>For more see, <a rel="nofollow" class="external text" href="http://refit.sourceforge.net/myths/">rEFIt myths</a>.
</p>
<p>In OS X, download the ".dmg" from <a rel="nofollow" class="external text" href="http://refit.sourceforge.net/">rEFIt Homepage</a> and install it.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have already partitioned your hard disk in preparation for the Arch installation, rEFIt may not be enabled by default.  You will have to run the "enable.sh" script installed in /efi/refit/.</div>
<p>Open up <b>Terminal</b> and enter:
</p>
<pre>cd /efi/refit;
./enable.sh
</pre>
<h3><span class="mw-headline" id="Problems_with_rEFIt">Problems with rEFIt</span></h3>
<p>If you experience problems after the install of Arch or rEFIt, especially is the right OS is not showing up to boot to or if it dumps you at a GRUB prompt stuck like the following:
</p>
<pre>GRUB&gt;_
</pre>
<p>Then have a look at this link:
</p>
<p><a rel="nofollow" class="external free" href="http://mac.linux.be/content/problems-refit-and-grub-after-installation">http://mac.linux.be/content/problems-refit-and-grub-after-installation</a>
</p>
<p>It can give you a basic idea on how to boot off the Arch live cd, mount the problem Arch install, chroot, use gptsync, and reinstall GRUB. This is probably for more advanced users who can translate the commands from a debian system to an Arch system and also apply it to the partitions on their machine. Be careful not to install GRUB in the wrong spot.
</p>
<p>If you need gptsync, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gptsync/">gptsync</a></span><sup><small>AUR</small></sup>.
</p>
<h4><span class="mw-headline" id="Mavericks_upgrade_breaks_Arch_boot_option">Mavericks upgrade breaks Arch boot option</span></h4>
<p>For some multi-boot users who utilize a separate Linux boot partition, the OS X Mavericks upgrade may overwrite the boot partition with Apple's own recovery boot filesystem. This breaks the Arch Linux boot option in rEFIt/rEFInd. The best way to proceed in this situation is to abandon a separate boot partition and use the EFI system partition (ESP) to install the bootloader of your choice. It is also recommended that you use rEFInd instead of rEFIt as development on the latter has halted.
</p>
<p>Assuming grub2 as the bootloader:
</p>
<p>Use the Arch LiveCD to boot to a shell and <a href="../en/Chroot.html" title="Chroot">chroot</a> to your broken Arch Linux environment.
</p>
<p>Mount the ESP on /boot.
</p>
<p>Edit the fstab and remove the old boot partition and make ESP the new boot partition. Now mount the ESP as the new /boot parition.
</p>
<pre># mount -a
</pre>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Reinstall</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package.
</p>
<p>Create a new initramfs and vmlinuz in /boot.
</p>
<pre># mkinitcpio -p linux
</pre>
<p>Install grub.
</p>
<pre># grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub --recheck --debug
</pre>
<p>Create a new grub.cfg file.
</p>
<pre># grub-mkconfig -o /boot/EFI/grub/grub.cfg
</pre>
<p>Make sure that grub.cfg is in the same directory as grubx64.efi.
</p>
<p>Generate a new refind_linux.conf file in /boot simply by running mkrlconf.sh which comes with rEFInd.
</p>
<p>Exit the chroot environment.
</p>
<p>Reboot. You should see a new entry for Arch Linux in rEFInd and it should boot to your Arch Linux installation.
</p>
<h2><span class="mw-headline" id="Model-specific_information">Model-specific information</span></h2>
<h3><span class="mw-headline" id="MacBook">MacBook</span></h3>
<h4>
<span id="April_2016_12.22_-_Version_9.2C1"></span><span class="mw-headline" id='April_2016_12"_-_Version_9,1'>April 2016 12" - Version 9,1</span>
</h4>
<ul><li>Booting from USB via EFI works fine, when giving the <code>intremap=nosid</code> kernel option. Remember to hold the Alt key on booting to enter the boot menu. In order to allow Linux boot directly from your system disk, you'll first need to install <a rel="nofollow" class="external free" href="http://www.rodsbooks.com/refind/">http://www.rodsbooks.com/refind/</a> from within OSX recovery mode (hold cmd+r during boot, then open terminal, then run refind-install script).</li></ul>
<ul><li>The wireless card works out of the box with <code>brcmfmac</code>.</li></ul>
<ul><li>Suspend / hibernate does not work. The problem seems to be the NVMe that does not wake up. When booting from an external drive, suspend / hibernate works out of the box.</li></ul>
<ul><li>Audio recording works out of the box. Audio playback works out of the box for headphones, not for built-in speakers. Cirrus driver patch needed for making the speakers work: <a rel="nofollow" class="external free" href="https://github.com/leifliddy/macbook12-audio-driver">https://github.com/leifliddy/macbook12-audio-driver</a>
</li></ul>
<ul><li>The keyboard and the touchpad do <i>not</i> work out of the box. There is a work-in-progress driver available that works well: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/macbook12-spi-driver-dkms/">macbook12-spi-driver-dkms</a></span><sup><small>AUR</small></sup>. Sometimes the touchpad does not work after booting but this can be fixed by reloading the driver with <code>rmmod applespi &amp;&amp; modprobe applespi</code>.</li></ul>
<ul><li>The keyboard backlight does not work (no solution yet).</li></ul>
<ul><li>For Bluetooth driver, see <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/macbook12-bluetooth-driver/">macbook12-bluetooth-driver</a></span><sup><small>AUR</small></sup>
</li></ul>
<h4>
<span id="Mid_2007_13.22_-_Version_2.2C1"></span><span class="mw-headline" id='Mid_2007_13"_-_Version_2,1'>Mid 2007 13" - Version 2,1</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> I used the 201212 ISO image.</div>
<p>Since older Macbooks have a 32bit EFI running, the usual installation image is not recognized. You need to either remove the UEFI support from the disc (<a href="../en/Unified_Extensible_Firmware_Interface.html#Remove_UEFI_boot_support_from_optical_media" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Remove UEFI boot support from optical media</a>) or build a 32bit EFI version of the disc. The paragraphs below will take the first path to success, booting into BIOS mode and its pitfalls. For a try the other way round, read <a href="../en/Unified_Extensible_Firmware_Interface.html#Create_UEFI_bootable_USB_from_ISO" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Create UEFI bootable USB from ISO</a> first.
</p>
<p>First prepare your harddisc according to your wishes. In this scenario it was a "Linux only" approach with
</p>
<pre>/dev/sda1 HFS+ AF00 200M -&gt; EFI boot system on Apple HFS+ partition
/dev/sda2 ext4 8300 147G -&gt; arch system
/dev/sda3 swap 8200 1G   -&gt; swap
</pre>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/hfsprogs/">hfsprogs</a></span><sup><small>AUR</small></sup> package contains the tools to handle HFS/HFS+ filesystems. The rEFInd bootloader recognizes it on its own. Usually the partition for the EFI bootloader is a FAT32 (vfat) partition. In this case I tried rEFIt first, which apparently needs the HFS+ filesystem to work, and kept it at that.
</p>
<p>The mount points are:
</p>
<pre>/dev/sda2 -&gt; /
/dev/sda1 -&gt; /boot
</pre>
<p>The bootloader in use was <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/index.html">rEFInd</a> instead of rEFIt. To install it, the rEFInd homepage provides a good guide. Usually it is simply done by copying rEFInd:
</p>
<pre>mkdir /boot/EFI
cp -vr /usr/share/refind/drivers_ia32 /boot/EFI/refind/
cp -vr /usr/share/refind/tools_ia32 /boot/EFI/refind/
cp -vr /usr/share/refind/fonts /boot/EFI/refind/
cp -vr /usr/share/refind/icons /boot/EFI/refind/
cp -v /usr/share/refind/refind_ia32.efi /boot/EFI/refind/
cp -v /usr/share/refind/refind.conf-sample /boot/EFI/refind/refind.conf
cp -v /usr/share/refind/refind_linux.conf-sample /boot/refind_linux.conf
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> I'm using the 32bit version of Arch and refind, since the EFI of the old MacBooks is 32bit. I'm not sure about 32bit rEFInd booting a 64bit Arch...</div>
<p>The pitfall here is, that the system bootet in BIOS compatibility mode and not in EFI mode. You cannot therefore use <code>efibootmgr</code>, because the EFI variables (even with 'modprobe efivars') are not available. While installing the system get <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mactel-boot/">mactel-boot</a></span><sup><small>AUR</small></sup>. The <code>hfs-bless</code> utility comes in handy, when blessing the EFI bootloader. This is done by calling:
</p>
<pre>hfs-bless /boot/EFI/refind/refind_ia32.efi
</pre>
<p>Since the Linux kernel does come with EFI stub enabled, it seems a good idea to run it through a bootloader first. Especially if it runs not out of the box. But using rEFInd makes GRUB (or any other bootloader) obsolete, because of that.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> In the refind_linux.conf you add any kernel option you may want as long as you use the EFI stub of your kernel. In refind.conf you adjust your needs for the bootloader itself, like menu entries. If you use them (menu entries), rEFInd should not look for these EFI stub kernels itself, so blacklist the directories used in here, like <code>/boot/</code>.</div>
<p>Not running out of the box is unfortunately the initial stage for the kernel. Since we installed it in BIOS mode, two modules are missing to grant access to the root partition while booting. Hence the 'initfsram-linux.img' can not be found/loaded. Adding the following modules to your 'MODULES' line in <code>/etc/mkinitcpio.conf</code> solved this (<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1139226#p1139226">original post</a>).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES="ahci sd_mod"</pre>
<p>Rebuild your kernel image:
</p>
<pre>mkinitcpio -p linux
</pre>
<p>The bootloader rEFInd can scan kernels even out of the '/boot/...' directory and assumes an efi kernel even without the extension '.efi'. If you do not want to try out special kernels, this should work without the hassle to copy each kernel after building to some spot special.
</p>
<p>If you happen to get multiple entries for one boot image, it often results of a previous installation of a bootloader within the MBR. To remove that, try the following - taken from the <a rel="nofollow" class="external text" href="http://ubuntuforums.org/showpost.php?p=7828260&amp;postcount=4">original post</a>. This is valid for GPT partitioned discs, so please check your environment and save your MBR first.
</p>
<pre># dd if=/dev/zero of=/dev/sda bs=440 count=1
</pre>
<h3><span class="mw-headline" id="MacBook_Pro">MacBook Pro</span></h3>
<h4>
<span id="Early_2015_13.22.2F15.22_-_Version_12.2Cx.2F11.2C4.2B"></span><span class="mw-headline" id='Early_2015_13"/15"_-_Version_12,x/11,4+'>Early 2015 13"/15" - Version 12,x/11,4+</span>
</h4>
<h5><span class="mw-headline" id="Wireless">Wireless</span></h5>
<p>The <code>brcmfmac</code> driver is working as of 2015-11-20, with newer firmware necessary for working 5GHz support (<a rel="nofollow" class="external text" href="https://bugzilla.kernel.org/show_bug.cgi?id=100201#c65">see here.</a>)
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  On the Macbook Pro 12,1 if the <code>brcmfmac</code> driver can not be started and the following errors occur in the journal:
<pre>brcmfmac: brcmf_chip_recognition: chip backplane type 15 is not supported
brcmfmac: brcmf_pcie_probe: failed 14e4:43ba
</pre>
<p>then check whether <a href="../en/Power_management.html#PCI_Runtime_Power_Management" title="Power management">PCI runtime power management</a> is enabled on the device, and disable it if so.
</p>
</div>
<h5><span class="mw-headline" id="Bluetooth_2">Bluetooth</span></h5>
<p>Bluetooth is fully supported starting from kernel-4.4.0.
</p>
<h5>
<span id="Suspend_.26_Power_Off_.2811.2C4.2B.29"></span><span class="mw-headline" id="Suspend_&amp;_Power_Off_(11,4+)">Suspend &amp; Power Off (11,4+)</span>
</h5>
<p>The 11,4 and 11,5 MacBook Pros do not shutdown or suspend correctly with the default kernel. This issue is being addressed in <a rel="nofollow" class="external text" href="https://bugzilla.kernel.org/show_bug.cgi?id=103211">Bug 103211</a> and a temporary patch is currently available in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/linux-macbook/">linux-macbook</a></span><sup><small>AUR</small></sup>. Note that <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/arch/x86/pci/fixup.c?h=v4.13-rc1&amp;id=13cfc732160f7bc7e596128ce34cda361c556966">Linux 4.13.0</a> has this patch included, and will be released shortly.
</p>
<h5>
<span id="Keyboard_.26_Trackpad"></span><span class="mw-headline" id="Keyboard_&amp;_Trackpad">Keyboard &amp; Trackpad</span>
</h5>
<p>Haptic feedback works out of the box due to the trackpad's built-in firmware.
</p>
<p>There are several drivers available that provide multitouch support. The following have been confirmed working with the MacBookPro12,1.
</p>
<p>For <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-input-libinput">xf86-input-libinput</a></span> the following configuration emulates some features from the OS X functionality. For more options see <span class="plainlinks archwiki-template-man" title="$ man 4 libinput"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/libinput.4">libinput(4)</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/90-libinput.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "InputClass"
    Identifier "libinput touchpad catchall"
    MatchIsTouchpad "on"
    MatchDevicePath "/dev/input/event*"
    Driver "libinput"
    Option "NaturalScrolling" "true"
EndSection</pre>
<p>For <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-input-synaptics">xf86-input-synaptics</a></span> the following configuration is necessary to make the touchpad work fully.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/60-magictrackpad.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "InputClass"
    Identifier "Trackpad"
    Driver "synaptics"
    MatchIsTouchpad "on"
    MatchDevicePath "/dev/input/event*"
EndSection</pre>
<p>Further, some US/ANSI keyboards suffer from an issue where the tilde key (~, the key vertically between Esc and Tab) registers as &lt; and &gt;. The following config file fixes this issue.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/hid_apple.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options hid_apple iso_layout=0</pre>
<p>See <a rel="nofollow" class="external text" href="https://bugzilla.kernel.org/show_bug.cgi?id=96771">this kernel bugzilla</a> for more details and the relevant patches for earlier kernels.
</p>
<h5><span class="mw-headline" id="Graphics">Graphics</span></h5>
<p>For Intel-only graphics, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> package. For more information or OpenGL/3D support, follow instructions at <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a>.
</p>
<p>As of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel 4.16.6 dual graphics switching does work on the 11,5 (2015) with Intel modesetting and the AMD GPU utilizing the radeon driver (amdgpu is untested). See <a href="../en/MacBookPro11,x.html#Graphics" title="MacBookPro11,x">MacBookPro11,x#Graphics</a> to enable the integrated graphics. Once the laptop boots with integrated graphics enabled you can use VGA Switcheroo controls to power down the discrete GPU. However, if you keep it powered on you will be able to utilize HDMI connections and using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/switcheroo-control/">switcheroo-control</a></span><sup><small>AUR</small></sup> you can run applications on the AMD GPU.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The kernel parameters <i>acpi_backlight</i>, <i>i915.lvds_downclock</i>, <i>i915.enable_ips</i>, and <i>intel_iommu</i> are no longer necessary as of kernel 4.2.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> (Kernel 4.10.8, MacBook Pro 11,4+) If you experience system lock ups and/or tearing in Xorg, remove the .<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> completely, including any config file you made for it. Xorg will default to its modesetting DDX driver. The performance of this driver is good and the locks go away. See also:  <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are experiencing flickering issues with Xorg, you can set <i>i915.enable_rc6</i> to 0 parameter into the kernel parameters which will disable to power saving of <a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a>.</div>
<h4><span class="mw-headline" id="2012_-_2014_models">2012 - 2014 models</span></h4>
<ul>
<li>
<a href="../en/MacBookPro11,x.html" title="MacBookPro11,x">MacBookPro11,x</a> (Late 2013—Mid 2014)</li>
<li>
<a href="../en/MacBookPro10,x.html" title="MacBookPro10,x">MacBookPro10,x</a> (Mid 2012—Early 2013)</li>
</ul>
<h3><span class="mw-headline" id="MacBook_Air">MacBook Air</span></h3>
<h4>
<span id="Early_2014_11.22_-_Version_6.2C1"></span><span class="mw-headline" id='Early_2014_11"_-_Version_6,1'>Early 2014 11" - Version 6,1</span>
</h4>
<p>This is almost the same as the 2013 version, where the only known difference is a slightly faster processor. The version numbers have not been changed since the 2013 version.
</p>
<p>It works excellently after following the instructions for the MBA 2013 13" here and in the forum thread.
Bluetooth, which has been reported not working for some people with the 2013 version, works without trouble for the 2014 version, although it should be exactly the same.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Unless you have a local repository on a USB disk, you need a USB to ethernet adaptor or a USB wireless adaptor supported natively by the kernel to easily install Arch Linux, since you have to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=broadcom-wl-dkms">broadcom-wl-dkms</a></span> package to make the internal wireless adaptor work.</div>
<p>Unresolved issues:
</p>
<ul>
<li>There is no driver for the webcam yet.</li>
<li>rEFInd uses 30 seconds to start booting. Using the bless trick stops rEFInd from loading, and it has to be re-installed.</li>
</ul>
<h4>
<span id="Mid_2013_13.22_-_Version_6.2C2"></span><span class="mw-headline" id='Mid_2013_13"_-_Version_6,2'>Mid 2013 13" - Version 6,2</span>
</h4>
<p><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=165899">Dedicated forum thread</a>
</p>
<h5><span class="mw-headline" id="Installing_and_booting">Installing and booting</span></h5>
<p>Booting from a normal 2013.6 USB key works fine, but I could not seem to get either GRUB or Syslinux working.
</p>
<p>I was able to boot by first installing Arch Linux following the MacBook guide at the wiki (having a separate FAT32 /boot partition). Skip the bootloader installation. 
</p>
<p>Installing <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/getting.html">rEFInd</a> from OS X (important!) and installing the EFI stub loader made me able to boot fine.
</p>
<p><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=165710">Dedicated thread</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Installing <a rel="nofollow" class="external text" href="http://www.rodsbooks.com/refind/getting.html">rEFInd</a> from Linux (or from OS X, but to the esp) also works fine</div>
<h5><span class="mw-headline" id="Arch_Only_Installation">Arch Only Installation</span></h5>
<p>This method works without rEFInd and uses grub to boot EFI.  Partition as follows:
</p>
<pre> /dev/sda1 200M Microsoft basic data
 /dev/sda2 256M Linux filesystem
 /dev/sda3 4G Linux swap
 /dev/sda4 108.6G Linux filesystem
</pre>
<p>sda1 can also be a HFS+ partition for EFI.  This example chooses to use FAT32 (vfat). Although swap is optional, it is required for hibernation. Instead of sda4 for root and home, an alternative partition scheme would be to make sda4 as root and sda5 as home.
</p>
<p>Format and mount:
</p>
<pre> mkfs.vfat -F 32 /dev/sda1
 mkfs.ext2 /dev/sda2
 mkswap /dev/sda3
 swapon /dev/sda3
 mkfs.ext4 /dev/sda4
</pre>
<pre> mount /dev/sda4 /mnt
 mkdir /mnt/boot
 mount /dev/sda2 /mnt/boot
 mkdir /mnt/boot/efi
 mount /dev/sda1 /mnt/boot/efi
</pre>
<p>Finish the installation according to the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a> and skip anything after the bootloader.  After you have generated your initramfs and set root passwd follow below to setup grub. First, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span>, then:
</p>
<pre> mount -t efivarfs efivarfs /sys/firmware/efi/efivars
 grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub --recheck --debug
 grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg
 cp /boot/efi/EFI/grub/grub.cfg /boot/grub/grub.cfg
 cp /boot/efi/EFI/grub/grubx64.efi /boot/efi/EFI/boot/bootx64.efi}}
</pre>
<p>Now you can exit/unmount/reboot:
</p>
<pre> exit
 umount -R /mnt
 reboot
</pre>
<h5><span class="mw-headline" id="Stability_problems">Stability problems</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Passing <code>libata.force=1:noncq</code> to the kernel parameters solves the problem.</div>
<p>This is the big worry for me. Every now and then my system hangs for a brief moment and everything involving net or disk access just hangs there for a while and then it seems to work. 
So far it only seems to happen when I run something disk or CPU-intensive. Also had an occasion when I could not start X and just got this repeating all over my screen:
</p>
<pre>ata1.00: failed command: WRITE FPDMA QUEUED
ata1.00: cmd 61/08:f0:10:8c:c2/00:00:0b:00:00/40 tag 30 ncq 4096 out
res 40/00:00:00:00:00/00:00:00:00:00/00 Emask 0x4 (timeout)
ata1.00: status: { DRDY }
</pre>
<p>On the next attempt it worked fine.
I did SMART short and long tests on my disk and they returned fine:
</p>
<p><a rel="nofollow" class="external text" href="http://pastebin.com/vRE4T2Ld">smartctl -a</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-30 ⓘ]</sup>
</p>
<p>There are some messages in my boot that indicate this could be disk and/or ACPI related.
</p>
<p>These are with 2013-06 ISO, 3.9.7-1 2013 x86_64 kernel.
</p>
<p><a rel="nofollow" class="external text" href="http://pastebin.com/mjTJaPFa">journalctl -b</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-30 ⓘ]</sup>
Seems to only work with the headphone jack, not with the speakers.
</p>
<p><a rel="nofollow" class="external text" href="http://pastebin.com/SdAcHuKh">dmesg</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-03-30 ⓘ]</sup>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Same problem in 2017 with a Macbook Air early 2014. Updating the firmware (via migration to macOS Sierra) solved the issue.</div>
<h5><span class="mw-headline" id="Marvell_ATA_suspend_bugs">Marvell ATA suspend bugs</span></h5>
<p>If you have 2013 MacBook Air with a Marvell 128 or 256 GB drive, you might get the following ata errors instead after pm-suspend/resumes:
</p>
<pre>ata1: exception Emask 0x10 SAct 0x0 SErr 0x10000 action 0xe frozen
ata1: irq_stat 0x00400000, PHY RDY changed
ata1: SError: { PHYRdyChg }
ata1: hard resetting link
ata1: SATA link up 1.5 Gbps (SStatus 113 SControl 310)
ata1.00: unexpected _GTF length (8)
ata1.00: unexpected _GTF length (8)
ata1.00: configured for UDMA/33
ata1: EH complete
</pre>
<p>Try what Patrick and Tejun figured out on the <a rel="nofollow" class="external text" href="https://bugzilla.kernel.org/show_bug.cgi?id=62351">linux bug</a>. I followed what Patrick describes with sata_alpm, and I have not seen the issue since.
</p>
<p>There are more steps on how to resolve this issue in <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1562168#p1562168">this thread on the Arch forum</a>
</p>
<h5>
<span id="Suspend.2FResume"></span><span class="mw-headline" id="Suspend/Resume">Suspend/Resume</span>
</h5>
<p>Brightness is either 0% or 100% after resuming from suspend.  Adding the kernel parameter "acpi_osi=!Darwin" to your bootloader fixes the problem, though may have other side effects including disabling the thunderbolt port.
</p>
<h5><span class="mw-headline" id="WiFi">WiFi</span></h5>
<p>WiFi does not work out of the box. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=broadcom-wl-dkms">broadcom-wl-dkms</a></span> to connect to a network.  If booting from the official Arch Linux ISO, one needs to unload a few standard modules in order to use the included wl module.  Do so as follows:
</p>
<pre># rmmod b43 ssb bcma wl
</pre>
<p>Now simply load the wl module:
</p>
<pre># modprobe wl
</pre>
<p>This should automatically load the onboard wifi which can be seen by issuing: <code>ip a</code>.  From here follow the <a href="../en/Wpa_supplicant.html#Connecting_with_wpa_cli" class="mw-redirect" title="WPA supplicant">WPA supplicant#Connecting with wpa_cli</a> article to bring up the wireless network.
</p>
<h5><span class="mw-headline" id="Touchpad_2">Touchpad</span></h5>
<p>Since 3.10.3 kernel touchpad works perfectly with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-input-synaptics">xf86-input-synaptics</a></span>.
</p>
<h5><span class="mw-headline" id="Audio">Audio</span></h5>
<p>ALSA may recognise the HDMI audio out as card 0 which will be the default card. Confirm this by checking the output of
</p>
<pre>   aplay -l
</pre>
<p>If that is the case, you may need to create a /etc/asound.conf with below entries:
</p>
<pre> defaults.pcm.card 1
 defaults.ctl.card 1
</pre>
<p>to use the HDA Intel card, ie. the built-in speakers / headphones.
</p>
<h4>
<span id="Mid_2012_13.22_.E2.80.94_version_5.2C2"></span><span class="mw-headline" id='Mid_2012_13"_—_version_5,2'>Mid 2012 13" — version 5,2</span>
</h4>
<p>Kernel panics using default boot media under arch kernel 3.5. Adding <code>intremap=off</code> fixes this. Additionally, there are problems loading the <code>applesmc</code> module (meaning the temperature sensors, fan, and keyboard backlight do not work). These problems are fixed in the linux 3.6-rc4 mainline kernel (I have tested).
</p>
<h4>
<span id="Mid_2012_11.5.22_.E2.80.94_Version_5.2C1"></span><span class="mw-headline" id='Mid_2012_11.5"_—_Version_5,1'>Mid 2012 11.5" — Version 5,1</span>
</h4>
<p>If you have issues with waking from sleep while in X11 such as a black screen or showing the console with a frozen mouse cursor then remove <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-input-synaptics">xf86-input-synaptics</a></span> and install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xf86-input-mtrack-git/">xf86-input-mtrack-git</a></span><sup><small>AUR</small></sup>. This fixed errors such as 
</p>
<pre> (EE) [dix] bcm5974: unable to find touch point 0
</pre>
<p>and backtraces that causes X11 to crash. This might apply to Version 5,2 assuming they use the same trackpad.
</p>
<h4>
<span id="Mid_2011_.E2.80.94_version_4.2Cx"></span><span class="mw-headline" id="Mid_2011_—_version_4,x">Mid 2011 — version 4,x</span>
</h4>
<p>Works out-of-the-box since kernel 3.2. 
</p>
<h4>
<span id="Mid_2009_.E2.80.94_version_2.2C1"></span><span class="mw-headline" id="Mid_2009_—_version_2,1">Mid 2009 — version 2,1</span>
</h4>
<p>Everything works, except the WIFI. You need to <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=b43-fwcutter">b43-fwcutter</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/b43-firmware/">b43-firmware</a></span><sup><small>AUR</small></sup> packages.
</p>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>options b43 pio=1 qos=0</code> to <code>/etc/modprobe.d/b43.conf</code>.
</p>
<h4>
<span id="Early_2008_.E2.80.94_version_1.2C1"></span><span class="mw-headline" id="Early_2008_—_version_1,1">Early 2008 — version 1,1</span>
</h4>
<p>Everything works out of the box though you will need the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=b43-fwcutter">b43-fwcutter</a></span> package (or simply <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/b43-firmware/">b43-firmware</a></span><sup><small>AUR</small></sup>) for the wireless adapter to work.
</p>
<p>Since this model has only one USB port, you may find it easiest to install Arch with a powered USB hub. Plug a USB network adapter (wireless or ethernet adapter to plug into a USB port) and your Arch installation media into the USB hub.
</p>
<p>If you cannot get any result by scanning wireless network after boot, unload modules <code>b43</code> and <code>ssb</code> and load them again:
</p>
<pre>   rmmod ssb
   rmmod b43
   modprobe b43
</pre>
<p>There is a good chance you will find what's wrong with DMA from the dmesg log.
</p>
<p>Even if you can scan wireless networks after reloading the modules, it's still possible that you will only be able to connect to some networks, but not all of them. According to a more detailed discussion here: <a rel="nofollow" class="external free" href="http://crunchbang.org/forums/viewtopic.php?id=17368">http://crunchbang.org/forums/viewtopic.php?id=17368</a>, adding <code>pio=1,qos=0</code> options to the b43 module can solve this problem.
</p>
<p>I tested this for a 13' MacBookAir1,1 with a BCM4321 chipset, and it works.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li>
<b>MacBook Air</b>
<ul>
<li><a rel="nofollow" class="external text" href="http://dabase.com/blog/Macbook_Air_Early_2014_Archlinux/">Macbook Air Early 2014 — dabase.com</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/d4ve01f/ArchLinux-on-MacBook-Air">How to install Archlinux on Macbook Air (6,2) — Davide Di Francesco</a></li>
<li><a rel="nofollow" class="external text" href="http://www.nico.schottelius.org/blog/macbook-air-42-archlinux/">Installing Linux on a Macbook Air (4,2) — Nico Schottelius</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Geek-Almighty/Arch-LInux-Files/blob/master/MBArchSetup%20v01">MacBook Air (7,2) — A.N Geek</a></li>
</ul>
</li></ul>
<ul><li><b>MacBook Pro</b></li></ul>
<ul><li><ul>
<li><a rel="nofollow" class="external free" href="http://allanmcrae.com/2010/04/installing-arch-on-a-macbook-pro-5-5/">http://allanmcrae.com/2010/04/installing-arch-on-a-macbook-pro-5-5/</a></li>
<li><a rel="nofollow" class="external free" href="http://allanmcrae.com/2012/04/installing-arch-on-a-macbook-pro-8-1/">http://allanmcrae.com/2012/04/installing-arch-on-a-macbook-pro-8-1/</a></li>
</ul></li></ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Apple.html" title="Category:Apple">Apple</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Mac&amp;oldid=652447">https://wiki.archlinux.org/index.php?title=Mac&amp;oldid=652447</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 15 February 2021, at 01:22.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
