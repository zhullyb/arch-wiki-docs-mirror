<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>nftables - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Nftables rootpage-Nftables skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">nftables</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="/title/Iptables" title="Iptables">iptables</a></li>
<li><a href="/title/Firewalld" title="Firewalld">Firewalld</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://netfilter.org/projects/nftables/">nftables</a> is a netfilter project that aims to replace the existing {ip,ip6,arp,eb}tables framework. It provides a new packet filtering framework, a new user-space utility (nft), and a compatibility layer for {ip,ip6}tables. It uses the existing hooks, connection tracking system, user-space queueing component, and logging subsystem of netfilter.
</p>
<p>It consists of three main components: a kernel implementation, the libnl <a href="https://en.wikipedia.org/wiki/Netlink" class="extiw" title="wikipedia:Netlink">netlink</a> communication and the nftables user-space front-end.
The kernel provides a netlink configuration interface, as well as run-time rule-set evaluation, libnl contains the low-level functions for communicating with the kernel, and the nftables front-end is what the user interacts with via nft.
</p>
<p>You can also visit the <a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page">official nftables wiki page</a> for more information.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Usage"><span class="tocnumber">2</span> <span class="toctext">Usage</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Simple_firewall"><span class="tocnumber">2.1</span> <span class="toctext">Simple firewall</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#Configuration"><span class="tocnumber">3</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-5">
<a href="#Tables"><span class="tocnumber">3.1</span> <span class="toctext">Tables</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Create_table"><span class="tocnumber">3.1.1</span> <span class="toctext">Create table</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#List_tables"><span class="tocnumber">3.1.2</span> <span class="toctext">List tables</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#List_chains_and_rules_in_a_table"><span class="tocnumber">3.1.3</span> <span class="toctext">List chains and rules in a table</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Delete_table"><span class="tocnumber">3.1.4</span> <span class="toctext">Delete table</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Flush_table"><span class="tocnumber">3.1.5</span> <span class="toctext">Flush table</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11">
<a href="#Chains"><span class="tocnumber">3.2</span> <span class="toctext">Chains</span></a>
<ul>
<li class="toclevel-3 tocsection-12">
<a href="#Create_chain"><span class="tocnumber">3.2.1</span> <span class="toctext">Create chain</span></a>
<ul>
<li class="toclevel-4 tocsection-13"><a href="#Regular_chain"><span class="tocnumber">3.2.1.1</span> <span class="toctext">Regular chain</span></a></li>
<li class="toclevel-4 tocsection-14"><a href="#Base_chain"><span class="tocnumber">3.2.1.2</span> <span class="toctext">Base chain</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-15"><a href="#List_rules"><span class="tocnumber">3.2.2</span> <span class="toctext">List rules</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Edit_a_chain"><span class="tocnumber">3.2.3</span> <span class="toctext">Edit a chain</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Delete_a_chain"><span class="tocnumber">3.2.4</span> <span class="toctext">Delete a chain</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#Flush_rules_from_a_chain"><span class="tocnumber">3.2.5</span> <span class="toctext">Flush rules from a chain</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19">
<a href="#Rules"><span class="tocnumber">3.3</span> <span class="toctext">Rules</span></a>
<ul>
<li class="toclevel-3 tocsection-20">
<a href="#Add_rule"><span class="tocnumber">3.3.1</span> <span class="toctext">Add rule</span></a>
<ul>
<li class="toclevel-4 tocsection-21"><a href="#Expressions"><span class="tocnumber">3.3.1.1</span> <span class="toctext">Expressions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-22"><a href="#Deletion"><span class="tocnumber">3.3.2</span> <span class="toctext">Deletion</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="#Sets"><span class="tocnumber">3.4</span> <span class="toctext">Sets</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Atomic_reloading"><span class="tocnumber">3.5</span> <span class="toctext">Atomic reloading</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25">
<a href="#Examples"><span class="tocnumber">4</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#Workstation"><span class="tocnumber">4.1</span> <span class="toctext">Workstation</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Server"><span class="tocnumber">4.2</span> <span class="toctext">Server</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Limit_rate"><span class="tocnumber">4.3</span> <span class="toctext">Limit rate</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Jump"><span class="tocnumber">4.4</span> <span class="toctext">Jump</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Different_rules_for_different_interfaces"><span class="tocnumber">4.5</span> <span class="toctext">Different rules for different interfaces</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#Masquerading"><span class="tocnumber">4.6</span> <span class="toctext">Masquerading</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#NAT_with_port_forwarding"><span class="tocnumber">4.7</span> <span class="toctext">NAT with port forwarding</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Count_new_connections_per_IP"><span class="tocnumber">4.8</span> <span class="toctext">Count new connections per IP</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Dynamic_blackhole"><span class="tocnumber">4.9</span> <span class="toctext">Dynamic blackhole</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-35">
<a href="#Tips_and_tricks"><span class="tocnumber">5</span> <span class="toctext">Tips and tricks</span></a>
<ul>
<li class="toclevel-2 tocsection-36"><a href="#Saving_current_rule_set"><span class="tocnumber">5.1</span> <span class="toctext">Saving current rule set</span></a></li>
<li class="toclevel-2 tocsection-37">
<a href="#Simple_stateful_firewall"><span class="tocnumber">5.2</span> <span class="toctext">Simple stateful firewall</span></a>
<ul>
<li class="toclevel-3 tocsection-38"><a href="#Single_machine"><span class="tocnumber">5.2.1</span> <span class="toctext">Single machine</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-39"><a href="#Prevent_brute-force_attacks"><span class="tocnumber">5.3</span> <span class="toctext">Prevent brute-force attacks</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Logging_traffic"><span class="tocnumber">5.4</span> <span class="toctext">Logging traffic</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-41">
<a href="#Troubleshooting"><span class="tocnumber">6</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-42"><a href="#Working_with_Docker"><span class="tocnumber">6.1</span> <span class="toctext">Working with Docker</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-43"><a href="#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Mention <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span>.<a rel="nofollow" class="external autonumber" href="https://www.redhat.com/en/blog/using-iptables-nft-hybrid-linux-firewall">[1]</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Nftables">Talk:Nftables#</a>)</div>
</div>
<p><a href="/title/Install" class="mw-redirect" title="Install">Install</a> the userspace utilities package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nftables">nftables</a></span> or the git version <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nftables-git/">nftables-git</a></span><sup><small>AUR</small></sup>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Most <a href="/title/Iptables#Front-ends" title="Iptables">iptables front-ends</a> feature no direct or indirect support of nftables, but may introduce it.<a rel="nofollow" class="external autonumber" href="https://www.spinics.net/lists/netfilter/msg58215.html">[2]</a> One graphical front-end that supports both, nftables and iptables, is <a href="/title/Firewalld" title="Firewalld">firewalld</a>.<a rel="nofollow" class="external autonumber" href="https://firewalld.org/2018/07/nftables-backend">[3]</a>
</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><b>nftables</b> makes <b>no</b> distinction between temporary rules made in the command line and permanent ones loaded from or saved to a file.
</p>
<p>All rules have to be created or loaded using <code>nft</code> command line utility.
</p>
<p>Refer to <a href="#Configuration">#Configuration</a> section on how to use.
</p>
<p>Current ruleset can be printed with:
</p>
<pre># nft list ruleset
</pre>
<h3><span class="mw-headline" id="Simple_firewall">Simple firewall</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nftables">nftables</a></span> comes with simple and secure firewall configuration stored in <code>/etc/nftables.conf</code> file.
</p>
<p>The <code>nftables.service</code> will load rules from that file when <a href="/title/Start/enable" class="mw-redirect" title="Start/enable">started or enabled</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>nftables user-space utility <code>nft</code> performs most of the rule-set evaluation before handing rule-sets to the kernel. Rules are stored in chains, which in turn are stored in tables. The following sections indicate how to create and modify these constructs.
</p>
<p>To read input from a file use the <code>-f</code>/<code>--file</code> option:
</p>
<pre># nft --file <i>filename</i>
</pre>
<p>Note that any rules already loaded are <b>not</b> automatically flushed.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8">nft(8)</a></span> for a complete list of all commands.
</p>
<h3><span class="mw-headline" id="Tables">Tables</span></h3>
<p>Tables hold <a href="#Chains">#Chains</a>. Unlike tables in iptables, there are no built-in tables in nftables. The number of tables and their names is up to the user. However, each table only has one address family and only applies to packets of this family. Tables can have one of five families specified:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>nftables family</th>
<th>iptables utility
</th>
</tr>
<tr>
<td>ip</td>
<td>iptables
</td>
</tr>
<tr>
<td>ip6</td>
<td>ip6tables
</td>
</tr>
<tr>
<td>inet</td>
<td>iptables and ip6tables
</td>
</tr>
<tr>
<td>arp</td>
<td>arptables
</td>
</tr>
<tr>
<td>bridge</td>
<td>ebtables
</td>
</tr>
</tbody>
</table>
<p><code>ip</code> (i.e. IPv4) is the default family and will be used if family is not specified.
</p>
<p>To create one rule that applies to both IPv4 and IPv6, use <code>inet</code>. <code>inet</code> allows for the unification of the <code>ip</code> and <code>ip6</code> families to make defining rules for both easier.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8#ADDRESS_FAMILIES">nft(8) § ADDRESS FAMILIES</a></span> for a complete description of address families.
</p>
<p>In all of the following, <code><i>family_type</i></code> is optional, and if not specified is set to <code>ip</code>.
</p>
<h4><span class="mw-headline" id="Create_table">Create table</span></h4>
<p>The following adds a new table:
</p>
<pre># nft add table <i>family_type</i> <i>table_name</i>
</pre>
<h4><span class="mw-headline" id="List_tables">List tables</span></h4>
<p>To list all tables:
</p>
<pre># nft list tables
</pre>
<h4><span class="mw-headline" id="List_chains_and_rules_in_a_table">List chains and rules in a table</span></h4>
<p>To list all chains and rules of a specified table do:
</p>
<pre># nft list table <i>family_type</i> <i>table_name</i>
</pre>
<p>For example, to list all the rules of the <code>my_table</code> table of the <code>inet</code> family:
</p>
<pre># nft list table inet my_table
</pre>
<h4><span class="mw-headline" id="Delete_table">Delete table</span></h4>
<p>To delete a table do:
</p>
<pre># nft delete table <i>family_type</i> <i>table_name</i>
</pre>
<p>This will destroy all chains in the table.
</p>
<h4><span class="mw-headline" id="Flush_table">Flush table</span></h4>
<p>To flush all rules from a table do:
</p>
<pre># nft flush table <i>family_type</i> <i>table_name</i>
</pre>
<h3><span class="mw-headline" id="Chains">Chains</span></h3>
<p>The purpose of chains is to hold <a href="#Rules">#Rules</a>. Unlike chains in iptables, there are no built-in chains in nftables. This means that if no chain uses any types or hooks in the netfilter framework, packets that would flow through those chains will not be touched by nftables, unlike iptables.
</p>
<p>Chains have two types. A <i>base</i> chain is an entry point for packets from the networking stack, where a hook value is specified. A <i>regular</i> chain may be used as a jump target for better organization.
</p>
<p>In all of the following <code><i>family_type</i></code> is optional, and if not specified is set to <code>ip</code>.
</p>
<h4><span class="mw-headline" id="Create_chain">Create chain</span></h4>
<h5><span class="mw-headline" id="Regular_chain">Regular chain</span></h5>
<p>The following adds a regular chain named <code><i>chain_name</i></code> to the table named <code><i>table_name</i></code>:
</p>
<pre># nft add chain <i>family_type</i> <i>table_name</i> <i>chain_name</i>
</pre>
<p>For example, to add a regular chain named <code>my_tcp_chain</code> to the <code>my_table</code> table of the <code>inet</code> address family do:
</p>
<pre># nft add chain inet my_table my_tcp_chain
</pre>
<h5><span class="mw-headline" id="Base_chain">Base chain</span></h5>
<p>To add a base chain specify hook and priority values:
</p>
<pre># nft add chain <i>family_type</i> <i>table_name</i> <i>chain_name</i> '{ type <i>chain_type</i> hook <i>hook_type</i> priority <i>priority_value</i> ; }'
</pre>
<p><code><i>chain_type</i></code> can be <code>filter</code>, <code>route</code>, or <code>nat</code>.
</p>
<p>For IPv4/IPv6/Inet address families <code><i>hook_type</i></code> can be <code>prerouting</code>, <code>input</code>, <code>forward</code>, <code>output</code>, or <code>postrouting</code>. See <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8#ADDRESS_FAMILIES">nft(8) § ADDRESS FAMILIES</a></span> for a list of hooks for other families.
</p>
<p><code><i>priority_value</i></code> takes either a priority name or an integer value. See <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8#CHAINS">nft(8) § CHAINS</a></span> for a list of standard priority names and values. Chains with lower numbers are processed first and can be negative. <a rel="nofollow" class="external autonumber" href="https://wiki.nftables.org/wiki-nftables/index.php/Configuring_chains#Base_chain_types">[4]</a>
</p>
<p>For example, to add a base chain that filters input packets:
</p>
<pre># nft add chain inet my_table my_chain '{ type filter hook input priority 0; }'
</pre>
<p>Replace <code>add</code> with <code>create</code> in any of the above to add a new chain but return an error if the chain already exists.
</p>
<h4><span class="mw-headline" id="List_rules">List rules</span></h4>
<p>The following lists all rules of a chain:
</p>
<pre># nft list chain <i>family_type</i> <i>table_name</i> <i>chain_name</i>
</pre>
<p>For example, the following lists the rules of the chain named <code>my_output</code> in the <code>inet</code> table named <code>my_table</code>:
</p>
<pre># nft list chain inet my_table my_output
</pre>
<h4><span class="mw-headline" id="Edit_a_chain">Edit a chain</span></h4>
<p>To edit a chain, simply call it by its name and define the rules you want to change.
</p>
<pre># nft chain <i>family_type table_name chain_name</i> '{ [ type <i>chain_type</i> hook <i>hook_type</i> device <i>device_name</i> priority <i>priority_value</i> ; policy <i>policy_type</i> ; ] }'
</pre>
<p>For example, to change the <code>my_input</code> chain policy of the default table from <code>accept</code> to <code>drop</code>
</p>
<pre># nft chain inet my_table my_input '{ policy drop ; }'
</pre>
<h4><span class="mw-headline" id="Delete_a_chain">Delete a chain</span></h4>
<p>To delete a chain do:
</p>
<pre># nft delete chain <i>family_type</i> <i>table_name</i> <i>chain_name</i>
</pre>
<p>The chain must not contain any rules or be a jump target.
</p>
<h4><span class="mw-headline" id="Flush_rules_from_a_chain">Flush rules from a chain</span></h4>
<p>To flush rules from a chain do:
</p>
<pre># nft flush chain <i>family_type</i> <i>table_name</i> <i>chain_name</i>
</pre>
<h3><span class="mw-headline" id="Rules">Rules</span></h3>
<p>Rules are either constructed from expressions or statements and are contained within chains.
</p>
<h4><span class="mw-headline" id="Add_rule">Add rule</span></h4>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <i>iptables-translate</i> utility translates <a href="/title/Iptables" title="Iptables">iptables</a> rules to nftables format.</div>
<p>To add a rule to a chain do:
</p>
<pre># nft add rule <i>family_type</i> <i>table_name</i> <i>chain_name</i> handle <i>handle_value</i> <i>statement</i>
</pre>
<p>The rule is appended at <code><i>handle_value</i></code>, which is optional. If not specified, the rule is appended to the end of the chain.
</p>
<p>To prepend the rule to the position do:
</p>
<pre># nft insert rule <i>family_type</i> <i>table_name</i> <i>chain_name</i> handle <i>handle_value</i> <i>statement</i>
</pre>
<p>If <code><i>handle_value</i></code> is not specified, the rule is prepended to the chain.
</p>
<h5><span class="mw-headline" id="Expressions">Expressions</span></h5>
<p>Typically a <code><i>statement</i></code> includes some expression to be matched and then a verdict statement. Verdict statements include <code>accept</code>, <code>drop</code>, <code>queue</code>, <code>continue</code>, <code>return</code>, <code>jump <i>chain_name</i></code>, and <code>goto <i>chain_name</i></code>. Other statements than verdict statements are possible. See <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8">nft(8)</a></span> for more information.
</p>
<p>There are various expressions available in nftables and, for the most part, coincide with their iptables counterparts. The most noticeable difference is that there are no generic or implicit matches. A generic match was one that was always available, such as <code>--protocol</code> or <code>--source</code>. Implicit matches were protocol-specific, such as <code>--sport</code> when a packet was determined to be TCP.
</p>
<p>The following is an incomplete list of the matches available:
</p>
<ul>
<li>meta    (meta properties, e.g. interfaces)</li>
<li>icmp    (ICMP protocol)</li>
<li>icmpv6  (ICMPv6 protocol)</li>
<li>ip      (IP protocol)</li>
<li>ip6     (IPv6 protocol)</li>
<li>tcp     (TCP protocol)</li>
<li>udp     (UDP protocol)</li>
<li>sctp    (SCTP protocol)</li>
<li>ct      (connection tracking)</li>
</ul>
<p>The following is an incomplete list of match arguments (for a more complete list, see <span class="plainlinks archwiki-template-man" title="$ man 8 nft"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nft.8">nft(8)</a></span>):
</p>
<pre>meta:
  oif &lt;output interface INDEX&gt;
  iif &lt;input interface INDEX&gt;
  oifname &lt;output interface NAME&gt;
  iifname &lt;input interface NAME&gt;

  (oif and iif accept string arguments and are converted to interface indexes)
  (oifname and iifname are more dynamic, but slower because of string matching)

icmp:
  type &lt;icmp type&gt;

icmpv6:
  type &lt;icmpv6 type&gt;

ip:
  protocol &lt;protocol&gt;
  daddr &lt;destination address&gt;
  saddr &lt;source address&gt;

ip6:
  daddr &lt;destination address&gt;
  saddr &lt;source address&gt;

tcp:
  dport &lt;destination port&gt;
  sport &lt;source port&gt;

udp:
  dport &lt;destination port&gt;
  sport &lt;source port&gt;

sctp:
  dport &lt;destination port&gt;
  sport &lt;source port&gt;

ct:
  state &lt;new | established | related | invalid&gt;
</pre>
<h4><span class="mw-headline" id="Deletion">Deletion</span></h4>
<p>Individual rules can only be deleted by their handles. The <code>nft --handle list</code> command must be used to determine rule handles. Note the <code>--handle</code> switch, which tells <code>nft</code> to list handles in its output.
</p>
<p>The following determines the handle for a rule and then deletes it. The <code>--numeric</code> argument is useful for viewing some numeric output, like unresolved IP addresses.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nft --handle --numeric list chain inet my_table my_input</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">table inet my_table {
     chain input {
          type filter hook input priority 0;
          ip saddr 127.0.0.1 accept # handle 10
     }
}
</pre>
<pre># nft delete rule inet my_table my_input handle 10
</pre>
<p>All the chains in a table can be flushed with the <code>nft flush table</code> command. Individual chains can be flushed using either the <code>nft flush chain</code> or <code>nft delete rule</code> commands.
</p>
<pre># nft flush table <i>table_name</i>
# nft flush chain <i>family_type</i> <i>table_name</i> <i>chain_name</i>
# nft delete rule <i>family_type</i> <i>table_name</i> <i>chain_name</i>
</pre>
<p>The first command flushes all of the chains in the ip <code><i>table_name</i></code> table. The second flushes the <code><i>chain_name</i></code> chain in the <code><i>family_type</i></code> <code><i>table_name</i></code> table. The third deletes all of the rules in <code><i>chain_name</i></code> chain in the <code><i>family_type</i></code> <code><i>table_name</i></code> table.
</p>
<h3><span class="mw-headline" id="Sets">Sets</span></h3>
<p><a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Sets">Sets are named or anonymous</a>, and consist of one or more elements, separated by commas, enclosed by curly braces. Anonymous sets are embedded in rules and cannot be updated, you must delete and re-add the rule. E.g., you cannot just remove "http" from the dports set in the following:
</p>
<pre># nft add rule ip6 filter input tcp dport {telnet, http, https} accept
</pre>
<p>Named sets can be updated, and can be typed and flagged. <i>sshguard</i> uses named sets for the IP addresses of blocked hosts.
</p>
<pre>table ip sshguard {
       set attackers {
               type ipv4_addr
               flags interval
               elements = { 1.2.3.4 }
       }
</pre>
<p>To <i>add</i> or <i>delete</i> elements from the set, use:
</p>
<pre># nft add element ip sshguard attackers { 5.6.7.8/32 }
# nft delete element ip sshguard attackers { 1.2.3.4/32 }
</pre>
<p>Note the type <i>ipv4_addr</i> can include a CIDR netmask (the "/32" here is not necessary, but is included for completeness' sake). Note also, the set defined here by "TABLE ip sshguard { SET attackers }" is addressed as <code>ip sshguard attackers</code>.
</p>
<h3><span class="mw-headline" id="Atomic_reloading">Atomic reloading</span></h3>
<p>Flush the current ruleset:
</p>
<pre># echo "flush ruleset" &gt; /tmp/nftables 
</pre>
<p>Dump the current ruleset:
</p>
<pre># nft -s list ruleset &gt;&gt; /tmp/nftables
</pre>
<p>Now you can edit <code>/tmp/nftables</code> and apply your changes with:
</p>
<pre># nft -f /tmp/nftables
</pre>
<h2><span class="mw-headline" id="Examples">Examples</span></h2>
<h3><span class="mw-headline" id="Workstation">Workstation</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nftables.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">flush ruleset

table inet my_table {
	chain my_input {
		type filter hook input priority 0; policy drop;

		iif lo accept comment "Accept any localhost traffic"
		ct state invalid drop comment "Drop invalid connections"
		ct state established,related accept comment "Accept traffic originated from us"

		meta l4proto ipv6-icmp icmpv6 type { destination-unreachable, packet-too-big, time-exceeded, parameter-problem, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report } accept comment "Accept ICMPv6"
		meta l4proto icmp icmp type { destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem } accept comment "Accept ICMP"
		ip protocol igmp accept comment "Accept IGMP"

		udp dport mdns ip6 daddr ff02::fb accept comment "Accept mDNS"
		udp dport mdns ip daddr 224.0.0.251 accept comment "Accept mDNS"

		udp sport 1900 udp dport &gt;= 1024 ip6 saddr { fd00::/8, fe80::/10 } meta pkttype unicast limit rate 4/second burst 20 packets accept comment "Accept UPnP IGD port mapping reply"
		udp sport 1900 udp dport &gt;= 1024 ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } meta pkttype unicast limit rate 4/second burst 20 packets accept comment "Accept UPnP IGD port mapping reply"

		udp sport netbios-ns udp dport &gt;= 1024 meta pkttype unicast ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept Samba Workgroup browsing replies"
		udp sport netbios-ns udp dport &gt;= 1024 meta pkttype unicast ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept Samba Workgroup browsing replies"

		counter comment "Count any other traffic"
	}

	chain my_forward {
		type filter hook forward priority 0; policy drop;
		# Drop everything forwarded to us. We do not forward. That is routers job.
	}

	chain my_output {
		type filter hook output priority 0; policy accept;
		# Accept every outbound connection
	}

}
</pre>
<h3><span class="mw-headline" id="Server">Server</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nftables.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">flush ruleset

table inet my_table {
	chain my_input {
		type filter hook input priority 0; policy drop;

		iif lo accept comment "Accept any localhost traffic"
		ct state invalid drop comment "Drop invalid connections"
		ct state established,related accept comment "Accept traffic originated from us"

		meta l4proto ipv6-icmp icmpv6 type { destination-unreachable, packet-too-big, time-exceeded, parameter-problem, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report } accept comment "Accept ICMPv6"
		meta l4proto icmp icmp type { destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem } accept comment "Accept ICMP"
		ip protocol igmp accept comment "Accept IGMP"

		udp dport mdns ip6 daddr ff02::fb accept comment "Accept mDNS"
		udp dport mdns ip daddr 224.0.0.251 accept comment "Accept mDNS"

		tcp dport ssh accept comment "Accept SSH on port 22"

		tcp dport ipp accept comment "Accept IPP/IPPS on port 631"

		tcp dport { http, https, 8008, 8080 } accept comment "Accept HTTP (ports 80, 443, 8008, 8080)"

		meta l4proto { tcp, udp } th dport 2049 ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept NFS"
		meta l4proto { tcp, udp } th dport 2049 ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept NFS"

		udp dport netbios-ns ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept NetBIOS Name Service (nmbd)"
		udp dport netbios-ns ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept NetBIOS Name Service (nmbd)"
		udp dport netbios-dgm ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept NetBIOS Datagram Service (nmbd)"
		udp dport netbios-dgm ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept NetBIOS Datagram Service (nmbd)"
		tcp dport netbios-ssn ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept NetBIOS Session Service (smbd)"
		tcp dport netbios-ssn ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept NetBIOS Session Service (smbd)"
		tcp dport microsoft-ds ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept Microsoft Directory Service (smbd)"
		tcp dport microsoft-ds ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept Microsoft Directory Service (smbd)"

		udp sport bootpc udp dport bootps ip saddr 0.0.0.0 ip daddr 255.255.255.255 accept comment "Accept DHCPDISCOVER (for DHCP-Proxy)"
		udp sport { bootpc, 4011 } udp dport { bootps, 4011 } ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept PXE"
		udp dport tftp ip6 saddr { fd00::/8, fe80::/10 } accept comment "Accept TFTP"
		udp dport tftp ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 169.254.0.0/16 } accept comment "Accept TFTP"

	}

	chain my_forward {
		type filter hook forward priority 0; policy drop;
		# Drop everything forwarded to us. We do not forward. That is routers job.
	}

	chain my_output {
		type filter hook output priority 0; policy accept;
		# Accept every outbound connection
	}

}
</pre>
<h3><span class="mw-headline" id="Limit_rate">Limit rate</span></h3>
<pre>table inet my_table {
	chain my_input {
		type filter hook input priority 0; policy drop;

		iif lo accept comment "Accept any localhost traffic"
		ct state invalid drop comment "Drop invalid connections"

		meta l4proto icmp icmp type echo-request limit rate over 10/second burst 4 packets drop comment "No ping floods"
		meta l4proto ipv6-icmp icmpv6 type echo-request limit rate over 10/second burst 4 packets drop comment "No ping floods"

		ct state established,related accept comment "Accept traffic originated from us"

		meta l4proto ipv6-icmp icmpv6 type { destination-unreachable, packet-too-big, time-exceeded, parameter-problem, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report } accept comment "Accept ICMPv6"
		meta l4proto icmp icmp type { destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem } accept comment "Accept ICMP"
		ip protocol igmp accept comment "Accept IGMP"

		tcp dport ssh ct state new limit rate 15/minute accept comment "Avoid brute force on SSH"

	}

}
</pre>
<h3><span class="mw-headline" id="Jump">Jump</span></h3>
<p>When using jumps in config file, it is necessary to define the target chain first. Otherwise one could end up with <code>Error: Could not process rule: No such file or directory</code>.
</p>
<pre>table inet my_table {
    chain web {
        tcp dport http accept
        tcp dport 8080 accept
    }
    chain my_input {
        type filter hook input priority 0;
        ip saddr 10.0.2.0/24 jump web
        drop
    }
}
</pre>
<h3><span class="mw-headline" id="Different_rules_for_different_interfaces">Different rules for different interfaces</span></h3>
<p>If your box has more than one network interface, and you would like to use different rules for different interfaces, you may want to use a "dispatching" filter chain, and then interface-specific filter chains. For example, let us assume your box acts as a home router, you want to run a web server accessible over the LAN (interface <code>enp3s0</code>), but not from the public internet (interface <code>enp2s0</code>), you may want to consider a structure like this:
</p>
<pre>table inet my_table {
  chain my_input { # this chain serves as a dispatcher
    type filter hook input priority 0;

    iif lo accept # always accept loopback
    iifname enp2s0 jump my_input_public
    iifname enp3s0 jump my_input_private

    reject with icmpx type port-unreachable # refuse traffic from all other interfaces
  }
  chain my_input_public { # rules applicable to public interface interface
    ct state {established,related} accept
    ct state invalid drop
    udp dport bootpc accept
    tcp dport bootpc accept
    reject with icmpx type port-unreachable # all other traffic
  }
  chain my_input_private {
    ct state {established,related} accept
    ct state invalid drop
    udp dport bootpc accept
    tcp dport bootpc accept
    tcp port http accept
    tcp port https accept
    reject with icmpx type port-unreachable # all other traffic
  }
  chain my_output { # we let everything out
    type filter hook output priority 0;
    accept
  }
}
</pre>
<p>Alternatively you could choose only one <code>iifname</code> statement, such as for the single upstream interface, and put the default rules for all other interfaces in one place, instead of dispatching for each interface.
</p>
<h3><span class="mw-headline" id="Masquerading">Masquerading</span></h3>
<p>nftables has a special keyword <code>masquerade</code> "where the source address is automagically set to the address of the output interface" (<a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_%28NAT%29#Masquerading">source</a>). This is particularly useful for situations in which the IP address of the interface is unpredictable or unstable, such as the upstream interface of routers connecting to many ISPs. Without it, the Network Address Translation rules would have to be updated every time the IP address of the interface changed.
</p>
<p>To use it:
</p>
<ul>
<li>make sure masquerading is enabled in the kernel (true if you use the default kernel), otherwise during kernel configuration, set <code>CONFIG_NFT_MASQ=m</code>.</li>
<li>the <code>masquerade</code> keyword can only be used in chains of type <code>nat</code>.</li>
<li>masquerading is a kind of source NAT, so only works in the output path.</li>
</ul>
<p>Example for a machine with two interfaces: LAN connected to <code>enp3s0</code>, and public internet connected to <code>enp2s0</code>:
</p>
<pre>table inet my_nat {
  chain my_masquerade {
    type nat hook postrouting priority 100;
    oifname "enp2s0" masquerade
  }
}
</pre>
<p>Since the table type is <code>inet</code> both IPv4 and IPv6 packets will be masqueraded. If you want only ipv4 packets to be masqueraded (since extra adress space of IPv6 makes NAT not required) <code>meta nfproto ipv4</code> expression can be used infront of <code>oifname "enp2s0" masquerade</code> or the table type can be changed to <code>ip</code>.
</p>
<h3><span class="mw-headline" id="NAT_with_port_forwarding">NAT with port forwarding</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> I think <code>my_postrouting</code> chain will cause the destination computer see that connections are made by router rather than from some global IP. Also this does not masquerade outbound traffic. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Nftables">Talk:Nftables#</a>)</div>
</div>
<p>This example will forward ports 22 and 80 to <code><i>destination_ip</i></code>. You will need to set <code>net.ipv4.ip_forward</code> and <code>net.ipv4.conf.<i>wan_interface</i>.forwarding</code> to <code>1</code> via <a href="/title/Sysctl" title="Sysctl">sysctl</a>.
</p>
<pre>table ip my_nat {
  chain my_prerouting {
    type nat hook prerouting priority -100;

    tcp dport { ssh, http } dnat to <i>destination_ip</i>
  }

  chain my_postrouting {
    type nat hook postrouting priority 100;

    ip daddr <i>destination_ip</i> masquerade
  }
}
</pre>
<h3><span class="mw-headline" id="Count_new_connections_per_IP">Count new connections per IP</span></h3>
<p>Use this snippet to count HTTPS connections:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nftables.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">table inet filter {
    set https {
        type ipv4_addr;
        flags dynamic;
        size 65536;
        timeout 60m;
    }

    chain input {
        type filter hook input priority 0
        ct state new tcp dport 443 update @https { ip saddr counter }
    }
}
</pre>
<p>To print the counters, run <code>nft list set inet filter https</code>.
</p>
<h3><span class="mw-headline" id="Dynamic_blackhole">Dynamic blackhole</span></h3>
<p>Use this snippet to drop all HTTPS connections for 1 minute from a source IP that exceeds the limit of 10/second.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nftables.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">table inet dev {
    set blackhole {
        type ipv4_addr;
        flags dynamic, timeout;
        size 65536;
    }

    chain input {
        ct state new tcp dport 443 \
                meter flood size 128000 { ip saddr timeout 10s limit rate over 10/second } \
                add @blackhole { ip saddr timeout 1m }

        ip saddr @blackhole counter drop
    }
}
</pre>
<p>To print the blackholed IPs, run <code>nft list set inet dev blackhole</code>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Saving_current_rule_set">Saving current rule set</span></h3>
<p>The output of <code>nft list ruleset</code> command is a valid input file for it as well. Current rule set can be saved to file and later loaded back in.
</p>
<pre>$ nft -s list ruleset | tee <i>filename</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>nft list</code> does not output variable definitions, if you had any in your original file they will be lost. Any variables used in rules will be replaced by their value.</div>
<h3><span class="mw-headline" id="Simple_stateful_firewall">Simple stateful firewall</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This is not a very simple firewall. I would consider what Arch Linux ships in /etc/nftables.conf simple. Recommend replacing this section with that script and give some directions on how to expand it for specific needs. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Nftables">Talk:Nftables#</a>)</div>
</div>
<p>See <a href="/title/Simple_stateful_firewall" title="Simple stateful firewall">Simple stateful firewall</a> for more information.
</p>
<h4><span class="mw-headline" id="Single_machine">Single machine</span></h4>
<p>Flush the current ruleset:
</p>
<pre># nft flush ruleset
</pre>
<p>Add a table:
</p>
<pre># nft add table inet my_table
</pre>
<p>Add the input, forward, and output base chains. The policy for input and forward will be to drop. The policy for output will be to accept.
</p>
<pre># nft add chain inet my_table my_input '{ type filter hook input priority 0 ; policy drop ; }'
# nft add chain inet my_table my_forward '{ type filter hook forward priority 0 ; policy drop ; }'
# nft add chain inet my_table my_output '{ type filter hook output priority 0 ; policy accept ; }'
</pre>
<p>Add two regular chains that will be associated with tcp and udp:
</p>
<pre># nft add chain inet my_table my_tcp_chain
# nft add chain inet my_table my_udp_chain
</pre>
<p>Related and established traffic will be accepted:
</p>
<pre># nft add rule inet my_table my_input ct state related,established accept
</pre>
<p>All loopback interface traffic will be accepted:
</p>
<pre># nft add rule inet my_table my_input iif lo accept
</pre>
<p>Drop any invalid traffic:
</p>
<pre># nft add rule inet my_table my_input ct state invalid drop
</pre>
<p>Accept ICMP and IGMP:
</p>
<pre># nft add rule inet my_table my_input meta l4proto ipv6-icmp icmpv6 type '{ destination-unreachable, packet-too-big, time-exceeded, parameter-problem, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report }' accept
# nft add rule inet my_table my_input meta l4proto icmp icmp type '{ destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem }' accept
# nft add rule inet my_table my_input ip protocol igmp accept
</pre>
<p>New udp traffic will jump to the UDP chain:
</p>
<pre># nft add rule inet my_table my_input meta l4proto udp ct state new jump my_udp_chain
</pre>
<p>New tcp traffic will jump to the TCP chain:
</p>
<pre># nft add rule inet my_table my_input 'meta l4proto tcp tcp flags &amp; (fin|syn|rst|ack) == syn ct state new jump my_tcp_chain'
</pre>
<p>Reject all traffic that was not processed by other rules:
</p>
<pre># nft add rule inet my_table my_input meta l4proto udp reject
# nft add rule inet my_table my_input meta l4proto tcp reject with tcp reset
# nft add rule inet my_table my_input counter reject with icmpx type port-unreachable
</pre>
<p>At this point you should decide what ports you want to open to incoming connections, which are handled by the TCP and UDP chains. For example to open connections for a web server add:
</p>
<pre># nft add rule inet my_table my_tcp_chain tcp dport 80 accept
</pre>
<p>To accept HTTPS connections for a webserver on port 443:
</p>
<pre># nft add rule inet my_table my_tcp_chain tcp dport 443 accept
</pre>
<p>To accept SSH traffic on port 22:
</p>
<pre># nft add rule inet my_table my_tcp_chain tcp dport 22 accept
</pre>
<p>To accept incoming DNS requests:
</p>
<pre># nft add rule inet my_table my_tcp_chain tcp dport 53 accept
# nft add rule inet my_table my_udp_chain udp dport 53 accept
</pre>
<p>Be sure to make your changes permanent when satisifed.
</p>
<h3><span class="mw-headline" id="Prevent_brute-force_attacks">Prevent brute-force attacks</span></h3>
<p><a href="/title/Sshguard" title="Sshguard">Sshguard</a> is program that can detect brute-force attacks and modify firewalls based on IP addresses it temporarily blacklists. See <a href="/title/Sshguard#nftables" title="Sshguard">Sshguard#nftables</a> on how to set up nftables to be used with it.
</p>
<h3><span class="mw-headline" id="Logging_traffic">Logging traffic</span></h3>
<p>You can log packets using the <code>log</code> action. The most simple rule to log all incoming traffic is:
</p>
<pre># nft add rule inet filter input log
</pre>
<p>See <a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Logging_traffic">nftables wiki</a> for details.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Working_with_Docker">Working with Docker</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> This section is not correct. The default docker forward policy is accept. This might end in an insecure forward chain... (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Nftables">Talk:Nftables#</a>)</div>
</div>
<p>Using nftables can interfere with <a href="/title/Docker" title="Docker">Docker</a> networking (and probably other container runtimes as well). In particular the drop policy for the <code>forward</code> chain will block packets originating in docker containers. If you want to keep the <code>forward</code> rule in your <code>inet</code> table, you can use the following:
</p>
<ol>
<li>
<a href="/title/Install" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span> to provide an iptables compatible interface for nftables that docker can use.</li>
<li>Use the following for the <code>forward</code> chain in your <code>inet</code> table:
<dl><dd><pre>chain forward {
  type filter hook forward priority security; policy drop;
  mark 1 accept
</pre></dd></dl>
</li>
<li>Add a rule to the DOCKER-USER chain in the <code>ip filter</code> table to mark packets if docker is running:
<dl><dd><pre>table ip filter {
  chain DOCKER-USER {
    mark set 1
  }
}
</pre></dd></dl>
</li>
</ol>
<p>This works by marking packets if docker is active, and accepting the packets in this case, since docker has already filtered them (the forward chain defined by docker uses a drop policy).
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://wiki.nftables.org/">netfilter nftables wiki</a></li>
<li><a href="https://wiki.debian.org/nftables" class="extiw" title="debian:nftables">debian:nftables</a></li>
<li><a href="https://wiki.gentoo.org/wiki/nftables" class="extiw" title="gentoo:nftables">gentoo:nftables</a></li>
<li><a rel="nofollow" class="external text" href="https://lwn.net/Articles/324251/">First release of nftables</a></li>
<li><a rel="nofollow" class="external text" href="https://home.regit.org/netfilter-en/nftables-quick-howto/">nftables quick howto</a></li>
<li><a rel="nofollow" class="external text" href="https://lwn.net/Articles/564095/">The return of nftables</a></li>
<li><a rel="nofollow" class="external text" href="https://developers.redhat.com/blog/2016/10/28/what-comes-after-iptables-its-successor-of-course-nftables/">What comes after ‘iptables’? Its successor, of course: `nftables`</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Firewalls" title="Category:Firewalls">Firewalls</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Accuracy" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Nftables&amp;oldid=667640">https://wiki.archlinux.org/index.php?title=Nftables&amp;oldid=667640</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 3 May 2021, at 08:16.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
