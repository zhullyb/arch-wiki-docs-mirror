<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GitLab - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GitLab rootpage-GitLab skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">GitLab</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Gitolite.html" title="Gitolite">Gitolite</a></li>
<li><a href="../en/Ruby_on_Rails.html" title="Ruby on Rails">Ruby on Rails</a></li>
</ul>
</div>
<p>From <a rel="nofollow" class="external text" href="https://about.gitlab.com/">GitLab's homepage</a>:
</p>
<dl><dd>GitLab offers git repository management, code reviews, issue tracking, activity feeds and wikis. Enterprises install GitLab on-premise and connect it with LDAP and Active Directory servers for secure authentication and authorization. A single GitLab server can handle more than 25,000 users but it is also possible to create a high availability setup with multiple active servers.</dd></dl>
<p>An example live version can be found at <a rel="nofollow" class="external text" href="https://gitlab.com/">GitLab.com</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installation"><span class="tocnumber">1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Configuration"><span class="tocnumber">2</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Preliminary_notes"><span class="tocnumber">2.1</span> <span class="toctext">Preliminary notes</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#GitLab"><span class="tocnumber">2.2</span> <span class="toctext">GitLab</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Custom_port_for_Puma"><span class="tocnumber">2.3</span> <span class="toctext">Custom port for Puma</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Secret_strings"><span class="tocnumber">2.4</span> <span class="toctext">Secret strings</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Redis"><span class="tocnumber">2.5</span> <span class="toctext">Redis</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#PostgreSQL_database"><span class="tocnumber">2.6</span> <span class="toctext">PostgreSQL database</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Initialize_Gitlab_database"><span class="tocnumber">2.7</span> <span class="toctext">Initialize Gitlab database</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Adjust_modifier_bits"><span class="tocnumber">2.8</span> <span class="toctext">Adjust modifier bits</span></a></li>
<li class="toclevel-2 tocsection-11">
<a href="#Web_server_configuration"><span class="tocnumber">2.9</span> <span class="toctext">Web server configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Nginx"><span class="tocnumber">2.9.1</span> <span class="toctext">Nginx</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Apache"><span class="tocnumber">2.9.2</span> <span class="toctext">Apache</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Node.js"><span class="tocnumber">2.9.3</span> <span class="toctext">Node.js</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15">
<a href="#HTTPS/SSL"><span class="tocnumber">2.10</span> <span class="toctext">HTTPS/SSL</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="#Change_GitLab_configs"><span class="tocnumber">2.10.1</span> <span class="toctext">Change GitLab configs</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Let's_Encrypt"><span class="tocnumber">2.10.2</span> <span class="toctext">Let's Encrypt</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-18"><a href="#Firewall"><span class="tocnumber">2.11</span> <span class="toctext">Firewall</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-19"><a href="#Start_and_test_GitLab"><span class="tocnumber">3</span> <span class="toctext">Start and test GitLab</span></a></li>
<li class="toclevel-1 tocsection-20">
<a href="#Upgrade_database_on_updates"><span class="tocnumber">4</span> <span class="toctext">Upgrade database on updates</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="#Manual_method"><span class="tocnumber">4.1</span> <span class="toctext">Manual method</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Automatic_method"><span class="tocnumber">4.2</span> <span class="toctext">Automatic method</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#Advanced_configuration"><span class="tocnumber">5</span> <span class="toctext">Advanced configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Basic_SSH"><span class="tocnumber">5.1</span> <span class="toctext">Basic SSH</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Custom_SSH_connection"><span class="tocnumber">5.2</span> <span class="toctext">Custom SSH connection</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Sending_emails_from_GitLab"><span class="tocnumber">5.3</span> <span class="toctext">Sending emails from GitLab</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-27">
<a href="#Useful_tips"><span class="tocnumber">6</span> <span class="toctext">Useful tips</span></a>
<ul>
<li class="toclevel-2 tocsection-28"><a href="#Rake_tasks"><span class="tocnumber">6.1</span> <span class="toctext">Rake tasks</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Backup_and_restore"><span class="tocnumber">6.2</span> <span class="toctext">Backup and restore</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Enable_fast_SSH_key_lookup"><span class="tocnumber">6.3</span> <span class="toctext">Enable fast SSH key lookup</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31">
<a href="#Troubleshooting"><span class="tocnumber">7</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="#HTTPS_is_not_green_(gravatar_not_using_https)"><span class="tocnumber">7.1</span> <span class="toctext">HTTPS is not green (gravatar not using https)</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Errors_after_updating"><span class="tocnumber">7.2</span> <span class="toctext">Errors after updating</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#GitLab_Puma_cannot_access_non-default_repositories_directory"><span class="tocnumber">7.3</span> <span class="toctext">GitLab Puma cannot access non-default repositories directory</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Failed_to_connect_to_Gitaly"><span class="tocnumber">7.4</span> <span class="toctext">Failed to connect to Gitaly</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Failed_to_connect_via_SSH"><span class="tocnumber">7.5</span> <span class="toctext">Failed to connect via SSH</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#CSS_or_styles_issue"><span class="tocnumber">7.6</span> <span class="toctext">CSS or styles issue</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#The_server_does_not_support_push_options"><span class="tocnumber">7.7</span> <span class="toctext">The server does not support push options</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-39"><a href="#See_also"><span class="tocnumber">8</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>GitLab requires <a href="../en/Redis.html" title="Redis">Redis</a> and a database backend. If you plan to run it on the same machine, first install <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package.
</p>
<p>Finally, a <a href="../en/List_of_applications/Internet.html#Web_servers" class="mw-redirect" title="Web server">web server</a> has to be installed and configured. The configuration for GitLab will be discussed in the <a href="#Web_server_configuration">#Web server configuration</a> section.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Preliminary_notes">Preliminary notes</span></h3>
<p>GitLab is composed of multiple components, see the <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ce/development/architecture.html">architecture overview page</a>.
</p>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package installs GitLab's files in a manner that more closely follow standard Linux conventions:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Description
</th>
<th>
<a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">GitLab's Official</a>
</th>
<th>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span>
</th>
</tr>
<tr>
<td>Application Code
</td>
<td>
<code>/home/git</code>
</td>
<td>
<code>/usr/share/webapps/gitlab</code>
</td>
</tr>
<tr>
<td>Application Data
</td>
<td>
<code>/home/git</code>
</td>
<td>
<code>/var/lib/gitlab</code>
</td>
</tr>
<tr>
<td>User (Home Directory)
</td>
<td>
<code>git</code> (<code>/home/git</code>)
</td>
<td>
<code>gitlab</code> (<code>/var/lib/gitlab</code>)
</td>
</tr>
<tr>
<td>Configuration File GitShell
</td>
<td>
<code>/home/git/gitlab-shell/config.yml</code>
</td>
<td>
<code>/etc/webapps/gitlab-shell/config.yml</code>
</td>
</tr>
<tr>
<td>Configuration File GitLab
</td>
<td>
<code>/home/git/gitlab/config/gitlab.yml</code>
</td>
<td>
<code>/etc/webapps/gitlab/gitlab.yml</code>
</td>
</tr>
<tr>
<td>Logs
</td>
<td>
<code>/home/git/log</code>
</td>
<td>
<code>/var/log/gitlab</code>
</td>
</tr>
<tr>
<td>Unix socket files / PID files
</td>
<td>
<code>/home/git/sockets</code>
</td>
<td>
<code>/run/gitlab</code>
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you are familiar with the <a href="../en/Arch_Build_System.html" title="Arch Build System">Arch Build System</a> you can edit the PKGBUILD and relevant files to change gitlab's home directory to a place of your liking.</div>
<h3><span class="mw-headline" id="GitLab">GitLab</span></h3>
<p>Edit <code>/etc/webapps/gitlab/gitlab.yml</code> and setup at least the following parameters:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>hostname</code> and <code>port</code> are used for the <code>git clone http://<i>hostname:port</i></code> as example.</div>
<p><b>Hostname:</b> In the <code>gitlab:</code> section set <code>host:</code> - replacing <code>localhost</code> to <code><i>yourdomain.com</i></code> (no <code>http://</code> or trailing slash) - into your fully qualified domain name.
</p>
<p><b>Port:</b> <code>port:</code> can be confusing. This is not the port that the GitLab server (Puma) runs on; it is the port that users will initially access through in their browser. Basically, if you intend for users to visit <code><i>yourdomain.com</i></code> in their browser, without appending a port number to the domain name, leave <code>port:</code> as <code>80</code>. If you intend your users to type something like <code><i>yourdomain.com:3425</i></code> into their browsers, then you would set <code>port:</code> to <code>3425</code>. You will also have to <b>configure your webserver</b> to listen on that port.
</p>
<p><b>Timezone (optional):</b> The <code>time_zone:</code> parameter is optional, but may be useful to force the zone of GitLab applications.
</p>
<p>Based on the table in <a href="#Preliminary_notes">#Preliminary notes</a> above, the following paths have to be configured in <code>gitlab.yml</code>:
</p>
<ul>
<li><code>repository_downloads_path: "/var/lib/gitlab/shared/cache/archive/"</code></li>
<li>
<code>gitlab_ci</code> section: <code>builds_path: "/var/lib/gitlab/builds/"</code>
</li>
<li>
<code>incoming_email</code> section (if enabled): <code>log_path: "/var/log/gitlab/mail_room_json.log"</code>
</li>
<li>
<code>artifacts</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/artifacts"</code>
</li>
<li>
<code>external_diffs</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/external-diffs"</code>
</li>
<li>
<code>lfs</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/lfs-objects"</code>
</li>
<li>
<code>packages</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/packages"</code>
</li>
<li>
<code>dependency_proxy</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/dependency_proxy"</code>
</li>
<li>
<code>terraform_state</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/terraform_state"</code>
</li>
<li>
<code>pages</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/pages"</code>
</li>
<li>
<code>registry</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/registry"</code>
</li>
</ul>
<h3><span class="mw-headline" id="Custom_port_for_Puma">Custom port for Puma</span></h3>
<p>GitLab Puma is the main component which processes most of the user requests. By default, it listens on the <code>/run/gitlab/gitlab.socket</code> UNIX socket which can be changed in the <code>/etc/webapps/gitlab/puma.rb</code> file.
</p>
<p>To configure Puma to listen on a TCP port as well as UNIX socket:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/puma.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">bind 'unix:///run/gitlab/gitlab.socket'
bind 'tcp://127.0.0.1:8080'</pre>
<p>If the Puma address is changed, the configuration of other components which communicate with Puma have to be updated as well:
</p>
<ul><li>For GitLab Shell, update the <code>gitlab_url</code> variable in <code>/etc/webapps/gitlab-shell/config.yml</code> and <code>url</code> in the <code>[gitlab]</code> section in <code>/etc/gitlab-gitaly/config.toml</code>.</li></ul>
<dl><dd><div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> UNIX socket path can be specified with URL-escaped slashes (i.e. <code>http+unix://%2Frun%2Fgitlab%2Fgitlab.socket</code> for the default <code>/run/gitlab/gitlab.socket</code>).</div></dd></dl>
<ul><li>For GitLab Workhorse, <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the <code>gitlab-workhorse.service</code> and update the <code>-authBackend</code> option. See <a rel="nofollow" class="external autonumber" href="https://gitlab.com/gitlab-org/gitlab-workhorse#relative-url-support">[1]</a> for details.</li></ul>
<h3><span class="mw-headline" id="Secret_strings">Secret strings</span></h3>
<p>Make sure that the files <code>/etc/webapps/gitlab/secret</code> and <code>/etc/webapps/gitlab-shell/secret</code> files contain something. Their content should be kept secret because they are used for the generation of authentication tokens etc.
</p>
<p>For example, random strings can be generated with the following commands:
</p>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab/secret
# chmod 640 /etc/webapps/gitlab/secret
</pre>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab-shell/secret
# chmod 640 /etc/webapps/gitlab-shell/secret
</pre>
<p>Also fill in (new) secret strings for <code>secrets.yml</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/secrets.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">production:
  secret_key_base: <i>secret</i>
  db_key_base: <i>secret</i>
</pre>
<h3><span class="mw-headline" id="Redis">Redis</span></h3>
<p>In order to provide sufficient performance you will need a cache database. <a href="../en/Redis.html#Installation" title="Redis">Install</a> and <a href="../en/Redis.html#Configuration" title="Redis">configure</a> a Redis instance, being careful to the section dedicated to listening via a socket.
</p>
<p>Add the <code>gitlab</code> user to the <code>redis</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> and update this configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/resque.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">development:
  url: unix:/run/redis/redis.sock
test:
  url: unix:/run/redis/redis.sock
production:
  url: unix:/run/redis/redis.sock</pre>
<h3><span class="mw-headline" id="PostgreSQL_database">PostgreSQL database</span></h3>
<p>A <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> database will be required before Gitlab can be run.
</p>
<p>Login to PostgreSQL and create the <code>gitlabhq_production</code> database along with its user. Remember to change <code>your_username_here</code> and <code>your_password_here</code> to the real values:
</p>
<pre># psql -d template1
</pre>
<pre>template1=# CREATE USER your_username_here WITH PASSWORD 'your_password_here';
template1=# ALTER USER your_username_here SUPERUSER;
template1=# CREATE DATABASE gitlabhq_production OWNER your_username_here;
template1=# \q</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The reason for creating the user as a superuser is that GitLab is trying to be "smart" and install extensions (not just create them in its own userspace). And this is only allowed by superusers in Postgresql.</div>
<p>Try connecting to the new database with the new user to verify it works:
</p>
<pre># psql -d gitlabhq_production
</pre>
<p>Open the new <code>/etc/webapps/gitlab/database.yml</code> and set the values for <code>username:</code> and <code>password:</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/database.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#
# PRODUCTION
#
production:
  adapter: postgresql
  encoding: unicode
  database: gitlabhq_production
  pool: 10
  username: your_username_here
  password: "your_password_here"
  # host: localhost
  # port: 5432
  socket: /run/postgresql/.s.PGSQL.5432
...
</pre>
<p>For our purposes (unless you know what you are doing), you do not need to worry about configuring the other databases listed in <code>/etc/webapps/gitlab/database.yml</code>. We only need to set up the production database to get GitLab working.
</p>
<h3><span class="mw-headline" id="Initialize_Gitlab_database">Initialize Gitlab database</span></h3>
<p>Start the <a href="../en/Redis.html" title="Redis">Redis</a> server and the <code>gitlab-gitaly.service</code> before initializing the database.
</p>
<p>Initialize the database and activate advanced features:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:setup
</pre>
<p>Finally run the following commands to check your installation:
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:env:info
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:check
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The <i>gitlab:env:info</i> and <i>gitlab:check</i> commands might show a fatal error related to git. This is OK.</li>
<li>The <i>gitlab:check</i> will complain about missing initscripts. This is nothing to worry about, as <a href="../en/Systemd.html" title="Systemd">systemd</a> service files are used instead (which GitLab does not recognize).</li>
</ul>
</div>
<h3><span class="mw-headline" id="Adjust_modifier_bits">Adjust modifier bits</span></h3>
<p>(The gitlab check will not pass if the user and group ownership is not configured properly)
</p>
<pre># chmod -R ug+rwX,o-rwx /var/lib/gitlab/repositories/
# chmod -R ug-s /var/lib/gitlab/repositories
# find /var/lib/gitlab/repositories/ -type d -print0 | xargs -0 chmod g+s
</pre>
<h3><span class="mw-headline" id="Web_server_configuration">Web server configuration</span></h3>
<p>To access GitLab from an outside network, the upstream documentation recommends to use an established web server as a proxy. All queries from the web server to GitLab are processed by GitLab Workhorse, which decides how they should be processed. See <a rel="nofollow" class="external autonumber" href="https://gitlab.com/gitlab-org/gitlab-workhorse#quick-facts-how-does-workhorse-work">[2]</a> for details.
</p>
<h4><span class="mw-headline" id="Nginx">Nginx</span></h4>
<p>See <a href="../en/Nginx.html#Configuration" title="Nginx">Nginx#Configuration</a> for basic <i>nginx</i> configuration and <a href="../en/Nginx.html#TLS" title="Nginx">Nginx#TLS</a> for enabling HTTPS. The sample in this section also assumes that server blocks are managed with <a href="../en/Nginx.html#Managing_server_entries" title="Nginx">Nginx#Managing server entries</a>.
</p>
<p>Create and edit the configuration based on the following snippet. See the <a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-ce/tree/master/lib/support/nginx">upstream GitLab repository</a> for more examples.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/servers-available/gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">upstream gitlab-workhorse {
  server unix:/run/gitlab/gitlab-workhorse.socket fail_timeout=0;
}

server {
  listen 80;                  # IPv4 HTTP
  #listen 443 ssl http2;      # uncomment to enable IPv4 HTTPS + HTTP/2
  #listen [::]:80;            # uncomment to enable IPv6 HTTP
  #listen [::]:443 ssl http2; # uncomment to enable IPv6 HTTPS + HTTP/2
  server_name example.com;

  access_log  /var/log/gitlab/nginx_access.log;
  error_log   /var/log/gitlab/nginx_error.log;

  #ssl_certificate ssl/example.com.crt;
  #ssl_certificate_key ssl/example.com.key;

  location ~ ^/(assets)/ {
    root /usr/share/webapps/gitlab/public;
    gzip_static on; # to serve pre-gzipped version
    expires max;
    add_header Cache-Control public;
  }

  location / {
      # unlimited upload size in nginx (so the setting in GitLab applies)
      client_max_body_size 0;

      # proxy timeout should match the timeout value set in /etc/webapps/gitlab/puma.rb
      proxy_read_timeout 60;
      proxy_connect_timeout 60;
      proxy_redirect off;

      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-Ssl on;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_pass http://gitlab-workhorse;
  }

  error_page 404 /404.html;
  error_page 422 /422.html;
  error_page 500 /500.html;
  error_page 502 /502.html;
  error_page 503 /503.html;
  location ~ ^/(404|422|500|502|503)\.html$ {
    root /usr/share/webapps/gitlab/public;
    internal;
  }
}
</pre>
<h4><span class="mw-headline" id="Apache">Apache</span></h4>
<p>Install and configure the <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a> and <a href="../en/Apache_HTTP_Server.html#TLS" title="Apache HTTP Server">Apache HTTP Server#TLS</a> for enabling HTTPS. You can use these <a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/web-server/apache">upstream recipes</a> to get started with the configuration file for GitLab's virtual host.
</p>
<p>Notice that the SSL virtual host needs a specific IP instead of generic. Also if you set a custom port for Puma, do not forget to set it at the <code>BalanceMember</code> line.
</p>
<p>A working example with certbot flavor assuming that <code>gitlab-workhorse.service</code> contains <code>-listenNetowrk tcp -listenAddr 127.0.0.8181</code> on the <code>ExecStart</code> line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/gitlab.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;VirtualHost *:443&gt;
    ServerName SERVERNAME
    ServerAlias SERVERNAME
    DocumentRoot /usr/share/webapps/gitlab/public
    &lt;Directory /usr/share/webapps/gitlab/public&gt;
        Options FollowSymlinks
        AllowOverride all
        Require all granted
    &lt;/Directory&gt;
    &lt;IfModule mod_alias.c&gt;
        Alias / /usr/share/webapps/gitlab/public/
    &lt;/IfModule&gt;

    &lt;IfModule mod_headers.c&gt;
        Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains; preload"
    &lt;/IfModule&gt;

    ProxyPreserveHost On
    SSLProxyEngine on
    AllowEncodedSlashes NoDecode
    &lt;Location /&gt;
        Require all granted
        ProxyPassReverse http://127.0.0.1:8181
        ProxyPassReverse http://SERVERNAME
    &lt;/Location&gt;
    #
    RewriteEngine on
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f [OR]
    RewriteCond %{REQUEST_URI} ^/uploads/.*
    RewriteRule .* http://127.0.0.1:8181%{REQUEST_URI} [P,QSA,NE]
    RequestHeader set X_FORWARDED_PROTO 'https'
    RequestHeader set X-Forwarded-Ssl on
    #
    ErrorDocument 404 /404.html
    ErrorDocument 422 /422.html
    ErrorDocument 500 /500.html
    ErrorDocument 503 /deploy.html
    ErrorLog /var/log/httpd/gitlab.lan.info-error_log
    CustomLog /var/log/httpd/gitlab.lan.info-access_log common
Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/SERVERNAME/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/SERVERNAME/privkey.pem
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerName SERVERNAME
    Redirect / https://SERVERNAME
RewriteEngine on
RewriteCond %{SERVER_NAME} =SERVERNAME
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
&lt;/VirtualHost&gt;
</pre>
<h4><span class="mw-headline" id="Node.js">Node.js</span></h4>
<p>You can easily set up an HTTPS proxy on port 443 to proxy traffic to the GitLab Workhorse using <a rel="nofollow" class="external text" href="https://github.com/CodeCharmLtd/http-master">http-master</a> for Node.js. http-master is built on top of <a rel="nofollow" class="external text" href="https://github.com/nodejitsu/node-http-proxy">node-http-proxy</a>.
</p>
<h3>
<span id="HTTPS.2FSSL"></span><span class="mw-headline" id="HTTPS/SSL">HTTPS/SSL</span>
</h3>
<h4><span class="mw-headline" id="Change_GitLab_configs">Change GitLab configs</span></h4>
<p>Modify <code>/etc/webapps/gitlab/shell.yml</code> so the URL to your GitLab site starts with <code>https://</code>. Modify <code>/etc/webapps/gitlab/gitlab.yml</code> so that <code>https:</code> setting is set to <code>true</code>.
</p>
<h4>
<span id="Let.27s_Encrypt"></span><span class="mw-headline" id="Let's_Encrypt">Let's Encrypt</span>
</h4>
<p>To validate your URL, the Let's Encrypt process will try to access your GitLab server via a URL such as <code><i>your.domain.name</i>/.well-known/acme-challenge/<i>a_long_id</i></code>. Hence, you need to make sure that requests to the <code>.well-known</code> subdirectory are not proxied to GitLab Workhorse. This can be done easily with the Certbot's "webroot" method, see <a href="../en/Certbot.html#Webroot" title="Certbot">Certbot#Webroot</a> for details.
</p>
<h3><span class="mw-headline" id="Firewall">Firewall</span></h3>
<p>If you want to give direct access to your Gitlab installation through an <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall, you may need to adjust the port and the network address:
</p>
<pre># iptables -A tcp_inbound -p TCP -s <b>192.168.1.0/24</b> --destination-port <b>80</b> -j ACCEPT
</pre>
<p>If you are behind a router, do not forget to forward this port to the running GitLab server host, if you want to allow WAN access.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Allowing access to GitLab from hosts other than localhost is not recommended before completing the installation and setting the root password. See <a href="#Start_and_test_GitLab">#Start and test GitLab</a>.</div>
<h2><span class="mw-headline" id="Start_and_test_GitLab">Start and test GitLab</span></h2>
<p>Make sure <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> and <a href="../en/Redis.html" title="Redis">Redis</a> are running and setup correctly.
</p>
<p>Then <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a>/<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> <code>gitlab.target</code>.
</p>
<p>Now test your GitLab instance by visiting <a rel="nofollow" class="external free" href="http://localhost">http://localhost</a> or <code><a rel="nofollow" class="external free" href="http://localhost">http://localhost</a>:<i>port</i></code>, where <code><i>port</i></code> is the port number on which your web server listens. You should be prompted to create a password:
</p>
<pre>username: root
password: You will be prompted to create one on your first visit.
</pre>
<p>See <a href="#Troubleshooting">#Troubleshooting</a> and log files inside the <code>/var/log/gitlab/</code> directory for troubleshooting.
</p>
<h2><span class="mw-headline" id="Upgrade_database_on_updates">Upgrade database on updates</span></h2>
<h3><span class="mw-headline" id="Manual_method">Manual method</span></h3>
<p>After updating the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package, it is required to upgrade the database:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake db:migrate
</pre>
<p>Afterwards, restart gitlab-related services:
</p>
<pre># systemctl daemon-reload
# systemctl restart gitlab-sidekiq gitlab-puma gitlab-workhorse gitlab-gitaly
</pre>
<h3><span class="mw-headline" id="Automatic_method">Automatic method</span></h3>
<p>You can create pacman hooks to automate database upgrades on gitlab package updates. Create the three following files, do not forget to set the executable flag on the shell script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/gitlab-pre.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = gitlab

[Action]
Description = Stopping gitlab services
When = PreTransaction
Exec = /usr/bin/systemctl stop gitlab-gitaly.service gitlab-mailroom.service gitlab-puma.service gitlab-sidekiq.service gitlab-workhorse.service</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/gitlab-post.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = gitlab

[Action]
Description = Upgrading gitlab database and restarting services
When = PostTransaction
Exec = /etc/pacman.d/hooks/gitlab-post.sh</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/gitlab-post.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

(cd /usr/share/webapps/gitlab ; su -s /bin/sh gitlab -c "$(cat environment | xargs) bundle exec rake db:migrate")
systemctl start gitlab.target</pre>
<h2><span class="mw-headline" id="Advanced_configuration">Advanced configuration</span></h2>
<h3><span class="mw-headline" id="Basic_SSH">Basic SSH</span></h3>
<p>After completing the basic installation, set up SSH access for users.  Configuration for <a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a> is described below.  <a href="../en/Secure_Shell.html#Implementations" class="mw-redirect" title="SSH">Other SSH clients and servers</a> will require different modifications.
</p>
<p>For tips on adding user SSH keys, the process is well-documented on the <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ee/ssh/">GitLab</a> website.  You can check the administrator logs at <code>/var/lib/gitlab/log/gitlab-shell.log</code> to confirm user SSH keys are being submitted properly.  Behind the scenes, GitLab adds these keys to its <i>authorized_keys</i> file in <code>/var/lib/gitlab/.ssh/authorized_keys</code>.
</p>
<p>The common method of testing keys (e.g. <code>ssh -T git@<i>your_server</i></code>) requires a bit of extra configuration to work correctly.  The user configured in <code>/etc/webapps/gitlab/gitlab.yml</code> (by default <code>gitlab</code>) must be added to the server's sshd configuration file, in addition to a handful of other changes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PubkeyAuthentication   yes
AuthorizedKeysFile     %h/.ssh/authorized_keys
</pre>
<p>If your <code>/etc/ssh/sshd_config</code> contains the <code>AllowUsers</code> option, then the <code>gitlab</code> user should be added to the list:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AllowUsers gitlab <i>other users...</i>
</pre>
<p>After updating the configuration file, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> the <code>sshd.service</code>.
</p>
<p>Test user SSH keys (optionally add -v to see extra information):
</p>
<pre>$ ssh -T <i>gitlab</i>@<i>your_server</i>
</pre>
<h3><span class="mw-headline" id="Custom_SSH_connection">Custom SSH connection</span></h3>
<p>If you are running SSH on a non-standard port, you must change the GitLab user's SSH config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/gitlab/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">host localhost      # Give your setup a name (here: override localhost)
user gitlab         # Your remote git user
port 2222           # Your port number
hostname 127.0.0.1; # Your server name or IP</pre>
<p>You also need to change the corresponding options (e.g. ssh_user, ssh_host, admin_uri) in the <code>/etc/webapps/gitlab/gitlab.yml</code> file.
</p>
<h3><span class="mw-headline" id="Sending_emails_from_GitLab">Sending emails from GitLab</span></h3>
<p>GitLab can send emails either using a local <a href="../en/Mail_server.html" class="mw-redirect" title="Mail transfer agent">mail transfer agent</a> (via <i>sendmail</i>) or using <a href="https://en.wikipedia.org/wiki/SMTP" class="extiw" title="wikipedia:SMTP">SMTP</a>.
</p>
<p>To use <i>sendmail</i>, edit <code>/etc/webapps/gitlab/smtp_settings.rb</code> and comment out all lines. Then mail delivery should work without any further configuration in GitLab, assuming that the local mail transfer agent is configured properly.
</p>
<p>To use SMTP, configure the options in <code>smtp_settings.rb</code> according to your mail server. For example, to send via Gmail:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/smtp_settings.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">if Rails.env.production?
  Gitlab::Application.config.action_mailer.delivery_method = :smtp

  ActionMailer::Base.delivery_method = :smtp
  ActionMailer::Base.smtp_settings = {
    address:              'smtp.gmail.com',
    port:                 587,
    domain:               'gmail.com',
    user_name:            'username@gmail.com',
    password:             'application password',
    authentication:       'plain',
    enable_starttls_auto: true
  }
end
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Gmail will reject mails received this way (and send you a mail that it did). You will need to disable secure authentication (follow the link in the rejection mail) to work around this. The more secure approach is to enable two-factor authentication for <code>username@gmail.com</code> and to set up an <a rel="nofollow" class="external text" href="https://support.google.com/accounts/answer/185833">application specific password</a> for this configuration file.</div>
<h2><span class="mw-headline" id="Useful_tips">Useful tips</span></h2>
<h3><span class="mw-headline" id="Rake_tasks">Rake tasks</span></h3>
<p>A number of setup/maintenance/etc tasks are available through rake.  To list them, go to Gitlab's home directory:
</p>
<pre>$ cd /usr/share/webapps/gitlab
</pre>
<p>and run:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u gitlab $(cat environment | xargs) bundle exec rake -T | grep gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">rake gitlab:app:check                         # GITLAB | Check the configuration of the GitLab Rails app
rake gitlab:backup:create                     # GITLAB | Create a backup of the GitLab system
rake gitlab:backup:restore                    # GITLAB | Restore a previously created backup
rake gitlab:check                             # GITLAB | Check the configuration of GitLab and its environment
rake gitlab:cleanup:block_removed_ldap_users  # GITLAB | Cleanup | Block users that have been removed in LDAP
rake gitlab:cleanup:dirs                      # GITLAB | Cleanup | Clean namespaces
rake gitlab:cleanup:repos                     # GITLAB | Cleanup | Clean repositories
rake gitlab:env:check                         # GITLAB | Check the configuration of the environment
rake gitlab:env:info                          # GITLAB | Show information about GitLab and its environment
rake gitlab:generate_docs                     # GITLAB | Generate sdocs for project
rake gitlab:gitlab_shell:check                # GITLAB | Check the configuration of GitLab Shell
rake gitlab:import:all_users_to_all_groups    # GITLAB | Add all users to all groups (admin users are added as owners)
rake gitlab:import:all_users_to_all_projects  # GITLAB | Add all users to all projects (admin users are added as masters)
rake gitlab:import:repos                      # GITLAB | Import bare repositories from gitlab_shell -&gt; repos_path into GitLab project instance
rake gitlab:import:user_to_groups[email]      # GITLAB | Add a specific user to all groups (as a developer)
rake gitlab:import:user_to_projects[email]    # GITLAB | Add a specific user to all projects (as a developer)
rake gitlab:satellites:create                 # GITLAB | Create satellite repos
rake gitlab:setup                             # GITLAB | Setup production application
rake gitlab:shell:build_missing_projects      # GITLAB | Build missing projects
rake gitlab:shell:install[tag,repo]           # GITLAB | Install or upgrade gitlab-shell
rake gitlab:shell:setup                       # GITLAB | Setup gitlab-shell
rake gitlab:sidekiq:check                     # GITLAB | Check the configuration of Sidekiq
rake gitlab:test                              # GITLAB | Run all tests
rake gitlab:web_hook:add                      # GITLAB | Adds a web hook to the projects
rake gitlab:web_hook:list                     # GITLAB | List web hooks
rake gitlab:web_hook:rm                       # GITLAB | Remove a web hook from the projects
rake setup                                    # GITLAB | Setup gitlab db
</pre>
<h3><span class="mw-headline" id="Backup_and_restore">Backup and restore</span></h3>
<p>Create a backup of the gitlab system:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:backup:create
</pre>
<p>Restore the previously created backup file <code>/var/lib/gitlab/backups/1556571328_2019_04_29_11.10.2_gitlab_backup.tar</code>:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:backup:restore BACKUP=1556571328_2019_04_29_11.10.2
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Backup folder is set in <code>config/gitlab.yml</code>. GitLab backup and restore is documented <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/backup_restore.md">here</a>.</div>
<h3><span class="mw-headline" id="Enable_fast_SSH_key_lookup">Enable fast SSH key lookup</span></h3>
<p>Enable Fast SSH Key Lookup as explained in this page: <a rel="nofollow" class="external free" href="https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html">https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html</a>
</p>
<p>In short, edit <code>/etc/ssh/sshd_config</code>.
</p>
<p>Revert all changes done following this wiki (or revert <code>sshd_config</code> from the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> package) and only add:
</p>
<pre>AuthorizedKeysCommand /var/lib/gitlab/gitlab-shell/bin/gitlab-shell-authorized-keys-check gitlab %u %k
AuthorizedKeysCommandUser gitlab
</pre>
<p>Finally <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">restart</a> the <code>sshd.service</code>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="HTTPS_is_not_green_.28gravatar_not_using_https.29"></span><span class="mw-headline" id="HTTPS_is_not_green_(gravatar_not_using_https)">HTTPS is not green (gravatar not using https)</span>
</h3>
<p>Redis caches gravatar images, so if you have visited your GitLab with http, then enabled https, gravatar will load up the non-secure images. You can clear the cache by doing
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake cache:clear
</pre>
<p>as the gitlab user.
</p>
<h3><span class="mw-headline" id="Errors_after_updating">Errors after updating</span></h3>
<p>After updating the package from the AUR, the database migrations and asset updates will sometimes fail. These steps may resolve the issue, if a simple reboot does not.
</p>
<p>First, move to the gitlab installation directory.
</p>
<pre>$ cd /usr/share/webapps/gitlab
</pre>
<p>If every gitlab page gives a 500 error, then the database migrations and the assets are probably stale. If not, skip this step.
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake db:migrate
</pre>
<p>If gitlab is constantly waiting for the deployment to finish, then the assets have probably not been recompiled.
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:assets:clean gitlab:assets:compile cache:clear
</pre>
<p>Finally, restart the gitlab services and test your site.
</p>
<pre># systemctl restart gitlab-puma gitlab-sidekiq gitlab-workhorse
</pre>
<h3><span class="mw-headline" id="GitLab_Puma_cannot_access_non-default_repositories_directory">GitLab Puma cannot access non-default repositories directory</span></h3>
<p>If a custom repository storage directory is set in <code>/home</code>, disable the <code>ProtectHome=true</code> parameter in the <code>gitlab-puma.service</code> (see <a href="../en/Systemd.html#Drop-in_files" title="Systemd">systemd#Drop-in files</a> and the <a rel="nofollow" class="external text" href="https://forum.gitlab.com/t/cannot-change-repositores-location/9634/2">relevant forum thread on gitlab.com</a>).
</p>
<h3><span class="mw-headline" id="Failed_to_connect_to_Gitaly">Failed to connect to Gitaly</span></h3>
<p>Sometimes, the Gitaly service will not get started, leaving GitLab unable to connect to Gitaly. The solution is simple:
</p>
<pre># systemctl start gitlab-gitaly
</pre>
<h3><span class="mw-headline" id="Failed_to_connect_via_SSH">Failed to connect via SSH</span></h3>
<p>If git operations (-T, pull, clone, etc.) fails using ssh try changing the shell:
</p>
<pre># usermod -s /usr/share/webapps/gitlab-shell/bin/gitlab-shell-ruby gitlab
</pre>
<h3><span class="mw-headline" id="CSS_or_styles_issue">CSS or styles issue</span></h3>
<p>If you have any issues with styles and CSS not working, you may try to edit <code>/usr/share/webapps/gitlab/config/environments/production.rb</code> and change:
</p>
<pre> # Disable Rails's static asset server (Apache or nginx will already do this)
 config.public_file_server.enabled = false
</pre>
<p>to:
</p>
<pre> # Disable Rails's static asset server (Apache or nginx will already do this)
 config.public_file_server.enabled = true
</pre>
<h3><span class="mw-headline" id="The_server_does_not_support_push_options">The server does not support push options</span></h3>
<p>If you get an error like <code>fatal: the receiving end does not support push options</code> you might need to enable it for the GitLab Git user (<code>gitlab</code>) on the server. This can be done in the gitconfig:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab-shell/.gitconfig</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[receive]
         advertisePushOptions = true</pre>
<p>Alternatively one can set this with: <code>sudo -u gitlab -H git config --global receive.advertisePushOptions true</code>
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.gitlab.com/ce/install/installation.html">Official installation documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes">GitLab recipes with further documentation on running it with several web servers</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-ce">GitLab source code</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Git_web_interfaces.html" title="Category:Git web interfaces">Git web interfaces</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GitLab&amp;oldid=647720">https://wiki.archlinux.org/index.php?title=GitLab&amp;oldid=647720</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 31 December 2020, at 09:32.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
