<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd (Italiano)/User (Italiano) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Italiano_User_Italiano rootpage-Systemd_Italiano skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">systemd (Italiano)/User (Italiano)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../../it/Systemd.html" title="Systemd (Italiano)">Systemd (Italiano)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../../it/Systemd.html" title="Systemd (Italiano)">systemd (Italiano)</a></li>
<li><a href="../../en/Getty.html#Automatic_login_to_virtual_console" class="mw-redirect" title="Automatic login to virtual console (Italiano)">Automatic login to virtual console (Italiano)</a></li>
<li><a href="../../en/Xinit.html" class="mw-redirect" title="Start X at Login (Italiano)">Start X at Login (Italiano)</a></li>
</ul>
</div>
<p><a href="../../it/Systemd.html" title="Systemd (Italiano)">systemd</a> offre agli utenti la possibilità di gestire i servizi sotto il controllo dell'utente tramite una istanza di systemd per singolo utente, che consente agli stessi di avviare, fermare, abilitare e disabilitare le proprie unità. Questa caratteristica è utile per demoni e altre operazioni automatiche come lo scaricamento della posta. È inoltre possibile, con alcune modifiche, avviare Xorg e il window manager in uso direttamente tramite i servizi utente.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Come_funziona"><span class="tocnumber">1</span> <span class="toctext">Come funziona</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Configurazione_di_base"><span class="tocnumber">2</span> <span class="toctext">Configurazione di base</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#D-Bus"><span class="tocnumber">2.1</span> <span class="toctext">D-Bus</span></a></li>
<li class="toclevel-2 tocsection-4">
<a href="#Variabili_d'ambiente"><span class="tocnumber">2.2</span> <span class="toctext">Variabili d'ambiente</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#DISPLAY_e_XAUTHORITY"><span class="tocnumber">2.2.1</span> <span class="toctext">DISPLAY e XAUTHORITY</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#PATH"><span class="tocnumber">2.2.2</span> <span class="toctext">PATH</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Avvio_automatico_delle_istanze_utente_di_systemd"><span class="tocnumber">2.3</span> <span class="toctext">Avvio automatico delle istanze utente di systemd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#Xorg_e_systemd"><span class="tocnumber">3</span> <span class="toctext">Xorg e systemd</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Login_automatico_in_Xorg_senza_display_manager"><span class="tocnumber">3.1</span> <span class="toctext">Login automatico in Xorg senza display manager</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Avvio_di_Xorg_come_servizio_utente"><span class="tocnumber">3.2</span> <span class="toctext">Avvio di Xorg come servizio utente</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Scrivere_servizi_utente"><span class="tocnumber">4</span> <span class="toctext">Scrivere servizi utente</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Esempio"><span class="tocnumber">4.1</span> <span class="toctext">Esempio</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Esempio_con_variabili"><span class="tocnumber">4.2</span> <span class="toctext">Esempio con variabili</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Nota_per_applicazioni_X11"><span class="tocnumber">4.3</span> <span class="toctext">Nota per applicazioni X11</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#Esempi_d'uso"><span class="tocnumber">5</span> <span class="toctext">Esempi d'uso</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Multiplexer_di_terminale_persistente"><span class="tocnumber">5.1</span> <span class="toctext">Multiplexer di terminale persistente</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Window_manager"><span class="tocnumber">5.2</span> <span class="toctext">Window manager</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Riferimenti"><span class="tocnumber">6</span> <span class="toctext">Riferimenti</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Come_funziona">Come funziona</span></h2>
<p>Secondo la configurazione di default in <code>/etc/pam.d/system-login</code>, il modulo <code>pam_systemd</code> avvia automaticamente una istanza di <code>systemd --user</code> al primo login dell'utente. Tale processo rimarrà in esecuzione fin tanto che l'utente sarà coneesso, e verrà terminato quando l'utente effettua il logout. Quando l'<a href="#Avvio_automatico_delle_istanze_utente_di_systemd">#Avvio automatico delle istanze utente di systemd</a> è abilitato, l'istanza viene avviata al boot e non più terminata. L'istanza utente di systemd si occupa di gestire i servizi utente, utilizzabili per avviare demoni o compiere operazioni automatiche, disponendo comunque di tutti i benefici di systemd, come l'attivazione  socket, timers, dipendenze o controllo processi tramite cgroups.
Similmente a quanto accade con in servizi di sistema, i servizi utente risiedono nelle directory seguenti (ordinate per preferenza crescente):
</p>
<ul>
<li>
<code>/usr/lib/systemd/user/</code> directory per i servizi forniti dai pacchetti.</li>
<li>
<code>/etc/systemd/user/</code> directory per i servizi definiti dall'amministratore di sistema.</li>
<li>
<code>~/.config/systemd/user/</code> directory per i servizi utente.</li>
</ul>
<p>All'avvio di una istanza utente di systemd, viene caricato il target <code>default.target</code>; è ora possibile controllare manualmente i servizi utente tramite <code>systemctl --user</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attenzione:</strong> 
<ul>
<li>Si noti che, a partire dalla versione 206, l'istanza utente <code>systemd --user</code> è un processo dedicato per utente, e non per sessione. Ne consegue che la maggior parte delle risorse gestite dai servizi utenti, come sockets o file di stato, riguardano un singolo utente (sono difatti situati nella home directory dello stesso) e non una sessione. Ciò significa che tutti i servizi utente vengono eseguiti al di fuori di una sessione; per questo motivo, i programmi che necessitano di essere eseguiti per ogni singola sessione probabilmente non funzioneranno con le istanze utente di systemd. La gestione delle sessioni da parte di systemd varia continuamente. Si legga <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[1]</a> e <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[2]</a> per avere un'idea generale sullo sviluppo di questa funzionalità.</li>
<li>
<code>systemd --user</code> viene eseguito come processo separato rispetto a <code>systemd --system</code>. I servizi utente non possono pertanto riferirsi o dipendere da servizi di sistema.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Configurazione_di_base">Configurazione di base</span></h2>
<p>Tutti i servizi utente devono essere inseriti in <code>~/.config/systemd/user</code>. Se si vuole avviare une servizio automaticamente al login, si esegua <code>systemctl --user enable <i>servizio</i></code> per ogni servizio.
</p>
<h3><span class="mw-headline" id="D-Bus">D-Bus</span></h3>
<p>Alcune applicazioni necessitano di un messagebus <a href="../../en/D-Bus.html" title="D-Bus">D-Bus</a>, tradizionalmente avviato quando si esegue un desktop environment tramite <code>dbus-launch</code>.
A partire dalla versione 226, systemd è divenuto il gestore del messagebus utente. <a rel="nofollow" class="external autonumber" href="https://archlinux.org/news/d-bus-now-launches-user-buses/">[3]</a> Il demone <i>dbus-daemon</i> viene avviato una volta per ogni sessione utente utilizzando le unità utente <code>dbus.socket</code> e <code>dbus.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Se precedentemente si sono creati tali file manualmente nella cartella <code>/etc/systemd/user/</code> o <code>~/.config/systemd/user/</code>, è ora possibile rimuoverli.</div>
<h3>
<span id="Variabili_d.27ambiente"></span><span class="mw-headline" id="Variabili_d'ambiente">Variabili d'ambiente</span>
</h3>
<p>L'istanza utente di systemd non eredita le <a href="../../en/Environment_variables.html" title="Environment variables">variabili d'ambiente</a> definite in <code>.bashrc</code> e similari. Vi sono quattro modi per definire variabili d'ambiente per istanze utente di systemd:
</p>
<ol>
<li>Per gli utenti che abbiano una propria home directory, si specifichi l'opzione <code>DefaultEnvironment</code> in <code>~/.config/systemd/user.conf</code>. Viene applicata solo alle unità utente di un utente specifico.</li>
<li>Utilizzare l'opzione <code>DefaultEnvironment</code> in <code>/etc/systemd/user.conf</code>. Viene applicata a tutti i servizi utente.</li>
<li>Creare un file di configurazione in <code>/etc/systemd/system/user@.service.d/</code>. Viene applicata a tutti i servizi utente.</li>
<li>In qualsiasi momento, tramite i comandi <code>systemctl --user set-environment</code> o <code>systemctl --user import-environment</code>. Applicata a tutti i servizi avviati dopo l'esecuzione dei comandi di cui sopra, ma non a quelli già avviati.</li>
</ol>
<dl><dd><dl><dd><div class="archwiki-template-box archwiki-template-box-tip">
<strong>Suggerimento:</strong> Per definire più variabili contemporaneamente, si crei un file di configurazione contentente una lista di coppie <i>chiave=valore</i>, separate da uno spazio, e si aggiunga <code>xargs systemctl --user set-environment &lt; /path/to/file.conf</code> al file di configurazione utente della shell in uso.</div></dd></dl></dd></dl>
<p>Una variabile che si potrebbe voler definire è <code>PATH</code>.
</p>
<h4><span class="mw-headline" id="DISPLAY_e_XAUTHORITY">DISPLAY e XAUTHORITY</span></h4>
<p>La variabile <code>DISPLAY</code> viene utilizzata da qualsiasi applicazione X per individuare il display da utilizare, mentre <code>XAUTHORITY</code> identifica il percorso al file <code>.Xauthority</code> dell'utente corrente, e di conseguenza il cookie necessario per accedere a X. Se si intende lanciare applicazioni grafiche tramite servizi di systemd, sarà necessario definire tali variabili.
A partire dalla <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/systemd/systemd/tree/NEWS?id=v219#n194">versione 219</a>, systemd fornisce uno script situato in <code>/etc/X11/xinit/xinitrc.d/50-systemd-user.sh</code> per importarle nella sessione utente di systemd all'avvio di X. Ne consegue che, a meno che X non venga avviato tramite procedure non standard, i servizi utenti dovrebbero essere già al corrente dei valori delle due variabili.
</p>
<h4><span class="mw-headline" id="PATH">PATH</span></h4>
<p>Come tutte le variabili d'ambiente definite tramite <code>.bashrc</code> o <code>.bash_profile</code>, anche <code>PATH</code> non è visibile a systemd. Se si modifica il valore di tale variabile e si intende avviare applicazioni che se ne avvalgano come servizi di systemd, sarà necessario notificare systemd della sua modifica. È consigliabile farlo aggiungendo la seguente riga al proprio <code>.bash_profile</code>, dopo aver definito la variabile <code>PATH</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bash_profile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">systemctl --user import-environment PATH
</pre>
<h3><span class="mw-headline" id="Avvio_automatico_delle_istanze_utente_di_systemd">Avvio automatico delle istanze utente di systemd</span></h3>
<p>L'istanza utente di systemd viene avviata dopo il primo login di un utente, e fermata alla chiusura dell'ultima sessione di quell'utente. Potrebbe essere talvolta necesario avviarla subito dopo il boot, e mantenerla attiva alla chiusura dell'ultima sessione utente relativa, ad esempio per avere processi utente attivi senza alcuna sesione utente in corso.
Si esegua a tal proposito il seguente comando per abilitare tale comportamento per un singolo utente:
</p>
<pre># loginctl enable-linger <i>nomeutente</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attenzione:</strong> I servizi systemd <b>non</b> sono sessioni, dal momento che vengono eseguiti al di fuori di <i>logind</i>. Non si utilizzi la funzionalità di lingering per abilitare il login automatico, dal momento che questo <a href="../../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">renderà inutilizzabile la sessione</a>.</div>
<h2><span class="mw-headline" id="Xorg_e_systemd">Xorg e systemd</span></h2>
<p>Vi sono diversi metodi per avviare Xorg tramite systemd. Di seguito due possibilità: l'avvio di una sessione utente con un processo di Xorg o l'avvio di quest'ultimo come servizio utente.
</p>
<h3><span class="mw-headline" id="Login_automatico_in_Xorg_senza_display_manager">Login automatico in Xorg senza display manager</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Questa configurazione avvia due istanze di D-Bus: una per il desktop e l'altra per systemd. Perchè non utilizzare quella di systemd?  (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd_(Italiano)/User_(Italiano)">Talk:Systemd (Italiano)/User (Italiano)#</a>)</div>
</div>
<p>Quanto sotto avvierà una sessione utente ed il server Xorg come unità di sistema e provvederà poi a leggere il contenuto di <code>~/.xinitrc</code>, avviare il window manager, ecc.
</p>
<p>Sarà necessario configurare <a href="#D-Bus">#D-Bus</a> nel modo corretto ed installare il pacchetto <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xlogin-git/">xlogin-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>Si crei il proprio file <a href="../../it/Xinit.html" class="mw-redirect" title="Xinitrc (Italiano)">xinitrc</a> da quello di default, in modo che effettui il source dei files in <code>/etc/X11/xinit/xinitrc.d/</code>. È necessario che l'esecuzione del priorio <code>~/.xinitrc</code> non ritorni, quindi si inserisca <code>wait</code> come ultimo comando, o si aggiunga <code>exec</code> all'ultimo comando (ad esempio, il proprio window manager).
</p>
<p>Questa sessione utilizzerà il proprio demone D-Bus, ma varie utility di systemd si connetteranno automaticamente all'istanza avviata dal servizio <code>dbus.service</code>
</p>
<p>Si abiliti infine (<b>come root</b>) il servizio <i>xlogin</i> per ottenere il login automatico al boot:
</p>
<pre># systemctl enable xlogin@<i>username</i>
</pre>
<p>La sessione utente viene eseguita interamente in un ambiente systemd, quindi tutto dovrebbe funzionare nel modo corretto.
</p>
<h3><span class="mw-headline" id="Avvio_di_Xorg_come_servizio_utente">Avvio di Xorg come servizio utente</span></h3>
<p>In alternativa, è possibile avviare <a href="../../it/Xorg.html" title="Xorg (Italiano)">xorg</a> come servizio utente, avendo il vantaggio di poter definire il servizio in questione come dipendenza di altre unità che lo necessitino.
Questo approccio, tuttavia, non è esente da difetti, elencati sotto:
</p>
<p>A partire dalla versione 1.16, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-server">xorg-server</a></span> si integra in modo migliore con systemd in due modi:
</p>
<ul>
<li>Può essere avviato senza privilegi di root, delegando la gestione dei dispositivi a logind (si vedano i commit di Hans de Goede <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/commit/?id=82863656ec449644cd34a86388ba40f36cea11e9">this qui</a>).</li>
<li>Può essere avviato come servizio attivato tramite socket (si veda <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/commit/?id=b3d3ffd19937827bcbdb833a628f9b1814a6e189">questo commit</a>).</li>
</ul>
<p>Sfortunatamente, per avviare Xorg senza privilegi di amministratore, è necessario essere in una sessione, perciò, in questo momento, è necessario avviare Xorg come amministratore per poterlo gestire tramite i servizi utente (come per versioni precedenti la 1.16).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Si noti che quanto sopra non è una restrizione imposta da logind: Xorg necessita infatti di sapere di quale sessione appropriarsi e, ad ora, ottiene questa informazione chiamando la funzione <code>GetSessionByPID</code> di <a rel="nofollow" class="external text" href="https://www.freedesktop.org/wiki/Software/systemd/logind">logind</a>, utilizzando il proprio PID come argomento. Si vedano <a rel="nofollow" class="external text" href="http://lists.x.org/archives/xorg-devel/2014-February/040476.html">questo thread</a> e <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/tree/hw/xfree86/os-support/linux/systemd-logind.c">i sorgenti di Xorg</a>. È probabilmente possibile modificare Xorg in modo che ottenga la sessione dalla tty sulla quale viene avviata.</div>
<p>Di seguito le istruzioni per avviare Xorg come servizio utente
</p>
<p>1. Assicurarsi che Xorg possa venire avviato con privilegi da amministratore da qualsiasi utente, modificando <code>/etc/X11/Xwrapper.config</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/Xwrapper.config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allowed_users=anybody
needs_root_rights=yes
</pre>
<p>2. Creare le seguenti unità in <code>~/.config/systemd/user</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Socket for xorg at display %i

[Socket]
ListenStream=/tmp/.X11-unix/X%i
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Xorg server at display %i

Requires=xorg@%i.socket
After=xorg@%i.socket

[Service]
Type=simple
SuccessExitStatus=0 1

ExecStart=/usr/bin/Xorg :%i -nolisten tcp -noreset -verbose 2 "vt${XDG_VTNR}"
</pre>
<p>Dove <code>${XDG_VTNR</code>} è il terminale virtuale dove Xorg verrà eseguito, definito all'interno del servizio utente, o specificato come variabile d'ambiente in systemd tramite:
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Xorg dovrebbe essere lanciato dallo stesso terminale virtuale dove si è effettuato il login, altrimenti loging considererà la sessione come inattiva.</div>
<p>3. Assicurarsi di definire la variabile d'ambiente <code>DISPLAY</code> come spiegato <a href="#DISPLAY">sopra</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.
</p>
<p>4. Per abilitare l'attivazione socket per Xorg sul display 0 e tty2, si procederebbe come segue:
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=2     # Per dichiarare a xorg@.service quale terminale utilizzare
$ systemctl --user start xorg@0.socket            # Resta in ascolto sul socket del display 0
</pre>
<p>A questo punto, qualsiasi applicazione X11 verrà eseguita automaticamente sul terminale virtuale 2.
</p>
<p>La variabile d'ambiente <code>XDG_VTNR</code> può essere definita nell'ambiente di systemd partendo da  <code>.bash_profile</code>, cosa che renderebbe possibile avviare qualsiasi applicazione X11, compreso un window manager, come unità utente systemd, inserendo una dipendenza a <code>xorg@0.socket</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attenzione:</strong> Al momento, l'esecuzione di un window manager come servizio utente ne comporta l'avvio al di fuori della sessione, con tutti i problemi che ciò comporta: <a href="../../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">General troubleshooting#Session permissions</a>. Sembra però che gli sviluppatori di systemd stiano tentando di rendere possibile tale comportamento. Si veda a tal proposito <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[4]</a> e <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[5]</a>.</div>
<h2><span class="mw-headline" id="Scrivere_servizi_utente">Scrivere servizi utente</span></h2>
<h3><span class="mw-headline" id="Esempio">Esempio</span></h3>
<p>Di seguito un esempio per l'avvio di mpd come servizio utente:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mpd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Music Player Daemon

[Service]
ExecStart=/usr/bin/mpd --no-daemon

[Install]
WantedBy=default.target
</pre>
<h3><span class="mw-headline" id="Esempio_con_variabili">Esempio con variabili</span></h3>
<p>Esempio di avvio di <code>sickbeard</code> come servizio utente, con definizione di una variabile utente per la directory home dove Sickbeard reperisce alcuni file di configurazione:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/sickbeard.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=SickBeard Daemon

[Service]
ExecStart=/usr/bin/env python2 /opt/sickbeard/SickBeard.py --config %h/.sickbeard/config.ini --datadir %h/.sickbeard

[Install]
WantedBy=default.target
</pre>
<p>Come specificato in <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5">systemd.unit(5)</a></span>, la variabile <code>%h</code> viene sostituita con la home directory dell'utente che esegue il servizio. Vi sono altre variabili disponibili, spiegate in dettaglio nelle pagine di manuale di <a href="../../it/Systemd.html" title="Systemd (Italiano)">systemd</a>.
</p>
<h3><span class="mw-headline" id="Nota_per_applicazioni_X11">Nota per applicazioni X11</span></h3>
<p>La maggior parte delle applicazioni X11, necessitano della variabile <code>DISPLAY</code> per essere eseguite. Vedere a tal proposito la sezione <a href="#DISPLAY_e_XAUTHORITY">#DISPLAY e XAUTHORITY</a>.
</p>
<h2>
<span id="Esempi_d.27uso"></span><span class="mw-headline" id="Esempi_d'uso">Esempi d'uso</span>
</h2>
<h3><span class="mw-headline" id="Multiplexer_di_terminale_persistente">Multiplexer di terminale persistente</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> References <code>user-session@.service</code> instead of <code>user@.service</code>; the latter does not contain <code>Conflicts=getty@tty1.service</code>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd_(Italiano)/User_(Italiano)">Talk:Systemd (Italiano)/User (Italiano)#</a>)</div>
</div>
<p>You may wish your user session to default to running a terminal multiplexer, such as <a href="../../en/GNU_Screen.html" title="GNU Screen">GNU Screen</a> or <a href="../../en/Tmux.html" title="Tmux">Tmux</a>, in the background rather than logging you into a window manager session. Separating login from X login is most likely only useful for those who boot to a TTY instead of to a display manager (in which case you can simply bundle everything you start in with myStuff.target). 
</p>
<p>To create this type of user session, procede as above, but instead of creating wm.target, create multiplexer.target:
</p>
<pre>[Unit]
Description=Terminal multiplexer
Documentation=info:screen man:screen(1) man:tmux(1)
After=cruft.target
Wants=cruft.target

[Install]
Alias=default.target</pre>
<p><code>cruft.target</code>, like <code>mystuff.target</code> above, should start anything you think should run before tmux or screen starts (or which you want started at boot regardless of timing), such as a GnuPG daemon session.
</p>
<p>You then need to create a service for your multiplexer session. Here is a sample service, using tmux as an example and sourcing a gpg-agent session which wrote its information to <code>/tmp/gpg-agent-info</code>. This sample session, when you start X, will also be able to run X programs, since DISPLAY is set.
</p>
<pre>[Unit]
Description=tmux: A terminal multiplixer
Documentation=man:tmux(1)
After=gpg-agent.service
Wants=gpg-agent.service

[Service]
Type=forking
ExecStart=/usr/bin/tmux start
ExecStop=/usr/bin/tmux kill-server
Environment=DISPLAY=:0
EnvironmentFile=/tmp/gpg-agent-info

[Install]
WantedBy=multiplexer.target</pre>
<p>Once this is done, <code>systemctl --user enable</code> <code>tmux.service</code>, <code>multiplexer.target</code> and any services you created to be run by <code>cruft.target</code> and you should be set to go! Activated <code>user-session@.service</code> as described above, but be sure to remove the <code>Conflicts=getty@tty1.service</code> from <code>user-session@.service</code>, since your user session will not be taking over a TTY. Congratulations! You have a running terminal multiplexer and some other useful programs ready to start at boot!
</p>
<h3><span class="mw-headline" id="Window_manager">Window manager</span></h3>
<p>Per eseguire un window manager come servizio di systemd, sarà necessario <a href="#Avvio_di_Xorg_come_servizio_utente">avviare Xorg come servizio utente</a>. Di seguito, un esempio utilizzando awesome:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/awesome.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Awesome window manager
After=xorg.target
Requires=xorg.target

[Service]
ExecStart=/usr/bin/awesome
Restart=always
RestartSec=10
 
[Install]
WantedBy=wm.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> La sezione <code>[Install]</code> include una direttiva <code>WantedBy</code>. All'utilizzo di <code>systemctl --user enable</code>, verrà creato il link <code>~/.config/systemd/user/wm.target.wants/<i>window_manager</i>.service</code>, consentendo l'avvio al login. Si raccomanda l'abilitazione di questo servizio, e non la creazione manuale del link simbolico.</div>
<h2><span class="mw-headline" id="Riferimenti">Riferimenti</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units/wiki/Home">Wiki Bitbucket di KaiSforza</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/zoqaeski/systemd-user-units">Servizi di Zoqaeski su GitHub</a></li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/grawity/systemd-user-units">Collezione di servizi utente systemd</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">link interrotto</a> 2020-08-06]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=167115">Discussione sul forum di Arch a seguito dei cambiamenti introdotti a partire da systemd 206</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../it/Category:System_administration.html" title="Category:System administration (Italiano)">System administration (Italiano)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd_(Italiano)/User_(Italiano)&amp;oldid=647064">https://wiki.archlinux.org/index.php?title=Systemd_(Italiano)/User_(Italiano)&amp;oldid=647064</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 12:26.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
