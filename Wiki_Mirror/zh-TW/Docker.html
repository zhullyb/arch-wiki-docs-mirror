<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Docker (正體中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Docker_正體中文 rootpage-Docker_正體中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Docker (正體中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a></li>
<li><a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a></li>
<li><a href="../en/Linux_Containers.html#Systemd_considerations_.28required.29" class="mw-redirect" title="Lxc-systemd">Lxc-systemd</a></li>
<li><a href="../en/Vagrant.html" title="Vagrant">Vagrant</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://www.docker.io">Docker</a> 提供使用者包裝、搬移、執行任意程式作為一個輕量級容器。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%9D"><span class="tocnumber">1</span> <span class="toctext">安裝</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E8%A8%AD%E5%AE%9A"><span class="tocnumber">2</span> <span class="toctext">設定</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#%E4%BB%A3%E7%90%86%E4%BC%BA%E6%9C%8D%E5%99%A8"><span class="tocnumber">2.1</span> <span class="toctext">代理伺服器</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Docker_Daemon_%E8%A8%AD%E5%AE%9A"><span class="tocnumber">2.1.1</span> <span class="toctext">Docker Daemon 設定</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Container_%E8%A8%AD%E5%AE%9A"><span class="tocnumber">2.1.2</span> <span class="toctext">Container 設定</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Daemon_Socket_%E8%A8%AD%E5%AE%9A"><span class="tocnumber">2.2</span> <span class="toctext">Daemon Socket 設定</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Docker%E8%88%87LXC"><span class="tocnumber">3</span> <span class="toctext">Docker與LXC</span></a></li>
<li class="toclevel-1 tocsection-8">
<a href="#%E6%98%A0%E5%83%8F%E6%AA%94"><span class="tocnumber">4</span> <span class="toctext">映像檔</span></a>
<ul>
<li class="toclevel-2 tocsection-9">
<a href="#Arch_Linux"><span class="tocnumber">4.1</span> <span class="toctext">Arch Linux</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#x86_64"><span class="tocnumber">4.1.1</span> <span class="toctext">x86_64</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#i686"><span class="tocnumber">4.1.2</span> <span class="toctext">i686</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#%E5%BB%BA%E7%BD%AE%E6%98%A0%E5%83%8F%E6%AA%94"><span class="tocnumber">4.1.3</span> <span class="toctext">建置映像檔</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#Debian"><span class="tocnumber">4.2</span> <span class="toctext">Debian</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#%E5%BF%AB%E7%85%A7%E5%80%89%E5%BA%AB"><span class="tocnumber">5</span> <span class="toctext">快照倉庫</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#%E6%8F%90%E7%A4%BA"><span class="tocnumber">6</span> <span class="toctext">提示</span></a></li>
<li class="toclevel-1 tocsection-16">
<a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C"><span class="tocnumber">7</span> <span class="toctext">常見問題</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Docker_Info%E9%A1%AF%E7%A4%BA%E9%8C%AF%E8%AA%A4%E8%A8%8A%E6%81%AF"><span class="tocnumber">7.1</span> <span class="toctext">Docker Info顯示錯誤訊息</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#%E5%9C%A8BTRFS%E6%AA%94%E6%A1%88%E7%B3%BB%E7%B5%B1%E4%B8%AD%E5%88%AA%E9%99%A4_Docker_%E6%98%A0%E5%83%8F%E6%AA%94"><span class="tocnumber">7.2</span> <span class="toctext">在BTRFS檔案系統中刪除 Docker 映像檔</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Container%E4%B8%AD%E7%9A%84docker0_Bridge%E7%84%A1%E6%B3%95%E5%8F%96%E5%BE%97IP/%E7%84%A1%E6%B3%95%E5%AD%98%E5%8F%96%E7%B6%B2%E8%B7%AF"><span class="tocnumber">7.3</span> <span class="toctext">Container中的docker0 Bridge無法取得IP/無法存取網路</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="tocnumber">8</span> <span class="toctext">參考資料</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.9D"></span><span class="mw-headline" id="安裝">安裝</span>
</h2>
<p>你可以透過官方套件庫安裝 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker">docker</a></span> 套件：
</p>
<pre># pacman -S docker
</pre>
<p>或是從<a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>安裝 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-git/">docker-git</a></span><sup><small>AUR</small></sup> 套件：
</p>
<pre># git clone <a rel="nofollow" class="external free" href="https://aur.archlinux.org/docker-git.git">https://aur.archlinux.org/docker-git.git</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-08-02 ⓘ]</sup>
# cd docker-git
# makepkg -sri
</pre>
<p>接著，你可以<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">啟動</a> <code>docker.service</code> 並驗證安裝是否成功：
</p>
<pre># systemctl start docker.service
# docker info
</pre>
<p>如果你想用你的使用者帳戶(非root帳戶)來使用Docker，把你的帳戶加到Docker的群組中：
</p>
<pre># gpasswd -a <i>user</i> docker
</pre>
<p>記得重新登入來套用新權限，或者你可以用這個指令讓現在的使用者階段套用新群組：
</p>
<pre>$ newgrp docker
</pre>
<h2>
<span id=".E8.A8.AD.E5.AE.9A"></span><span class="mw-headline" id="設定">設定</span>
</h2>
<h3>
<span id=".E4.BB.A3.E7.90.86.E4.BC.BA.E6.9C.8D.E5.99.A8"></span><span class="mw-headline" id="代理伺服器">代理伺服器</span>
</h3>
<p>Proxy設定有兩個地方：一個是主機端的Docker Daemon設定，另一個是套用在Container上的Proxy設定。
</p>
<h4>
<span id="Docker_Daemon_.E8.A8.AD.E5.AE.9A"></span><span class="mw-headline" id="Docker_Daemon_設定">Docker Daemon 設定</span>
</h4>
<p>將 <code>/usr/lib/systemd/system/docker.service</code> 複製到 <code>/etc/systemd/system/docker.service</code>。
</p>
<p>接著編輯 <code>/etc/systemd/system/docker.service</code>, 將 <code>http_proxy</code> 替換成你的 Proxy伺服器。
</p>
<pre>[Service]
Environment="http_proxy=192.168.1.1:3128"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 這裡的 <code>192.168.1.1</code> 是你的Proxy伺服器位址，千萬不要設定成 <code>127.0.0.1</code>.</div>
<h4>
<span id="Container_.E8.A8.AD.E5.AE.9A"></span><span class="mw-headline" id="Container_設定">Container 設定</span>
</h4>
<p>在 <code>docker.service</code> 中的設定並不會套用到Container中，你必須在Container中的 <code>Dockerfile</code> 設定 <code>ENV</code> ，如：
</p>
<pre> FROM base/archlinux
 ENV http_proxy="http://192.168.1.1:3128"
 ENV https_proxy="https://192.168.1.1:3128"
</pre>
<p>你可以在 <a rel="nofollow" class="external text" href="https://docs.docker.com/reference/builder/#env">Docker#env</a> 找到更詳細的資料。
</p>
<h3>
<span id="Daemon_Socket_.E8.A8.AD.E5.AE.9A"></span><span class="mw-headline" id="Daemon_Socket_設定">Daemon Socket 設定</span>
</h3>
<p><i>Docker Daemon</i> 預設會監聽 <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" class="extiw" title="wikipedia:Unix domain socket">Unix socket</a>。如果要讓他監聽特定的通訊埠號，可以修改 <code>/etc/systemd/system/docker.socket</code> 中的 <code>ListenStream</code> 為想要的通訊埠號：
</p>
<pre>[Socket]
ListenStream=0.0.0.0:2375
</pre>
<h2>
<span id="Docker.E8.88.87LXC"></span><span class="mw-headline" id="Docker與LXC">Docker與LXC</span>
</h2>
<p>0.9.0 版以後的 Docker 提供了一個不依賴LXC的函式庫的新Container啟動方式，稱為<i>libcontainer</i>。
</p>
<p>LXC的驅動及設定有可能也在近期移除，因此，使用者將無法在0.9.0版以上的Docker使用 <code>lxc-attach</code> 管理Container，它需要 <code>-e lxc</code> 作為 Docker daemon 執行時的參數。
</p>
<p>你可以在 <code>/etc/systemd/system/docker.service.d/</code> 建立 <code>lxc.conf</code>，並新增以下內容：
</p>
<pre>[Service]
ExecStart=
ExecStart=/usr/bin/docker -d -e lxc
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>註記:</strong> 你可以參照<a rel="nofollow" class="external text" href="https://github.com/docker/docker/pull/5797">Remove lxc exec driver #5797</a>來了解這一段的內容。</div>
<h2>
<span id=".E6.98.A0.E5.83.8F.E6.AA.94"></span><span class="mw-headline" id="映像檔">映像檔</span>
</h2>
<h3><span class="mw-headline" id="Arch_Linux">Arch Linux</span></h3>
<h4><span class="mw-headline" id="x86_64">x86_64</span></h4>
<p>用這個個指令來下載 x86_64 的映像檔。
</p>
<pre># docker pull archlinux/base
</pre>
<h4><span class="mw-headline" id="i686">i686</span></h4>
<p>在 Docker Registry 中的 Arch Linux 映像檔只提供 x86_64 版本，i686版本請參考下面章節自行編譯。
</p>
<h4>
<span id=".E5.BB.BA.E7.BD.AE.E6.98.A0.E5.83.8F.E6.AA.94"></span><span class="mw-headline" id="建置映像檔">建置映像檔</span>
</h4>
<p>首先，到 <a rel="nofollow" class="external text" href="https://registry.hub.docker.com/u/base/archlinux/">docker base/archlinux registry</a> 點擊 <code>mkimage-arch.sh</code> 下載 <code>mkimage-arch.sh</code> 和 <code>mkimage-arch-pacman.conf</code> 到相同目錄。
</p>
<p>接著，賦予它執行權限並執行它。
</p>
<pre>$ chmod +x mkimage-arch.sh
$ cp /etc/pacman.conf ./mkimage-arch-pacman.conf
$ LC_ALL=C ./mkimage-arch.sh
# docker run -t -i --rm archlinux /bin/bash
</pre>
<p>在電腦或網路速度較慢的環境下，你可以延長timeout時間： 
</p>
<pre>$ sed -i 's/timeout 60/timeout 120/' mkimage-arch.sh
</pre>
<h3><span class="mw-headline" id="Debian">Debian</span></h3>
<p>從 <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> 下載 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=debootstrap">debootstrap</a></span> 以建置 Debain 的映像檔。
</p>
<pre># mkdir wheezy-chroot
# debootstrap wheezy ./wheezy-chroot <a rel="nofollow" class="external free" href="http://http.debian.net/debian/">http://http.debian.net/debian/</a>
# cd wheezy-chroot
# tar cpf - . | docker import - debian
# docker run -t -i --rm debian /bin/bash
</pre>
<p><br>
</p>
<h2>
<span id=".E5.BF.AB.E7.85.A7.E5.80.89.E5.BA.AB"></span><span class="mw-headline" id="快照倉庫">快照倉庫</span>
</h2>
<p>當多個映像檔建立或更新，他們可能各自有不同的套件版本，為了讓這些Containers能夠有一致的套件版本，使用者可以使用<a rel="nofollow" class="external text" href="https://registry.hub.docker.com/u/pritunl/archlinux/">Docker image with a snapshot repository</a>，他允許使用者在建立之後從官方套件庫安裝套件。
</p>
<pre>$ docker pull pritunl/archlinux:latest
$ docker run --rm -t -i pritunl/archlinux:latest /bin/bash
</pre>
<h2>
<span id=".E6.8F.90.E7.A4.BA"></span><span class="mw-headline" id="提示">提示</span>
</h2>
<p>你可以透過這個指令擷取執行中Container的IP位址：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker inspect --format '{{ .NetworkSettings.IPAddress }}' &lt;container-name OR id&gt; </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">172.17.0.37</pre>
<h2>
<span id=".E5.B8.B8.E8.A6.8B.E5.95.8F.E9.A1.8C"></span><span class="mw-headline" id="常見問題">常見問題</span>
</h2>
<h3>
<span id="Docker_Info.E9.A1.AF.E7.A4.BA.E9.8C.AF.E8.AA.A4.E8.A8.8A.E6.81.AF"></span><span class="mw-headline" id="Docker_Info顯示錯誤訊息">Docker Info顯示錯誤訊息</span>
</h3>
<p>如果執行 <code>docker info</code> 後收到下面的錯誤訊息：
</p>
<pre> FATA[0000] Get <a rel="nofollow" class="external free" href="http:///var/run/docker.sock/v1.17/info">http:///var/run/docker.sock/v1.17/info</a>: read unix /var/run/docker.sock: connection reset by peer. Are you trying to connect to a TLS-enabled daemon without TLS? 
</pre>
<p>這表示你可能沒有載入 <code>bridge</code> 模組，你可以透過執行 <code>lsmod </code> 來檢查是否載入。 如果沒有，你可以使用  <code>modprobe bridge</code> 來載入或者是重新開機(當近期有更新核心(kernel)後而沒有重新開機，請務必進行重新開機，因為Bridge模組有可能是建置在最新的核心上)。
</p>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>註記:</strong>  您可以參考 <a rel="nofollow" class="external text" href="https://github.com/docker/docker/issues/6853">Docker daemon fails to start on Arch Linux with "package not installed" #6853 </a>來獲得更多資訊。</div>
<h3>
<span id=".E5.9C.A8BTRFS.E6.AA.94.E6.A1.88.E7.B3.BB.E7.B5.B1.E4.B8.AD.E5.88.AA.E9.99.A4_Docker_.E6.98.A0.E5.83.8F.E6.AA.94"></span><span class="mw-headline" id="在BTRFS檔案系統中刪除_Docker_映像檔">在BTRFS檔案系統中刪除 Docker 映像檔</span>
</h3>
<p>當使用者在<a href="../en/Btrfs.html" title="Btrfs">btrfs</a>檔案系統中刪除Docker映像檔時，在 <code>/var/lib/docker/btrfs/subvolumes/</code> 會殘留一個檔案大小為0的映像檔。當你嘗試刪除它時，可能會收到權限上的錯誤。
</p>
<pre> # docker rm bab4ff309870
 # rm -Rf /var/lib/docker/btrfs/subvolumes/*
 rm: cannot remove '/var/lib/docker/btrfs/subvolumes/85122f1472a76b7519ed0095637d8501f1d456787be1a87f2e9e02792c4200ab': Operation not permitted
</pre>
<p>這是<a href="../en/Btrfs.html" title="Btrfs">btrfs</a>建立subvolumes導致的問題，正確的刪除指令為：
</p>
<pre> # btrfs subvolume delete /var/lib/docker/btrfs/subvolumes/85122f1472a76b7519ed0095637d8501f1d456787be1a87f2e9e02792c4200ab
</pre>
<h3>
<span id="Container.E4.B8.AD.E7.9A.84docker0_Bridge.E7.84.A1.E6.B3.95.E5.8F.96.E5.BE.97IP.2F.E7.84.A1.E6.B3.95.E5.AD.98.E5.8F.96.E7.B6.B2.E8.B7.AF"></span><span class="mw-headline" id="Container中的docker0_Bridge無法取得IP/無法存取網路">Container中的docker0 Bridge無法取得IP/無法存取網路</span>
</h3>
<p>Docker預設是有啟用IP forwarding的，但是systemd的預設值會覆蓋掉它，你可以按照下列步驟來取消覆蓋(對所有介面有效)：
</p>
<pre># cat &gt;/etc/systemd/network/ipforward.network &lt;&lt;EOF
[Network]
IPForward=kernel
EOF
</pre>
<p>最後 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">重新啟動</a> <code>systemd-networkd</code> 和 <code>docker</code> 兩個服務。
</p>
<pre># systemctl restart systemd-networkd.service
# systemctl restart docker.service
</pre>
<h2>
<span id=".E5.8F.83.E8.80.83.E8.B3.87.E6.96.99"></span><span class="mw-headline" id="參考資料">參考資料</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://docs.docker.com/installation/archlinux/">Arch Linux on docs.docker.com</a><sup title="Last check status: 403">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-08-02 ⓘ]</sup>
</li>
<li>
<a rel="nofollow" class="external text" href="https://www.gitbook.com/book/philipzheng/docker_practice/details">《Docker —— 從入門到實踐­》正體中文版</a> (非官方文件)</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:7d876dcc0aeb99723c8082d6986c7db5.html" title="Category:正體中文">正體中文</a></li>
<li><a href="../zh-TW/Category:Virtualization.html" title="Category:Virtualization (正體中文)">Virtualization (正體中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Docker_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)&amp;oldid=628474">https://wiki.archlinux.org/index.php?title=Docker_(正體中文)&amp;oldid=628474</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 2 August 2020, at 17:43.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
