<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GRUB (正體中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GRUB_正體中文 rootpage-GRUB_正體中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">GRUB (正體中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale-modified.png" class="image"><img alt="Tango-preferences-desktop-locale-modified.png" src="../File:Tango-preferences-desktop-locale-modified.png" decoding="async" width="48" height="48"></a><b>The <a href="/title/ArchWiki:Contributing#Translating" title="ArchWiki:Contributing">translation</a> of this article or section does not reflect the original text.</b><a href="/title/File:Tango-preferences-desktop-locale-modified.png" class="image"><img alt="Tango-preferences-desktop-locale-modified.png" src="../File:Tango-preferences-desktop-locale-modified.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Last updated 2012 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:GRUB_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)">Talk:GRUB (正體中文)#</a>)</div>
</div>
<p><a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/">GRUB2</a> 是新一代的 GRand Unified Bootloader (GRUB/開機引導程式). GRUB2 來自於 <a rel="nofollow" class="external text" href="https://www.nongnu.org/pupa/">PUPA</a> 這個探討下一代 GRUB 的研究專案 。GRUB 2 被重新編寫，擁有模組化和可移植性。<a rel="nofollow" class="external autonumber" href="https://www.gnu.org/software/grub/grub-faq.html#q1">[1]</a>
</p>
<p>簡單地說，<i>開機引導程式</i> 是當電腦開機時第一個執行的程式（在此請自動忽略BIOS）。它負責載入並移交控制權給 Linux 核心。而核心載入後，則反過來啟動作業系統內的其它部份。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%89%8D%E8%A8%80"><span class="tocnumber">1</span> <span class="toctext">前言</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E7%B5%A6_GRUB_%E8%88%8A%E7%89%88%E7%9A%84%E4%BD%BF%E7%94%A8%E8%80%85"><span class="tocnumber">1.1</span> <span class="toctext">給 GRUB 舊版的使用者</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#Preliminary_Requirements_for_GRUB2"><span class="tocnumber">1.2</span> <span class="toctext">Preliminary Requirements for GRUB2</span></a>
<ul>
<li class="toclevel-3 tocsection-4">
<a href="#BIOS_%E7%B3%BB%E7%B5%B1"><span class="tocnumber">1.2.1</span> <span class="toctext">BIOS 系統</span></a>
<ul>
<li class="toclevel-4 tocsection-5"><a href="#GPT_specific_instructions"><span class="tocnumber">1.2.1.1</span> <span class="toctext">GPT specific instructions</span></a></li>
<li class="toclevel-4 tocsection-6"><a href="#MBR_aka_msdos_partitioning_specific_instructions"><span class="tocnumber">1.2.1.2</span> <span class="toctext">MBR aka msdos partitioning specific instructions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-7">
<a href="#UEFI_%E7%B3%BB%E7%B5%B1"><span class="tocnumber">1.2.2</span> <span class="toctext">UEFI 系統</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#%E5%89%B5%E5%BB%BA%E4%B8%A6%E6%8E%9B%E8%BC%89%E5%88%B0UEFI%E7%B3%BB%E7%B5%B1%E5%88%86%E5%89%B2%E5%8D%80(Create_and_Mount_the_UEFI_SYSTEM_PARTITION)"><span class="tocnumber">1.2.2.1</span> <span class="toctext">創建並掛載到UEFI系統分割區(Create and Mount the UEFI SYSTEM PARTITION)</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%E5%AE%89%E8%A3%9D"><span class="tocnumber">2</span> <span class="toctext">安裝</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#BIOS_%E7%B3%BB%E7%B5%B1_2"><span class="tocnumber">2.1</span> <span class="toctext">BIOS 系統</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#%E5%82%99%E4%BB%BD%E9%87%8D%E8%A6%81%E8%B3%87%E6%96%99(Backup_Important_Data)"><span class="tocnumber">2.1.1</span> <span class="toctext">備份重要資料(Backup Important Data)</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#%E5%AE%89%E8%A3%9Dgrub-bios%E5%A5%97%E4%BB%B6(Install_grub-bios_package)"><span class="tocnumber">2.1.2</span> <span class="toctext">安裝grub-bios套件(Install grub-bios package)</span></a></li>
<li class="toclevel-3 tocsection-13">
<a href="#%E5%AE%89%E8%A3%9Dgrub-bios%E5%95%9F%E5%8B%95%E6%AA%94%E6%A1%88(Install_grub-bios_boot_files)"><span class="tocnumber">2.1.3</span> <span class="toctext">安裝grub-bios啟動檔案(Install grub-bios boot files)</span></a>
<ul>
<li class="toclevel-4 tocsection-14"><a href="#%E5%AE%89%E8%A3%9D%E5%88%B0440%E4%BD%8D%E5%85%83%E7%B5%84MBR%E5%95%9F%E5%8B%95%E5%8D%80(Install_to_440-byte_MBR_boot_code_region)"><span class="tocnumber">2.1.3.1</span> <span class="toctext">安裝到440位元組MBR啟動區(Install to 440-byte MBR boot code region)</span></a></li>
<li class="toclevel-4 tocsection-15"><a href="#Install_to_Partition_or_Partitionless_Disk"><span class="tocnumber">2.1.3.2</span> <span class="toctext">Install to Partition or Partitionless Disk</span></a></li>
<li class="toclevel-4 tocsection-16"><a href="#%E5%96%AE%E7%8D%A8%E7%94%A2%E7%94%9Fcore.img(Generate_core.img_alone)"><span class="tocnumber">2.1.3.3</span> <span class="toctext">單獨產生core.img(Generate core.img alone)</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-17"><a href="#%E7%94%A2%E7%94%9FGRUB2_BOIS%E8%A8%AD%E7%BD%AE%E6%AA%94%E6%A1%88(Generate_GRUB2_BIOS_Config_file)"><span class="tocnumber">2.1.4</span> <span class="toctext">產生GRUB2 BOIS設置檔案(Generate GRUB2 BIOS Config file)</span></a></li>
<li class="toclevel-3 tocsection-18">
<a href="#%E5%9C%A8BIOS%E5%A4%9A%E9%87%8D%E5%95%9F%E5%8B%95(Multiboot_in_BIOS)"><span class="tocnumber">2.1.5</span> <span class="toctext">在BIOS多重啟動(Multiboot in BIOS)</span></a>
<ul>
<li class="toclevel-4 tocsection-19"><a href="#%E5%9C%A8BIOS-MBR%E6%A8%A1%E5%BC%8F%E4%B8%AD%E5%95%9F%E5%8B%95%E5%B7%B2%E5%AE%89%E8%A3%9D%E7%9A%84Microsoft_Windows(Boot_Microsoft_Windows_installed_in_BIOS-MBR_mode)"><span class="tocnumber">2.1.5.1</span> <span class="toctext">在BIOS-MBR模式中啟動已安裝的Microsoft Windows(Boot Microsoft Windows installed in BIOS-MBR mode)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-20">
<a href="#UEFI%E7%B3%BB%E7%B5%B1(UEFI_systems)"><span class="tocnumber">2.2</span> <span class="toctext">UEFI系統(UEFI systems)</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#%E5%AE%89%E8%A3%9Dgrub-uefi%E5%A5%97%E4%BB%B6(Install_grub-uefi_package)"><span class="tocnumber">2.2.1</span> <span class="toctext">安裝grub-uefi套件(Install grub-uefi package)</span></a></li>
<li class="toclevel-3 tocsection-22">
<a href="#%E5%AE%89%E8%A3%9Dgrub-uefi%E5%95%9F%E5%8B%95%E6%AA%94%E6%A1%88(Install_grub-uefi_boot_files)"><span class="tocnumber">2.2.2</span> <span class="toctext">安裝grub-uefi啟動檔案(Install grub-uefi boot files)</span></a>
<ul>
<li class="toclevel-4 tocsection-23"><a href="#Install_to_UEFI_SYSTEM_PARTITION"><span class="tocnumber">2.2.2.1</span> <span class="toctext">Install to UEFI SYSTEM PARTITION</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-24">
<a href="#Create_GRUB2_entry_in_the_Firmware_Boot_Manager"><span class="tocnumber">2.2.3</span> <span class="toctext">Create GRUB2 entry in the Firmware Boot Manager</span></a>
<ul>
<li class="toclevel-4 tocsection-25"><a href="#Non-Mac_UEFI_systems"><span class="tocnumber">2.2.3.1</span> <span class="toctext">Non-Mac UEFI systems</span></a></li>
<li class="toclevel-4 tocsection-26"><a href="#Apple_Mac_EFI_systems"><span class="tocnumber">2.2.3.2</span> <span class="toctext">Apple Mac EFI systems</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-27"><a href="#%E7%94%A2%E7%94%9FGRUB2_UEFI%E8%A8%AD%E7%BD%AE%E6%AA%94%E6%A1%88(Generate_GRUB2_UEFI_Config_file)"><span class="tocnumber">2.2.4</span> <span class="toctext">產生GRUB2 UEFI設置檔案(Generate GRUB2 UEFI Config file)</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#Create_GRUB2_Standalone_UEFI_Application"><span class="tocnumber">2.2.5</span> <span class="toctext">Create GRUB2 Standalone UEFI Application</span></a></li>
<li class="toclevel-3 tocsection-29">
<a href="#Multiboot_in_UEFI"><span class="tocnumber">2.2.6</span> <span class="toctext">Multiboot in UEFI</span></a>
<ul>
<li class="toclevel-4 tocsection-30"><a href="#Chainload_Microsoft_Windows_x86_64_UEFI-GPT"><span class="tocnumber">2.2.6.1</span> <span class="toctext">Chainload Microsoft Windows x86_64 UEFI-GPT</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-31">
<a href="#%E8%A8%AD%E7%BD%AE(Configuration)"><span class="tocnumber">3</span> <span class="toctext">設置(Configuration)</span></a>
<ul>
<li class="toclevel-2 tocsection-32">
<a href="#%E4%BD%BF%E7%94%A8grub-mkconfig%E8%87%AA%E5%8B%95%E7%94%A2%E7%94%9F(Automatically_generating_using_grub-mkconfig)_(Recommended)"><span class="tocnumber">3.1</span> <span class="toctext">使用grub-mkconfig自動產生(Automatically generating using grub-mkconfig) (Recommended)</span></a>
<ul>
<li class="toclevel-3 tocsection-33"><a href="#Additional_arguments"><span class="tocnumber">3.1.1</span> <span class="toctext">Additional arguments</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-34"><a href="#%E6%89%8B%E5%8B%95%E5%89%B5%E5%BB%BAgrub.cfg(_Manually_creating_grub.cfg)"><span class="tocnumber">3.2</span> <span class="toctext">手動創建grub.cfg( Manually creating grub.cfg)</span></a></li>
<li class="toclevel-2 tocsection-35">
<a href="#%E9%9B%99%E5%95%9F%E5%8B%95(dual-boot)"><span class="tocnumber">3.3</span> <span class="toctext">雙啟動(dual-boot)</span></a>
<ul>
<li class="toclevel-3 tocsection-36">
<a href="#%E4%BD%BF%E7%94%A8_grub-mkconfig"><span class="tocnumber">3.3.1</span> <span class="toctext">使用 grub-mkconfig</span></a>
<ul>
<li class="toclevel-4 tocsection-37"><a href="#%E8%88%87_GNU/Linux"><span class="tocnumber">3.3.1.1</span> <span class="toctext">與 GNU/Linux</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#%E8%88%87_FreeBSD"><span class="tocnumber">3.3.1.2</span> <span class="toctext">與 FreeBSD</span></a></li>
<li class="toclevel-4 tocsection-39"><a href="#%E8%88%87_Windows"><span class="tocnumber">3.3.1.3</span> <span class="toctext">與 Windows</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-40"><a href="#With_Windows_via_EasyBCD_and_NeoGRUB"><span class="tocnumber">3.3.2</span> <span class="toctext">With Windows via EasyBCD and NeoGRUB</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-41">
<a href="#Visual_Configuration"><span class="tocnumber">3.4</span> <span class="toctext">Visual Configuration</span></a>
<ul>
<li class="toclevel-3 tocsection-42"><a href="#Setting_the_framebuffer_resolution"><span class="tocnumber">3.4.1</span> <span class="toctext">Setting the framebuffer resolution</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#915resolution_hack"><span class="tocnumber">3.4.2</span> <span class="toctext">915resolution hack</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="#%E8%83%8C%E6%99%AF%E5%9C%96%E7%89%87%E5%92%8C%E5%AD%97%E9%AB%94(Background_image_and_bitmap_fonts)"><span class="tocnumber">3.4.3</span> <span class="toctext">背景圖片和字體(Background image and bitmap fonts)</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#%E4%BD%88%E6%99%AF%E4%B8%BB%E9%A1%8C(Theme)"><span class="tocnumber">3.4.4</span> <span class="toctext">佈景主題(Theme)</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="#%E9%81%B8%E5%96%AE%E9%A1%8F%E8%89%B2(Menu_colors)"><span class="tocnumber">3.4.5</span> <span class="toctext">選單顏色(Menu colors)</span></a></li>
<li class="toclevel-3 tocsection-47"><a href="#%E9%9A%B1%E8%97%8F%E9%81%B8%E5%96%AE(Hidden_menu)"><span class="tocnumber">3.4.6</span> <span class="toctext">隱藏選單(Hidden menu)</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#%E9%97%9C%E9%96%89%E5%B9%80%E7%B7%A9%E8%A1%9D(Disable_framebuffer)"><span class="tocnumber">3.4.7</span> <span class="toctext">關閉幀緩衝(Disable framebuffer)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-49">
<a href="#%E5%85%B6%E4%BB%96%E9%81%B8%E9%A0%85(Other_Options)"><span class="tocnumber">3.5</span> <span class="toctext">其他選項(Other Options)</span></a>
<ul>
<li class="toclevel-3 tocsection-50"><a href="#LVM"><span class="tocnumber">3.5.1</span> <span class="toctext">LVM</span></a></li>
<li class="toclevel-3 tocsection-51"><a href="#RAID"><span class="tocnumber">3.5.2</span> <span class="toctext">RAID</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#Persistent_block_device_naming"><span class="tocnumber">3.5.3</span> <span class="toctext">Persistent block device naming</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#Using_Labels"><span class="tocnumber">3.5.4</span> <span class="toctext">Using Labels</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#Recall_previous_entry"><span class="tocnumber">3.5.5</span> <span class="toctext">Recall previous entry</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#%E5%AE%89%E5%85%A8(Security)"><span class="tocnumber">3.5.6</span> <span class="toctext">安全(Security)</span></a></li>
<li class="toclevel-3 tocsection-56"><a href="#Root_Encryption"><span class="tocnumber">3.5.7</span> <span class="toctext">Root Encryption</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-57">
<a href="#%E5%9C%A8GRUB2%E5%95%9F%E5%8B%95(ISOBooting_an_ISO_Directly_From_GRUB2)"><span class="tocnumber">3.6</span> <span class="toctext">在GRUB2啟動(ISOBooting an ISO Directly From GRUB2)</span></a>
<ul>
<li class="toclevel-3 tocsection-58"><a href="#Arch_ISO"><span class="tocnumber">3.6.1</span> <span class="toctext">Arch ISO</span></a></li>
<li class="toclevel-3 tocsection-59"><a href="#Ubuntu_ISO"><span class="tocnumber">3.6.2</span> <span class="toctext">Ubuntu ISO</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-60">
<a href="#Using_the_command_shell"><span class="tocnumber">4</span> <span class="toctext">Using the command shell</span></a>
<ul>
<li class="toclevel-2 tocsection-61"><a href="#Pager_support"><span class="tocnumber">4.1</span> <span class="toctext">Pager support</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-62"><a href="#GUI_configuration_tools"><span class="tocnumber">5</span> <span class="toctext">GUI configuration tools</span></a></li>
<li class="toclevel-1 tocsection-63"><a href="#parttool_or_legacy_hide/unhide"><span class="tocnumber">6</span> <span class="toctext">parttool or legacy hide/unhide</span></a></li>
<li class="toclevel-1 tocsection-64"><a href="#Using_the_rescue_console"><span class="tocnumber">7</span> <span class="toctext">Using the rescue console</span></a></li>
<li class="toclevel-1 tocsection-65"><a href="#Combining_the_use_of_UUIDs_and_basic_scripting"><span class="tocnumber">8</span> <span class="toctext">Combining the use of UUIDs and basic scripting</span></a></li>
<li class="toclevel-1 tocsection-66">
<a href="#%E7%96%91%E9%9B%A3%E6%8E%92%E8%A7%A3(Troubleshooting)"><span class="tocnumber">9</span> <span class="toctext">疑難排解(Troubleshooting)</span></a>
<ul>
<li class="toclevel-2 tocsection-67"><a href="#Enable_GRUB2_debug_messages"><span class="tocnumber">9.1</span> <span class="toctext">Enable GRUB2 debug messages</span></a></li>
<li class="toclevel-2 tocsection-68"><a href="#Correct_GRUB2_No_Suitable_Mode_Found_Error"><span class="tocnumber">9.2</span> <span class="toctext">Correct GRUB2 No Suitable Mode Found Error</span></a></li>
<li class="toclevel-2 tocsection-69"><a href="#msdos-style_error_message"><span class="tocnumber">9.3</span> <span class="toctext">msdos-style error message</span></a></li>
<li class="toclevel-2 tocsection-70"><a href="#UEFI_GRUB2_drops_to_shell"><span class="tocnumber">9.4</span> <span class="toctext">UEFI GRUB2 drops to shell</span></a></li>
<li class="toclevel-2 tocsection-71"><a href="#UEFI_GRUB2_not_loaded"><span class="tocnumber">9.5</span> <span class="toctext">UEFI GRUB2 not loaded</span></a></li>
<li class="toclevel-2 tocsection-72"><a href="#Invalid_signature"><span class="tocnumber">9.6</span> <span class="toctext">Invalid signature</span></a></li>
<li class="toclevel-2 tocsection-73"><a href="#Restore_GRUB_Legacy"><span class="tocnumber">9.7</span> <span class="toctext">Restore GRUB Legacy</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-74"><a href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99(References)"><span class="tocnumber">10</span> <span class="toctext">參考資料(References)</span></a></li>
<li class="toclevel-1 tocsection-75"><a href="#%E5%A4%96%E9%83%A8%E9%80%A3%E7%B5%90(External_Links)"><span class="tocnumber">11</span> <span class="toctext">外部連結(External Links)</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.89.8D.E8.A8.80"></span><span class="mw-headline" id="前言">前言</span>
</h2>
<p>有些資訊必須先予以澄清:
</p>
<ul><li>The name <i>GRUB</i> officially refers to version <i>2</i> of the software, see <a rel="nofollow" class="external autonumber" href="https://www.gnu.org/software/grub/">[2]</a>. If you are looking for the article on the legacy version, see <a href="/title/GRUB_Legacy" title="GRUB Legacy">GRUB Legacy</a>.</li></ul>
<ul><li>
<a href="/title/GRUB_Legacy" title="GRUB Legacy">GRUB Legacy</a> (i.e. version 0.9x) 已被開發者們認為是舊作，在 Arch Linux已經被GRUB2取代 . 參閱最新消息 <a rel="nofollow" class="external text" href="https://archlinux.org/news/grub-legacy-no-longer-supported/">here</a>. Upstream recommends GRUB2 &gt;=1.99 over GRUB Legacy, even for current GRUB Legacy users.</li></ul>
<ul><li>從 1.99-6版起, GRUB2 支援 <a href="/title/Btrfs" title="Btrfs">Btrfs</a> as root (without a separate <code>/boot</code> filesystem) compressed with either zlib or LZO.</li></ul>
<ul><li>For GRUB2 UEFI info, it is recommended to read the <a href="/title/UEFI" class="mw-redirect" title="UEFI">UEFI</a>, <a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a> and <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">Boot loader</a> pages before reading this page.</li></ul>
<h3>
<span id=".E7.B5.A6_GRUB_.E8.88.8A.E7.89.88.E7.9A.84.E4.BD.BF.E7.94.A8.E8.80.85"></span><span class="mw-headline" id="給_GRUB_舊版的使用者">給 GRUB 舊版的使用者</span>
</h3>
<ul><li>GRUB 舊版將從您的系統中移除, 您可以考慮將 GRUB更新到版本 2.x, 或者其他開機程式.</li></ul>
<ul><li>Upgrade from <a href="/title/GRUB_Legacy" title="GRUB Legacy">GRUB Legacy</a> to <a href="/title/GRUB" title="GRUB">GRUB</a>(2) is the much same as fresh installing GRUB(2)which is covered <a href="#Installation">below</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.</li></ul>
<ul><li>GRUB and GRUB2 的指令是有差別的. 請在進行下一步之前自己熟悉一下 <a rel="nofollow" class="external text" href="https://web.archive.org/web/20100819172849/http://grub.enbug.org/CommandList">GRUB2 commands</a>  (例如， "find" 就被更換為 "search").</li></ul>
<ul><li>GRUB2 現在己經 <i>模組化</i> 且不再需要 "stage 1.5"。因此，引導程式本身是有限的 - 當需要擴充功能時模組才從硬碟內被載入（例如，<a href="/title/LVM" title="LVM">LVM</a> 或 RAID支援）</li></ul>
<ul><li>GRUB2 設備命名也改得和 GRUB 不同。磁區 Partitions 由數字 1 起算，而硬碟仍然由 0 起算，舉例來說，<code>/dev/sda1</code> 被 GRUB2 指引為 <code>(hd0,1)</code>等 。</li></ul>
<h3><span class="mw-headline" id="Preliminary_Requirements_for_GRUB2">Preliminary Requirements for GRUB2</span></h3>
<h4>
<span id="BIOS_.E7.B3.BB.E7.B5.B1"></span><span class="mw-headline" id="BIOS_系統">BIOS 系統</span>
</h4>
<h5><span class="mw-headline" id="GPT_specific_instructions"><a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a> specific instructions</span></h5>
<p>GRUB2 in BIOS-GPT configuration requires a <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/html_node/BIOS-installation.html#BIOS-installation">BIOS Boot Partition</a> to embed its <code>core.img</code> in the absence of post-MBR gap in GPT partitioned systems (which is taken over by the GPT Primary Header and Primary Partition table). This partition is used by GRUB2 only in BIOS-GPT setups. No such partition type exists in case of MBR partitioning (at least not for GRUB2). This partition is also not required if the system is UEFI based, as no embedding of bootsectors takes place in that case. Syslinux does not require this partition.
</p>
<p>For a BIOS-GPT configuration, create a 2 MiB partition using cgdisk or GNU Parted with no filesystem. The location of the partition in the partition table does not matter but it should be within the first 2 TiB region of the disk. It is advisable to put it somewhere in the beginning of the disk before the <code>/boot</code> partition. Set the partition type to "EF02" in cgdisk or <code>set &lt;BOOT_PART_NUM&gt; bios_grub on</code> in GNU Parted.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This partition should be created before <code>grub-install</code> or <code>grub-setup</code> is run or before the <b>Install Bootloader</b> step of the Archlinux installer (if GRUB2 BIOS is selected as bootloader).</div>
<h5><span class="mw-headline" id="MBR_aka_msdos_partitioning_specific_instructions"><a href="/title/MBR" class="mw-redirect" title="MBR">MBR</a> aka msdos partitioning specific instructions</span></h5>
<p>Usually the post-MBR gap (after the 512 byte MBR region and before the start of the 1st partition) in many MBR (or msdos disklabel) partitioned systems is 31 KiB when DOS compatibility cylinder alignment issues are satisfied in the partition table. However a post-MBR gap of about 1 to 2 MiB is recommended to provide sufficient room for embedding GRUB2's <code>core.img</code> (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/24103">FS#24103</a>). It is advisable to use a partitioner which supports 1 MiB partition alignment to obtain this space as well as satisfy other non-512 byte sector issues (which are unrelated to embedding of <code>core.img</code>).
</p>
<p>如果你沒有在BIOS系統中雙啟動到MS Windows (any version), 轉換到 GPT partitioning - <a href="/title/GUID_Partition_Table#Convert_from_MBR_to_GPT" class="mw-redirect" title="GUID Partition Table">GUID Partition Table#Convert_from_MBR_to_GPT</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>是很適合的。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Create the 2MiB partition mentioned above BEFORE you convert to GPT. If you do not, gparted will not resize your boot partition to allow its creation, and when you reboot GRUB2 will not know where to look.</div>
<h4>
<span id="UEFI_.E7.B3.BB.E7.B5.B1"></span><span class="mw-headline" id="UEFI_系統">UEFI 系統</span>
</h4>
<h5>
<span id=".E5.89.B5.E5.BB.BA.E4.B8.A6.E6.8E.9B.E8.BC.89.E5.88.B0UEFI.E7.B3.BB.E7.B5.B1.E5.88.86.E5.89.B2.E5.8D.80.28Create_and_Mount_the_UEFI_SYSTEM_PARTITION.29"></span><span class="mw-headline" id="創建並掛載到UEFI系統分割區(Create_and_Mount_the_UEFI_SYSTEM_PARTITION)">創建並掛載到UEFI系統分割區(Create and Mount the UEFI SYSTEM PARTITION)</span>
</h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 建議先閱讀 <a href="/title/UEFI" class="mw-redirect" title="UEFI">UEFI</a>, <a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a> and <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">Boot loader</a> 頁面</div>
<p>遵循 <a href="/title/Unified_Extensible_Firmware_Interface#Create_an_UEFI_System_Partition_in_Linux" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#Create_an_UEFI_System_Partition_in_Linux</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> 中創建 UEFI SYSTEM PARTITION的指引. 接在將 UEFI SYSTEM PARTITION（也就是ESP分割區） 掛載在 <code>/boot/efi</code>. 如果您已經將 UEFI System Partition 掛載在其他掛載點, 以此掛載點置換在下面指引中的 {ic|/boot/efi}} :
</p>
<pre># mkdir -p /boot/efi
# mount -t vfat &lt;UEFISYS_PART_DEVICE&gt; /boot/efi
</pre>
<p>如果&lt;UEFI_系統分割區&gt;<code>/EFI</code>不存在，請創建它的路徑(如：/boot/efi/EFI) 
</p>
<pre># mkdir -p /boot/efi/EFI
</pre>
<h2>
<span id=".E5.AE.89.E8.A3.9D"></span><span class="mw-headline" id="安裝">安裝</span>
</h2>
<h3>
<span id="BIOS_.E7.B3.BB.E7.B5.B1_2"></span><span class="mw-headline" id="BIOS_系統_2">BIOS 系統</span>
</h3>
<h4>
<span id=".E5.82.99.E4.BB.BD.E9.87.8D.E8.A6.81.E8.B3.87.E6.96.99.28Backup_Important_Data.29"></span><span class="mw-headline" id="備份重要資料(Backup_Important_Data)">備份重要資料(Backup Important Data)</span>
</h4>
<p>雖然 GRUB(2) 的安裝應該會是相當平穩的,仍然強烈建議安裝 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-bios">grub-bios</a></span><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span>]</sup>前保留舊版的 GRUB資料。
</p>
<pre># mv /boot/grub /boot/grub-legacy
</pre>
<p>備份內含啟動碼(boot code)跟分區對映表(partition table)的 MBR  (根據您的實際硬碟分割情形，置換 <code>/dev/sd<b>X</b></code> )
</p>
<pre># dd if=/dev/sdX of=/path/to/backup/mbr_backup bs=512 count=1
</pre>
<p>只有 MBR中的446 位元組包含啟動碼, 接者的 64 位元組包含分區對映表. 如果您不想在將來回存到MBR時覆蓋掉你新設置的分區對映表，強烈建議此時只備份MBR啟動碼就好:
</p>
<pre># dd if=/dev/sdX of=/path/to/backup/bootcode_backup bs=446 count=1
</pre>
<p>如果無法正確安裝 GRUB2 , 參閱 <a href="/title/GRUB2#Restore_GRUB_Legacy" class="mw-redirect" title="GRUB2">GRUB2#Restore_GRUB_Legacy</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.
</p>
<h4>
<span id=".E5.AE.89.E8.A3.9Dgrub-bios.E5.A5.97.E4.BB.B6.28Install_grub-bios_package.29"></span><span class="mw-headline" id="安裝grub-bios套件(Install_grub-bios_package)">安裝grub-bios套件(Install grub-bios package)</span>
</h4>
<pre>GRUB(2)套件可以用pacman安裝 (安裝完將會取代 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-legacy/">grub-legacy</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span>):

# pacman -S grub-bios
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 僅安裝套件並不會更新 <code>/boot/grub/i386-pc/core.img</code> 檔案和 GRUB(2) 在 <code>/boot/grub/i386-pc</code>的模組. 你必須如下解釋般使用 <code>grub-install</code>來更新他們</div>
<h4>
<span id=".E5.AE.89.E8.A3.9Dgrub-bios.E5.95.9F.E5.8B.95.E6.AA.94.E6.A1.88.28Install_grub-bios_boot_files.29"></span><span class="mw-headline" id="安裝grub-bios啟動檔案(Install_grub-bios_boot_files)">安裝grub-bios啟動檔案(Install grub-bios boot files)</span>
</h4>
<p>要達到BIOS啟動有三種安裝 GRUB(2)方法:
</p>
<ul>
<li>
<a href="#%E5%AE%89%E8%A3%9D%E5%88%B0440%E4%BD%8D%E5%85%83%E7%B5%84MBR%E5%95%9F%E5%8B%95%E5%8D%80(Install_to_440-byte_MBR_boot_code_region)">#安裝到440位元組MBR啟動區(Install to 440-byte MBR boot code region)</a> (建議) ,</li>
<li>
<a href="#Install_to_Partition_or_Partitionless_Disk">#Install to Partition or Partitionless Disk</a> (不建議),</li>
<li>
<a href="#Generate_core.img_alone">#Generate_core.img_alone</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> (最安全的方法,但需要安裝其他的BIOS引導程式像是 <a href="/title/Grub-legacy" class="mw-redirect" title="Grub-legacy">grub-legacy</a> 或 <a href="/title/Syslinux" title="Syslinux">syslinux</a> 來連鎖啟動 (chainload) <code>/boot/grub/i386-pc/core.img</code>).</li>
</ul>
<h5>
<span id=".E5.AE.89.E8.A3.9D.E5.88.B0440.E4.BD.8D.E5.85.83.E7.B5.84MBR.E5.95.9F.E5.8B.95.E5.8D.80.28Install_to_440-byte_MBR_boot_code_region.29"></span><span class="mw-headline" id="安裝到440位元組MBR啟動區(Install_to_440-byte_MBR_boot_code_region)">安裝到440位元組MBR啟動區(Install to 440-byte MBR boot code region)</span>
</h5>
<p>To setup <code>grub-bios</code> in the 440-byte Master Boot Record boot code region, populate the <code>/boot/grub</code> directory, generate the <code>/boot/grub/i386-pc/core.img</code> file, and embed it in the 31 KiB (minimum size - varies depending on partition alignment) post-MBR gap (MBR disks) or in BIOS Boot Partition (GPT disks), run:
</p>
<pre># modprobe dm-mod
# grub-install --target=i386-pc --recheck --debug /dev/sda
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
</pre>
<p>where <code>/dev/sda</code> is the destination of the installation (in this case the MBR of the first SATA disk). If you use <a href="/title/LVM" title="LVM">LVM</a> for your <code>/boot</code>, you can install GRUB2 on multiple physical disks. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Without <code>--target</code> or <code>--directory</code> option, grub-install cannot determine for which firmware grub(2) is being installed. In such cases grub-install will show <code>source_dir does not exist. Please specify --target or --directory</code> message.</div>
<p>The <code>--no-floppy</code> tells <code>grub-bios</code> utilities not to search for any floppy devices which reduces the overall execution time of <code>grub-install</code> on many systems (it will also prevent the issue below from occurring). Otherwise you get an error that looks like this:
</p>
<pre>grub-probe: error: Cannot get the real path of '/dev/fd0'
Auto-detection of a filesystem module failed.
Please specify the module with the option '--modules' explicitly.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>--no-floppy</code> has been removed from <code>grub-install</code> in 2.00~beta2 upstream release, and replaced with <code>--allow-floppy</code>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Make sure to check the <code>/boot</code> directory if you use the latter. Sometimes the <code> boot-directory</code> parameter creates another <code>/boot</code> folder inside of <code>/boot</code>. A wrong install would look like: <code>/boot/boot/grub/</code>.</div>
<h5><span class="mw-headline" id="Install_to_Partition_or_Partitionless_Disk">Install to Partition or Partitionless Disk</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>grub-bios</code> (any version - including upstream Bazaar repo) does not encourage installation to a partition boot sector or a partitionless disk like GRUB Legacy or syslinux does. This kind of setup is prone to breakage, especially during updates, and is not supported by Arch devs.</div>
<p>To set up <code>grub-bios</code> to a partition boot sector, to a partitionless disk (also called superfloppy) or to a floppy disk, run (using for example <code>/dev/sdaX</code> as the <code>/boot</code> partition):
</p>
<pre># modprobe dm-mod 
# chattr -i /boot/grub/i386-pc/core.img
# grub-install --target=i386-pc --recheck --debug --force /dev/sdaX
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
# chattr +i /boot/grub/i386-pc/core.img
</pre>
<p>You need to use the <code>--force</code> option to allow usage of blocklists and should not use <code>--grub-setup=/bin/true</code> (which is similar to simply generating <code>core.img</code>).
</p>
<p><code>grub-install</code> will give out warnings like which should give you the idea of what might go wrong with this approach:
</p>
<pre>/sbin/grub-setup: warn: Attempting to install GRUB to a partitionless disk or to a partition. This is a BAD idea.
/sbin/grub-setup: warn: Embedding is not possible. GRUB can only be installed in this setup by using blocklists. 
                        However, blocklists are UNRELIABLE and their use is discouraged.
</pre>
<p>Without <code>--force</code> you may get the below error and <code>grub-setup</code> will not setup its boot code in the partition boot sector:
</p>
<pre>/sbin/grub-setup: error: will not proceed with blocklists
</pre>
<p>With <code>--force</code> you should get:
</p>
<pre>Installation finished. No error reported.
</pre>
<p>The reason why <code>grub-setup</code> does not by default allow this is because in case of partition or a partitionless disk is that <code>grub-bios</code> relies on embedded blocklists in the partition bootsector to locate the <code>/boot/grub/i386-pc/core.img</code> file and the prefix dir <code>/boot/grub</code>. The sector locations of <code>core.img</code> may change whenever the filesystem in the partition is being altered (files copied, deleted etc.). For more info see <a rel="nofollow" class="external free" href="https://bugzilla.redhat.com/show_bug.cgi?id=728742">https://bugzilla.redhat.com/show_bug.cgi?id=728742</a> and <a rel="nofollow" class="external free" href="https://bugzilla.redhat.com/show_bug.cgi?id=730915">https://bugzilla.redhat.com/show_bug.cgi?id=730915</a>.
</p>
<p>The workaround for this is to set the immutable flag on <code>/boot/grub/i386-pc/core.img</code> (using chattr command as mentioned above) so that the sector locations of the <code>core.img</code> file in the disk is not altered. The immutable flag on <code>/boot/grub/i386-pc/core.img</code> needs to be set only if <code>grub-bios</code> is installed to a partition boot sector or a partitionless disk, not in case of installation to MBR or simple generation of <code>core.img</code> without embedding any bootsector (mentioned above).
</p>
<h5>
<span id=".E5.96.AE.E7.8D.A8.E7.94.A2.E7.94.9Fcore.img.28Generate_core.img_alone.29"></span><span class="mw-headline" id="單獨產生core.img(Generate_core.img_alone)">單獨產生core.img(Generate core.img alone)</span>
</h5>
<p>To populate the <code>/boot/grub</code> directory and generate a <code>/boot/grub/i386-pc/core.img</code> file <b>without</b> embedding any <code>grub-bios</code> bootsector code in the MBR, post-MBR region, or the partition bootsector, add <code>--grub-setup=/bin/true</code> to <code>grub-install</code>:
</p>
<pre># modprobe dm-mod
# grub-install --target=i386-pc --grub-setup=/bin/true --recheck --debug /dev/sda
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
</pre>
<p>You can then chainload GRUB2's <code>core.img</code> from GRUB Legacy or syslinux as a Linux kernel or a multiboot kernel.
</p>
<h4>
<span id=".E7.94.A2.E7.94.9FGRUB2_BOIS.E8.A8.AD.E7.BD.AE.E6.AA.94.E6.A1.88.28Generate_GRUB2_BIOS_Config_file.29"></span><span class="mw-headline" id="產生GRUB2_BOIS設置檔案(Generate_GRUB2_BIOS_Config_file)">產生GRUB2 BOIS設置檔案(Generate GRUB2 BIOS Config file)</span>
</h4>
<p>最後產生一個GRUB2的設定檔 (this is explained in greater detail in the Configuration section):
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 檔案路徑是 <code>/boot/grub/grub.cfg</code>, <b>不是</b> <code>/boot/grub/i386-pc/grub.cfg</code>.</div>
<p>如果 grub(2) 在啟動是出現 "no suitable mode found" 訊息, 前往到 <a href="#Correct_GRUB2_No_Suitable_Mode_Found_Error">#Correct GRUB2 No Suitable Mode Found Error</a>.
如果 <code>grub-mkconfig</code> 失敗了, 使用下列指令將你的 <code>/boot/grub/menu.lst</code> 轉換成 <code>/boot/grub/grub.cfg</code> :
</p>
<pre># grub-menulst2cfg /boot/grub/menu.lst /boot/grub/grub.cfg
</pre>
<p>範例:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/menu.lst</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default=0
timeout=5

title  Arch Linux Stock Kernel
root   (hd0,0)
kernel /vmlinuz-linux root=/dev/sda2 ro
initrd /initramfs-linux.img

title  Arch Linux Stock Kernel Fallback
root   (hd0,0)
kernel /vmlinuz-linux root=/dev/sda2 ro
initrd /initramfs-linux-fallback.img
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set default='0'; if [ x"$default" = xsaved ]; then load_env; set default="$saved_entry"; fi
set timeout=5

menuentry 'Arch Linux Stock Kernel' {
  set root='(hd0,1)'; set legacy_hdbias='0'
  legacy_kernel   '/vmlinuz-linux' '/vmlinuz-linux' 'root=/dev/sda2' 'ro'
  legacy_initrd '/initramfs-linux.img' '/initramfs-linux.img'
  
}

menuentry 'Arch Linux Stock Kernel Fallback' {
  set root='(hd0,1)'; set legacy_hdbias='0'
  legacy_kernel   '/vmlinuz-linux' '/vmlinuz-linux' 'root=/dev/sda2' 'ro'
  legacy_initrd '/initramfs-linux-fallback.img' '/initramfs-linux-fallback.img'
}
</pre>
<p>如果你忘了創建 <code>/boot/grub/grub.cfg</code> 這個GRUB2的設定檔，那麼重啟到 GRUB2 選單，按C進入命令列, 輸入:
</p>
<pre>sh:grub&gt; insmod legacycfg
sh:grub&gt; legacy_configfile ${prefix}/menu.lst
</pre>
<p>啟動到Archlinux且重新創建正確的  <code>/boot/grub/grub.cfg</code> 。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 這個選項只有在 BIOS 系統管用, 在 UEFI 系統不行.</div>
<h4>
<span id=".E5.9C.A8BIOS.E5.A4.9A.E9.87.8D.E5.95.9F.E5.8B.95.28Multiboot_in_BIOS.29"></span><span class="mw-headline" id="在BIOS多重啟動(Multiboot_in_BIOS)">在BIOS多重啟動(Multiboot in BIOS)</span>
</h4>
<h5>
<span id=".E5.9C.A8BIOS-MBR.E6.A8.A1.E5.BC.8F.E4.B8.AD.E5.95.9F.E5.8B.95.E5.B7.B2.E5.AE.89.E8.A3.9D.E7.9A.84Microsoft_Windows.28Boot_Microsoft_Windows_installed_in_BIOS-MBR_mode.29"></span><span class="mw-headline" id="在BIOS-MBR模式中啟動已安裝的Microsoft_Windows(Boot_Microsoft_Windows_installed_in_BIOS-MBR_mode)">在BIOS-MBR模式中啟動已安裝的Microsoft Windows(Boot Microsoft Windows installed in BIOS-MBR mode)</span>
</h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> GRUB(2) 支援直接啟動 <code>bootmgr</code>檔案和分割區啟動區的連鎖載入 (chainload of partition boot sector)，因此不需要BIOS-MBR設定來啟動Windows</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 需要注意是具有bootmgr檔案的系統分割區, 而不一定是安裝有Windows的分割區, 也就是說:當你用blkid這個指令顯示出所有UUID's，他將是有著 LABEL="SYSTEM RESERVED" 且大小約為 100 mb-200 mb，更像是Arch的 /boot 分割區. 觀看 <a href="https://en.wikipedia.org/wiki/System_partition_and_boot_partition" class="extiw" title="wikipedia:System partition and boot partition">wikipedia:System_partition_and_boot_partition</a> for some more info.</div>
<p>找到放置著<code>bootmgr</code>的NTFS格式Windows系統分割區的UUID  . 舉例來說, 如果 Windows <code>bootmgr</code> 置放在 <code>/media/Windows/bootmgr</code>:
</p>
<pre># grub-probe --target=fs_uuid /media/Windows/bootmgr
69B235F6749E84CE
</pre>
<p>然後, 把下面的幾行敘述加到 <code>/etc/grub.d/40_custom</code> 或 <code>/boot/grub/custom.cfg</code> 接者用前述的<code>grub-mkconfig</code>產生 <code>grub.cfg</code>來啟動安裝在BIOS-MBR模式的 Windows (Vista, 7 or 8):
</p>
<pre>menuentry "Microsoft Windows 7 BIOS-MBR" {
    insmod part_msdos
    insmod ntfs
    insmod search_fs_uuid
    insmod ntldr     
    search --fs-uuid --no-floppy --set=root 69B235F6749E84CE
    ntldr /bootmgr
}</pre>
<p>For Windows XP:
</p>
<pre>menuentry "Microsoft Windows XP" {
    insmod part_msdos
    insmod ntfs
    insmod search_fs_uuid
    insmod ntldr     
    search --fs-uuid --no-floppy --set=root 69B235F6749E84CE
    ntldr /ntldr
}
</pre>
<h3>
<span id="UEFI.E7.B3.BB.E7.B5.B1.28UEFI_systems.29"></span><span class="mw-headline" id="UEFI系統(UEFI_systems)">UEFI系統(UEFI systems)</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 在閱讀這個部份前，建議先閱讀 <a href="/title/UEFI" class="mw-redirect" title="UEFI">UEFI</a>, <a href="/title/GPT" class="mw-redirect" title="GPT">GPT</a> and <a href="/title/Boot_loader" class="mw-redirect" title="Boot loader">Boot loader</a> 頁面</div>
<h4>
<span id=".E5.AE.89.E8.A3.9Dgrub-uefi.E5.A5.97.E4.BB.B6.28Install_grub-uefi_package.29"></span><span class="mw-headline" id="安裝grub-uefi套件(Install_grub-uefi_package)">安裝grub-uefi套件(Install grub-uefi package)</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Unless specified as EFI 1.x , EFI and UEFI terms are used interchangeably to denote UEFI 2.x firmware. Also unless stated explicitely, the instructions are general and not Mac specific. Some of them may not work or may be different in Macs. Apple's EFI implementation is neither a EFI 1.x version nor UEFI 2.x version but mixes up both. This kind of firmware does not fall under any one UEFI Specification version and is therefore not a standard UEFI firmware.</div>
<p>GRUB(2) UEFI bootloader is available in Arch Linux only from version 1.99~rc1. To install, first <a href="/title/Unified_Extensible_Firmware_Interface#Detecting_UEFI_Firmware_Arch" title="Unified Extensible Firmware Interface">detect which UEFI firmware arch</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> you have (either x86_64 or i386).
</p>
<p>Depending on that, install the appropriate package
</p>
<p>For 64-bit aka x86_64 UEFI firmware:
</p>
<pre># pacman -S grub-efi-x86_64
</pre>
<p>For 32-bit aka i386 UEFI firmware:
</p>
<pre># pacman -S grub-efi-i386
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Simply installing the package will not update the <code>core.efi</code> file and the GRUB(2) modules in the UEFI System Partition. You need to do this manually using <code>grub-install</code> as explained below.</div>
<h4>
<span id=".E5.AE.89.E8.A3.9Dgrub-uefi.E5.95.9F.E5.8B.95.E6.AA.94.E6.A1.88.28Install_grub-uefi_boot_files.29"></span><span class="mw-headline" id="安裝grub-uefi啟動檔案(Install_grub-uefi_boot_files)">安裝grub-uefi啟動檔案(Install grub-uefi boot files)</span>
</h4>
<h5><span class="mw-headline" id="Install_to_UEFI_SYSTEM_PARTITION">Install to UEFI SYSTEM PARTITION</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The below commands assume you are using <code>grub-efi-x86_64</code> (for <code>grub-efi-i386</code> replace <code>x86_64</code> with <code>i386</code> in the below commands).</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To do this, you need to boot using UEFI and not the BIOS. If you booted by just copying the ISO file to the USB drive, you will need to follow <a href="/title/UEFI#Create_UEFI_bootable_USB_from_ISO" class="mw-redirect" title="UEFI">this guide</a> or grub-install will show errors.</div>
<p>The UEFI system partition will need to be mounted at <code>/boot/efi/</code> for the GRUB(2) install script to detect it:
</p>
<pre># mkdir -p /boot/efi
# mount -t vfat /dev/sdXY /boot/efi
</pre>
<p>Install GRUB UEFI application to <code>/boot/efi/EFI/arch_grub</code> and its modules to <code>/boot/grub/x86_64-efi</code> (recommended) using:
</p>
<pre># modprobe dm-mod
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch_grub --recheck --debug
# mkdir -p /boot/grub/locale
# cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo /boot/grub/locale/en.mo
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Without <code>--target</code> or <code>--directory</code> option, grub-install cannot determine for which firmware grub(2) is being installed. In such cases grub-install will show <code>source_dir does not exist. Please specify --target or --directory</code> message.</div>
<p>If you want to install grub(2) modules and <code>grub.cfg</code> at the directory <code>/boot/efi/EFI/grub</code> and the <code>grubx64.efi</code> application at <code>/boot/efi/EFI/arch_grub</code> (ie. all the grub(2) uefi files inside the UEFISYS partition itself) use:
</p>
<pre># modprobe dm-mod 
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch_grub --boot-directory=/boot/efi/EFI --recheck --debug
# mkdir -p /boot/efi/EFI/grub/locale
# cp /usr/share/locale/en\@quot/LC_MESSAGES/grub.mo /boot/efi/EFI/grub/locale/en.mo
</pre>
<p>The <code>--efi-directory</code> option mentions the mountpoint of UEFI SYSTEM PARTITION , <code>--bootloader-id</code> mentions the name of the directory used to store the <code>grubx64.efi</code> file and <code>--boot-directory</code> mentions the directory wherein the actual modules will be installed (and into which <code>grub.cfg</code> should be created).
</p>
<p>The actual paths are:
</p>
<pre>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt;/grubx64.efi
</pre>
<pre>&lt;boot-directory&gt;/grub/x86_64-efi/&lt;all modules, grub.efi, core.efi, grub.cfg&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> the <code>--bootloader-id</code> option does not change <code>&lt;boot-directory&gt;/grub</code>, i.e. you cannot install the modules to <code>&lt;boot-directory&gt;/&lt;bootloader-id&gt;</code>, the path is hard-coded to be <code>&lt;boot-directory&gt;/grub</code>.</div>
<p>In <code>--efi-directory=/boot/efi --boot-directory=/boot/efi/EFI --bootloader-id=grub</code>:
</p>
<pre>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt; == &lt;boot-directory&gt;/grub == /boot/efi/EFI/grub
</pre>
<p>In <code>--efi-directory=/boot/efi --boot-directory=/boot/efi/EFI --bootloader-id=arch_grub</code>:
</p>
<pre>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt; == /boot/efi/EFI/arch_grub
&lt;boot-directory&gt;/grub == /boot/efi/EFI/grub
</pre>
<p>In <code>--efi-directory=/boot/efi --boot-directory=/boot --bootloader-id=arch_grub</code>:
</p>
<pre>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt; == /boot/efi/EFI/arch_grub
&lt;boot-directory&gt;/grub == /boot/grub
</pre>
<p>In <code>--efi-directory=/boot/efi --boot-directory=/boot --bootloader-id=grub</code>:
</p>
<pre>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt; == /boot/efi/EFI/grub
&lt;boot-directory&gt;/grub == /boot/grub
</pre>
<p>The <code>&lt;efi-directory&gt;/&lt;EFI or efi&gt;/&lt;bootloader-id&gt;/grubx64.efi</code> is an exact copy of <code>&lt;boot-directory&gt;/grub/x86_64-efi/core.efi</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> In GRUB2 2.00~beta4, the <code>grub-install</code> option <code>--efi-directory</code> replaces <code>--root-directory</code> and the latter is deprecated.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The options <code>--efi-directory</code> and <code>--bootloader-id</code> are specific to GRUB(2) UEFI.</div>
<p>In all the cases the UEFI SYSTEM PARTITION should be mounted for <code>grub-install</code> to install <code>grubx64.efi</code> in it, which will be launched by the firmware (using the <code>efibootmgr</code> created boot entry in non-Mac systems).
</p>
<p>If you notice carefully, there is no &lt;device_path&gt; option (Eg: <code>/dev/sda</code>) at the end of the <code>grub-install</code> command unlike the case of setting up GRUB(2) for BIOS systems. Any &lt;device_path&gt; provided will be ignored by the install script as UEFI bootloaders do not use MBR or Partition boot sectors at all.
</p>
<p>You may now be able to UEFI boot your system by creating a <code>grub.cfg</code> file by following <a href="#Generate_GRUB2_UEFI_Config_file">#Generate_GRUB2_UEFI_Config_file</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> and <a href="#Create_GRUB2_entry_in_the_Firmware_Boot_Manager">#Create GRUB2 entry in the Firmware Boot Manager</a>.
</p>
<h4><span class="mw-headline" id="Create_GRUB2_entry_in_the_Firmware_Boot_Manager">Create GRUB2 entry in the Firmware Boot Manager</span></h4>
<h5><span class="mw-headline" id="Non-Mac_UEFI_systems">Non-Mac UEFI systems</span></h5>
<p><code>grub-install</code> will ensure that <code>/boot/efi/EFI/arch_grub/grubx64.efi</code> is launched by default if it detects <code>efibootmgr</code> and if it is able to access UEFI Runtime Services. Follow <a href="/title/Unified_Extensible_Firmware_Interface#efibootmgr" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#efibootmgr</a> for more info.(Before trying these steps, be sure to create a grub.cfg (<a href="/title/Grub2#Generate_GRUB2_UEFI_Config_file" class="mw-redirect" title="Grub2">Grub2#Generate_GRUB2_UEFI_Config_file</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>) because you will need it to boot into Arch after grub is loaded)
</p>
<p>If you have problems running GRUB2 in UEFI mode you can try the following (worked on an ASUS Z68 mainboard):
</p>
<pre># cp /boot/efi/EFI/arch_grub/grubx64.efi /boot/efi/shellx64.efi
</pre>
<p>or
</p>
<pre># cp /boot/efi/EFI/arch_grub/grubx64.efi /boot/efi/EFI/shellx64.efi
</pre>
<p>or
</p>
<pre># cp /boot/efi/EFI/arch_grub/grubx64.efi /boot/efi/EFI/tools/shellx64.efi
</pre>
<p>After this launch the UEFI Shell from the UEFI setup/menu (in ASUS UEFI BIOS, switch to advanced mode, press Exit in the top right corner and choose "Launch EFI shell from filesystem device"). The GRUB2 menu will show up and you can boot into your system. Afterwards you can use efibootmgr to setup a menu entry (see above).
</p>
<p>If your motherboard has no such option (or even if it does), you can use UEFI shell (<a href="/title/Unified_Extensible_Firmware_Interface#UEFI_Shell" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface#UEFI Shell</a>) to create a UEFI boot option for the Arch partition temporarily.
</p>
<p>Once you boot into the EFI shell, add a UEFI boot menu entry:
</p>
<pre>Shell&gt; bcfg boot add 0 fs1:\EFI\arch_grub\grubx64.efi "Arch Linux (GRUB2)"
</pre>
<p>where <code>fs1</code> is the mapping corresponding to the UEFI System Partition and <code>\EFI\arch_grub\grubx64.efi</code> is the the from the <code>--bootloader-id</code> from the <code>grub-install</code> command above.
</p>
<p>This will temporarily add a UEFI boot option for the next boot to get into Arch.
</p>
<p>Once in Arch, modprobe <code>efivars</code> and confirm that <code>efibootmgr</code> creates no errors (no errors meaning you successfully booted in UEFI mode).
</p>
<p>Then <a href="/title/Grub2#Install_to_UEFI_SYSTEM_PARTITION" class="mw-redirect" title="Grub2">Grub2#Install_to_UEFI_SYSTEM_PARTITION</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> can be performed again and should successfully permanently add a boot entry in the UEFI menu.
</p>
<h5><span class="mw-headline" id="Apple_Mac_EFI_systems">Apple Mac EFI systems</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> TODO: GRUB upstream Bazaar mactel branch <a rel="nofollow" class="external free" href="http://bzr.savannah.gnu.org/lh/grub/branches/mactel/changes">http://bzr.savannah.gnu.org/lh/grub/branches/mactel/changes</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2020-08-02 ⓘ]</sup>. No further update from grub developers.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> TODO: Experimental "bless" utility for Linux by Fedora developers - <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mactel-boot/">mactel-boot</a></span><sup><small>AUR</small></sup>. Requires more testing.</div>
<p>Use bless command from within Mac OS X to set <code>grubx64.efi</code> as the default boot option. You can also boot from the Mac OS X install disc and launch a Terminal there if you only have Linux installed. In the Terminal, create a directory and mount the EFI System Partition:
</p>
<pre># cd /Volumes
# mkdir efi
# mount -t msdos /dev/disk0s1 /Volumes/efi
</pre>
<p>Then run bless on <code>grub.efi</code> and on the EFI partition to set them as the default boot options.
</p>
<pre># bless --folder=/Volumes/efi --file=/Volumes/efi/efi/arch_grub/grubx64.efi --setBoot
# bless --mount=/Volumes/efi --file=/Volumes/efi/efi/arch_grub/grubx64.efi --setBoot
</pre>
<p>More info at <a rel="nofollow" class="external free" href="https://help.ubuntu.com/community/UEFIBooting#Apple_Mac_EFI_systems_.28both_EFI_architecture.29">https://help.ubuntu.com/community/UEFIBooting#Apple_Mac_EFI_systems_.28both_EFI_architecture.29</a>.
</p>
<h4>
<span id=".E7.94.A2.E7.94.9FGRUB2_UEFI.E8.A8.AD.E7.BD.AE.E6.AA.94.E6.A1.88.28Generate_GRUB2_UEFI_Config_file.29"></span><span class="mw-headline" id="產生GRUB2_UEFI設置檔案(Generate_GRUB2_UEFI_Config_file)">產生GRUB2 UEFI設置檔案(Generate GRUB2 UEFI Config file)</span>
</h4>
<p>Finally, generate a configuration for GRUB(2) (this is explained in greater detail in the Configuration section):
</p>
<pre># grub-mkconfig -o &lt;boot-directory&gt;/grub/grub.cfg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The file path is <code>&lt;boot-directory&gt;/grub/grub.cfg</code>, NOT <code>&lt;boot-directory&gt;/grub/x86_64-efi/grub.cfg</code>.</div>
<p>If you used <code>--boot-directory=/boot</code>:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>If you used <code>--boot-directory=/boot/efi/EFI</code>:
</p>
<pre># grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg
</pre>
<p>This is independent of the value of <code>--bootloader-id</code> option.
</p>
<p>If GRUB2 complains about "no suitable mode found" while booting, try <a href="#Correct_GRUB2_No_Suitable_Mode_Found_Error">#Correct GRUB2 No Suitable Mode Found Error</a>.
</p>
<h4><span class="mw-headline" id="Create_GRUB2_Standalone_UEFI_Application">Create GRUB2 Standalone UEFI Application</span></h4>
<p>It is possible to create a <code>grubx64_standalone.efi</code> application which has all the modules embeddded in a memdisk within the uefi application, thus removing the need for having a separate directory populated with all the GRUB2 uefi modules and other related files. This is done using the <code>grub-mkstandalone</code> command which is included in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-common">grub-common</a></span><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span>]</sup> &gt;= 1:1.99-6 package.
</p>
<p>The easiest way to do this would be with the install command already mentioned before, but specifying the modules to include. For example:
</p>
<pre># grub-mkstandalone --directory="/usr/lib/grub/x86_64-efi/" --format="x86_64-efi" --compression="xz" \
--output="/boot/efi/EFI/arch_grub/grubx64_standalone.efi" &lt;any extra files you want to include&gt;
</pre>
<p>The <code>grubx64_standalone.efi</code> file expects <code>grub.cfg</code> to be within its $prefix which is <code>(memdisk)/boot/grub</code>. The memdisk is embedded within the efi app. The <code>grub-mkstandlone</code> script allow passing files to be included in the memdisk image to be as the arguments to the script (in &lt;any extra files you want to include&gt;).
</p>
<p>If you have the <code>grub.cfg</code> at <code>/home/user/Desktop/grub.cfg</code>, then create a temporary <code>/home/user/Desktop/boot/grub/</code> directory, copy the <code>/home/user/Desktop/grub.cfg</code> to <code>/home/user/Desktop/boot/grub/grub.cfg</code>, cd into <code>/home/user/Desktop/boot/grub/</code> and run:
</p>
<pre># grub-mkstandalone --directory="/usr/lib/grub/x86_64-efi/" --format="x86_64-efi" --compression="xz" \
--output="/boot/efi/EFI/arch_grub/grubx64_standalone.efi" "boot/grub/grub.cfg"
</pre>
<p>The reason to cd into <code>/home/user/Desktop/boot/grub/</code> and to pass the file path as <code>boot/grub/grub.cfg</code> (notice the lack of a leading slash - boot/ vs /boot/ ) is because <code>dir1/dir2/file</code> is included as <code>(memdisk)/dir1/dir2/file</code> by the <code>grub-mkstandalone</code> script. 
</p>
<p>If you pass <code>/home/user/Desktop/grub.cfg</code> the file will be included as <code>(memdisk)/home/user/Desktop/grub.cfg</code>. If you pass <code>/home/user/Desktop/boot/grub/grub.cfg</code> the file will be included as <code>(memdisk)/home/user/Desktop/boot/grub/grub.cfg</code>. That is the reason for cd'ing into <code>/home/user/Desktop/boot/grub/</code> and passing <code>boot/grub/grub.cfg</code>, to include the file as <code>(memdisk)/boot/grub/grub.cfg</code>, which is what <code>grub.efi</code> expects the file to be.
</p>
<p>You need to create an UEFI Boot Manager entry for <code>/boot/efi/EFI/arch_grub/grubx64_standalone.efi</code> using <code>efibootmgr</code>. Follow <a href="#Create_GRUB2_entry_in_the_Firmware_Boot_Manager">#Create GRUB2 entry in the Firmware Boot Manager</a>.
</p>
<h4><span class="mw-headline" id="Multiboot_in_UEFI">Multiboot in UEFI</span></h4>
<h5><span class="mw-headline" id="Chainload_Microsoft_Windows_x86_64_UEFI-GPT">Chainload Microsoft Windows x86_64 UEFI-GPT</span></h5>
<p>Find the UUID of the FAT32 filesystem in the UEFI SYSTEM PARTITION where the Windows UEFI Bootloader files reside. For example, if Windows <code>bootmgfw.efi</code> exists at <code>/boot/efi/EFI/Microsoft/Boot/bootmgfw.efi</code> (ignore the upper-lower case differences since that is immaterial in FAT filesystem):
</p>
<pre># grub-probe --target=fs_uuid /boot/efi/EFI/Microsoft/Boot/bootmgfw.efi
1ce5-7f28
</pre>
<pre># grub-probe --target=hints_string /boot/efi/EFI/Microsoft/Boot/bootmgfw.efi
--hint-bios=hd0,gpt1 --hint-efi=hd0,gpt1 --hint-baremetal=ahci0,gpt1
</pre>
<p>Then, add this code to <code>/boot/grub/grub.cfg</code> OR <code>/boot/efi/EFI/grub/grub.cfg</code> to chainload Windows x86_64 (Vista SP1+, 7 or 8) installed in UEFI-GPT mode:
</p>
<pre>menuentry "Microsoft Windows x86_64 UEFI-GPT" {
    insmod part_gpt
    insmod fat
    insmod search_fs_uuid
    insmod chain
    search --fs-uuid --no-floppy --set=root --hint-bios=hd0,gpt1 --hint-efi=hd0,gpt1 --hint-baremetal=ahci0,gpt1 1ce5-7f28
    chainloader /efi/Microsoft/Boot/bootmgfw.efi
}
</pre>
<h2>
<span id=".E8.A8.AD.E7.BD.AE.28Configuration.29"></span><span class="mw-headline" id="設置(Configuration)">設置(Configuration)</span>
</h2>
<p>你可以選擇自動產生或手動編輯 <code>grub.cfg</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 對 EFI 系統, 如果 GRUB2 是以 <code>--boot-directory</code> 參數安裝,  <code>grub.cfg</code> 檔案將被放在跟 <code>grubx64.efi</code>相同的路徑. 否則,  <code>grub.cfg</code> 這檔案將會放在 <code>/boot/grub/</code>, 這點跟 GRUB2的BIOS版本是一樣的.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 這裡對於如何配置GRUB2有相當完整的敘述: <a rel="nofollow" class="external free" href="https://web.archive.org/web/20160630080118/http://members.iinet.net/~herman546/p20/GRUB2%20Configuration%20File%20Commands.html">https://web.archive.org/web/20160630080118/http://members.iinet.net/~herman546/p20/GRUB2%20Configuration%20File%20Commands.html</a> </div>
<h3>
<span id=".E4.BD.BF.E7.94.A8grub-mkconfig.E8.87.AA.E5.8B.95.E7.94.A2.E7.94.9F.28Automatically_generating_using_grub-mkconfig.29_.28Recommended.29"></span><span class="mw-headline" id="使用grub-mkconfig自動產生(Automatically_generating_using_grub-mkconfig)_(Recommended)">使用grub-mkconfig自動產生(Automatically generating using grub-mkconfig) (Recommended)</span>
</h3>
<p>在 GRUB2中<code>/etc/default/grub</code> 和 <code>/etc/grub.d/*</code>，與舊版的GRUB的 <code>menu.lst</code> 有相似的設置效果，  <code>grub-mkconfig</code> 預設利用這些檔案產生標準的<code>grub.cfg</code>輸出. 產生 <code>grub.cfg</code> 檔案可以執行指令:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p><code>/etc/grub.d/10_linux</code> is set to automatically add menu items for Arch linux that work out of the box, to any generated configuration. 其他的作業系統也許需要手動配置到 <code>/etc/grub.d/40_custom</code> 或 <code>/boot/grub/custom.cfg</code>
</p>
<h4><span class="mw-headline" id="Additional_arguments">Additional arguments</span></h4>
<p>To pass custom additional arguments to the Linux image, you can set the <code>GRUB_CMDLINE_LINUX</code> variable in <code>/etc/default/grub</code>. This is analogous to adding commands to the kernel line in GRUB Legacy.
</p>
<p>For example, use <code>GRUB_CMDLINE_LINUX="resume=/dev/sdaX"</code> where <code>sda<b>X</b></code> is your swap partition to enable resume after hibernation.
</p>
<p>You can also use <code>GRUB_CMDLINE_LINUX="resume=/dev/disk/by-uuid/${swap_uuid}"</code>, where <code>${swap_uuid} </code> is the <a href="/title/Persistent_block_device_naming" title="Persistent block device naming">UUID</a> of your swap partition.
</p>
<p>Users who have replaced the default SysV init with <a href="/title/Systemd" title="Systemd">systemd</a> will want to add <code>init=/bin/systemd</code> to their <code>GRUB_CMDLINE_LINUX</code>.
</p>
<p>Multiple entries are separated by spaces within the double quotes.  So, for users who want both resume and systemd it would look like this:
<code>GRUB_CMDLINE_LINUX="resume=/dev/sdaX init=/bin/systemd"</code>
</p>
<h3>
<span id=".E6.89.8B.E5.8B.95.E5.89.B5.E5.BB.BAgrub.cfg.28_Manually_creating_grub.cfg.29"></span><span class="mw-headline" id="手動創建grub.cfg(_Manually_creating_grub.cfg)">手動創建grub.cfg( Manually creating grub.cfg)</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 直接對這個檔案進行編輯是不建議的事.這個檔案是用 <code>grub-mkconfig</code> 產生,所以最好是編輯你的  <code>/etc/default/grub</code> 或其他在 <code>/etc/grub.d</code> 資料夾的script.</div>
<p>一個基本的 GRUB 設置檔使用下列的選項
</p>
<ul>
<li>
<code>(hdX,Y)</code> 意味在硬碟<code>X</code>中的分割區 <code>Y</code>  , 分割區的編號從1開始，硬碟編號從0開始。</li>
<li>
<code>set default=N</code> is the default boot entry that is chosen after timeout for user action</li>
<li>
<code>set timeout=M</code> 意謂用 <code>M</code>秒鐘的時間等待使用者動作，否則啟動預設選項。</li>
<li>
<code>menuentry "title" {entry options}</code> 是啟動項目名稱 <code>title</code>
</li>
<li>
<code>set root=(hdX,Y)</code> 設置啟動分割區, 此分割區應有核心和GRUB模組 (boot need not be a separate partition, and may simply be a directory under the "root" partition (<code>/</code>)</li>
</ul>
<p>一個設置範例:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg
</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Config file for GRUB2 - The GNU GRand Unified Bootloader
# /boot/grub/grub.cfg

# DEVICE NAME CONVERSIONS
#
#  Linux           Grub
# -------------------------
#  /dev/fd0        (fd0)
#  /dev/sda        (hd0)
#  /dev/sdb2       (hd1,2)
#  /dev/sda3       (hd0,3)
#

# Timeout for menu
set timeout=5

# Set default boot entry as Entry 0
set default=0

# (0) Arch Linux
menuentry "Arch Linux" {
    set root=(hd0,1)
    linux /vmlinuz-linux root=/dev/sda3 ro
    initrd /initramfs-linux.img
}

## (1) Windows
#menuentry "Windows" {
#set root=(hd0,3)
#chainloader +1
#}
</pre>
<h3>
<span id=".E9.9B.99.E5.95.9F.E5.8B.95.28dual-boot.29"></span><span class="mw-headline" id="雙啟動(dual-boot)">雙啟動(dual-boot)</span>
</h3>
<p><i>注意: 如果你希望 GRUB2 自動尋找其他的作業系統(舉例來說，像是ubuntu).那麼你可能需要從<a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a>下載並安裝 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=os-prober">os-prober</a></span> </i>
</p>
<h4>
<span id=".E4.BD.BF.E7.94.A8_grub-mkconfig"></span><span class="mw-headline" id="使用_grub-mkconfig">使用 grub-mkconfig</span>
</h4>
<p>想增加其他啟動項目，最好的方法是編輯 <code>/etc/grub.d/40_custom</code>或{ic|/boot/grub/custom.cfg}} . 如此一來，項目將在你執行 <b>grub-mkconfig</b>後自動加入。
加入新的內容,執行 
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg 
</pre>
<p>以產生一個新的 <code>grub.cfg</code>和grub選單。
</p>
<h5>
<span id=".E8.88.87_GNU.2FLinux"></span><span class="mw-headline" id="與_GNU/Linux">與 GNU/Linux</span>
</h5>
<p>假設其他的 distro 在分割區 <code>sda2</code>:
</p>
<pre>menuentry "Other Linux" {
set root=(hd0,2)
linux /boot/vmlinuz (add other options here as required)
initrd /boot/initrd.img (if the other kernel uses/needs one)
}
</pre>
<h5>
<span id=".E8.88.87_FreeBSD"></span><span class="mw-headline" id="與_FreeBSD">與 FreeBSD</span>
</h5>
<p>Requires that FreeBSD is installed on a single partition with UFS. 假如安裝在<code>sda4</code>:
</p>
<pre>menuentry "FreeBSD" {
set root=(hd0,4)
chainloader +1
}
</pre>
<h5>
<span id=".E8.88.87_Windows"></span><span class="mw-headline" id="與_Windows">與 Windows</span>
</h5>
<p>假設你的 Windows 分割區是 <code>sda3</code>Remember you need to point set root and chainloader to the system reserve partition that windows made when it installed, not the actual partition windows is on..在{{ic|/etc/grub.d/40_custom})加入
</p>
<pre># (2) Windows XP
menuentry "Windows XP" {
    set root=(hd0,3)
    chainloader (hd0,3)+1
}
</pre>
<p>執行 
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg 
</pre>
<p>以產生一個新的 <code>grub.cfg</code>和grub選單。
</p>
<p>If the Windows bootloader is on an entirely different hard drive than GRUB, it may be necessary to trick Windows into believing that it is the first hard drive. This was possible in GRUB Legacy with <code>map</code> and is now done with <code>drivemap</code>. Assuming GRUB is on <code>hd0</code> and Windows is on <code>hd2</code>, you need to add the following after <code>set root</code>:
</p>
<pre>drivemap -s hd0 hd2
</pre>
<h4><span class="mw-headline" id="With_Windows_via_EasyBCD_and_NeoGRUB">With Windows via EasyBCD and NeoGRUB</span></h4>
<p>Since EasyBCD's NeoGRUB currently does not understand the GRUB2 menu format, chainload to it by replacing the contents of your <code>C:\NST\menu.lst</code> file with lines similar to the following:
</p>
<pre>default 0
timeout 1
</pre>
<pre>title       Chainload into GRUB v2
root        (hd0,7)
kernel      /boot/grub/i386-pc/core.img
</pre>
<h3><span class="mw-headline" id="Visual_Configuration">Visual Configuration</span></h3>
<p>In GRUB2 it is possible, by default, to change the look of the menu. Make sure to initialize, if not done already, GRUB2 graphical terminal, gfxterm, with proper video mode, gfxmode, in GRUB2. This can be seen in the section <a href="#Correct_GRUB2_No_Suitable_Mode_Found_Error">#Correct GRUB2 No Suitable Mode Found Error</a>. This video mode is passed by GRUB2 to the linux kernel via 'gfxpayload' so any visual configurations need this mode in order to be in effect.
</p>
<h4><span class="mw-headline" id="Setting_the_framebuffer_resolution">Setting the framebuffer resolution</span></h4>
<p>GRUB2 can set the framebuffer for both GRUB2 itself and the kernel. The old <code>vga=</code> way is deprecated. The preferred method is editing <code>/etc/default/grub</code> as the following sample:
</p>
<pre>GRUB_GFXMODE=1024x768x32
GRUB_GFXPAYLOAD_LINUX=keep
</pre>
<p>套用改變, 執行: 
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>The <code>gfxpayload</code> property will make sure the kernel keeps the resolution.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果這個例子對你以<code>vbemode="0x105"</code>置換<code>gfxmode="1024x768x32"</code>沒有成功. Remember to replace the specified resolution with one suitable for your screen.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 你可以使用 <code># hwinfo --framebuffer</code>來顯示出所有的模式 (hwinfo is available in [community]), while at GRUB2 prompt you can use the <code>vbeinfo</code> command.</div>
<p>If this method does not work for you, the deprecated <code>vga=</code> method will still work. Just
add it next to the <code>"GRUB_CMDLINE_LINUX_DEFAULT="</code> line in <code>/etc/default/grub</code>
for eg: <code>"GRUB_CMDLINE_LINUX_DEFAULT="quiet splash vga=792"</code> will give you a <code>1024x768</code> resolution.
</p>
<p>You can choose one of these resolutions: <code>640×480</code>, <code>800×600</code>, <code>1024×768</code>, <code>1280×1024</code>,<code>1600×1200</code>, <code>1920×1200</code>
</p>
<h4><span class="mw-headline" id="915resolution_hack">915resolution hack</span></h4>
<p>Some times for Intel graphic adapters neither <code># hwinfo --framebuffer</code> nor <code>vbeinfo</code> will show you the desired resolution. In this case you can use <code>915resolution</code> hack. This hack will temporarily modify video BIOS and add needed resolution. See <a rel="nofollow" class="external text" href="http://915resolution.mango-lang.org/">915resolution's home page</a>
</p>
<p>In the following I will proceed with the example for my system. Please adjust the recipe for your needs. First you need to find a video mode which will be modified later. For that, run <code>915resolution</code> in GRUB2 command shell:
</p>
<pre>915resolution -l
</pre>
<p>The output will be something like:
</p>
<pre>Intel 800/900 Series VBIOS Hack : version 0.5.3
...
Mode 30 : 640x480, 8 bits/pixel
...
</pre>
<p>Next, our purpose is to overwrite mode 30. (You can choose what ever mode you want.) In the file <code>/etc/grub.d/00_header</code> just before the <code>set gfxmode=${GRUB_GFXMODE</code>} line insert:
</p>
<pre>915resolution 30 1440 900
</pre>
<p>Here we are overwriting the mode <code>30</code> with <code>1440x900</code> resolution. Lastly we need to set <code>GRUB_GFXMODE</code> as described earlier, regenerate GRUB2 configuration file and reboot to test changes:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
# reboot
</pre>
<h4>
<span id=".E8.83.8C.E6.99.AF.E5.9C.96.E7.89.87.E5.92.8C.E5.AD.97.E9.AB.94.28Background_image_and_bitmap_fonts.29"></span><span class="mw-headline" id="背景圖片和字體(Background_image_and_bitmap_fonts)">背景圖片和字體(Background image and bitmap fonts)</span>
</h4>
<p>GRUB2 comes with support for background images and bitmap fonts in <code>pf2</code> format. The unifont font is included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-common">grub-common</a></span><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span>]</sup> package under the filename <code>unicode.pf2</code>, or, as only ASCII characters under the name <code>ascii.pf2</code>.
</p>
<p>圖像支援格式有 tga, png and jpeg. 解析度最大支援取決於您的硬體.
</p>
<p>Make sure you have set up the proper <a href="/title/GRUB2#Setting_the_framebuffer_resolution" class="mw-redirect" title="GRUB2">framebuffer resolution</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.
</p>
<p>編輯 <code>/etc/default/grub</code> :
</p>
<pre>GRUB_BACKGROUND="/boot/grub/myimage"
#GRUB_THEME="/path/to/gfxtheme"
GRUB_FONT="/path/to/font.pf2"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果你將GRUB裝在分開的分割區, <code>/boot/grub/myimage</code> 會變成 <code>/grub/myimage</code>.</div>
<p>套用改變且將新資訊加到 <code>grub.cfg</code>, 執行: 
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>如果成功加入背景圖, 使用者將在終端機看到 <code>"Found background image..."</code> . 
如果沒看到這段敘述, 圖像資訊可能沒有成功加到 <code>grub.cfg</code> 裡.
</p>
<p>如果圖片沒有顯示, 進行確認:
</p>
<ul>
<li>在 <code>/etc/default/grub</code>的圖片路徑跟檔名都是正確的.</li>
<li>圖片的格式跟大小是正確的 (tga, png, 8-bit jpg).</li>
<li>The image was saved in the RGB mode, and is not indexed.</li>
<li>console mode 沒有啟用在 <code>/etc/default/grub</code>裡.</li>
<li>
<code>grub-mkconfig</code> 確實執行並將背景圖片資訊放到 <code>/boot/grub/grub.cfg</code> 裡.</li>
</ul>
<h4>
<span id=".E4.BD.88.E6.99.AF.E4.B8.BB.E9.A1.8C.28Theme.29"></span><span class="mw-headline" id="佈景主題(Theme)">佈景主題(Theme)</span>
</h4>
<p>Here is an example for configuring Starfield theme which was included in GRUB2 package.
</p>
<p>Edit <code>/etc/default/grub</code>
</p>
<pre>GRUB_THEME="/usr/share/grub/themes/starfield/theme.txt"
</pre>
<p>Generate the changes:
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>如果主題設定成功, 您將會在終端機看到 <code>Found theme: /usr/share/grub/themes/starfield/theme.txt</code> 
使用主題時，你原先設定的 splash image 將不會被顯示出來
</p>
<h4>
<span id=".E9.81.B8.E5.96.AE.E9.A1.8F.E8.89.B2.28Menu_colors.29"></span><span class="mw-headline" id="選單顏色(Menu_colors)">選單顏色(Menu colors)</span>
</h4>
<p>如同 GRUB 舊版 (0.9x), 在 GRUB2你可以更改選單顏色. 目前可用的顏色 GRUB2 參照 <a rel="nofollow" class="external free" href="https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html#Theme-file-format">https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html#Theme-file-format</a>.
這裡有個範例:
</p>
<p>編輯 <code>/etc/default/grub</code>:
</p>
<pre>GRUB_COLOR_NORMAL="light-blue/black"
GRUB_COLOR_HIGHLIGHT="light-cyan/blue"
</pre>
<p>套用變更:
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h4>
<span id=".E9.9A.B1.E8.97.8F.E9.81.B8.E5.96.AE.28Hidden_menu.29"></span><span class="mw-headline" id="隱藏選單(Hidden_menu)">隱藏選單(Hidden menu)</span>
</h4>
<p>One of the unique features of GRUB2 is hiding/skipping the menu and showing it by holding <code>Esc</code> when needed. You can also adjust whether you want to see the timeout counter.
</p>
<p>Edit <code>/etc/default/grub</code> as you wish. Here is an example where the comments from the beginning of the two lines have been removed to enable the feature, the timeout has been set to five seconds and to be shown to the user:
</p>
<pre>GRUB_HIDDEN_TIMEOUT=5
GRUB_HIDDEN_TIMEOUT_QUIET=false
</pre>
<p>接者執行:
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h4>
<span id=".E9.97.9C.E9.96.89.E5.B9.80.E7.B7.A9.E8.A1.9D.28Disable_framebuffer.29"></span><span class="mw-headline" id="關閉幀緩衝(Disable_framebuffer)">關閉幀緩衝(Disable framebuffer)</span>
</h4>
<p>Users who use NVIDIA proprietary driver might wish to disable GRUB2's framebuffer as it can cause problems with the binary driver.
</p>
<p>要關閉幀緩衝, 編輯 <code>/etc/default/grub</code> 並將下行取消註解:
</p>
<pre>GRUB_TERMINAL_OUTPUT=console
</pre>
<p>接著執行:
</p>
<pre>grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3>
<span id=".E5.85.B6.E4.BB.96.E9.81.B8.E9.A0.85.28Other_Options.29"></span><span class="mw-headline" id="其他選項(Other_Options)">其他選項(Other Options)</span>
</h3>
<h4><span class="mw-headline" id="LVM">LVM</span></h4>
<p>If you use <a href="/title/LVM" title="LVM">LVM</a> for your <code>/boot</code>, add the following before menuentry lines:
</p>
<pre>insmod lvm
</pre>
<p>and specify your root in the menuentry as:
</p>
<pre>set root=(<i>lvm_group_name</i>-<i>lvm_logical_boot_partition_name</i>)
</pre>
<p>Example:
</p>
<pre># (0) Arch Linux
menuentry "Arch Linux" {
insmod lvm
set root=(VolumeGroup-lv_boot)
# you can only set following two lines
linux /vmlinuz-linux root=/dev/mapper/VolumeGroup-root ro
initrd /initramfs-linux.img
}
</pre>
<h4><span class="mw-headline" id="RAID">RAID</span></h4>
<p>GRUB2 provides convenient handling of RAID volumes. You need to add <code>insmod raid</code> which allows you to address the volume natively. For example, <code>/dev/md0</code> becomes:
</p>
<pre>set root=(md0)
</pre>
<p>whereas a partitioned RAID volume (e.g. <code>/dev/md0p1</code>) becomes:
</p>
<pre>set root=(md0,1)
</pre>
<h4><span class="mw-headline" id="Persistent_block_device_naming">Persistent block device naming</span></h4>
<p>You can use UUIDs to detect partitions instead of the "old" <code>/dev/sd*</code> and <code>/dev/hd*</code> scheming. It has the advantage of detecting partitions by their unique UUIDs, which is needed by some people booting with complicated partition setups.
</p>
<p>UUIDs are used by default in the recent versions of GRUB2 - there is no downside in it anyway except that you need to re-generate the <code>grub.cfg</code> file every time you resize or reformat your partitions. Remember this when modifying partitions with Live-CD.
</p>
<p>Recent versions of GRUB2 use UUIDs by default. You can enable the use of UUIDs by simply commenting the UUID line (which is the default):
</p>
<pre>#GRUB_DISABLE_LINUX_UUID=true
</pre>
<p>Or you can uncomment it and set the value to <code>false</code>:
</p>
<pre>GRUB_DISABLE_LINUX_UUID=false
</pre>
<p>Either way, do not forget to generate the changes:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg</pre>
<h4><span class="mw-headline" id="Using_Labels">Using Labels</span></h4>
<p>It is possible to use labels, human-readable strings attached to filesystems, by using the <code>--label</code> option to <code>search</code>. First of all, label your existing partition:
</p>
<pre># tune2fs -L a &lt;LABEL&gt; &lt;PARTITION&gt;
</pre>
<p>Then, add an entry using labels. An example of this:
</p>
<pre>menuentry "Arch Linux, session texte" {
    search --label --no-floppy --set=root archroot
    linux /boot/vmlinuz-linux root=/dev/disk/by-label/archroot ro
    initrd /boot/initramfs-linux.img
}
</pre>
<h4><span class="mw-headline" id="Recall_previous_entry">Recall previous entry</span></h4>
<p>GRUB2 can remember the last entry you booted from and use this as the default entry to boot from next time. This is useful if you have multiple kernels (i.e., the current Arch one and the LTS kernel as a fallback option) or operating systems. To do this, edit <code>/etc/default/grub</code> and change the setting of <code>GRUB_DEFAULT</code>:
</p>
<pre>GRUB_DEFAULT=saved
</pre>
<p>This ensures that GRUB will default to the saved entry. To enable saving the selected entry, add the following line to <code>/etc/default/grub</code>:
</p>
<pre>GRUB_SAVEDEFAULT=true
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Manually added menu items, eg Windows in <code>/etc/grub.d/40_custom</code> or <code>/boot/grub/custom.cfg</code> , will need <code>savedefault</code> added. Remember to regenerate your configuration file.</div>
<h4>
<span id=".E5.AE.89.E5.85.A8.28Security.29"></span><span class="mw-headline" id="安全(Security)">安全(Security)</span>
</h4>
<p>如果你想增加 GRUB2的安全性，使其他人不能改變啟動參數跟使用命令列,你可以加上一個 user/password 組合到 GRUB2的設置檔案. 如果像這樣做的話, 執行指令 <code>grub-mkpasswd-pbkdf2</code>. 輸入密碼且確認它. 螢幕輸入將會像是這樣:
</p>
<pre>Your PBKDF2 is grub.pbkdf2.sha512.10000.C8ABD3E93C4DFC83138B0C7A3D719BC650E6234310DA069E6FDB0DD4156313DA3D0D9BFFC2846C21D5A2DDA515114CF6378F8A064C94198D0618E70D23717E82.509BFA8A4217EAD0B33C87432524C0B6B64B34FBAD22D3E6E6874D9B101996C5F98AB1746FE7C7199147ECF4ABD8661C222EEEDB7D14A843261FFF2C07B1269A</pre>
<p>Then, add the following to <code>/etc/grub.d/00_header</code>:
</p>
<pre>cat &lt;&lt; EOF

set superusers="username"
password_pbkdf2 username &lt;password&gt;

EOF</pre>
<p>這裡的 <code>&lt;password&gt;</code> 是由 <code>grub-mkpasswd_pbkdf2</code>產生的字串.
</p>
<p>再次產生你的設置檔案， 您的 GRUB2 命令列, 啟動參數和所有的啟動項目都將被保護。
</p>
<p>This can be relaxed and further customized with more users as described in the "Security" part of <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/grub.html#Security">the GRUB manual</a>.
</p>
<h4><span class="mw-headline" id="Root_Encryption">Root Encryption</span></h4>
<p>To let GRUB2 automatically add the kernel parameters for root encryption,
add <code>cryptdevice=/dev/yourdevice:label</code> to <code>GRUB_CMDLINE_LINUX</code> in <code>/etc/default/grub</code>.
</p>
<p>Example with root mapped to <code>/dev/mapper/root</code>:
</p>
<pre>GRUB_CMDLINE_LINUX="cryptdevice=/dev/sda2:root"
</pre>
<p>Also, disable the usage of UUIDs for the rootfs:
</p>
<pre>GRUB_DISABLE_LINUX_UUID=true
</pre>
<p>Regenerate the configuration.
</p>
<h3>
<span id=".E5.9C.A8GRUB2.E5.95.9F.E5.8B.95.28ISOBooting_an_ISO_Directly_From_GRUB2.29"></span><span class="mw-headline" id="在GRUB2啟動(ISOBooting_an_ISO_Directly_From_GRUB2)">在GRUB2啟動(ISOBooting an ISO Directly From GRUB2)</span>
</h3>
<p>編輯 <code>/etc/grub.d/40_custom</code> 或 <code>/boot/grub/custom.cfg</code> 為目標ISO增加項目。完成後<code>grub-mkconfig -o /boot/grub/grub.cfg</code> (as root)更新選單。
</p>
<h4><span class="mw-headline" id="Arch_ISO">Arch ISO</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 一定要調整第3行的 <code>hdX,Y</code> ，才能指向ISO檔正確所在的硬碟/分割區。 同時調整 <code>img_dev</code> 行來對應到相同的位置。 像是, 如果電腦裡已有一個內置硬碟，此時想從隨身碟開啟ISO檔，那麼用<code>sdbY</code>取代 <code>sdaY</code>.</div>
<pre>menuentry "Archlinux-2011.08.19-netinstall-x86_64.iso" {
    set isofile="/archives/archlinux-2011.08.19-netinstall-x86_64.iso"
    loopback loop (hd0,7)$isofile
    linux (loop)/arch/boot/x86_64/vmlinuz archisolabel=ARCH_201108 img_dev=/dev/sda7 img_loop=$isofile earlymodules=loop
    initrd (loop)/arch/boot/x86_64/archiso.img
}
</pre>
<pre>menuentry "Archlinux-2012.07.15-netinstall-dual.iso" {
    set isofile="/archives/archlinux-2012.07.15-netinstall-dual.iso"
    loopback loop (hd0,7)$isofile
    linux (loop)/arch/boot/x86_64/vmlinuz archisolabel=ARCH_201207 img_dev=/dev/sda7 img_loop=$isofile
    initrd (loop)/arch/boot/x86_64/archiso.img
}
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> For thumbdrives, use <a href="/title/Persistent_block_device_naming" title="Persistent block device naming">Persistent block device names</a> for the "img_dev" kernel parameter. <b>Ex:</b> img_dev=/dev/disk/by-label/CORSAIR</div>
<h4><span class="mw-headline" id="Ubuntu_ISO">Ubuntu ISO</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 一定要調整第3行的 <code>hdX,Y</code> ，才能指向ISO檔正確所在的硬碟/分割區。 同時調整 <code>img_dev</code> 行來對應到相同的位置。</div>
<pre>menuentry "ubuntu-12.04-desktop-amd64.iso" {
    set isofile="/path/to/ubuntu-12.04-desktop-amd64.iso"
    loopback loop (hdX,Y)$isofile
    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet noeject noprompt splash --
    initrd (loop)/casper/initrd.lz
}
</pre>
<h2><span class="mw-headline" id="Using_the_command_shell">Using the command shell</span></h2>
<p>Since the MBR is too small to store all GRUB2 modules, only the menu and a few basic commands reside there. The majority of GRUB2 functionality remains in modules in <code>/boot/grub</code>, which are inserted as needed. In error conditions (e.g. if the partition layout changes) GRUB2 may fail to boot. When this happens, a command shell may appear.
</p>
<p>GRUB2 offers multiple shells/prompts. If there is a problem reading the menu but the bootloader is able to find the disk, you will likely be dropped to the "normal" shell:
</p>
<pre>sh:grub&gt;
</pre>
<p>If there is a more serious problem (e.g. GRUB cannot find required files), you may instead be dropped to the "rescue" shell:
</p>
<pre>grub rescue&gt;
</pre>
<p>The rescue shell is a restricted subset of the normal shell, offering much less functionality. If dumped to the rescue shell, first try inserting the "normal" module, then starting the "normal" shell:
</p>
<pre>grub rescue&gt; set prefix=(hdX,Y)/boot/grub
grub rescue&gt; insmod (hdX,Y)/boot/grub/i386-pc/normal.mod
rescue:grub&gt; normal
</pre>
<h3><span class="mw-headline" id="Pager_support">Pager support</span></h3>
<p>GRUB2 supports pager for reading commands that provide long output (like the help command). This works only in normal shell mode and not in rescue mode. To enable pager, in GRUB2 command shell type:
</p>
<pre>sh:grub&gt; set pager=1
</pre>
<h2><span class="mw-headline" id="GUI_configuration_tools">GUI configuration tools</span></h2>
<p>Following package may be installed from <a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a>
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-customizer/">grub-customizer</a></span><sup><small>AUR</small></sup><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> (requires gettext gksu gtkmm hicolor-icon-theme openssl)
<dl><dd>Customize the bootloader (GRUB2 or BURG)</dd></dl>
</li>
<li>
<a rel="nofollow" class="external text" href="https://www.linux-apps.com/p/1127844">grub2-editor</a> (requires kdelibs)
<dl><dd>A KDE4 control module for configuring the GRUB2 bootloader</dd></dl>
</li>
<li>
<a rel="nofollow" class="external text" href="https://www.linux-apps.com/p/1127777">kcm-grub2</a> (requires kdelibs python2-qt kdebindings-python)
<dl><dd>This Kcm module manages the most common settings of Grub2.</dd></dl>
</li>
<li>
<a rel="nofollow" class="external text" href="https://sourceforge.net/projects/startup-manager/">startupmanager</a> (requires gnome-python imagemagick yelp python2 xorg-xrandr)
<dl><dd>GUI app for changing the settings of GRUB, GRUB2, Usplash and Splashy</dd></dl>
</li>
</ul>
<h2>
<span id="parttool_or_legacy_hide.2Funhide"></span><span class="mw-headline" id="parttool_or_legacy_hide/unhide">parttool or legacy hide/unhide</span>
</h2>
<p>If you have a Windows 9x paradigm with hidden C:\ disks GRUB Legacy had the hide/unhide feature. In GRUB2 this has been replaced by <code>parttool</code>. For example, to boot the third C:\ disk of three Windows 9x installations on the CLI enter the CLI and:
</p>
<pre>parttool hd0,1 hidden+ boot-
parttool hd0,2 hidden+ boot-
parttool hd0,3 hidden- boot+
set root=hd0,3
chainloader +1
boot
</pre>
<h2><span class="mw-headline" id="Using_the_rescue_console">Using the rescue console</span></h2>
<p>See <a href="#Using_the_command_shell">#Using the command shell</a> first. If unable to activate the standard shell, one possible solution is to boot using a live CD or some other rescue disk to correct configuration errors and reinstall GRUB. However, such a boot disk is not always available (nor necessary); the rescue console is surprisingly robust.
</p>
<p>The available commands in GRUB rescue include <code>insmod</code>, <code>ls</code>, <code>set</code>, and <code>unset</code>. This example uses <code>set</code> and <code>insmod</code>. <code>set</code> modifies variables and <code>insmod</code> inserts new modules to add functionality.
</p>
<p>Before starting, the user must know the location of their <code>/boot</code> partition (be it a separate partition, or a subdirectory under their root):
</p>
<pre>grub rescue&gt; set prefix=(hdX,Y)/boot/grub
</pre>
<p>where X is the physical drive number and Y is the partition number.
</p>
<p>To expand console capabilities, insert the <code>linux</code> module:
</p>
<pre>grub rescue&gt; insmod (hdX,Y)/boot/grub/linux.mod
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> With a separate boot partition, omit <code>/boot</code> from the path, (i.e. type <code>set prefix=(hdX,Y)/grub</code> and <code>insmod (hdX,Y)/grub/linux.mod</code>).</div>
<p>This introduces the <code>linux</code> and <code>initrd</code> commands, which should be familiar (see <a href="#Configuration">#Configuration</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>).
</p>
<p>An example, booting Arch Linux:
</p>
<pre>set root=(hd0,5)
linux /boot/vmlinuz-linux root=/dev/sda5
initrd /boot/initramfs-linux.img
boot
</pre>
<p>With a separate boot partition, again change the lines accordingly:
</p>
<pre>set root=(hd0,5)
linux /vmlinuz-linux root=/dev/sda6
initrd /initramfs-linux.img
boot
</pre>
<p>After successfully booting the Arch Linux installation, users can correct <code>grub.cfg</code> as needed and then reinstall GRUB2.
</p>
<p>to reinstall GRUB2 and fix the problem completely, changing <code>/dev/sda</code> if needed. See <a href="#Bootloader_installation">#Bootloader installation</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> for details.
</p>
<h2><span class="mw-headline" id="Combining_the_use_of_UUIDs_and_basic_scripting">Combining the use of UUIDs and basic scripting</span></h2>
<p>If you like the idea of using UUIDs to avoid unreliable BIOS mappings or are struggling with GRUB's syntax, here is an example boot menu item that uses UUIDs and a small script to direct GRUB to the proper disk partitions for your system. All you need to do is replace the UUIDs in the sample with the correct UUIDs for your system. The example applies to a system with a boot and root partition. You will obviously need to modify the GRUB configuration if you have additional partitions:
</p>
<pre> menuentry "Arch Linux 64" {
     # Set the UUIDs for your boot and root partition respectively
     set the_boot_uuid=ece0448f-bb08-486d-9864-ac3271bd8d07
     set the_root_uuid=c55da16f-e2af-4603-9e0b-03f5f565ec4a
   
     # (Note: This may be the same as your boot partition)
   
     # Get the boot/root devices and set them in the root and grub_boot variables
     search --fs-uuid --no-floppy --set=root $the_root_uuid
     search --fs-uuid --no-floppy --set=grub_boot $the_boot_uuid
   
     # Check to see if boot and root are equal.
     # If they are, then append /boot to $grub_boot (Since $grub_boot is actually the root partition)
     if [ $the_boot_uuid == $the_root_uuid] ; then
         set grub_boot=$grub_boot/boot
     fi
   
     # $grub_boot now points to the correct location, so the following will properly find the kernel and initrd
     linux ($grub_boot)/vmlinuz-linux root=/dev/disk/by-uuid/$uuid_os_root ro
     initrd ($grub_boot)/initramfs-linux.img
 }
</pre>
<h2>
<span id=".E7.96.91.E9.9B.A3.E6.8E.92.E8.A7.A3.28Troubleshooting.29"></span><span class="mw-headline" id="疑難排解(Troubleshooting)">疑難排解(Troubleshooting)</span>
</h2>
<p>Any troubleshooting should be added here.
</p>
<h3><span class="mw-headline" id="Enable_GRUB2_debug_messages">Enable GRUB2 debug messages</span></h3>
<p>Add:
</p>
<pre>set pager=1
set debug=all
</pre>
<p>to <code>grub.cfg</code>.
</p>
<h3><span class="mw-headline" id="Correct_GRUB2_No_Suitable_Mode_Found_Error">Correct GRUB2 No Suitable Mode Found Error</span></h3>
<p>If you get this error when booting any menuentry:
</p>
<pre>error: no suitable mode found
Booting however
</pre>
<p>Then you need to initialize GRUB2 graphical terminal (<code>gfxterm</code>) with proper video mode (<code>gfxmode</code>) in GRUB2. This video mode is passed by GRUB2 to the linux kernel via 'gfxpayload'. In case of UEFI systems, if the GRUB2 video mode is not initialized, no kernel boot messages will be shown in the terminal (atleast until KMS kicks in).
</p>
<p>Copy <code>/usr/share/grub/unicode.pf2</code> to ${GRUB2_PREFIX_DIR} (<code>/boot/grub/</code> in case of BIOS and UEFI systems). If GRUB2 UEFI was installed with <code>--boot-directory=/boot/efi/EFI</code> set, then the directory is <code>/boot/efi/EFI/grub/</code>:
</p>
<pre># cp /usr/share/grub/unicode.pf2 ${GRUB2_PREFIX_DIR}
</pre>
<p>If <code>/usr/share/grub/unicode.pf2</code> does not exist, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bdf-unifont">bdf-unifont</a></span>, create the <code>unifont.pf2</code> file and then copy it to <code>${GRUB2_PREFIX_DIR}</code>:
</p>
<pre># grub-mkfont -o unicode.pf2 /usr/share/fonts/misc/unifont.bdf
</pre>
<p>Then, in the <code>grub.cfg</code> file, add the following lines to enable GRUB2 to pass the video mode correctly to the kernel, without of which you will only get a black screen (no output) but booting (actually) proceeds successfully without any system hang.
</p>
<p>BIOS systems:
</p>
<pre>insmod vbe
</pre>
<p>UEFI systems:
</p>
<pre>insmod efi_gop
insmod efi_uga
</pre>
<p>After that add the following code (common to both BIOS and UEFI):
</p>
<pre>insmod font
</pre>
<pre>if loadfont ${prefix}/fonts/unicode.pf2
then
    insmod gfxterm
    set gfxmode=auto
    set gfxpayload=keep
    terminal_output gfxterm
fi
</pre>
<p>As you can see for gfxterm (graphical terminal) to function properly, <code>unicode.pf2</code> font file should exist in <code>${GRUB2_PREFIX_DIR}</code>.
</p>
<h3><span class="mw-headline" id="msdos-style_error_message">msdos-style error message</span></h3>
<pre>grub-setup: warn: This msdos-style partition label has no post-MBR gap; embedding won't be possible!
grub-setup: warn: Embedding is not possible. GRUB can only be installed in this setup by using blocklists.
            However, blocklists are UNRELIABLE and its use is discouraged.
grub-setup: error: If you really want blocklists, use --force.
</pre>
<p>This error may occur when you try installing GRUB2 in a VMware container. Read more about it <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=581760#p581760">here</a>. It happens when the first partition starts just after the MBR (block 63), without the usual space of 1 MiB (2048 blocks) before the first partition. Read <a href="#MBR_aka_msdos_partitioning_specific_instructions">#MBR aka msdos partitioning specific instructions</a>
</p>
<h3><span class="mw-headline" id="UEFI_GRUB2_drops_to_shell">UEFI GRUB2 drops to shell</span></h3>
<p>If GRUB loads but drops you into the rescue shell with no errors, it may be because of a missing or misplaced <code>grub.cfg</code>. This will happen if GRUB2 UEFI was installed with <code>--boot-directory</code> and <code>grub.cfg</code> is missing OR if the partition number of the boot partition changed (which is hard-coded into the <code>grubx64.efi</code> file).
</p>
<h3><span class="mw-headline" id="UEFI_GRUB2_not_loaded">UEFI GRUB2 not loaded</span></h3>
<p>In some cases the EFI may fail to load GRUB correctly. Provided everything is set up correctly, the output of:
</p>
<pre>efibootmgr -v
</pre>
<p>might look something like this:
</p>
<pre>BootCurrent: 0000
Timeout: 3 seconds
BootOrder: 0000,0001,0002
Boot0000* Grub	HD(1,800,32000,23532fbb-1bfa-4e46-851a-b494bfe9478c)File(\efi\grub\grub.efi)
Boot0001* Shell	HD(1,800,32000,23532fbb-1bfa-4e46-851a-b494bfe9478c)File(\EfiShell.efi)
Boot0002* Festplatte	BIOS(2,0,00)P0: SAMSUNG HD204UI
</pre>
<p>If everything works correctly, the EFI would now automatically load GRUB.
</p>
<p>If the screen only goes black for a second and the next boot option is tried afterwards, according to <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=981560#p981560">this post</a>, moving GRUB to the partition root can help. The boot option has to be deleted and recreated afterwards. The entry for GRUB should look like this then:
</p>
<pre>Boot0000* Grub	HD(1,800,32000,23532fbb-1bfa-4e46-851a-b494bfe9478c)File(\grub.efi)
</pre>
<h3><span class="mw-headline" id="Invalid_signature">Invalid signature</span></h3>
<p>If trying to boot Windows results in an "invalid signature" error, e.g. after reconfiguring partitions or adding additional hard drives, (re)move GRUB's device configuration and let it reconfigure:
</p>
<pre># mv /boot/grub/device.map /boot/grub/device.map-old
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p><code>grub-mkconfig</code> should now mention all found boot options, including Windows. If it works, remove <code>/boot/grub/device.map-old</code>.
</p>
<h3><span class="mw-headline" id="Restore_GRUB_Legacy">Restore GRUB Legacy</span></h3>
<ul><li>將 GRUB2 檔案先移除:</li></ul>
<pre># mv /boot/grub /boot/grub.nonfunctional
</pre>
<ul><li>把舊版GRUB( GRUB Legacy )放回 <code>/boot</code>:</li></ul>
<pre># cp -af /boot/grub-legacy /boot/grub
</pre>
<ul><li>將sda的MBR加上後面62個sectors的區塊用備份好的資料取代</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 這指令同時也回存舊的分割區對應表(partition table)，這可能會弄亂你的系統</div>
<pre># dd if=/path/to/backup/first-sectors of=/dev/sdX bs=512 count=1
</pre>
<p>比較安全的方法是僅回存MBR的啟動碼:
</p>
<pre># dd if=/path/to/backup/mbr-boot-code of=/dev/sdX bs=446 count=1
</pre>
<h2>
<span id=".E5.8F.83.E8.80.83.E8.B3.87.E6.96.99.28References.29"></span><span class="mw-headline" id="參考資料(References)">參考資料(References)</span>
</h2>
<ol>
<li>Official GRUB2 Manual - <a rel="nofollow" class="external free" href="https://www.gnu.org/software/grub/manual/grub.html">https://www.gnu.org/software/grub/manual/grub.html</a>
</li>
<li>Ubuntu wiki page for GRUB2 - <a rel="nofollow" class="external free" href="https://help.ubuntu.com/community/Grub2">https://help.ubuntu.com/community/Grub2</a>
</li>
<li>GRUB2 wiki page describing steps to compile for UEFI systems - <a rel="nofollow" class="external free" href="https://help.ubuntu.com/community/UEFIBooting">https://help.ubuntu.com/community/UEFIBooting</a>
</li>
<li>Wikipedia's page on <a href="https://en.wikipedia.org/wiki/BIOS_Boot_partition" class="extiw" title="wikipedia:BIOS Boot partition">BIOS Boot partition</a>
</li>
</ol>
<h2>
<span id=".E5.A4.96.E9.83.A8.E9.80.A3.E7.B5.90.28External_Links.29"></span><span class="mw-headline" id="外部連結(External_Links)">外部連結(External Links)</span>
</h2>
<ol>
<li><a rel="nofollow" class="external text" href="https://github.com/KA2107/My_Shell_Scripts/blob/41cb1dfe91d7c25dbb068c4ca4625e5e639b5b57/grub/grub_bios.sh">A Linux Bash Shell script to compile and install GRUB(2) for BIOS from BZR Source</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/KA2107/My_Shell_Scripts/blob/master/grub/grub_uefi.sh">A Linux Bash Shell script to compile and install GRUB(2) for UEFI from BZR Source</a></li>
</ol>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Boot_loaders_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)" title="Category:Boot loaders (正體中文)">Boot loaders (正體中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Bad_translation" title="Category:Pages or sections flagged with Template:Bad translation">Pages or sections flagged with Template:Bad translation</a></li>
<li><a href="/title/Category:Pages_with_broken_section_links" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="/title/Category:Pages_with_broken_package_links" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="/title/Category:Pages_with_dead_links" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GRUB_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)&amp;oldid=670658">https://wiki.archlinux.org/index.php?title=GRUB_(正體中文)&amp;oldid=670658</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 12 May 2021, at 11:17.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
