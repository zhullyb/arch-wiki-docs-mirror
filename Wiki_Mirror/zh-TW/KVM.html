<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>KVM (正體中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-KVM_正體中文 rootpage-KVM_正體中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">KVM (正體中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本條目或段落需要進行<a href="/title/ArchWiki:Contributing#Translating" title="ArchWiki:Contributing">翻譯</a>。</b><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>註記: </b> <span style="color:red;">please use the first argument of the template to provide more detailed indications.</span> (<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:KVM_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)">討論</a>)</div>
</div>
<p><b>KVM</b>（Kernel-based Virtual Machine的縮寫）是於Linux內核內建的虛擬機。有點類似於 <a href="/title/Xen" title="Xen">Xen</a> ，但更追求更簡單的運作，比如執行此虛擬機器，只需要載入相應的 <code>kvm</code> 模組即可後台待命。和 <a href="/title/Xen" title="Xen">Xen</a> 的半虛擬不同的是，KVM 需要電腦支援虛擬化技術（Intel的 VT 扩展或者 AMD 的 AMD-V 擴充）。Xen的全虛擬化仍然要求電腦支援虛擬化技術。
</p>
<p>在KVM中，可以執行各種未更改的GNU/Linux, Windows 或任何其他系統鏡像。(請看<a rel="nofollow" class="external autonumber" href="https://www.linux-kvm.org/page/Guest_Support_Status">[1]</a>)，每個虛擬機器都可提供獨享的虛擬硬體：網路卡，硬碟，顯卡等。请看 <a rel="nofollow" class="external text" href="https://www.linux-kvm.org/page/HOWTO">KVM Howto</a>
</p>
<p>KVM, Xen, VMware, 和 QEMU 的不同之處，請看此處<a rel="nofollow" class="external text" href="https://www.linux-kvm.org/page/FAQ#What_is_the_difference_between_kvm_and_Xen.3F">KVM FAQ</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E6%AA%A2%E6%9F%A5%E6%82%A8%E7%9A%84%E9%9B%BB%E8%85%A6%E6%98%AF%E5%90%A6%E6%94%AF%E6%8F%B4KVM"><span class="tocnumber">1</span> <span class="toctext">檢查您的電腦是否支援KVM</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E7%A1%AC%E9%AB%94%E6%94%AF%E6%8F%B4"><span class="tocnumber">1.1</span> <span class="toctext">硬體支援</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#%E5%85%A7%E6%A0%B8%E6%94%AF%E6%8F%B4"><span class="tocnumber">1.2</span> <span class="toctext">內核支援</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#KVM%E6%A8%A1%E7%B5%84"><span class="tocnumber">1.3</span> <span class="toctext">KVM模組</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#Para-virtualized_devices"><span class="tocnumber">2</span> <span class="toctext">Para-virtualized devices</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#VirtIO_modules"><span class="tocnumber">2.1</span> <span class="toctext">VirtIO modules</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Loading_kernel_modules"><span class="tocnumber">2.2</span> <span class="toctext">Loading kernel modules</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#List_of_para-virtualized_devices"><span class="tocnumber">2.3</span> <span class="toctext">List of para-virtualized devices</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8KVM"><span class="tocnumber">3</span> <span class="toctext">如何使用KVM</span></a></li>
<li class="toclevel-1 tocsection-10">
<a href="#%E5%B0%8F%E8%B2%BC%E5%A3%AB%E4%B8%8E%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="tocnumber">4</span> <span class="toctext">小貼士与小技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#%E5%B5%8C%E5%A5%97%E8%99%9B%E6%93%AC%E5%8C%96"><span class="tocnumber">4.1</span> <span class="toctext">嵌套虛擬化</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E6.AA.A2.E6.9F.A5.E6.82.A8.E7.9A.84.E9.9B.BB.E8.85.A6.E6.98.AF.E5.90.A6.E6.94.AF.E6.8F.B4KVM"></span><span class="mw-headline" id="檢查您的電腦是否支援KVM">檢查您的電腦是否支援KVM</span>
</h2>
<h3>
<span id=".E7.A1.AC.E9.AB.94.E6.94.AF.E6.8F.B4"></span><span class="mw-headline" id="硬體支援">硬體支援</span>
</h3>
<p>KVM需要宿主（host）機的處理器支援虛擬化（對於Intel CPU來說是VT-x，對於AMD CPU來說是AMD-V）。你可以通過<a href="/index.php?title=Lscpu&amp;action=edit&amp;redlink=1" class="new" title="Lscpu (page does not exist)">lscpu</a>命令來檢查你的CPU是否支援虛擬化：
</p>
<pre>$ lscpu
</pre>
<p>如果你的CPU支援虛擬化，輸出結果中會有一行Virtualization的諮詢。
</p>
<p>你也可以執行：
</p>
<pre>$ grep -E "(vmx|svm)" --color=always /proc/cpuinfo
</pre>
<p>如果執行後沒有結果，那麼你的CPU<b>不</b>支援硬體虛擬化，你<b>不能</b>使用KVM。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 您可能需要在BIOS中啟用虛擬化支援</div>
<h3>
<span id=".E5.85.A7.E6.A0.B8.E6.94.AF.E6.8F.B4"></span><span class="mw-headline" id="內核支援">內核支援</span>
</h3>
<p>Arch Linux的內核提供了相應的<a href="/title/Kernel_modules" class="mw-redirect" title="Kernel modules">內核模組</a>來支援KVM和VirtIO。
</p>
<h3>
<span id="KVM.E6.A8.A1.E7.B5.84"></span><span class="mw-headline" id="KVM模組">KVM模組</span>
</h3>
<p>如果你的內核是用 CONFIG_IKCONFIG_PROC 這個選項編譯的話，你可以通過以下命令檢查你的內核是否已經包含了支援KVM所必須的模組（<code>kvm</code>及<code>kvm_amd</code>与<code>kvm_intel</code>這両者中的任意一個）：
</p>
<pre>$ zgrep KVM /proc/config.gz
</pre>
<p>如果模組設定不等於 <code>y</code>或<code>m</code>，則該模組<b>不</b>可用
</p>
<h2><span class="mw-headline" id="Para-virtualized_devices">Para-virtualized devices</span></h2>
<p>Para-virtualization provides a fast and efficient means of communication for guests to use devices on the host machine. KVM provides para-virtualized devices to virtual machines using the Virtio API as a layer between the hypervisor and guest.
</p>
<p>All virtio devices have two parts: the host device and the guest driver.
</p>
<h3><span class="mw-headline" id="VirtIO_modules">VirtIO modules</span></h3>
<p>Use the following command to check if needed modules are available:
</p>
<pre>$ zgrep VIRTIO /proc/config.gz
</pre>
<h3><span class="mw-headline" id="Loading_kernel_modules">Loading kernel modules</span></h3>
<p>First, check if the kernel modules are automatically loaded. This should be the case with recent versions of <a href="/title/Udev" title="Udev">udev</a>.
</p>
<pre>$ lsmod | grep kvm
$ lsmod | grep virtio
</pre>
<p>In case the above commands return nothing, you need to <a href="/title/Kernel_modules#Loading" class="mw-redirect" title="Kernel modules">load</a><sup>[<a href="/title/Help:Procedures#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> kernel modules.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
If modprobing <code>kvm_intel</code> or <code>kvm_amd</code> fails but modprobing <code>kvm</code> succeeds, (and <code>lscpu</code> claims that hardware acceleration is supported), check your BIOS settings. Some vendors (especially laptop vendors) disable these processor extensions by default. To determine whether there is no hardware support or there is but the extensions are disabled in BIOS, the output from <code>dmesg</code> after having failed to modprobe will tell.</div>
<h3><span class="mw-headline" id="List_of_para-virtualized_devices">List of para-virtualized devices</span></h3>
<ul>
<li>network device (virtio-net)</li>
<li>block device (virtio-blk)</li>
<li>controller device (virtio-scsi)</li>
<li>serial device (virtio-serial)</li>
<li>balloon device (virtio-balloon)</li>
</ul>
<h2>
<span id=".E5.A6.82.E4.BD.95.E4.BD.BF.E7.94.A8KVM"></span><span class="mw-headline" id="如何使用KVM">如何使用KVM</span>
</h2>
<p>必須使用<a href="/title/QEMU" title="QEMU">QEMU</a>或<a href="/title/Libvirt" title="Libvirt">Libvirt</a>作為KVM的控制界面和前端，請參考<a href="/title/Libvirt_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)" title="Libvirt (正體中文)">Libvirt (正體中文)</a>條目和<a href="/title/QEMU" title="QEMU">QEMU</a>條目。
</p>
<h2>
<span id=".E5.B0.8F.E8.B2.BC.E5.A3.AB.E4.B8.8E.E5.B0.8F.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="小貼士与小技巧">小貼士与小技巧</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 請參考<a href="/title/QEMU#Tips_and_tricks" title="QEMU">QEMU#Tips and tricks</a>和<a href="/title/QEMU#Troubleshooting" title="QEMU">QEMU#Troubleshooting</a>詞條。</div>
<h3>
<span id=".E5.B5.8C.E5.A5.97.E8.99.9B.E6.93.AC.E5.8C.96"></span><span class="mw-headline" id="嵌套虛擬化">嵌套虛擬化</span>
</h3>
<p>在宿主機啟用<code>kvm_intel</code>模組的嵌套虛擬化機能：
</p>
<pre># modprobe -r kvm_intel
# modprobe kvm_intel nested=1
</pre>
<p>使嵌套虛擬化永久生效（請參考<a href="/title/Kernel_modules#Setting_module_options" class="mw-redirect" title="Kernel modules">Kernel modules#Setting module options</a>）：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/modprobe.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options kvm_intel nested=1
</pre>
<p>檢驗嵌套虛擬化功能是否已被激活：  
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ systool -m kvm_intel -v | grep nested</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">    nested              = "Y"
</pre>
<p>使用以下命令來執行guest虛擬機器：
</p>
<pre>$ qemu-system-x86_64 -enable-kvm -cpu host
</pre>
<p>啟動虛擬機並檢查是否有vmx標誌：
</p>
<pre>$ grep vmx /proc/cpuinfo
</pre>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Categories</a>: <ul>
<li><a href="/title/Category:%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87" title="Category:正體中文">正體中文</a></li>
<li><a href="/title/Category:Virtualization_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)" title="Category:Virtualization (正體中文)">Virtualization (正體中文)</a></li>
<li><a href="/title/Category:Kernel_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)" title="Category:Kernel (正體中文)">Kernel (正體中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Translateme_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)" title="Category:Pages or sections flagged with Template:Translateme (正體中文)">Pages or sections flagged with Template:Translateme (正體中文)</a></li>
<li><a href="/title/Category:Pages_with_broken_section_links" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=KVM_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)&amp;oldid=664199">https://wiki.archlinux.org/index.php?title=KVM_(正體中文)&amp;oldid=664199</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 25 April 2021, at 13:48.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
