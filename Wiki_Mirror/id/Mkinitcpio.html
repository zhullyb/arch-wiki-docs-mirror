<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>mkinitcpio (Indonesia) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Mkinitcpio_Indonesia rootpage-Mkinitcpio_Indonesia skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">mkinitcpio (Indonesia)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>This article or section needs to be <a href="../en/ArchWiki:Contributing.html#Translating" title="ArchWiki:Contributing">translated</a>.</b><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Notes:</b> work in progress. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mkinitcpio_(Indonesia)">Talk:Mkinitcpio (Indonesia)#</a>)</div>
</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/Systemd.html" title="Systemd">systemd</a></li>
<li><a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">Kernel modules</a></li>
</ul>
</div>
<p><b>mkinitcpio</b> adalah generasi berikutnya dari pembuatan <a href="https://en.wikipedia.org/wiki/initramfs" class="extiw" title="wikipedia:initramfs">initramfs</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Sekilas_Pandang"><span class="tocnumber">1</span> <span class="toctext">Sekilas Pandang</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Installation"><span class="tocnumber">2</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Image_creation_and_activation"><span class="tocnumber">3</span> <span class="toctext">Image creation and activation</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Generate_customized_manual_initcpio"><span class="tocnumber">3.1</span> <span class="toctext">Generate customized manual initcpio</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#Configuration"><span class="tocnumber">4</span> <span class="toctext">Configuration</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#MODULES"><span class="tocnumber">4.1</span> <span class="toctext">MODULES</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#BINARIES_and_FILES"><span class="tocnumber">4.2</span> <span class="toctext">BINARIES and FILES</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#HOOKS"><span class="tocnumber">4.3</span> <span class="toctext">HOOKS</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Build_hooks"><span class="tocnumber">4.3.1</span> <span class="toctext">Build hooks</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Runtime_hooks"><span class="tocnumber">4.3.2</span> <span class="toctext">Runtime hooks</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Common_hooks"><span class="tocnumber">4.3.3</span> <span class="toctext">Common hooks</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12"><a href="#COMPRESSION"><span class="tocnumber">4.4</span> <span class="toctext">COMPRESSION</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#COMPRESSION_OPTIONS"><span class="tocnumber">4.5</span> <span class="toctext">COMPRESSION_OPTIONS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14">
<a href="#Runtime_customization"><span class="tocnumber">5</span> <span class="toctext">Runtime customization</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#init_from_base_hook"><span class="tocnumber">5.1</span> <span class="toctext">init from base hook</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Using_RAID"><span class="tocnumber">5.2</span> <span class="toctext">Using RAID</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Using_net"><span class="tocnumber">5.3</span> <span class="toctext">Using net</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Using_LVM"><span class="tocnumber">5.4</span> <span class="toctext">Using LVM</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Using_encrypted_root"><span class="tocnumber">5.5</span> <span class="toctext">Using encrypted root</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#/usr_as_a_separate_partition"><span class="tocnumber">5.6</span> <span class="toctext">/usr as a separate partition</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21">
<a href="#Troubleshooting"><span class="tocnumber">6</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#Extracting_the_image"><span class="tocnumber">6.1</span> <span class="toctext">Extracting the image</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Recompressing_a_modified_extracted_image"><span class="tocnumber">6.2</span> <span class="toctext">Recompressing a modified extracted image</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#%22/dev_must_be_mounted%22_when_it_already_is"><span class="tocnumber">6.3</span> <span class="toctext">"/dev must be mounted" when it already is</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Using_systemd_HOOKS_in_a_LUKS/LVM/resume_setup"><span class="tocnumber">6.4</span> <span class="toctext">Using systemd HOOKS in a LUKS/LVM/resume setup</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Possibly_missing_firmware_for_module_XXXX"><span class="tocnumber">6.5</span> <span class="toctext">Possibly missing firmware for module XXXX</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#mkinitcpio_creates_images_with_all_the_shared_libraries_missing"><span class="tocnumber">6.6</span> <span class="toctext">mkinitcpio creates images with all the shared libraries missing</span></a></li>
<li class="toclevel-2 tocsection-28">
<a href="#Standard_rescue_procedures"><span class="tocnumber">6.7</span> <span class="toctext">Standard rescue procedures</span></a>
<ul>
<li class="toclevel-3 tocsection-29"><a href="#Boot_succeeds_on_one_machine_and_fails_on_another"><span class="tocnumber">6.7.1</span> <span class="toctext">Boot succeeds on one machine and fails on another</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#See_also"><span class="tocnumber">7</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Sekilas_Pandang">Sekilas Pandang</span></h2>
<p>mkinitcpio adalah script Bash yang digunakan untuk membuat ramdisk yang merupakan lingkungan awal dari system linux (initial ramdisk environment). Dikutip dari <span class="plainlinks archwiki-template-man" title="$ man 8 mkinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.8">mkinitcpio(8)</a></span>:
</p>
<dl><dd>Initial ramdisk pada dasarnya merupakan suatu lingkup sistem yang sangat kecil (yang merupakan versi sederhana dari linux OS) yang bekerja persis setelah kernel (vmlinuz) di angkat ke system / memory, ini biasanya disebut sebagai celah awalan untuk pengguna (early user space) dan digunakan untuk mengangkat beragam modul modul yang dibutuhkan oleh kernel dan untuk pengesetan / persiapan berbagai hal yang penting sebelum kendali system diserahkan kepada program init yang terdapat didalam root filesystem. Dengan cara inilah dimungkinkan untuk, sebagai contoh: mengakses root file systems yang dienkripsi atau untuk mengakses root file systems yang ada di perangkat lunak jajaran RAID. mkinitcpio memungkinkan berbagai persesuaian ekstensi kernel dengan cara yang lebih mudah, juga dilengkapi deteksi otomatis pada saat berjalan, dan berbagai fitur lainnya.</dd></dl>
<p>Secara tradisi, kernel bertanggung jawab atas pendeteksian segala perangkat keras dan inisialisasi tugas-tugas pada saat awal didalam proses boot  <a href="../en/Arch_boot_process.html" class="mw-redirect" title="Boot process">boot process</a> sebelum dilakukan pengkaitan terhadap root file system (mount root file system) dan kemudian memberikan kendali system kepada <code>init</code>. Namun seiring dengan berkembangnya teknologi, tugas-tugas kernel seperti tersebut menjadi semakin kompleks pula.
</p>
<p>Pada saat ini, root file system bisa saja berada atau terinstal didalam beragam jenis hardware, mulai dari media simpan SCSI hingga SATA sampai USB, itupun dikendalikan oleh beragam pengendali media simpanan yang berasal dari pabrikan/perakit yang berbeda-beda pula. Ditambah lagi root file system bisa saja disimpan dengan enkripsi tertentu atau bisa juga dikompresi didalam suatu perangkat lunak jajaran RAID atau grup volume logikal. Nah - cara termudah untuk menangani kompleksitas tersebut adalah dengan memberi celah/kesempatan mengelola system tersebut dalam bentuk sela awal singkat bagi pengguna (early user space) saat proses boot berjalan: itu adalah initial ramdisk.
</p>
<p>Silahkan lihat juga: <a rel="nofollow" class="external text" href="https://web.archive.org/web/20150430223035/http://archlinux.me/brain0/2010/02/13/early-userspace-in-arch-linux/">/dev/brain0 » Blog Archive » Early Userspace in Arch Linux</a>.
</p>
<p>mkinitcpio adalah perangkat yang dibangun secara modular untuk membangun sebuah image CPIO yaitu initramfs, dilengkapi beberapa kelebihan diatas perangkat sefungsi lainnya; diantara kelebihan ini adalah:
</p>
<ul>
<li>Dapat menggunakan <a rel="nofollow" class="external text" href="https://www.busybox.net/">BusyBox</a> untuk menghasilkan dasar yang ringan dan juga ringkas pada sela awal singkat bagi pengguna (early userspace).</li>
<li>Mendukung <b><a href="../en/Udev.html" title="Udev">udev</a></b> untuk keperluan pendeteksian perangkat secara otomatis pada saat berjalan, sekaligus dapat mencegah pemanggilan modul-modul yang dinyatakan tidak perlu.</li>
<li>Using an extendable hook-based init script, which supports custom hooks that can easily be included in packages.</li>
<li>Support for  <a href="../en/LVM.html" class="mw-redirect" title="LVM2">LVM2</a>, <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> for both plain and LUKS volumes, <a href="../en/RAID.html" title="RAID">RAID</a>, and <a href="https://en.wikipedia.org/wiki/swsusp" class="extiw" title="wikipedia:swsusp">swsusp</a> and <a href="../en/ArchWiki:Archive.html" class="mw-redirect" title="TuxOnIce">TuxOnIce</a> for resuming, and booting from USB mass storage devices.</li>
<li>The ability to allow many features to be configured from the kernel command line without needing to rebuild the image.</li>
</ul>
<p>mkinitcpio is a modular tool for building an initramfs CPIO image, offering many advantages over alternative methods; these advantages include:
</p>
<ul>
<li>The use of <a rel="nofollow" class="external text" href="https://www.busybox.net/">BusyBox</a> to provide a small and lightweight base for early userspace.</li>
<li>Support for <b><a href="../en/Udev.html" title="Udev">udev</a></b> for hardware auto-detection at runtime, thus preventing the loading of unnecessary modules.</li>
<li>Using an extendable hook-based init script, which supports custom hooks that can easily be included in packages.</li>
<li>Support for  <a href="../en/LVM.html" class="mw-redirect" title="LVM2">LVM2</a>, <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> for both plain and LUKS volumes, <a href="../en/RAID.html" title="RAID">RAID</a>, and <a href="https://en.wikipedia.org/wiki/swsusp" class="extiw" title="wikipedia:swsusp">swsusp</a> and <a href="../en/ArchWiki:Archive.html" class="mw-redirect" title="TuxOnIce">TuxOnIce</a> for resuming, and booting from USB mass storage devices.</li>
<li>The ability to allow many features to be configured from the kernel command line without needing to rebuild the image.</li>
</ul>
<p>mkinitcpio has been developed by the Arch Linux developers and from community contributions. See the <a rel="nofollow" class="external text" href="https://projects.archlinux.org/mkinitcpio.git/">public Git repository</a>.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span> package is available in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a> and is a dependency of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package.
</p>
<p>Advanced users may wish to install the latest development version of mkinitcpio from Git with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-git/">mkinitcpio-git</a></span><sup><small>AUR</small></sup> package.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is <b>highly</b> recommended that you follow the <a rel="nofollow" class="external text" href="https://mailman.archlinux.org/mailman/listinfo/arch-projects">arch-projects mailing list</a> if you use mkinitcpio from Git!</div>
<h2><span class="mw-headline" id="Image_creation_and_activation">Image creation and activation</span></h2>
<p>By default, the mkinitcpio script generates two images after kernel installation or upgrades: <code>/boot/initramfs-linux.img</code> and <code>/boot/initramfs-linux-fallback.img</code>. The <i>fallback</i> image utilizes the same configuration file as the <i>default</i> image, except the <b>autodetect</b> hook is skipped during creation, thus including a full range of modules. The <b>autodetect</b> hook detects required modules and tailors the image for specific hardware, shrinking the initramfs. 
</p>
<p>Users may create any number of initramfs images with a variety of different configurations. The desired image must be specified in the respective <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration file. After changes are made to the mkinitcpio configuration file, the image must be regenerated. For the stock Arch Linux kernel, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package, this is done by running this command with root privileges:
</p>
<pre># mkinitcpio -p linux
</pre>
<p>The <code>-p</code> switch specifies a <i>preset</i> to utilize; most kernel packages provide a related mkinitcpio preset file, found in <code>/etc/mkinitcpio.d</code> (e.g. <code>/etc/mkinitcpio.d/linux.preset</code> for <code>linux</code>). A preset is a predefined definition of how to create an initramfs image instead of specifying the configuration file and output file every time.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <i>preset</i> files are used to automatically regenerate the initramfs after a kernel update; be careful when editing them.</div>
<h3><span class="mw-headline" id="Generate_customized_manual_initcpio">Generate customized manual initcpio</span></h3>
<p>Users can generate an image using an alternative configuration file. For example, the following will generate an initramfs image according to the directions in <code>/etc/mkinitcpio-custom.conf</code> and save it at <code>/boot/linux-custom.img</code>.
</p>
<pre># mkinitcpio -c /etc/mkinitcpio-custom.conf -g /boot/linux-custom.img
</pre>
<p>If generating an image for a kernel other than the one currently running, add the kernel version to the command line. You can see available kernel versions in <code>/usr/lib/modules</code>.
</p>
<pre># mkinitcpio -g /boot/linux-custom2.img -k 3.3.0-ARCH
</pre>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The primary configuration file for <b>mkinitcpio</b> is <code>/etc/mkinitcpio.conf</code>. Additionally, preset definitions are provided by kernel packages in the <code>/etc/mkinitcpio.d</code> directory (e.g. <code>/etc/mkinitcpio.d/linux.preset</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <b>lvm2</b>, <b>mdadm</b>, and <b>encrypt</b> are <b>NOT</b> enabled by default. Please read this section carefully for instructions if these hooks are required.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul><li>Users with multiple hardware disk controllers that use the same node names but different kernel modules (e.g. two SCSI/SATA or two IDE controllers) should ensure the correct order of modules is specified in <code>/etc/mkinitcpio.conf</code>. Otherwise, the root device location may change between boots, resulting in kernel panics. A more elegant alternative is to use <a href="../en/Persistent_block_device_naming.html" title="Persistent block device naming">persistent block device naming</a> to ensure that the right devices are mounted.</li></ul>
<ul><li>
<b>PS/2 keyboard users</b>: In order to get keyboard input during early init, if you do not have it already, add the <b>keyboard</b> hook to the <code>HOOKS</code>. On some motherboards (mostly ancient ones, but also a few new ones), the i8042 controller cannot be automatically detected. It is rare, but some people will surely be without keyboard. You can detect this situation in advance. If you have a PS/2 port and get <code>i8042: PNP: No PS/2 controller found. Probing ports directly</code> message, add <b>atkbd</b> to the <code>MODULES</code>.</li></ul>
</div>
<p>Users can modify six variables within the configuration file:
</p>
<dl>
<dt><code>MODULES</code></dt>
<dd>Kernel modules to be loaded before any boot hooks are run.</dd>
<dt><code>BINARIES</code></dt>
<dd>Additional binaries to be included in the initramfs image.</dd>
<dt><code>FILES</code></dt>
<dd>Additional files to be included in the initramfs image.</dd>
<dt><code>HOOKS</code></dt>
<dd>Hooks are scripts that execute in the initial ramdisk.</dd>
<dt><code>COMPRESSION</code></dt>
<dd>Used to compress the initramfs image.</dd>
<dt><code>COMPRESSION_OPTIONS</code></dt>
<dd>Extra arguments to pass to the <code>COMPRESSION</code> program. Usage of this setting is strongly discouraged. mkinitcpio will handle special requirements for compressors (e.g. passing <code>--check=crc32</code> to xz), and misusage can easily lead to an unbootable system.</dd>
</dl>
<h3><span class="mw-headline" id="MODULES">MODULES</span></h3>
<p>The MODULES array is used to specify modules to load before anything else is done.
</p>
<p>Modules suffixed with a <code>?</code> will not throw errors if they are not found. This might be useful for custom kernels that compile in modules which are listed explicitly in a hook or config file.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If using <b>reiser4</b>, it <i>must</i> be added to the modules list.</li>
<li>If you will be needing any file system during the boot process that is not live when you run mkinitcpio — for example, if your LUKS encryption key file is on an <b>ext2</b> file system but no <b>ext2</b> file systems are mounted when you run mkinitcpio — that file system module must also be added to the MODULES list. See <a href="../en/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt/System configuration">Dm-crypt/System configuration#cryptkey</a> for more details.</li>
</ul>
</div>
<h3><span class="mw-headline" id="BINARIES_and_FILES">BINARIES and FILES</span></h3>
<p>These options allow users to add files to the image. Both <code>BINARIES</code> and <code>FILES</code> are added before hooks are run, and may be used to override files used or provided by a hook. <code>BINARIES</code> are auto-located within a standard <code>PATH</code> and are dependency-parsed, meaning any required libraries will also be added. <code>FILES</code> are added <i>as-is</i>. For example:
</p>
<pre>FILES="/etc/modprobe.d/modprobe.conf /etc/another.conf"
</pre>
<pre>BINARIES="kexec some_bin"
</pre>
<p>Note that for both <code>BINARIES</code> and <code>FILES</code>, multiple entries can be added delimited with spaces.
The example above will add two regular files, namely <code>modprobe.conf</code> and <code>another.conf</code> and two binaries, namely <code>kexec</code> and <code>some_bin</code> to the image.
</p>
<p>Within the image, all files will be in an identical location as where they are found on the parent system. In the above example, <code>modprobe.conf</code> will be placed in <code>/etc/modprobe.d/</code> within the image. The chain of parent directories to the file will be automatically created by mkinitcpio.
</p>
<h3><span class="mw-headline" id="HOOKS">HOOKS</span></h3>
<p>The <code>HOOKS</code> setting is the most important setting in the file. Hooks are small scripts which describe what will be added to the image. For some hooks, they will also contain a runtime component which provides additional behavior, such as starting a daemon, or assembling a stacked block device. Hooks are referred to by their name, and executed in the order they exist in the <code>HOOKS</code> setting in the config file.
</p>
<p>The default <code>HOOKS</code> setting should be sufficient for most simple, single disk setups. For root devices which are stacked or multi-block devices such as <a href="../en/LVM.html" title="LVM">LVM</a>, <a href="../en/LVM_on_software_RAID.html" class="mw-redirect" title="Software RAID and LVM">mdadm</a>, or <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, see the respective wiki pages for further necessary configuration.
</p>
<h4><span class="mw-headline" id="Build_hooks">Build hooks</span></h4>
<p>Build hooks are found in <code>/usr/lib/initcpio/install</code>. These files are sourced by the bash shell during runtime of mkinitcpio and should contain two functions: <code>build</code> and <code>help</code>. The <code>build</code> function describes the modules, files, and binaries which will be added to the image. An API, documented by mkinitcpio(8), serves to facilitate the addition of these items. The <code>help</code> function outputs a description of what the hook accomplishes.
</p>
<p>For a list of all available hooks:
</p>
<pre>$ mkinitcpio -L
</pre>
<p>Use mkinitcpio's <code>-H</code> option to output help for a specific hook, for example:
</p>
<pre>$ mkinitcpio -H udev
</pre>
<h4><span class="mw-headline" id="Runtime_hooks">Runtime hooks</span></h4>
<p>Runtime hooks are found in <code>/usr/lib/initcpio/hooks</code>. For any runtime hook, there should always be a build hook of the same name, which calls <code>add_runscript</code> to add the runtime hook to the image. These files are sourced by the busybox ash shell during early userspace. With the exception of cleanup hooks, they will always be run in the order listed in the <code>HOOKS</code> setting. Runtime hooks may contain several functions:
</p>
<p><code>run_earlyhook</code>: Functions of this name will be run once the API file systems have been mounted and the kernel command line has been parsed. This is generally where additional daemons, such as udev, which are needed for the early boot process are started from.
</p>
<p><code>run_hook</code>: Functions of this name are run shortly after the early hooks. This is the most common hook point, and operations such as assembly of stacked block devices should take place here.
</p>
<p><code>run_latehook</code>: Functions of this name are run after the root device has been mounted. This should be used, sparingly, for further setup of the root device, or for mounting other file systems, such as <code>/usr</code>.
</p>
<p><code>run_cleanuphook</code>: Functions of this name are run as late as possible, and in the reverse order of how they are listed in the <code>HOOKS</code> setting in the config file. These hooks should be used for any last minute cleanup, such as shutting down any daemons started by an early hook.
</p>
<h4><span class="mw-headline" id="Common_hooks">Common hooks</span></h4>
<p>A table of common hooks and how they affect image creation and runtime follows. Note that this table is not complete, as packages can provide custom hooks.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Find out if <code>dmraid</code>, etc. work/are needed for systemd based initramfs. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mkinitcpio_(Indonesia)">Talk:Mkinitcpio (Indonesia)#</a>)</div>
</div>
<table class="wikitable">
<caption>
<b>Current hooks</b>
</caption>
<tbody>
<tr>
<th>busybox</th>
<th>systemd</th>
<th>Installation</th>
<th>Runtime
</th>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>base</b></td>
<td>Sets up all initial directories and installs base utilities and libraries. Always keep this hook as the first hook unless you know what you are doing.
<p>Provides a busybox recovery shell when using <b>systemd</b> hook.
</p>
</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>udev</b></td>
<td rowspan="3" style="text-align: center;"><b>systemd</b></td>
<td>Adds udevd, udevadm, and a small subset of udev rules to your image.</td>
<td>Starts the udev daemon and processes uevents from the kernel; creating device nodes. As it simplifies the boot process by not requiring the user to explicitly specify necessary modules, using it is recommended.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>usr</b></td>
<td>Adds support for <code>/usr</code> on a separate partition.</td>
<td>Mounts the <code>/usr</code> partition after the real root has been mounted.
</td>
</tr>

<tr>
<td style="text-align: center;"><b>resume</b></td>
<td style="text-align: center;">--</td>
<td>Tries to resume from the "suspend to disk" state. <b>resume</b> hook supports both <i>swsusp</i> and <i><a href="../en/ArchWiki:Archive.html" class="mw-redirect" title="TuxOnIce">TuxOnIce</a></i>, <b>systemd</b> hook supports only <i>swsusp</i>. See <a href="../en/Power_management/Suspend_and_hibernate.html#Hibernation" class="mw-redirect" title="Hibernation">Hibernation</a> for further configuration.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>btrfs</b></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">--</td>
<td>Sets the required modules to enable <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> for using multiple devices with Btrfs. This hook is not required for using Btrfs on a single device.</td>
<td>Runs <code>btrfs device scan</code> to assemble a multi-device Btrfs root file system when <b>udev</b> hook or <b>systemd</b> hook is not present. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> package is required for this hook.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>autodetect</b></td>
<td>Shrinks your initramfs to a smaller size by creating a whitelist of modules from a scan of sysfs. Be sure to verify included modules are correct and none are missing. This hook must be run before other subsystem hooks in order to take advantage of auto-detection. Any hooks placed before 'autodetect' will be installed in full.</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>modconf</b></td>
<td>Includes modprobe configuration files from <code>/etc/modprobe.d</code> and <code>/usr/lib/modprobe.d</code>
</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>block</b></td>
<td>Adds all block device modules, formerly separately provided by the <i>fw</i>, <i>mmc</i>, <i>pata</i>, <i>sata</i>, <i>scsi</i>, <i>usb</i>, and <i>virtio</i> hooks.</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>pcmcia</b></td>
<td>Adds the necessary modules for PCMCIA devices. You need to have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pcmciautils">pcmciautils</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> installed to use this.</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>net</b></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;"><i>not implemented</i></td>
<td>Adds the necessary modules for a network device. For PCMCIA net devices, please add the <b>pcmcia</b> hook too.</td>
<td>Provides handling for an NFS-based root file system.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>dmraid</b></td>
<td style="text-align: center;"><i>?</i></td>
<td>Provides support for fakeRAID root devices. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmraid">dmraid</a></span> installed to use this. Note that it is preferred to use <code>mdadm</code> with the <b>mdadm_udev</b> hook with fakeRAID if your controller supports it.</td>
<td>Locates and assembles fakeRAID block devices using <code>dmraid</code>.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>mdadm</b></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">--</td>
<td>Provides support for assembling RAID arrays from <code>/etc/mdadm.conf</code>, or autodetection during boot. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span> installed to use this. The <b>mdadm_udev</b> hook is preferred over this hook.</td>
<td>Locates and assembles software RAID block devices using <code>mdassemble</code>.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>mdadm_udev</b></td>
<td>Provides support for assembling RAID arrays via udev. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span> installed to use this. If you use this hook with a FakeRAID array, it is recommended to include <code>mdmon</code> in the binaries section.</td>
<td>Locates and assembles software RAID block devices using <code>udev</code> and <code>mdadm</code> incremental assembly. This is the preferred method of mdadm assembly (rather than using the above <i>mdadm</i> hook).
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>keyboard</b></td>
<td>Adds the necessary modules for keyboard devices. Use this if you have an USB or serial keyboard and need it in early userspace (either for entering encryption passphrases or for use in an interactive shell). As a side effect, modules for some non-keyboard input devices might be added to, but this should not be relied on.</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>keymap</b></td>
<td rowspan="2" style="text-align: center;"><b>sd-vconsole</b></td>
<td>Adds the specified keymap(s) from <code>/etc/vconsole.conf</code> to the initramfs.</td>
<td>Loads the specified keymap(s) from <code>/etc/vconsole.conf</code> during early userspace.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>consolefont</b></td>
<td>Adds the specified console font from <code>/etc/vconsole.conf</code> to the initramfs.</td>
<td>Loads the specified console font from <code>/etc/vconsole.conf</code> during early userspace.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>encrypt</b></td>
<td style="text-align: center;"><b>sd-encrypt</b></td>
<td>Adds the <code>dm_crypt</code> kernel module and the <code>cryptsetup</code> tool to the image. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> installed to use this.</td>
<td>Detects and unlocks an encrypted root partition. See <a href="#Runtime_customization">#Runtime customization</a> for further configuration.
<p>For <b>sd-encrypt</b> see <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup-generator.8">systemd-cryptsetup-generator(8)</a></span> for available kernel command line options. Alternatively, if the file <code>/etc/crypttab.initramfs</code> exists, it will be added to the initramfs as <code>/etc/crypttab</code>. See the <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span> manpage for more information on crypttab syntax.
</p>
</td>
</tr>
<tr>
<td style="text-align: center;"><b>lvm2</b></td>
<td style="text-align: center;"><b>sd-lvm2</b></td>
<td>Adds the device mapper kernel module and the <code>lvm</code> tool to the image. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> installed to use this.</td>
<td>Enables all LVM2 volume groups. This is necessary if you have your root file system on <a href="../en/LVM.html" title="LVM">LVM</a>.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>fsck</b></td>
<td>Adds the fsck binary and file system-specific helpers. If added after the <b>autodetect</b> hook, only the helper specific to your root file system will be added. Usage of this hook is <b>strongly</b> recommended, and it is required with a separate <code>/usr</code> partition.</td>
<td>Runs fsck against your root device (and <code>/usr</code> if separate) prior to mounting. The use of this hook requires the rw parameter to be set on the kernel commandline (<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1307895#p1307895">discussion</a>).
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>filesystems</b></td>
<td>This includes necessary file system modules into your image. This hook is <b>required</b> unless you specify your file system modules in MODULES.</td>
<td>--
</td>
</tr>
</tbody>
</table>
<h3><span class="mw-headline" id="COMPRESSION">COMPRESSION</span></h3>
<p>The kernel supports several formats for compression of the initramfs—<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, lzma, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> (also known as lzma2), <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzo">lzo</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lz4">lz4</a></span>. For most use cases, gzip, lzop, and lz4 provide the best balance of compressed image size and decompression speed. The provided <code>mkinitcpio.conf</code> has the various <code>COMPRESSION</code> options commented out. Uncomment one to choose which compression format you desire.
</p>
<p>Specifying no <code>COMPRESSION</code> will result in a gzip-compressed initramfs file. To create an uncompressed image, specify <code>COMPRESSION=cat</code> in the config or use <code>-z cat</code> on the command line.
</p>
<p>Make sure you have the correct file compression utility installed for the method you wish to use.
</p>
<h3><span class="mw-headline" id="COMPRESSION_OPTIONS">COMPRESSION_OPTIONS</span></h3>
<p>These are additional flags passed to the program specified by <code>COMPRESSION</code>, such as:
</p>
<pre>COMPRESSION_OPTIONS='-9'
</pre>
<p>In general these should never be needed as mkinitcpio will make sure that any supported compression method has the necessary flags to produce a working image. Furthermore, misusage of this option can lead to an unbootable system if the kernel is unable to unpack the resultant archive.
</p>
<h2><span class="mw-headline" id="Runtime_customization">Runtime customization</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Which options work with the <code>systemd</code> hook and which are <code>base</code>-only? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Mkinitcpio_(Indonesia)">Talk:Mkinitcpio (Indonesia)#</a>)</div>
</div>
<p>Runtime configuration options can be passed to <code>init</code> and certain hooks via the kernel command line. Kernel command-line parameters are often supplied by the bootloader. The options discussed below can be appended to the kernel command line to alter default behavior. See <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a> and <a href="../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a> for more information.
</p>
<h3><span class="mw-headline" id="init_from_base_hook">init from base hook</span></h3>
<dl>
<dt><code>root</code></dt>
<dd>This is the most important parameter specified on the kernel command line, as it determines what device will be mounted as your proper root device. mkinitcpio is flexible enough to allow a wide variety of formats, for example:</dd>
</dl>
<pre>root=/dev/sda1                                                # /dev node
root=LABEL=CorsairF80                                         # label
root=UUID=ea1c4959-406c-45d0-a144-912f4e86b207                # UUID
root=PARTUUID=14420948-2cea-4de7-b042-40f67c618660            # GPT partition UUID
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The following boot parameters alter the default behavior of <code>init</code> in the initramfs environment. See <code>/usr/lib/initcpio/init</code> for details. They will not work when <code>systemd</code> hook is being used since the <code>init</code> from <code>base</code> hook is replaced.</div>
<dl>
<dt><code>break</code></dt>
<dd>If <code>break</code> or <code>break=premount</code> is specified, <code>init</code> pauses the boot process (after loading hooks, but before mounting the root file system) and launches an interactive shell which can be used for troubleshooting purposes. This shell can be launched after the root has been mounted by specifying <code>break=postmount</code>. Normal boot continues after exiting from the shell.</dd>
</dl>
<dl>
<dt><code>disablehooks</code></dt>
<dd>Disable hooks at runtime by adding <code>disablehooks=hook1[,hook2,...]</code>. For example: <pre>disablehooks=resume</pre>
</dd>
</dl>
<dl>
<dt><code>earlymodules</code></dt>
<dd>Alter the order in which modules are loaded by specifying modules to load early via <code>earlymodules=mod1[,mod2,...]</code>. (This may be used, for example, to ensure the correct ordering of multiple network interfaces.)</dd>
</dl>
<p>See <a href="../en/General_troubleshooting.html#Boot_problems" class="mw-redirect" title="Boot debugging">Boot debugging</a> and <span class="plainlinks archwiki-template-man" title="$ man 8 mkinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.8">mkinitcpio(8)</a></span> for other parameters.
</p>
<h3><span class="mw-headline" id="Using_RAID">Using RAID</span></h3>
<p>First, add the <code>mdadm_udev</code> or <code>mdadm</code> hook to the <code>HOOKS</code> array and any required RAID modules (e.g. raid456, ext4) to the <code>MODULES</code> array in <code>/etc/mkinitcpio.conf</code>.
</p>
<p>Using the <code>mdadm</code> hook, you no longer need to configure your RAID array in the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>. The <code>mdadm</code> hook will either use your <code>/etc/mdadm.conf</code> file or automatically detect the array(s) during the init phase of boot.
</p>
<p>Assembly via udev is also possible using the <code>mdadm_udev</code> hook. Upstream prefers this method of assembly. <code>/etc/mdadm.conf</code> will still be read for purposes of naming the assembled devices if it exists.
</p>
<h3><span class="mw-headline" id="Using_net">Using net</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> NFSv4 is not yet supported <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/28287">FS#28287</a>.</div>
<p><b>Required Packages</b>
</p>
<p><code>net</code> requires the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-nfs-utils">mkinitcpio-nfs-utils</a></span> package from the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.
</p>
<p><b>Kernel Parameters</b> 
</p>
<p>Comprehensive and up-to-date information can be found in the official <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">kernel documentation</a>.
</p>
<p><b>ip=</b>
</p>
<p>This parameter tells the kernel how to configure IP addresses of devices and also how to set up the IP routing table. It can take up to nine arguments separated by colons: <code>ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;:&lt;dns0-ip&gt;:&lt;dns1-ip&gt;</code>.
</p>
<p>If this parameter is missing from the kernel command line, all fields are assumed to be empty, and the defaults mentioned in the <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">kernel documentation</a> apply. In general this means that the kernel tries to configure everything using autoconfiguration.
</p>
<p>The <code>&lt;autoconf&gt;</code> parameter can appear alone as the value to the 'ip' parameter (without all the ':' characters before). If the value is "ip=off" or "ip=none", no autoconfiguration will take place, otherwise autoconfiguration will take place. The most common way to use this is "ip=dhcp".
</p>
<p>For parameters explanation, see the <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">kernel doc</a>.
</p>
<dl><dt>Examples</dt></dl>
<pre> ip=127.0.0.1:::::lo:none  --&gt; Enable the loopback interface.
 ip=192.168.1.1:::::eth2:none --&gt; Enable static eth2 interface.
 ip=:::::eth0:dhcp --&gt; Enable dhcp protocol for eth0 configuration.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure to use kernel device names (e.g. <i>eth0</i>) for the <code>&lt;device&gt;</code> parameter, and not <a href="../en/Network_configuration.html#Device_names" title="Network configuration">udev</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> ones (e.g. <i>enp2s0</i>) as those will not work.</div>
<p><b>BOOTIF=</b>
</p>
<p>If you have multiple network cards, this parameter can include the MAC address of the interface you are booting from. This is often useful as interface numbering may change, or in conjunction with pxelinux IPAPPEND 2 or IPAPPEND 3 option.
If not given, eth0 will be used.
</p>
<p><i>Example:</i>
</p>
<pre> BOOTIF=01-A1-B2-C3-D4-E5-F6  # Note the prepended "01-" and capital letters.
</pre>
<p><b>nfsroot=</b>
</p>
<p>If the <code>nfsroot</code> parameter is NOT given on the command line, the default <code>/tftpboot/%s</code> will be used.
</p>
<pre> nfsroot=[&lt;server-ip&gt;:]&lt;root-dir&gt;[,&lt;nfs-options&gt;]
</pre>
<p><i>Parameter explanation:</i>
</p>
<pre> &lt;server-ip&gt;   Specifies the IP address of the NFS server. If this field
               is not given, the default address as determined by the
               `ip' variable (see below) is used. One use of this
               parameter is for example to allow using different servers
               for RARP and NFS. Usually you can leave this blank.
 
 &lt;root-dir&gt;    Name of the directory on the server to mount as root. If
               there is a "%s" token in the string, the token will be
               replaced by the ASCII-representation of the client's IP
               address.
 
 &lt;nfs-options&gt; Standard NFS options. All options are separated by commas.
               If the options field is not given, the following defaults
               will be used:
                       port            = as given by server portmap daemon
                       rsize           = 1024
                       wsize           = 1024
                       timeo           = 7
                       retrans         = 3
                       acregmin        = 3
                       acregmax        = 60
                       acdirmin        = 30
                       acdirmax        = 60
                       flags           = hard, nointr, noposix, cto, ac
</pre>
<p><b>root=/dev/nfs</b>
</p>
<p>If you do not use the <code>nfsroot</code> parameter, you need to set <code>root=/dev/nfs</code> to boot from an NFS root via automatic configuration.
</p>
<h3><span class="mw-headline" id="Using_LVM">Using LVM</span></h3>
<p>If your root device is on <a href="../en/LVM.html" title="LVM">LVM</a>, see <a href="../en/LVM.html#Configure_mkinitcpio" title="LVM">LVM#Configure mkinitcpio</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.
</p>
<h3><span class="mw-headline" id="Using_encrypted_root">Using encrypted root</span></h3>
<p>If using an <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">encrypted root</a> see <a href="../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">Dm-crypt/System configuration#mkinitcpio</a> for detailed information on which hooks to include.
</p>
<h3>
<span id=".2Fusr_as_a_separate_partition"></span><span class="mw-headline" id="/usr_as_a_separate_partition">/usr as a separate partition</span>
</h3>
<p>If you keep <code>/usr</code> as a separate partition, you must adhere to the following requirements:
</p>
<ul>
<li>Add the <code>fsck</code> hook, mark <code>/usr</code> with a <code>passno</code> of <code>0</code> in <code>/etc/fstab</code>. While recommended for everyone, it is mandatory if you want your <code>/usr</code> partition to be fsck'ed at boot-up. Without this hook, <code>/usr</code> will never be fsck'd.</li>
<li>Add the <code>usr</code> hook. This will mount the <code>/usr</code> partition after root is mounted.</li>
</ul>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Extracting_the_image">Extracting the image</span></h3>
<p>If you are curious about what is inside the initrd image, you can extract it and poke at the files inside of it. 
</p>
<p>The initrd image is an SVR4 CPIO archive, generated via the <code>find</code> and <code>bsdcpio</code> commands, optionally compressed with a compression scheme understood by the kernel. For more information on the compression schemes, see <a href="#COMPRESSION">#COMPRESSION</a>.
</p>
<p>mkinitcpio includes a utility called <code>lsinitcpio</code> which will list and extract the contents of initramfs images.
</p>
<p>You can list the files in the image with:
</p>
<pre>$ lsinitcpio /boot/initramfs-linux.img
</pre>
<p>And to extract them all in the current directory:
</p>
<pre>$ lsinitcpio -x /boot/initramfs-linux.img
</pre>
<p>You can also get a more human-friendly listing of the important parts in the image:
</p>
<pre>$ lsinitcpio -a /boot/initramfs-linux.img
</pre>
<h3><span class="mw-headline" id="Recompressing_a_modified_extracted_image">Recompressing a modified extracted image</span></h3>
<p>After extracting an image as explained above, after modifying it, you can find the command necessary to recompress it.  Edit <code>/usr/bin/mkinitcpio</code> and change the line as shown below (line 531 in mkinitcpio v20-1.)
</p>
<pre>#MKINITCPIO_PROCESS_PRESET=1 "$0" "${preset_cmd[@]}"
MKINITCPIO_PROCESS_PRESET=1 /usr/bin/bash -x "$0" "${preset_cmd[@]}"
</pre>
<p>Then running <code>mkinitcpio</code> with its usual options (typically <code>mkinitcpio -p linux</code>), toward the last 20 lines or so you will see something like:
</p>
<pre>+ find -mindepth 1 -printf '%P\0'
+ LANG=C
+ bsdcpio -0 -o -H newc --quiet
+ gzip
</pre>
<p>Which corresponds to the command you need to run, which may be:
</p>
<pre># find -mindepth 1 -printf '%P\0' | LANG=C bsdcpio -0 -o -H newc --quiet | gzip &gt; /boot/initramfs-linux.img
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It's a good idea to rename the automatically generated /boot/initramfs-linux.img before you overwrite it, so you can easily undo your changes.  Be prepared for making a mistake that prevents your system from booting.  If this happens, you will need to boot through the fallback, or a boot CD, to restore your original, run mkinitcpio to overwrite your changes, or fix them yourself and recompress the image.</div>
<h3>
<span id=".22.2Fdev_must_be_mounted.22_when_it_already_is"></span><span class="mw-headline" id='"/dev_must_be_mounted"_when_it_already_is'>"/dev must be mounted" when it already is</span>
</h3>
<p>The test used by mkinitcpio to determine if /dev is mounted is to see if /dev/fd/ is there. If everything else looks fine, it can be "created" manually by:
</p>
<pre># ln -s /proc/self/fd /dev/
</pre>
<p>(Obviously, /proc must be mounted as well. mkinitcpio requires that anyway, and that is the next thing it will check.)
</p>
<h3>
<span id="Using_systemd_HOOKS_in_a_LUKS.2FLVM.2Fresume_setup"></span><span class="mw-headline" id="Using_systemd_HOOKS_in_a_LUKS/LVM/resume_setup">Using systemd HOOKS in a LUKS/LVM/resume setup</span>
</h3>
<p>Using <code>systemd</code>/<code>sd-encrypt</code>/<code>sd-lvm2</code> <b>HOOKS</b> instead of the traditional <code>encrypt</code>/<code>lvm2</code>/<code>resume</code> requires different initrd parameters to be passed by your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>. See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1480241">this post on forum</a> for details.
</p>
<h3><span class="mw-headline" id="Possibly_missing_firmware_for_module_XXXX">Possibly missing firmware for module XXXX</span></h3>
<p>When initramfs are being rebuild after a kernel update, you might get these two warnings:
</p>
<pre>==&gt; WARNING: Possibly missing firmware for module: aic94xx
==&gt; WARNING: Possibly missing firmware for module: smsmdtv 
</pre>
<p>These appear to any Arch Linux users, especially those who have not installed these firmware modules. If you do not use hardware which uses these firmwares you can safely ignore this message.
</p>
<h3><span class="mw-headline" id="mkinitcpio_creates_images_with_all_the_shared_libraries_missing">mkinitcpio creates images with all the shared libraries missing</span></h3>
<p>If your machine fails to boot with an "Attempted to kill init!" kernel panic right off the bat (before any <code>init</code> or <code>systemd</code>-related messages appear on the screen), and running <code>lsinitcpio</code> reveals that all the shared libraries are missing from the images generated in <code>/boot</code>, make sure there is a symbolic link at <code>/usr/lib64</code> pointing to <code>/usr/lib</code>, and rebuild them all.
</p>
<h3><span class="mw-headline" id="Standard_rescue_procedures">Standard rescue procedures</span></h3>
<p>With an improper initial ram-disk a system often is unbootable. So follow a system rescue procedure like below:
</p>
<h4><span class="mw-headline" id="Boot_succeeds_on_one_machine_and_fails_on_another">Boot succeeds on one machine and fails on another</span></h4>
<p><i>mkinitcpio'</i>s <code>autodetect</code> hook filters unneeded <a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">kernel modules</a> in the primary initramfs scanning <code>/sys</code> and the modules loaded at the time it is run. If you transfer your <code>/boot</code> directory to another machine and the boot sequence fails during early userspace, it may be because the new hardware is not detected due to missing kernel modules. 
</p>
<p>To fix, first try choosing the <a href="#Image_creation_and_activation">fallback</a> image from your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Bootloader">bootloader</a>, as it is not filtered by <code>autodetect</code>. Once booted, run <i>mkinitcpio</i> on the new machine to rebuild the primary image with the correct modules. If the fallback image fails, try booting into an Arch Linux live CD/USB, chroot into the installation, and run <i>mkinitcpio</i> on the new machine. As a last resort, try <a href="#MODULES">manually</a> adding modules to the initramfs.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a href="../en/General_troubleshooting.html#Boot_problems" class="mw-redirect" title="Boot debugging">Boot debugging</a> - Debugging with GRUB</li>
<li>Linux Kernel documentation on <a rel="nofollow" class="external text" href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/plain/Documentation/filesystems/ramfs-rootfs-initramfs.txt?id=HEAD">initramfs</a>
</li>
<li>Linux Kernel documentation on <a rel="nofollow" class="external text" href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/plain/Documentation/initrd.txt?id=HEAD">initrd</a>
</li>
<li>Wikipedia article on <a href="https://en.wikipedia.org/wiki/initrd" class="extiw" title="wikipedia:initrd">initrd</a>
</li>
<li>
<b><a href="https://en.wikipedia.org/wiki/dracut_(software)" class="extiw" title="w:dracut (software)">dracut</a></b> — A cross-distribution initramfs generation tool.</li>
</ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://dracut.wiki.kernel.org/">https://dracut.wiki.kernel.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dracut">dracut</a></span>
</dd></dl>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../id/Category:Boot_process.html" title="Category:Boot process (Indonesia)">Boot process (Indonesia)</a></li>
<li><a href="../id/Category:Kernel.html" title="Category:Kernel (Indonesia)">Kernel (Indonesia)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Translateme.html" title="Category:Pages or sections flagged with Template:Translateme">Pages or sections flagged with Template:Translateme</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Mkinitcpio_(Indonesia)&amp;oldid=661182">https://wiki.archlinux.org/index.php?title=Mkinitcpio_(Indonesia)&amp;oldid=661182</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 17 April 2021, at 12:04.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
