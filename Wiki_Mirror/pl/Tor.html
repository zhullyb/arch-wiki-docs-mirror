<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Tor (Polski) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Tor_Polski rootpage-Tor_Polski skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Tor (Polski)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><br>
<b>Tor</b> (<a href="/index.php?title=J%C4%99zyk_angielski&amp;action=edit&amp;redlink=1" class="new" title="Język angielski (page does not exist)">ang.</a> <b>The Onion Router</b>) – wirtualna sieć komputerowa implementująca trasowanie cebulowe drugiej generacji. Sieć zapobiega analizie ruchu sieciowego i w konsekwencji zapewnia użytkownikom prawie anonimowy dostęp do zasobów Internet
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Wprowadzenie"><span class="tocnumber">1</span> <span class="toctext">Wprowadzenie</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Instalacja"><span class="tocnumber">2</span> <span class="toctext">Instalacja</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Konfiguracja"><span class="tocnumber">3</span> <span class="toctext">Konfiguracja</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Konfiguracja_przeka%C5%BAnika"><span class="tocnumber">3.1</span> <span class="toctext">Konfiguracja przekaźnika</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Uruchamianie_Tora_w_Chroot"><span class="tocnumber">4</span> <span class="toctext">Uruchamianie Tora w Chroot</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#Uruchamianie_Tora_w_kontenerze_systemd-nspawn_z_wirtualnym_interfejsem_sieciowym"><span class="tocnumber">5</span> <span class="toctext">Uruchamianie Tora w kontenerze systemd-nspawn z wirtualnym interfejsem sieciowym</span></a>
<ul>
<li class="toclevel-2 tocsection-7">
<a href="#Instalacja_i_konfiguracja_hosta"><span class="tocnumber">5.1</span> <span class="toctext">Instalacja i konfiguracja hosta</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Wirtualny_interfejs_sieciowy"><span class="tocnumber">5.1.1</span> <span class="toctext">Wirtualny interfejs sieciowy</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Uruchom_i_w%C5%82%C4%85cz_systemd-nspawn"><span class="tocnumber">5.1.2</span> <span class="toctext">Uruchom i włącz systemd-nspawn</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Usage"><span class="tocnumber">6</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-11">
<a href="#Web_browsing"><span class="tocnumber">7</span> <span class="toctext">Web browsing</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Firefox"><span class="tocnumber">7.1</span> <span class="toctext">Firefox</span></a></li>
<li class="toclevel-2 tocsection-13">
<a href="#Chromium"><span class="tocnumber">7.2</span> <span class="toctext">Chromium</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Debug"><span class="tocnumber">7.2.1</span> <span class="toctext">Debug</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Rozbudowa"><span class="tocnumber">7.2.2</span> <span class="toctext">Rozbudowa</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-16"><a href="#Luakit"><span class="tocnumber">7.3</span> <span class="toctext">Luakit</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#HTTP_proxy"><span class="tocnumber">8</span> <span class="toctext">HTTP proxy</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Firefox_2"><span class="tocnumber">8.1</span> <span class="toctext">Firefox</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Polipo"><span class="tocnumber">8.2</span> <span class="toctext">Polipo</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Privoxy"><span class="tocnumber">8.3</span> <span class="toctext">Privoxy</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21">
<a href="#komunikatory"><span class="tocnumber">9</span> <span class="toctext">komunikatory</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#Pidgin"><span class="tocnumber">9.1</span> <span class="toctext">Pidgin</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#Irssi"><span class="tocnumber">10</span> <span class="toctext">Irssi</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="#Pacman"><span class="tocnumber">11</span> <span class="toctext">Pacman</span></a></li>
<li class="toclevel-1 tocsection-25">
<a href="#Uruchamianie_serwera_Tor"><span class="tocnumber">12</span> <span class="toctext">Uruchamianie serwera Tor</span></a>
<ul>
<li class="toclevel-2 tocsection-26">
<a href="#Uruchamianie_mostka_Tora"><span class="tocnumber">12.1</span> <span class="toctext">Uruchamianie mostka Tora</span></a>
<ul>
<li class="toclevel-3 tocsection-27"><a href="#Konfiguracja_2"><span class="tocnumber">12.1.1</span> <span class="toctext">Konfiguracja</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-28">
<a href="#Uruchamianie_przeka%C5%BAnika_Tora"><span class="tocnumber">12.2</span> <span class="toctext">Uruchamianie przekaźnika Tora</span></a>
<ul>
<li class="toclevel-3 tocsection-29"><a href="#Konfiguracja_3"><span class="tocnumber">12.2.1</span> <span class="toctext">Konfiguracja</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-30">
<a href="#Uruchomienie_w%C4%99z%C5%82a_wyj%C5%9Bciowego_Tora"><span class="tocnumber">12.3</span> <span class="toctext">Uruchomienie węzła wyjściowego Tora</span></a>
<ul>
<li class="toclevel-3 tocsection-31"><a href="#Konfiguracja_4"><span class="tocnumber">12.3.1</span> <span class="toctext">Konfiguracja</span></a></li>
<li class="toclevel-3 tocsection-32">
<a href="#+100Mbps_Exit_Relay_configuration_example"><span class="tocnumber">12.3.2</span> <span class="toctext">+100Mbps Exit Relay configuration example</span></a>
<ul>
<li class="toclevel-4 tocsection-33">
<a href="#Tor"><span class="tocnumber">12.3.2.1</span> <span class="toctext">Tor</span></a>
<ul>
<li class="toclevel-5 tocsection-34"><a href="#Podnie%C5%9B_maksymaln%C4%85_liczb%C4%99_otwartych_deskryptor%C3%B3w_plik%C3%B3w"><span class="tocnumber">12.3.2.1.1</span> <span class="toctext">Podnieś maksymalną liczbę otwartych deskryptorów plików</span></a></li>
<li class="toclevel-5 tocsection-35"><a href="#Uruchom_tor.service_jako_root,_aby_powi%C4%85za%C4%87_Tora_z_portami_uprzywilejowanymi"><span class="tocnumber">12.3.2.1.2</span> <span class="toctext">Uruchom tor.service jako root, aby powiązać Tora z portami uprzywilejowanymi</span></a></li>
<li class="toclevel-5 tocsection-36"><a href="#Konfiguracja_Tora"><span class="tocnumber">12.3.2.1.3</span> <span class="toctext">Konfiguracja Tora</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-37"><a href="#arm"><span class="tocnumber">12.3.2.2</span> <span class="toctext">arm</span></a></li>
<li class="toclevel-4 tocsection-38"><a href="#iptables"><span class="tocnumber">12.3.2.3</span> <span class="toctext">iptables</span></a></li>
<li class="toclevel-4 tocsection-39"><a href="#Haveged"><span class="tocnumber">12.3.2.4</span> <span class="toctext">Haveged</span></a></li>
<li class="toclevel-4 tocsection-40">
<a href="#pdnsd"><span class="tocnumber">12.3.2.5</span> <span class="toctext">pdnsd</span></a>
<ul>
<li class="toclevel-5 tocsection-41"><a href="#Nieocenzurowany_DNS"><span class="tocnumber">12.3.2.5.1</span> <span class="toctext">Nieocenzurowany DNS</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-42">
<a href="#TorDNS"><span class="tocnumber">13</span> <span class="toctext">TorDNS</span></a>
<ul>
<li class="toclevel-2 tocsection-43"><a href="#U%C5%BCywanie_TorDNS_do_wszystkich_zapyta%C5%84_DNS"><span class="tocnumber">13.1</span> <span class="toctext">Używanie TorDNS do wszystkich zapytań DNS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-44"><a href="#Torsocks"><span class="tocnumber">14</span> <span class="toctext">Torsocks</span></a></li>
<li class="toclevel-1 tocsection-45"><a href="#Transparent_Torification"><span class="tocnumber">15</span> <span class="toctext">Transparent Torification</span></a></li>
<li class="toclevel-1 tocsection-46">
<a href="#Porady_i_wskaz%C3%B3wki"><span class="tocnumber">16</span> <span class="toctext">Porady i wskazówki</span></a>
<ul>
<li class="toclevel-2 tocsection-47"><a href="#Mo%C5%BCliwo%C5%9Bci_j%C4%85dra"><span class="tocnumber">16.1</span> <span class="toctext">Możliwości jądra</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-48">
<a href="#Rozwi%C4%85zywanie_problem%C3%B3w"><span class="tocnumber">17</span> <span class="toctext">Rozwiązywanie problemów</span></a>
<ul>
<li class="toclevel-2 tocsection-49"><a href="#Problem_z_warto%C5%9Bci%C4%85_u%C5%BCytkownika"><span class="tocnumber">17.1</span> <span class="toctext">Problem z wartością użytkownika</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Wprowadzenie">Wprowadzenie</span></h2>
<p>Użytkownicy sieci Tor uruchamiają serwer proxy na swoim komputerze. Oprogramowanie to łączy się z siecią Tor, okresowo negocjuje obwód wirtualny przez sieć Tor. Tor wykorzystuje kryptografię w sposób warstwowy podobnie do warstw cebuli zapewniając idealną tajemnicę między routerami. Oprogramowanie proxy tora posiada też interfejs SOCKS dla swoich klientów.
Aplikacje SOCKS-aware mogą być skierowane do sieci Tor, który następnie przepuszcza ruch przez wirtualny obwód Tora. Dzięki temu tor daje  anonimowość użytkownika końcowego.
</p>
<p>anonimowość jest uzyskana dzięki szyfrowaniu ruchu, tor wysyła zaszyfrowane pakiety przez inne węzły sieci i odszyfrowuje je na ostatnim węźle, aby odebrać ruch przed przekazaniem go do określonego serwera.
</p>
<p>Jednym z wyzwań, które należy wykonać dla anonimowości Tor, jest to, że może to być znacznie wolniejsze niż bezpośrednie połączenie ze względu na dużą liczbę ponownych trasowania ruchu
</p>
<p>Dodatkowo, chociaż Tor zapewnia ochronę przed analizą ruchu, nie może zapobiec potwierdzeniu ruchu na granicy sieci Tora (tj. Ruchu wchodzącego i wychodzącego z sieci).
</p>
<h2><span class="mw-headline" id="Instalacja">Instalacja</span></h2>
<h2><span class="mw-headline" id="Konfiguracja">Konfiguracja</span></h2>
<p>Domyślnie Tor czyta konfiguracje z pliku <code>/etc/tor/torrc</code> Opcje konfiguracji są wyjaśnione <span class="plainlinks archwiki-template-man" title="$ man 1 tor"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tor.1">tor(1)</a></span> <a rel="nofollow" class="external text" href="https://torproject.org/docs/tor-manual.html.en">Strona Tor</a>. Domyślna konfiguracja powinna działać prawidłowo dla większości użytkowników Tora.
</p>
<p>Istnieją potencjalne konflikty między konfiguracjami w <code>torrc</code> a <code>tor.service</code>.
</p>
<ul>
<li>W <code>torrc</code>, <code>RunAsDaemon</code> Powinno, jako domyślnie, być ustawione na <code>0</code>, since <code>Type=simple</code> Jest ustawiony w <code>[Service]</code> Sekcji w <code>tor.service</code>.</li>
<li>W <code>torrc</code>, <code>User</code> Nie powinien być ustawiony, chyba że <code>User=</code> jest ustawione na <code>root</code> w <code>[Service]</code> Sekcji w <code>tor.service</code>.</li>
</ul>
<h3>
<span id="Konfiguracja_przeka.C5.BAnika"></span><span class="mw-headline" id="Konfiguracja_przekaźnika">Konfiguracja przekaźnika</span>
</h3>
<p>Maksymalny numer deskryptora pliku, który może być otwarty przez Tora, można ustawić za pomocą <code>LimitNOFILE</code> i <code>tor.service</code> Szybkie przekaźniki mogą chcieć zwiększyć tę wartość.
</p>
<p>Jeśli na komputerze nie jest uruchomiony serwer WWW, a Ty nie ustawiłeś <code>AccountingMax</code>, rozważ zmianę <code>ORPort</code> na <code>443</code> lub <code>DirPort</code> na <code>80</code>. Wielu użytkowników Tora utknęło za zaporami ogniowymi, które pozwalają im tylko przeglądać Internet, a ta zmiana pozwoli im dotrzeć do przekaźnika Tora.  Jeśli używasz już portów <code>80</code> i <code>443</code>, inne przydatne porty to <code>22</code>, <code>110</code> i <code>143</code>. [1] Ale ponieważ są to uprzywilejowane porty, aby to zrobić, Tor musi działać jako root, ustawiając <code>User=root</code>  na <code>tor.service</code> i <code>User tor</code> w <code>torrc</code>.
</p>
<p>Możesz przejrzeć cykl życia dokumentacji nowego przekaźnika Tor.
</p>
<h2><span class="mw-headline" id="Uruchamianie_Tora_w_Chroot">Uruchamianie Tora w Chroot</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  Połączenie z telnetem do lokalnego portu ControlPort wydaje się być zepsute podczas działania Tora w chroot</div>
<p>Ze względów bezpieczeństwa może być pożądane uruchomienie Tora w <a href="../en/Chroot.html" title="Chroot">chroot</a>. Poniższy skrypt stworzy odpowiedni chroot w <code>/opt/torchroot</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/torchroot-setup.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
export TORCHROOT=/opt/torchroot

mkdir -p $TORCHROOT
mkdir -p $TORCHROOT/etc/tor
mkdir -p $TORCHROOT/dev
mkdir -p $TORCHROOT/usr/bin
mkdir -p $TORCHROOT/usr/lib
mkdir -p $TORCHROOT/usr/share/tor
mkdir -p $TORCHROOT/var/lib

ln -s /usr/lib  $TORCHROOT/lib
cp /etc/hosts           $TORCHROOT/etc/
cp /etc/host.conf       $TORCHROOT/etc/
cp /etc/localtime       $TORCHROOT/etc/
cp /etc/nsswitch.conf   $TORCHROOT/etc/
cp /etc/resolv.conf     $TORCHROOT/etc/
cp /etc/tor/torrc       $TORCHROOT/etc/tor/

cp /usr/bin/tor         $TORCHROOT/usr/bin/
cp /usr/share/tor/geoip* $TORCHROOT/usr/share/tor/
cp /lib/libnss* /lib/libnsl* /lib/ld-linux-*.so* /lib/libresolv* /lib/libgcc_s.so* $TORCHROOT/usr/lib/
cp $(ldd /usr/bin/tor | awk '{print $3}'|grep --color=never "^/") $TORCHROOT/usr/lib/
cp -r /var/lib/tor      $TORCHROOT/var/lib/
chown -R tor:tor $TORCHROOT/var/lib/tor

sh -c "grep --color=never ^tor /etc/passwd &gt; $TORCHROOT/etc/passwd"
sh -c "grep --color=never ^tor /etc/group &gt; $TORCHROOT/etc/group"

mknod -m 644 $TORCHROOT/dev/random c 1 8
mknod -m 644 $TORCHROOT/dev/urandom c 1 9
mknod -m 666 $TORCHROOT/dev/null c 1 3

if [[ "$(uname -m)" == "x86_64" ]]; then
  cp /usr/lib/ld-linux-x86-64.so* $TORCHROOT/usr/lib/.
  ln -sr /usr/lib64 $TORCHROOT/lib64
  ln -s $TORCHROOT/usr/lib ${TORCHROOT}/usr/lib64
fi

</pre>
<p>Po uruchomieniu skryptu jako root, Tor może zostać uruchomiony w <a href="../en/Chroot.html" title="Chroot">chroot</a> za pomocą polecenia:
</p>
<pre># chroot --userspec=tor:tor /opt/torchroot /usr/bin/tor
</pre>
<p>lub jeśli używasz Systemd przeładowywać usługę:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/chroot.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
User=root
ExecStart=
ExecStart=/usr/bin/sh -c "chroot --userspec=tor:tor /opt/torchroot /usr/bin/tor -f /etc/tor/torrc"
KillSignal=SIGINT</pre>
<p><br>
</p>
<h2><span class="mw-headline" id="Uruchamianie_Tora_w_kontenerze_systemd-nspawn_z_wirtualnym_interfejsem_sieciowym">Uruchamianie Tora w kontenerze systemd-nspawn z wirtualnym interfejsem sieciowym</span></h2>
<p>W tym przykładzie utworzymy kontener <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a> o nazwie <code>tor-exit</code> z wirtualnym interfejsem sieciowym macvlan.
</p>
<p>Zobacz <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">Systemd-nspawn</a> i <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a>, aby uzyskać pełną dokumentację.
</p>
<h3><span class="mw-headline" id="Instalacja_i_konfiguracja_hosta">Instalacja i konfiguracja hosta</span></h3>
<p>W tym przykładzie pojemnik znajdować się w <code>/srv/container</code>:
</p>
<pre># mkdir /srv/container/tor-exit
</pre>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span>.
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tor">tor</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/arm/">arm</a></span><sup><small>AUR</small></sup> and deselect <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> as per <a href="../en/Systemd-nspawn.html#Create_and_boot_a_minimal_Arch_Linux_container" title="Systemd-nspawn">Systemd-nspawn#Create and boot a minimal Arch Linux container</a>:
</p>
<pre># pacstrap -i -c -d /srv/container/tor-exit base tor arm
</pre>
<p>Create directory if it does not exist:
</p>
<pre># mkdir /var/lib/container
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Symlinks for <code>nspawn</code> are currently broken (as of 2016-02-04; see <a rel="nofollow" class="external free" href="https://github.com/systemd/systemd/issues/2001">https://github.com/systemd/systemd/issues/2001</a>), and will give you a "too many levels of symlinks" error. As a (possibly insecure) workaround, simply pacstrap your install to the container directory instead.</div>
<p>Symlink to register the container on the host, as per <a href="../en/Systemd-nspawn.html#Enable_container_to_start_at_boot" title="Systemd-nspawn">Systemd-nspawn#Enable container to start at boot</a>:
</p>
<pre># ln -s /srv/container/tor-exit /var/lib/container/tor-exit
</pre>
<h4><span class="mw-headline" id="Wirtualny_interfejs_sieciowy">Wirtualny interfejs sieciowy</span></h4>
<p>Utwórz katalog DropIn dla usługi kontenera:
</p>
<pre># mkdir /etc/systemd/system/systemd-nspawn@tor-exit.service.d
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/systemd-nspawn@tor-exit.service.d/tor-exit.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/systemd-nspawn --quiet --keep-unit --boot --link-journal=guest --network-macvlan=$INTERFACE --private-network --directory=/var/lib/container/%i
LimitNOFILE=32768</pre>
<p><code>--network-macvlan=$INTERFACE --private-network</code> automagicznie tworzy nazwę macvlan <code>mv-$INTERFACE</code> wewnątrz kontenera, który nie jest widoczny z hosta. <code>--private-network</code> jest implikowane przez <code>--network-macvlan=</code> zgodnie z <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1">systemd-nspawn(1)</a></span>.
Jest to wskazane ze względów bezpieczeństwa, ponieważ pozwoli ci podać prywatny adres IP do kontenera i nie będzie wiedział, jakie jest IP twojego komputera. Pomoże to ukryć żądania DNS.
</p>
<p><code>LimitNOFILE=32768</code> per <a href="#Raise_maximum_number_of_open_file_descriptors">#Raise maximum number of open file descriptors</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.
</p>
<p>Ustaw <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> zgodnie z twoją siecią w <code>/srv/container/tor-exit/etc/systemd/network/mv-$INTERFACE.network</code>.
</p>
<h4>
<span id="Uruchom_i_w.C5.82.C4.85cz_systemd-nspawn"></span><span class="mw-headline" id="Uruchom_i_włącz_systemd-nspawn">Uruchom i włącz systemd-nspawn</span>
</h4>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">Start</a> i włącz <code>systemd-nspawn@tor-exit.service</code>.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Uruchom / włącz <code>tor.service</code> <a href="../en/Systemd.html#Using_units" title="Systemd">using systemd</a>. Możesz też uruchomić go przy pomocy <code>sudo -u tor /usr/bin/tor</code>.
</p>
<p>Aby użyć programu, skonfiguruj go do użycia <code>127.0.0.1</code> lub localhost jako serwer proxy SOCKS5, z portem <code>9050</code> (zwykły tor z ustawieniami standardowymi).
Aby sprawdzić, czy Tor działa poprawnie, odwiedź stronę <a rel="nofollow" class="external text" href="https://check.torproject.org/">Tor</a>,  <a rel="nofollow" class="external text" href="http://serifos.eecs.harvard.edu/cgi-bin/ipaddr.pl?tor=1">Harvard</a> lub <a rel="nofollow" class="external text" href="https://torcheck.xenobite.eu/">Xenobite.eu</a> websites.
</p>
<h2><span class="mw-headline" id="Web_browsing">Web browsing</span></h2>
<p>Projekt Tor obsługuje obecnie przeglądanie stron internetowych za pomocą <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/?K=tor-browser">Tor Browser</a>, które można pobrać z AUR. Jest on zbudowany z poprawioną wersją rozszerzonych wydań Firefoksa. Tora można również używać ze zwykłymi przeglądarkami <a href="../en/Firefox.html" title="Firefox">Firefox</a>, <a href="../en/Chromium.html" title="Chromium">Chromium</a> i innymi przeglądarkami.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Projekt Tor zdecydowanie zaleca używanie przeglądarki Tora, jeśli chcesz pozostać anonimowy <a rel="nofollow" class="external autonumber" href="https://www.torproject.org/docs/faq.html.en#TBBOtherBrowser">[1]</a>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Aby makepkg zweryfikował podpis w archiwum źródła AUR dla TBB, zaimportuj plik <a rel="nofollow" class="external text" href="https://www.torproject.org/docs/signing-keys.html.en">podpisywanie kluczy z projektu Tor</a> (currently 2E1AC68ED40814E0) jak wyjaśniono w <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">GnuPG#Use a keyserver</a>.</div>
<h3><span class="mw-headline" id="Firefox">Firefox</span></h3>
<p>In <i>Preferencje &gt; Ogólne &gt; Proxy sieciowe &gt; Ustawienia</i> Wybierz <i>Ręczna konfiguracja serwerów proxy</i> i wprowadź host SOCKS <code>localhost</code> z portem <code>9050</code> (SOCKS v5). Aby skierować wszystkie żądania DNS poprzez Socks Proxy Tora zaznacz także <i>Proxy DNS podczas używania z SOCKS v5</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Podczas korzystania z przeglądarki Firefox 55 lub wcześniejszej (na przykład 52 ESR) ustawienia znajdują się w Preferencje&gt; Zaawansowane&gt; Sieć&gt; Ustawienia.</div>
<h3><span class="mw-headline" id="Chromium">Chromium</span></h3>
<p>Możesz po prostu uruchomić:
</p>
<pre>$ chromium --proxy-server="socks5://myproxy:8080" --host-resolver-rules="MAP * ~NOTFOUND , EXCLUDE myproxy"
</pre>
<p>The <code>--proxy-server="socks5://myproxy:8080"</code> flaga mówi Chrome, aby wysłać wszystko <code>http://</code> i <code>https://</code> Żądania URL przez serwer proxy SOCKS <code>"myproxy:8080"</code>, przy użyciu wersji 5 protokołu SOCKS. Nazwa hosta dla tych adresów URL zostanie rozwiązana przez serwer proxy, a nie lokalnie przez Chrome.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Proxying of <code>ftp://</code> URLs through a SOCKS proxy is not yet implemented<a rel="nofollow" class="external autonumber" href="https://www.chromium.org/developers/design-documents/network-stack/socks-proxy">[2]</a>.</div>
<p>The <code>--proxy-server</code> flaga dotyczy tylko ładowań adresów URL. Istnieją inne składniki przeglądarki Chrome, które mogą bezpośrednio rozwiązać problem DNS, a tym samym ominąć ten serwer proxy. Najbardziej znaczącym takim komponentem jest "Prefetcher DNS". W związku z tym, jeśli pobieranie z wyprzedzeniem DNS nie jest wyłączone w Chrome, nadal będą wyświetlane lokalne żądania DNS przez Chrome, mimo że określiłeś serwer proxy SOCKS v5. Wyłączenie wstępnego pobierania DNS rozwiąże ten problem, ale jest to kruche rozwiązanie, ponieważ trzeba pamiętać o wszystkich obszarach w Chrome, które wysyłają surowe żądania DNS. Aby rozwiązać ten problem, następna flaga, <code>--host-resolver-rules="MAP * ~NOTFOUND , EXCLUDE myproxy"</code>, to wszystko, aby Chrome nie wysyłał żądań DNS przez sieć. Mówi, że wszystkie rozwiązania DNS mają być po prostu odwzorowane na (nieprawidłowy) adres <code>~NOTFOUND</code> (think of it as <code>0.0.0.0</code>). The <code>"EXCLUDE"</code> klauzula zrobić wyjątek dla <code>"myproxy"</code>, ponieważ w przeciwnym razie Chrome nie byłby w stanie rozwiązać adresu samego serwera proxy SOCKS, a wszystkie żądania musiałyby zawodzić <code>PROXY_CONNECTION_FAILED</code>.
</p>
<p>Aby zapobiec <a rel="nofollow" class="external text" href="https://ipleak.net/#webrtcleak">WebRTC leak</a>możesz zainstalować rozszerzenie <a rel="nofollow" class="external text" href="https://chrome.google.com/webstore/detail/webrtc-network-limiter/npeicpdbkakmehahjeeohfdhnlpdklia">WebRTC Network Limiter</a>.
</p>
<h4><span class="mw-headline" id="Debug">Debug</span></h4>
<p>Pierwszą rzeczą, którą należy sprawdzić podczas debugowania, jest karta Proxy na temat: net-internals i sprawdź, jakie są efektywne ustawienia proxy:
<code>chrome://net-internals/#proxy</code>
</p>
<p>Następnie spójrz na kartę DNS w <code>about:net-internals</code> aby upewnić się, że Chrome nie wydaje lokalnych odpowiedzi DNS:
<code>chrome://net-internals/#dns</code>
</p>
<h4><span class="mw-headline" id="Rozbudowa">Rozbudowa</span></h4>
<p>Podobnie jak w Firefoksie, możesz skonfigurować szybki przełącznik, na przykład poprzez <a rel="nofollow" class="external text" href="https://chrome.google.com/webstore/detail/dpplabbmogkhghncfbfdeeokoefdjegm">Proxy SwitchySharp</a>.
</p>
<p>Po zainstalowaniu wejdź na jego stronę konfiguracji. W zakładce "Profile Proxy" dodaj nowy profil "Tor", jeśli zaznaczone, odznacz opcję "" Użyj tego samego serwera proxy dla wszystkich protokołów ", następnie dodaj" localhost "jako Host SOCKS," " 9050 <i> do odpowiedniego portu i wybierz "SOCKS v5".</i>
</p>
<p>Opcjonalnie możesz włączyć szybkie przełączanie w zakładce "Ogólne", aby móc przełączać pomiędzy normalną nawigacją a siecią Tor, klikając lewym przyciskiem myszy ikonę Proxy SwitchySharp.
</p>
<h3><span class="mw-headline" id="Luakit">Luakit</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Obserwator nie będzie miał trudności z identyfikacją cię przez rzadki ciąg agenta użytkownika i mogą występować dalsze problemy z Flash, JavaScript lub podobnym.</div>
<p>Możesz po prostu uruchomić:
</p>
<pre>$ torsocks luakit
</pre>
<h2><span class="mw-headline" id="HTTP_proxy">HTTP proxy</span></h2>
<p>Tor może być używany z proxy HTTP takim jak <a href="../en/Polipo.html" title="Polipo">Polipo</a> lub <a href="../en/Privoxy.html" title="Privoxy">Privoxy</a>, jednak zespół deweloperów Tor zaleca korzystanie z biblioteki SOCKS5, ponieważ przeglądarki bezpośrednio ją obsługują.
</p>
<h3><span class="mw-headline" id="Firefox_2">Firefox</span></h3>
<p>Dodatek FoxyProxy umożliwia określenie wielu serwerów proxy dla różnych adresów URL lub dla wszystkich przeglądanych stron. Po ponownym uruchomieniu przeglądarki Firefox ręcznie ustaw Firefoxa na port
<code>8118</code> na <code>localhost</code> czyli w miejscu, gdzie działają <a href="../en/Polipo.html" title="Polipo">Polipo</a> lub <a href="../en/Privoxy.html" title="Privoxy">Privoxy</a>. Te ustawienia można uzyskać w opcji Dodaj&gt; Standardowy typ proxy. Wybierz etykietę serwera proxy (np. Tor) i wprowadź port i hosta w polach Proxy HTTP i SSL Proxy. Aby sprawdzić, czy Tor działa poprawnie, odwiedź stronę Tor Check i przełącz Tor'a.
</p>
<h3><span class="mw-headline" id="Polipo">Polipo</span></h3>
<p>Projekt Tor utworzył niestandardowy <a rel="nofollow" class="external text" href="https://gitweb.torproject.org/torbrowser.git/plain/build-scripts/config/polipo.conf?id=1ffcd9dafb9dd76c3a29dd686e05a71a95599fb5">plik konfiguracyjny Polipo</a>, aby zapobiec potencjalnym problemom z Polipo, a także zapewnić lepszą anonimowość
</p>
<p>Pamiętaj, że Polipo nie jest wymagany, jeśli możesz użyć proxy SOCKS 5, które Tor uruchamia się automatycznie na porcie 9050. Jeśli chcesz używać Chromium z Tor, nie potrzebujesz pakietu Polipo (patrz: <a href="#Chromium">#Chromium</a>).
</p>
<h3><span class="mw-headline" id="Privoxy">Privoxy</span></h3>
<p>Możesz także użyć tej konfiguracji w innych aplikacjach, takich jak przesyłanie wiadomości (np. Jabber, IRC). Aplikacje obsługujące serwery proxy HTTP, które można podłączyć do Privoxy (tj. <code>127.0.0.1:8118</code>). Aby bezpośrednio używać proxy SOCKS, możesz wskazać swoją aplikację w Tora (tj. <code>127.0.0.1:9050</code>). Problem z tą metodą polega jednak na tym, że aplikacje wykonujące DNS samodzielnie mogą powodować wyciek informacji. Rozważ użycie Socks4A (np. Z Privoxy).
</p>
<h2><span class="mw-headline" id="komunikatory">komunikatory</span></h2>
<p>Aby korzystać z komunikatora internetowego, nie potrzebujemy proxy http, takiego jak <a href="../en/Polipo.html" title="Polipo">polipo</a>/<a href="../en/Privoxy.html" title="Privoxy">privoxy</a>. Będziemy używać demona tor'a bezpośrednio, który domyślnie nasłuchuje na porcie 9050.
</p>
<h3><span class="mw-headline" id="Pidgin">Pidgin</span></h3>
<p>Możesz skonfigurować Pidgin do korzystania z Tora globalnie lub na konto. Aby używać Tora globalnie, przejdź do Narzędzia -&gt; Preferencje -&gt; Proxy. Aby używać Tora dla określonych kont, przejdź do sekcji "Konta&gt; Zarządzaj kontami", wybierz żądane konto, kliknij przycisk Modyfikuj, a następnie przejdź do karty Proxy. Ustawienia serwera proxy są następujące:
</p>
<pre>Proxy type SOCKS5
Host 127.0.0.1
Port 9150
</pre>
<h2><span class="mw-headline" id="Irssi">Irssi</span></h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>cap_sasl.pl</code> is broken with <i>perl</i> 5.20; SSL does also not work with <code>torsocks</code> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Tor_(Polski)">Talk:Tor (Polski)#</a>)</div>
</div>
<p>Freenode recommends connecting to <code>.onion</code> directly. It also requires charybdis and ircd-seven's SASL mechanism for identifying to nickserv during connection; see <a href="../en/Irssi.html#Authenticating_with_SASL" title="Irssi">Irssi#Authenticating with SASL</a>. Start irssi:
</p>
<pre>$ torsocks irssi
</pre>
<p>Set your identification to nickserv, which will be read when connecting. Supported mechanisms are ECDSA-NIST256P-CHALLENGE (see <a rel="nofollow" class="external text" href="https://github.com/atheme/ecdsatool/blob/master/cap_sasl.pl">ecdsatool</a>)  and PLAIN. DH-BLOWFISH is <a rel="nofollow" class="external text" href="https://freenode.net/sasl/sasl-irssi.shtml">no longer supported</a>.
</p>
<pre>/sasl set <i>network</i> <i>username</i> <i>password</i> <i>mechanism</i>
</pre>
<p>Disable CTCP and DCC and set a different hostname to prevent information disclosure: <a rel="nofollow" class="external autonumber" href="https://encrypteverything.ca/IRC_Anonymity_Guide">[3]</a>
</p>
<pre>/ignore * CTCPS
/ignore * DCC
/set hostname <i>fake_host</i>
</pre>
<p>Connect to Freenode:
</p>
<pre>/connect -network <i>network</i> frxleqtzgvwkv7oz.onion
</pre>
<p>For more information check <a rel="nofollow" class="external text" href="http://freenode.net/irc_servers.shtml#tor">Accessing freenode Via Tor</a>, <a rel="nofollow" class="external text" href="http://freenode.net/sasl/README.txt">SASL README</a> or <a rel="nofollow" class="external text" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/IrcSilc">IRC/SILC Wiki article</a>.
</p>
<h2><span class="mw-headline" id="Pacman">Pacman</span></h2>
<p>Operacje pobierania Pacmana (bazy danych repozytorium, pakiety i klucze publiczne) można wykonywać za pomocą sieci Tor.
</p>
<p>Zalety:
</p>
<ul>
<li>Osoby atakujące, które mogą monitorować twoje połączenie internetowe i które są skierowane konkretnie do twojego komputera, nie mogą już oglądać aktualizacji i z tego powodu nie mogą wydedukować pakietów, które zainstalowałeś, jak są aktualne, kiedy i jak często je aktualizujesz. Osoba atakująca może się jeszcze dowiedzieć, jakie oprogramowanie i wersje używasz innymi metodami, na przykład podczas oglądania pakietów z serwera http lub sprawdzania, czy urządzenie pokaże, że masz zainstalowany serwer HTTP i jego wersję.</li>
<li>Jeśli zwierciadło nie jest cebulką, złośliwe węzły wyjściowe, przez które przechodzisz, mogą oglądać aktualizacje i mogą zdecydować się na atak, jednak prawdopodobnie nie będą wiedzieć, kto atakuje..</li>
<li>Atakujący próbujący sprawić, że twoja maszyna uwierzy, że nie ma żadnych nowych aktualizacji, aby uniemożliwić mu uzyskanie poprawek bezpieczeństwa, będzie miał trudniejszy czas, ponieważ nie mogą one konkretnie kierować na twoją maszynę.</li>
</ul>
<p>Wady:
</p>
<ul><li>Dłuższe czasy aktualizacji ze względu na dłuższe opóźnienia i mniejszą przepustowość. Może to stanowić duże zagrożenie dla bezpieczeństwa, jeśli aktualizacje będą musiały być wykonane tak szybko, jak to możliwe, szczególnie na komputerach podłączonych bezpośrednio do Internetu. Tak jest w przypadku ogromnej luki w zabezpieczeniach i że błędy są szybkie do sondowania, łatwe do wykorzystania, a napastnicy już rozpoczęli atakowanie tak wielu systemów, jak tylko mogą, zanim systemy zostaną zaktualizowane.</li></ul>
<p>Niezawodność z Tor:
</p>
<ul>
<li>Nie potrzebujesz już działającego DNS.</li>
<li>Jesteś zależny od sieci Tor i węzłów wyjściowych, które nie blokują aktualizacji.</li>
<li>Jesteś zależny od demona Tora, aby działał poprawnie. Demon Tora może nie działać, jeśli nie ma do niego więcej miejsca na dysku. "Zarezerwowane bloki gid:" w ext4, przydziałach lub w inny sposób mogą to naprawić.</li>
<li>Jeśli jesteś w kraju, w którym Tor jest zablokowany lub w ogóle nie ma żadnych użytkowników Tor, powinieneś użyć mostów.</li>
</ul>
<p>Uwaga na GPG:
</p>
<p>W magazynie archim, pacman ufaj tylko kluczom, które są podpisane przez ciebie (Można to zrobić za pomocą klawisza pacman -lub-klucz) lub podpisane przez 3 z 5 kluczy Arch master. Jeśli złośliwy węzeł wyjściowy zastąpi pakiety tymi, które zostały podpisane przez jego klucz, pacman nie pozwoli użytkownikowi zainstalować pakietu.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl --socks5-hostname localhost:9050 -C - -f %u &gt; %o
...</pre>
<h2><span class="mw-headline" id="Uruchamianie_serwera_Tor">Uruchamianie serwera Tor</span></h2>
<p>Sieć Tor jest zależna od ludzi, którzy wnoszą przepustowość i konfigurują usługi. Istnieje kilka sposobów na wniesienie wkładu do sieci.
</p>
<h3><span class="mw-headline" id="Uruchamianie_mostka_Tora">Uruchamianie mostka Tora</span></h3>
<p>Mostki Tora jest przekaźnikiem sieci Tor, który nie jest wymieniony w publicznym katalogu Tora, umożliwiając tym ludziom łączenie się z siecią Tor, gdy rządy lub dostawcy usług internetowych blokują wszystkie publiczne przekaźniki Tora.
</p>
<h4><span class="mw-headline" id="Konfiguracja_2">Konfiguracja</span></h4>
<p>Zgodnie z <a rel="nofollow" class="external free" href="https://www.torproject.org/docs/bridges">https://www.torproject.org/docs/bridges</a>, Stwórz swój <code>torrc</code> być tylko tymi czterema liniami (Domyślnie: <code>/etc/tor/torrc</code>, i <code>$HOME/.torrc</code> jeśli ten plik nie zostanie znaleziony)
</p>
<dl><dd></dd></dl>
<pre>   SocksPort 0
   ORPort 443
   BridgeRelay 1
   Exitpolicy reject *:*
</pre>
<h3>
<span id="Uruchamianie_przeka.C5.BAnika_Tora"></span><span class="mw-headline" id="Uruchamianie_przekaźnika_Tora">Uruchamianie przekaźnika Tora</span>
</h3>
<p>Oznacza to, że twoja maszyna będzie działać jako węzeł wejściowy lub przekaźnik przekazujący i, w przeciwieństwie do mostu, będzie wymieniony w publicznym katalogu Tora. Twój adres IP będzie publicznie widoczny w katalogu Tor, ale przekaźnik będzie przekazywał tylko do innych przekaźników lub węzłów wyjściowych Tora, a nie bezpośrednio do Internetu.
</p>
<h4><span class="mw-headline" id="Konfiguracja_3">Konfiguracja</span></h4>
<p>Powinieneś przynajmniej podzielić 20 KB / s:
</p>
<pre>Nickname <i>tornickname</i>
ORPort 9001                    # This TCP-Port has to be opened/forwarded in your Firewall
BandwidthRate 20 KB            # Throttle traffic to 20KB/s
BandwidthBurst 50 KB           # But allow bursts up to 50KB/s
</pre>
<p>Nie pozwalaj wyjść z Twojego przekaźnika:
</p>
<pre>ExitPolicy reject *:*
</pre>
<h3>
<span id="Uruchomienie_w.C4.99z.C5.82a_wyj.C5.9Bciowego_Tora"></span><span class="mw-headline" id="Uruchomienie_węzła_wyjściowego_Tora">Uruchomienie węzła wyjściowego Tora</span>
</h3>
<p>Wszelkie żądania od użytkownika Tora do zwykłego Internetu oczywiście muszą gdzieś wyjść z sieci, a węzły wyjściowe zapewniają tę istotną usługę. Na dostępnym hoście, żądanie pojawi się jako pochodzące z twojego komputera. Oznacza to, że uruchomienie węzła wyjściowego jest ogólnie uważane za bardziej uciążliwe pod względem prawnym niż uruchamianie innych form przekaźników Tora. Zanim staniesz się przekaźnikiem wyjścia, możesz przeczytać <a rel="nofollow" class="external text" href="https://blog.torproject.org/running-exit-node">Wskazówki dotyczące uruchamiania węzła wyjściowego przy minimalnym szykanowaniu.</a>.
</p>
<h4><span class="mw-headline" id="Konfiguracja_4">Konfiguracja</span></h4>
<p>Za pomocą narzędzia torrc można skonfigurować usługi, które mają być dozwolone za pośrednictwem węzła wyjściowego.
Zezwalaj na cały ruch:
</p>
<pre>ExitPolicy accept *:*
</pre>
<p>Zezwalaj tylko portom irc 6660-6667 na wychodzenie z węzła:
</p>
<pre>ExitPolicy accept *:6660-6667,reject *:* # Allow irc ports but no more
</pre>
<p>Domyślnie Tor blokuje niektóre porty. Możesz użyć torrc, aby to przesłonić.
</p>
<pre>ExitPolicy accept *:119        # Accept nntp as well as default exit policy
</pre>
<h4>
<span id=".2B100Mbps_Exit_Relay_configuration_example"></span><span class="mw-headline" id="+100Mbps_Exit_Relay_configuration_example">+100Mbps Exit Relay configuration example</span>
</h4>
<p>If you run a fast exit relay (+100Mbps) with <code>ORPort 443</code> and <code>DirPort 80</code> (as recommended in <a rel="nofollow" class="external text" href="http://www.torproject.org/docs/tor-relay-debian.html.en#after">Configuring a Tor relay on Debian/Ubuntu</a>) the following configuration changes might serve as inspiration to setup Tor alongside <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall, <a href="../en/Haveged.html" title="Haveged">Haveged</a> to increase system entropy and <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a> as DNS cache. It is important to <i>first</i> read <a rel="nofollow" class="external text" href="http://www.torproject.org/docs/tor-relay-debian.html.en#after">Configuring a Tor relay on Debian/Ubuntu</a>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="#Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface">#Running Tor in a systemd-nspawn container with a virtual network interface</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> for instructions to install Tor in a <code>systemd-nspawn</code> container. <a href="../en/Haveged.html" title="Haveged">Haveged</a> should be installed on the container host.</div>
<h5><span class="mw-headline" id="Tor">Tor</span></h5>
<h6>
<span id="Podnie.C5.9B_maksymaln.C4.85_liczb.C4.99_otwartych_deskryptor.C3.B3w_plik.C3.B3w"></span><span class="mw-headline" id="Podnieś_maksymalną_liczbę_otwartych_deskryptorów_plików">Podnieś maksymalną liczbę otwartych deskryptorów plików</span>
</h6>
<p>Aby obsłużyć więcej niż 8192 połączeń, <code>LimitNOFILE</code> można zwiększyć do 32768 w trybie <a rel="nofollow" class="external text" href="https://www.torproject.org/docs/faq.html.en#PackagedTor">Tor FAQ</a>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/increase-file-limits.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
LimitNOFILE=32768</pre>
<p>Aby z powodzeniem podnieść  <code>nofile</code> limit, możesz również dołączyć następujące elementy:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/security/limits.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
tor     soft    nofile    32768
tor     hard    nofile    32768
@tor    soft    nofile    32768
@tor    hard    nofile    32768
</pre>
<p>Sprawdź, czy limit <code>nofile</code> (filedescriptor) został pomyślnie podniesiony za pomocą <code># sudo -u tor 'ulimit -Hn'</code> lub <code># sudo -u tor bash</code> i <code># ulimit -Hn</code>.
</p>
<h6>
<span id="Uruchom_tor.service_jako_root.2C_aby_powi.C4.85za.C4.87_Tora_z_portami_uprzywilejowanymi"></span><span class="mw-headline" id="Uruchom_tor.service_jako_root,_aby_powiązać_Tora_z_portami_uprzywilejowanymi">Uruchom tor.service jako root, aby powiązać Tora z portami uprzywilejowanymi</span>
</h6>
<p>Aby powiązać Tora z portami uprzywilejowanymi, usługa musi zostać uruchomiona jako root. Proszę sprecyzuj <code>User tor</code> opcja w <code>/etc/tor/torrc</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/start-as-root.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
User=root</pre>
<h6><span class="mw-headline" id="Konfiguracja_Tora">Konfiguracja Tora</span></h6>
<p>Aby nasłuchiwać na portach 80 i 443, usługa musi być uruchomiona jako <code>root</code>, jak opisano w <a href="#Uruchom_tor.service_jako_root,_aby_powi%C4%85za%C4%87_Tora_z_portami_uprzywilejowanymi">#Uruchom tor.service jako root, aby powiązać Tora z portami uprzywilejowanymi</a>. Użyj opcji User tor w <code>/etc/tor/torrc</code>, aby właściwie zmniejszyć uprawnienia Tora.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tor/torrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SocksPort 0                                       ## Pure relay configuration without local socks proxy

Log notice stdout                                 ## Default Tor behavior

ControlPort 9051                                  ## For arm connection
CookieAuthentication 1                            ## For arm connection

ORPort 443                                        ## Service must be started as root

Address $IP                                       ## IP or FQDN
Nickname $NICKNAME                                ## Nickname displayed in <a rel="nofollow" class="external text" href="https://onionoo.torproject.org/">Onionoo</a>

RelayBandwidthRate 500 Mbits                      ## bytes/KBytes/MBytes/GBytes/KBits/MBits/GBits
RelayBandwidthBurst 1000 MBits                    ## bytes/KBytes/MBytes/GBytes/KBits/MBits/GBits

ContactInfo $E-MAIL - $BTC-ADDRESS                ## See <a rel="nofollow" class="external text" href="https://oniontip.com/">OnionTip</a>

DirPort 80                                        ## Service must be started as root
DirPortFrontPage /etc/tor/tor-exit-notice.html    ## Original: <a rel="nofollow" class="external text" href="https://gitweb.torproject.org/tor.git/plain/contrib/operator-tools/tor-exit-notice.html">https://gitweb.torproject.org/tor.git/plain/contrib/operator-tools/tor-exit-notice.html</a>

MyFamily $($KEYID),$($KEYID)...                   ## Remember $ in front of keyid(s) ;)

ExitPolicy reject XXX.XXX.XXX.XXX/XX:*            ## Block domain of public IP in addition to std. exit policy

User tor                                          ## Return to tor user after service started as root to listen on privileged ports

DisableDebuggerAttachment 0                       ## For arm connection

### Performance related options ###
AvoidDiskWrites 1                                 ## Reduce wear on SSD
DisableAllSwap 1                                  ## Service must be started as root
HardwareAccel 1                                   ## Look for OpenSSL hardware cryptographic support
NumCPUs 2                                         ## Only start two threads</pre>
<p>Ta konfiguracja jest oparta na <a rel="nofollow" class="external text" href="https://www.torproject.org/docs/tor-manual.html.en">Tor Manual</a>. 
</p>
<p><br>
Tor domyślnie otwiera proxy soks dla portu 9050 - nawet jeśli go nie skonfigurujesz. Ustaw <code>SocksPort 0</code>, jeśli planujesz uruchomić Tor tylko jako przekaźnik, i nie nawiązywać żadnych lokalnych połączeń aplikacji.
</p>
<p><code>Log notice stdout</code> zmienia logowanie na standardowe wyjście, które jest także domyślnym ustawieniem Tora.
<code>ControlPort 9051</code>, <code>CookieAuthentication 1</code> i <code>DisableDebuggerAttachment 0</code> pozwala <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/arm/">arm</a></span><sup><small>AUR</small></sup> aby połączyć się z Torem i wyświetlić połączenia.
</p>
<p><code>ORPort 443</code> i <code>DirPort 80</code> pozwala Torowi słuchać na portach 443 i 80 oraz <code>DirPortFrontPage</code> wyświetla <a rel="nofollow" class="external text" href="https://gitweb.torproject.org/tor.git/plain/contrib/operator-tools/tor-exit-notice.html">tor-exit-notice.html</a> na porcie 80.
</p>
<p><code>ExitPolicy reject XXX.XXX.XXX.XXX/XX:*</code> powinien odzwierciedlać publiczny adres IP i maskę sieci, które można uzyskać za pomocą polecenia <code># ip addr</code>,więc połączenia wyjściowe nie mogą łączyć się z hostem lub sąsiednimi komputerami publicznym IP i ominąć zapory ogniowe.
</p>
<p><code>AvoidDiskWrites 1</code> redukuje zapisy dysku i zużycie SSD.
<code>DisableAllSwap 1</code> "spróbuje zablokować wszystkie obecne i przyszłe strony pamięci, aby pamięć nie mogła być stronicowana". 
</p>
<p>Jeśli <code># cat /proc/cpuinfo </code> zwraca, że twój procesor obsługuje instrukcje AES i <code># lsmod </code> zwraca, że moduł jest załadowany, możesz określić <code>HardwareAccel 1</code> która próbuje "użyć wbudowanej (statycznej) akceleracji sprzętowej kryptografii, gdy jest dostępna", zobacz <a rel="nofollow" class="external text" href="http://www.torservers.net/wiki/setup/server#aes-ni_crypto_acceleration">http://www.torservers.net/wiki/setup/server#aes-ni_crypto_acceleration</a>.
</p>
<p><code>ORPort 443</code>, <code>DirPort 80</code> i <code>DisableAllSwap 1</code> wymaga uruchomienia usługi Tora jako <code>root</code> as described in <a href="#Uruchom_tor.service_jako_root,_aby_powi%C4%85za%C4%87_Tora_z_portami_uprzywilejowanymi">#Uruchom tor.service jako root, aby powiązać Tora z portami uprzywilejowanymi</a>.
Użyj <code>User tor</code> opcja właściwego zmniejszenia uprawnień Tora.
</p>
<h5><span class="mw-headline" id="arm">arm</span></h5>
<p>Jeśli <code>ControlPort 9051</code> i <code>CookieAuthentication 1</code> jest określony w <code>/etc/tor/torrc</code>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/arm/">arm</a></span><sup><small>AUR</small></sup> można zacząć z <code>sudo -u tor arm</code>.
Jeśli chcesz oglądać połączenia Tora w <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/arm/">arm</a></span><sup><small>AUR</small></sup> <code>DisableDebuggerAttachment 0</code> należy również określić.
</p>
<h5><span class="mw-headline" id="iptables">iptables</span></h5>
<p>Skonfiguruj i naucz się korzystać z <a href="../en/Iptables.html" title="Iptables">iptables</a>. <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a>, w której śledzenie połączeń musiałoby śledzić tysiące połączeń w wyjściowym przekaźniku tor, ta konfiguracja zapory jest bezpaństwowa..
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/iptables/iptables.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*raw
-A PREROUTING -j NOTRACK
-A OUTPUT -j NOTRACK
COMMIT

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p tcp ! --syn -j ACCEPT
-A INPUT -p udp -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -i lo -j ACCEPT
COMMIT</pre>
<p><code>-A PREROUTING -j NOTRACK</code> i <code>-A OUTPUT -j NOTRACK</code> wyłącza śledzenie połączeń w <code>raw</code> table.
</p>
<p><code>:INPUT DROP [0:0]</code> jest domyślny <code>INPUT</code> cel i opuszcza ruch wejściowy, którego nie robimy <code>ACCEPT</code>.
</p>
<p><code>:FORWARD DROP [0:0]</code> jest domyślny <code>FORWARD</code> cel i ma znaczenie tylko wtedy, gdy host jest normalnym routerem, a nie hostem, który jest routerem cebulowym.
</p>
<p><code>:OUTPUT ACCEPT [0:0]</code> jest domyślny <code>OUTPUT</code> cel i pozwala na wszystkie połączenia wychodzące.
</p>
<p><code>-A INPUT -p tcp ! --syn -j ACCEPT</code> zezwól na już ustanowione przychodzące połączenia TCP zgodnie z poniższymi regułami i połączeniami TCP ustanowionymi z węzła wyjściowego.
</p>
<p><code>-A INPUT -p udp -j ACCEPT</code> zezwól na wszystkie przychodzące połączenia UDP, ponieważ nie używamy śledzenia połączeń.
</p>
<p><code>-A INPUT -p icmp -j ACCEPT</code> pozwalać na <a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol" class="extiw" title="wikipedia:Internet Control Message Protocol">ICMP</a>.
</p>
<p><code>-A INPUT -p tcp --dport 443 -j ACCEPT</code>zezwól na połączenia przychodzące do <code>ORPort</code>.
</p>
<p><code>-A INPUT -p tcp --dport 80 -j ACCEPT</code> zezwól na połączenia przychodzące do <code>DirPort</code>.
</p>
<p><code>-A INPUT -i lo -j ACCEPT</code> Pozwala wszystkie połączenia na interfejsie loopback.
</p>
<h5><span class="mw-headline" id="Haveged">Haveged</span></h5>
<p>Zobacz Haveged, aby zdecydować, czy twój system generuje wystarczającą entropię, aby obsłużyć wiele połączeń OpenSSL, patrz <a rel="nofollow" class="external text" href="http://www.issihosts.com/haveged/">haveged - A simple entropy daemon</a> i <a rel="nofollow" class="external text" href="http://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged">how-to-setup-additional-entropy-for-cloud-servers-using-haveged</a> do dokumentacji.
</p>
<h5><span class="mw-headline" id="pdnsd">pdnsd</span></h5>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Ta konfiguracja zakłada, że twój resolver sieciowy DNS jest zaufany (nieocenzurowany).</div>
<p>Możesz użyć <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a> do buforowania zapytań DNS lokalnie, więc przekaźnik wyjściowy może rozwiązać DNS szybciej, a przekaźnik wyjściowy nie przekazuje wszystkich zapytań DNS do zewnętrznego rekursora DNS.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pdnsd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
perm_cache=102400                       ## (Default value)*100 = 1MB * 100 = 100MB
...
server {
    label= "resolvconf";
    file = "/etc/pdnsd-resolv.conf";    ## Preferably do not use /etc/resolv.conf
    timeout=4;                          ## Server timeout, this may be much shorter than the global timeout option.
    uptest=query;                       ## Test availability using empty DNS queries. 
    query_test_name=".";                ## To be used if remote servers ignore empty queries.
    interval=10m;                       ## Test every 10 minutes.
    purge_cache=off;                    ## Ignore TTL.
    edns_query=yes;                     ## Use EDNS for outgoing queries to allow UDP messages larger than 512 bytes. May cause trouble with some legacy systems.
    preset=off;                         ## Assume server is down before uptest.
 }
...</pre>
<p>Ten skrót konfiguracji pokazuje, jak cacheować kwerendy do twojego normalnego rekursora DNS lokalnie i zwiększać rozmiar pamięci podręcznej pdnsd do 100 MB.
</p>
<h6><span class="mw-headline" id="Nieocenzurowany_DNS">Nieocenzurowany DNS</span></h6>
<p>Jeśli twój lokalny rekursor DNS jest w jakiś sposób ocenzurowany lub ingeruje w zapytania DNS, zobacz <a href="../en/Domain_name_resolution.html#Alternative_DNS_servers" class="mw-redirect" title="Resolv.conf">Resolv.conf#Alternative DNS servers</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> dla alternatyw i dodaj je w oddzielnej sekcji serwera w <code>/etc/pdnsd.conf</code> zgodnie <a href="../en/Pdnsd.html#DNS_servers" title="Pdnsd">Pdnsd#DNS servers</a>.
</p>
<h2><span class="mw-headline" id="TorDNS">TorDNS</span></h2>
<p>Tor 0.2.x zapewnia wbudowany forwarder DNS. Aby go włączyć dodaj następujące linie do pliku konfiguracyjnego Tora i zrestartuj demona:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tor/torrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DNSPort 9053
AutomapHostsOnResolve 1
AutomapHostsSuffixes .exit,.onion
</pre>
<p>Umożliwi to Torowi zaakceptowanie żądań DNS (nasłuchiwanie na porcie 9053 w tym przykładzie) jak zwykłego serwera DNS i rozwiązanie domeny za pośrednictwem sieci Tor. Wadą jest to, że jest w stanie rozwiązywać zapytania DNS tylko dla rekordów A; Zapytania MX i NS nigdy nie są odbierane. Aby uzyskać więcej informacji, zobacz to <a rel="nofollow" class="external text" href="https://techstdout.boum.org/TorDns/">Debian-based introduction</a>.
</p>
<p>Zapytania DNS można również wykonać za pomocą interfejsu wiersza poleceń za pomocą polecenia <code>tor-resolve</code> Na przykład:
</p>
<pre>$ tor-resolve archlinux.org
66.211.214.131
</pre>
<h3>
<span id="U.C5.BCywanie_TorDNS_do_wszystkich_zapyta.C5.84_DNS"></span><span class="mw-headline" id="Używanie_TorDNS_do_wszystkich_zapytań_DNS">Używanie TorDNS do wszystkich zapytań DNS</span>
</h3>
<p>Możliwe jest skonfigurowanie systemu, jeśli jest to pożądane, do korzystania z TorDNS dla wszystkich zapytań, które tworzy twój system, niezależnie od tego, czy ostatecznie użyjesz Tora do połączenia się z ostatecznym miejscem docelowym. Aby to zrobić, skonfiguruj system tak, aby używał 127.0.0.1 jako swojego serwera DNS i edytuj linię "DNSPort" w katalogu <code>/etc/tor/torrc</code>, aby wyświetlić:
</p>
<pre>DNSPort 53
</pre>
<p>Alternatywnie możesz użyć lokalnego serwera buforowania DNS, takiego jak <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> lub <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a>, który również zrekompensuje, że TorDNS jest nieco wolniejszy niż tradycyjne serwery DNS. Poniższe instrukcje pokażą, jak skonfigurować <i>dnsmasq</i> do tego celu.
</p>
<p>Zmień ustawienie tora, aby wykryć żądanie DNS w porcie 9053 i zaistaluj <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span>.
</p>
<p>Zmodyfikuj plik konfiguracyjny tak, aby zawierał:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dnsmasq.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">no-resolv
port=53
server=127.0.0.1#9053
listen-address=127.0.0.1
</pre>
<p>Te konfiguracje ustawiają dnsmasq, aby nasłuchiwał tylko żądań z lokalnego komputera i używał TorDNS jako jedynego dostawcy upstream. Konieczne jest edycja pliku <code>/etc/resolv.conf</code>, aby system wysyłał zapytania tylko do serwera dnsmasq.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver 127.0.0.1
</pre>
<p>Uruchom demona <b>dnsmasq</b>.
</p>
<p>Finally if you use <i>dhcpd</i> you would need to change its settings to that it does not alter the resolv configuration file. Just add this line in the configuration file:
</p>
<p>Jeśli korzystasz z dhcpd, musisz zmienić jego ustawienia, aby nie zmieniało pliku konfiguracyjnego resolv. Po prostu dodaj tę linię w pliku konfiguracyjnym:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nohook resolv.conf
</pre>
<p>Jeśli masz już linię <i>nohook</i>, po prostu dodaj <b>resolv.conf</b> oddzielony przecinkiem.
</p>
<h2><span class="mw-headline" id="Torsocks">Torsocks</span></h2>
<p><i>torsocks'</i> umożliwiają korzystanie z aplikacji za pośrednictwem sieci Tor bez konieczności wprowadzania zmian konfiguracji w aplikacji. Ze strony podręcznika:
</p>
<p>'torsocks to wrapper między biblioteką torsocks a aplikacją, aby każda komunikacja internetowa przechodziła przez sieć Tor.<i></i>
</p>
<p>Przykład użycia:
</p>
<pre>$ torsocks elinks checkip.dyndns.org
$ torsocks wget -qO- <a rel="nofollow" class="external free" href="https://check.torproject.org/">https://check.torproject.org/</a> | grep -i congratulations
</pre>
<p><br>
</p>
<h2><span class="mw-headline" id="Transparent_Torification">Transparent Torification</span></h2>
<p>W niektórych przypadkach bezpieczniej i często łatwiej jest w przejrzysty sposób toralizować cały system, zamiast konfigurować poszczególne aplikacje do korzystania z portu soks Tor'a, nie wspominając o zapobieganiu wyciekom DNS. Transparentną toryfikację można przeprowadzić za pomocą <a href="../en/Iptables.html" title="Iptables">iptables</a> w taki sposób, że wszystkie pakiety wychodzące są przekierowywane przez <i>TransPort</i> Tora, z wyjątkiem ruchu samego Tora. Po zainstalowaniu aplikacje nie muszą być skonfigurowane do korzystania z Tora, przez Tor <i>SocksPort</i> będzie nadal działać. Działa to również dla DNS za pośrednictwem <i>DNSPort</i> Tora, ale zdajemy sobie sprawę, że Tor obsługuje tylko TCP, więc pakiety UDP inne niż DNS nie mogą być wysyłane przez Tora i dlatego muszą być całkowicie zablokowane, aby zapobiec wyciekom. Użycie iptables do przezroczystego toryfikowania systemu zapewnia porównywalnie silną ochronę przed wyciekami, ale nie zastępuje zwirtualizowanych aplikacji torowania, takich jak Whonix lub TorVM <a rel="nofollow" class="external autonumber" href="https://www.whonix.org/wiki/Comparison_with_Others">[4]</a>. Przezroczysta torifikacja również nie będzie chroniła przed atakami odcisków palców we własnym zakresie, dlatego zaleca się używanie jej w połączeniu z przeglądarką Tor (przeszukaj AUR dla wersji, którą chcesz: <a rel="nofollow" class="external free" href="https://aur.archlinux.org/packages/?K=tor-browser">https://aur.archlinux.org/packages/?K=tor-browser</a>) Aplikacje nadal mogą użyć się nazwy komputera, adresu MAC, numeru seryjnego, strefy czasowej itp., A te z uprawnieniami root mogą całkowicie wyłączyć zaporę. Innymi słowy, przezroczysta toryfikator z iptables chroni przed przypadkowymi połączeniami i wyciekami DNS przez źle skonfigurowane oprogramowanie, nie jest wystarczająca do ochrony przed złośliwym oprogramowaniem lub oprogramowaniem o poważnych lukach w zabezpieczeniach.
</p>
<p>To enable transparent torification, use the following file for <code>iptables-restore</code> and <code>ip6tables-restore</code> (internally used by <a href="../en/Systemd.html" title="Systemd">systemd</a>'s <code>iptables.service</code> and <code>ip6tables.service</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>Ten plik używa tabeli nat do wymuszania połączeń wychodzących przez TransPort lub DNSPort i blokuje wszystko, czego nie może dokonać.
</p>
<ul>
<li>Teraz za pomocą <code>--ipv6</code> i <code>--ipv4</code> dla zmian specyficznych dla protokołu. <code>iptables-restore</code> i <code>ip6tables-restore</code> Można teraz korzystać z tego samego pliku.</li>
<li>Gdzie --ipv6 lub --ipv4 jest jednoznacznie określone, <code>ip*tables-restore</code> zignoruje regułę, jeśli nie jest to właściwe dla protokołu.</li>
<li>
<code>ip6tables</code> nie wspiera <code>--reject-with</code>. Upewnij się, że twój torrc zawiera następujące linie:</li>
</ul>
<pre>SocksPort 9050
DNSPort 5353
TransPort 9040
</pre>
<p>Zobacz <span class="plainlinks archwiki-template-man" title="$ man 8 iptables"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/iptables.8">iptables(8)</a></span>.
</p>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>Jeśli pojawi się ten błąd: <code>iptables-restore: unable to initialize table 'nat'</code>, musisz załadować odpowiednie moduły jądra:
</p>
<pre># modprobe ip_tables iptable_nat ip_conntrack iptable-filter ipt_state
</pre>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/iptables/iptables.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

*nat
:PREROUTING ACCEPT [6:2126]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [17:6239]
:POSTROUTING ACCEPT [6:408]

-A PREROUTING ! -i lo -p udp -m udp --dport 53 -j REDIRECT --to-ports 5353
-A PREROUTING ! -i lo -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j REDIRECT --to-ports 9040
-A OUTPUT -o lo -j RETURN
--ipv4 -A OUTPUT -d 192.168.0.0/16 -j RETURN
-A OUTPUT -m owner --uid-owner "tor" -j RETURN
-A OUTPUT -p udp -m udp --dport 53 -j REDIRECT --to-ports 5353
-A OUTPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j REDIRECT --to-ports 9040
COMMIT

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]

-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
--ipv4 -A INPUT -p tcp -j REJECT --reject-with tcp-reset
--ipv4 -A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable
--ipv4 -A INPUT -j REJECT --reject-with icmp-proto-unreachable
--ipv6 -A INPUT -j REJECT
--ipv4 -A OUTPUT -d 127.0.0.0/8 -j ACCEPT
--ipv4 -A OUTPUT -d 192.168.0.0/16 -j ACCEPT
--ipv6 -A OUTPUT -d ::1/8 -j ACCEPT
-A OUTPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -m owner --uid-owner "tor" -j ACCEPT
--ipv4 -A OUTPUT -j REJECT --reject-with icmp-port-unreachable
--ipv6 -A OUTPUT -j REJECT
COMMIT
</pre>
<p>Ten plik działa również dla ip6tables-restore, więc możesz dowiązać symbolicznie:
</p>
<pre># ln -s /etc/iptables/iptables.rules /etc/iptables/ip6tables.rules
</pre>
<p>Upewnij się, że Tor działa, i <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">start/enable</a> the <code>iptables</code> i <code>ip6tables</code> systemd units.
</p>
<p>Możesz dodać <code>Requires=iptables.service</code> i <code>Requires=ip6tables.service</code> do dowolnej jednostki systemowej loguje użytkownika (najprawdopodobniej menedżer wyświetlania), aby zapobiec uruchomieniu procesów użytkownika przed uruchomieniem zapory. Zobacz <a href="../en/Systemd.html" title="Systemd">systemd</a>.
</p>
<h2>
<span id="Porady_i_wskaz.C3.B3wki"></span><span class="mw-headline" id="Porady_i_wskazówki">Porady i wskazówki</span>
</h2>
<h4>
<span id="Mo.C5.BCliwo.C5.9Bci_j.C4.85dra"></span><span class="mw-headline" id="Możliwości_jądra">Możliwości jądra</span>
</h4>
<p>Jeśli chcesz uruchomić tor jako użytkownik inny niż root i użyć portu niższego niż 1024, możesz użyć funkcji jądra, aby umożliwić {{ic|/usr/bin/tor} powiązanie z portami niższymi niż 1024:
</p>
<pre># setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/tor
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Każde uaktualnienie do pakietu tor spowoduje zresetowanie uprawnień, rozważ użycie <a href="../en/Pacman.html#Hooks" title="Pacman">pacman#Hooks</a>, aby automatycznie ustawić uprawnienia po uaktualnieniach</div>
<p>Jeśli korzystasz z usługi systemd, można również użyć systemd, aby nadać procesowi odpowiednie uprawnienia. Ma to tę zaletę, że uprawnienia nie muszą być ponownie stosowane po każdej aktualizacji tor:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/netcap.conf
</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
CapabilityBoundingSet=
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
AmbientCapabilities=
AmbientCapabilities=CAP_NET_BIND_SERVICE</pre>
<p>Więcej informacji na stronie <a rel="nofollow" class="external text" href="https://superuser.com/questions/710253/allow-non-root-process-to-bind-to-port-80-and-443">superuser.com</a>
</p>
<h2>
<span id="Rozwi.C4.85zywanie_problem.C3.B3w"></span><span class="mw-headline" id="Rozwiązywanie_problemów">Rozwiązywanie problemów</span>
</h2>
<h3>
<span id="Problem_z_warto.C5.9Bci.C4.85_u.C5.BCytkownika"></span><span class="mw-headline" id="Problem_z_wartością_użytkownika">Problem z wartością użytkownika</span>
</h3>
<p>Jeśli demon <b>tor</b> nie może się uruchomić, uruchom następujące polecenie jako root (lub użyj sudo)
</p>
<pre># tor
</pre>
<p>Jeśli pojawi się następujący błąd
</p>
<pre>May 23 00:27:24.624 [warn] Error setting groups to gid 43: "Operation not permitted".
May 23 00:27:24.624 [warn] If you set the "User" option, you must start Tor as root.
May 23 00:27:24.624 [warn] Failed to parse/validate config: Problem with User value. See logs for details.
May 23 00:27:24.624 [err] Reading config failed--see warnings above.
</pre>
<p>Oznacza to, że problem dotyczy wartości User, co prawdopodobnie oznacza, że jeden lub więcej plików lub katalogów w katalogu <code>/var/lib/tor</code> nie należy do tora. Można to ustalić za pomocą następującego polecenia find:
</p>
<pre>find /var/lib/tor/ ! -user tor
</pre>
<p>Wszystkie pliki lub katalogi wymienione w wynikach tej komendy muszą mieć zmienioną własność. Można to zrobić indywidualnie dla każdego pliku, jak na przykład:
</p>
<pre>chown tor:tor /var/lib/tor/filename
</pre>
<p>Lub, aby zmienić wszystko wymienione przez powyższy przykład find, zmodyfikuj polecenie do tego:
</p>
<pre>find /var/lib/tor/ ! -user tor -exec chown tor:tor {} \;
</pre>
<p>Tor powinien teraz poprawnie uruchomić się.
</p>
<p>Nadal, jeśli nie możesz uruchomić usługi tor, uruchom usługę przy użyciu root'a (spowoduje to powrót do użytkownika tor). Aby to zrobić, zmień nazwę użytkownika w pliku <code>/etc/tor/torrc</code>:
</p>
<pre>User tor
</pre>
<p>Teraz zmodyfikuj plik usługi tor systemd <code>/usr/lib/systemd/system/tor.service</code> w następujący sposób
</p>
<pre>[Service]
User=root
Group=root
Type=simple
</pre>
<p>Proces zostanie uruchomiony jako użytkownik tor. W tym celu zmień identyfikator użytkownika i grupy na tor, a także zapisz go:
</p>
<pre># chown -R tor:tor /var/lib/tor/
# chmod -R 755 /var/lib/tor
</pre>
<p>Teraz zapisz zmiany:
</p>
<pre># systemctl --system daemon-reload
</pre>
<p>Potem <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>tor.service</code>.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../pl/Category:Internet_applications.html" title="Category:Internet applications (Polski)">Internet applications (Polski)</a></li>
<li><a href="../pl/Category:Proxy_servers.html" title="Category:Proxy servers (Polski)">Proxy servers (Polski)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Tor_(Polski)&amp;oldid=635254">https://wiki.archlinux.org/index.php?title=Tor_(Polski)&amp;oldid=635254</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 September 2020, at 05:17.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
