<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Dm-crypt (Polski)/Encrypting an entire system (Polski) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Polski_Encrypting_an_entire_system_Polski rootpage-Dm-crypt_Polski skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Dm-crypt (Polski)/Encrypting an entire system (Polski)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../../pl/Dm-crypt.html" title="Dm-crypt (Polski)">Dm-crypt (Polski)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p>Poniżej przedstawiono przykłady typowych scenariuszy pełnego szyfrowania systemu z dm-crypt. Wyjaśniają wszystkie adaptacje, które należy wykonać w normalnej procedurze instalacji. Wszystkie niezbędne narzędzia znajdują się na <a rel="nofollow" class="external text" href="https://archlinux.org/download/">installation image</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Przegl%C4%85d"><span class="tocnumber">1</span> <span class="toctext">Przegląd</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#Prosty_uk%C5%82ad_partycji_z_LUKS"><span class="tocnumber">2</span> <span class="toctext">Prosty układ partycji z LUKS</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Przygotowanie_dysku"><span class="tocnumber">2.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Preparing_non-boot_partitions"><span class="tocnumber">2.2</span> <span class="toctext">Preparing non-boot partitions</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Przygotowanie_partycji_rozruchowej"><span class="tocnumber">2.3</span> <span class="toctext">Przygotowanie partycji rozruchowej</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Mounting_the_devices"><span class="tocnumber">2.4</span> <span class="toctext">Mounting the devices</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Konfigurowanie_mkinitcpio"><span class="tocnumber">2.5</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Konfiguracja_programu_rozruchowego"><span class="tocnumber">2.6</span> <span class="toctext">Konfiguracja programu rozruchowego</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#LVM_na_LUKS"><span class="tocnumber">3</span> <span class="toctext">LVM na LUKS</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Przygotowanie_dysku_2"><span class="tocnumber">3.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Przygotowywanie_wolumin%C3%B3w_logicznych"><span class="tocnumber">3.2</span> <span class="toctext">Przygotowywanie woluminów logicznych</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Przygotowanie_partycji_rozruchowej_2"><span class="tocnumber">3.3</span> <span class="toctext">Przygotowanie partycji rozruchowej</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Konfigurowanie_mkinitcpio_2"><span class="tocnumber">3.4</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Konfigurowanie_boot_loadera"><span class="tocnumber">3.5</span> <span class="toctext">Konfigurowanie boot loadera</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#LUKS_na_LVM"><span class="tocnumber">4</span> <span class="toctext">LUKS na LVM</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Przygotowanie_dysku_3"><span class="tocnumber">4.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Przygotowywanie_wolumin%C3%B3w_logicznych_2"><span class="tocnumber">4.2</span> <span class="toctext">Przygotowywanie woluminów logicznych</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Przygotowanie_partycji_rozruchowej_3"><span class="tocnumber">4.3</span> <span class="toctext">Przygotowanie partycji rozruchowej</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Konfigurowanie_mkinitcpio_3"><span class="tocnumber">4.4</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#konfiguracjae_boot_loadera"><span class="tocnumber">4.5</span> <span class="toctext">konfiguracjae boot loadera</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Konfigurowanie_fstab_i_crypttab"><span class="tocnumber">4.6</span> <span class="toctext">Konfigurowanie fstab i crypttab</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Szyfrowanie_woluminu_logicznego_/home"><span class="tocnumber">4.7</span> <span class="toctext">Szyfrowanie woluminu logicznego /home</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#LUKS_na_programowym_RAID"><span class="tocnumber">5</span> <span class="toctext">LUKS na programowym RAID</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Przygotowanie_dysku_4"><span class="tocnumber">5.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Budowanie_macierzy_RAID"><span class="tocnumber">5.2</span> <span class="toctext">Budowanie macierzy RAID</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Przygotowanie_urz%C4%85dze%C5%84_blokowych"><span class="tocnumber">5.3</span> <span class="toctext">Przygotowanie urządzeń blokowych</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Konfiguracja_boot_loadera"><span class="tocnumber">5.4</span> <span class="toctext">Konfiguracja boot loadera</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Tworzenie_plik%C3%B3w_kluczy"><span class="tocnumber">5.5</span> <span class="toctext">Tworzenie plików kluczy</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Konfigurowanie_systemu"><span class="tocnumber">5.6</span> <span class="toctext">Konfigurowanie systemu</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30">
<a href="#Zwyk%C5%82y_dm-crypt"><span class="tocnumber">6</span> <span class="toctext">Zwykły dm-crypt</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#Przygotowanie_dysku_5"><span class="tocnumber">6.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#Przygotowywanie_partycji,_kt%C3%B3re_nie_s%C4%85_uruchomione"><span class="tocnumber">6.2</span> <span class="toctext">Przygotowywanie partycji, które nie są uruchomione</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#Przygotowanie_partycji_rozruchowej_4"><span class="tocnumber">6.3</span> <span class="toctext">Przygotowanie partycji rozruchowej</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Konfigurowanie_mkinitcpio_4"><span class="tocnumber">6.4</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Konfiguracja_bootloadera"><span class="tocnumber">6.5</span> <span class="toctext">Konfiguracja bootloadera</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Po_instalacji"><span class="tocnumber">6.6</span> <span class="toctext">Po instalacji</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-37">
<a href="#Szyfrowana_partycja_rozruchowa_(GRUB)"><span class="tocnumber">7</span> <span class="toctext">Szyfrowana partycja rozruchowa (GRUB)</span></a>
<ul>
<li class="toclevel-2 tocsection-38"><a href="#Przygotowanie_dysku_6"><span class="tocnumber">7.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Przygotowywanie_wolumin%C3%B3w_logicznych_3"><span class="tocnumber">7.2</span> <span class="toctext">Przygotowywanie woluminów logicznych</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#Przygotowanie_partycji_rozruchowej_5"><span class="tocnumber">7.3</span> <span class="toctext">Przygotowanie partycji rozruchowej</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#Konfigurowanie_mkinitcpio_5"><span class="tocnumber">7.4</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Konfiguracja_botladera"><span class="tocnumber">7.5</span> <span class="toctext">Konfiguracja botladera</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Konfigurowanie_fstab_i_crypttab_2"><span class="tocnumber">7.6</span> <span class="toctext">Konfigurowanie fstab i crypttab</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-44">
<a href="#Btrfs_subvolumes_with_swap"><span class="tocnumber">8</span> <span class="toctext">Btrfs subvolumes with swap</span></a>
<ul>
<li class="toclevel-2 tocsection-45"><a href="#Przygotowanie_dysku_7"><span class="tocnumber">8.1</span> <span class="toctext">Przygotowanie dysku</span></a></li>
<li class="toclevel-2 tocsection-46">
<a href="#Przygotowanie_partycji_systemowej"><span class="tocnumber">8.2</span> <span class="toctext">Przygotowanie partycji systemowej</span></a>
<ul>
<li class="toclevel-3 tocsection-47"><a href="#Utw%C3%B3rz_kontener_LUKS"><span class="tocnumber">8.2.1</span> <span class="toctext">Utwórz kontener LUKS</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#Odblokuj_kontener_LUKS"><span class="tocnumber">8.2.2</span> <span class="toctext">Odblokuj kontener LUKS</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="#Sformatuj_zmapowane_urz%C4%85dzenie"><span class="tocnumber">8.2.3</span> <span class="toctext">Sformatuj zmapowane urządzenie</span></a></li>
<li class="toclevel-3 tocsection-50"><a href="#Zamontuj_zmapowane_urz%C4%85dzenie"><span class="tocnumber">8.2.4</span> <span class="toctext">Zamontuj zmapowane urządzenie</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-51">
<a href="#Tworzenie_subwolumin%C3%B3w_btrfs"><span class="tocnumber">8.3</span> <span class="toctext">Tworzenie subwoluminów btrfs</span></a>
<ul>
<li class="toclevel-3 tocsection-52"><a href="#Uk%C5%82ad"><span class="tocnumber">8.3.1</span> <span class="toctext">Układ</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#Create_top-level_subvolumes"><span class="tocnumber">8.3.2</span> <span class="toctext">Create top-level subvolumes</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#Mount_top-level_subvolumes"><span class="tocnumber">8.3.3</span> <span class="toctext">Mount top-level subvolumes</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#Utw%C3%B3rz_zagnie%C5%BCd%C5%BCone_subvolumes"><span class="tocnumber">8.3.4</span> <span class="toctext">Utwórz zagnieżdżone subvolumes</span></a></li>
<li class="toclevel-3 tocsection-56"><a href="#Zamontuj_ESP"><span class="tocnumber">8.3.5</span> <span class="toctext">Zamontuj ESP</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-57">
<a href="#Konfigurowanie_mkinitcpio_6"><span class="tocnumber">8.4</span> <span class="toctext">Konfigurowanie mkinitcpio</span></a>
<ul>
<li class="toclevel-3 tocsection-58"><a href="#Utw%C3%B3rz_plik_klucza"><span class="tocnumber">8.4.1</span> <span class="toctext">Utwórz plik klucza</span></a></li>
<li class="toclevel-3 tocsection-59"><a href="#Edycja_mkinitcpio.conf"><span class="tocnumber">8.4.2</span> <span class="toctext">Edycja mkinitcpio.conf</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-60"><a href="#Konfigurowanie_botladera"><span class="tocnumber">8.5</span> <span class="toctext">Konfigurowanie botladera</span></a></li>
<li class="toclevel-2 tocsection-61"><a href="#Konfiguracja_swap"><span class="tocnumber">8.6</span> <span class="toctext">Konfiguracja swap</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id="Przegl.C4.85d"></span><span class="mw-headline" id="Przegląd">Przegląd</span>
</h2>
<p>Zabezpieczenie głównego systemu plików to miejsce, w którym <i> dm-crypt </i> wyróżnia się pod względem cech, wydajności i wydajności. W przeciwieństwie do selektywnego szyfrowania systemów plików użytkownika innego niż root, zaszyfrowany system plików root może ukrywać informacje, takie jak zainstalowane programy, nazwy użytkowników wszystkich kont i popularne wektory wycieku danych, takie jak <a href="../../en/Locate.html" class="mw-redirect" title="Mlocate">mlocate</a> i <code>/var/log/</code>. Co więcej, zaszyfrowany system plików root sprawia, że manipulowanie systemem jest o wiele trudniejsze, ponieważ wszystko oprócz programu <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> i jądra jest szyfrowane.
</p>
<p>Wszystkie scenariusze zilustrowane poniżej dzielą te zalety, inne ich wady i zalety, które je różnicują:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Scenariusze
</th>
<th>Zalety
</th>
<th>Wady
</th>
</tr>
<tr>
<td>
<a href="#Prosty_uk%C5%82ad_partycji_z_LUKS">#Prosty układ partycji z LUKS</a>
<p>pokazuje podstawową i prostą konfigurację dla w pełni zaszyfrowanego rootu LUKS.
</p>
</td>
<td>
<ul><li>Proste partycjonowanie i konfiguracja</li></ul>
</td>
<td>
<ul><li>Nieelastyczny; miejsce na dysku do zaszyfrowania musi zostać wstępnie przydzielone</li></ul>
</td>
</tr>
<tr>
<td>
<a href="#LVM_na_LUKS">#LVM na LUKS</a>
<p>osiąga elastyczność partycjonowania za pomocą LVM w pojedynczej zaszyfrowanej partycji LUKS.
</p>
</td>
<td>
<ul>
<li>Proste partycjonowanie ze znajomością LVM</li>
<li>Tylko jeden klucz wymagany do odblokowania wszystkich woluminów (np. Łatwe przywrócenie ustawień z dysku)</li>
<li>Układ woluminów nie jest przezroczysty po zablokowaniu</li>
<li>Najłatwiejsza metoda na to<a href="../../en/Dm-crypt/Swap_encryption.html#With_suspend-to-disk_support" title="Dm-crypt/Swap encryption">suspension to disk</a>
</li>
</ul>
</td>
<td>
<ul>
<li>LVM dodaje dodatkową warstwę odwzorowania i hook</li>
<li>Mniej przydatne, jeśli pojedyncza objętość powinna otrzymać oddzielny klucz</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#LUKS_na_LVM">#LUKS na LVM</a>
<p>używa dm-crypt tylko po skonfigurowaniu LVM.
</p>
</td>
<td>
<ul>
<li>LVM może służyć do przechowywania zaszyfrowanych woluminów na wielu dyskach</li>
<li>Łatwe połączenie nie-szyfrowanych grup woluminów</li>
</ul>
</td>
<td>
<ul>
<li>Złożony; Zmiana woluminów wymaga również zmiany mapperów szyfrowania</li>
<li>Woluminy wymagają indywidualnych kluczy</li>
<li>Układ LVM jest przezroczysty po zablokowaniu</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#LUKS_na_programowym_RAID">#LUKS na programowym RAID</a>
<p>używa dm-crypt tylko po skonfigurowaniu RAID.
</p>
</td>
<td>
<ul><li>Analogiczny do LUKS na LVM</li></ul>
</td>
<td>
<ul><li>Analogiczny do LUKS na LVM</li></ul>
</td>
</tr>
<tr>
<td>
<a href="#Zwyk%C5%82y_dm-crypt">#Zwykły dm-crypt</a>
<p>używa trybu zwykłego dm-crypt, tj. bez nagłówka LUKS i jego opcji dla wielu kluczy. <br>W tym scenariuszu są również używane urządzenia USB <code>/boot</code> i pamięć kluczy, która może być zastosowana do innych scenariuszy.
</p>
</td>
<td>
<ul>
<li>Odporność danych dla przypadków, w których nagłówek LUKS może być uszkodzony</li>
<li>Pozwala <a href="https://en.wikipedia.org/wiki/Disk_encryption#Full_disk_encryption" class="extiw" title="wikipedia:Disk encryption">Full Disk Encryption</a>
</li>
<li>Pomaga w rozwiązywaniu <a href="../../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">problemów</a> z dyskami SSD</li>
</ul>
</td>
<td>
<ul>
<li>Dbałość o wszystkie parametry szyfrowania jest wymagana</li>
<li>Pojedynczy klucz szyfrowania i brak opcji zmiany</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#Szyfrowana_partycja_rozruchowa_(GRUB)">#Szyfrowana partycja rozruchowa (GRUB)</a>
<p>pokazuje, jak zaszyfrować partycję rozruchową za pomocą programu ładującego GRUB. <br> W tym scenariuszu używana jest również partycja ESP, którą można zastosować do innych scenariuszy.
</p>
</td>
<td>
<ul>
<li>Te same korzyści, co scenariusz, na którym opiera się instalacja (LVM na LUKS dla tego konkretnego przykładu)</li>
<li>Mniej danych pozostaje niezaszyfrowanych, tzn. Program ładujący i partycja ESP, jeśli są obecne</li>
</ul>
</td>
<td>
<ul>
<li>Te same wady, co scenariusz, na którym opiera się instalacja (LVM na LUKS dla tego konkretnego przykładu)</li>
<li>Bardziej skomplikowana konfiguracja</li>
<li>Nie obsługiwane przez inne bootloadery</li>
</ul>
</td>
</tr>
<tr>
<td>
<a href="#Btrfs_subvolumes_with_swap">#Btrfs subvolumes with swap</a>
<p>pokazuje, jak zaszyfrować <a href="../../en/Btrfs.html" title="Btrfs">Btrfs</a> system, w tym <code>/boot</code> katalog, również dodając partycję do swap, na sprzęcie UEFI.
</p>
</td>
<td>
<ul>
<li>Podobne zalety jak <a href="#Szyfrowana_partycja_rozruchowa_(GRUB)">#Szyfrowana partycja rozruchowa (GRUB)</a>
</li>
<li>Dostępność funkcji Btrfs</li>
</ul>
</td>
<td>
<ul><li>Podobne wady jak <a href="#Szyfrowana_partycja_rozruchowa_(GRUB)">#Szyfrowana partycja rozruchowa (GRUB)</a>
</li></ul>
</td>
</tr>
</tbody>
</table>
<p>Chociaż wszystkie powyższe scenariusze zapewniają o wiele większą ochronę przed zagrożeniami zewnętrznymi niż zaszyfrowane systemy plików wtórnych, mają również wspólną wadę: każdy użytkownik posiadający klucz szyfrujący jest w stanie odszyfrować cały dysk, a zatem może uzyskać dostęp do danych innych użytkowników. Jeśli jest to niepokojące, możliwe jest użycie kombinacji narzędzia blokowego i ułożonego w stos szyfrowania systemu plików i czerpania korzyści z obu. Zobacz <a href="../../en/Data-at-rest_encryption.html" class="mw-redirect" title="Disk encryption">Disk encryption</a>, aby zaplanować z wyprzedzeniem.
</p>
<p>Zobacz <a href="../../en/Dm-crypt/Drive_preparation.html#Partitioning" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation#Partitioning</a> ogólny przegląd strategii partycjonowania używanych w scenariuszach.
</p>
<p>Innym obszarem, który należy rozważyć, jest skonfigurowanie zaszyfrowanej partycji wymiany i jakiego rodzaju. Zobacz <a href="../../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">Dm-crypt/Swap encryption</a> dla alternatywy.
</p>
<p>Jeśli spodziewasz się chronić dane systemu nie tylko przed kradzieżą fizyczną, ale także przed koniecznością zabezpieczenia przed logicznym manipulowaniem, zobacz <a href="../../en/Dm-crypt/Specialties.html#Securing_the_unencrypted_boot_partition" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Securing the unencrypted boot partition</a> dla dalszych możliwości po wykonaniu jednego ze scenariuszy.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> W żadnym scenariuszu nigdy nie używaj oprogramowania do naprawy systemu plików, takiego jak fsck bezpośrednio na zaszyfrowanym woluminie, lub zniszczy wszelkie sposoby odzyskania klucza używanego do odszyfrowania plików Takie narzędzia muszą być używane zamiast odszyfrowanego (otwartego) urządzenia.</div>
<h2>
<span id="Prosty_uk.C5.82ad_partycji_z_LUKS"></span><span class="mw-headline" id="Prosty_układ_partycji_z_LUKS">Prosty układ partycji z LUKS</span>
</h2>
<p>Ten przykład obejmuje pełne szyfrowanie systemu za pomocą "dmcrypt" + LUKS w prostym układzie partycji:
</p>
<pre>+--------------------+--------------------------+--------------------------+
|Boot partition      |LUKS encrypted system     |Optional free space       |
|                    |partition                 |for additional partitions |
|/dev/sdaY           |/dev/sdaX                 |or swap to be setup later |
+--------------------+--------------------------+--------------------------+
</pre>
<p>Pierwsze kroki można wykonać bezpośrednio po uruchomieniu obrazu instalacyjnego Arch Linux.
</p>
<h3><span class="mw-headline" id="Przygotowanie_dysku">Przygotowanie dysku</span></h3>
<p>Przed utworzeniem jakichkolwiek partycji powinieneś wiedzieć o znaczeniu i metodach bezpiecznego usuwania dysku, opisanych w <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>.
</p>
<p>Następnie utwórz potrzebne partycje, przynajmniej jedną dla <code>/</code> (e.g. <code>/dev/sdaX</code>) i <code>/boot</code> (<code>/dev/sdaY</code>). Zobacz <a href="../../en/Partitioning.html" title="Partitioning">Partitioning</a>.
</p>
<h3><span class="mw-headline" id="Preparing_non-boot_partitions">Preparing non-boot partitions</span></h3>
<p>Następujące polecenia tworzą i montują zaszyfrowaną partycję root. Odpowiadają one procedurze opisanej szczegółowo w <a href="../../en/Dm-crypt/Encrypting_a_non-root_file_system.html#Partition" title="Dm-crypt/Encrypting a non-root file system">Dm-crypt/Encrypting a non-root file system#Partition</a> (which, despite the title, <i>can</i> be applied to root partitions, as long as <a href="#Konfigurowanie_mkinitcpio">mkinitcpio</a> and the <a href="#Configuring_the_boot_loader">boot loader</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> are correctly configured).
If you want to use particular non-default encryption options (e.g. cipher, key length), see the <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">encryption options</a> before executing the first command:
</p>
<p><br>
(który, pomimo tytułu, może być zastosowany do partycji root, o ile mkinitcpio i program ładujący są poprawnie skonfigurowane). Jeśli chcesz użyć określonych, innych niż domyślne opcji szyfrowania (np. Szyfr, długość klucza), zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">opcje szyfrowania</a> przed wykonaniem pierwszego polecenia:
</p>
<pre># cryptsetup -y -v luksFormat /dev/sdaX
# cryptsetup open /dev/sdaX cryptroot
# mkfs.ext4 /dev/mapper/cryptroot
# mount /dev/mapper/cryptroot /mnt
</pre>
<p>Sprawdź, czy mapowanie działa zgodnie z przeznaczeniem:
</p>
<pre># umount /mnt
# cryptsetup close cryptroot
# cryptsetup open /dev/sdaX cryptroot
# mount /dev/mapper/cryptroot /mnt
</pre>
<p>Jeśli utworzyłeś oddzielne partycje (e.g. <code>/home</code>), kroki te muszą zostać dostosowane i powtórzone dla nich wszystkich, z wyjątkiem  <code>/boot</code>. Zobacz <a href="../../en/Dm-crypt/Encrypting_a_non-root_file_system.html#Automated_unlocking_and_mounting" title="Dm-crypt/Encrypting a non-root file system">Dm-crypt/Encrypting a non-root file system#Automated unlocking and mounting</a>, jak radzić sobie z dodatkowymi partycjami podczas startu.
</p>
<p>Zauważ, że każde urządzenie blokowe wymaga własnego hasła. Może to być niewygodne, ponieważ skutkuje oddzielnym hasłem, które należy wprowadzić podczas rozruchu. Alternatywą jest użycie pliku klucza przechowywanego w partycji systemowej, aby odblokować oddzielną partycję za pośrednictwem <code>crypttab</code>. zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Using_LUKS_to_format_partitions_with_a_keyfile" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Using LUKS to format partitions with a keyfile</a> po instrukcje.
</p>
<h3><span class="mw-headline" id="Przygotowanie_partycji_rozruchowej">Przygotowanie partycji rozruchowej</span></h3>
<p>To, co musisz skonfigurować, to nieszyfrowana partycja rozruchowa, która jest potrzebna dla zaszyfrowanego katalogu głównego. Dla standardowej partycji MBR / non-EFI / boot, na przykład wykonaj:
</p>
<pre># mkfs.ext4 /dev/sdaY
# mkdir /mnt/boot
# mount /dev/sdaY /mnt/boot
</pre>
<h3><span class="mw-headline" id="Mounting_the_devices">Mounting the devices</span></h3>
<p>At <a href="../../en/Installation_guide.html#Mount_the_file_systems" title="Installation guide">Installation guide#Mount the file systems</a> you will have to mount the mapped devices, not the actual partitions. Of course <code>/boot</code>, which is not encrypted, will still have to be mounted directly.
</p>
<p>Afterwards continue with the installation procedure up to the mkinitcpio step.
</p>
<p>W Przewodniku instalacji # Zainstaluj systemy plików, w których będziesz musiał zamontować odwzorowane urządzenia, a nie rzeczywiste partycje. Oczywiście / boot, który nie jest szyfrowany, będzie musiał być montowany bezpośrednio.
</p>
<p>Następnie kontynuuj procedurę instalacji aż do kroku mkinitcpio.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio">Konfigurowanie mkinitcpio</span></h3>
<p>Dodaj <code>keyboard</code>, <code>keymap</code> i <code>encrypt</code> haki do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>. Jeśli domyślna mapa klawiszy US jest dla Ciebie w porządku, możesz pominąć <code>keymap</code> hak.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... <b>keyboard</b> <b>keymap</b> block <b>encrypt</b> ... filesystems ...)</pre>
<p>Depending on which other hooks are used, the order may be relevant. See <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> for details and other hooks that you may need.
</p>
<h3><span class="mw-headline" id="Konfiguracja_programu_rozruchowego">Konfiguracja programu rozruchowego</span></h3>
<p>Aby odblokować zaszyfrowaną partycję root przy starcie, program ładujący musi ustawić następujące parametry boot loadera:
</p>
<pre>cryptdevice=UUID=<i>&lt;device-UUID&gt;</i>:cryptroot root=/dev/mapper/cryptroot
</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> po szczegóły..
</p>
<p>The <code><i>&lt;device-UUID&gt;</i></code> refers to the UUID of <code>/dev/sdaX</code>. See <a href="../../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a> for details.
</p>
<h2><span class="mw-headline" id="LVM_na_LUKS">LVM na LUKS</span></h2>
<p>Prostą metodą jest ustawienie LVM na górze zaszyfrowanej partycji zamiast na odwrót. Technicznie LVM jest skonfigurowany w jednym dużym szyfrowanym systemie blokowym. W związku z tym LVM nie jest przezroczysta, dopóki urządzenie blokujące nie zostanie odblokowane, a podstawowa struktura woluminu zostanie odblokowana i zamontowana podczas rozruchu.
</p>
<p>Układ dysku w tym przykładzie to:
</p>
<pre>+-----------------------------------------------------------------------+ +----------------+
| Logical volume1       | Logical volume2       | Logical volume3       | |                |
|/dev/mapper/MyVol-swap |/dev/mapper/MyVol-root |/dev/mapper/MyVol-home | | Boot partition |
|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _| | (may be on     |
|                                                                       | | other device)  |
|                        LUKS encrypted partition                       | |                |
|                          /dev/sdaX                                    | | /dev/sdbY      |
+-----------------------------------------------------------------------+ +----------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This method does not allow you to span the logical volumes over multiple disks easily; see <a href="../../en/Dm-crypt/Specialties.html#Modifying_the_encrypt_hook_for_multiple_partitions" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Modifying the encrypt hook for multiple partitions</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Tdwa warianty tej konfiguracji:
<ul>
<li>Instrukcje na <a href="../../en/Dm-crypt/Specialties.html#Encrypted_system_using_a_detached_LUKS_header" title="Dm-crypt/Specialties">dm-crypt/Specialties#Encrypted system using a detached LUKS header</a> użyj tej konfiguracji z odłączonym nagłówkiem LUKS na urządzeniu USB, aby uzyskać z nim dwuetapowe uwierzytelnienie.</li>
<li>Instrukcje na <a rel="nofollow" class="external text" href="http://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/">Pavel Kogan's blog</a> pokaż, jak zaszyfrować <code>/boot</code> partycji, zachowując ją na głównej partycji LUKS podczas korzystania z GRUB-a.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Przygotowanie_dysku_2">Przygotowanie dysku</span></h3>
<p>Przed utworzeniem jakichkolwiek partycji powinieneś powinnaś wiedzieć o znaczeniu i metodach bezpiecznego usuwania dysku, opisanych w <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>.
</p>
<p>Korzystając z bootloadera <a href="../../en/GRUB.html" title="GRUB">GRUB</a> razem z <a href="../../en/Partitioning.html#GUID_Partition_Table" class="mw-redirect" title="GPT">GPT</a>, utwórz partycję rozruchową systemu BIOS, jak wyjaśniono w <a href="../../en/GRUB.html#BIOS_systems" title="GRUB">GRUB#BIOS systems</a>.
</p>
<p>Utwórz partycję do zamontowania w <code>/boot</code> typu <code>8300</code> o wielkości 100 MB lub większej.
</p>
<p>Utwórz partycję typu <code>8E00</code>, która później będzie zawierała zaszyfrowany kontener.
</p>
<p>Utwórz zaszyfrowany kontener LUKS na partycji "systemowej". Wprowadź dwukrotnie wybrane hasło.
</p>
<pre># cryptsetup luksFormat /dev/<i>sdaX</i>
</pre>
<p>Aby uzyskać więcej informacji o dostępnych opcjach cryptsetup, zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">LUKS encryption options</a> przed powyższym poleceniem.
</p>
<p>Otwórz kontener:
</p>
<pre># cryptsetup open /dev/<i>sdaX</i> cryptolvm
</pre>
<p>Odszyfrowany kontener jest teraz dostępny pod adresem <code>/dev/mapper/cryptolvm</code>.
</p>
<h3>
<span id="Przygotowywanie_wolumin.C3.B3w_logicznych"></span><span class="mw-headline" id="Przygotowywanie_woluminów_logicznych">Przygotowywanie woluminów logicznych</span>
</h3>
<p>Utwórz wolumin fizyczny na otwartym kontenerze LUKS:
</p>
<pre># pvcreate /dev/mapper/cryptolvm
</pre>
<p>Utwórz nazwę grupy woluminów <code>MyVol</code> (lub cokolwiek chcesz), dodając do niego wcześniej utworzoną wolumin fizyczny:
</p>
<pre># vgcreate MyVol /dev/mapper/cryptolvm
</pre>
<p>Utwórz wszystkie swoje woluminy logiczne w grupie woluminów:
</p>
<pre># lvcreate -L 8G MyVol -n swap
# lvcreate -L 15G MyVol -n root
# lvcreate -l 100%FREE MyVol -n home
</pre>
<p>Sformatuj systemy plików na każdym woluminie logicznym:
</p>
<pre># mkfs.ext4 /dev/mapper/MyVol-root
# mkfs.ext4 /dev/mapper/MyVol-home
# mkswap /dev/mapper/MyVol-swap
</pre>
<p>Zamontuj swoje systemy plików:
</p>
<pre># mount /dev/mapper/MyVol-root /mnt
# mkdir /mnt/home
# mount /dev/mapper/MyVol-home /mnt/home
# swapon /dev/mapper/MyVol-swap
</pre>
<h3><span class="mw-headline" id="Przygotowanie_partycji_rozruchowej_2">Przygotowanie partycji rozruchowej</span></h3>
<p>The bootloader loads the kernel, <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, and its own configuration files from the <code>/boot</code> directory. This directory must be located on a separate unencrypted filesystem.
</p>
<p>Program ładujący ładuje jądro, initramfs i własne pliki konfiguracyjne z katalogu <code>/boot</code>. Ten katalog musi znajdować się w oddzielnym niezaszyfrowanym systemie plików.
</p>
<p>Utwórz system plików Ext2 na partycji przeznaczonej dla <code>/boot</code>. Dowolny system plików, który może odczytać bootloader, jest odpowiedni.
</p>
<pre># mkfs.ext2 /dev/<i>sdbY</i>
</pre>
<p>Utwórz katalog <code>/mnt/boot</code>:
</p>
<pre># mkdir /mnt/boot
</pre>
<p>Zamontuj partycję na <code>/mnt/boot</code>:
</p>
<pre># mount /dev/<i>sdbY</i> /mnt/boot
</pre>
<p>Następnie kontynuuj procedurę instalacji aż do kroku <code>mkinitcpio</code>
</p>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio_2">Konfigurowanie mkinitcpio</span></h3>
<p>Dodaj <code>keyboard</code>, <code>encrypt</code> i <code>lvm2</code> haki do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... <b>keyboard</b> <b>keymap</b> block <b>encrypt</b> <b>lvm2</b> ... filesystems ...)</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> dla szczegółów i innych haczyków, których możesz potrzebować.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_boot_loadera">Konfigurowanie boot loadera</span></h3>
<p>Aby odblokować zaszyfrowaną partycję root przy starcie, program ładujący musi ustawić następujący boot loadera:
</p>
<pre>cryptdevice=UUID=<i>device-UUID</i>:cryptolvm root=/dev/mapper/MyVol-root
</pre>
<p>The <code><i>&lt;device-UUID&gt;</i></code> refers to the UUID of <code>/dev/sdaX</code>. See <a href="../../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a> for details.
</p>
<p>See <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> for details.
</p>
<h2><span class="mw-headline" id="LUKS_na_LVM">LUKS na LVM</span></h2>
<p>Aby użyć szyfrowania na <a href="../../en/LVM.html" title="LVM">LVM</a>, woluminy LVM są najpierw konfigurowane, a następnie wykorzystywane jako baza dla zaszyfrowanych partycji. W ten sposób możliwa jest również kombinacja zaszyfrowanych i nieszyfrowanych woluminów partycji.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Unlike <a href="#LVM_na_LUKS">#LVM na LUKS</a>, this method allows normally spanning the logical volumes over multiple disks. </div>
<p>Poniższy krótki przykład tworzy LUKS na instalacji LVM i miesza się w użyciu pliku klucza dla partycji / home i tymczasowych woluminów krypt dla / tmp i / swap. Ten ostatni jest uważany za pożądany z punktu widzenia bezpieczeństwa, ponieważ żadne potencjalnie wrażliwe dane tymczasowe nie przeżywają ponownego uruchomienia komputera, gdy szyfrowanie zostanie ponownie zainicjowane. Jeśli masz doświadczenie z LVM, będziesz mógł zignorować / zastąpić LVM i inne szczegóły zgodnie z twoim planem. Jeśli chcesz rozłożyć wolumin logiczny na wielu dyskach podczas konfiguracji, procedura do tego została opisana w <a href="../../en/Dm-crypt/Specialties.html#Expanding_LVM_on_multiple_disks" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Expanding LVM on multiple disks</a>.
</p>
<div class="noprint archwiki-template-message">
<p><a href="../../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The intro of this scenario needs some adjustment now that a comparison has been added to <a href="#Overview">#Overview</a>. A suggested structure is to make it similar to the <a href="#Simple_partition_layout_with_LUKS">#Simple partition layout with LUKS</a> intro. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dm-crypt_(Polski)/Encrypting_an_entire_system_(Polski)">Talk:Dm-crypt (Polski)/Encrypting an entire system (Polski)#</a>)</div>
</div>
<h3><span class="mw-headline" id="Przygotowanie_dysku_3">Przygotowanie dysku</span></h3>
<p>Schemat partycjonowania:
</p>
<pre>+----------------+-----------------------------------------------------------------------+
|                | LUKS encrypted volume | LUKS encrypted volume | LUKS encrypted volume |
|                | /dev/mapper/swap      | /dev/mapper/root      | /dev/mapper/home      |
|                |_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|
|                | Logical volume1       | Logical volume2       | Logical volume3       |
|                |/dev/mapper/MyVol-swap |/dev/mapper/MyVol-root |/dev/mapper/MyVol-home |
|                |_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|_ _ _ _ _ _ _ _ _ _ _ _|
| Boot partition |                                                                       |
|   /dev/sda1    |                               /dev/sda2                               |
+----------------+-----------------------------------------------------------------------+
</pre>
<p>Randomise <code>/dev/sda2</code> zgodnie z <a href="../../en/Dm-crypt/Drive_preparation.html#dm-crypt_wipe_on_an_empty_disk_or_partition" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation#dm-crypt wipe on an empty disk or partition</a>.
</p>
<h3>
<span id="Przygotowywanie_wolumin.C3.B3w_logicznych_2"></span><span class="mw-headline" id="Przygotowywanie_woluminów_logicznych_2">Przygotowywanie woluminów logicznych</span>
</h3>
<pre># pvcreate /dev/sda2
# vgcreate MyVol /dev/sda2
# lvcreate -L 10G -n lvroot MyVol
# lvcreate -L 500M -n swap MyVol
# lvcreate -L 500M -n tmp MyVol
# lvcreate -l 100%FREE -n home MyVol
</pre>
<pre># cryptsetup luksFormat -c aes-xts-plain64 -s 512 /dev/mapper/MyVol-lvroot
# cryptsetup open /dev/mapper/MyVol-lvroot root
# mkfs.ext4 /dev/mapper/root
# mount /dev/mapper/root /mnt
</pre>
<p>Więcej informacji o opcjach szyfrowania można znaleźć w <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Encryption options for LUKS mode</a>.
Zauważ, że <code>/home</code> zostanie zaszyfrowane <a href="#Encrypting_logical_volume_/home">#Encrypting logical volume /home</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>. Further, zauważ, że jeśli kiedykolwiek będziesz miał dostęp do zaszyfrowanego katalogu głównego z Arch-ISO, powyższe <code>open</code> akcja pozwoli ci po <a href="../../en/LVM.html#Logical_Volumes_do_not_show_up" title="LVM">Pojawia się LVM</a>.
</p>
<h3><span class="mw-headline" id="Przygotowanie_partycji_rozruchowej_3">Przygotowanie partycji rozruchowej</span></h3>
<pre># dd if=/dev/zero of=/dev/sda1 bs=1M status=progress
# mkfs.ext4 /dev/sda1
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
</pre>
<p>Teraz po skonfigurowaniu zaszyfrowanego partycjonowania LVM nadszedł czas na instalację: <a href="../../en/Installation_guide.html#Mount_the_file_systems" title="Installation guide">Arch Install Scripts</a>.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio_3">Konfigurowanie mkinitcpio</span></h3>
<p>Dodaj <code>keyboard</code>, <code>lvm2</code> i <code>encrypt</code> haki do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... <b>keyboard</b> <b>keymap</b> block <b>lvm2</b> <b>encrypt</b> ... filesystems ...)</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> po szczegóły i inne haki, które mogą być potrzebne.
</p>
<h3><span class="mw-headline" id="konfiguracjae_boot_loadera">konfiguracjae boot loadera</span></h3>
<p>Aby odblokować zaszyfrowaną partycję root przy starcie, program ładujący musi ustawić następujące parametry boot loadera :
</p>
<pre>cryptdevice=/dev/mapper/MyVol-lvroot:root root=/dev/mapper/root
</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> po szczegóły.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_fstab_i_crypttab">Konfigurowanie fstab i crypttab</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/root        /       ext4            defaults        0       1
/dev/sda1               /boot   ext4            defaults        0       2
/dev/mapper/tmp         /tmp    tmpfs           defaults        0       0
/dev/mapper/swap        none    swap            sw              0       0
</pre>
<p>The following crypttab options will re-encrypt the temporary filesystems each reboot:
</p>
<p>Następujące opcje <a href="../../en/Dm-crypt/System_configuration.html#crypttab" class="mw-redirect" title="Crypttab">crypttab</a> ponownie zaszyfrują tymczasowe pliki przy każdym ponownym uruchomieniu komputera:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">swap	/dev/mapper/MyVol-swap	/dev/urandom	swap,cipher=aes-xts-plain64,size=256
tmp	/dev/mapper/MyVol-tmp	/dev/urandom	tmp,cipher=aes-xts-plain64,size=256
</pre>
<h3>
<span id="Szyfrowanie_woluminu_logicznego_.2Fhome"></span><span class="mw-headline" id="Szyfrowanie_woluminu_logicznego_/home">Szyfrowanie woluminu logicznego /home</span>
</h3>
<p>Since this scenario uses LVM as the primary and dm-crypt as secondary mapper, each encrypted logical volume requires its own encryption. Yet, unlike the temporary filesystems configured with volatile encryption above, the logical volume for <code>/home</code> should be persistent, of course. The following assumes you have rebooted into the installed system, otherwise you have to adjust paths.
To safe on entering a second passphrase at boot for it, a <a href="../../en/Dm-crypt/Device_encryption.html#Keyfiles" title="Dm-crypt/Device encryption">keyfile</a> is created:
</p>
<p><br>
Ponieważ ten scenariusz używa LVM jako podstawowej i dm-crypt jako programu odwzorowującego wtórnego, każdy zaszyfrowany wolumin logiczny wymaga własnego szyfrowania. Jednak, inaczej niż w przypadku tymczasowych systemów plików skonfigurowanych powyżej z użyciem szyfrowania ulotnego, wolumin logiczny dla <code>/home</code>  powinien być oczywiście stały. Poniższe założenie zakłada ponowne uruchomienie systemu, w przeciwnym razie trzeba dostosować ścieżki. Aby zabezpieczyć się przed wprowadzeniem drugiego hasła podczas uruchamiania, tworzony jest plik <a href="../../en/Dm-crypt/Device_encryption.html#Keyfiles" title="Dm-crypt/Device encryption">klucza</a>:  
</p>
<pre># mkdir -m 700 /etc/luks-keys
# dd if=/dev/random of=/etc/luks-keys/home bs=1 count=256 status=progress
</pre>
<p>Wolumin logiczny jest zaszyfrowany:
</p>
<pre># cryptsetup luksFormat -v -s 512 /dev/mapper/MyVol-home /etc/luks-keys/home
# cryptsetup -d /etc/luks-keys/home open /dev/mapper/MyVol-home home
# mkfs.ext4 /dev/mapper/home
# mount /dev/mapper/home /home
</pre>
<p>The encrypted mount is configured in <a href="../../en/Dm-crypt/System_configuration.html#crypttab" class="mw-redirect" title="Crypttab">crypttab</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">home	/dev/mapper/MyVol-home   /etc/luks-keys/home
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/mapper/home        /home   ext4        defaults        0       2
</pre>
<p>i konfiguracja jest zakończona.
</p>
<p>Jeśli chcesz rozszerzyć wolumin logiczny dla <code>/home</code> (lub dowolnego innego woluminu) w późniejszym czasie, ważne jest, aby pamiętać, że część zaszyfrowana LUKS musi również zostać zmieniona. Aby zobaczyć procedurę, patrz <a href="../../en/Dm-crypt/Specialties.html#Expanding_LVM_on_multiple_disks" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Expanding LVM on multiple disks</a>.
</p>
<h2><span class="mw-headline" id="LUKS_na_programowym_RAID">LUKS na programowym RAID</span></h2>
<p>Ten przykład jest oparty na konfiguracji dla laptopa wyposażonego w dwa dyski SSD o jednakowej wielkości oraz dodatkowy dysk twardy dla pamięci masowej. Efektem końcowym jest oparte na LUKS pełne szyfrowanie dysku (w tym <code>/boot</code>) dla wszystkich dysków, z dyskami SSD w macierzy RAID0 i pliki kluczy używane do odblokowania całego szyfrowania po podaniu GRUB poprawnego hasła przy starcie. Obsługa formatów TRIM jest włączona na dyskach SSD, ale warto zapoznać się ze szczegółowymi informacjami na temat bezpieczeństwa <a href="../../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Discard/TRIM support for solid state drives (SSD)</a> przed rozważeniem skorzystania z tego. 
</p>
<p><br>
This setup utilizes a very simplistic partitioning scheme, with all the available RAID storage being mounted at <code>/</code> (no separate <code>/boot</code> partition), and the decrypted HDD being mounted at <code>/mnt/data</code>. It is also worth mentioning that the system in this example boots in BIOS mode and the drives are partitioned with <a href="../../en/Partitioning.html" title="Partitioning">GPT</a> partitions. 
</p>
<p><br>
Ta konfiguracja wykorzystuje bardzo uproszczony schemat partycjonowania, przy czym wszystkie dostępne pamięci RAID są montowane w / (brak oddzielnej partycji rozruchowej), a odszyfrowany dysk HDD jest montowany w {ic|/mnt/data}}. Warto również wspomnieć, że system w tym przykładzie uruchamia się w trybie BIOS, a dyski są partycjonowane przy użyciu partycji GPT.
</p>
<p>Należy pamiętać, że regularne kopie zapasowe są bardzo ważne w tej konfiguracji. Jeśli którakolwiek z dysków SSD ulegnie awarii, dane zawarte w macierzy RAID będą praktycznie niemożliwe do odzyskania. Możesz wybrać inny poziom RAID, jeśli twoja odporność na uszkodzenia jest dla ciebie ważna.
</p>
<p>W tej konfiguracji szyfrowanie nie jest zaprzeczeniem.
</p>
<p>W celu wykonania poniższych instrukcji stosuje się następujące urządzenia blokowe:
</p>
<pre>/dev/sda = first SSD
/dev/sdb = second SSD
/dev/sdc = HDD
</pre>
<p>Pamiętaj, aby zastąpić je odpowiednimi oznaczeniami urządzeń do konfiguracji, ponieważ mogą się one różnić.
</p>
<h3><span class="mw-headline" id="Przygotowanie_dysku_4">Przygotowanie dysku</span></h3>
<p>Przed utworzeniem jakichkolwiek partycji powinieneś powinnaś wiedzieć o znaczeniu i metodach bezpiecznego usuwania dysku, opisanych w <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>.
</p>
<p>Korzystając z bootloadera GRUB razem z GPT, utwórz partycję rozruchową systemu BIOS, jak wyjaśniono w systemach GRUB # BIOS. W przypadku tej konfiguracji obejmuje to partycję 1M dla "rozruchu BIOS" w <code>/dev/sda1</code>, a pozostałe miejsce na dysku jest podzielone na partycje dla "Linux RAID" w <code>/dev/sda2</code>. 
</p>
<p>Po utworzeniu partycji na <code>/dev/sda</code>, można użyć następujących komend do sklonowania ich do <code>/dev/sdb</code>.
</p>
<pre># sfdisk -d /dev/sda &gt; sda.dump
# sfdisk /dev/sdb &lt; sda.dump
</pre>
<p>Dysk twardy jest przygotowywany z pojedynczą partycją Linuksa obejmującą cały dysk w <code>/dev/sdc1</code>.
</p>
<h3><span class="mw-headline" id="Budowanie_macierzy_RAID">Budowanie macierzy RAID</span></h3>
<p>Utwórz macierz RAID dla dysków SSD. Ten przykład wykorzystuje RAID 0, możesz chcieć wykorzystać inny poziom w oparciu o twoje preferencje lub wymagania.
</p>
<pre># mdadm --create --verbose --level=0 --metadata=1.2 --raid-devices=2 /dev/md0 /dev/sda2 /dev/sdb2
</pre>
<h3>
<span id="Przygotowanie_urz.C4.85dze.C5.84_blokowych"></span><span class="mw-headline" id="Przygotowanie_urządzeń_blokowych">Przygotowanie urządzeń blokowych</span>
</h3>
<p>Jak wyjaśniono w przygotowaniu <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>, dyski są wymazywane losowymi danymi z wykorzystaniem <code>/dev/zero</code> oraz kryptograficznym z losowym kluczem. Alternatywnie możesz użyć <code>dd</code> z <code>/dev/random</code> lub <code>/dev/urandom</code>, ale będzie to znacznie wolniejsze
</p>
<pre># cryptsetup open --type plain /dev/md0 container --key-file /dev/random
# dd if=/dev/zero of=/dev/mapper/container bs=1M status=progress
# cryptsetup close container
</pre>
<p>I powtórz powyższe na HDD (<code>/dev/sdc1</code> w tym przykładzie).
</p>
<p>Skonfiguruj szyfrowanie dla <code>/dev/md0</code>:
</p>
<pre># cryptsetup -y -v luksFormat -c aes-xts-plain64 -s 512 /dev/md0
# cryptsetup open /dev/md0 cryptroot
# mkfs.ext4 /dev/mapper/cryptroot
# mount /dev/mapper/cryptroot /mnt
</pre>
<p>I powtórz dla HDD:
</p>
<pre># cryptsetup -y -v luksFormat -c aes-xts-plain64 -s 512 /dev/sdc1
# cryptsetup open /dev/sdc1 cryptdata
# mkfs.ext4 /dev/mapper/cryptdata
# mkdir -p /mnt/mnt/data
# mount /dev/mapper/cryptdata /mnt/mnt/data
</pre>
<h3><span class="mw-headline" id="Konfiguracja_boot_loadera">Konfiguracja boot loadera</span></h3>
<p>Skonfiguruj GRUB dla zaszyfrowanego systemu, edytując plik <code>/etc/defaults/grub</code>, wykonując następujące czynności. Zauważ, że opcja: <code>:allow-discards</code> umożliwia obsługę TRIM na SSD, jeśli nie chcesz jej używać, powinieneś to pominąć.
</p>
<pre>GRUB_CMDLINE_LINUX="cryptdevice=/dev/md0:cryptroot:allow-discards root=/dev/mapper/cryptroot"
GRUB_ENABLE_CRYPTODISK=y
</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> i <a href="../../en/GRUB.html#Boot_partition" title="GRUB">GRUB#Boot partition</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> po szczegółowe informacje.
</p>
<p>Dokończ instalację GRUB na obu dyskach SSD (w rzeczywistości instalacja będzie działać tylko na <code>/dev/sda</code>).
</p>
<pre># grub-install --target=i386-pc /dev/sda
# grub-install --target=i386-pc /dev/sdb
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3>
<span id="Tworzenie_plik.C3.B3w_kluczy"></span><span class="mw-headline" id="Tworzenie_plików_kluczy">Tworzenie plików kluczy</span>
</h3>
<p>Kolejne kroki nie pozwalają na dwukrotne wpisanie hasła podczas startu systemu (raz GRUB może odblokować szyfrowanie, a drugi raz, gdy initramfs przejmuje kontrolę nad systemem). Odbywa się to poprzez utworzenie pliku klucza do szyfrowania i dodanie go do obrazu initramfs, aby umożliwić szyfrowanie haka, aby odblokować urządzenie root. zobacz <a href="../../en/Dm-crypt/Device_encryption.html#With_a_keyfile_embedded_in_the_initramfs" title="Dm-crypt/Device encryption">dm-crypt/Device encryption#With a keyfile embedded in the initramfs</a> po szczegółowe informacje.
</p>
<ul><li>Utwórz plik <a href="../../en/Dm-crypt/Device_encryption.html#Keyfiles" title="Dm-crypt/Device encryption">klucza</a> i dodaj klucz do <code>/dev/md0</code>.</li></ul>
<ul><li>Utwórz kolejny plik kluczy dla dysku twardego ((<code>/dev/sdc1</code>), aby można go było odblokować podczas rozruchu. Dla wygody pozostaw powyższe hasło w miejscu, ponieważ może to ułatwić odzyskiwanie, jeśli kiedykolwiek będziesz tego potrzebować. Edytuj <code>/etc/crypttab</code>, aby odszyfrować dysk twardy podczas startu. Zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Unlocking_the_root_partition_at_boot" title="Dm-crypt/Device encryption">dm-crypt/Device encryption#Unlocking the root partition at boot</a>.</li></ul>
<h3><span class="mw-headline" id="Konfigurowanie_systemu">Konfigurowanie systemu</span></h3>
<p>Edytuj <a href="../../en/Fstab.html" title="Fstab">/etc/fstab</a>, aby zamontować urządzenia blokujące cryptroot i cryptdata; jeśli nie włączasz obsługi TRIM, usuń opcję montowania:
</p>
<pre>/dev/mapper/cryptroot  /           ext4    rw,noatime,discard  0   1 
/dev/mapper/cryptdata  /mnt/data   ext4    defaults            0   2  
</pre>
<p>Zapisz konfigurację RAID:
</p>
<pre># mdadm --detail --scan &gt; /etc/mdadm.conf 
</pre>
<p>Edytuj plik <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>, aby dołączyć swój plik kluczy i dodaj odpowiednie haki:
</p>
<pre>FILES=(/crypto_keyfile.bin)
HOOKS=( ... <b>keyboard</b> <b>keymap</b> block <b>mdadm_udev</b> <b>encrypt</b> filesystems ... )
</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> po szczegóły
</p>
<h2>
<span id="Zwyk.C5.82y_dm-crypt"></span><span class="mw-headline" id="Zwykły_dm-crypt">Zwykły dm-crypt</span>
</h2>
<p>W przeciwieństwie do LUKS, tryb zwykły dm-crypt nie wymaga nagłówka na zaszyfrowanym urządzeniu: ten scenariusz wykorzystuje tę funkcję do ustawienia systemu na niepodzielonym na partycje, zaszyfrowanym dysku, który będzie nieodróżnialny od dysku wypełnionego losowymi danymi, co może pozwolić na <a href="https://en.wikipedia.org/wiki/Deniable_encryption" class="extiw" title="wikipedia:Deniable encryption">deniable encryption</a>. Zobacz też <a href="https://en.wikipedia.org/wiki/Disk_encryption#Full_disk_encryption" class="extiw" title="wikipedia:Disk encryption">wikipedia:Disk encryption#Full disk encryption</a>.
</p>
<p>Zauważ, że jeśli szyfrowanie całego dysku nie jest wymagane, metody korzystające z LUKS opisane w powyższych sekcjach są lepszymi opcjami zarówno dla szyfrowania systemowego, jak i zaszyfrowanych partycji. Funkcje LUKS takie jak zarządzanie kluczami z wieloma hasłami / plikami kluczy lub ponowne szyfrowanie urządzenia w miejscu są niedostępne w trybie zwykłym.
</p>
<p><i>Plain</i> dm-crypt encryption can be more resilient to damage than LUKS, because it does not rely on an encryption master-key which can be a single-point of failure if damaged.
</p>
<p>Zwykłe szyfrowanie dm-crypt może być bardziej odporne na uszkodzenia niż LUKS, ponieważ nie opiera się na kluczu szyfrującym, który może być pojedynczym punktem awarii, jeśli jest uszkodzony. Jednak użycie trybu zwykłego wymaga również ręcznej konfiguracji opcji szyfrowania, aby uzyskać taką samą siłę kryptograficzną. Zobacz też <a href="../../en/Data-at-rest_encryption.html#Cryptographic_metadata" class="mw-redirect" title="Disk encryption">Disk encryption#Cryptographic metadata</a>. Stosując tryb "zwykły" można również rozważyć, jeśli chodzi o problemy wyjaśnione w <a href="../../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Discard/TRIM support for solid state drives (SSD)</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Jeśli twoim celem jest szyfrowanie bez nagłówka, ale nie masz pewności co do braku wyprowadzania klucza w trybie "zwykłym", to dwie alternatywy to:
<ul>
<li>
<a href="../../en/Tcplay.html" title="Tcplay">tcplay</a>, który oferuje szyfrowanie bez nagłówków, ale z funkcją PBKDF2, lub</li>
<li>tryb dm-crypt LUKS z odłączonym nagłówkiem za pomocą "cryptsetup"  <code>--header</code> opcja. Nie można go używać ze standardowym hakiem "szyfruj", ale hakiem <a href="../../en/Dm-crypt/Specialties.html#Encrypted_system_using_a_detached_LUKS_header" title="Dm-crypt/Specialties">may be modified</a>.</li>
</ul>
</div>
<p>Scenariusz wykorzystujący dwie pamięci USB:
</p>
<ul>
<li>jeden dla urządzenia rozruchowego, który pozwala również na przechowywanie opcji wymaganych do otwarcia / odblokowania zwykłego szyfrowanego urządzenia w konfiguracji modułu ładującego, ponieważ wpisanie ich na każdym rozruchu byłoby podatne na błędy;</li>
<li>drugi dla pliku kluczy szyfrujących, zakładając, że jest przechowywany jako nieprzetworzone bity, aby w oczach nieświadomego napastnika, który mógłby uzyskać klucz usb, klucz szyfrowania pojawi się jako dane losowe, zamiast być widocznym jako normalny plik. Zobacz też <a href="https://en.wikipedia.org/wiki/Security_through_obscurity" class="extiw" title="wikipedia:Security through obscurity">Wikipedia:Security through obscurity</a>, follow <a href="../../en/Dm-crypt/Device_encryption.html#Keyfiles" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Keyfiles</a> to prepare the keyfile.</li>
</ul>
<p>Układ dysku to:
</p>
<pre>+--------------------+------------------+--------------------+ +---------------+ +---------------+
|Volume 1:           |Volume 2:         |Volume 3:           | |Boot device    | |Encryption key |
|                    |                  |                    | |               | |file storage   |
|root                |swap              |home                | |/boot          | |(unpartitioned |
|                    |                  |                    | |               | |in example)    |
|/dev/store/root     |/dev/store/swap   |/dev/store/home     | |/dev/sdY1      | |/dev/sdZ       |
|--------------------+------------------+--------------------| |---------------| |---------------|
|disk drive /dev/sdaX encrypted using plain mode and LVM     | |USB stick 1    | |USB stick 2    |
+------------------------------------------------------------+ +---------------+ +---------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>Możliwe jest również użycie pojedynczego klucza usb poprzez bezpośrednie skopiowanie pliku klucza do initram. Przykładowy plik kluczy <code>/etc/keyfile</code> zostanie skopiowany do obrazu initram przez ustawienie <code>FILES=(/etc/keyfile)</code> w <code>/etc/mkinitcpio.conf</code>. Sposób instruowania <code>encrypt</code> do odczytu pliku klucza w obrazie initram <code>rootfs:</code> prefiks przed nazwą pliku, np. <code>cryptkey=rootfs:/etc/keyfile</code>.</li>
<li>inną opcją jest użycie hasła z dobrom <a href="../../en/Data-at-rest_encryption.html#Choosing_a_strong_passphrase" class="mw-redirect" title="Disk encryption">entropią</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Przygotowanie_dysku_5">Przygotowanie dysku</span></h3>
<p>Ważne jest, aby zamapowane urządzenie było wypełnione danymi. W szczególności dotyczy to zastosowania scenariusza, które stosujemy tutaj.
Zobacz <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a> i <a href="../../en/Dm-crypt/Drive_preparation.html#dm-crypt_specific_methods" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation#dm-crypt specific methods</a>
</p>
<h3>
<span id="Przygotowywanie_partycji.2C_kt.C3.B3re_nie_s.C4.85_uruchomione"></span><span class="mw-headline" id="Przygotowywanie_partycji,_które_nie_są_uruchomione">Przygotowywanie partycji, które nie są uruchomione</span>
</h3>
<p>Zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_plain_mode" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Encryption options for plain mode</a> szczegółowe informacje.
</p>
<p>Korzystanie z urządzenia <code>/dev/sd<i>X</i></code>, z szyfrem twofish-xts z 512-bitowym rozmiarem klucza i przy użyciu pliku klucza mamy następujące opcje dla tego scenariusza:
</p>
<pre># cryptsetup --hash=sha512 --cipher=twofish-xts-plain64 --offset=0 --key-file=/dev/sd<i>Z</i> --key-size=512 open --type=plain /dev/sdX enc</pre>
<p>W przeciwieństwie do szyfrowania za pomocą LUKS, powyższe polecenie musi być wykonane "w całości" za każdym razem, gdy konieczne jest ponowne ustanowienie mapowania, dlatego ważne jest, aby pamiętać szczegóły szyfrowania, hasza i pliku klucza.
</p>
<p>Możemy teraz sprawdzić, czy wpis mapowania został wprowadzony <code>/dev/mapper/enc</code>:
</p>
<pre># fdisk -l
</pre>
<p>Następnie ustawiamy woluminy logiczne <a href="../../en/LVM.html" title="LVM">LVM</a> na zmapowanym urządzeniu. Zobacz<a href="../../en/LVM.html#Installing_Arch_Linux_on_LVM" title="LVM">LVM#Installing Arch Linux on LVM</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> po dalsze szczegóły:
</p>
<pre># pvcreate /dev/mapper/enc
# vgcreate store /dev/mapper/enc
# lvcreate -L 20G store -n root
# lvcreate -L 10G store -n swap
# lvcreate -l 100%FREE store -n home
</pre>
<p>Formatujemy i montujemy je oraz aktywujemy partycję swap zobacz <a href="../../en/File_systems.html#Create_a_file_system" title="File systems">File systems#Create a file system</a> po dalsze szczegóły: 
</p>
<pre># mkfs.ext4 /dev/store/root
# mkfs.ext4 /dev/store/home
# mount /dev/store/root /mnt
# mkdir /mnt/home
# mount /dev/store/home /mnt/home
# mkswap /dev/store/swap
# swapon /dev/store/swap
</pre>
<h3><span class="mw-headline" id="Przygotowanie_partycji_rozruchowej_4">Przygotowanie partycji rozruchowej</span></h3>
<p>Partycję <code>/boot</code> można zainstalować na standardowej partycji vfat USB-Stick, jeśli jest taka potrzeba. Ale jeśli potrzebne jest ręczne partycjonowanie, wystarczy mała partycja 200 MB. Utwórz partycję za pomocą wybranego <a href="../../en/Partitioning.html#Partitioning_tools" title="Partitioning">narzędzia do partycjonowania.</a>
</p>
<p>Wybieramy system plików, który nie jest zapisywany w dzienniku, aby zachować pamięć flash partycji <code>/boot</code>, jeśli nie została jeszcze sformatowana jako vfat:
</p>
<pre># mkfs.ext2 /dev/sd<i>Y</i>1
# mkdir /mnt/boot
# mount /dev/sd<i>Y</i>1 /mnt/boot
</pre>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio_4">Konfigurowanie mkinitcpio</span></h3>
<p>Dodaj <code>keyboard</code>, <code>encrypt</code> i <code>lvm2</code> haki do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... <b>keyboard</b> <b>keymap</b> block <b>encrypt</b> <b>lvm2</b> ... filesystems ...)</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> do dalszych szczegółów i innych haczyków, które możesz potrzebować.
</p>
<h3><span class="mw-headline" id="Konfiguracja_bootloadera">Konfiguracja bootloadera</span></h3>
<p>Aby uruchomić zaszyfrowaną partycję root, botlader musi ustawić następujące parametry jądra:
</p>
<pre>cryptdevice=/dev/sd<i>X</i>:enc cryptkey=/dev/sd<i>Z</i>:0:512 crypto=sha512:twofish-xts-plain64:512:0:
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Jeśli używasz sd-encrypt zamiast szyfrowania, użyj odpowiednio opcji określonych w ' systemd-cryptsetup-generator(8)<i>.</i>
</div>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> po dalsze szczegóły i inne parametry, których możesz potrzebować.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Jeśli używasz GRUB-a, możesz zainstalować go na tym samym USB co partycję <code>/boot</code>:
<pre># grub-install --recheck /dev/sd<i>Y</i>
</pre>
</div>
<h3><span class="mw-headline" id="Po_instalacji">Po instalacji</span></h3>
<p>Możesz chcieć usunąć pendrive USB po uruchomieniu. Ponieważ partycja <code>/boot</code> zazwyczaj nie jest potrzebna, opcja noauto może zostać dodana do odpowiedniej linii w <code>/etc/fstab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># /dev/sd<i>Yn</i>
/dev/sd<i>Yn</i> /boot ext2 <b>noauto</b>,rw,noatime 0 2
</pre>
<p>Jednakże, gdy wymagana jest aktualizacja jądra lub programu ładującego, partycja <code>/boot</code> musi być obecna i zamontowana. Ponieważ pozycja w <code>fstab</code> już istnieje, można ją zamontować po prostu za pomocą:
</p>
<pre># mount /boot
</pre>
<h2>
<span id="Szyfrowana_partycja_rozruchowa_.28GRUB.29"></span><span class="mw-headline" id="Szyfrowana_partycja_rozruchowa_(GRUB)">Szyfrowana partycja rozruchowa (GRUB)</span>
</h2>
<p>Ta konfiguracja wykorzystuje ten sam układ i konfigurację partycji dla partycji głównej systemu, co poprzednia sekcja #<a href="#LVM_na_LUKS">#LVM na LUKS</a>, z dwiema wyraźnymi różnicami:
</p>
<ol>
<li>Konfiguracja jest przeprowadzana dla systemu <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> i</li>
<li>Specjalna funkcja programu bodladera GRUB służy do dodatkowego szyfrowania partycji rozruchowej <code>/boot</code>. Zobacz też <a href="../../en/GRUB.html#Boot_partition" title="GRUB">GRUB#Boot partition</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.</li>
</ol>
<p>Układ dysku w tym przykładzie to:
</p>
<pre>+---------------+----------------+----------------+----------------+----------------+
|ESP partition: |Boot partition: |Volume 1:       |Volume 2:       |Volume 3:       |
|               |                |                |                |                |
|/boot/efi      |/boot           |root            |swap            |home            |
|               |                |                |                |                |
|               |                |/dev/store/root |/dev/store/swap |/dev/store/home |
|/dev/sdaX      |/dev/sdaY       +----------------+----------------+----------------+
|<b>un</b>encrypted    |LUKS encrypted  |/dev/sdaZ encrypted using LVM on LUKS             |
+---------------+----------------+--------------------------------------------------+
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Wszystkie scenariusze mają służyć jako przykłady. Możliwe jest oczywiście zastosowanie obu powyższych dwóch etapów instalacji również w innych scenariuszach. Zobacz także warianty połączone w <a href="#LVM_na_LUKS">#LVM na LUKS</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can use <code>cryptboot</code> script from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup> package for simplified encrypted boot management (mounting, unmounting, upgrading packages) and as a defense against <a rel="nofollow" class="external text" href="https://www.schneier.com/blog/archives/2009/10/evil_maid_attac.html">Evil Maid</a> attacks with <a href="../../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html#Using_your_own_keys" class="mw-redirect" title="Secure Boot">UEFI Secure Boot</a>. For more informations and limitations see <a rel="nofollow" class="external text" href="https://github.com/xmikos/cryptboot">cryptboot project</a> page.</div>
<h3><span class="mw-headline" id="Przygotowanie_dysku_6">Przygotowanie dysku</span></h3>
<p>Przed utworzeniem jakichkolwiek partycji powinieneś powinnaś wiedzieć o znaczeniu metod bezpiecznego usuwania dysku, opisanych w <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>.
</p>
<p>Utwórz <a href="/index.php?title=Partycj%C4%99_systemow%C4%85_EFI&amp;action=edit&amp;redlink=1" class="new" title="Partycję systemową EFI (page does not exist)">partycję systemową EFI</a> o odpowiednim rozmiarze, później zostanie zamontowana w <code>/boot/efi</code>.
</p>
<p>Utwórz partycję do zamontowania w <code>/boot</code> typu <code>8300</code> o wielkości 100 MB lub więcej.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> When using the <a href="../../en/GRUB.html" title="GRUB">GRUB</a> bootloader together with a BIOS/<a href="../../en/Partitioning.html#GUID_Partition_Table" class="mw-redirect" title="GPT">GPT</a>, create a BIOS Boot Partition as explained in <a href="../../en/GRUB.html#BIOS_systems" title="GRUB">GRUB#BIOS systems</a> instead of the ESP.</div>
<p>Utwórz partycję typu <code>8E00</code>, który później będzie zawierał zaszyfrowany kontener.
</p>
<p>Utwórz zaszyfrowany kontener LUKS na partycji "systemowej".
</p>
<pre># cryptsetup luksFormat /dev/<i>sdaZ</i>
</pre>
<p>Aby uzyskać więcej informacji o dostępnych opcjach cryptsetup, zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">LUKS encryption options</a> przed powyższym poleceniem.
</p>
<p>Twój układ partycji powinien wyglądać podobnie do tego:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># gdisk /dev/sda</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         1050623   512.0 MiB   EF00  EFI System
   2         1050624         1460223   200.0 MiB   8300  Linux filesystem
   3         1460224        41943006   19.3 GiB    8E00  Linux LVM
</pre>
<p>Otwórz kontener:
</p>
<pre># cryptsetup open /dev/<i>sdaZ</i> lvm
</pre>
<p>Odszyfrowany kontener jest teraz dostępny pod adresem <code>/dev/mapper/lvm</code>.
</p>
<h3>
<span id="Przygotowywanie_wolumin.C3.B3w_logicznych_3"></span><span class="mw-headline" id="Przygotowywanie_woluminów_logicznych_3">Przygotowywanie woluminów logicznych</span>
</h3>
<p>Woluminy logiczne LVM tego przykładu są zgodne z dokładnym układem w poprzednim scenariuszu. Dlatego prosimy postępować zgodnie z instrukcjami <a href="#Preparing_the_logical_volumes">Preparing the logical volumes</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> lub dostosuj je według potrzeb.
</p>
<h3><span class="mw-headline" id="Przygotowanie_partycji_rozruchowej_5">Przygotowanie partycji rozruchowej</span></h3>
<p>Program ładujący ładuje jądro <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, i jego własne pliki konfiguracyjne z katalogu <code>/boot</code> directory.
</p>
<p>Najpierw utwórz kontener LUKS, w którym będą znajdować się i instalowane pliki:
</p>
<pre># cryptsetup luksFormat /dev/sda<i>Y</i>
</pre>
<p>Następnie otwórz:
</p>
<pre># cryptsetup open /dev/sda<i>Y</i> cryptboot
</pre>
<p>Utwórz system plików na partycji przeznaczonej dla <code>/boot</code>. Dowolny system plików, który może odczytać bootloader, jest odpowiedni:
</p>
<pre># mkfs.ext2 /dev/mapper/<i>cryptboot</i>
</pre>
<p>Utwórz katalog <code>/mnt/boot</code>:
</p>
<pre># mkdir /mnt/boot
</pre>
<p>Zamontuj partycję na <code>/mnt/boot</code>:
</p>
<pre># mount /dev/mapper/<i>cryptboot</i> /mnt/boot
</pre>
<p>Utwórz punkt montowania dla <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> w <code>/boot/efi</code> w celu zapewnienia zgodności z <code>grub-install</code> i zamontuj:
</p>
<pre># mkdir /mnt/boot/efi
# mount /dev/<i>sdaX</i> /mnt/boot/efi
</pre>
<p>W tym momencie powinieneś mieć następujące partycje i woluminy logiczne wewnątrz <code>/mnt</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME              	  MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda                       8:0      0   200G  0 disk
├─sda1                    8:1      0   512M  0 part  /boot/efi
├─sda2                    8:2      0   200M  0 part
│ └─boot		  254:0    0   198M  0 crypt /boot
└─sda3                    8:3      0   100G  0 part
  └─lvm                   254:1    0   100G  0 crypt
    ├─MyStorage-swapvol   254:2    0     8G  0 lvm   [SWAP]
    ├─MyStorage-rootvol   254:3    0    15G  0 lvm   /
    └─MyStorage-homevol   254:4    0    77G  0 lvm   /home
</pre>
<p>Następnie kontynuuj procedurę instalacji aż do kroku mkinitcpio.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio_5">Konfigurowanie mkinitcpio</span></h3>
<p>Dodaj <code>keyboard</code>, <code>encrypt</code> i <code>lvm2</code> haki do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(... <b>keyboard</b> <b>keymap</b> block <b>encrypt</b> <b>lvm2</b> ... filesystems ...)</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> for details and other hooks that you may need.
</p>
<h3><span class="mw-headline" id="Konfiguracja_botladera">Konfiguracja botladera</span></h3>
<p>Skonfiguruj GRUB, aby rozpoznał zaszyfrowaną partycję <code>/boot</code> LUKS i odblokuj zaszyfrowaną partycję root przy starcie:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/grub</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">GRUB_CMDLINE_LINUX="... cryptdevice=UUID=<i>&lt;device-UUID&gt;</i>:lvm ..."
GRUB_ENABLE_CRYPTODISK=y</pre>
<p>Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Boot_loader" title="Dm-crypt/System configuration">Dm-crypt/System configuration#Boot loader</a> i <a href="../../en/GRUB.html#Boot_partition" title="GRUB">GRUB#Boot partition</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> do dalszych szczegółów. <code><i>&lt;device-UUID&gt;</i></code> odnosi się do UUID z <code>/dev/sdaZ</code> (partycja przechowująca lvm zawierający główny system plików). Zobacz<a href="../../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a>.
</p>
<p>Wygeneruj plik <a href="../../en/GRUB.html#Generate_the_main_configuration_file" title="GRUB">konfiguracyjny</a> GRUB i <a href="../../en/GRUB.html#Installation_2" title="GRUB">zainstaluj</a>  na zamontowanym ESP:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub --recheck
</pre>
<p>Jeśli zakończy się to bezbłędnie, GRUB powinien poprosić o hasło, aby odblokować partycję <code>/boot</code> po następnym uruchomieniu.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_fstab_i_crypttab_2">Konfigurowanie fstab i crypttab</span></h3>
<p>Ta sekcja opisuje dodatkową konfigurację pozwalającą systemowi <b>zamontować</b> zaszyfrowane <code>/boot</code>
</p>
<p>Podczas gdy GRUB prosi o hasło, aby odblokować zaszyfrowane <code>/boot</code> po powyższych instrukcjach odblokowanie partycji nie jest przekazywane do initramfs. Stąd, <code>/boot</code> nie będzie dostępne po ponownym uruchomieniu systemu, ponieważ <code>encrypt</code> hook tylko odblokowuje root systemu.
</p>
<p>Jeśli używałeś skryptu "genfstab" podczas instalacji, zostanie wygenerowany <code>/etc/fstab</code> wpisy dla <code>/boot</code> i <code>/boot/efi</code> montuj punkty już, ale system nie odnajdzie device mapper dla partycji rozruchowej. Aby go udostępnić, dodaj go do <a href="../../en/Dm-crypt/System_configuration.html#crypttab" class="mw-redirect" title="Crypttab">crypttab</a>. Na przykład:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cryptboot  /dev/sdaY      none        luks
</pre>
<p>sprawi, że system ponownie poprosi o podanie hasła (to znaczy, że musisz wprowadzić je dwukrotnie przy starcie systemu: raz dla GRUB i raz dla systemd init). Aby uniknąć podwójnego wpisu dotyczącego odblokowania <code>/boot</code>, postępuj zgodnie z instrukcjami na stronie <a href="../../en/Dm-crypt/Device_encryption.html#Keyfiles" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Keyfiles</a> do:
</p>
<ol>
<li>Stwórz <a href="../../en/Dm-crypt/Device_encryption.html#Storing_the_keyfile_on_a_filesystem" title="Dm-crypt/Device encryption">randomtext keyfile</a>,</li>
<li>Dodaj plik klucza do pliku (<code>/dev/sdaY</code>) <a href="../../en/Dm-crypt/Device_encryption.html#Configuring_LUKS_to_make_use_of_the_keyfile" title="Dm-crypt/Device encryption">boot partition's LUKS header</a> and</li>
<li>Sprawdź wpis <code>/etc/fstab</code> i dodaj linię <code>/etc/crypttab</code> do <a href="../../en/Dm-crypt/Device_encryption.html#Unlocking_the_root_partition_at_boot" title="Dm-crypt/Device encryption">unlock it automatically at boot</a>.</li>
</ol>
<p><br>
Jeśli z jakiegoś powodu plik klucza nie odblokuje partycji rozruchowej, systemd zrestartuje się, aby poprosić o hasło do odblokowania, a jeśli jest to poprawne, kontynuuj uruchamianie.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Opcjonalne kroki poinstalacyjne:
<ul>
<li>Warto rozważyć dodanie programu ładującego GRUB do listy ignorowanych plików <code>/etc/pacman.conf</code> w celu uzyskania szczególnej kontroli, kiedy bootloader (który zawiera własne moduły szyfrujące) jest aktualizowany.</li>
<li>Jeśli chcesz zaszyfrować partycję <code>/boot</code>, aby zabezpieczyć się przed zagrożeniami związanymi z nieuprawnionym dostępem, pomoc dla <a href="../../en/Dm-crypt/Specialties.html#mkinitcpio-chkcryptoboot" title="Dm-crypt/Specialties">mkinitcpio-chkcryptoboot</a>
</li>
</ul>
</div>
<h2><span class="mw-headline" id="Btrfs_subvolumes_with_swap">Btrfs subvolumes with swap</span></h2>
<p>Poniższy przykład tworzy pełne szyfrowanie systemowe za pomocą LUKS przy użyciu subwoluminów <a href="../../en/Btrfs.html" title="Btrfs">Btrfs</a> do <a href="../../en/Btrfs.html#Mounting_subvolumes" title="Btrfs">simulate partitions</a>.
</p>
<p>Jeśli używasz UEFI, to <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> (ESP) jest wymagane. <code>/boot</code> może znajdować się na <code>/</code> i być zaszyfrowane; jednak samo ESP nie może być zaszyfrowane. W tym przykładowym układzie ESP jest <code>/dev/sda<i>Y</i></code> i jest zamontowany w <code>/boot/efi</code>. <code>/boot</code> sama znajduje się na partycji systemowej, <code>/dev/sda<i>X</i></code>.
</p>
<p>Ponieważ <code>/boot</code> znajduje się na zaszyfrowanej <code>/</code>, <a href="../../en/GRUB.html" title="GRUB">GRUB</a> musi być użyty jako bootloader, ponieważ tylko GRUB może załadować moduły niezbędne do odszyfrowania <code>/boot</code> (e.g., crypto.mod, cryptodisk.mod and luks.mod) <a rel="nofollow" class="external autonumber" href="http://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/">[1]</a>.
</p>
<p>Dodatkowo wyświetlana jest opcjonalna zwykła, zaszyfrowana partycja <a href="../../en/Swap.html" title="Swap">swap</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Nie używaj <a href="../../en/Swap.html#Swap_file" class="mw-redirect" title="Swap file">swap file</a> zamiast osobnej partycji, ponieważ może to spowodować utratę danych. zobacz <a href="../../en/Btrfs.html#Swap_file" title="Btrfs">Btrfs#Swap file</a>.</div>
<pre>+--------------------------+--------------------------+--------------------------+
|ESP                       |System partition          |Swap partition            |
|<b>un</b>encrypted               |LUKS-encrypted            |plain-encrypted           |
|                          |                          |                          |
|/boot/efi                 |/                         |                          |
|/dev/sda<i>Y</i>                 |/dev/sda<i>X</i>                 |/dev/sda<i>Z</i>                 |
|--------------------------+--------------------------+--------------------------+
</pre>
<h3><span class="mw-headline" id="Przygotowanie_dysku_7">Przygotowanie dysku</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Nie można używać partycji btrfs, jak opisano w <a href="../../en/Btrfs.html#Partitionless_Btrfs_disk" title="Btrfs">Btrfs#Partitionless Btrfs disk</a> podczas korzystania z LUKS. Należy użyć tradycyjnego partycjonowania, nawet jeśli jest to po prostu utworzenie jednej partycji.</div>
<p>Przed utworzeniem jakichkolwiek partycji powinieneś wiedzieć o znaczeniu i metodach bezpiecznego usuwania dysku, opisanych w <a href="../../en/Dm-crypt/Drive_preparation.html" title="Dm-crypt/Drive preparation">Dm-crypt/Drive preparation</a>. Jeśli używasz <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> stworzyć <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> o odpowiednim rozmiarze. Zostanie on później zamontowany w <code>/boot/efi</code>. Jeśli masz zamiar utworzyć zaszyfrowaną partycję wymiany, utwórz dla niej partycję, ale nie oznaczaj jej jako "swap", ponieważ z partycją będzie używana zwykły "dm-crypt".
</p>
<p>Utwórz potrzebne partycje, przynajmniej jedną dla <code>/</code> (e.g. <code>/dev/sda<i>X</i></code>). zobacz <a href="../../en/Partitioning.html" title="Partitioning">Partitioning</a> article.
</p>
<h3><span class="mw-headline" id="Przygotowanie_partycji_systemowej">Przygotowanie partycji systemowej</span></h3>
<h4>
<span id="Utw.C3.B3rz_kontener_LUKS"></span><span class="mw-headline" id="Utwórz_kontener_LUKS">Utwórz kontener LUKS</span>
</h4>
<p>Śledzić <a href="../../en/Dm-crypt/Device_encryption.html#Encrypting_devices_with_LUKS_mode" title="Dm-crypt/Device encryption">dm-crypt/Device encryption#Encrypting devices with LUKS mode</a> ustawić <code>/dev/sda<i>X</i></code> dla LUKS. Zobacz <a href="../../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Encryption options for LUKS mode</a> zanim to zrobisz, aby wyświetlić listę opcji szyfrowania.
</p>
<h4><span class="mw-headline" id="Odblokuj_kontener_LUKS">Odblokuj kontener LUKS</span></h4>
<p>Teraz wykonaj <a href="../../en/Dm-crypt/Device_encryption.html#Unlocking/Mapping_LUKS_partitions_with_the_device_mapper" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#Unlocking/Mapping LUKS partitions with the device mapper</a> aby odblokować kontener LUKS i zmapować go.
</p>
<h4>
<span id="Sformatuj_zmapowane_urz.C4.85dzenie"></span><span class="mw-headline" id="Sformatuj_zmapowane_urządzenie">Sformatuj zmapowane urządzenie</span>
</h4>
<p>Przejdź do sformatowania zmapowanego urządzenia zgodnie z opisem w <a href="../../en/Btrfs.html#File_system_on_a_single_device" title="Btrfs">Btrfs#File system on a single device</a>, gdzie <code><i>/dev/partition</i></code>jest nazwą zmapowanego urządzenia (tj., <code>cryptroot</code>) i <b>not</b> <code>/dev/sda<i>X</i></code>.
</p>
<h4>
<span id="Zamontuj_zmapowane_urz.C4.85dzenie"></span><span class="mw-headline" id="Zamontuj_zmapowane_urządzenie">Zamontuj zmapowane urządzenie</span>
</h4>
<p>W końcu, <a href="../../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> teraz sformatowane urządzenie mapowane (tzn. <code>/dev/mapper/cryptroot</code>) do <code>/mnt</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Możesz chcieć użyć <code>compress=lzo</code> opcja montowania. zobacz <a href="../../en/Btrfs.html#Compression" title="Btrfs">Btrfs#Compression</a> po więcej informacji.</div>
<h3>
<span id="Tworzenie_subwolumin.C3.B3w_btrfs"></span><span class="mw-headline" id="Tworzenie_subwoluminów_btrfs">Tworzenie subwoluminów btrfs</span>
</h3>
<h4>
<span id="Uk.C5.82ad"></span><span class="mw-headline" id="Układ">Układ</span>
</h4>
<p><a href="../../en/Btrfs.html#Subvolumes" title="Btrfs">Subvolumes</a> będą używane do symulacji partycji, ale będą również tworzone inne (zagnieżdżone) podwiliny. Oto częściowa reprezentacja tego, co wygeneruje następujący przykład:
</p>
<pre>subvolid=5 (/dev/sda<i>X</i>)
   |
   ├── @ (mounted as /)
   |       |
   |       ├── /bin (directory)
   |       |
   |       ├── /home (mounted @home subvolume)
   |       |
   |       ├── /usr (directory)
   |       |
   |       ├── /.snapshots (mounted @snapshots subvolume)
   |       |
   |       ├── /var/cache/pacman/pkg (nested subvolume)
   |       |
   |       ├── ... (other directories and nested subvolumes)
   |
   ├── @snapshots (mounted as /.snapshots)
   |
   ├── @home (mounted as /home)
   |
   └── @... (additional subvolumes you wish to use as mount points)
</pre>
<p>Ta sekcja jest zgodna z <a href="../../en/Snapper.html#Suggested_filesystem_layout" title="Snapper">Snapper#Suggested filesystem layout</a>, który jest najbardziej przydatny w połączeniu z <a href="../../en/Snapper.html" title="Snapper">Snapper</a>. Powinieneś także skonsultować się <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Layout">Btrfs Wiki SysadminGuide#Layout</a>.
</p>
<h4><span class="mw-headline" id="Create_top-level_subvolumes">Create top-level subvolumes</span></h4>
<p>Tutaj używamy konwencji prefiksowania <code>@</code> do subwolumowania nazw, które będą używane jako punkty montowania, oraz <code>@</code> będzie subvolume, które jest zamontowane jako <code>/</code>.
</p>
<p>Śledząc <a href="../../en/Btrfs.html#Creating_a_subvolume" title="Btrfs">Btrfs#Creating a subvolume</a> artykuł, utwórz subvolumes w  <code>/mnt/@</code>, <code>/mnt/@snapshots</code>, i <code>/mnt/@home</code>.
</p>
<p>Utwórz teraz wszystkie dodatkowe subvolumes, które chcesz teraz wykorzystać jako punkty podłączenia.
</p>
<h4><span class="mw-headline" id="Mount_top-level_subvolumes">Mount top-level subvolumes</span></h4>
<p>Odmontuj partycję systemową na <code>/mnt</code>.
</p>
<p>Teraz zamontuj nowo utworzony <code>@</code> subvolume, które będzie służyć jako <code>/</code> do <code>/mnt</code> używając <code>subvol=</code> opcje montowania. Zakładając, że zmapowane urządzenie ma nazwę <code>cryptroot</code>, polecenie wyglądałoby jak:
</p>
<pre># mount -o compress=lzo,subvol=@ /dev/mapper/cryptroot /mnt
</pre>
<p>Zobacz <a href="../../en/Btrfs.html#Mounting_subvolumes" title="Btrfs">Btrfs#Mounting subvolumes</a> for more details.
</p>
<p>Zamontuj także inne subvolumes do odpowiednich punktów montowania <code>@home</code> do <code>/mnt/home</code> i <code>@snapshots</code> do <code>/mnt/.snapshots</code>.
</p>
<h4>
<span id="Utw.C3.B3rz_zagnie.C5.BCd.C5.BCone_subvolumes"></span><span class="mw-headline" id="Utwórz_zagnieżdżone_subvolumes">Utwórz zagnieżdżone subvolumes</span>
</h4>
<p>utwórz dowolne subvolumes, których <b>nie</b> chcesz mieć podczas robienia migawki <code>/</code>. Na przykład prawdopodobnie nie chcesz robić migawek <code>/var/cache/pacman/pkg</code>. Te podwilumny będą zagnieżdżone pod <code>@</code> subvolume, ale równie łatwo mogłoby zostać stworzone wcześniej na tym samym poziomie co <code>@</code> zgodnie z własnymi preferencjami.
</p>
<p>ponieważ <code>@</code> subvolume jest zamontowany w <code>/mnt</code> będziesz musiał <a href="../../en/Btrfs.html#Creating_a_subvolume" class="mw-redirect" title="Create a subvolume">create a subvolume</a> w <code>/mnt/var/cache/pacman/pkg</code> dla tego przykładu. Może być konieczne najpierw utworzenie katalogów macierzystych.
</p>
<p>Inne katalogi, z którymi możesz to zrobić, to <code>/var/abs</code>, <code>/var/tmp</code>, i <code>/srv</code>.
</p>
<h4><span class="mw-headline" id="Zamontuj_ESP">Zamontuj ESP</span></h4>
<p>Jeśli wcześniej przygotowano partycję systemową EFI, utwórz jej punkt podłączenia i zamontuj go teraz.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Btrfs snapshots wykluczą <code>/boot/efi</code>, ponieważ nie jest to system plików btrfs.</div>
<p>Na etapie [[Installation guide#Install Pacstrap, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> musi być zainstalowany jako dodatek do grupy podstawowej.
</p>
<h3><span class="mw-headline" id="Konfigurowanie_mkinitcpio_6">Konfigurowanie mkinitcpio</span></h3>
<h4>
<span id="Utw.C3.B3rz_plik_klucza"></span><span class="mw-headline" id="Utwórz_plik_klucza">Utwórz plik klucza</span>
</h4>
<p>Aby GRUB otworzył partycję LUKS bez konieczności dwukrotnego wpisywania hasła przez użytkownika, użyjemy pliku klucza osadzonego w initramfs. Śledzić <a href="../../en/Dm-crypt/Device_encryption.html#With_a_keyfile_embedded_in_the_initramfs" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption#With a keyfile embedded in the initramfsupewnij</a> się, że dodasz klucz <code>/dev/sda<i>X</i></code> na <i>luksAddKey</i> step.
</p>
<h4><span class="mw-headline" id="Edycja_mkinitcpio.conf">Edycja mkinitcpio.conf</span></h4>
<p>Po utworzeniu, dodaniu i osadzeniu klucza, jak opisano powyżej, dodaj <code>encrypt</code> hak do <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a> jak również wszelkie inne haki, których potrzebujesz. Zobacz <a href="../../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">Dm-crypt/System configuration#mkinitcpio</a> dla szczegółowych informacji. Pamiętaj, aby zregenerować początkowy RAMdysk po zakończeniu.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Możesz dodać <code>BINARIES=(/usr/bin/btrfs)</code> dla Twojej <code>mkinitcpio.conf</code>. Zobacz <a href="../../en/Btrfs.html#Corruption_recovery" title="Btrfs">Btrfs#Corruption recovery</a> article.</div>
<h3><span class="mw-headline" id="Konfigurowanie_botladera">Konfigurowanie botladera</span></h3>
<p>Zaistaluj <a href="../../en/GRUB.html" title="GRUB">GRUB</a> do <code>/dev/sda</code>. Następnie edytuj <code>/etc/default/grub</code> zgodnie z instrukcją <a href="../../en/GRUB.html#Encryption" title="GRUB">GRUB#Encryption</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> artykułu, zgodnie z instrukcjami dla zaszyfrowanego katalogu głównego i partycji rozruchowej. Na koniec wygeneruj plik konfiguracyjny GRUB.
</p>
<h3><span class="mw-headline" id="Konfiguracja_swap">Konfiguracja swap</span></h3>
<p>Jeśli utworzyłeś partycję, która ma być używana do szyfrowanej wymiany, teraz jest czas na jej skonfigurowanie. Postępuj zgodnie z instrukcjami na <a href="../../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">Dm-crypt/Swap encryption</a>.
</p>
<p>Po wykonaniu tego kroku kontynuuj konfigurację systemu zgodnie z ustawieniami <a href="../../en/Installation_guide.html#Reboot" title="Installation guide">installation guide</a>.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../pl/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Polski)">Data-at-rest encryption (Polski)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Polski)/Encrypting_an_entire_system_(Polski)&amp;oldid=646729">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Polski)/Encrypting_an_entire_system_(Polski)&amp;oldid=646729</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 11:53.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
