<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>EFISTUB (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-EFISTUB_Русский rootpage-EFISTUB_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">EFISTUB (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../en/Arch_boot_process.html" class="mw-redirect" title="Процесс загрузки Arch">Процесс загрузки Arch</a></li>
<li><a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Загрузчики">Загрузчики</a></li>
<li><a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="Unified Extensible Firmware Interface (Русский)">Unified Extensible Firmware Interface (Русский)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/EFISTUB.html" title="EFISTUB">EFISTUB</a>. Дата последней синхронизации: 2015-07-29. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=EFISTUB&amp;diff=0&amp;oldid=388777">изменения</a>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Был обнаружен баг, при котором загрузка EFISTUB могла не сработать в зависимости от версии ядра и модели материнской платы. Смотрите <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/33745">FS#33745</a> и <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=156670">[1]</a> для дополнительной информации.</div>
<p>Ядро Linux (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>&gt;=3.3) поддерживает EFISTUB (EFI BOOT STUB) загрузку. Эта возможность позволяет прошивке EFI загружать ядро как обычное EFI приложение. Эта опция включена по умолчанию в стандартных ядрах Arch Linux, а также её можно активировать при помощи установки <code>CONFIG_EFI_STUB=y</code> в конфигурации ядра (смотрите <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/efi-stub.txt">The EFI Boot Stub</a> для дополнительной информации).
</p>
<p>EFISTUB ядро может быть загружено непосредственно с помощью UEFI материнской платы или же посредственно с использованием <a href="../en/Arch_boot_process.html#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D1%87%D0%B8%D0%BA%D0%B8_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D1%8E%D1%89%D0%B8%D0%B5_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_UEFI" class="mw-redirect" title="Загрузчики">UEFI менеджера загрузки</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup>. Последний рекомендуется  использовать в том случае, если у вас есть несколько ядер/initramfs пар и загрузочное меню UEFI вашей материнской платы неудобное в использовании.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_EFISTUB"><span class="tocnumber">1</span> <span class="toctext">Настройка EFISTUB</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5_%D1%82%D0%BE%D1%87%D0%BA%D0%B8_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BB%D1%8F_ESP"><span class="tocnumber">1.1</span> <span class="toctext">Альтернативные точки монтирования для ESP</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_systemd"><span class="tocnumber">1.1.1</span> <span class="toctext">С помощью systemd</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_incron"><span class="tocnumber">1.1.2</span> <span class="toctext">С помощью incron</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_%D1%85%D1%83%D0%BA%D0%B0_mkinitcpio"><span class="tocnumber">1.1.3</span> <span class="toctext">С помощью хука mkinitcpio</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_%D0%B1%D0%B8%D0%BD%D0%B4%D0%B8%D0%BD%D0%B3%D0%B0_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F"><span class="tocnumber">1.1.4</span> <span class="toctext">С помощью биндинга монтирования</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-7">
<a href="#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_EFISTUB"><span class="tocnumber">2</span> <span class="toctext">Загрузка EFISTUB</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D1%8F_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8"><span class="tocnumber">2.1</span> <span class="toctext">Используя менеджер загрузки</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D1%8F_UEFI_Shell"><span class="tocnumber">2.2</span> <span class="toctext">Используя UEFI Shell</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D1%8F_%D0%BD%D0%B5%D0%BF%D0%BE%D1%81%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE_UEFI_(efibootmgr)"><span class="tocnumber">2.3</span> <span class="toctext">Используя непосредственно UEFI (efibootmgr)</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_EFISTUB"></span><span class="mw-headline" id="Настройка_EFISTUB">Настройка EFISTUB</span>
</h2>
<p>После создания <a href="../en/Unified_Extensible_Firmware_Interface.html#EFI_System_Partition" title="Unified Extensible Firmware Interface">системного раздела EFI</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup> вы должны выбрать точку монтирования для него. Самый простой способ - это смонтировать его в <code>/boot</code>, так как это позволит pacman непосредственно обновлять ядро, которое будет использовать EFI прошивка. Если вы пойдёте по этому пути, переходите к разделу <a href="#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_EFISTUB">#Загрузка EFISTUB</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Вы можете хранить ядро и initramfs не на ESP, если вы используете менеджер загрузки, у которого есть драйвер файловой системы для раздела, в котором они расположены, например <a href="../en/REFInd.html" class="mw-redirect" title="REFInd (Русский)">rEFInd</a>.</div>
<h3>
<span id=".D0.90.D0.BB.D1.8C.D1.82.D0.B5.D1.80.D0.BD.D0.B0.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D0.B5_.D1.82.D0.BE.D1.87.D0.BA.D0.B8_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BB.D1.8F_ESP"></span><span class="mw-headline" id="Альтернативные_точки_монтирования_для_ESP">Альтернативные точки монтирования для ESP</span>
</h3>
<p>Если вы примонтируете Системный Раздел EFI куда-либо в другое место (например, в <code>/boot/efi</code>), вам нужно будет скопировать загружаемые файлы в эту директорию (здесь и далее будем обозначать её как <code>$esp</code>).
</p>
<pre># mkdir $esp/EFI/arch
# cp /boot/vmlinuz-linux $esp/EFI/arch/vmlinuz-linux
# cp /boot/initramfs-linux.img $esp/EFI/arch/initramfs-linux.img
# cp /boot/initramfs-linux-fallback.img $esp/EFI/arch/initramfs-linux-fallback.img
</pre>
<p>Кроме того, вам нужно будет постоянно обновлять файлы на ESP при последующих обновлениях ядра. Если этого не делать, то система может перестать загружаться. Следующие далее разделы описывают механизмы автоматизации данных действий.
</p>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_systemd"></span><span class="mw-headline" id="С_помощью_systemd">С помощью systemd</span>
</h4>
<p><a href="../ru/Systemd.html" title="Systemd (Русский)">Systemd</a> умеет выполнять задания при наступлении событий. В данном случае используется возможность отслеживания изменений в определённой папке для синхронизации EFISTUB ядер и initramfs файлов при их обновлении в <code>/boot</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/efistub-update.path</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Copy EFISTUB Kernel to UEFISYS Partition

[Path]
PathChanged=/boot/initramfs-linux-fallback.img

[Install]
WantedBy=multi-user.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Здесь используется отслеживание изменений в <code>initramfs-linux-fallback.img</code>, так как это последний файл, собранный с помощью mkinitcpio. Это сделано для того, чтобы избежать начала потенциальной гонки, когда systemd может копировать старые файлы до того, как все они будут собраны.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/efistub-update.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Copy EFISTUB Kernel to UEFISYS Partition

[Service]
Type=oneshot
ExecStart=/usr/bin/cp -f /boot/vmlinuz-linux $esp/EFI/arch/vmlinuz-linux
ExecStart=/usr/bin/cp -f /boot/initramfs-linux.img $esp/EFI/arch/initramfs-linux.img
ExecStart=/usr/bin/cp -f /boot/initramfs-linux-fallback.img $esp/EFI/arch/initramfs-linux-fallback.img
</pre>
<p>Включите эти сервисы с помощью:
</p>
<pre># systemctl enable efistub-update.path
</pre>
<p>Вам нужно будет перезагрузиться либо сказать systemd начать отслеживать папку с помощью:
</p>
<pre># systemctl start efistub-update.path
</pre>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_incron"></span><span class="mw-headline" id="С_помощью_incron">С помощью incron</span>
</h4>
<p>Чтобы запускать скрипт синхронизации EFISTUB ядра при обновлениях ядра можно использовать <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=incron">incron</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/efistub-update.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash
/usr/bin/cp -f /boot/vmlinuz-linux $esp/EFI/arch/vmlinuz-linux
/usr/bin/cp -f /boot/initramfs-linux.img $esp/EFI/arch/initramfs-linux.img
/usr/bin/cp -f /boot/initramfs-linux-fallback.img $esp/EFI/arch/initramfs-linux-fallback.img</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Первый параметр <code>/boot/initramfs-linux-fallback.img</code> - это файл для отслеживания. Второй параметр <code>IN_CLOSE_WRITE</code> - это действие, которое надо отслеживать. Третий параметр <code>/usr/local/bin/efistub-update.sh</code> - это скрипт, который будет выполнен.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/incron.d/efistub-update.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/boot/initramfs-linux-fallback.img IN_CLOSE_WRITE /usr/local/bin/efistub-update.sh</pre>
<p>Чтобы использовать данный метод, включите сервис incrond:
</p>
<pre># systemctl enable incrond.service
</pre>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_.D1.85.D1.83.D0.BA.D0.B0_mkinitcpio"></span><span class="mw-headline" id="С_помощью_хука_mkinitcpio">С помощью хука mkinitcpio</span>
</h4>
<p>Mkinitcpio может сгенерировать хук, которому для работы не требуется демон системного уровня. Он порождает фоновый процесс, который ждёт генерации <code>vm-linuz</code>, <code>initramfs-linux.img</code> и <code>initramfs-linux-fallback.img</code> перед копированием файлов.
</p>
<p>Добавьте <code>efistub-update</code> в список хуков в <code>/etc/mkinitcpio.conf</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/initcpio/install/efistub-update</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash
build() {
	/root/watch.sh &amp;
}

help() {
	cat &lt;&lt;HELPEOF
This hook waits for mkinitcpio to finish and copies the finished ramdisk and kernel to the ESP
HELPEOF
}</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/root/watch.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

while [[ -d "/proc/$PPID" ]]; do
	sleep 1
done

/usr/bin/cp -f /boot/vmlinuz-linux $esp/EFI/arch/vmlinuz-linux
/usr/bin/cp -f /boot/initramfs-linux.img $esp/EFI/arch/initramfs-linux.img
/usr/bin/cp -f /boot/initramfs-linux-fallback.img $esp/EFI/arch/initramfs-linux-fallback.img

echo "Synced kernel with ESP"</pre>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_.D0.B1.D0.B8.D0.BD.D0.B4.D0.B8.D0.BD.D0.B3.D0.B0_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="С_помощью_биндинга_монтирования">С помощью биндинга монтирования</span>
</h4>
<p>Вместо того, чтобы монтировать сам ESP раздел в <code>/boot</code>, вы можете примонтировать директорию ESP раздела в <code>/boot</code> используя bind mount (смотрите <code>mount(8)</code>). Это позволит pacman обновлять ядро непосредственно, в то же время оставляя организацию ESP на ваше усмотрение. Если это у вас работает, то данный способ является гораздо проще всех остальных, которые копируют файлы.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Для этого требуется ядро и загрузчик, совместимый с FAT32. Это не проблема для обычных установок Arch, номожет быть проблемой для других дистрибутивов (а именно тех, которым требуются симлинки в <code>/boot</code>). Сообщение на форуме <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1331867#p1331867">здесь</a>.</div>
<p>Как и <a href="#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5_%D1%82%D0%BE%D1%87%D0%BA%D0%B8_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BB%D1%8F_ESP">прежде</a>, скопируйте все загружаемые файлы в директорию на вашем ESP, но смонтируйте ESP <b>вне</b> <code>/boot</code> (например, в <code>/esp</code>). Затем примонтируемый каталог:
</p>
<pre># mount --bind /esp/EFI/arch/ /boot
</pre>
<p>Если ваши файлы появились в <code>/boot</code>, как и ожидалось, отредактируйте ваш <a href="../ru/Fstab.html" title="Fstab (Русский)">Fstab</a>, чтобы сделать монтирование постоянным:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/esp/EFI/arch /boot none defaults,bind 0 0
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Вы <i>обязаны</i> использовать <a href="../en/Kernel_parameters.html#%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2" class="mw-redirect" title="Параметры ядра">параметр ядра</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup> <code>root=<i>system_root</i></code> для того чтобы загружаться с использованием данного метода.</div>
<h2>
<span id=".D0.97.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B0_EFISTUB"></span><span class="mw-headline" id="Загрузка_EFISTUB">Загрузка EFISTUB</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Путь до Linux EFISTUB ядра initramfs должен быть относительным к корню Системного Раздела EFI. Например, если initramfs расположен в <code>$esp/EFI/arch/initramfs-linux.img</code>, то соответствующей UEFI строкой должна быть <code>initrd=/EFI/arch/initramfs-linux.img</code> или <code>initrd=\EFI\arch\initramfs-linux.img</code>. В следующих примерах будет предполагаться, что всё расположено в <code>$esp/</code>.</div>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D1.8F_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8"></span><span class="mw-headline" id="Используя_менеджер_загрузки">Используя менеджер загрузки</span>
</h3>
<p>Есть несколько UEFI менеджеров загрузки, которые могут предоставить дополнительные опции или упростить процесс загрузки UEFI, особенно если у вас есть несколько ядер/операционных систем. Смотрите <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Загрузчики">Загрузчики</a> для дополнительной информации.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D1.8F_UEFI_Shell"></span><span class="mw-headline" id="Используя_UEFI_Shell">Используя UEFI Shell</span>
</h3>
<p>Есть возможность запускать EFISTUB ядро из UEFI Shell как обычное UEFI приложение. В этом случае параметры ядра передаются как обычные параметры запускаемому файлу EFISTUB ядра.
</p>
<pre>&gt; fs0:
&gt; /vmlinuz-linux root=PARTUUID=3518bb68-d01e-45c9-b973-0b5d918aae96 initrd=/initramfs-linux.img
</pre>
<p>Чтобы избежать необходимости каждый раз вспоминать все параметры вашего ядра, вы можете сохранить исполняемую команду в shell скрипт, например в <code>archlinux.nsh</code> на вашем Системном Разделе UEFI, а затем запустить её с помощью:
</p>
<pre>&gt; fs0:
&gt; archlinux
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D1.8F_.D0.BD.D0.B5.D0.BF.D0.BE.D1.81.D1.80.D0.B5.D0.B4.D1.81.D1.82.D0.B2.D0.B5.D0.BD.D0.BD.D0.BE_UEFI_.28efibootmgr.29"></span><span class="mw-headline" id="Используя_непосредственно_UEFI_(efibootmgr)">Используя непосредственно UEFI (efibootmgr)</span>
</h3>
<p>UEFI <a href="../en/Unified_Extensible_Firmware_Interface.html#%D0%9C%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_UEFI" class="mw-redirect" title="UEFI (Русский)">разработан так, чтобы убрать необходимость</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup> наличия промежуточных загрузчиков, таких как <a href="../ru/GRUB.html" title="GRUB (Русский)">GRUB</a>. Если ваша материнская плата имеет хорошую реализацию UEFI, есть возможность вставлять параметры ядра внутрь загрузочных записей UEFI и материнская плата сможет загружать непрсредственно Arch. Вы можете использовать <code>efibootmgr</code> чтобы модифицировать загрузочные записи вашей материнской платы изнутри Arch.
</p>
<pre># efibootmgr -d /dev/sd<b>X</b> -p <b>Y</b> -c -L "Arch Linux" -l /vmlinuz-linux -u "root=<b>/dev/sda2</b> rw initrd=\initramfs-linux.img"
</pre>
<p>Где <code>X</code> и <code>Y</code> замените на соответсвующий диск и раздел, где находится ваш ESP. Измените параметр <code>root=</code>, чтобы он соответствовал корню вашего Linux (также можно использовать UUID диска).
</p>
<p><b>Или</b> с помощью действия <a href="../en/Power_management/Suspend_and_hibernate.html#Required_kernel_parameters" class="mw-redirect" title="Suspend and hibernate">приостановки на диск</a>:
</p>
<pre># efibootmgr -d /dev/sd<b>X</b> -p <b>Y</b> -c -L "Arch Linux" -l /vmlinuz-linux -u "root=<b>/dev/sda2</b> rw resume=<b>/dev/sda4</b> initrd=\initramfs-linux.img"
</pre>
<p>Измените параметр <code>resume=</code> на соответствующий вашему swap разделу, оставив остальные параметры такими, как описано выше.
</p>
<p>Затем хорошей идеей будет выполнение
</p>
<pre># efibootmgr -v
</pre>
<p>для проверки того, что получившаяся запись корректна.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Некоторые комбинации версий ядер и <code>efibootmgr</code> могут отказываться создавать новые загрузочные записи. Это может происходить из-за того что не хватает свободного места в NVRAM. Вы можете попробовать удалить какие-нибудь мусорные EFI файлы
<pre># rm /sys/firmware/efi/efivars/dump-*
</pre>
Или же, в качестве последней надежды, загрузитесь с параметром ядра <code>efi_no_storage_paranoia</code>. Вы также можете попробовать откатить efibootmgr до версии  0.11.0, если она доступна в вашем кеше. Эта версия работает с Linux версии 4.0.6. Смотрите обсуждение ошибки <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/34641">FS#34641</a> для дополнительной информации.</div>
<p>Чтобы задать порядок загрузки выполните:
</p>
<pre># efibootmgr -o XXXX,XXXX
</pre>
<p>где XXXX - это номер, который появляется в выводе команды `efibootmgr` напротив каждой записи.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Сохраните где-нибудь команду для создания вашей загрузочной записи в шелл скрипте, который поможет вам при изменениях (например, когда вы захотите изменить параметры ядра).</div>
<p>Дополнительную информацию по efibootmgr смотрите в <a href="../en/Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="UEFI (Русский)">UEFI (Русский)#efibootmgr</a>. Пост на форуме <a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=1090040#p1090040">https://bbs.archlinux.org/viewtopic.php?pid=1090040#p1090040</a> .
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Boot_loaders.html" title="Category:Boot loaders (Русский)">Boot loaders (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=EFISTUB_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=644998">https://wiki.archlinux.org/index.php?title=EFISTUB_(Русский)&amp;oldid=644998</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 13 December 2020, at 10:25.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
