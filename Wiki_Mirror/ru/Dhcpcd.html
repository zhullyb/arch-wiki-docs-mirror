<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dhcpcd (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dhcpcd_Русский rootpage-Dhcpcd_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">dhcpcd (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Network_configuration.html" class="mw-redirect" title="Настройка сети">Настройка сети</a></li>
<li><a href="../ru/1dc7f819a14c7ee72d436a3b4a1a1db3.html" class="mw-redirect" title="Настройка беспроводной сети">Настройка беспроводной сети</a></li>
<li><a href="../ru/Dhcpd.html" title="Dhcpd (Русский)">dhcpd (Русский)</a></li>
</ul>
</div>
<p><i>dhcpcd</i> — свободная реализация клиента DHCP и DHCPv6. На данный момент является наиболее развитым DHCP-клиентом с открытым исходным кодом. Полный список возможностей вы можете найти на <a rel="nofollow" class="external text" href="http://roy.marples.name/projects/dhcpcd/">домашней странице проекта</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Не путайте <i>dhcpcd</i> — DHCP-клиент и <a href="../ru/Dhcpd.html" title="Dhcpd (Русский)">dhcpd</a>, который является <b>DHCP-сервером</b>.</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Установка</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">2</span> <span class="toctext">Запуск</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0"><span class="tocnumber">3</span> <span class="toctext">Настройка</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D1%8B"><span class="tocnumber">3.1</span> <span class="toctext">Статические маршруты</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#%D0%98%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0"><span class="tocnumber">3.2</span> <span class="toctext">Идентификатор клиента</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#%D0%A3%D1%81%D0%BA%D0%BE%D1%80%D0%B5%D0%BD%D0%B8%D0%B5_DHCP_%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC_ARP-%D1%81%D0%BA%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F"><span class="tocnumber">3.3</span> <span class="toctext">Ускорение DHCP отключением ARP-сканирования</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#%D0%97%D0%B0%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D0%B9_%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D1%80%D0%BE%D1%84%D0%B8%D0%BB%D1%8C"><span class="tocnumber">3.4</span> <span class="toctext">Запасной статический профиль</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#%D0%A5%D1%83%D0%BA%D0%B8"><span class="tocnumber">4</span> <span class="toctext">Хуки</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#10-wpa_supplicant"><span class="tocnumber">4.1</span> <span class="toctext">10-wpa_supplicant</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8"><span class="tocnumber">5</span> <span class="toctext">Советы и рекомендации</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#%D0%9E%D1%81%D0%B2%D0%BE%D0%B1%D0%BE%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B0%D1%80%D0%B5%D0%BD%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%B0"><span class="tocnumber">5.1</span> <span class="toctext">Освобождение арендованного IP-адреса</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC"><span class="tocnumber">6</span> <span class="toctext">Решение проблем</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#Client_ID"><span class="tocnumber">6.1</span> <span class="toctext">Client ID</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%D0%9E%D1%81%D0%B2%D0%BE%D0%B1%D0%BE%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B0%D1%80%D0%B5%D0%BD%D0%B4%D1%8B_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%B0"><span class="tocnumber">6.2</span> <span class="toctext">Освобождение аренды IP-адреса</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%D0%9D%D0%B5_%D1%83%D0%B4%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%D1%81%D1%8F_%D0%BA_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80%D1%83"><span class="tocnumber">6.3</span> <span class="toctext">Не удается подключиться к маршрутизатору</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#dhcpcd.service_%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82%D1%83%D0%B5%D1%82_%D1%81_udev_%D0%BF%D1%80%D0%B8_%D1%81%D1%82%D0%B0%D1%80%D1%82%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B"><span class="tocnumber">6.4</span> <span class="toctext">dhcpcd.service конфликтует с udev при старте системы</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%D0%92%D1%80%D0%B5%D0%BC%D1%8F_%D0%BE%D0%B6%D0%B8%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F"><span class="tocnumber">6.5</span> <span class="toctext">Время ожидания</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">7</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p><a href="../ru/Pacman.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BE%D1%82%D0%B4%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span>, доступный в <a href="../ru/Official_repositories.html" class="mw-redirect" title="Официальных репозиториях">официальных репозиториях</a>. Он является частью группы <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span>, поэтому, скорее всего он уже установлен в вашей системе.
</p>
<p>Также с пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dhcpcd-ui/">dhcpcd-ui</a></span><sup><small>AUR</small></sup> (доступен в <a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="AUR (Русский)">AUR</a>) вы можете установить графическую оболочку <a href="../en/GTK.html" class="mw-redirect" title="GTK+">GTK+</a> для демона <i>dhcpcd</i> (и, опционально, для <a href="../en/Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant (Русский)">wpa_supplicant</a>). Он предоставляет диалоговую панель для настройки и позволяет вводить данные для подключения к беспроводным сетям.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dhcpcd-ui-patched/">dhcpcd-ui-patched</a></span><sup><small>AUR</small></sup> - патченная версия пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dhcpcd-ui/">dhcpcd-ui</a></span><sup><small>AUR</small></sup>. Она использует AppIndicator вместо GtkStatusIcon и компилируется с gtk3, благодаря чему имеет четкую иконку в трее при использовании с <a href="../en/KDE.html" title="KDE">KDE</a>.
</p>
<h2>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Запуск">Запуск</span>
</h2>
<p>Вместе с <i>dhcpcd</i> предоставляются два юнит-файла <a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a>, каждый из которых может быть использован для управления демоном:
</p>
<ul>
<li>служба <code>dhcpcd.service</code> запускает клиент для всех сетевых интерфейсов.</li>
<li>служба <code>dhcpcd@.service</code> может использоваться для запуска клиента на отдельном сетевом интерфейсе, например: <code>dhcpcd@<i>eth0</i>.service</code>.</li>
</ul>
<p>Чтобы запустить <i>dhcpcd</i> вручную, просто наберите:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dhcpcd <i>eth0</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dhcpcd: version 5.1.1 starting
dhcpcd: <i>eth0</i>: broadcasting for a lease
...
dhcpcd: <i>eth0</i>: leased 192.168.1.70 for 86400 seconds
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Если вы выбрали <code>dhcpcd.service</code> и он не запускается, смотрите раздел <a href="#dhcpcd.service_%D0%BA%D0%BE%D0%BD%D1%84%D0%BB%D0%B8%D0%BA%D1%82%D1%83%D0%B5%D1%82_%D1%81_udev_%D0%BF%D1%80%D0%B8_%D1%81%D1%82%D0%B0%D1%80%D1%82%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">#dhcpcd.service конфликтует с udev при старте системы</a>.</div>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>Основная часть настроек выполняется в файле <code>/etc/dhcpcd.conf</code>. Некоторые наиболее используемые опции описаны далее. Подробнее о структуре файла и его содержании смотрите в <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span>.
</p>
<h3>
<span id=".D0.A1.D1.82.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BC.D0.B0.D1.80.D1.88.D1.80.D1.83.D1.82.D1.8B"></span><span class="mw-headline" id="Статические_маршруты">Статические маршруты</span>
</h3>
<p>Если вы хотите, чтобы при подключении добавлялись статические маршруты, создайте новый хук-скрипт в <code>/usr/lib/dhcpcd/dhcpcd-hooks</code> и напишите в нем команды для добавления маршрутов. Например, чтобы добавить маршрут в подсети <code>10.11.12.0/24</code> через шлюз <code>192.168.192.5</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/dhcpcd/dhcpcd-hooks/40-vpnroute</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ip route add 10.11.12.0/24 via 192.168.192.5
</pre>
<p>Префикс <code>40</code> использован для того, чтобы данный скрипт отрабатывал после уже имеющихся хук-скриптов.
</p>
<h3>
<span id=".D0.98.D0.B4.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D1.80_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0"></span><span class="mw-headline" id="Идентификатор_клиента">Идентификатор клиента</span>
</h3>
<p>Сервер DHCP может однозначно идентифицировать клиента посредством различных параметров:
</p>
<ul>
<li>имя хоста (в частности то имя, которое отправляет клиент),</li>
<li>MAC-адрес сетевого адаптера клиента через который проходит соединение,</li>
<li>Identity Association ID (IAID),</li>
<li>DHCP Unique Identifier (DUID).</li>
</ul>
<p>Подробнее смотрите в <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc3315#section-4.2">RFC 3315</a>.
</p>
<p>В зависимости от настроек DHCP-сервера, какие-то из этих параметров могут быть обязательными, а другие — опциональными.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Стандартной конфигурации <i>dhcpcd</i> в большинстве случаев будет достаточно. Указанные параметры определяются автоматически и ручная настройка обычно требуется только при возникновении проблем.</div>
<p>Если при использовании стандартных настроек не удается получить IP, для настройки вы можете использовать следующие опции в <code>dhcpcd.conf</code>:
</p>
<ul>
<li>
<code>hostname</code> — отправляет имя хоста (берется из <code>/etc/hostname</code>).</li>
<li>
<code>clientid</code> — отправляет MAC-адрес интерфейса в качестве идентификатора.</li>
<li>
<code>iaid <i>имя_интерфейса</i></code> — извлекает IAID для интерфейса, указанного в опции <code>interface <i>имя_интерфейса</i></code>. Обе эти опции должны присутствовать одновременно, дополнительно смотрите <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1388376#p1388376">это обсуждение</a>.</li>
<li>
<code>duid</code> — указывает <i>dhcpcd</i> использовать из DUID и IAID в качестве идентификатора.</li>
</ul>
<p>Значение DUID устанавливается в <code>/etc/dhcpcd.duid</code>. Для эффективной работы DHCP важно, чтобы это значение было уникальным для конкретной системы, и устанавливалось одинаковым на все сетевые интерфейсы. В свою очередь, IAID представляет собой уникальный идентификатор для каждого сетевого интерфейса в отдельности (смотрите подробнее в <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc4361#section-6.1">RFC 4361</a>).
</p>
<p>При использовании <a href="https://en.wikipedia.org/wiki/Dynamic_DNS" class="extiw" title="wikipedia:Dynamic DNS">Dynamic DNS</a> особенно необходимо удостовериться в уникальности этих идентификаторов. Если в сети находятся два DNS-клиента с одинаковыми DUID, они будут конфликтовать, поочередно отнимая друг у друга аренду DNS-записи. Это может произойти, например, в случае, если была сделана копия виртуальной машины с другими именем хоста и MAC-адресом адаптера, но DUID в настройках остался прежним.
</p>
<h3>
<span id=".D0.A3.D1.81.D0.BA.D0.BE.D1.80.D0.B5.D0.BD.D0.B8.D0.B5_DHCP_.D0.BE.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5.D0.BC_ARP-.D1.81.D0.BA.D0.B0.D0.BD.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Ускорение_DHCP_отключением_ARP-сканирования">Ускорение DHCP отключением ARP-сканирования</span>
</h3>
<p><i>dhcpcd</i>, следуя рекомендациям стандарта DHCP (<a rel="nofollow" class="external text" href="http://www.ietf.org/rfc/rfc2131.txt">RFC2131</a>, раздел 2.2), проверяет при помощи запросов ARP, что присвоенный IP-адрес не используется каким-нибудь другим устройством в сети. Как правило, для небольших домашних сетей в этом нет необходимости, поэтому вы можете ускорить соединение <i>dhcpcd</i> примерно на 5 секунд, добавив в <code>/etc/dhcpcd.conf</code> строку:
</p>
<pre>noarp
</pre>
<p>Того же эффекта можно достичь, запуская <i>dhcpcd</i> с опцией <code>--noarp</code>.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D0.B0.D1.81.D0.BD.D0.BE.D0.B9_.D1.81.D1.82.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.BF.D1.80.D0.BE.D1.84.D0.B8.D0.BB.D1.8C"></span><span class="mw-headline" id="Запасной_статический_профиль">Запасной статический профиль</span>
</h3>
<p>Вы можете настроить статические параметры IP в <i>dhcpcd</i>, которые будут использоваться в качестве резервных, если не удалось получить аренду от сервера. Это полезно для автономных устройств, к которым обычно есть доступ только по сети (например, <a href="../en/Category:ARM_architecture.html" class="mw-redirect" title="Raspberry Pi">Raspberry Pi</a>) для того, чтобы не потерять возможность с ними соединиться.
</p>
<p>В следующем примере создается профиль <code>static_eth0</code> с IP <code>192.168.1.1</code> и адресом шлюза и DNS <code>192.168.1.23</code>, который устанавливается как запасной для <code>eth0</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># define static profile
profile static_eth0
static ip_address=192.168.1.1
static routers=192.168.1.23
static domain_name_servers=192.168.1.23

# fallback to static profile on eth0
interface eth0
fallback static_eth0
</pre>
<p>Возможны также более сложные варианты настройки, например, совмещение с опцией <code>arping</code>. Подробнее смотрите в <code>dhcpcd.conf(5)</code>.
</p>
<h2>
<span id=".D0.A5.D1.83.D0.BA.D0.B8"></span><span class="mw-headline" id="Хуки">Хуки</span>
</h2>
<p><i>dhcpcd</i> запускает все скрипты в каталоге <code>/usr/lib/dhcpcd/dhcpcd-hooks/</code> в последовательности, определенной стандартным порядком сортировки. Более подробно смотрите в <code>dhcpcd(5)</code> и <code>dhcpcd-run-hooks(8)</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Каждый скрипт можно отключить при помощи опции <code>nohook</code> в <code>dhcpcd.conf</code>.</li>
<li>Опция <code>env</code> позволяет установить переменные окружения для <b>всех</b> хуков. Например, вы можете заставить хук <code>30-hostname</code> всегда устанавливать имя хоста, указав <code>env force_hostname=YES</code>.</li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>Эта статья или раздел нуждается в <a href="../ru/ArchWiki:Contributing.html#%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4" title="ArchWiki:Contributing (Русский)">переводе</a></b><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Примечания:</b> Необходимо добавить описание стандартных хуков. (обсуждение: <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Dhcpcd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Talk:Dhcpcd (Русский)#</a>)</div>
</div>
<h3><span class="mw-headline" id="10-wpa_supplicant">10-wpa_supplicant</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Начиная с версии dhcpcd-6.10.0-1 поведение демона по умолчанию изменено: теперь хук 10-wpa_supplicant не запускается по умолчанию! Подробнее: <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=207416">[1]</a>, <a rel="nofollow" class="external autonumber" href="https://gentoo.org/support/news-items/2016-01-08-some-dhcpcd-hooks-are-now-examples.html">[2]</a>
</div>
<p>Хук <code>10-wpa_supplicant</code> автоматически запускает <a href="../en/Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant">WPA supplicant</a> для беспроводных интерфейсов. Это происходит только если:
</p>
<ul>
<li>процесс <i>wpa_supplicant</i> еще не запущен на данном интерфейсе</li>
<li>существует файл настроек <i>wpa_supplicant</i>. <i>dhcpcd</i> проверяет следующие пути:</li>
</ul>
<pre>/etc/wpa_supplicant/wpa_supplicant-"$interface".conf
/etc/wpa_supplicant/wpa_supplicant.conf
/etc/wpa_supplicant-"$interface".conf
/etc/wpa_supplicant.conf
</pre>
<p>в указанном порядке. Вы можете указать свой список путей, используя опцию <code>env wpa_supplicant_conf=<i>путь</i></code> в <code>/etc/dhcpcd.conf</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Хук использует первый файл настроек, который ему удастся найти, и не будет принимать во внимание остальные. Имейте это в виду, если у вас несколько файлов настроек <i>wpa_supplicant</i>.</div>
<p>Если вы самостоятельно подключаетесь к беспроводным сетям с помощью <i>wpa_supplicant</i>, этот хук может приводить к нежелательным попыткам подключения. Например, если вы остановили <i>wpa_supplicant</i>, он может вновь включить сетевой интерфейс. Также, если вы используете <a href="../en/Netctl.html#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D1%84%D0%B8%D0%BB%D0%B5%D0%B9" class="mw-redirect" title="Netctl (Русский)">netctl-auto</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup>, <i>wpa_supplicant</i> будет запускаться автоматически с использованием файла настроек <code>/run/network/wpa_supplicant_"$interface".conf</code>, поэтому запуск из хука будет излишним и приведет лишь к появлению ошибок в логе при чтении стандартного файла <code>/etc/wpa_supplicant/wpa_supplicant.conf</code>, который содержит лишь примеры и может не являться корректным с точки зрения программы.
</p>
<p>Чтобы выключить хук, добавьте <code>nohook wpa_supplicant</code> в <code>dhcpcd.conf</code>.
</p>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.9E.D1.81.D0.B2.D0.BE.D0.B1.D0.BE.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B0.D1.80.D0.B5.D0.BD.D0.B4.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_IP-.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.B0"></span><span class="mw-headline" id="Освобождение_арендованного_IP-адреса">Освобождение арендованного IP-адреса</span>
</h3>
<p>Файл аренды <code>/var/lib/dhcpcd/dhcpcd-<i>имя_интерфейса</i>.lease</code> (где <code><i>имя_интерфейса</i></code> — имя сетевого интерфейса, для которого имеется назначенный в аренду IP-адрес) содержит последний ответ на запрос аренды, полученный от DHCP-сервера. Он используется для того, чтобы сохранить адрес и срок аренды (атрибут <code>mtime</code>). По истечении срока IP-адрес из файла запрашивается снова у DHCP-сервера, и, если адрес свободен, он снова присваивается сетевому интерфейсу клиента. Если вы не хотите, чтобы использовался тот же IP-адрес, просто удалите этот файл и перезапустите <i>dhcpcd</i>.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3><span class="mw-headline" id="Client_ID">Client ID</span></h3>
<p>Если у вас сеть с DHCPv4, которая фильтрует Client ID, основанные на MAC-адресах, вам скорее всего нужно изменить строку
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Use the same DUID + IAID as set in DHCPv6 for DHCPv4 Client ID as per RFC4361.
duid
</pre>
<p>на
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Use the hardware address of the interface for the Client ID (DHCPv4).
clientid
</pre>
<p>иначе вы не сможете получать аренду от DHCP, если он не может правильно прочесть ваш Client ID <a href="https://en.wikipedia.org/wiki/DHCPv6" class="extiw" title="wikipedia:DHCPv6">DHCPv6</a>. Подробнее смотрите в <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc4361">RFC 4361</a>.
</p>
<h3>
<span id=".D0.9E.D1.81.D0.B2.D0.BE.D0.B1.D0.BE.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B0.D1.80.D0.B5.D0.BD.D0.B4.D1.8B_IP-.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.B0"></span><span class="mw-headline" id="Освобождение_аренды_IP-адреса">Освобождение аренды IP-адреса</span>
</h3>
<p>Иногда происходит нежелательное присвоение IP-адреса. Например, когда два маршрутизатора соединены вместе через VPN-канал, и второй маршрутизатор через этот канал присваивает IP клиенту. Чтобы это исправить, освободите IP-адрес, выполнив:
</p>
<pre># dhcpcd -k
</pre>
<p>Теперь попробуйте снова:
</p>
<pre># dhcpcd
</pre>
<p>Вероятно, желаемого результата не удастся добиться с первого раза.
</p>
<h3>
<span id=".D0.9D.D0.B5_.D1.83.D0.B4.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B8.D1.82.D1.8C.D1.81.D1.8F_.D0.BA_.D0.BC.D0.B0.D1.80.D1.88.D1.80.D1.83.D1.82.D0.B8.D0.B7.D0.B0.D1.82.D0.BE.D1.80.D1.83"></span><span class="mw-headline" id="Не_удается_подключиться_к_маршрутизатору">Не удается подключиться к маршрутизатору</span>
</h3>
<p>С некоторыми маршрутизаторами может возникать проблема, когда к ним не удается подключиться при помощи <i>dhcpcd</i>. Для того, чтобы это исправить, закомментируйте или удалите строку
</p>
<pre>require dhcp_server_identifier
</pre>
<p>в файле настроек <code>/etc/dhcpcd.conf</code>. Обратите внимание, что это может вызвать новые проблемы, если в вашей сети находятся несколько DHCP-серверов; смотрите <a rel="nofollow" class="external text" href="https://technet.microsoft.com/en-us/library/cc977442.aspx">эту страницу</a> для получения дополнительной информации.
</p>
<h3>
<span id="dhcpcd.service_.D0.BA.D0.BE.D0.BD.D1.84.D0.BB.D0.B8.D0.BA.D1.82.D1.83.D0.B5.D1.82_.D1.81_udev_.D0.BF.D1.80.D0.B8_.D1.81.D1.82.D0.B0.D1.80.D1.82.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="dhcpcd.service_конфликтует_с_udev_при_старте_системы">dhcpcd.service конфликтует с udev при старте системы</span>
</h3>
<p><code>dhcpcd.service</code> может быть <a href="../ru/Systemd.html#%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD" title="Systemd (Русский)">Systemd (Русский)#включен</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup> без указания сетевого интерфейса. Однако, это может создать т. н. <i>состояние гонки</i> (конфликт) с <i>systemd-udevd</i> в момент загрузки системы, когда <i>systemd-udevd</i> пытается назначить интерфейсу постоянное имя:
</p>
<pre>error changing net interface name wlan0 to wlp4s0: Device or resource busy
</pre>
<p>Чтобы избежать этого, запускайте <i>dhcpcd</i> для каждого конкретного сетевого интерфейса отдельно, как описано в разделе <a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA">#Запуск</a>.
</p>
<h3>
<span id=".D0.92.D1.80.D0.B5.D0.BC.D1.8F_.D0.BE.D0.B6.D0.B8.D0.B4.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Время_ожидания">Время ожидания</span>
</h3>
<p>Если <i>dhcpcd</i> работает на одном сетевом интерфейсе и ему не удается получить аренду в течение 30 секунд (например, если сервер еще не готов), процесс просто выведет сообщение об ошибке и завершится. Чтобы заставить <i>dhcpcd</i> ожидать бесконечно, добавьте опцию <code>timeout</code> со значением <code>0</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/dhcpcd@.service.d/timeout.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dhcpcd -w -q <b>-t 0</b> %I</pre>
<p>Не забудьте <a href="../ru/Systemd.html#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0%D0%BC%D0%B8_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">перезагрузить конфигурацию systemd</a>.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="http://roy.marples.name/man/html8/dhcpcd.html">dhcpcd(8)</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-02]</sup>
</li>
<li>
<a rel="nofollow" class="external text" href="http://roy.marples.name/man/html5/dhcpcd.conf.html">dhcpcd.conf(5)</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-02]</sup>
</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:DHCP.html" title="Category:DHCP (Русский)">DHCP (Русский)</a></li>
<li><a href="../ru/Category:Commands.html" title="Category:Commands (Русский)">Commands (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../ru/Category:Pages_or_sections_flagged_with_Template:Translateme.html" title="Category:Pages or sections flagged with Template:Translateme (Русский)">Pages or sections flagged with Template:Translateme (Русский)</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dhcpcd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=644987">https://wiki.archlinux.org/index.php?title=Dhcpcd_(Русский)&amp;oldid=644987</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 13 December 2020, at 10:18.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
