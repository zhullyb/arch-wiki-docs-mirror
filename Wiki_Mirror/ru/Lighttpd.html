<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Lighttpd (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Lighttpd_Русский rootpage-Lighttpd_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Lighttpd (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>Эта статья или раздел нуждается в <a href="../ru/ArchWiki:Contributing.html#%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4" title="ArchWiki:Contributing (Русский)">переводе</a></b><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Примечания:</b> Перевод устарел. (обсуждение: <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Lighttpd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Talk:Lighttpd (Русский)#</a>)</div>
</div>
<p><b>lighttpd</b> - веб-сервер, разрабатываемый с расчётом на быстроту и защищённость, а также соответствие стандартам. В lighttpd есть поддержка сжатия отдаваемого содержимого «на лету», HTTP-аутентификации, перезаписи URL, SSL и автоматической балансировки нагрузки (нагрузка может автоматически распределяться по нескольким запущенным серверам lighttpd). Веб-сервер также поддерживает интерфейсы CGI, SCGI, FastCGI.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Установка</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0"><span class="tocnumber">2</span> <span class="toctext">Настройка</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#CGI"><span class="tocnumber">3</span> <span class="toctext">CGI</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#FastCGI"><span class="tocnumber">4</span> <span class="toctext">FastCGI</span></a>
<ul>
<li class="toclevel-2 tocsection-5">
<a href="#PHP"><span class="tocnumber">4.1</span> <span class="toctext">PHP</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#php-fpm"><span class="tocnumber">4.1.1</span> <span class="toctext">php-fpm</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#SSI"><span class="tocnumber">5</span> <span class="toctext">SSI</span></a></li>
<li class="toclevel-1 tocsection-8">
<a href="#SSL"><span class="tocnumber">6</span> <span class="toctext">SSL</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BD%D0%B0%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_HTTP_%D0%BD%D0%B0_HTTPS"><span class="tocnumber">6.1</span> <span class="toctext">Перенаправление HTTP на HTTPS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#%D0%A1%D0%B6%D0%B0%D1%82%D0%B8%D0%B5_%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D1%8F%D1%89%D0%B8%D1%85_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85"><span class="tocnumber">7</span> <span class="toctext">Сжатие исходящих данных</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#%D0%A1%D0%B6%D0%B0%D1%82%D0%B8%D0%B5_%D0%B4%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D1%82%D0%B0"><span class="tocnumber">7.1</span> <span class="toctext">Сжатие динамического контента</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%B5%D1%88%D0%B5%D0%BC_%D0%B1%D1%80%D0%B0%D1%83%D0%B7%D0%B5%D1%80%D0%B0_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">8</span> <span class="toctext">Управление кешем браузера пользователя</span></a></li>
<li class="toclevel-1 tocsection-13">
<a href="#%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D1%85%D0%BE%D1%81%D1%82%D1%8B"><span class="tocnumber">9</span> <span class="toctext">Виртуальные хосты</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D0%B9"><span class="tocnumber">9.1</span> <span class="toctext">Использование условий</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#mod_simple_vhost"><span class="tocnumber">9.2</span> <span class="toctext">mod_simple_vhost</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#mod_evhost"><span class="tocnumber">9.3</span> <span class="toctext">mod_evhost</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#%D0%9B%D0%B8%D1%81%D1%82%D0%B8%D0%BD%D0%B3_%D0%B4%D0%B8%D1%80%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%B9"><span class="tocnumber">10</span> <span class="toctext">Листинг директорий</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#%D0%9E%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0"><span class="tocnumber">11</span> <span class="toctext">Ограничение доступа</span></a></li>
<li class="toclevel-1 tocsection-19">
<a href="#%D0%90%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F"><span class="tocnumber">12</span> <span class="toctext">Аутентификация</span></a>
<ul>
<li class="toclevel-2 tocsection-20"><a href="#%D0%9C%D0%B5%D1%82%D0%BE%D0%B4%D1%8B"><span class="tocnumber">12.1</span> <span class="toctext">Методы</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#Backends"><span class="tocnumber">12.2</span> <span class="toctext">Backends</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#plain"><span class="tocnumber">12.2.1</span> <span class="toctext">plain</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#htpasswd"><span class="tocnumber">12.2.2</span> <span class="toctext">htpasswd</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#htdigest"><span class="tocnumber">12.2.3</span> <span class="toctext">htdigest</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#ldap"><span class="tocnumber">12.2.4</span> <span class="toctext">ldap</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-26"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%B8"><span class="tocnumber">12.3</span> <span class="toctext">Пример конфигурации</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-27"><a href="#%D0%9A%D0%BE%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%BE_%D1%83%D0%BC%D0%BE%D0%BB%D1%87%D0%B0%D0%BD%D0%B8%D1%8E"><span class="tocnumber">13</span> <span class="toctext">Кодировка по умолчанию</span></a></li>
<li class="toclevel-1 tocsection-28">
<a href="#%D0%9F%D1%80%D0%BE%D0%BA%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">14</span> <span class="toctext">Проксирование</span></a>
<ul>
<li class="toclevel-2 tocsection-29"><a href="#Lighttpd_%D0%BA%D0%B0%D0%BA_reverse_proxy_%D0%B4%D0%BB%D1%8F_%D0%BE%D1%82%D0%B4%D0%B0%D1%87%D0%B8_%D1%81%D1%82%D0%B0%D1%82%D0%B8%D0%BA%D0%B8"><span class="tocnumber">14.1</span> <span class="toctext">Lighttpd как reverse proxy для отдачи статики</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#%D0%A0%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_Lighttpd"><span class="tocnumber">14.2</span> <span class="toctext">Распределние нагрузки с помощью Lighttpd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31">
<a href="#%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="tocnumber">15</span> <span class="toctext">Производительность</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="#HTTP_Keep-Alive"><span class="tocnumber">15.1</span> <span class="toctext">HTTP Keep-Alive</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA_%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B9"><span class="tocnumber">15.2</span> <span class="toctext">Обработчик событий</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D1%85_%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9"><span class="tocnumber">15.3</span> <span class="toctext">Обработчик сетевых соединений</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#%D0%9C%D0%B0%D0%BA%D1%81%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE_%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9"><span class="tocnumber">15.4</span> <span class="toctext">Максимальное количество соединений</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-36">
<a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B7%D0%BB%D0%B8%D1%87%D0%BD%D1%8B%D1%85_CMS"><span class="tocnumber">16</span> <span class="toctext">Примеры настроек для различных CMS</span></a>
<ul>
<li class="toclevel-2 tocsection-37"><a href="#phpMyAdmin"><span class="tocnumber">16.1</span> <span class="toctext">phpMyAdmin</span></a></li>
<li class="toclevel-2 tocsection-38">
<a href="#Mediawiki"><span class="tocnumber">16.2</span> <span class="toctext">Mediawiki</span></a>
<ul>
<li class="toclevel-3 tocsection-39"><a href="#texvc"><span class="tocnumber">16.2.1</span> <span class="toctext">texvc</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="#HTTPS_login"><span class="tocnumber">16.2.2</span> <span class="toctext">HTTPS login</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-41">
<a href="#Drupal"><span class="tocnumber">16.3</span> <span class="toctext">Drupal</span></a>
<ul>
<li class="toclevel-3 tocsection-42"><a href="#%D0%92%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82_1:_server.error-handler-404"><span class="tocnumber">16.3.1</span> <span class="toctext">Вариант 1: server.error-handler-404</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#%D0%92%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82_2:_mod_rewrite"><span class="tocnumber">16.3.2</span> <span class="toctext">Вариант 2: mod_rewrite</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-44"><a href="#MODX"><span class="tocnumber">16.4</span> <span class="toctext">MODX</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-45"><a href="#%D0%A1%D0%BC._%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">17</span> <span class="toctext">См. также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p>lighttpd доступ в extra репозитории
</p>
<pre># pacman -S lighttpd</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>Настройи lighttpd находятся в файле <code>/etc/lighttpd/lighttpd.conf</code>. Настройки по умолчанию позволяют проверить работоспособность сервера.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Проверить правильность настроек и выявить ошибки можно с помощью команды:
<pre>$ lighttpd -t -f /etc/lighttpd/lighttpd.conf</pre>
</div>
<p>По умолчанию в качестве document-root сервера служит директория <code>/srv/http/</code>.
</p>
<p>Проверяем, существует ли пользователь http:
</p>
<pre># grep http /etc/passwd</pre>
<p>Если такого пользователя нет в системе, добавляем его командой:
</p>
<pre># useradd -d /srv/http -r -s /bin/false -U http</pre>
<p>Проверим правильность установки
</p>
<pre># rc.d start lighttpd
# echo 'It works!' &gt; /srv/http/index.html</pre>
<p>Затем откройте в своём браузере адрес <a rel="nofollow" class="external free" href="http://localhost">http://localhost</a> и вы должны увидеть тестовую страницу.
</p>
<p>Вы также можете добавить lighttpd в секцию DAEMONS в <code>/etc/rc.conf</code>, чтобы он загружался при старте системы.
</p>
<p>Примеры конфигурационных файлов вы можете найти в <code>/usr/share/doc/lighttpd/config/</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Вы можете копировать текст из примеров прямо в <code>/etc/lighttpd/lighttpd.conf</code> или разместить настройки в отдельных файлах в <code>/etc/lighttpd/conf.d</code> (предварительно создав этот каталог). Чтобы включить файл с настройками из <code>/etc/lighttpd/conf.d</code> добавьте в <code>/etc/lighttpd/lighttpd.conf</code> следующую строку:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/example.conf"</pre>
<p>Вы также можете включить все файлы настроек из <code>/etc/lighttpd/conf.d/</code> одной командой:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include_shell "cat /etc/lighttpd/conf.d/*.conf"</pre>
<p>При этом файлы будут включаться в порядке их следования в каталоге, что может привести к непредсказуемым результатам. В качетсве решения можно перед названием файла ставить цифры, например, <code>10-auth.conf</code>, <code>20-fastcgi.conf</code>, <code>21-fastcgi-php.conf</code>.
</p>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Для корректной обработки различных типов файлов нужно определить mime-типы:
<pre># cp /usr/share/doc/lighttpd/config/conf.d/mime.conf /etc/lighttpd/conf.d/</pre>
<p>Теперь нужно включить эти настройки в <code>/etc/lighttpd/lighttpd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/mime.conf"
</pre>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> После изменения конфигурационных файлов не забудьте перезапустить сервер:
<pre># rc.d retsrt lighttpd</pre>
</div>
<h2><span class="mw-headline" id="CGI">CGI</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> По умолчанию lighttpd будет запускать процессы от пользователя и группы "http".</div>
<p>Этот модуль позволяет выполнять различные CGI программы. Пример конфигурации CGI модуля приведён ниже:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/cgi.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_alias", "mod_cgi" )

alias.url += ( "/cgi-bin" =&gt; server_root + "/cgi-bin" )
$HTTP["url"] =~ "^/cgi-bin" {
   cgi.assign = ( ".pl"  =&gt; "/usr/bin/perl",
                  ".cgi" =&gt; "/usr/bin/perl",
                  ".rb"  =&gt; "/usr/bin/ruby",
                  ".erb" =&gt; "/usr/bin/eruby",
                  ".py"  =&gt; "/usr/bin/python",
                  ".sh"  =&gt; "/bin/sh"
   )
}</pre>
<p>Включаем эти настройки в <code>/etc/lighttpd/lighttpd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/cgi.conf"</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Чтобы файлы с некоторым расширением исполнялись безо всякой спец. программы, просто не указывайте никакую CGI-программу: 
<pre>cgi.assign = ( ".sh" =&gt; "" )</pre>
<p>Файл без расширения, но имеет определённую правую часть URL: 
</p>
<pre>cgi.assign = ( "/testfile" =&gt; "" )</pre>
</div>
<h2><span class="mw-headline" id="FastCGI">FastCGI</span></h2>
<p>Устанавливаем FastCGI командой:
</p>
<pre># pacman -S fcgi</pre>
<p>Теперь у вас есть lighttpd с поддержкой fcgi.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> По умолчанию lighttpd будет запускать процессы от пользователя и группы "http".</div>
<p>Следующее содержимое нужно добавить в файл конфигурации
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/fastcgi.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_fastcgi" )

server.indexfiles += ( "dispatch.fcgi" ) #dispatch.fcgi if rails specified

server.error-handler-404   = "/dispatch.fcgi" #too
fastcgi.server = (
   ".fcgi" =&gt; ((
      "socket" =&gt; "/var/run/lighttpd/rails-fastcgi.sock",
      "bin-path" =&gt; "/path/to/rails/application/public/dispatch.fcgi"
   ))
)</pre>
<p>Включаем этот конфиг в <code>/etc/lighttpd/lighttpd.conf</code> строкой
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/fastcgi.conf"</pre>
<h3><span class="mw-headline" id="PHP">PHP</span></h3>
<p>Устанавливаем php и php-cgi
</p>
<pre># pacman -S php php-cgi</pre>
<p>Проверяем, что php-cgi работает:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ php-cgi --version</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PHP 5.3.8 with Suhosin-Patch (cgi-fcgi) (built: Sep 11 2011 10:04:49)
Copyright (c) 1997-2011 The PHP Group
Zend Engine v2.3.0, Copyright (c) 1998-2011 Zend Technologies</pre>
<p>Если вы увидели похожий вывод, значит всё установлено правильно.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы получаете ошибки, подобные этим "<i>No input file found</i>" при попытке получить доступ к вашему php файлу, убедитесь, что следующие директивы активированы в <code>/etc/php/php.ini</code>:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cgi.fix_pathinfo=1
open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/another/path:/second/path</pre>
<p>И что файлы доступны для чтения всем:
</p>
<pre># chmod -R 644</pre>
</div>
<p>Чтобы lighttpd мог работать с php в <code>/etc/lighttpd/conf.d/fastcgi-php.conf</code> добавляем
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/fastcgi-php.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_fastcgi" )

index-file.names += ( "index.php" )

fastcgi.server = (
   ".php" =&gt; (( 
      "bin-path" =&gt; "/usr/bin/php-cgi",
      "socket" =&gt; "/var/run/lighttpd/php-fastcgi" + PID + ".sock",
      "max-procs" =&gt; 4, # значение по умолчанию
      "bin-environment" =&gt; (
         "PHP_FCGI_CHILDREN" =&gt; "1", # значение по умолчанию
         "PHP_FCGI_MAX_REQUESTS" =&gt; "10000"
      ),
      "broken-scriptfilename" =&gt; "enable"
   ))
)

fastcgi.map-extensions = ( ".php3" =&gt; ".php", ".php4" =&gt; ".php", ".php5" =&gt; ".php", "phtml" =&gt; "php" ) # если используете разные версии php
</pre>
<p>Включаем этот конфиг в <code>/etc/lighttpd/lighttpd.conf</code> строкой
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/fastcgi-php.conf"</pre>
<p>Проверяем работу php:
</p>
<pre># echo "&lt;?php phpinfo() ?&gt;" &gt; /srv/http/phpinfo.php</pre>
<p>Затем откройте в своём браузере адрес <a rel="nofollow" class="external free" href="http://localhost/phpinfo.php">http://localhost/phpinfo.php</a> и вы должны увидеть страницу, содержащую информацию о php.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Если вы хотите, чтобы в html файлах обрабатывался php-код, добавьте в <code>fastcgi-php.conf</code>:
<pre>fastcgi.map-extensions = ( ".html" =&gt; ".php" )</pre>
</div>
<h4><span class="mw-headline" id="php-fpm">php-fpm</span></h4>
<p>В качестве альтернативы php-cgi можно использовать php-fpm. Целесообразность использования php-fpm заключается в отсутствии в последних версиях lighttpd динамической регуляции количества php процессов.
</p>
<p>Устанавливаем php-fpm и запускаем демон:
</p>
<pre># pacman -S php-fpm
# rc.d start php-fpm</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Настройки php-fpm находятся в файле <code>/etc/php/php-fpm.conf</code>. <a rel="nofollow" class="external text" href="http://php-fpm.org/wiki/Configuration_File">Подробнее о настройках php-fpm</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-12-27]</sup>.</div>
<p>В <code>/etc/lighttpd/conf.d/fastcgi-php.conf</code> добавляем:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/fastcgi-php.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_fastcgi" )

index-file.names += ( "index.php" ) 

fastcgi.server = (
   ".php" =&gt; ((
      "socket" =&gt; "/var/run/php-fpm/php-fpm.sock",
      "broken-scriptfilename" =&gt; "enable"
   ))
)</pre>
<p>Аналогично предыдущему описанию включаем этот конфиг в <code>/etc/lighttpd/lighttpd.conf</code> строкой
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/fastcgi-php.conf"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Демон php-fpm необходимо запускать до lighttpd, иначе php-скрипты не будут обрабатываться (будут выдаваться ошибки 500 или 503).</div>
<h2><span class="mw-headline" id="SSI">SSI</span></h2>
<p>SSI (Server Side Includes — включения на стороне сервера) — несложный язык для динамической «сборки» веб-страниц на сервере из отдельных составных частей и выдачи клиенту полученного HTML-документа.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если вы используете одновременно mod_ssi и mod_compress, то mod_ssi должен быть загружен <b>до</b> mod_compress.</div>
<p>Чтобы добавить поддержку SSI в Lighttpd добавляем следующие настройки в <code>/etc/lighttpd/conf.d/ssi.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/ssi.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_ssi" )

ssi.extension              = ( ".html", ".shtml" )
</pre>
<p>Затем
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/ssi.conf"</pre>
<h2><span class="mw-headline" id="SSL">SSL</span></h2>
<p>Создаем директорию для хранения сертификатов:
</p>
<pre># mkdir /etc/lighttpd/certs</pre>
<p>Генерируем самоподписанный сертификат (пример команды):
</p>
<pre># openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout /etc/lighttpd/certs/www.example.com.pem -out /etc/lighttpd/certs/www.example.com.pem</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Подробнее о создании сертификатов смотрите отдельную <a href="../en/OpenSSL.html" title="OpenSSL">статью</a>. </div>
<p>Выставляем владельца и нужные права:
</p>
<pre># chown http:http /etc/lighttpd/certs/www.example.com.pem
# chmod 600 /etc/lighttpd/certs/www.example.com.pem</pre>
<p>Теперь нужно включить SSL в настройках lighttpd (в <code>/etc/lighttpd/lighttpd.conf</code>).
</p>
<p>Чтобы включить SSL для всего HTTP-сервера (вам также нужно указать порт сервера 443):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ssl.engine = "enable" 
ssl.pemfile = "/etc/lighttpd/certs/www.example.com.pemm"</pre>
<p>Чтобы включить SSL в дополнение к HTTP:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":443" {
   ssl.engine = "enable" 
   ssl.pemfile = "/etc/lighttpd/certs/www.example.com.pem" 
}</pre>
<p>Если вы хотите использовать другой сайт при переходе на HTTPS, вам нужно указать другую директорию в качестве document-root используя сокет (в данном случае 443 порт) в качестве условия:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":443" {
   server.document-root = "/srv/ssl" # use your ssl directory here
   ssl.engine                 = "enable"
   ssl.pemfile                = "/etc/lighttpd/certs/www.example.com.pem"  # use the path where you created your pem file
}</pre>
<p>Вы также можете использовать named-based виртуальным хостинг, чтобы реализовать несколько SSL серверов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] == "www.example.org" {
   ssl.pemfile = "/etc/lighttpd/certs/www.example.org.pem" 
}
$HTTP["host"] == "mail.example.org" {
   ssl.pemfile = "/etc/lighttpd/certs/mail.example.org.pem" 
}</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <a href="https://en.wikipedia.org/wiki/Server_Name_Indication" class="extiw" title="wikipedia:Server Name Indication">SNI</a> поддерживается не всеми браузерами. <a href="https://en.wikipedia.org/wiki/Server_Name_Indication#Support" class="extiw" title="wikipedia:Server Name Indication">Подробнее</a>. IP-based виртуальный хостинг лишён этого недостатка.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Некоторые php-скрипты пытаются определить HTTPS, проверяя значение переменной $_SERVER['HTTPS']. Чтобы разрешить это, вам нужно подключить модуль setenv и передать соответствующую опцию. Пример настройки:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = ( ... "mod_setenv", ... )

$SERVER["socket"] == ":443" {
   ssl.engine             = "enable" 
   ssl.pemfile            = "/etc/lighttpd/server.pem" 
   setenv.add-environment = (
     "HTTPS" =&gt; "on" 
   )
}</pre>
</div>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BD.D0.B0.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_HTTP_.D0.BD.D0.B0_HTTPS"></span><span class="mw-headline" id="Перенаправление_HTTP_на_HTTPS">Перенаправление HTTP на HTTPS</span>
</h3>
<p>mod_redirect должен быть включён:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules              = ( ... "mod_redirect", ... )</pre>
<p>Перенаправляем трафик для домена example.org:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":80" {
   $HTTP["host"] =~ "example.org" {
      url.redirect = ( "^/(.*)" =&gt; "https://example.org/$1" )
      server.name                 = "example.org" 
   }
}</pre>
<p>Перенаправляем запросы на HTTPS для части сайта (в примере ниже - <code>/secure</code>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":80" {
   $HTTP["url"] =~ "^/secure|^/phpmyadmin" {
      url.redirect = ( "^/(.*)" =&gt; "https://example.com/$1" )
   }
}</pre>
<p>Перенаправляем весь трафик на HTTPS:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":80" {
   $HTTP["host"] =~ "(.*)" {
      url.redirect = ( "^/(.*)" =&gt; "https://%1/$1" )
   }
}</pre>
<h2>
<span id=".D0.A1.D0.B6.D0.B0.D1.82.D0.B8.D0.B5_.D0.B8.D1.81.D1.85.D0.BE.D0.B4.D1.8F.D1.89.D0.B8.D1.85_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"></span><span class="mw-headline" id="Сжатие_исходящих_данных">Сжатие исходящих данных</span>
</h2>
<p>Сжатие исходящих данных уменьшает нагрузку на сеть и может улучшить общую пропускную способность веб-сервера. 
</p>
<p>На сегодня поддерживается только статичное содержимое.
</p>
<p>Сервер автоматически договаривается какой метод сжатия использовать. Поддерживается gzip, deflate, bzip.
</p>
<p>Ограничение на размер сжимаемых файлов: от 128 байт до 128 мегабайт.
</p>
<p>Создаём нужную директорию и задаём владельца:
</p>
<pre># mkdir /var/cache/lighttpd/compress/
# chown http:http /var/cache/lighttpd/compress/</pre>
<p>В <code>/etc/lighttpd/conf.d/compress.conf</code> вносим:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/compress.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_compress" )

compress.cache-dir          = "/var/cache/lighttpd/compress/"
compress.allowed-encodings  = ("bzip2", "gzip", "deflate") # значение по умолчанию
compress.filetype           = ("text/plain", "text/html", "text/javascript", "text/css", "text/xml")</pre>
<p>Включаем настройки <code>/etc/lighttpd/conf.d/compress.conf</code> в <code>/etc/lighttpd/lighttpd.conf</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/compress.conf"</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Чтобы каталог, в котором Lighttpd хранит сжатые файлы регулярно очищался от старых, неиспользуемых файлов, можно использовать следующий скрипт в качестве задания Cron:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/cron.daily/lighttpd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

find /var/cache/lighttpd/compress -type f -mtime +10 | xargs -r rm
</pre>
<p>В данном примере будут удалены все файлы, которые старше 10 дней.
</p>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Вы также можете использовать условия (имя хоста или url), чтобы задать произвольный каталог для сжатых фавйлов. 
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] == "docs.example.org" {
   compress.cache-dir = "/srv/http/cache/docs.example.org/" 
}</pre>
<p>Не забудьте установить владельцем каталога пользователя http.
</p>
</div>
<h3>
<span id=".D0.A1.D0.B6.D0.B0.D1.82.D0.B8.D0.B5_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.BD.D1.82.D0.B0"></span><span class="mw-headline" id="Сжатие_динамического_контента">Сжатие динамического контента</span>
</h3>
<p>Для сжатия динамического контента (PHP) в <code>/etc/php/php.ini</code> нужно включить следующую директиву:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">zlib.output_compression = On</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Вы также можете задать уровен сжатия с помощью директивы <a rel="nofollow" class="external text" href="http://www.php.net/manual/en/zlib.configuration.php">zlib.output_compression_level</a>.</div>
<h2>
<span id=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.B5.D1.88.D0.B5.D0.BC_.D0.B1.D1.80.D0.B0.D1.83.D0.B7.D0.B5.D1.80.D0.B0_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Управление_кешем_браузера_пользователя">Управление кешем браузера пользователя</span>
</h2>
<p>Для ускорения загрузки статических файлов можно управлять кешем браузера пользователя через заголовки Expires и Cache-Control. Для этого в Lighttpd используется mod_expire.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_expire" )

expire.url = (
   "/images/"  =&gt; "access plus 7 days",
   "/themes/" =&gt; "access plus 7 days",
   "/jquery/" =&gt; "access plus 2 weeks",
)

</pre>
<p>Можно также перечислить отдельные расширения файлов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_expire" )

expire.url = (
   ".css" =&gt; "access plus 7 days",
   ".js" =&gt; "access plus 2 weeks",
   ".png" =&gt; "access plus 7 days",
   ".gif" =&gt; "access plus 7 days",
   ".jpg" =&gt; "access plus 7 days",
)

</pre>
<p>Альтернативу предыдущему листингу:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_expire" )

$HTTP["url"] =~ "\.(jpe?g|gif|png|css|js)$" {
     expire.url = ( "" =&gt; "access 7 days" )
}

</pre>
<h2>
<span id=".D0.92.D0.B8.D1.80.D1.82.D1.83.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D1.85.D0.BE.D1.81.D1.82.D1.8B"></span><span class="mw-headline" id="Виртуальные_хосты">Виртуальные хосты</span>
</h2>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.83.D1.81.D0.BB.D0.BE.D0.B2.D0.B8.D0.B9"></span><span class="mw-headline" id="Использование_условий">Использование условий</span>
</h3>
<p>Первый способ заключается в изменении server.document-root в зависимости от содержимого заголовка "host".
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] == "www.example1.com" {
   server.document-root = "/srv/vhosts/www.example1.com/http"
   accesslog.filename = "/srv/vhosts/www.example1.com/access.log"
   server.error-handler-404 = "/404.php"
}

$HTTP["host"] == "www.example2.com" {
   server.document-root = "/srv/vhosts/www.example2.com/http"
   accesslog.filename = "/srv/vhosts/www.example2.com/access.log"
   server.error-handler-404 = "/404.php"
}</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Не забудьте предварительно создать необходимые каталоги и назначить им соответствующих владельцев (http:http).
<pre># mkdir -p /srv/vhosts/www.exmaple1.com/http
# mkdir -p /srv/vhosts/www.exmaple2.com/http
# chown -R http:http /srv/vhosts/</pre>
</div>
<h3><span class="mw-headline" id="mod_simple_vhost">mod_simple_vhost</span></h3>
<p>Этот способ более прост и экономичен. В указанной директории хостинга имя каждого каталога соответствует аналогичному имени вируального хоста. Внутри каждого такого каталога находится dccroot вируального хоста.
</p>
<p>Docroot для каждого вируального хоста строится из следующих трёх значений:
</p>
<ul>
<li>server-root</li>
<li>hostname</li>
<li>document-root</li>
</ul>
<p>Абсолютный путь к docroot'у строится из:
</p>
<pre>server-root + hostname + document-root
</pre>
<p>в случае если путь не существует
</p>
<pre>server-root + default-host + document-root
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Вы можете использовать символьные ссылки чтобы соотнести несколько имён хостов одной директории.</div>
<p>В качестве примера приведём следующий:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/simple_vhost.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_simple_vhost" )

simple-vhost.server-root = "/srv/vhosts/"
simple-vhost.default-host = "www.example.org"
simple-vhost.document-root = "http"
</pre>
<p>Включаем конфигурацию из <code>/etc/lighttpd/conf.d/simple_vhost.conf</code> в <code>/etc/lighttpd/lighttpd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include /etc/lighttpd/conf.d/simple_vhost.conf</pre>
<p>Для создания виртуального хоста достаточно создать каталог в <code>/srv/vhosts/</code> и сделать владельцем http:http. Например:
</p>
<pre># mkdir -p /srv/vhosts/www.exmaple1.com/http
# chown http:http /srv/vhosts/www.exmaple1.com/http</pre>
<h3><span class="mw-headline" id="mod_evhost">mod_evhost</span></h3>
<p>Модуль evhost создаёт document-root, основываясь на шаблнах. Эти шаблоны представляют различные части запроса "host":
</p>
<ul>
<li>%% =&gt; % sign</li>
<li>%0 =&gt; domain name + tld</li>
<li>%1 =&gt; tld</li>
<li>%2 =&gt; domain name without tld</li>
<li>%3 =&gt; subdomain 1 name</li>
<li>%4 =&gt; subdomain 2 name</li>
<li>%_ =&gt; full domain name</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = ( ... "mod_evhost", ... )
evhost.path-pattern = "/srv/vhosts/%0/http/"</pre>
<p>С помощью этого моудля можно также организовать виртуальные хосты для поддоменов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">evhost.path-pattern = "/srv/vhosts/%0/http/%3/"</pre>
<h2>
<span id=".D0.9B.D0.B8.D1.81.D1.82.D0.B8.D0.BD.D0.B3_.D0.B4.D0.B8.D1.80.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B8.D0.B9"></span><span class="mw-headline" id="Листинг_директорий">Листинг директорий</span>
</h2>
<p>Чтобы включить листинг для всех каталогов в <code>/etc/lighttpd/lighttpd.conf</code> укажите следующую опцию:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dir-listing.activate = "enable"</pre>
<p>Листинг включается для всех каталогов, в корне которых нет файлов перечисленных в директиве <i>index-file.names</i>.
</p>
<p>Чтобы включить листинг для отдельного каталога укажите следующее:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["url"] =~ "^/download($|/)" {
   dir-listing.activate = "enable" 
}</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Для исключения из листинга скрытых файлов используется директива dir-listing.hide-dotfiles = "enable". Список исключений, основанный на регулярных выражениях, задаётся директивой dir-listing.exclude</div>
<h2>
<span id=".D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0"></span><span class="mw-headline" id="Ограничение_доступа">Ограничение доступа</span>
</h2>
<p>Для использования ограничения доступа необходим включить mod_access:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = ( ... "mod_access", ... )</pre>
<p>Ограничиваем доступ к файлам, заканчивающимся на "~" и ".inc":
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">url.access-deny = ( "~", ".inc")</pre>
<p>Запрет доступа к сайту для определённого IP:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["remoteip"] == "202.54.1.1" {
   url.access-deny = ( "" )
}</pre>
<p>Ограничение доступа к каталогу <code>/libraries</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["url"] =~ "^/libraries/" {
   url.access-deny = ("")
}</pre>
<p>Запрет доступа к каталогу <code>/stats</code> всех кроме IP адресов 200.19.1.5 и 210.45.2.7:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["remoteip"] !~ "200\.19\.1\.5|210\.45\.2\.7" {
   $HTTP["url"] =~ "^/stats/" {
      url.access-deny = ( "" )
   }
}</pre>
<p>Запрет доступа к файлам jpg, jpeg, png если запрос приходит не с www.example.com (защита от прямых ссылок):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd,conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["referer"] !~ "^($|http://www\.example\.org)" {
   url.access-deny = ( ".jpg", ".jpeg", ".png" )
}</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> При совместном использовании директив url.access-deny и server.error-handler-404 при запросе запрещённого контента запросы будут направляться согласно директиве server.error-handler-404 (<a rel="nofollow" class="external text" href="https://redmine.lighttpd.net/issues/1727">Подробнее</a>).Чтобы этого избежать необходимо добавить server.error-handler-404 = "forbidden" внутрь условия, содержащего url.access-deny. Пример:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] =~ "mysite\.com" {
   server.document-root = "/srv/http/mysite.com"
   server.error-handler-404 = "/index.php"
   $HTTP["url"] == "/cache/" {
      url.access-deny = ( "" )
      server.error-handler-404 = "forbidden"
   }
   $HTTP["url"] =~ "^/wiki/(.*/)?\.ht" {
      url.access-deny = ( "" )
      server.error-handler-404 = "forbidden"
   }
}</pre>
</div>
<h2>
<span id=".D0.90.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D1.8F"></span><span class="mw-headline" id="Аутентификация">Аутентификация</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если mod_fastcgi и mod_auth используются вместе, то mod_auth должен быть загружен <b>до</b> mod_fastcgi.</div>
<h3>
<span id=".D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B"></span><span class="mw-headline" id="Методы">Методы</span>
</h3>
<p>lighttpd поддерживает два метода аутентификации: 
</p>
<ul>
<li>
<b>Basic</b> метод передаёт имя пользователя и пароль по сети в открытом виде(закодированными в base64), что способствует возникновению проблемы безопастности в случае если соединение между клиентом и сервером не шифруется.</li>
<li>
<b>Digest</b> метод передаёт только хешированную информацию, что значительно повышает конфидециальность аутентификационных данных в незащищённых сетях.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Реализация digest метода в настоящий момент не полностью соответствует стандарту, позволяя осуществить replay attack.</div>
<h3><span class="mw-headline" id="Backends">Backends</span></h3>
<p>В зависимости от метода lighttpd позволяет использовать различные методы хранения данных необходимых для аутентификации. 
Для basic аутентификации:
</p>
<ul>
<li>plain</li>
<li>htpasswd (crypt only)</li>
<li>htdigest</li>
<li>ldap</li>
</ul>
<p>Для digest аутентификации:
</p>
<ul>
<li>plain</li>
<li>htdigest</li>
</ul>
<h4><span class="mw-headline" id="plain">plain</span></h4>
<p>Файл содержит строки с именами пользователей и паролями в открытом виде. Имя пользователя и пароль разделяются двоеточием. Например:
</p>
<pre>agent007:secret
</pre>
<h4><span class="mw-headline" id="htpasswd">htpasswd</span></h4>
<p>Файл содержит строки с именами пользователей и зашифрованными с помощью crypt() паролями. Имя пользователя и пароль разделяются двоеточием.Например:
</p>
<pre>agent007:XWY5JwrAVBXsQ
</pre>
<h4><span class="mw-headline" id="htdigest">htdigest</span></h4>
<p>Файл содержит строки с именами пользователей, realm'ом и зашифрованными с помощью md5() паролями. Имя пользователя, realm и пароль разделяются двоеточием. Например:
</p>
<pre>agent007:download area:8364d0044ef57b3defcfa141e8f77b65
</pre>
<h4><span class="mw-headline" id="ldap">ldap</span></h4>
<p>ldap backend обычно выполняет следующие действия для аутентификации пользователя
</p>
<ul>
<li>анонимное соединение (при загрузке plugin'а)</li>
<li>получение DN для фильтрации = username</li>
<li>аутентификация на ldap сервере</li>
<li>рассоединение</li>
</ul>
<p>если четвёртый шаг проходит без ошибок, то пользователь считается авторизированным
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Для создания файлов htpasswd и htdigest Вы можете воспользоваться утилитами, идущими в составе пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span> или установить <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/apache-tools/">apache-tools</a></span><sup><small>AUR</small></sup> из <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>. 
<p>Чтобы сгенерировать файл htpasswd введите команду:
</p>
<pre>$ htpasswd lighttpd.user.htpasswd username</pre>
<p>Чтобы сгенерировать файл htdigest введите команду:
</p>
<pre>$ htdigest lighttpd.user.htdigest 'download area' username</pre>
</div>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Пример_конфигурации">Пример конфигурации</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/auth.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules += ( "mod_auth" )
## отладка
# 0 для выключения, 1 для 'auth-ok' сообщений, 2 для подробных сообщений
auth.debug                 = 0

## тип backend'а
# plain, htpasswd, ldap или htdigest
auth.backend               = "htpasswd" 

# имя файла в котором хранится информация необходимая для plain аутентификации
auth.backend.plain.userfile = "lighttpd-plain.user" 

## для htpasswd
auth.backend.htpasswd.userfile = "/full/path/to/lighttpd-htpasswd.user" 

## для htdigest
auth.backend.htdigest.userfile = "lighttpd-htdigest.user" 

## ограничения
# установка ограничений:
#
# ( &lt;left-part-of-the-url&gt; =&gt;
#   ( "method" =&gt; "digest"/"basic",
#     "realm" =&gt; &lt;realm&gt;,
#     "require" =&gt; "user=&lt;username&gt;" )
# )
#
# &lt;realm&gt; это значение которое будет показано в диалоговом окне
#     и также будет использоваться для digest-алгоритма и
#     должно совпадать с realm'ом в htdigest файле (если используется)
#

auth.require = ( "/download/" =&gt;
                 (
                 # метод должен быть или basic или digest
                   "method"  =&gt; "digest",
                   "realm"   =&gt; "download archiv",
                   "require" =&gt; "user=agent007|user=agent008" 
                 ),
                 "/server-info" =&gt;
                 (
                 # Ограничение доступа к информации о сервере
                   "method"  =&gt; "digest",
                   "realm"   =&gt; "download archiv",
                   "require" =&gt; "valid-user" 
                 )
                 "/protected-folder/" =&gt;
                 (
                   "method"  =&gt; "digest",
                   "realm"   =&gt; "download archiv",
                   "require" =&gt; "valid-user" 
                 )
               )

# Использование регулярного выражения (как альтернатива):
$HTTP["url"] =~ "/server-info|/protected-folder/" {
  auth.require = ( "" =&gt;
                   (
                     "method"  =&gt; "digest",
                     "realm"   =&gt; "download archiv",
                     "require" =&gt; "valid-user" 
                   )
                 )
}
</pre>
<h2>
<span id=".D0.9A.D0.BE.D0.B4.D0.B8.D1.80.D0.BE.D0.B2.D0.BA.D0.B0_.D0.BF.D0.BE_.D1.83.D0.BC.D0.BE.D0.BB.D1.87.D0.B0.D0.BD.D0.B8.D1.8E"></span><span class="mw-headline" id="Кодировка_по_умолчанию">Кодировка по умолчанию</span>
</h2>
<p>Чтобы установить кодировку для статических файлов, нужно добавить charset=utf-8 в директиве mimetype.assign. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mime.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mimetype.assign             = (
  ".css"          =&gt;      "text/css; charset=utf-8",
  ".html"         =&gt;      "text/html; charset=utf-8",
  ".htm"          =&gt;      "text/html; charset=utf-8",
  ".js"           =&gt;      "text/javascript; charset=utf-8",
  ".log"          =&gt;      "text/plain; charset=utf-8",
  ".conf"         =&gt;      "text/plain; charset=utf-8",
  ".text"         =&gt;      "text/plain; charset=utf-8",
  ".txt"          =&gt;      "text/plain; charset=utf-8",
  ".xml"          =&gt;      "text/xml; charset=utf-8",
  ""              =&gt;      "application/octet-stream",
)</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Для файлов, указанных в директиве ssi.extension, добавление charset=utf-8 в mimetype.assign не работает. Единственный способ указать кодировку, это добавить в секцию &lt;head&gt; shtml файла строку:
<pre>&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;</pre>
</div>
<p>Кодировка для листинга каталогов устанавливается директивой:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dir-listing.encoding = "utf-8"</pre>
<p>Кодировка для php файлов устанавливается в файле <code>/etc/php/php.ini</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default_charset = "utf-8"</pre>
<h2>
<span id=".D0.9F.D1.80.D0.BE.D0.BA.D1.81.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Проксирование">Проксирование</span>
</h2>
<h3>
<span id="Lighttpd_.D0.BA.D0.B0.D0.BA_reverse_proxy_.D0.B4.D0.BB.D1.8F_.D0.BE.D1.82.D0.B4.D0.B0.D1.87.D0.B8_.D1.81.D1.82.D0.B0.D1.82.D0.B8.D0.BA.D0.B8"></span><span class="mw-headline" id="Lighttpd_как_reverse_proxy_для_отдачи_статики">Lighttpd как reverse proxy для отдачи статики</span>
</h3>
<p>Пример конфигурации при использовании виртуальных хостов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = (
   ... "mod_proxy", ...
}

$HTTP["host"] =~ "example\.com" {
   setenv.add-request-header ( "Host" =&gt; "example.org" ) # добавляем HTTP заголовок
   $HTTP["url"] !~ "\.(js|css|gif|jpg|png|ico|txt|swf|html|htm)$" {
      proxy.server = ( "" =&gt; (( "host" =&gt; "127.0.0.1", "port" =&gt; 8080 )
   ))
   }
}</pre>
<p>Можно также перенапрвлять только скрипты с определённым расширением:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = (
   ... "mod_proxy", ...
}

$HTTP["host"] =~ "example\.com" {
   setenv.add-request-header ( "Host" =&gt; "example.org" ) # добавляем HTTP заголовок
   proxy.server = ( ".php" =&gt; (( "host" =&gt; "127.0.0.1", "port" =&gt; 8080 )),
                    ".cgi" =&gt; (( "host" =&gt; "127.0.0.1", "port" =&gt; 8080 )),
                    ".pl" =&gt; (( "host" =&gt; "127.0.0.1", "port" =&gt; 8080 ))
   )
}</pre>
<p>В качестве альтернативы можно использовать условие $HTTP["url"]:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = (
   ... "mod_proxy", ...
}

$HTTP["host"] =~ "example\.com" {
   setenv.add-request-header ( "Host" =&gt; "example.org" ) # добавляем HTTP заголовок
   $HTTP['url'] =~ "(.cgi|.pl|.php)$" {
      proxy.server = ( "" =&gt; ( host = "127.0.0.1", port = "8080" ))
   }
}</pre>
<h3>
<span id=".D0.A0.D0.B0.D1.81.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_Lighttpd"></span><span class="mw-headline" id="Распределние_нагрузки_с_помощью_Lighttpd">Распределние нагрузки с помощью Lighttpd</span>
</h3>
<p>Для распределения нагрузки можно использовать следующие настройки: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.modules = (
   ... "mod_proxy", ...
}
$SERVER["socket"] == ":80" {
   proxy.balance = "hash" 
   proxy.server  = ( "" =&gt; ( ( "host" =&gt; "10.0.0.10", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.11", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.12", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.13", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.14", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.15", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.16", "port" =&gt; "80" ),
                             ( "host" =&gt; "10.0.0.17", "port" =&gt; "80" )
   ))
}</pre>
<p>Доступны следующие типы балансинга:
</p>
<ul>
<li>
<b>fair</b> - запрос обрабатывается менее нагруженным сервером</li>
<li>
<b>round-robin</b> - запросы обрабатывают сервера по очереди</li>
<li>
<b>hash</b> - гарантировано один и тот же uri будет обрабатываться конкретным сервером</li>
</ul>
<h2>
<span id=".D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.B4.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D0.BE.D1.81.D1.82.D1.8C"></span><span class="mw-headline" id="Производительность">Производительность</span>
</h2>
<h3><span class="mw-headline" id="HTTP_Keep-Alive">HTTP Keep-Alive</span></h3>
<p>Отключение Keep-Alive может помочь вашему серверу, если вы страдаете от большого количества дескрипторов файлов. Значения по умолчанию:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.max-keep-alive-requests = 16
server.max-keep-alive-idle = 5
server.max-read-idle = 60
server.max-write-idle = 360</pre>
<p>Обработка 16 запросов на одно соединение, ожидание 5 секунд прежде, чем Lighttpd закроет соединение.
</p>
<p>Если сервер обрабатывает несколько соединений сразу под высокой нагрузкой (предположим, 500 соединений
одновременно в течение 24 часов), вы можете столкнуться с проблемой нехватки дескрипторов файлов
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.max-keep-alive-requests = 4
server.max-keep-alive-idle = 4</pre>
<p>Это позволит высвободить соединения ранее, и освободит дескриптор файлов без вредные потери производительности.
</p>
<p>Отключение Keep-Alive полностью является крайним случаем, если вы все еще хватает файловых дескрипторов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.max-keep-alive-requests = 0</pre>
<h3>
<span id=".D0.9E.D0.B1.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.87.D0.B8.D0.BA_.D1.81.D0.BE.D0.B1.D1.8B.D1.82.D0.B8.D0.B9"></span><span class="mw-headline" id="Обработчик_событий">Обработчик событий</span>
</h3>
<p>Для Linux с ядром 2.6 и выше рекомендуется следующее значение:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.event-handler = linux-sysepoll</pre>
<p>Значение по умолчанию: poll (для Unix систем).
</p>
<h3>
<span id=".D0.9E.D0.B1.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.87.D0.B8.D0.BA_.D1.81.D0.B5.D1.82.D0.B5.D0.B2.D1.8B.D1.85_.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D0.B9"></span><span class="mw-headline" id="Обработчик_сетевых_соединений">Обработчик сетевых соединений</span>
</h3>
<p>Основный интерфейс для всех платформ - это системные вызовы read() и write(). Современные операционные системы имеют свои собственные системные вызовы, помогающие серверам передавать файлы так быстро, как это возможно. Чтобы установить обработчик сетевых сеодиненй используется директива server.network-backend:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.network-backend = linux-sendfile</pre>
<ul>
<li>linux-sendfile рекомендуется для маленьких файлов.</li>
<li>writev рекомендуется для очень больших файлов.</li>
</ul>
<h3>
<span id=".D0.9C.D0.B0.D0.BA.D1.81.D0.B8.D0.BC.D0.B0.D0.BB.D1.8C.D0.BD.D0.BE.D0.B5_.D0.BA.D0.BE.D0.BB.D0.B8.D1.87.D0.B5.D1.81.D1.82.D0.B2.D0.BE_.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D0.B9"></span><span class="mw-headline" id="Максимальное_количество_соединений">Максимальное количество соединений</span>
</h3>
<p>Lighttpd - сервер, работающий в один поток. Его основной ресурс ограничивается количеством дескрипторов файлов, которые устанавливается 1024 по умолчанию в большинстве систем. Дескриптор файла — это просто число, которое представляет открытый файл или сокет. Каждый раз, когда процесс открывает новый файл или сокет, он определяет место для нового дескриптора файла. После закрытия файла или сокета эти дескрипторы используются повторно. Большая часть систем Unix накладывает ограничение на число одновременно открытых дескрипторов файлов. Эти ограничения касаются как одного процесса, так и всей системы.
</p>
<p>Узнать ограничение дескрипторов файлов в вашей системе можно с помощью команды:
</p>
<pre># ulimit -n</pre>
<p>Если у вас сайт с большим трафиком, вы можете увеличить это ограничение:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.max-fds = 2048</pre>
<h2>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D1.8B_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BA_.D0.B4.D0.BB.D1.8F_.D1.80.D0.B0.D0.B7.D0.BB.D0.B8.D1.87.D0.BD.D1.8B.D1.85_CMS"></span><span class="mw-headline" id="Примеры_настроек_для_различных_CMS">Примеры настроек для различных CMS</span>
</h2>
<h3><span class="mw-headline" id="phpMyAdmin">phpMyAdmin</span></h3>
<p>Устанавливаем необходимые пакеты:
</p>
<pre># pacman -S lighttpd mysql php-cgi php-mcrypt phpmyadmin</pre>
<p>Настройка поддержки php описана <a href="#PHP">выше</a>.
</p>
<p>Раскоментируем следующие директивы в <code>/etc/php/php.ini</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension=mcrypt.so
extension=mysql.so</pre>
<p>Также убедитесь, что директории phpmyadmin указаны в директиве open_basedir в <code>/etc/php/php.ini</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/:/etc/webapps/</pre>
<p>Затем конфигурируем Lighttpd:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/phpmyadmin.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Подкючаем необходимые модули, если этого не было сделано раньше
server.modules += ( "mod_alias", "mod_access", "mod_redirect", "mod_rewrite" )

alias.url = ( "/phpmyadmin" =&gt; "/usr/share/webapps/phpMyAdmin/")
url.rewrite = ( "^/phpMyAdmin(/.*)?$" =&gt; "/phpmyadmin$1" )</pre>
<p>Если вы хотите, чтобы phpMyAdmin был доступен только по защищённому протоколу добавьте следюущие настройки:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/phpmyadmin.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$SERVER["socket"] == ":80" {
   $HTTP["url"] =~ "^/phpmyadmin" {
      url.redirect = ( "^/(.*)" =&gt; "https://example.com/$1" )
   }
}</pre>
<p>Вы также можете ограничить доступ к phpMyAdmin для определённых IP адресов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/phpmyadmin.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["remoteip"] != "127.0.0.1" {
   $HTTP["url"] =~ "^/phpmyadmin" {
      url.access-deny = ( "" )
   }
}</pre>
<p>Подключаем <code>/etc/lighttpd/conf.d/phpmyadmin.conf</code> к основному файлу настроек:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/phpmyadmin.conf"</pre>
<p>Запускаем сервер:
</p>
<pre># rc.d start lighttpd</pre>
<p>Теперь вы можете получить доступ к phpMyAdmin по адресу <a rel="nofollow" class="external free" href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a> или <a rel="nofollow" class="external free" href="http://localhost/phpMyAdmin">http://localhost/phpMyAdmin</a>
</p>
<h3><span class="mw-headline" id="Mediawiki">Mediawiki</span></h3>
<p>Устанавливаем необходимые пакеты:
</p>
<pre># pacman -S lighttpd mysql php-cgi imagemagick ghostscript mediawiki</pre>
<p>Настройка поддержки php описана <a href="#PHP">выше</a>.
УБедитесь, что необходимые директории перечислены в директиве open_basedir в <code>/etc/php/php.ini</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/:/etc/webapps/:/var/cache/mediawiki:/var/lib/mediawiki/</pre>
<p>Задаём пароль для учётной записи root MySQL:
</p>
<pre>#mysqladmin -u root password пароль</pre>
<p>Создаём базу данных для wiki:
</p>
<pre># mysql -uroot -p${rootpasswd} --execute="create database wiki;"</pre>
<p>Создаём пользователя для новой базы:
</p>
<pre># mysql -uroot -p${rootpasswd} --execute="GRANT ALL PRIVILEGES ON wiki.* TO ${wiki_user}@localhost IDENTIFIED by '${userpasswd}'  WITH GRANT OPTION;"</pre>
<ul>
<li>${rootpasswd} - пароль root MySQL.</li>
<li>${wiki_user} - имя пользователя базы данных wiki.</li>
<li>${userpasswd} - пароль пользователя базы данныз wiki.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Тоже самое Вы можете проделать через web-интерфейс <a href="#phpMyAdmin">phpMyAdmin</a>.</div>
<p>Настраиваем Lighttpd (согласно нижеприведённые настройки wiki будет доступна по адресу <a rel="nofollow" class="external free" href="http://mysite/wiki">http://mysite/wiki</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mediawiki.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Подкючаем необходимые модули, если этого не было сделано раньше
server.modules += ( "mod_alias", "mod_access", "mod_redirect", "mod_rewrite" )
# Создаём alias
alias.url += ( "/wiki" =&gt; "/usr/share/webapps/mediawiki")
# Перенаправляем запросы на несуществующие файлы на index.php
$HTTP["url"] =~ "/wiki" {
   server.error-handler-404 = "/wiki/index.php"
}
# Запрещаем доступ к .htaccess файлам
$HTTP["url"] =~ "/\.ht" {
   url.access-deny = ( "" )
   server.error-handler-404 = "403"
}
# Запрещаем доступ к папкам (согласно расположению .htaccess)
$HTTP["url"] =~ "^/wiki/(cache|includes|maintenance|math|languages|serialized|images/deleted)/" {
   url.access-deny = ( "" )
   server.error-handler-404 = "403"
}
# Запрещаем выполнение html или php кода в каталоге images (http://www.mediawiki.org/wiki/Manual:Security#Upload_security)
$HTTP["url"] =~ "^/wiki/images/" {
   mimetype.assign = (
      ".html" =&gt; "text/plain",
      ".htm" =&gt; "text/plain",
      ".shtml" =&gt; "text/plain",
      ".phtml" =&gt; "text/plain",
      ".php5" =&gt; "text/plain",
      ".php" =&gt; "text/plain",
      "" =&gt; ""
   )
}
# Определяем mime-тип для файлов без расширения
$HTTP["url"] =~ "^/wiki/(.*/)?(README|FAQ|COPYING|CREDITS|HYSTORY|INSTALL|OBSOLETE|RELEASE-NOTES(.*)|TODO|UPGRADE)$" {
   mimetype.assign	= ( "" =&gt; "text/plain" )
}
# Определяем mime-тип для файлов в каталоге docs
$HTTP["url"] =~ "^/wiki/docs/" {
   mimetype.assign	= ( "" =&gt; "text/plain" )
}</pre>
<p>Подключаем <code>/etc/lighttpd/conf.d/mediawiki.conf</code> к основному файлу настроек:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include "conf.d/mediawiki.conf"</pre>
<p>Запускаем сервер:
</p>
<pre># rc.d start lighttpd</pre>
<p>Теперь вы можете перейти по адресу <a rel="nofollow" class="external free" href="http://localhost/wiki">http://localhost/wiki</a> для утсановки.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Для получения коротких URL в <code>/usr/share/webapps/mediawiki/LocalSettings.php</code> нужно добавить:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/webapps/mediawiki/LocalSettings.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$wgArticlePath = "/wiki/$1";
$wgUsePathInfo = true;</pre>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Вместо директивы server.error-handler-404 = /wiki/index.php можно использовать следующие правила перезаписи:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mediawiki.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">url.rewrite-if-not-file = (
   "^/wiki/(mw-)?config(/.*)?$" =&gt; "$0",
   "^/wiki/([^?]*)(?:\?(.*))?" =&gt; "/wiki/index.php?title=$1&amp;$2",
   "^/wiki/([^?]*)" =&gt; "/wiki/index.php?title=$1"
)
</pre>
</div>
<p>Если хотите использовать поддомен для wiki или Mediawiki будет единствуенной CMS на вашем сайте, то настройки Lighttpd будут выглядеть следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mediawiki.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Подкючаем необходимые модули, если этого не было сделано раньше
server.modules += ( "mod_alias", "mod_access", "mod_redirect", "mod_rewrite" )

# Перенаправляем запросы на несуществующие файлы на index.php
$HTTP["host"] =~ "mysite\.com" { # для поддомена "wiki\.mysite\.com"
   server.document-root = "/usr/share/webapps/mediawiki"
   server.error-handler-404 = "/index.php")
# Запрещаем доступ к .htaccess файлам
   $HTTP["url"] =~ "/\.ht" {
# Предотвращаем перенапрвление запросов на запрещённый контент на /index.php (баг Lighttpd)
      url.access-deny = ( "" )
      server.error-handler-404 = "403"
   }
# Запрещаем доступ к папкам (согласно расположению .htaccess)
   $HTTP["url"] =~ "^/(cache|includes|maintenance|math|languages|serialized|images/deleted)/" {
# Предотвращаем перенапрвление запросов на запрещённый контент на /index.php (баг Lighttpd)
      url.access-deny = ( "" )
      server.error-handler-404 = "403"
   }
# Запрещаем выполнение html или php кода в каталоге images (http://www.mediawiki.org/wiki/Manual:Security#Upload_security)
   $HTTP["url"] =~ "^/images/" {
      mimetype.assign = (
         ".html" =&gt; "text/plain",
         ".htm" =&gt; "text/plain",
         ".shtml" =&gt; "text/plain",
         ".phtml" =&gt; "text/plain",
         ".php5" =&gt; "text/plain",
         ".php" =&gt; "text/plain",
         "" =&gt; ""
      )
   }
# Определяем mime-тип для файлов без расширения
   $HTTP["url"] =~ "^/(.*/)?(README|FAQ|COPYING|CREDITS|HYSTORY|INSTALL|OBSOLETE|RELEASE-NOTES(.*)|TODO|UPGRADE)$" {
      mimetype.assign	= ( "" =&gt; "text/plain" )
   }
# Определяем mime-тип для файлов в каталоге docs
   $HTTP["url"] =~ "^/docs/" {
      mimetype.assign	= ( "" =&gt; "text/plain" )
   }
}</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Для получения коротких URL в <code>/usr/share/webapps/mediawiki/LocalSettings.php</code> нужно добавить:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/webapps/mediawiki/LocalSettings.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$wgArticlePath = "/$1";
$wgUsePathInfo = true;</pre>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Вместо директивы server.error-handler-404 = /index.php можно использовать следующие правила перезаписи:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mediawiki.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">url.rewrite-if-not-file = (
   "^/(mw-)?config(/.*)?$" =&gt; "$0",
   "^/([^?]*)(?:\?(.*))?" =&gt; "/index.php?title=$1&amp;$2",
   "^/([^?]*)" =&gt; "/index.php?title=$1"
)
</pre>
</div>
<h4><span class="mw-headline" id="texvc">texvc</span></h4>
<p>Устанавлиаем необходимые пакеты:
</p>
<pre># pacman -S texvc</pre>
<p>Затем в файле <code>/usr/share/webapps/mediawiki/LocalSettings.php</code> добавляем:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/share/webapps/mediawiki/LocalSettings.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$wgUseTeX           = true;
$wgMaxShellMemory = 8000000;
$wgMaxShellFileSize = 1000000;
$wgMaxShellTime = 300;</pre>
<h4><span class="mw-headline" id="HTTPS_login">HTTPS login</span></h4>
<p>Если MediaWiki Установлена в папку wiki, то конфиг будет выглядеть следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/conf.d/mediawiki.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["scheme"] == "http" {
   $HTTP["url"] =~ "^/wiki/(.*)UserLogin" {
      url.redirect = ( "^/(.*)" =&gt; "https://unikum.dyndns.org/$1" )
   }
   $HTTP["url"] =~ "^/wiki/" {
      $HTTP["querystring"] =~ "UserLogin" {
         url.redirect = ( "^/(.*)" =&gt; "https://unikum.dyndns.org/$1" )
      }
   }
}</pre>
<h3><span class="mw-headline" id="Drupal">Drupal</span></h3>
<p>Устанавливаем Drupal:
</p>
<pre># pacman -S drupal</pre>
<p>УБедитесь, что необходимые директории перечислены в директиве open_basedir в <code>/etc/php/php.ini</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/usr/share/webapps/:/var/lib/drupal/</pre>
<p>Настраиваем Lighttpd:
</p>
<h4>
<span id=".D0.92.D0.B0.D1.80.D0.B8.D0.B0.D0.BD.D1.82_1:_server.error-handler-404"></span><span class="mw-headline" id="Вариант_1:_server.error-handler-404">Вариант 1: server.error-handler-404</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] =~ "mysite\.com$" { # "drupal\.mysite\.com" для поддомена
   server.document-root = "/usr/share/webapps/drupal"
   server.error-handler-404 = "/index.php"
# Запрет доступа (согласно .htaccess)
   url.access-deny = ( ".engine", ".inc", "info", ".install", ".make", ".module", ".profile", ".test", ".po", ".sh", "sql", ".theme", ".tpl.php", ".xtmpl", "Entries", "Repository", "Root", "Tag", "Template" )
}</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  При возникновении проблем с доступом при изменении настроек попробуйте отключить "Чистые ссылки" (Главная » Администрирование » Конфигурация » Адреса и поиск).
</div>
<h4>
<span id=".D0.92.D0.B0.D1.80.D0.B8.D0.B0.D0.BD.D1.82_2:_mod_rewrite"></span><span class="mw-headline" id="Вариант_2:_mod_rewrite">Вариант 2: mod_rewrite</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$HTTP["host"] =~ "mysite\.com$" { # "drupal\.mysite\.com" для поддомена
   server.document-root = "/usr/share/webapps/drupal"
   url.rewrite-if-not-file += (
      "^/rss.xml" =&gt; "/index.php?q=rss.xml",
      "^/system/test/(.*)$" =&gt; "/index.php?q=system/test/$1",
      "^/([^.?]*)\?(.*)$" =&gt; "/index.php?q=$1&amp;$2",
      "^/search/(.*)$" =&gt; "/index.php?q=search/$1",
      "^/([^.?]*)$" =&gt; "/index.php?q=$1",
      "^/([^.?]*\.html)$" =&gt; "/index.php?q=$1",
      "^/([^.?]*\.htm)$" =&gt; "/index.php?q=$1",
   )

   url.access-deny = ( ".engine", ".inc", "info", ".install", ".make", ".module", ".profile", ".test", ".po", ".sh", "sql", ".theme", ".tpl.php", ".xtmpl", "Entries", "Repository", "Root", "Tag", "Template" )
}
</pre>
<h3><span class="mw-headline" id="MODX">MODX</span></h3>
<p>Для того, чтобы в MODX заработали "Дружественные URL" в конфиг Lighttpd внесите следующие строки: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">url.rewrite-if-not-file += (
   "^/$" =&gt; "index.php",
   "^/(assets|manager|core|connectors)" =&gt; "$0",
   "^/(?!index(?:-ajax)?\.php)(.*)\?(.*)$" =&gt; "/index.php?q=$1&amp;$2",
   "^/(?!index(?:-ajax)?\.php)(.*)$" =&gt; "/index.php?q=$1"
)

$HTTP["url"] =~ "^/core/" {
   url.access-deny = ( "" )
}
</pre>
<p>Также стоит запреттить доступ для всех в папку core.
</p>
<h2>
<span id=".D0.A1.D0.BC._.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="См._также">См. также</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://redmine.lighttpd.net/projects/lighttpd/wiki">Lighttpd wiki</a> (англ.)</li>
<li>
<a rel="nofollow" class="external text" href="http://silinio.webhost.ru/lighttpd/index.html">Документация по web-серверу Lighttpd (version 1.3.16)</a> (рус.)</li>
<li>
<a rel="nofollow" class="external text" href="http://netsago.org/ru/docs/2/6/">Перевод статьи «The lighttpd Web Server»</a> (рус.)</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Web_server.html" title="Category:Web server (Русский)">Web server (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../ru/Category:Pages_or_sections_flagged_with_Template:Translateme.html" title="Category:Pages or sections flagged with Template:Translateme (Русский)">Pages or sections flagged with Template:Translateme (Русский)</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Lighttpd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=661717">https://wiki.archlinux.org/index.php?title=Lighttpd_(Русский)&amp;oldid=661717</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 April 2021, at 11:58.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
