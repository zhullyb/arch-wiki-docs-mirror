<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd (Русский)/User (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Русский_User_Русский rootpage-Systemd_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">systemd (Русский)/User (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../ru/Systemd.html" title="Systemd (Русский)">Systemd (Русский)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Systemd.html" title="Systemd (Русский)">systemd (Русский)</a></li>
<li><a href="../en/Getty.html#Automatic_login_to_virtual_console" class="mw-redirect" title="Автоматический вход в виртуальную консоль">Автоматический вход в виртуальную консоль</a></li>
<li><a href="../ru/Xinit.html#%D0%90%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_X_%D0%BF%D1%80%D0%B8_%D0%B2%D1%85%D0%BE%D0%B4%D0%B5_%D0%B2_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%83" class="mw-redirect" title="Xinitrc (Русский)">xinitrc (Русский)#Автозапуск X при входе в систему</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Systemd/User.html" title="Systemd/User">systemd/User</a>. Дата последней синхронизации: 2 октября 2020. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Systemd/User&amp;diff=0&amp;oldid=636508">изменения</a>.</div>
<p><a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a> предоставляет пользователям возможность управления и контроля службами с отдельными процессами systemd для каждого пользователя, что позволяет ему запускать, останавливать, включать и отключать свои собственные службы. Это удобно применять для демонов и других служб, которые обычно выполняются для одного пользователя, например, <a href="../en/Music_Player_Daemon.html" title="Music Player Daemon">mpd</a> или для выполнения автоматизированных задач, таких как выборка почты. С некоторыми предостережениями можно даже запустить Xorg и весь оконный менеджер с помощью пользовательских служб.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%9A%D0%B0%D0%BA_%D1%8D%D1%82%D0%BE_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82"><span class="tocnumber">1</span> <span class="toctext">Как это работает</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8"><span class="tocnumber">2</span> <span class="toctext">Основные настройки</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F"><span class="tocnumber">2.1</span> <span class="toctext">Переменные окружения</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D1%8B"><span class="tocnumber">2.1.1</span> <span class="toctext">Пример службы</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#DISPLAY_%D0%B8_XAUTHORITY"><span class="tocnumber">2.1.2</span> <span class="toctext">DISPLAY и XAUTHORITY</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#PATH"><span class="tocnumber">2.1.3</span> <span class="toctext">PATH</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#pam_environment"><span class="tocnumber">2.1.4</span> <span class="toctext">pam_environment</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-8"><a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">2.2</span> <span class="toctext">Автоматический запуск systemd от имени пользователя</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D1%85_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2"><span class="tocnumber">3</span> <span class="toctext">Написание пользовательских юнитов</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80"><span class="tocnumber">3.1</span> <span class="toctext">Пример</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81_%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%BC%D0%B8"><span class="tocnumber">3.2</span> <span class="toctext">Пример с переменными</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BE_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F%D1%85_X"><span class="tocnumber">3.3</span> <span class="toctext">Примечание о приложениях X</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%D0%A7%D1%82%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B6%D1%83%D1%80%D0%BD%D0%B0%D0%BB%D0%B0"><span class="tocnumber">3.4</span> <span class="toctext">Чтение журнала</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#%D0%92%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B"><span class="tocnumber">4</span> <span class="toctext">Временные файлы</span></a></li>
<li class="toclevel-1 tocsection-15">
<a href="#Xorg_%D0%B8_systemd"><span class="tocnumber">5</span> <span class="toctext">Xorg и systemd</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BB%D0%BE%D0%B3%D0%B8%D0%BD_%D0%B2_Xorg_%D0%B1%D0%B5%D0%B7_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%D0%B0"><span class="tocnumber">5.1</span> <span class="toctext">Автоматический логин в Xorg без экранного менеджера</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Xorg_%D0%BA%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D0%B0_systemd"><span class="tocnumber">5.2</span> <span class="toctext">Xorg как пользовательская служба systemd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18">
<a href="#%D0%9D%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5_%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F"><span class="tocnumber">6</span> <span class="toctext">Некоторые случаи использования</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#%D0%9F%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%BD%D1%8B%D0%B9_%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BF%D0%BB%D0%B5%D0%BA%D1%81%D0%BE%D1%80"><span class="tocnumber">6.1</span> <span class="toctext">Постоянный терминальный мультиплексор</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#%D0%9E%D0%BA%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80"><span class="tocnumber">6.2</span> <span class="toctext">Оконный менеджер</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#%D0%97%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%B2_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F_%D0%BF%D1%80%D0%B8_%D0%B2%D1%8B%D1%85%D0%BE%D0%B4%D0%B5_%D0%B8%D0%B7_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B"><span class="tocnumber">7</span> <span class="toctext">Завершение процессов пользователя при выходе из системы</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">8</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.9A.D0.B0.D0.BA_.D1.8D.D1.82.D0.BE_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82"></span><span class="mw-headline" id="Как_это_работает">Как это работает</span>
</h2>
<p>В соответствии с конфигурацией по умолчанию в <code>/etc/pam.d/system-login</code>, модуль <code>pam_systemd</code> автоматически запускает <code>systemd --user</code> в случае, когда пользователь в первый раз входит в систему . Этот процесс будет работать до тех пор, пока существует сессия этого пользователя, и будет убит, как только последний сеанс для пользователя будет закрыт. Когда включен <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">#Автоматический запуск systemd от имени пользователя</a>, то процесс запускается при загрузке и убит не будет. Пользовательский процесс systemd отвечает за управление службами пользователей, которые могут быть использованы для запуска демонов или автоматизированных задач, со всеми преимуществами systemd, таких как активация сокета, таймеры, системы зависимостей или строгий контроль процесса через контрольные группы.
</p>
<p>Аналогично системным службам, пользовательские службы расположены в следующих каталогах (отсортированы по возрастанию приоритета):
</p>
<ul>
<li>
<code>/usr/lib/systemd/user/</code> где находятся службы, относящиеся к установленным пакетам.</li>
<li>
<code>~/.local/share/systemd/user/</code> где находятся службы, относящиеся к пакетам, установленным в домашний каталог.</li>
<li>
<code>/etc/systemd/user/</code> где находятся общесистемные пользовательские службы, созданные системным администратором.</li>
<li>
<code>~/.config/systemd/user/</code> где пользователь размещает свои собственные службы.</li>
</ul>
<p>При запуске пользовательского процесса systemd он привязывается к пользовательской же (то есть отдельной для каждого пользователя) цели <code>default.target</code>. Другие службы могут управляться вручную с помощью команды <code>systemctl --user</code>. См. <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.special"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.special.7#UNITS_MANAGED_BY_THE_USER_SERVICE_MANAGER">systemd.special(7) § UNITS MANAGED BY THE USER SERVICE MANAGER</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Имейте в виду, что <code>systemd --user</code> представляет собой процесс для каждого пользователя, а не для сессии. Смысл заключается в том, что большая часть ресурсов, обрабатываемых пользовательскими службами, такие как сокеты или файлы состояния будут создаваться отдельно для каждого пользователя (в его домашнем каталоге), и не за один сеанс. Это означает, что все пользовательские службы работают вне сеанса. Как следствие, программы, которые должны быть запущены внутри сессии, вероятно, прервут выполнение пользовательских служб. С помощью systemd в пользовательском сеансе обрабатывается довольно много данных. См <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[1]</a> и <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[2]</a> для получения подсказок о том, как идут дела.</li>
<li>
<code>systemd --user</code> выполняется как процесс, отдельный от родительского процесса <code>systemd --system</code>. Службы пользователей не могут ссылаться или зависеть от системных юнитов или юнитов других пользователей.</li>
</ul>
</div>
<h2>
<span id=".D0.9E.D1.81.D0.BD.D0.BE.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B8"></span><span class="mw-headline" id="Основные_настройки">Основные настройки</span>
</h2>
<p>Все пользовательские службы размещаются в <code>~/.config/systemd/user/</code>. Если вы хотите запускать службы при первом входе в систему, выполните <code>systemctl --user enable <i>service</i></code> для любой службы, которую вы хотите сделать автозагрузочной.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong>  Если вы хотите включить службу для всех пользователей, а не для пользователя, выполняющего команду <i>systemctl </i>, запустите <code>systemctl --user --global enable <i>service</i></code> от имени суперпользователя.</div>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5_.D0.BE.D0.BA.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Переменные_окружения">Переменные окружения</span>
</h3>
<p>Пользовательский процесс systemd не наследует какую-либо из <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменных окружения</a>, установленных в <code>.bashrc</code> или других. Существует несколько способов установить переменные окружения для systemd:
</p>
<ol><li>Для переменной <code>$HOME</code> пользовательского каталога, создайте файл <i>.conf</i> в каталоге <code>~/.config/environment.d/</code> со строками вида {{ic | 1 = NAME = VAL}. Применяется только к части пользовательских служб.</li></ol>
<p>Смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> для получения дополнительной информации.
</p>
<ol>
<li>Используйте опцию <code>DefaultEnvironment</code> в <code>/etc/systemd/user.conf</code>. Применяется ко всем пользовательским службам.</li>
<li>Добавление конфигурационного файла в <code>/etc/systemd/system/user@.service.d/</code>. Применяется ко всем пользовательским процессам; см <a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D1%8B">#Пример службы</a>
</li>
<li>Для временного изменения используйте <code>systemctl --user set-environment</code> или <code>systemctl --user import-environment</code>. Применяется ко всем пользовательским службам, созданным после установки переменных окружения, но не к службам, которые уже были запущены.</li>
<li>Используйте <code>dbus-update-activation-environment --systemd --all</code> команда обеспечивается <a href="../en/D-Bus.html" class="mw-redirect" title="Dbus">dbus</a>. Имеет тот же эффект, что и <code>systemctl --user import-environment</code>, но так же влияет на сессию D-Bus. Вы можете добавить это в конец вашего файла инициализации оболочки.</li>
<li>Для "глобальных" переменных пользовательского окружения вы можете использовать каталоги <code>environment.d</code>, которые анализируются генераторами systemd. Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.generator.7">systemd.generator(7)</a></span>.</li>
<li>Вы также можете написать скрипт генератора среды, который может создавать переменные среды, которые варьируются от пользователя к пользователю. Это, вероятно, лучший способ, если вам нужны индивидуальные среды (это относится к <code>XDG_RUNTIME_DIR</code>, <code>DBUS_SESSION_BUS_ADDRESS</code> и т.д.). Смотрите <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.environment-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.environment-generator.7">systemd.environment-generator(7)</a></span>.</li>
</ol>
<p>Одну переменную Вы можете установить в <code>PATH</code>.
</p>
<p>После настройки можно использовать команду <code>systemctl --user show-environment</code> для проверки правильности значений.
</p>
<h4>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.81.D0.BB.D1.83.D0.B6.D0.B1.D1.8B"></span><span class="mw-headline" id="Пример_службы">Пример службы</span>
</h4>
<p>Создайте <a href="../en/Systemd.html#Drop-in_files" title="Systemd">drop-in</a> каталог <code>/etc/systemd/system/user@.service.d/</code> и внутри создайте файл с расширением <code>.conf</code> (например, <code>local.conf</code>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user@.service.d/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment="PATH=/usr/lib/ccache/bin:/usr/local/bin:/usr/bin:/bin"
Environment="EDITOR=nano -c"
Environment="BROWSER=firefox"
Environment="NO_AT_BRIDGE=1"</pre>
<h4>
<span id="DISPLAY_.D0.B8_XAUTHORITY"></span><span class="mw-headline" id="DISPLAY_и_XAUTHORITY">DISPLAY и XAUTHORITY</span>
</h4>
<p>Переменная <code>DISPLAY</code> используется любым графическим приложением, чтобы знать, какой дисплей использовать, <code>XAUTHORITY</code>, чтобы указать путь к пользовательскому файлу <code>.Xauthority</code>, а также куки, необходимые для запуска Х-сервера. Если Вы планируете запускать графические приложения из процесса systemd, то эти переменные обязательно должны быть установлены. Systemd предоставляет скрипт в <code>/etc/X11/xinit/xinitrc.d/50-systemd-user.sh</code> для импорта этих переменных в пользовательскую сессию systemd на запуск X. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/v219/NEWS#L194">[3]</a> Так что если Вы не запускаете Х нестандартным образом, пользовательские службы должны знать переменные <code>DISPLAY</code> и <code>XAUTHORITY</code>.
</p>
<h4><span class="mw-headline" id="PATH">PATH</span></h4>
<p>Если изменить <code>PATH</code> и запланированный запуск приложений, которые используют службу systemd, Вы должны убедиться, что модифицированный <code>PATH</code> установлен и в среде systemd. Если предположить, что Вы установили переменную <code>PATH</code> в <code>.bash_profile</code>, то лучшим способом сделать systemd осведомленным о модификации <code>PATH</code> будет добавление в <code>.bash_profile</code> после <code>PATH</code> заданной переменной:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bash_profile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">systemctl --user import-environment PATH
</pre>
<p>Обратите внимание, что это не повлияет на службы systemd, запущенные до импортирования PATH.
</p>
<h4><span class="mw-headline" id="pam_environment">pam_environment</span></h4>
<p>Переменные среды можно сделать доступными с помощью модуля <code>pam_env.so</code>. Смотрите <a href="../en/Environment_variables.html#Using_pam_env" title="Environment variables">Environment variables#Using pam_env</a> для деталей конфигурации.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_systemd_.D0.BE.D1.82_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Автоматический_запуск_systemd_от_имени_пользователя">Автоматический запуск systemd от имени пользователя</span>
</h3>
<p>Пользовательский процесс systemd запускается сразу после первого входа пользователя в систему, и будет убит после завершения последнего сеанса пользователя. Иногда может быть полезно запустить службу сразу после загрузки, и поддерживать процесс systemd запущенным даже после завершения последнего сеанса пользователя, например, чтобы некоторый пользовательский процесс работал без какой-либо открытой сессии. Для этой цели используются долговременные службы.  Используйте следующую команду, чтобы включить долговременную службу для конкретного пользователя:
</p>
<pre># loginctl enable-linger <i>username</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Служба systemd находится <b>вне</b> сессии, она запускается за пределами <i>logind</i>. Не используйте долговременные службы для включения автоматического входа в систему, иначе будет <a href="../ru/General_troubleshooting.html#%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B8" title="General troubleshooting (Русский)">перерыв в работе сессии</a>.</div>
<h2>
<span id=".D0.9D.D0.B0.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B8.D1.85_.D1.8E.D0.BD.D0.B8.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Написание_пользовательских_юнитов">Написание пользовательских юнитов</span>
</h2>
<p>Смотрите <a href="../en/Systemd.html#Writing_unit_files" title="Systemd">systemd#Writing unit files</a> для получения общей информации о написании юнитов модулей systemd.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80"></span><span class="mw-headline" id="Пример">Пример</span>
</h3>
<p>Ниже приведен пример варианта пользовательской службы mpd.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mpd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Music Player Daemon

[Service]
ExecStart=/usr/bin/mpd --no-daemon

[Install]
WantedBy=default.target
</pre>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.81_.D0.BF.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.BC.D0.B8"></span><span class="mw-headline" id="Пример_с_переменными">Пример с переменными</span>
</h3>
<p>Ниже приведен пример пользовательской версии <code>sickbeard.service</code>, которая учитывает все переменные окружения пользовательских каталогов, где SickBeard может найти некоторые файлы:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/sickbeard.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=SickBeard Daemon

[Service]
ExecStart=/usr/bin/env python2 /opt/sickbeard/SickBeard.py --config %h/.sickbeard/config.ini --datadir %h/.sickbeard

[Install]
WantedBy=default.target
</pre>
<p>Как указано в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5">systemd.unit(5)</a></span>, переменная <code>%h</code> заменяется домашней директорией пользователя, запускающего службу. Есть и другие переменные, которые учитываются на странице руководства <a href="../en/Systemd.html" title="Systemd">systemd</a>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.87.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BE_.D0.BF.D1.80.D0.B8.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F.D1.85_X"></span><span class="mw-headline" id="Примечание_о_приложениях_X">Примечание о приложениях X</span>
</h3>
<p>Большинству приложений X для запуска нужна переменная <code>DISPLAY</code>. Смотрите <a href="#DISPLAY_%D0%B8_XAUTHORITY">#DISPLAY и XAUTHORITY</a>, чтобы узнать, как установить эту переменную для всего пользовательского экземпляра systemd.
</p>
<h3>
<span id=".D0.A7.D1.82.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B6.D1.83.D1.80.D0.BD.D0.B0.D0.BB.D0.B0"></span><span class="mw-headline" id="Чтение_журнала">Чтение журнала</span>
</h3>
<p>Журнал для пользователя может быть прочитан с помощью аналогичной команды:
</p>
<pre>$ journalctl --user
</pre>
<p>Чтобы указать юнит, можно использовать
</p>
<pre>$ journalctl --user -u myunit.service
</pre>
<p>Эквивалентная команда
</p>
<pre>$ journalctl --user --user-unit myunit.service
</pre>
<p>Обратите внимание, что journald не будет писать пользовательские журналы для пользователей с UID ниже 1000, вместо этого <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/blob/a33687b792908aa6c9f4c0b22e8935643ee0ddb6/src/journal/journald-server.c#L402">перенаправляя </a> всё в системный журнал.
</p>
<h2>
<span id=".D0.92.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D1.8B"></span><span class="mw-headline" id="Временные_файлы">Временные файлы</span>
</h2>
<p><i>systemd-tmpfiles</i> позволяет пользователям управлять нестабильными и временными файлами и каталогами так же, как общесистемным способом (см. <a href="../ru/Systemd.html#systemd-tmpfiles_%E2%80%94_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">systemd#systemd-tmpfiles — временные файлы</a>). Пользовательские файлы конфигурации считываются из <code>~/.config/user-tmpfiles.d/</code> и <code>~/.local/share/user-tmpfiles.d/</code> в указанном порядке. Для использования этой функциональности требуется включить необходимые пользовательские юниты systemd для вашего пользователя:
</p>
<pre>$ systemctl --user enable systemd-tmpfiles-setup.service systemd-tmpfiles-clean.timer
</pre>
<p>Синтаксис конфигурационных файлов такой же, как и для всей системы. Для получения дополнительной информации смотрите справочные страницы <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-tmpfiles"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-tmpfiles.8">systemd-tmpfiles(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 5 tmpfiles.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tmpfiles.d.5">tmpfiles.d(5)</a></span>.
</p>
<h2>
<span id="Xorg_.D0.B8_systemd"></span><span class="mw-headline" id="Xorg_и_systemd">Xorg и systemd</span>
</h2>
<p>Есть несколько способов запустить xorg в системных модулях. Ниже представлены два варианта: либо запустить новый пользовательский сеанс с процессом xorg, либо запустить xorg из пользовательской службы systemd.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.BB.D0.BE.D0.B3.D0.B8.D0.BD_.D0.B2_Xorg_.D0.B1.D0.B5.D0.B7_.D1.8D.D0.BA.D1.80.D0.B0.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Автоматический_логин_в_Xorg_без_экранного_менеджера">Автоматический логин в Xorg без экранного менеджера</span>
</h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Спорная информация в оригинале: This setup ends up with two user D-Bus buses, one for the desktop, and an other for systemd. Why can't we use the systemd one alone?  (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/User_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Talk:Systemd (Русский)/User (Русский)#</a>)</div>
</div>
<p>Эта опция запускает системный блок, который запускает сеанс пользователя с сервером xorg, а затем запускает обычный <code>~/.xinitrc</code> для запуска оконного менеджера и т.д.
</p>
<p>Вам необходим установленный <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xlogin-git/">xlogin-git</a></span><sup><small>AUR</small></sup>. Настройте свой xinitrc, как указано в разделе <a href="../en/Xinit.html#xinitrc" title="Xinit">Xinit#xinitrc</a>.
</p>
<p>Сеанс будет использовать собственный  dbus демон, но различные утилиты systemd будут автоматически подключаться к экземпляру <code>dbus.service</code>. Наконец, <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> службу <code>xlogin@<i>username</i></code> для автоматического входа при загрузке.Сеанс пользователя полностью находится в области видимости systemd, и все в сеансе пользователя должно работать нормально.
</p>
<h3>
<span id="Xorg_.D0.BA.D0.B0.D0.BA_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B0.D1.8F_.D1.81.D0.BB.D1.83.D0.B6.D0.B1.D0.B0_systemd"></span><span class="mw-headline" id="Xorg_как_пользовательская_служба_systemd">Xorg как пользовательская служба systemd</span>
</h3>
<p>Кроме того, <a href="../ru/Xorg.html" title="Xorg (Русский)">Xorg</a> можно запустить из службы пользователя systemd. Это хорошо, поскольку другие связанные с X юниты могут зависеть от xorg и т. д. Но с другой стороны, у этого есть некоторые недостатки, объясненные ниже.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-server">xorg-server</a></span> обеспечивает интеграцию с systemd двумя способами:
</p>
<ul>
<li>Может быть запущен непривилегированным, делегируя управление устройствами logind (смотрите коммиты Hans de Goede <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/commit/?id=82863656ec449644cd34a86388ba40f36cea11e9">коммит</a>).</li>
<li>Может быть превращен в сервис, активируемый сокетом (смотрите <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/commit/?id=b3d3ffd19937827bcbdb833a628f9b1814a6e189">этот коммит</a>). Это устраняет необходимость в <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/systemd-xorg-launch-helper-git/">systemd-xorg-launch-helper-git</a></span><sup><small>AUR</small></sup>.</li>
</ul>
<p>К сожалению, чтобы иметь возможность запускать xorg в непривилегированном режиме, он должен запускаться внутри сеанса. Итак, в данный момент недостаток запуска xorg в качестве пользовательской службы заключается в том, что он должен запускаться с привилегиями суперпользователя (как до 1.16) и не может использовать преимущества непривилегированного режима, представленного в 1.16.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Это не является фундаментальным ограничением, налагаемым logind, но причина, по-видимому, заключается в том, что xorg нужно знать, какой сеанс взять на себя, и сейчас он получает эту информацию, вызывая <a rel="nofollow" class="external text" href="https://www.freedesktop.org/wiki/Software/systemd/logind">logind</a>'s <code>GetSessionByPID</code> используя свой собственный pid в качестве аргумента. Смотрите <a rel="nofollow" class="external text" href="http://lists.x.org/archives/xorg-devel/2014-February/040476.html">this thread</a> и <a rel="nofollow" class="external text" href="https://cgit.freedesktop.org/xorg/xserver/tree/hw/xfree86/os-support/linux/systemd-logind.c">xorg sources</a>. Кажется вероятным, что xorg можно изменить, чтобы получить сеанс от tty, к которому он подключен, и затем он мог бы работать непривилегированным из пользовательской службы вне сеанса.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> В xorg 1.18  активация сокета, кажется, сломана. Клиент, вызывающий активацию, зависает. Смотрите вышестоящий отчет об ошибках <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/xorg/xserver/issues/491">[4]</a>. В качестве временного обходного пути вы можете запустить сервер xorg без активации сокета, убедившись, что клиенты подключаются после задержки, поэтому сервер полностью запускается. Кажется, нет никакого удобного механизма, чтобы получить уведомление о запуске для X сервера.</div>
<p>Вот как запустить xorg из пользовательского сервиса:
</p>
<p>1. Заставить xorg работать с правами суперпользователя и для любого пользователя путем редактирования <code>/etc/X11/Xwrapper.config</code> 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/Xwrapper.config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allowed_users=anybody
needs_root_rights=yes
</pre>
<p>2. Добавить следующие юниты в <code>~/.config/systemd/user</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Socket for xorg at display %i

[Socket]
ListenStream=/tmp/.X11-unix/X%i
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Xorg server at display %i

Requires=xorg@%i.socket
After=xorg@%i.socket

[Service]
Type=simple
SuccessExitStatus=0 1

ExecStart=/usr/bin/Xorg :%i -nolisten tcp -noreset -verbose 2 "vt${XDG_VTNR}"
</pre>
<p>где <code>${XDG_VTNR</code>} - виртуальный терминал, на котором будет запущен xorg, либо прописанный в сервисном модуле, либо установленный в среде systemd с помощью
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> xorg должен быть запущен на том же виртуальном терминале, где пользователь вошел в систему. В противном случае logind будет считать сеанс неактивным.</div>
<p>3. Обязательно настройте переменную среды <code>DISPLAY</code>, как описано <a href="#DISPLAY_%D0%B8_XAUTHORITY">выше</a>.
</p>
<p>4. Затем, чтобы активировать сокет для xorg на дисплее 0 и tty 2, следует выполнить:
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=2     # Так что xorg@.service знает, какой vt использовать
$ systemctl --user start xorg@0.socket            # начинает слушать на сокете для дисплея 0
</pre>
<p>Теперь запуск любого X приложения  автоматически запустит xorg на виртуальном терминале 2.
</p>
<p>Переменная среды <code>XDG_VTNR</code> может быть установлена в среде systemd из <code>.bash_profile</code>, а затем можно запустить любое приложение X, включая диспетчер окон, как системный модуль, зависящий от <code>xorg@0.socket</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> В настоящее время запуск оконного менеджера в качестве пользовательской службы означает, что он работает работает за пределами сеанса, с проблемами, которые могут возникнуть: <a href="../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">break the session</a>. Однако, похоже, что разработчики systemd намерены сделать что-то подобное возможным. Смотрите <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[5]</a> и <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[6]</a>
</div>
<h2>
<span id=".D0.9D.D0.B5.D0.BA.D0.BE.D1.82.D0.BE.D1.80.D1.8B.D0.B5_.D1.81.D0.BB.D1.83.D1.87.D0.B0.D0.B8_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Некоторые_случаи_использования">Некоторые случаи использования</span>
</h2>
<h3>
<span id=".D0.9F.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.BD.D1.8B.D0.B9_.D1.82.D0.B5.D1.80.D0.BC.D0.B8.D0.BD.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B9_.D0.BC.D1.83.D0.BB.D1.8C.D1.82.D0.B8.D0.BF.D0.BB.D0.B5.D0.BA.D1.81.D0.BE.D1.80"></span><span class="mw-headline" id="Постоянный_терминальный_мультиплексор">Постоянный терминальный мультиплексор</span>
</h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Устаревшая информация в оригинале: Ссылается на <code>user-session@.service</code> вместо <code>user@.service</code>; последний не содержит <code>Conflicts=getty@tty1.service</code>. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/User_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Talk:Systemd (Русский)/User (Русский)#</a>)</div>
</div>
<p>Возможно, вы захотите, чтобы в сеансе пользователя по умолчанию использовался терминальный мультиплексор, например <a href="../en/GNU_Screen.html" title="GNU Screen">GNU Screen</a> или <a href="../en/Tmux.html" title="Tmux">Tmux</a>, в фоновом режиме, а не для входа в сеанс оконного менеджера. Разделение входа в систему от входа в систему X, скорее всего, полезно только для тех, кто загружается с TTY, а не с экранным менеджером (в этом случае вы можете просто связать все, что вы запускаете, с myStuff.target). 
</p>
<p>Чтобы создать пользовательский сеанс такого типа, действуйте, как указано выше, но вместо создания wm.target создайте multiplexer.target:
</p>
<pre>[Unit]
Description=Terminal multiplexer
Documentation=info:screen man:screen(1) man:tmux(1)
After=cruft.target
Wants=cruft.target

[Install]
Alias=default.target</pre>
<p><code>cruft.target</code>, как <code>mystuff.target</code> выше, должен запускать все, что, по вашему мнению, должно запускаться до запуска tmux или экрана (или что вы хотите запустить при загрузке независимо от времени), например сеанс демона GnuPG.
</p>
<p>Затем вам нужно создать сервис для сеанса мультиплексора. Вот пример службы, использующей tmux в качестве примера и использующей сеанс gpg-agent, который записал свою информацию в <code>/tmp/gpg-agent-info</code>. Этот пример сеанса при запуске X также сможет запускать программы X, так как установлен DISPLAY.
</p>
<pre>[Unit]
Description=tmux: A terminal multiplixer 
Documentation=man:tmux(1)
After=gpg-agent.service
Wants=gpg-agent.service

[Service]
Type=forking
ExecStart=/usr/bin/tmux start
ExecStop=/usr/bin/tmux kill-server
Environment=DISPLAY=:0
EnvironmentFile=/tmp/gpg-agent-info

[Install]
WantedBy=multiplexer.target</pre>
<p>Как только это будет сделано, <code>systemctl --user enable</code> <code>tmux.service</code>, <code>multiplexer.target</code> и любые сервисы, которые вы создали для запуска <code>cruft.target</code>, и вы должны быть готовы к работе! Активирован <code>user-session@.service</code>, как описано выше, но обязательно удалите <code>Conflicts=getty@tty1.service</code> из {{ic|user-session@.service} }, поскольку ваш пользовательский сеанс не будет принимать TTY. Поздравляем! У вас есть работающий терминальный мультиплексор и некоторые другие полезные программы, готовые к запуску при загрузке!
</p>
<h3>
<span id=".D0.9E.D0.BA.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80"></span><span class="mw-headline" id="Оконный_менеджер">Оконный менеджер</span>
</h3>
<p>Чтобы запустить оконный менеджер в качестве службы systemd, сначала необходимо запустить <a href="#Xorg_%D0%BA%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D0%B0_systemd">Xorg как пользовательскую службу systemd</a>. В следующем примере мы будем использовать <a href="../ru/Awesome.html" title="Awesome (Русский)">awesome (Русский)</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/awesome.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Awesome window manager
After=xorg.target
Requires=xorg.target

[Service]
ExecStart=/usr/bin/awesome
Restart=always
RestartSec=10
 
[Install]
WantedBy=wm.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Раздел <code>[Install]</code> содержит часть <code>WantedBy</code>. При использовании <code>systemctl --user enable</code> он будет связывать это как <code>~/.config/systemd/user/wm.target.wants /<i>window_manager</i>.service</code>, позволяя ему стартовать при входе в систему. Рекомендуется включить этот сервис, а не связывать его вручную.</div>
<h2>
<span id=".D0.97.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D1.86.D0.B5.D1.81.D1.81.D0.BE.D0.B2_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F_.D0.BF.D1.80.D0.B8_.D0.B2.D1.8B.D1.85.D0.BE.D0.B4.D0.B5_.D0.B8.D0.B7_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Завершение_процессов_пользователя_при_выходе_из_системы">Завершение процессов пользователя при выходе из системы</span>
</h2>
<p>Arch Linux создает пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> с помощью <code>--without-kill-user-process</code>, устанавливая <code>KillUserProcesses</code> равным <code>no</code> по умолчанию. Этот параметр предотвращает уничтожение пользовательских процессов, когда пользователь полностью выходит из системы. Чтобы изменить это поведение и убить все пользовательские процессы при выходе из системы, установите <code>KillUserProcesses=yes</code> в <code>/etc/systemd/logind.conf</code>.
</p>
<p>Обратите внимание, что изменение этого параметра нарушает работу мультиплексоров терминала, таких как <a href="../en/Tmux.html" title="Tmux">tmux</a> и <a href="../ru/GNU_Screen.html" title="GNU Screen (Русский)">GNU Screen (Русский)</a>. Если вы измените этот параметр, вы все равно сможете использовать терминальный мультиплексор, используя <code>systemd-run</code> следующим образом:
</p>
<pre>$ systemd-run --scope --user <i>command</i> <i>args</i>
</pre>
<p>Например, чтобы запустить <code>screen</code>, вы должны сделать:
</p>
<pre>$ systemd-run --scope --user screen -S <i>foo</i>
</pre>
<p>Запущенные с помощью <code>systemd-run</code> процессы продолжат работу даже после выхода пользователя, если он залогинен в системе где-то ещё и служба <code>user@.service</code> всё ещё работает.
</p>
<p>После завершения всех активных сеансов <code>user@.service</code> прекращает работу, если для этого пользователя не был включён <i>lingering</i> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/76153ad45f09b6ae45464f2e03d3afefbb4b2afe/NEWS#L274">[7]</a>. Поэтому для запуска и работы долгосрочных процессов после полного выхода пользователя из системы необходимо включить lingering. Подробнее см. <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">#Автоматический запуск systemd от имени пользователя</a> и <span class="plainlinks archwiki-template-man" title="$ man 1 loginctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/loginctl.1">loginctl(1)</a></span>.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units/wiki/Home">Вики-ресурс пользователя KaiSforza на Bitbucket</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/zoqaeski/systemd-user-units">Файлы юнитов пользователя Zoqaeski на GitHub</a></li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=167115">Ветка форума Arch Linux об изменениях пользовательских экземпляров в systemd 206</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:System_administration.html" title="Category:System administration (Русский)">System administration (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/User_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=645597">https://wiki.archlinux.org/index.php?title=Systemd_(Русский)/User_(Русский)&amp;oldid=645597</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 December 2020, at 13:36.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
