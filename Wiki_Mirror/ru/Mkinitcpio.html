<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>mkinitcpio (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Mkinitcpio_Русский rootpage-Mkinitcpio_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">mkinitcpio (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Systemd.html" title="Systemd (Русский)">systemd (Русский)</a></li>
<li><a href="../ru/Kernel_module.html" class="mw-redirect" title="Kernel modules (Русский)">Kernel modules (Русский)</a></li>
</ul>
</div>
<p><br>
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5"><span class="tocnumber">1</span> <span class="toctext">Введение</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_mkinitcpio"><span class="tocnumber">2</span> <span class="toctext">Установка mkinitcpio</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%B0"><span class="tocnumber">3</span> <span class="toctext">Создание загрузочного образа</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#%D0%92%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82%D1%8B_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F_initcpio"><span class="tocnumber">3.1</span> <span class="toctext">Варианты создания initcpio</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0"><span class="tocnumber">4</span> <span class="toctext">Настройка</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#MODULES"><span class="tocnumber">4.1</span> <span class="toctext">MODULES</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#BINARIES_and_FILES"><span class="tocnumber">4.2</span> <span class="toctext">BINARIES and FILES</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#HOOKS"><span class="tocnumber">4.3</span> <span class="toctext">HOOKS</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Build_hooks"><span class="tocnumber">4.3.1</span> <span class="toctext">Build hooks</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Runtime_hooks"><span class="tocnumber">4.3.2</span> <span class="toctext">Runtime hooks</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#%D0%94%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B%D0%B5_%D1%85%D1%83%D0%BA%D0%B8"><span class="tocnumber">4.3.3</span> <span class="toctext">Доступные хуки</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12"><a href="#COMPRESSION"><span class="tocnumber">4.4</span> <span class="toctext">COMPRESSION</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#COMPRESSION_OPTIONS"><span class="tocnumber">4.5</span> <span class="toctext">COMPRESSION_OPTIONS</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14">
<a href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D1%82%D1%80%D0%BE%D0%BA%D0%B8_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D1%8F%D0%B4%D1%80%D0%B0"><span class="tocnumber">5</span> <span class="toctext">Изменения строки параметров ядра</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#%D0%92%D1%85%D0%BE%D0%B4_%D0%B2_%D0%B1%D0%B5%D0%B7%D0%BE%D1%82%D0%BA%D0%B0%D0%B7%D0%BD%D1%8B%D0%B9_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC"><span class="tocnumber">5.1</span> <span class="toctext">Вход в безотказный режим</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%82_%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%BE%D0%B2"><span class="tocnumber">5.2</span> <span class="toctext">Запрет обработчиков</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%82_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B5%D0%B9"><span class="tocnumber">5.3</span> <span class="toctext">Запрет загрузки модулей</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_raid"><span class="tocnumber">5.4</span> <span class="toctext">Использование raid</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_net"><span class="tocnumber">5.5</span> <span class="toctext">Использование net</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_lvm"><span class="tocnumber">5.6</span> <span class="toctext">Использование lvm</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BD%D0%B0_%D0%BA%D0%BE%D1%80%D0%BD%D0%B5%D0%B2%D0%BE%D0%BC_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%B5"><span class="tocnumber">5.7</span> <span class="toctext">Использование шифрования на корневом разделе</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_LUKS_%D1%82%D0%BE%D0%BC%D0%BE%D0%B2"><span class="tocnumber">5.7.1</span> <span class="toctext">Использование LUKS томов</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_legacy_cryptsetup_%D1%82%D0%BE%D0%BC%D0%BE%D0%B2"><span class="tocnumber">5.7.2</span> <span class="toctext">Использование legacy cryptsetup томов</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_loop-aes_%D1%82%D0%BE%D0%BC%D0%BE%D0%B2"><span class="tocnumber">5.7.3</span> <span class="toctext">Использование loop-aes томов</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-25">
<a href="#Troubleshooting"><span class="tocnumber">6</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#Extracting_the_image"><span class="tocnumber">6.1</span> <span class="toctext">Extracting the image</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Recompressing_a_modified_extracted_image"><span class="tocnumber">6.2</span> <span class="toctext">Recompressing a modified extracted image</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#%22/dev_must_be_mounted%22_when_it_already_is"><span class="tocnumber">6.3</span> <span class="toctext">"/dev must be mounted" when it already is</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Using_systemd_HOOKS_in_a_LUKS/LVM/resume_setup"><span class="tocnumber">6.4</span> <span class="toctext">Using systemd HOOKS in a LUKS/LVM/resume setup</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Possibly_missing_firmware_for_module_XXXX"><span class="tocnumber">6.5</span> <span class="toctext">Possibly missing firmware for module XXXX</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#mkinitcpio_creates_images_with_all_the_shared_libraries_missing"><span class="tocnumber">6.6</span> <span class="toctext">mkinitcpio creates images with all the shared libraries missing</span></a></li>
<li class="toclevel-2 tocsection-32">
<a href="#Standard_rescue_procedures"><span class="tocnumber">6.7</span> <span class="toctext">Standard rescue procedures</span></a>
<ul>
<li class="toclevel-3 tocsection-33"><a href="#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D1%8F%D0%B5%D1%82%D1%81%D1%8F_%D0%BD%D0%B0_%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9_%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D0%B5_%D0%B8_%D1%82%D0%B5%D1%80%D0%BF%D0%B8%D1%82_%D0%BD%D0%B5%D1%83%D0%B4%D0%B0%D1%87%D1%83_%D0%BD%D0%B0_%D0%B4%D1%80%D1%83%D0%B3%D0%BE%D0%B9"><span class="tocnumber">6.7.1</span> <span class="toctext">Загрузка выполняется на одной машине и терпит неудачу на другой</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-34">
<a href="#%D0%AF_%D0%BF%D0%B0%D1%80%D0%B0%D0%BD%D0%BE%D0%B8%D0%BA!"><span class="tocnumber">7</span> <span class="toctext">Я параноик!</span></a>
<ul>
<li class="toclevel-2 tocsection-35"><a href="#%D0%9F%D1%80%D0%B5%D0%B4%D1%83%D0%BF%D1%80%D0%B5%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE_cpio"><span class="tocnumber">7.1</span> <span class="toctext">Предупреждение о cpio</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_bsdtar_%D0%B4%D0%BB%D1%8F_%D0%B8%D0%B7%D0%B2%D0%BB%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F"><span class="tocnumber">7.2</span> <span class="toctext">Использование bsdtar для извлечения</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".D0.92.D0.B2.D0.B5.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Введение">Введение</span>
</h2>
<p>mkinitcpio это Bash скрипт используемый для создания начального загрузочного диска системы. Из <a rel="nofollow" class="external text" href="https://projects.archlinux.org/mkinitcpio.git/tree/man/mkinitcpio.8.txt">mkinitcpio man page</a>:
</p>
<dl><dd><i>The initial ramdisk is in essence a very small environment (early userspace) which loads various kernel modules and sets up necessary things before handing over control to init. This makes it possible to have, for example, encrypted root file systems and root file systems on a software RAID array. mkinitcpio allows for easy extension with custom hooks, has autodetection at runtime, and many other features.</i></dd></dl>
<p>Традиционно ядро отвечает за обнаружение всего оборудования и выполняет задачи на ранних этапах <a href="../en/Arch_boot_process.html" class="mw-redirect" title="Boot process">процесса загрузки</a> до монтирования корневой файловой системы.
</p>
<p>В настоящее время корневая файловая система может быть на широком диапазоне аппаратных средств от SCSI до SATA и USB дисков, управляемых различными контроллерами от разных производителей. Кроме того корневая файловая система может быть зашифрована или сжата, находиться в RAID массиве или группе логических томов. Простой способ справиться с этой сложностью является передача управления в пользовательском пространстве: начальный загрузочный диск.
</p>
<p>Смотрите также: <a rel="nofollow" class="external text" href="http://archlinux.me/brain0/2010/02/13/early-userspace-in-arch-linux/">/dev/brain0 » Blog Archive » Early Userspace in Arch Linux</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup>.
</p>
<p>mkinitcpio является модульным инструментом для построения initramfs CPIO образа, предлагая много преимуществ по сравнению с альтернативными методами. Эти преимущества включают в себя:
</p>
<ul>
<li>Использование <a rel="nofollow" class="external text" href="http://www.busybox.net/">BusyBox</a>, чтобы обеспечить легкость базы для раннего userspace'a.</li>
<li>Поддержка <b><a href="../ru/Udev.html" title="Udev (Русский)">udev</a></b> для автоматического обнаружения оборудования, предотвращая загрузку ненужных модулей.</li>
<li>Использование расширяемого hook-based скрипта с поддержкой пользовательских хуков, которые могут быть включены в состав пакетов и устанавливаться с помощью <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a>.</li>
<li>Поддержка  <b>LVM2</b>, <b>dm-crypt</b> как и LUKS томов, <b>mdadm</b>, и <b>swsusp</b>, и <b>suspend2</b> для использования спящего режима и загрузки с USB носителей.</li>
<li>Предоставляет много возможностей для настройки из командной строки ядра без необходимости пересборки образа.</li>
</ul>
<p>mkinitcpio создан разработчиками Arch Linux и вкладами сообщества. Смотрите <a rel="nofollow" class="external text" href="https://projects.archlinux.org/mkinitcpio.git/">public Git repository</a>.
</p>
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_mkinitcpio"></span><span class="mw-headline" id="Установка_mkinitcpio">Установка mkinitcpio</span>
</h2>
<p><a href="../ru/Pacman.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установить">Установить</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>, который является зависимым от пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, поэтому большинство пользователей уже установили его.
</p>
<p>Продвинутые пользователи могут захотеть установить последнюю версию mkinitcpio из Git с пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-git/">mkinitcpio-git</a></span><sup><small>AUR</small></sup>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <b>Настоятельно</b> читать <a rel="nofollow" class="external text" href="https://mailman.archlinux.org/mailman/listinfo/arch-projects">arch-projects mailing list</a> при использовании mkinitcpio из Git!</div>
<h2>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BE.D1.87.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.B0"></span><span class="mw-headline" id="Создание_загрузочного_образа">Создание загрузочного образа</span>
</h2>
<p>По умолчанию mkinitcpio генерирует два образа после установки или обновления ядра: <code>/boot/initramfs-linux.img</code> and <code>/boot/initramfs-linux-fallback.img</code>. <i>fallback</i> образ создается с точно таким же конфигурационным файлом за исключением хука <b>autodetect</b>, что позволяет включить в него все модули. Хук <b>autodetect</b> обнаруживает нужные модули необходимые для оборудования и включает их в initramfs. 
</p>
<p>Можно создать любое количество initramfs с различными конфигурациями. Необходимый initramfs должен быть прописан в <a href="../en/Arch_boot_process.html#Configuration_files" class="mw-redirect" title="Boot loader">конфигурационном файле загрузчика</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup>. После изменения конфигурационного файла initramfs должен быть пересобран. Для стандартного ядра Arch Linux, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>:
</p>
<pre># mkinitcpio -p linux
</pre>
<p>Параметр <code>-p</code> (сокращение от <i>preset</i>) указывает на использование preset файла из <code>/etc/mkinitcpio.d</code> (т.е. <code>/etc/mkinitcpio.d/linux.preset</code> для <code>linux</code>). preset файл определяет параметры сборки initramfs образа вместо указания файла конфигурации и выходной файл каждый раз.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <i>preset</i> файлы используются для автоматической пересборки initramfs после обновления ядра. Будьте внимательны при их редактировании.</div>
<h3>
<span id=".D0.92.D0.B0.D1.80.D0.B8.D0.B0.D0.BD.D1.82.D1.8B_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D1.8F_initcpio"></span><span class="mw-headline" id="Варианты_создания_initcpio">Варианты создания initcpio</span>
</h3>
<p>Пользователи могут вручную создать образ с помощью альтернативного конфигурационного файла. Например, следующее будет генерировать initramfs образ в соответствии с <code>/etc/mkinitcpio-custom.conf</code> и сохранит его в <code>/boot/linux-custom.img</code>.
</p>
<pre># mkinitcpio -c /etc/mkinitcpio-custom.conf -g /boot/linux-custom.img
</pre>
<p>Если необходимо создать образ с ядром отличным от загруженного.Доступные версии ядер можно посмотреть в <code>/usr/lib/modules</code>.
</p>
<pre># mkinitcpio -g /boot/linux.img -k 3.3.0-ARCH
</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p><code>/etc/mkinitcpio.conf</code> - основной конфигурационный файл <b>mkinitcpio</b>. Кроме того, в каталоге <code>/etc/mkinitcpio.d</code> располагаются preset файлы (e.g. <code>/etc/mkinitcpio.d/linux.preset</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <b>lvm2</b>, <b>mdadm</b>, и <b>encrypt</b> <b>НЕ ВКЛЮЧЕНЫ</b> по умолчанию. Прочитайте эту страницу чтобы узнать как их включить и настроить.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Если у вас более одного контроллера дисков использующих одно пространство имен устройств (например 2 SCSI/SATA или IDE контроллера) и они требуют разных модулей, укажите правильный порядок в <code>MODULES</code> в файле <code>/etc/mkinitcpio.conf</code>, иначе устройства могут поменяться местами и вы получите kernel panic при загрузке.
Более правильный путь - использовать <a href="../en/Persistent_block_device_naming.html" title="Persistent block device naming">persistent block device naming</a>, чтобы быть уверенным, что вы смонтировали действительно то, что хотели.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <b>PS/2 keyboard users</b>: Для того, чтобы получить ввод с клавиатуры в начале загрузки, если он не работает, необходимо добавить <b>keyboard</b> хук в <code>HOOKS</code>.
На некоторых материнских платах (в основном древних, но и некоторых новых), контроллер i8042 не может быть определен автоматически. Вы можете обнаружить эту ситуацию заранее.  Если у вас есть порт PS/2 и появляется сообщение  <code>i8042: PNP: No PS/2 controller found. Probing ports directly</code>, добавьте <b>atkbd</b> в <code>MODULES</code>.</div>
<p><br>
Можно изменять шесть переменных в конфигурационном файле:
</p>
<dl>
<dt><code>MODULES</code></dt>
<dd>Модули ядра, которые будут загружены до выполнения хуков.</dd>
<dt><code>BINARIES</code></dt>
<dd>Дополнительные исполняемые файлы, которые необходимо включить в initramfs.</dd>
<dt><code>FILES</code></dt>
<dd>Дополнительные файлы, которые необходимо включить в initramfs.</dd>
<dt><code>HOOKS</code></dt>
<dd>Hooks - скрипты, выполняемые в initramfs.</dd>
<dt><code>COMPRESSION</code></dt>
<dd>Тип используемого сжатия initramfs.</dd>
<dt><code>COMPRESSION_OPTIONS</code></dt>
<dd>Дополнительные опции архиваторов. Использование этого параметра не рекомендуется. mkinitcpio будет обрабатывать особые требования к архиваторам (например <code>--check=crc32</code> для xz), что может привести к невозможности запуска системы.</dd>
</dl>
<h3><span class="mw-headline" id="MODULES">MODULES</span></h3>
<p>Указывает какие модули ядра должны быть загружены прежде чем что-либо будет сделано.
</p>
<p>Для модулей с суффиксом <code>?</code> не будет выводиться ошибка, если они не будут найдены. Это может быть полезно для пользовательских ядер.
</p>
<h3><span class="mw-headline" id="BINARIES_and_FILES">BINARIES and FILES</span></h3>
<p>Указывают какие файлы необходимо добавить в initramfs. <code>BINARIES</code> и <code>FILES</code> будут добавлены до запуска хуков и использоваться для переопределения файлов использаемых хуками. <code>BINARIES</code> - бинарные файлы из <code>PATH</code>, необходимые для работы библиотеки будут автоматически добавлены. <code>FILES</code> добавляет файлы как есть. Например:
</p>
<pre>FILES="/etc/modprobe.d/modprobe.conf"
</pre>
<pre>BINARIES="kexec"
</pre>
<p>И в <code>BINARIES</code>, и в <code>FILES</code> может быть добавлено несколько файлов с пробелом в качестве разделителя.
</p>
<h3><span class="mw-headline" id="HOOKS">HOOKS</span></h3>
<p>Параметр <code>HOOKS</code> наиболее важный в файле настроек. Хуки - это небольшие скрипты, которые описывают что будет добавлено к образу, а также дополнительные действия, выполняемые при загрузке системы. Хуки указываются по имени и выполняются по порядку.
</p>
<p>Значение по умолчанию для <code>HOOKS</code> должно быть достаточным для большинства простых установок с одним диском. Для корневых устройств, которые являются многоуровневыми или многоблочными устройствами, такими как <a href="../en/LVM.html" title="LVM">LVM</a>, <a href="../en/LVM_on_software_RAID.html" class="mw-redirect" title="Software RAID and LVM">mdadm</a> или <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, см. cоответствующие страницы вики для дальнейшей необходимой конфигурации.
</p>
<h4><span class="mw-headline" id="Build_hooks">Build hooks</span></h4>
<p>Build hooks - хуки сборки. Располагаются в <code>/usr/lib/initcpio/install</code>. Эти файлы используются mkinitcpio во время сборки initramfs. Должны содержать две функции: <code>build</code> и <code>help</code>. Функция <code>build</code> перечисляет модули, файлы, исполняемые файлы, которые добавляются в образ. Функция <code>help</code> содержит описание действий хука.
</p>
<p>Для получения списка всех доступных хуков:
</p>
<pre>$ mkinitcpio -L
</pre>
<p>Используйте опцию <code>-H</code> для вывода информации о конкретном хуке:
</p>
<pre>$ mkinitcpio -H udev
</pre>
<h4><span class="mw-headline" id="Runtime_hooks">Runtime hooks</span></h4>
<p>Runtime hooks - хуки периода выполнения располагаются в <code>/usr/lib/initcpio/hooks</code>, пользовательские хуки могут быть помещены в <code>/etc/initcpio/hooks</code> Для любого хука периода исполнения всегда должен быть хук сборки с тем же именем, в котором имеется вызов <code>add_runscript</code>, указывающий на добавление хука периода исполнения в образ. Эти файлы обрабатываются командным интерпретатором ash из busybox во время раннего пользовательского пространства. Они запускаются по порядку записи в <code>HOOKS</code> за исключением хуков очистки. Runtime хуки могут содержать несколько функций:
</p>
<p><code>run_earlyhook</code>: Функции с таким именем будут запускаться однажды после установки API файловых систем и обработки командной строки ядра. Как правило, здесь запускаются дополнительные демоны, такие как udev, необходимые для раннего процесса загрузки.
</p>
<p><code>run_hook</code>: Функции с таким именем запускаются вскоре после ранних хуков. Это наиболее распространенная точка хуков, и здесь должны выполняться операции, такие как сборка многоуровневых блочных устройств.
</p>
<p><code>run_latehook</code>: Функции c этим именем запускаются после установки корневого устройства. Это следует использовать, умеренно, для дальнейшей настройки корневого устройства или для установки других файловых систем, таких как <code>/usr</code>.
</p>
<p><code>run_cleanuphook</code>: Функции с этим именем запускаются как можно позже, и в порядке обратном, порядку их перечисления в <code>HOOKS</code> файла конфигурации. Эти хуки должны использоваться для любой очистки в последнюю минуту, например, для закрытия всех демонов, запущенных ранними хуками.
</p>
<h4>
<span id=".D0.94.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.BD.D1.8B.D0.B5_.D1.85.D1.83.D0.BA.D0.B8"></span><span class="mw-headline" id="Доступные_хуки">Доступные хуки</span>
</h4>
<p>Таблица стандартных хуков и как они влияют на создание и выполнение образа. Обратите внимание, что эта таблица не является полной, так как пакеты могут предоставлять свои хуки.
</p>
<table class="wikitable">
<caption>
<b>Current hooks</b>
</caption>
<tbody>
<tr>
<th>busybox</th>
<th>systemd</th>
<th>Установка</th>
<th>Запуск
</th>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>base</b></td>
<td>Устанавливает все начальные каталоги, базовые утилиты и библиотеки. Всегда ставьте этот хук первым, за исключением случаев, когда вы действительно знаете, что делаете.
<p>Предоставляет busybox recovery shell при использовании совместно с хуком <b>systemd</b>.
</p>
</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>udev</b></td>
<td rowspan="3" style="text-align: center;"><b>systemd</b></td>
<td>Добавляет udev в образ ram-диска</td>
<td>Udev автоматически создает файл устройства для корня и загружает необходимые модули для его работы. Рекомендуется использовать.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>usr</b></td>
<td>Добавляет поддержку отделного <code>/usr</code> раздела.</td>
<td>Монтирует раздел <code>/usr</code> после монтирования корневой файловой системы.
</td>
</tr>

<tr>
<td style="text-align: center;"><b>resume</b></td>
<td style="text-align: center;">--</td>
<td>Необходим для работы спящего режима (suspend to disk). Работает с <i>swsusp</i>. Хук <b>systemd</b> поддерживает только <i>swsusp</i>. См. <a href="../en/Power_management/Suspend_and_hibernate.html#Hibernation" class="mw-redirect" title="Hibernation">Hibernation</a>.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>btrfs</b></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">--</td>
<td>Sets the required modules to enable <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> for using multiple devices with Btrfs. This hook is not required for using Btrfs on a single device.</td>
<td>Runs <code>btrfs device scan</code> to assemble a multi-device Btrfs root file system when <b>udev</b> hook or <b>systemd</b> hook is not present. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> package is required for this hook.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>autodetect</b></td>
<td>меньшает размер initramfs пытаясь определить какие модули вам нужны. Проверьте список модулей которые он добавил. Он должен запускаться раньше других подсистем. Все обработчики выполняемые до него будут включать все модули.</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>modconf</b></td>
<td>Добавляет конфигурационные файлы modprobe <code>/etc/modprobe.d</code> и <code>/usr/lib/modprobe.d</code>
</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>block</b></td>
<td>Добавляет все модули блочных устройств, ранее предоставляемые другими хуками (<i>fw</i>, <i>mmc</i>, <i>pata</i>, <i>sata</i>, <i>scsi</i>, <i>usb</i>, <i>virtio</i>).</td>
<td>--
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>pcmcia</b></td>
<td>Добавляет pcmcia модули. Требует <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pcmciautils">pcmciautils</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup>.</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>net</b></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;"><i>не реализован</i></td>
<td>Добавляет поддержку сети. Для PCMCIA устройств добавьте хук <b>pcmcia</b>.</td>
<td>Требуется для корневой файловой системы через NFS.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>dmraid</b></td>
<td style="text-align: center;"><i>?</i></td>
<td>Поддержка корневой файловой системы на fakeRAID массивах. Необходимо установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmraid">dmraid</a></span>. Обратите внимание, что необходимо использовать <code>mdadm</code> с хуком <b>mdadm_udev</b> с fakeRAID если ваш контроллер поддерживает это.</td>
<td>Находит и монтирует fakeRAID блочные устройства используя <code>dmraid</code>.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>mdadm</b></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">--</td>
<td>Обеспечивает поддержку для сборки RAID массивов из <code>/etc/mdadm.conf</code>, или автоопределеним во время загрузки. Необходимо установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span>. Вместо этого хука предпочтительнее использовать хук <b>mdadm_udev</b> .</td>
<td>Находит и собирает программные RAID блочные устройства с помощью <code>mdassemble</code>.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>mdadm_udev</b></td>
<td>Обеспечивает поддержку для сборки RAID массивов с помощью udev. Необходимо установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span>. Если вы используете этот хук с массивом FakeRAID, рекомендуется включить <code>mdmon</code> в секции BINARIES и добавить хук <b>shutdown</b> чтобы избежать восстановления массива при перезагрузке.</td>
<td>Находит и собирает программные RAID блочные устройства с помощь <code>udev</code> и <code>mdadm</code>.Это предпочтительный метод использования mdadm (заменяет хук <i>mdadm</i>).
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>keyboard</b></td>
<td>Добавляет модули необходимые для работы клавиатур. Используйте этот хук, если необходимо использовать USB клавиатуру на ранней стадии загрузки (в initramfs).</td>
<td>--
</td>
</tr>
<tr>
<td style="text-align: center;"><b>keymap</b></td>
<td rowspan="2" style="text-align: center;"><b>sd-vconsole</b></td>
<td>Добавляет в initramfs раскладки указанные <code>/etc/vconsole.conf</code>.</td>
<td>Загружает раскладки указанные в <code>/etc/vconsole.conf</code>.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>consolefont</b></td>
<td>Добавляет в initramfs консольный шрифт указанный <code>/etc/vconsole.conf</code>.</td>
<td>Загружает шрифт указанный в <code>/etc/vconsole.conf</code>.
</td>
</tr>
<tr>
<td style="text-align: center;"><b>encrypt</b></td>
<td style="text-align: center;"><b>sd-encrypt</b></td>
<td>Добавлет модуль ядра <code>dm_crypt</code> и <code>cryptsetup</code>. Требуется пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span>.</td>
<td>Определяет и подключает зашифрованый корневой раздел. См. <a href="#Runtime_customization">#Runtime customization</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">ссылка недействительна</a>: раздел не найден]</sup> для дальнейшей настройки.
<p>Для <b>sd-encrypt</b> см. <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-cryptsetup-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-cryptsetup-generator.8">systemd-cryptsetup-generator(8)</a></span> допустимые параметры ядра. В качестве альтернативы, если файл <code> /etc/crypttab.initramfs</code> существует, он будет добавлен в initramfs как <code> / etc / crypttab</code>. Дополнительную информацию о синтаксисе crypttab см. <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span>.
</p>
</td>
</tr>
<tr>
<td style="text-align: center;"><b>lvm2</b></td>
<td style="text-align: center;"><b>sd-lvm2</b></td>
<td>Добавляет поддержку <code>lvm</code>. Требует установленного пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span>.</td>
<td>Включает поддержку lvm. Необходим, если корневая файловая система на <a href="../en/LVM.html" title="LVM">LVM</a>.
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>fsck</b></td>
<td>Добавляет исполняемый файл fsck и необходимые обработчики файловых систем. Если стоит после хука <b>autodetect</b>, то будут добавлены только обработчики для вашей корневой файловой системы. Использование этого хука настоятельно рекомендуется и <b>обязательно</b> с отдельным <code>/usr</code> разделом.</td>
<td>Запускает fsck для корневой файловой системы (и раздела <code>/usr</code>) до монтирования. Использование этого хука требует, чтобы rw передавался в параметрах ядра (<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1307895#p1307895">discussion</a>).
</td>
</tr>
<tr>
<td colspan="2" style="text-align: center;"><b>filesystems</b></td>
<td>Включает в образ модули необходимых файловых систем. Этот хук <b>обязателен</b>, если Вы не указываете модули файловых систем в  MODULES.</td>
<td>--
</td>
</tr>
</tbody>
</table>
<h3><span class="mw-headline" id="COMPRESSION">COMPRESSION</span></h3>
<p>Ядро поддерживает несколько форматов для сжатия initramfs - <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, lzma, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> (также известный как lzma2), <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzo">lzo</a></span> , И <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lz4">lz4</a></span>. Для большинства случаев использования gzip, lzop и lz4 обеспечивают наилучший баланс размера сжатого образа и скорости декомпрессии. Стандартный <code> mkinitcpio.conf</code> имеет различные опции <code> COMPRESSION</code>. Раскомментируйте один, чтобы выбрать необходимый формат сжатия.
</p>
<p>Отсутствие параметра <code> COMPRESSION</code> приведет к файлу initramfs с сжатием gzip. Чтобы создать несжатый образ, укажите <code>COMPRESSION = cat</code> в конфигурации или используйте <code> -z cat</code> в командной строке.
</p>
<p>Убедитесь, что для метода, который вы хотите использовать, установлена ​​правильная утилита сжатия файлов.
</p>
<h3><span class="mw-headline" id="COMPRESSION_OPTIONS">COMPRESSION_OPTIONS</span></h3>
<p>Это дополнительные флаги, переданные программе, указанной <code> COMPRESSION</code>, например:
</p>
<pre>COMPRESSION_OPTIONS = '- 9'
</pre>
<p>В общем, они никогда не понадобятся, поскольку mkinitcpio будет следить за тем, чтобы любой поддерживаемый метод сжатия имел необходимые флаги для создания рабочего образа. Кроме того, неправильное использование этого параметра может привести к не загружаемой системе, если ядро ​​не сможет распаковать результирующий архив.
</p>
<h2>
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F_.D1.81.D1.82.D1.80.D0.BE.D0.BA.D0.B8_.D0.BF.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.BE.D0.B2_.D1.8F.D0.B4.D1.80.D0.B0"></span><span class="mw-headline" id="Изменения_строки_параметров_ядра">Изменения строки параметров ядра</span>
</h2>
<p>Не зависимо от наличия initramfs некоторые опции приходится передавать через строку параметров ядра, как например корневое устройство. Некоторые из обработчиков  mkinitcpio имеют специальные опции. Они и обсуждаются в этой главе.
</p>
<p>Если вы не знаете, что такое строка параметров ядра, читайте документацию по <a href="../en/GRUB.html" title="GRUB">GRUB</a> или <a href="../en/LILO.html" title="LILO">LILO</a>.
</p>
<h3>
<span id=".D0.92.D1.85.D0.BE.D0.B4_.D0.B2_.D0.B1.D0.B5.D0.B7.D0.BE.D1.82.D0.BA.D0.B0.D0.B7.D0.BD.D1.8B.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC"></span><span class="mw-headline" id="Вход_в_безотказный_режим">Вход в безотказный режим</span>
</h3>
<p>Если Вы добавите опцию
</p>
<pre>break=y
</pre>
<p>в строку параметров ядра, то init остановится после инициализации и вы получите <i>dash</i> шелл. Это может быть использовано, чтобы проверить, что все хорошо. После выхода загрузка продолжится в обычном режиме.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.80.D0.B5.D1.82_.D0.BE.D0.B1.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.87.D0.B8.D0.BA.D0.BE.D0.B2"></span><span class="mw-headline" id="Запрет_обработчиков">Запрет обработчиков</span>
</h3>
<p>Вы можете запретить обработчики при помощи параметра <i>disablehooks</i> в строке параметров ядра:
</p>
<pre>disablehooks=hook1,hook2,hook2
</pre>
<p>например,
</p>
<pre>disablehooks=resume
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.80.D0.B5.D1.82_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8_.D0.BC.D0.BE.D0.B4.D1.83.D0.BB.D0.B5.D0.B9"></span><span class="mw-headline" id="Запрет_загрузки_модулей">Запрет загрузки модулей</span>
</h3>
<p>Вы можете запретить загрузку некоторых модулей добавив параметр <i>disablemodules</i> в строку параметров ядра:
</p>
<pre>disablemodules=mod1,mod2,mod3
</pre>
<p>например,
</p>
<pre>disablemodules=ata_piix
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_raid"></span><span class="mw-headline" id="Использование_raid">Использование raid</span>
</h3>
<p>Добавьте обработчик raid в список HOOKS в /etc/mkinitcpio.conf
</p>
<p><b>Параметры ядра: </b>
Укажите md массивы с помощью: md= parameter: (см. ниже).
Простого добавления вашего raid массива достаточно.
</p>
<pre> Пример: md=0,/dev/sda3,/dev/sda4 md=1,/dev/hda1,/dev/hdb1
</pre>
<p>Затем добавьте следующее в строку kernel в <b>grub/menu.lst</b>:
</p>
<pre> Пример: md=0,/dev/sda3,/dev/sda4 md=1,/dev/hda1,/dev/hdb1
</pre>
<p>Т.е. это будет выглядеть так:
</p>
<pre> kernel /vmlinuz26beyond root=/dev/md0 ro md=0,/dev/sda1,/dev/sdb1
</pre>
<p>Эта строка создает два md массива с постоянными суперблоками
</p>
<p><b>Настройка:</b>
</p>
<pre> - для старых raid массивов без постоянных суперблоков:
    md=&lt;номер устройства md&gt;,&lt;уровень raid&gt;,&lt;chunk size factor&gt;,&lt;fault level&gt;,dev0,dev1
 - для raid массивом с постоянными суперблоками:
    md=&lt;номер устройства md&gt;,dev0,dev1,...,devn
 - для сборки partitionable массивов:
    md=d&lt;md device no.&gt;,dev0,dev1,...,devn
</pre>
<p><b>Параметры:</b>
</p>
<pre> - &lt;номер устройства md&gt; = номер устройства:
    0 значит md0, 1 значит md1, ...
 - &lt;уровень raid&gt; = -1 линейный режим, 0 striped режим
    другие режимы поддерживаются только с постоянным суперблоком
 - &lt;chunk size factor&gt; = (только для raid-0 и raid-1):
    Установить chunk size as 4k &lt;&lt; n.
 - &lt;fault level&gt; = игнорируется
 - &lt;dev0-devn&gt;: т.е. /dev/hda1,/dev/hdc1,/dev/sda1,/dev/sdb1
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_net"></span><span class="mw-headline" id="Использование_net">Использование net</span>
</h3>
<p><b>Параметры ядра:</b> 
</p>
<p><b>ip=</b> 
</p>
<p>Описание интерфейса может быть в короткой форме, которая состоит просто из имени интерфейса (eth0 или какой либо еще), или в длинной форме. Длинная форма содержит семь элементов, разделенных двоеточием:
</p>
<pre> ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;
 nfsaddrs= это алиас для ip= и может использоваться также.
</pre>
<p><i>Разъяснение параметров:</i>
</p>
<pre> &lt;client-ip&gt;   IP адрес клиента. Если пустой, то автоматически назначается
               протоколом RARP/BOOTP/DHCP. Какой протокол используется
               зависит от параметра &lt;autoconf&gt;. Если его значение не пустое,
               то autocnf работает корректно.
 
 &lt;server-ip&gt;   IP адрес NFS сервера. Если используется RARP для определения
               адреса клиента и этот параметр не пуст, то принимаются ответы
               только от указанного сервера.
               Для использования разных RARP и NFS серверов,
               укажите ваш RARP сервер здесь (или оставьте пустым), и
               укажите ваш NFS сервер в параметре `nfsroot'
               (см. выше). Если тут пусто, будет использован сервер, ответивший
               на RARP/BOOTP/DHCP запрос.
 
 &lt;gw-ip&gt;       IP адрес шлюза если сервер в другой подсети. Если тут пусто,
               предполагается, что сервер находится в одной подсети, если значение
               не получено по BOOTP/DHCP.
 
 &lt;netmask&gt;     Маска подсети для локального интерфейса. Если тут пусто,
               используется маска по умолчанию в зависимости от класса IP,
               если конечно не переопределена значением из BOOTP/DHCP ответа.
 
 &lt;hostname&gt;    Имя машины клиента. Если пусто, используется IP адрес в виде ASCII
               строки, или значение полученное по BOOTP/DHCP.
 
 &lt;device&gt;      Имя сетевого устройства. Если тут пусто, все устройства будут использованы
               для RARP/BOOTP/DHCP запросов, и все настройки будут получены из первого
               пришедшего ответа. Если вы имеете только одно сетевое устройство, можно спокойно
               оставить поле пустым.
 
 &lt;autoconf&gt;	Какой метод использовать для автонастройки: 'rarp', 'bootp', или 'dhcp'.
               Если значение 'both', 'all' или пусто, все протоколы будут использованы.
               'off', 'static' или 'none' означают запрет автонастройки.
</pre>
<p><i>Примеры:</i>
</p>
<pre> ip=127.0.0.1:::::lo:none  --&gt; Разрешить lo интерфейс.
 ip=192.168.1.1:::::eth2:none --&gt; Статический eth2 интерфейс.
 ip=:::::eth0:dhcp --&gt; Разрешить dhcp протокол для настройки интерфейса eth0.
</pre>
<p><b>nfsroot=</b>
</p>
<p>Если параметр 'nfsroot' НЕ передан, будет использовано значение по умолчанию "/tftpboot/%s".
</p>
<pre> nfsroot=[&lt;server-ip&gt;:]&lt;root-dir&gt;[,&lt;nfs-options&gt;]
</pre>
<p><i>Описание параметров:</i>
</p>
<pre> &lt;server-ip&gt;   IP адрес NFS сервера. Если параметр отсутствует
               адрес по умолчанию определяется по переменной
               `ip' (см. ниже). Одно из применений этого параметра -
               использование разных серверов для 
               RARP и NFS. Обычно можете оставить этот параметр пустым.
 
 &lt;root-dir&gt;    Путь к директории, которая будет корневой на клиенте. Если тут
               написано "%s", то оно будет заменено на ASCII представление IP
               клиента.
 
 &lt;nfs-options&gt; Стандартные опции NFS. Все опции разделены запятыми.
               Если опция отсутствует будут использованы следующие значения по умолчанию:
                       port            = как скажет portmap демон на сервере
                       rsize           = 1024
                       wsize           = 1024
                       timeo           = 7
                       retrans         = 3
                       acregmin        = 3
                       acregmax        = 60
                       acdirmin        = 30
                       acdirmax        = 60
                       flags           = hard, nointr, noposix, cto, ac
</pre>
<p><b>root=/dev/nfs</b>
</p>
<pre> Если вы не используете параметр nfsroot=, вам нужно установить root=/dev/nfs 
 для загрузки с автонастройкой корня в nfs.
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_lvm"></span><span class="mw-headline" id="Использование_lvm">Использование lvm</span>
</h3>
<p>Если ваш корень находится на lvm, вы должны добавить обработчик <b>lvm2</b>. Также, вы должны передать имя корневого устройства ядру в формате
</p>
<pre>root=/dev/mapper/&lt;имя-группы-томов&gt;-&lt;логическое-имя-тома&gt;
</pre>
<p>например
</p>
<pre>root=/dev/mapper/myvg-root
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.BD.D0.B0_.D0.BA.D0.BE.D1.80.D0.BD.D0.B5.D0.B2.D0.BE.D0.BC_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.B5"></span><span class="mw-headline" id="Использование_шифрования_на_корневом_разделе">Использование шифрования на корневом разделе</span>
</h3>
<p>Если ваш корневой раздел зашифрован, вы должны добавить обработчик <b>encrypt</b>. Затем укажите ядру корневой раздел также, как если бы он не был зашифрован.
</p>
<p>Например для sata/scsi:
</p>
<pre>root=/dev/sda5
</pre>
<p>или для зашифрованного lvm:
</p>
<pre>root=/dev/mapper/myvg-root
</pre>
<p>Корневое устройство автоматически поменяется на <i>/dev/mapper/root</i>.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_LUKS_.D1.82.D0.BE.D0.BC.D0.BE.D0.B2"></span><span class="mw-headline" id="Использование_LUKS_томов">Использование LUKS томов</span>
</h4>
<p>Если вы используете LUKS для шифрования дисков, скрипт инициализации поймет это автоматически, если вы указали обработчик <b>encrypt</b>. Он спросит пароль для разблокирования тома.
</p>
<p>Если этого не происходит, попробуйте добавить filesystem-module в список модулей в фале /etc/mkinitcpio.conf если он не вкомпилирован в ядро.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_legacy_cryptsetup_.D1.82.D0.BE.D0.BC.D0.BE.D0.B2"></span><span class="mw-headline" id="Использование_legacy_cryptsetup_томов">Использование legacy cryptsetup томов</span>
</h4>
<p>Если вы используете legacy cryptsetup том, вы должны указать все опции, необходимые для его разблокировки в строке параметров ядра. Опции формата
</p>
<pre>crypto=hash:cipher:keysize:offset:skip
</pre>
<p>представляют опции cryptsetup: --hash, --cipher, --keysize, --offset и --skip. Если вы пропустите опцию, будет использовано значение по умолчанию, т.е. вы можете написать просто
</p>
<pre>crypto=::::
</pre>
<p>если вы создали том с настройками по умолчанию.
</p>
<p><b>ЗАМЕЧАНИЕ:</b> По техническим причинам невозможно проверить корректность пароля для legacy cryptsetup тома. Если вы ошибетесь, у вас просто не получится его смонтировать. Рекомендуется использовать LUKS вместо legacy cryptsetup.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_loop-aes_.D1.82.D0.BE.D0.BC.D0.BE.D0.B2"></span><span class="mw-headline" id="Использование_loop-aes_томов">Использование loop-aes томов</span>
</h4>
<p><b>mkinitcpio</b> пока не поддерживает loop-aes.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Extracting_the_image">Extracting the image</span></h3>
<p>If you are curious about what is inside the initrd image, you can extract it and poke at the files inside of it. 
</p>
<p>The initrd image is an SVR4 CPIO archive, generated via the <code>find</code> and <code>bsdcpio</code> commands, optionally compressed with a compression scheme understood by the kernel. For more information on the compression schemes, see <a href="#COMPRESSION">#COMPRESSION</a>.
</p>
<p>mkinitcpio includes a utility called <code>lsinitcpio</code> which will list and extract the contents of initramfs images.
</p>
<p>You can list the files in the image with:
</p>
<pre>$ lsinitcpio /boot/initramfs-linux.img
</pre>
<p>And to extract them all in the current directory:
</p>
<pre>$ lsinitcpio -x /boot/initramfs-linux.img
</pre>
<p>You can also get a more human-friendly listing of the important parts in the image:
</p>
<pre>$ lsinitcpio -a /boot/initramfs-linux.img
</pre>
<h3><span class="mw-headline" id="Recompressing_a_modified_extracted_image">Recompressing a modified extracted image</span></h3>
<p>After extracting an image as explained above, after modifying it, you can find the command necessary to recompress it.  Edit <code>/usr/bin/mkinitcpio</code> and change the line as shown below (line 531 in mkinitcpio v20-1.)
</p>
<pre>#MKINITCPIO_PROCESS_PRESET=1 "$0" "${preset_cmd[@]}"
MKINITCPIO_PROCESS_PRESET=1 /usr/bin/bash -x "$0" "${preset_cmd[@]}"
</pre>
<p>Then running <code>mkinitcpio</code> with its usual options (typically <code>mkinitcpio -p linux</code>), toward the last 20 lines or so you will see something like:
</p>
<pre>+ find -mindepth 1 -printf '%P\0'
+ LANG=C
+ bsdcpio -0 -o -H newc --quiet
+ gzip
</pre>
<p>Which corresponds to the command you need to run, which may be:
</p>
<pre># find -mindepth 1 -printf '%P\0' | LANG=C bsdcpio -0 -o -H newc --quiet | gzip &gt; /boot/initramfs-linux.img
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is a good idea to rename the automatically generated /boot/initramfs-linux.img before you overwrite it, so you can easily undo your changes.  Be prepared for making a mistake that prevents your system from booting.  If this happens, you will need to boot through the fallback, or a boot CD, to restore your original, run mkinitcpio to overwrite your changes, or fix them yourself and recompress the image.</div>
<h3>
<span id=".22.2Fdev_must_be_mounted.22_when_it_already_is"></span><span class="mw-headline" id='"/dev_must_be_mounted"_when_it_already_is'>"/dev must be mounted" when it already is</span>
</h3>
<p>The test used by mkinitcpio to determine if /dev is mounted is to see if /dev/fd/ is there. If everything else looks fine, it can be "created" manually by:
</p>
<pre># ln -s /proc/self/fd /dev/
</pre>
<p>(Obviously, /proc must be mounted as well. mkinitcpio requires that anyway, and that is the next thing it will check.)
</p>
<h3>
<span id="Using_systemd_HOOKS_in_a_LUKS.2FLVM.2Fresume_setup"></span><span class="mw-headline" id="Using_systemd_HOOKS_in_a_LUKS/LVM/resume_setup">Using systemd HOOKS in a LUKS/LVM/resume setup</span>
</h3>
<p>Using <code>systemd</code>/<code>sd-encrypt</code>/<code>sd-lvm2</code> <b>HOOKS</b> instead of the traditional <code>encrypt</code>/<code>lvm2</code>/<code>resume</code> requires different initrd parameters to be passed by your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>. See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1480241">this post on forum</a> for details.
</p>
<h3><span class="mw-headline" id="Possibly_missing_firmware_for_module_XXXX">Possibly missing firmware for module XXXX</span></h3>
<p>When initramfs are being rebuild after a kernel update, you might get these two warnings:
</p>
<pre>==&gt; WARNING: Possibly missing firmware for module: aic94xx
==&gt; WARNING: Possibly missing firmware for module: smsmdtv 
</pre>
<p>These appear to any Arch Linux users, especially those who have not installed these firmware modules. If you do not use hardware which uses these firmwares you can safely ignore this message.
</p>
<h3><span class="mw-headline" id="mkinitcpio_creates_images_with_all_the_shared_libraries_missing">mkinitcpio creates images with all the shared libraries missing</span></h3>
<p>If your machine fails to boot with an "Attempted to kill init!" kernel panic right off the bat (before any <code>init</code> or <code>systemd</code>-related messages appear on the screen), and running <code>lsinitcpio</code> reveals that all the shared libraries are missing from the images generated in <code>/boot</code>, make sure there is a symbolic link at <code>/usr/lib64</code> pointing to <code>/usr/lib</code>, and rebuild them all. 
</p>
<h3><span class="mw-headline" id="Standard_rescue_procedures">Standard rescue procedures</span></h3>
<p>With an improper initial ram-disk a system often is unbootable. So follow a system rescue procedure like below:
</p>
<h4>
<span id=".D0.97.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B0_.D0.B2.D1.8B.D0.BF.D0.BE.D0.BB.D0.BD.D1.8F.D0.B5.D1.82.D1.81.D1.8F_.D0.BD.D0.B0_.D0.BE.D0.B4.D0.BD.D0.BE.D0.B9_.D0.BC.D0.B0.D1.88.D0.B8.D0.BD.D0.B5_.D0.B8_.D1.82.D0.B5.D1.80.D0.BF.D0.B8.D1.82_.D0.BD.D0.B5.D1.83.D0.B4.D0.B0.D1.87.D1.83_.D0.BD.D0.B0_.D0.B4.D1.80.D1.83.D0.B3.D0.BE.D0.B9"></span><span class="mw-headline" id="Загрузка_выполняется_на_одной_машине_и_терпит_неудачу_на_другой">Загрузка выполняется на одной машине и терпит неудачу на другой</span>
</h4>
<p><code>autodetect</code> hook скрипта <i>mkinitcpio</i> фильтрует ненужные <a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">kernel modules</a> в первичном initramfs путем сканирования /sys и модулей, загруженных во время запуска. Если вы переносите /boot каталог на другую машину и последовательность загрузки терпит неудачу на стадии early userspace, то это может проиходить, потому что новое аппаратное обеспечение не определено отсутствующими модулями ядра. Обратите внимание, что для USB 2.0 и 3.0 нужны разные модули ядра. 
</p>
<p>Чтобы исправить, сначала попробуйтей выбрать fallback образ в вашем <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Загрузчик">загрузчике</a>, поскольку он не фильтруется с помощью <code>autodetect</code>. После загрузки выполните <i>mkinitcpio</i> на новой машине, чтобы пересобрать первичный образ с корректными модулями. Если fallback образ не решил проблему, пропробуйте загрузиться в Arch Linux live CD/USB, выполнить chroot в установленную систему и выполнить <i>mkinitcpio</i> на новой машине. В крайнем случае, попробуйте <a href="#MODULES">вручную</a> добавить модули в initramfs.
</p>
<h2>
<span id=".D0.AF_.D0.BF.D0.B0.D1.80.D0.B0.D0.BD.D0.BE.D0.B8.D0.BA.21"></span><span class="mw-headline" id="Я_параноик!">Я параноик!</span>
</h2>
<p>Если вам действительно нужно знать, что включено в initrd, вы можете вытаскивать и класть внутрь образа файлы. Это просто cpio архив, но...
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B5.D0.B4.D1.83.D0.BF.D1.80.D0.B5.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE_cpio"></span><span class="mw-headline" id="Предупреждение_о_cpio">Предупреждение о cpio</span>
</h3>
<p>Использование cpio для извлечения опасно (от root'а), так как оно пытается извлечь файлы в /, ломая существующую систему загрузки. Для исправления, вам придется переставить все пакеты, файлы которых были перезаписаны с помощью pacman.static. Список файлов выдаст команда bsdtar -t -f kernel26.img
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_bsdtar_.D0.B4.D0.BB.D1.8F_.D0.B8.D0.B7.D0.B2.D0.BB.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Использование_bsdtar_для_извлечения">Использование bsdtar для извлечения</span>
</h3>
<p>bsdtar извлекает файлы в текущий каталог.
</p>
<p>Используйте команду:
</p>
<pre> bsdtar -x -f /boot/kernel26.img
</pre>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Boot_process.html" title="Category:Boot process (Русский)">Boot process (Русский)</a></li>
<li><a href="../ru/Category:Kernel.html" title="Category:Kernel (Русский)">Kernel (Русский)</a></li>
<li><a href="../ru/Category:Arch_projects.html" title="Category:Arch projects (Русский)">Arch projects (Русский)</a></li>
<li><a href="../ru/Category:Commands.html" title="Category:Commands (Русский)">Commands (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Mkinitcpio_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=645096">https://wiki.archlinux.org/index.php?title=Mkinitcpio_(Русский)&amp;oldid=645096</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 13 December 2020, at 14:01.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
