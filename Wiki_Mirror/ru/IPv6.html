<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>IPv6 (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-IPv6_Русский rootpage-IPv6_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">IPv6 (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="/title/IPv6_tunnel_broker_setup" title="IPv6 tunnel broker setup">IPv6 tunnel broker setup</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="/title/IPv6" title="IPv6">IPv6</a>. Дата последней синхронизации: 9 мая 2021. Вы можете <a href="/title/ArchWiki:Translation_Team_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=IPv6&amp;diff=0&amp;oldid=654164">изменения</a>.</div>
<p>В Arch Linux протокол <a href="https://en.wikipedia.org/wiki/ru:IPv6" class="extiw" title="wikipedia:ru:IPv6">IPv6</a> включён по умолчанию.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%9E%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BE%D1%81%D0%B5%D0%B4%D0%B5%D0%B9"><span class="tocnumber">1</span> <span class="toctext">Обнаружение соседей</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F_%D1%83%D0%B7%D0%BB%D0%B0_(SLAAC)"><span class="tocnumber">2</span> <span class="toctext">Автоконфигурация узла (SLAAC)</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82"><span class="tocnumber">2.1</span> <span class="toctext">Клиент</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%D0%A8%D0%BB%D1%8E%D0%B7"><span class="tocnumber">2.2</span> <span class="toctext">Шлюз</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#Privacy_Extensions"><span class="tocnumber">3</span> <span class="toctext">Privacy Extensions</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#dhcpcd"><span class="tocnumber">3.1</span> <span class="toctext">dhcpcd</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#NetworkManager"><span class="tocnumber">3.2</span> <span class="toctext">NetworkManager</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#systemd-networkd"><span class="tocnumber">3.3</span> <span class="toctext">systemd-networkd</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#connman"><span class="tocnumber">3.4</span> <span class="toctext">connman</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10">
<a href="#%D0%9F%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BF%D1%80%D0%B8%D0%B2%D0%B0%D1%82%D0%BD%D1%8B%D0%B9_%D0%B0%D0%B4%D1%80%D0%B5%D1%81"><span class="tocnumber">4</span> <span class="toctext">Постоянный приватный адрес</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#NetworkManager_2"><span class="tocnumber">4.1</span> <span class="toctext">NetworkManager</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B0%D0%B4%D1%80%D0%B5%D1%81"><span class="tocnumber">5</span> <span class="toctext">Статический адрес</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#IPv6_%D0%B8_PPPoE"><span class="tocnumber">6</span> <span class="toctext">IPv6 и PPPoE</span></a></li>
<li class="toclevel-1 tocsection-14">
<a href="#%D0%94%D0%B5%D0%BB%D0%B5%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B5%D1%84%D0%B8%D0%BA%D1%81%D0%B0_(DHCPv6-PD)"><span class="tocnumber">7</span> <span class="toctext">Делегирование префикса (DHCPv6-PD)</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#dhcpcd_2"><span class="tocnumber">7.1</span> <span class="toctext">dhcpcd</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#WIDE-DHCPv6"><span class="tocnumber">7.2</span> <span class="toctext">WIDE-DHCPv6</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#systemd-networkd_2"><span class="tocnumber">7.3</span> <span class="toctext">systemd-networkd</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%8B"><span class="tocnumber">7.4</span> <span class="toctext">Другие клиенты</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-19">
<a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_IPv6"><span class="tocnumber">8</span> <span class="toctext">Отключение IPv6</span></a>
<ul>
<li class="toclevel-2 tocsection-20"><a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8"><span class="tocnumber">8.1</span> <span class="toctext">Отключение функциональности</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B"><span class="tocnumber">8.2</span> <span class="toctext">Другие программы</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#dhcpcd_3"><span class="tocnumber">8.2.1</span> <span class="toctext">dhcpcd</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#NetworkManager_3"><span class="tocnumber">8.2.2</span> <span class="toctext">NetworkManager</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#ntpd"><span class="tocnumber">8.2.3</span> <span class="toctext">ntpd</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#GnuPG"><span class="tocnumber">8.2.4</span> <span class="toctext">GnuPG</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#sshd"><span class="tocnumber">8.2.5</span> <span class="toctext">sshd</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27"><a href="#systemd-networkd_3"><span class="tocnumber">8.3</span> <span class="toctext">systemd-networkd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_IPv4_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%BE_IPv6"><span class="tocnumber">9</span> <span class="toctext">Использование IPv4 вместо IPv6</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">10</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.9E.D0.B1.D0.BD.D0.B0.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D0.BE.D1.81.D0.B5.D0.B4.D0.B5.D0.B9"></span><span class="mw-headline" id="Обнаружение_соседей">Обнаружение соседей</span>
</h2>
<p>Пинг по адресу многоадресной рассылки <code>ff02::1</code> заставит все хосты в локальной сети ответить. При этом нужно указать сетевой интерфейс:
</p>
<pre>$ ping ff02::1%eth0
</pre>
<p>После этого список "соседей" по локальной сети можно вывести командой
</p>
<pre>$ ip -6 neigh
</pre>
<p>Аналогично, если сделать пинг по адресу <code>ff02::2</code>, то ответят только маршрутизаторы локальной сети.
</p>
<p>Если добавить опцию <code>-I <i>ваш-глобальный-ipv6</i></code> в пинг-запрос, хосты локальной сети ответят с использованием глобальных адресов. В этом случае сетевой интерфейс можно не указывать:
</p>
<pre>$ ping -I 2001:4f8:fff6::21 ff02::1
</pre>
<h2>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.D1.83.D0.B7.D0.BB.D0.B0_.28SLAAC.29"></span><span class="mw-headline" id="Автоконфигурация_узла_(SLAAC)">Автоконфигурация узла (SLAAC)</span>
</h2>
<p>Простейший способ получения IPv6-адреса в уже настроенной сети — автоконфигурация узла (SLAAC, Stateless address autoconfiguration). При этом адрес автоматически вычисляется на основании объявленного маршрутизатором префикса сети. Никакие дальнейшие настройки или использование специализированного ПО вроде DHCP-клиента не требуются.
</p>
<h3>
<span id=".D0.9A.D0.BB.D0.B8.D0.B5.D0.BD.D1.82"></span><span class="mw-headline" id="Клиент">Клиент</span>
</h3>
<p>Если вы используете <a href="/title/Netctl_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" class="mw-redirect" title="Netctl (Русский)">netctl</a>, то нужно только добавить одну строку в файл настроек вашей проводной или беспроводной сети.
</p>
<pre>IP6=stateless
</pre>
<p>Если вы используете <a href="/title/NetworkManager_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" class="mw-redirect" title="NetworkManager (Русский)">NetworkManager</a>, то он автоматически включит использование IPv6-адресов, если таковые объявлены в сети.
</p>
<p>Нужно также заметить, что для нормальной работы автоконфигурации должны быть разрешены пакеты ICMP для IPv6. Поэтому необходимо добавить разрешения для пакетов <code>ipv6-icmp</code> в настройки межсетевого экрана. Если вы используете <a href="/title/Simple_stateful_firewall_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Simple stateful firewall (Русский)">брандмауэр</a> на основе <a href="/title/Iptables_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Iptables (Русский)">iptables</a>, то добавьте следующее правило:
</p>
<pre>-A INPUT -p ipv6-icmp -j ACCEPT
</pre>
<p>Если вы используете другой интерфейс межсетевого экрана (ufw, shorewall и т.д.), то инструкции по разрешению пакетов <code>ipv6-icmp</code> нужно искать в документации.
</p>
<p>Если вы выбрали сетевой менеджер, который не поддерживает разрешение DNS с бесконтекстным (stateless) IPv6 (например, netctl), то для этох целей можно воспользоваться демоном  <span class="plainlinks archwiki-template-man" title="$ man 8 rdnssd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/rdnssd.8">rdnssd(8)</a></span> из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ndisc6">ndisc6</a></span>.
</p>
<h3>
<span id=".D0.A8.D0.BB.D1.8E.D0.B7"></span><span class="mw-headline" id="Шлюз">Шлюз</span>
</h3>
<p>Чтобы соответствующим образом работать с адресами IPv6 клиентских устройств вашей сети, нужно настроить демон объявлений (advertisement daemon). Для этой задачи используется входящий в <a href="/title/%D0%9E%D1%84%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B8" class="mw-redirect" title="Официальные репозитории">официальные репозитории</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=radvd">radvd</a></span>. Настройка <i>radvd</i> довольно проста. Добавьте следующие строки в файл <code>/etc/radvd.conf</code>, заменив <code>LAN</code> на название вашего сетевого интерфейса:
</p>
<pre>interface LAN {
  AdvSendAdvert on;
  MinRtrAdvInterval 3;
  MaxRtrAdvInterval 10;
  prefix ::/64 {
    AdvOnLink on;
    AdvAutonomous on;
    AdvRouterAddr on;
  };
};
</pre>
<p>Такая настройка скажет клиентам выбрать адреса из объявленного блока <code>/64</code>. Обратите внимание, что эта настройка объявляет <i>все доступные префиксы</i>, привязанные к сетевому интерфейсу. Если вы хотите указать конкретные префиксы, то замените <code>::/64</code> на необходимый, например, <code>2001:DB8::/64</code>. Блок настроек <code>prefix</code> нужно повторить для каждого указанного префикса.
</p>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Какой смысл объявлять DNS-сервер, находящийся за пределами локальной сети? (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:IPv6_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Talk:IPv6 (Русский)#</a>)</div>
</div>
<p>Чтобы объявить DNS-сервера клиентам вашей локальной сети, можно использовать предлагаемую протоколом обнаружения соседей <a href="https://en.wikipedia.org/wiki/ru:%D0%9F%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB_%D0%BE%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%BE%D1%81%D0%B5%D0%B4%D0%B5%D0%B9#.D0.A2.D0.B5.D1.85.D0.BD.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.B4.D0.B5.D1.82.D0.B0.D0.BB.D0.B8" class="extiw" title="wikipedia:ru:Протокол обнаружения соседей">функциональность RDNSS</a>. Например, добавьте следующие строки к файлу <code>/etc/radvd.conf</code>, чтобы объявить DNSv6-сервер Google:
</p>
<pre>RDNSS 2001:4860:4860::8888 2001:4860:4860::8844 {
};
</pre>
<p>Шлюз должен также разрешать трафик <code>ipv6-icmp</code> во всех основных цепочках межсетевого экрана. Для <a href="/title/Simple_stateful_firewall_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Simple stateful firewall (Русский)">брэндмауэра</a>/<a href="/title/Iptables_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Iptables (Русский)">iptables</a> добавьте правила:
</p>
<pre>-A INPUT -p ipv6-icmp -j ACCEPT
-A OUTPUT -p ipv6-icmp -j ACCEPT
-A FORWARD -p ipv6-icmp -j ACCEPT
</pre>
<p>Для других интерфейсов межсетевого экрана выполните аналогичные настройки и в конце не забудьте <a href="/title/%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C" class="mw-redirect" title="Включить">включить</a> <code>radvd.service</code>.
</p>
<h2><span class="mw-headline" id="Privacy_Extensions">Privacy Extensions</span></h2>
<p>Когда устройство-клиент получает адрес посредством SLAAC, его IPv6-адрес вычисляется на основании префикса сети и MAC-адреса сетевого интерфейса. Это может иметь определённые последствия с точки зрения безопасности, поскольку MAC-адрес компьютера теперь можно узнать по IPv6-адресу. Для решения этой проблемы был разработан стандарт <i>IPv6 Privacy Extensions</i> (<a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc4941">RFC 4941</a>). В соответствии с ним ядро видоизменяет исходный адрес, генерируя вместо него временный. Такой подход используется, когда необходимо скрыть настоящий адрес при подключении к удалённому серверу.
</p>
<p>Чтобы включить Privacy Extensions, добавьте в файл <code>/etc/sysctl.d/40-ipv6.conf</code> следующие строки:
</p>
<pre># Enable IPv6 Privacy Extensions
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.default.use_tempaddr = 2
net.ipv6.conf.<i>nic0</i>.use_tempaddr = 2
...
net.ipv6.conf.<i>nicN</i>.use_tempaddr = 2
</pre>
<p>Здесь <code>nic0</code>...<code>nicN</code> — названия сетевых интерфейсов. В статье <a href="/title/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%81%D0%B5%D1%82%D0%B8#%D0%9E%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D1%85_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%BE%D0%B2" class="mw-redirect" title="Настройка сети">Настройка сети#Обнаружение сетевых интерфейсов</a> описано, как узнать имена сетевых интерфейсов на вашей машине. Параметры <code>all.use_tempaddr</code> и <code>default.use_tempaddr</code> не будут применены к сетевым интерфейсам, которые уже определены в системе на момент выполнения файла настроек <a href="/title/Sysctl" title="Sysctl">sysctl</a>.
</p>
<p>После перезагрузки Privacy Extensions будут включены.
</p>
<h3><span class="mw-headline" id="dhcpcd">dhcpcd</span></h3>
<p>Начиная с версии 6.4.0 в <a href="/title/Dhcpcd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Dhcpcd (Русский)">dhcpcd</a> добавлена опция <code>slaac private</code>, которая включает функцию присвоения стабильных приватных адресов вместо адресов, основанных на MAC-адресе интерфейса, в соответствии <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc7217">RFC 7217</a>. Дополнительная настройка не требуется, если, конечно, вы не хотите изменять адрес IPv6 при каждом новом подключении к сети. Если назначить опцию <code>slaac hwaddr</code>, то адреса будут назначаться исходя из MAC-адреса интерфейса.
</p>
<h3><span class="mw-headline" id="NetworkManager">NetworkManager</span></h3>
<p><a href="/title/NetworkManager" title="NetworkManager">NetworkManager</a> использует IPv6 Privacy Extensions в соответствии с настройкой <code>ipv6.ip6-privacy</code> в файле <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5">NetworkManager.conf(5)</a></span> или в профиле соединения. Если параметр не задан ни глобально, ни для соединения, NetworkManager будет использовать <code>/proc/sys/net/ipv6/conf/default/use_tempaddr</code>.
</p>
<p>Чтобы включить IPv6 Privacy Extensions явно, добавьте следующие строки в файл <span class="plainlinks archwiki-template-man" title="$ man 5 NetworkManager.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/NetworkManager.conf.5">NetworkManager.conf(5)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/conf.d/ip6-privacy.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[connection]
ipv6.ip6-privacy=2</pre>
<p><a href="/title/NetworkManager#Configuration" title="NetworkManager">Примените настройки</a> и переподключитесь ко всем активным соединениям.
</p>
<p>Чтобы включить IPv6 Privacy Extensions для отдельных соединений под управлением NetworkManager, отредактируйте соответствующий нужному соединения файл в каталоге <code>/etc/NetworkManager/system-connections/</code>, добавив к разделу <code>[ipv6]</code> пару ключ-значение <code>ip6-privacy=2</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/system-connections/<i>соединение</i>.nmconnection</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[ipv6]
method=auto
<b>ip6-privacy=2</b>
...</pre>
<p>Перезагрузите соединение и подключитесь к нему снова.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Может показаться, что временный адрес IPv6, созданный при включении Privacy Extensions, никогда не обновляется (он не переходит в статус <code>deprecated</code> после истечения времени жизни <code>valid_lft</code>). На самом деле это не совсем так: через больший промежуток времени адрес всё же изменится.</div>
<h3><span class="mw-headline" id="systemd-networkd">systemd-networkd</span></h3>
<p>Systemd-networkd тоже не учитывает настройки <code>net.ipv6.conf.xxx.use_tempaddr</code> в файле <code>/etc/sysctl.d/40-ipv6.conf</code>, если оцпия <code>IPv6PrivacyExtensions</code> в файле <code>.network</code> не установлена в значение <code>kernel</code>.
</p>
<p>Тем не менее, учитываются некоторые другие опции:
</p>
<pre>net.ipv6.conf.xxx.temp_prefered_lft
net.ipv6.conf.xxx.temp_valid_lft
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <code>temp_prefered_lft</code> — корректное имя переменной, хотя допущена грамматическая ошибка (правильно preferred).</div>
<p>См. также <a href="/title/Systemd-networkd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Systemd-networkd (Русский)">systemd-networkd</a> и <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span>.
</p>
<h3><span class="mw-headline" id="connman">connman</span></h3>
<p>Добавьте следующую строку в файл службы (например, <code>/var/lib/connman/<i>название_службы</i>/settings</code>):
</p>
<pre>IPv6.privacy=preferred
</pre>
<p>Подробнее смотрите <a href="/title/ConnMan" title="ConnMan">ConnMan</a>.
</p>
<h2>
<span id=".D0.9F.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BF.D1.80.D0.B8.D0.B2.D0.B0.D1.82.D0.BD.D1.8B.D0.B9_.D0.B0.D0.B4.D1.80.D0.B5.D1.81"></span><span class="mw-headline" id="Постоянный_приватный_адрес">Постоянный приватный адрес</span>
</h2>
<p>Другой полезной возможностью являются описанные в <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc7217">RFC 7217</a> постоянные приватные IP-адреса (stable private addresses). Эта технология позволяет назначать интерфейсам постоянные адреса, для вычисления которых вместо MAC-адреса устройства используется специально сгенерированный ключ.
</p>
<p>Чтобы заставить ядро сгенерировать ключ (например, для интерфейса <code>wlan0</code>), необходимо задать <a href="/title/%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80_%D1%8F%D0%B4%D1%80%D0%B0" class="mw-redirect" title="Параметр ядра">параметр ядра</a>:
</p>
<pre># sysctl net.ipv6.conf.wlan0.addr_gen_mode=3
</pre>
<p>Выключив/включив интерфейс и выполнив <code>ip addr show dev wlan0</code> вы увидите флаг <code>stable-privacy</code> рядом с каждым адресом IPv6. Ядро должно было создать 128-битный ключ для генерирования адресов этого интерфейса. Чтобы увидеть сам ключ, выполните команду <code>sysctl net.ipv6.conf.wlan0.stable_secret</code>. Чтобы ключ сохранялся после перезагрузок и был постоянным, нужно добавить в файл <code>/etc/sysctl.d/40-ipv6.conf</code> следующие строки:
</p>
<pre># Enable IPv6 stable privacy mode
net.ipv6.conf.wlan0.stable_secret = <i>ключ</i>
net.ipv6.conf.wlan0.addr_gen_mode = 2
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если адрес IPv6 полчен от <a href="/title/Dhcpcd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Dhcpcd (Русский)">dhcpcd</a>, то флага <code>stable-privacy</code> у него не будет.</div>
<h3><span class="mw-headline" id="NetworkManager_2">NetworkManager</span></h3>
<p>Описанные выше настройки не работают для <a href="/title/NetworkManager_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" class="mw-redirect" title="NetworkManager (Русский)">NetworkManager</a>, но он использует постоянные приватные адреса по умолчанию <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/-/blob/nm-1-12/NEWS#L367-369">[1]</a>,<a rel="nofollow" class="external autonumber" href="https://bugzilla.redhat.com/show_bug.cgi?id=1279242#c15">[2]</a>.
</p>
<h2>
<span id=".D0.A1.D1.82.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B0.D0.B4.D1.80.D0.B5.D1.81"></span><span class="mw-headline" id="Статический_адрес">Статический адрес</span>
</h2>
<p>Иногда использование статического адреса может быть применено в качестве одной из мер обеспечения безопасности. Например, если ваш локальный маршрутизатор использует обнаружение соседей (Neighbor Discovery) или radvd (<a href="https://tools.ietf.org/html/rfc2461" class="extiw" title="rfc:2461">RFC 2461</a>), вашему интерфейсу будет автоматически присвоен адрес, который содержит часть MAC-адреса сетевого интерфейса (используя SLAAC). Это может быть не слишком хорошо для безопасности, так как позволяет без труда отслеживать систему даже если часть IPv6-адреса сменилась.
</p>
<p>Чтобы присвоить статический IP-адрес при помощи <a href="/title/Netctl_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" class="mw-redirect" title="Netctl (Русский)">netctl</a>, используйте шаблон профиля <code>/etc/netctl/examples/ethernet-static</code>. Следующие строки особенно важны:
</p>
<pre># For IPv6 static address configuration
IP6=static
Address6=('1234:5678:9abc:def::1/64' '1234:3456::123/96')
Routes6=('abcd::1234')
Gateway6='1234:0:123::abcd'
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы подключены к сети только посредстмов IPv6, то необходимо определить соответствующий DNS-сервер. Например:
<pre>DNS=('6666:6666::1' '6666:6666::2')
</pre>
Если ваш провайдер не предоставляет DNS для IPv6 и вы не хотите настраивать свой сервер, то можно выбрать его по рекомендациям в статье <a href="/title/%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D1%85_%D0%B8%D0%BC%D1%91%D0%BD" class="mw-redirect" title="Разрешение доменных имён">Разрешение доменных имён</a>.</div>
<h2>
<span id="IPv6_.D0.B8_PPPoE"></span><span class="mw-headline" id="IPv6_и_PPPoE">IPv6 и PPPoE</span>
</h2>
<p>Стандартный инструмент для <a href="https://en.wikipedia.org/wiki/ru:PPPoE" class="extiw" title="wikipedia:ru:PPPoE">PPPoE</a>, <code>pppd</code>, позволяет использовать IPv6 в PPPoE, если это поддерживается вашим провайдером и модемом. Добавьте одну строку в файл <code>/etc/ppp/options</code>:
</p>
<pre>+ipv6
</pre>
<p>Если вы используете <a href="/title/Netctl_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" class="mw-redirect" title="Netctl (Русский)">netctl</a> для PPPoE, тогда вместо этого добавьте следующую строку в файл настроек netctl:
</p>
<pre>PPPoEIP6=yes
</pre>
<h2>
<span id=".D0.94.D0.B5.D0.BB.D0.B5.D0.B3.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.B5.D1.84.D0.B8.D0.BA.D1.81.D0.B0_.28DHCPv6-PD.29"></span><span class="mw-headline" id="Делегирование_префикса_(DHCPv6-PD)">Делегирование префикса (DHCPv6-PD)</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> В этом разделе рассматривается настройка пользовательского шлюза, а не клиентских машин. Для стандартных маршрутизаторов, доступных на рынке, рекомендуется предварительно изучить документацию по включению функции делегирования префикса.</div>
<p>Делегирование префикса (prefix delegation) — широко распространённая технология развёртывания IPv6, используемая многими интернет-провайдерами. Представляет собой метод назначения сетевого префикса пользователю (например, локальной сети). Маршрутизатор может быть настроен на привязку разных сетевых префиксов к различным подсетям. Провайдер выдаёт префикс с помощью DHCPv6 (обычно это префикс <code>/56</code> или <code>/64</code>), а dhcp-клиент присваивает префиксы локальным сетям. В случае простого шлюза с двумя интерфейсами клиент обычно получает адрес через WAN-интерфейс (или псевдоинтерфейс вроде ppp) и на его основании присваивает IPv6-префикс интерфейсу локальной сети.
</p>
<p>Клиент DHCPv6 принимает входящие соединения на UDP-порт 546. Чтобы настроить доступ к этому порту в межсетевом экране <a href="/title/Nftables_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Nftables (Русский)">nftables</a>, в файле <code>/etc/nftables.conf</code> добавьте следующее правило в цепочку input:
</p>
<pre>table inet filter {
  chain input {
    udp dport dhcpv6-client accept
    ...
  }
...
}
</pre>
<h3><span class="mw-headline" id="dhcpcd_2">dhcpcd</span></h3>
<p><a href="/title/Dhcpcd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Dhcpcd (Русский)">dhcpcd</a> помимо поддержки dhcp для IPv4 также предлагает полноценную реализацию протокола DHCPv6 (включая DHCPv6-PD). Если вы используете <code>dhcpcd</code>, отредактируйте файл <code>/etc/dhcpcd.conf</code>. Скорее всего, вы уже используете dhcpcd для IPv4, поэтому просто обновите существующую конфигурацию.
</p>
<pre>duid
noipv6rs
waitip 6
# Uncomment this line if you are running dhcpcd for IPv6 only.
#ipv6only

# use the interface connected to WAN
interface WAN
ipv6rs
iaid 1
# use the interface connected to your LAN
ia_pd 1 LAN
#ia_pd 1/::/64 LAN/0/64
</pre>
<p>Эта конфигурация запросит префикс у WAN-интерфейса (<code>WAN</code>) и делегирует его внутреннему интерфейсу (<code>LAN</code>). Если вдруг с диапазоном <code>/64</code> возникнут проблемы, то нужно использовать вторую инструкцию <code>ia_pd</code>, которая в примере выше закомментирована. Кроме того, приведённая конфигурация также отключит вызовы маршрутизатора (router solicitation) для всех интерфейсов, кроме WAN.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> См. также <span class="plainlinks archwiki-template-man" title="$ man 8 dhcpcd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dhcpcd.8">dhcpcd(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 5 dhcpcd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dhcpcd.conf.5">dhcpcd.conf(5)</a></span>.</div>
<h3><span class="mw-headline" id="WIDE-DHCPv6">WIDE-DHCPv6</span></h3>
<p><a rel="nofollow" class="external text" href="http://wide-dhcpv6.sourceforge.net/">WIDE-DHCPv6</a> — свободная реализация протокола DHCP для IPv6 (DHCPv6), первоначально разработанная проектом KAME. <a href="/title/%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B5" class="mw-redirect" title="Установите">Установите</a> его с пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wide-dhcpv6/">wide-dhcpv6</a></span><sup><small>AUR</small></sup>.
</p>
<p>Если вы используете <code>wide-dhcpv6</code>, отредактируйте файл <code>/etc/wide-dhcpv6/dhcp6c.conf</code>, заменив <code>WAN</code> и <code>LAN</code> названиями соответвующих интерфейсов:
</p>
<pre># use the interface connected to your WAN
interface WAN {
  send ia-pd 0;
};
 
id-assoc pd 0 {
  # use the interface connected to your LAN
  prefix-interface LAN {
    sla-id 1;
    sla-len 8;
  };
};
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Параметр <code>sla-len</code> нужно назначить таким образом, чтобы выполнялась формула <code>(WAN-prefix) + (sla-len) = 64</code>. В нашем случае  для сети с префиксом <code>/56</code> формула примет вид 56+8=64. Для префикса <code>/64</code> <code>sla-len</code> будет равен <code>0</code>.</div>
<p>Клиент wide-dhcpv6  можно <a href="/title/%D0%97%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D1%8C" class="mw-redirect" title="Запустить">запустить</a>/<a href="/title/%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C" class="mw-redirect" title="Включить">включить</a> с помощью файла юнита systemd <code>dhcp6c@<i>interface</i>.service</code>, где <code><i>interface</i></code> — название интерфейса в файле настроек, т.е. например для интерфейса "WAN" используйте <code>dhcp6c@WAN.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> См. также <span class="plainlinks archwiki-template-man" title="$ man 8 dhcp6c">dhcp6c(8)</span> и <span class="plainlinks archwiki-template-man" title="$ man 5 dhcp6c.conf">dhcp6c.conf(5)</span>.</div>
<h3><span class="mw-headline" id="systemd-networkd_2">systemd-networkd</span></h3>
<p>Настройте внешний (wan) и внутренний (lan) интерфейсы. Это включит DHCPv6-PD для интерфейса с запущенным DHCPv6-клиентом. Делегированные префиксы предоставляются посредством IPv6 Router Advertisement во внутренней (локальной) сети.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/wan.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
# Укажите 'yes' вместо 'ipv6' для одновременной работы и ipv4, и ipv6.
DHCP=ipv6</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/lan.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
IPv6SendRA=yes
DHCPv6PrefixDelegation=yes</pre>
<h3>
<span id=".D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D1.8B"></span><span class="mw-headline" id="Другие_клиенты">Другие клиенты</span>
</h3>
<p><a href="/title/Network_configuration_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#DHCP" title="Network configuration (Русский)">dhclient</a> также может запрашивать сетевой префикс, но для присваивания этого префикса или его части нужно использовать специальный скрипт. Пример программы: <a rel="nofollow" class="external free" href="https://github.com/jaymzh/v6-gw-scripts/blob/master/dhclient-ipv6">https://github.com/jaymzh/v6-gw-scripts/blob/master/dhclient-ipv6</a>.
</p>
<h2>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_IPv6"></span><span class="mw-headline" id="Отключение_IPv6">Отключение IPv6</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Поддержка IPv6 встроена в ядро Arch Linux, поэтому отключить модуль просто добавив его в чёрный список не получится.</div>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Добавить объяснение, зачем может понадобиться отключение IPv6 (например, из-за сетевых экранов или некачественных DNS). (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:IPv6">Talk:IPv6</a>)</div>
</div>
<h3>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D1.83.D0.BD.D0.BA.D1.86.D0.B8.D0.BE.D0.BD.D0.B0.D0.BB.D1.8C.D0.BD.D0.BE.D1.81.D1.82.D0.B8"></span><span class="mw-headline" id="Отключение_функциональности">Отключение функциональности</span>
</h3>
<p>Добавление опции <code>ipv6.disable=1</code> в параметрах ядра отключает весь стек IPv6, что в большинстве случаев помогает добиться желаемого результата. Смотрите статью <a href="/title/Kernel_parameters" title="Kernel parameters">Kernel parameters</a> для получения дополнительной информации.
</p>
<p>Добавив вместо этого <code>ipv6.disable_ipv6=1</code>, вы оставите стек IPv6 работающим, но адреса IPv6 не будут присваиваться сетевым интерфейсам.
</p>
<p>Также вы можете отключить присвоение адреса IPv6 конкретным сетевым интерфейсам, добавив следующие строки в файл настроек <a href="/title/Sysctl" title="Sysctl">sysctl</a> <code>/etc/sysctl.d/40-ipv6.conf</code>:
</p>
<pre># Disable IPv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.<i>nic0</i>.disable_ipv6 = 1
...
net.ipv6.conf.<i>nicN</i>.disable_ipv6 = 1
</pre>
<p><a href="/title/%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5" class="mw-redirect" title="Перезапустите">Перезапустите</a> юнит <code>systemd-sysctl.service</code>, чтобы изменения вступили в силу.
</p>
<p>Необходимо перечислить здесь все сетевые интерфейсы, для которых требуется отключение IPv6, так как опция <code>all.disable_ipv6</code> не будет применена к сетевым интерфейсам, которые уже включены на момент выполнения инструкций из файла настроек.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Обратите также внимание, что при таком способе отключения IPv6 необходимо закомментировать все IPv6-хосты в файле <code>/etc/hosts</code>. В противном случае могут происходить ошибки подключения, если при определении адреса произошло разрешение на недоступный IPv6-адрес.
</div>
<h3>
<span id=".D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.8B"></span><span class="mw-headline" id="Другие_программы">Другие программы</span>
</h3>
<p>Отключение IPv6 в ядре не предотвращает другие программы от попытки использования версии IPv6. В большинстве случаев это не приводит к проблемам, однако, если они все-таки появляются, вам остается лишь искать в man-страницах или на просторах сети способ отключить эту функциональность.
</p>
<h4><span class="mw-headline" id="dhcpcd_3">dhcpcd</span></h4>
<p>Например, <i>dhcpcd</i> будет продолжать пытаться запрашивать настройки сети у маршрутизаторов IPv6 (т.н. <i>Router solicitation</i>). Чтобы отключить это, добавьте следующие строки в файл <code>/etc/dhcpcd.conf</code>:
</p>
<pre>noipv6rs
noipv6
</pre>
<h4><span class="mw-headline" id="NetworkManager_3">NetworkManager</span></h4>
<p>Чтобы отключить IPv6 в NetworkManager, вызовите контекстное меню значка статуса сети и перейдите в <i>Edit Connections &gt; Wired &gt; Network name &gt; Edit &gt; IPv6 Settings &gt; Method</i>, затем выберите <i>Method</i> как <i>Ignore/Disabled</i>.
</p>
<h4><span class="mw-headline" id="ntpd">ntpd</span></h4>
<p>Чтобы определить, как systemd должен запускать службу ntpd, необходимо <a href="/title/Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)#Drop-in_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">внести изменения</a> в файл <code>ntpd.service</code>.
</p>
<p>Это создаст drop-in сниппет, который будет запускаться вместо стандартного <code>ntpd.service</code>. Флаг <code>-4</code> отключает использование IPv6 демоном ntp. Поместите следующее в drop-in сниппет:
</p>
<pre>[Service]
ExecStart=
ExecStart=/usr/bin/ntpd -4 -g -u ntp:ntp
</pre>
<p>Здесь сначала очищается значение <code>ExecStart</code>, а затем устанавливается новая команда.
</p>
<h4><span class="mw-headline" id="GnuPG">GnuPG</span></h4>
<p>Отключите IPv6 в настройка <i>dirmngr</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/dirmngr.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">disable-ipv6
</pre>
<p>После этого перезапустите <a href="/title/Systemd/%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C" class="mw-redirect" title="Systemd/Пользователь">пользовательскую службу</a> <code>dirmngr.service</code>.
</p>
<h4><span class="mw-headline" id="sshd">sshd</span></h4>
<p>Добавьте следующие строки в файл <code>sshd_config</code>, чтобы убедиться, что <i>sshd</i> использует IPv4-адрес:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/ssh_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AddressFamily inet
</pre>
<p>После этого <a href="/title/%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D0%B5" class="mw-redirect" title="Перезапустите">перезапустите</a> службу <code>sshd.service</code>.
</p>
<h3><span class="mw-headline" id="systemd-networkd_3">systemd-networkd</span></h3>
<p>networkd позволяет отключить IPv6 для отдельного интерфейса. Когда в разделе <code>[Network]</code> сетевого юнита указан параметр <code>LinkLocalAddressing=ipv4</code> или <code>LinkLocalAddressing=no</code>, networkd не будет настраивать IPv6 на соответствующих сетевых интерфейсах.
</p>
<p>Следует однако отметить, что даже при использовании указанных выше опций networkd всё еще будет ожидать получения "объявлений маршрутизатора" (router advertisements, RA), если IPv6 не был отключён глобально для всей системы. Если трафик IPv6 не будет доходить до интерфейса (например, из-за настроек sysctl или ip6tables), то интерфейс останется в состоянии настройки и потенциально может стать причиной превышения времени ожидания (timeout) для служб, требующих полной настройки сети. Чтобы этого избежать, добавьте опцию <code>IPv6AcceptRA=no</code> в раздел <code>[Network]</code>.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_IPv4_.D0.B2.D0.BC.D0.B5.D1.81.D1.82.D0.BE_IPv6"></span><span class="mw-headline" id="Использование_IPv4_вместо_IPv6">Использование IPv4 вместо IPv6</span>
</h2>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="/title/File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Это отключит другие настройки по умолчанию. <a rel="nofollow" class="external autonumber" href="https://serverfault.com/a/93782/">[3]</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:IPv6#Factual_accuracy_-_Prefer_IPv4_over_IPv6">Talk:IPv6#Factual accuracy - Prefer IPv4 over IPv6</a>)</div>
</div>
<p>Раскомментируйте следующую строку в файле <code>/etc/gai.conf</code>:
</p>
<pre>#
#    For sites which prefer IPv4 connections change the last line to
#
precedence ::ffff:0:0/96  100
</pre>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/networking/ipv6.html">IPv6</a> — документация на kernel.org.</li>
<li>
<a rel="nofollow" class="external text" href="http://www.ipsidixit.net/2012/08/09/ipv6-temporary-addresses-and-privacy-extensions/">IPv6 temporary addresses</a> — временные адреса и расширения приватности.</li>
<li>
<a rel="nofollow" class="external text" href="https://mirrors.deepspace6.net/howtos/Linux+IPv6-HOWTO.html#AEN520">IPv6 prefixes</a> — о типах префиксов.</li>
<li>
<a rel="nofollow" class="external text" href="https://tldp.org/HOWTO/Linux+IPv6-HOWTO/ch11s02.html">net.ipv6 options</a> — документация параметров ядра.</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Networking_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)" title="Category:Networking (Русский)">Networking (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Accuracy" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=IPv6_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=670021">https://wiki.archlinux.org/index.php?title=IPv6_(Русский)&amp;oldid=670021</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 9 May 2021, at 13:17.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
