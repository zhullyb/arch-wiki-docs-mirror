<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>makepkg (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg_Русский rootpage-Makepkg_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">makepkg (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../en/Creating_packages.html" class="mw-redirect" title="Создание пакетов">Создание пакетов</a></li>
<li><a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD (Русский)</a></li>
<li><a href="../en/.SRCINFO.html" title=".SRCINFO">.SRCINFO</a></li>
<li><a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="Пользовательский репозиторий Arch">Пользовательский репозиторий Arch</a></li>
<li><a href="../ru/Pacman.html" title="Pacman (Русский)">pacman (Русский)</a></li>
<li><a href="../ru/Official_repositories.html" class="mw-redirect" title="Официальные репозитории">Официальные репозитории</a></li>
<li><a href="../ru/Arch_Build_System.html" class="mw-redirect" title="Система сборки Arch">Система сборки Arch</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Makepkg.html" title="Makepkg">makepkg</a>. Дата последней синхронизации: 3 ноября 2020. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;diff=0&amp;oldid=639664">изменения</a>.</div>
<p><a rel="nofollow" class="external text" href="https://git.archlinux.org/pacman.git/tree/scripts/makepkg.sh.in">makepkg</a> — скрипт для автоматизации сборки пакетов. Требования для работы — Unix-платформа с системой сборки и файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>.
</p>
<p><i>makepkg</i> входит в состав пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Настройка</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%D0%98%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F_%D0%BE_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D0%B5_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0"><span class="tocnumber">1.1</span> <span class="toctext">Информация о создателе пакета</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0"><span class="tocnumber">1.2</span> <span class="toctext">Расположение файлов пакета</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D1%86%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B5%D0%B9"><span class="tocnumber">1.3</span> <span class="toctext">Проверка цифровых подписей</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">2</span> <span class="toctext">Использование</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8"><span class="tocnumber">3</span> <span class="toctext">Советы и рекомендации</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#%D0%A1%D0%BD%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8_%D0%B8_%D0%B8%D0%B7%D0%B2%D0%BB%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%BE%D0%B2"><span class="tocnumber">3.1</span> <span class="toctext">Снижение времени загрузки и извлечения исходников</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#%D0%9E%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F_%D0%B4%D0%B2%D0%BE%D0%B8%D1%87%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2"><span class="tocnumber">3.2</span> <span class="toctext">Оптимизация двоичных пакетов</span></a></li>
<li class="toclevel-2 tocsection-9">
<a href="#%D0%A1%D0%BE%D0%BA%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D0%B8"><span class="tocnumber">3.3</span> <span class="toctext">Сокращение времени компиляции</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D1%8F"><span class="tocnumber">3.3.1</span> <span class="toctext">Параллельная компиляция</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_%D0%B8%D0%B7_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D0%B8"><span class="tocnumber">3.3.2</span> <span class="toctext">Сборка из файлов в памяти</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D1%8D%D1%88%D0%B0_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D0%B8"><span class="tocnumber">3.3.3</span> <span class="toctext">Использование кэша компиляции</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#%D0%92%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%BE%D0%B2%D1%8B%D1%85_%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D1%81%D1%83%D0%BC%D0%BC"><span class="tocnumber">3.4</span> <span class="toctext">Вычисление новых контрольных сумм</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D1%85_%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D0%BE%D0%B2_%D1%81%D0%B6%D0%B0%D1%82%D0%B8%D1%8F"><span class="tocnumber">3.5</span> <span class="toctext">Применение других алгоритмов сжатия</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%B8%D1%85_%D1%8F%D0%B4%D0%B5%D1%80_%D0%BF%D1%80%D0%B8_%D1%81%D0%B6%D0%B0%D1%82%D0%B8%D0%B8"><span class="tocnumber">3.6</span> <span class="toctext">Использование нескольких ядер при сжатии</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%D0%92%D1%8B%D0%B2%D0%BE%D0%B4_%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2_%D0%BF%D0%BE_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">3.7</span> <span class="toctext">Вывод списка пакетов по имени создателя</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_32-%D0%B1%D0%B8%D1%82%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2_%D0%B2_64-%D0%B1%D0%B8%D1%82%D0%BD%D0%BE%D0%B9_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5"><span class="tocnumber">3.8</span> <span class="toctext">Сборка 32-битных пакетов в 64-битной системе</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18">
<a href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC"><span class="tocnumber">4</span> <span class="toctext">Решение проблем</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#%D0%92%D1%8B%D0%B1%D0%BE%D1%80_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0_%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8_%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B5_%D0%B2_QMake"><span class="tocnumber">4.1</span> <span class="toctext">Выбор каталога установки при сборке в QMake</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#WARNING:_Package_contains_reference_to_%24srcdir"><span class="tocnumber">4.2</span> <span class="toctext">WARNING: Package contains reference to $srcdir</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#makepkg_%D0%BD%D0%B5_%D0%BC%D0%BE%D0%B6%D0%B5%D1%82_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8"><span class="tocnumber">4.3</span> <span class="toctext">makepkg не может загрузить зависимости через прокси</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80_XferCommand_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/pacman.conf"><span class="tocnumber">4.3.1</span> <span class="toctext">Параметр XferCommand в файле /etc/pacman.conf</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80_env_keep_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/sudoers"><span class="tocnumber">4.3.2</span> <span class="toctext">Параметр env_keep в файле /etc/sudoers</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-24"><a href="#makepkg_%D0%BD%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82,_%D0%BD%D0%BE_make_%D0%B7%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D1%83%D1%81%D0%BF%D0%B5%D1%88%D0%BD%D0%BE"><span class="tocnumber">4.4</span> <span class="toctext">makepkg не работает, но make завершается успешно</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">5</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>Параметры настройки <i>makepkg</i> подробно описаны в руководстве <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span>.
</p>
<p>Общесистемные настройки хранятся в файле <code>/etc/makepkg.conf</code>, пользовательские — в <code>$XDG_CONFIG_HOME/pacman/makepkg.conf</code> или <code>~/.makepkg.conf</code>. Рекомендуется проверять настройки перед сборкой пакетов.
</p>
<h3>
<span id=".D0.98.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D1.82.D0.B5.D0.BB.D0.B5_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.B0"></span><span class="mw-headline" id="Информация_о_создателе_пакета">Информация о создателе пакета</span>
</h3>
<p>Каждый пакет содержит метаданные, в том числе информацию о создателе пакета (packager). По умолчанию скомпилированный пакет создаётся с пометкой <code>Unknown Packager</code>. Однако если на одной системе компиляцией занимаются несколько пользователей или вы планируете распространять пакет среди других пользователей, то имеет смысл указать настоящие контактные данные, задав переменную <code>PACKAGER</code> в файле <code>makepkg.conf</code>.
</p>
<p>Создателя установленного пакета можно узнать командой:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>пакет</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Packager       : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>Кроме того, если указать цифровую подпись создателя в параметре <code>GPGKEY</code>, то она тоже будет автоматически добавляться к пакету.
</p>
<h3>
<span id=".D0.A0.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.B0"></span><span class="mw-headline" id="Расположение_файлов_пакета">Расположение файлов пакета</span>
</h3>
<p><i>makepkg</i> создаёт пакет в рабочем каталоге в формате tar-архива, а исходный код загружает в подкаталог <code>src/</code>. Целевые каталоги можно переназначить, например, чтобы все собранные пакеты хранились в <code>~/build/packages/</code>, а все исходные данные — в <code>~/build/sources/</code>.
</p>
<p>Можно задать следующие значения в <code>makepkg.conf</code>:
</p>
<ul>
<li>
<code>PKGDEST</code> — каталог для собранных пакетов (расширение <code>.pkg.tar.xz</code>);</li>
<li>
<code>SRCDEST</code> — каталог для <a href="../ru/PKGBUILD.html#source" title="PKGBUILD (Русский)">исходных</a> файлов (расширение <code>.tar.gz</code>; в каталог <code>src/</code> будут помещаться символические ссылки на новое местоположение);</li>
<li>
<code>SRCPKGDEST</code> — каталог для пакетов исходных данных (расширение <code>.src.tar.gz</code>, создаются командой <code>makepkg -S</code>).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Каталог <code>PKGDEST</code> можно очистить, например, командой <code>paccache -c ~/build/packages/</code> (см. <a href="../ru/Pacman.html#%D0%9E%D1%87%D0%B8%D1%81%D1%82%D0%BA%D0%B0_%D0%BA%D1%8D%D1%88%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">pacman#Очистка кэша пакетов</a>).
</div>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D1.86.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D1.8B.D1.85_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B5.D0.B9"></span><span class="mw-headline" id="Проверка_цифровых_подписей">Проверка цифровых подписей</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> При проверке цифровых подписей <i>makepkg</i> полагается исключительно на пользовательские связки ключей. Связки ключей <i>pacman</i> не используются <a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>.
</div>
<p>Файлы цифровых подписей имеют расширение <i>.sig</i> или <i>.asc</i> и указываются в параметре <code>source</code> файла <a href="../ru/PKGBUILD.html#source" title="PKGBUILD (Русский)">PKGBUILD</a>. Если <i>makepkg</i> встречает такой файл, то автоматически пытается <a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">проверить</a> подпись пакета. Если пользовательская связка ключей не содержит нужный открытый ключ, то <i>makepkg</i> выведет сообщение о невозможности осуществить проверку PGP-ключа и прервёт установку.
</p>
<p>Если нужный открытый ключ отсутствует, то файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>, скорее всего, содержит пункт  <a href="../ru/PKGBUILD.html#validpgpkeys" title="PKGBUILD (Русский)">validpgpkeys</a> с идентификаторами ключей. Ключи можно <a href="../ru/GnuPG.html#%D0%98%D0%BC%D0%BF%D0%BE%D1%80%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9" title="GnuPG (Русский)">импортировать</a> вручную или же найти их <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">на сервере ключей</a> и импортировать оттуда.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h2>
<p>Для корректной работы <i>makepkg</i> нужно <a href="../ru/Pacman.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установить">установить</a> группу пакетов <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/base-devel/">base-devel</a></span>. Пакеты из этой группы можно не указывать в качестве зависимосимостей для сборки (<i>makedepends</i>) в файле <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Убедитесь, что утилита <a href="../ru/Sudo.html" title="Sudo (Русский)">sudo</a> настроена должным образом для команд, передаваемых <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a>.</li>
<li>Запуск <i>makepkg</i> от root-пользователя  <b>запрещён</b>: <a rel="nofollow" class="external autonumber" href="https://lists.archlinux.org/pipermail/pacman-dev/2014-March/018911.html">[2]</a>, <a rel="nofollow" class="external autonumber" href="https://git.archlinux.org/pacman.git/tree/NEWS">[3]</a>. Поскольку <code>PKGBUILD</code> может содержать произвольные команды, сборка пакетов под root-аккаунтом признана небезопасной <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=67561">[4]</a>. Если у пользователя нет доступа к аккаунту обычного пользователя, то следует запускать <i>makepkg</i> от пользователя <a rel="nofollow" class="external text" href="http://allanmcrae.com/2015/01/replacing-makepkg-asroot/">"nobody"</a>.</li>
</ul>
</div>
<p>Чтобы собрать пакет, первым делом необходимо создать файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>, который представляет собой скрипт сборки. Написание скрипта описано в статье <a href="../en/Creating_packages.html" class="mw-redirect" title="Создание пакетов">Создание пакетов</a>. Скрипты для существующих пакетов можно найти в дереве каталогов <a href="../ru/Arch_Build_System.html" title="Arch Build System (Русский)">Системы сборки Arch</a>, а также в <a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="AUR (Русский)">AUR</a>. После того, как <code>PKGBUILD</code> получен, переместитесь в каталог с ним и выполните команду сборки пакета:
</p>
<pre>$ makepkg
</pre>
<p>Если в системе не установлены необходимые зависимости, <i>makepkg</i> предупредит вас об этом и отменит сборку. Если задать флаг <code>-s</code>/<code>--syncdeps</code>, то <i>makepkg</i> самостоятельно установит недостающие зависимости и соберёт пакет.
</p>
<pre>$ makepkg --syncdeps
</pre>
<p>С флагом <code>-r</code>/<code>--rmdeps</code> <i>makepkg</i> после сборки удалит те зависимости, которые будут больше не нужны. Если вы постоянно занимаетесь сборкой пакетов и не хотите загрязнять систему пакетами-сиротами, то стоит также ознакомиться со статьёй <a href="../ru/9162c98b104d744ec851c6ccfd816dd7.html#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)/Tips and tricks (Русский)">pacman/Tips and tricks#Удаление неиспользуемых пакетов</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Устанавливаемые пакеты-зависимости должны находиться в подключённых репозиториях; в статье <a href="../ru/Pacman.html#%D0%A0%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B8_%D0%B8_%D0%B7%D0%B5%D1%80%D0%BA%D0%B0%D0%BB%D0%B0" title="Pacman (Русский)">Pacman#Репозитории и зеркала</a> описана настройка репозиториев. Кроме того, зависимости можно установить вручную командой <code>pacman -S --asdeps <i>зависимость1</i> <i>зависимость2</i></code>.</li>
<li>При установке зависимостей используются только глобальные значения переменных, то есть переопределить значения, например, внутри функции упаковки разделённого пакета (split package) не получится.</li>
</ul>
</div>
<p>Когда все зависимости установлены и сборка пакета завершилась успешно, в рабочем каталоге появится файл пакета (<code><i>имя-пакета</i>-<i>версия-пакета</i>.pkg.tar.zst</code>). Чтобы установить его в систему, используйте флаг <code>-i</code>/<code>--install</code> (работает аналогично команде <code>pacman -U <i>имя-пакета</i>-<i>версия-пакета</i>.pkg.tar.zst</code>):
</p>
<pre>$ makepkg --install
</pre>
<p>С флагом <code>-c</code>/<code>--clean</code> <i>makepkg</i> удалит оставшиеся после сборки промежуточные файлы и каталоги (например, распакованные в <code>$srcdir</code> файлы). Это полезно при многократных сборках одного и того же пакета или его обновления в одном рабочем каталоге. Это предотвратит добавление устаревших файлов в новые сборки:
</p>
<pre>$ makepkg --clean
</pre>
<p>Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span>.
</p>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.A1.D0.BD.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8_.D0.B8_.D0.B8.D0.B7.D0.B2.D0.BB.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B8.D1.81.D1.85.D0.BE.D0.B4.D0.BD.D0.B8.D0.BA.D0.BE.D0.B2"></span><span class="mw-headline" id="Снижение_времени_загрузки_и_извлечения_исходников">Снижение времени загрузки и извлечения исходников</span>
</h3>
<p>При многократной пересборке одного и того же пакета, особенно в случае <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a>, используйте <code>SRCDEST</code>, чтобы сэкономить время на скачивание и распаковку файлов с исходным кодом.
</p>
<h3>
<span id=".D0.9E.D0.BF.D1.82.D0.B8.D0.BC.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D1.8F_.D0.B4.D0.B2.D0.BE.D0.B8.D1.87.D0.BD.D1.8B.D1.85_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Оптимизация_двоичных_пакетов">Оптимизация двоичных пакетов</span>
</h3>
<p>Повысить производительность программ можно на этапе сборки пакета за счет возможностей компилятора по оптимизации кода. Однако нужно иметь в виду, что двоичные файлы, скомпилированные под специфическую архитектуру процессора, не будут правильно работать на других машинах. Если говорить об архитектуре x86_64, то редко когда достигнутый эффект повышения производительности стоит затраченного на пересборку официальных пакетов времени.
</p>
<p>С другой стороны, <i>снизить</i> производительность, задав "нестандартные" флаги компилятора — проще простого. Чаще всего тонкая настройка компилятора приносит пользу лишь в определённой ситуации и не стоит применять её ко всем пакетам без разбора. Если вы не можете доказать повышение производительности путем тестов, то скорее всего, его просто нет! Статьи из Gentoo-wiki <a href="https://wiki.gentoo.org/wiki/GCC_optimization" class="extiw" title="gentoo:GCC optimization">Оптимизации GCC</a> и <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS" class="extiw" title="gentoo:Safe CFLAGS">Safe CFLAGS</a> содержат больше информации по оптимизации компилятора.
</p>
<p>Опции, переданные компилятору C/C++ (например, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> или <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>) зависят от переменных окружения <code>CFLAGS</code>, <code>CXXFLAGS</code> и <code>CPPFLAGS</code>. В <a href="../ru/Arch_Build_System.html" title="Arch Build System (Русский)">системе сборки Arch</a> <i>makepkg</i> извлекает значения переменных окружения из файла настроек <code>makepkg.conf</code> и использует их в качестве опций. Значения по умолчанию выбраны таким образом, чтобы создаваемые двоичные программы работали на широком диапазоне машин.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Следует помнить, что не все системы сборки используют переменные, указанные в файле <code>makepkg.conf</code>. Например, <i>cmake</i> игнорирует переменную <code>CPPFLAGS</code>. Как следствие, часто в файлах <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a> можно увидеть различные обходные решения для систем сборки, используемых для конкретного программного обеспечения.</li>
<li>Настройки в файле <code>Makefile</code> и аргументы в командах компиляции имеют приоритет над значениями в <code>makepkg.conf</code>, что может привести к их переопределению.</li>
</ul>
</div>
<p>Компилятор GCC может автоматически обнаруживать и включать безопасные оптимизации, доступные для конкретной архитектуры. Чтобы использовать эту особенность, сначала удалите любые <code>-march</code> и <code>-mtune</code> флаги, а затем добавьте опцию <code>-march=native</code>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe -fstack-protector-strong -fno-plt"
CXXFLAGS="${CFLAGS}"</pre>
<p>Чтобы узнать, какие флаги эта команда разблокирует на вашей машине, выполните:
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы укажете значение, отличное от <code>-march=native</code>, то <code>-Q --help=target</code> не сработает <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[5]</a>. Вам придётся пройти через фазу компиляции, чтобы узнать, какие опции на самом деле были включены. Подробнее см. <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Manual" class="extiw" title="gentoo:Safe CFLAGS">Gentoo:Safe CFLAGS#Manual</a>.</div>
<p>Начиная с <i>pacman</i> версии 5.2.2 файл <code>makepkg.conf</code> также содержит переменную окружения <code>RUSTFLAGS</code>, в которой можно указать флаги, передаваемые компилятору языка Rust. Если указать в переменной <code>RUSTFLAGS</code> значение <code>-C target-cpu=native</code>, компилятор включит возможные для архитектуры вашего процессора алгоритмы оптимизации.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="-C opt-level=2 <b>-C target-cpu=native</b>"</pre>
<p>Чтобы узнать, какие возможности процессора можно включить этой настройкой, выполните:
</p>
<pre>$ rustc -C target-cpu=native --print cfg
</pre>
<p>Если в команде выше указать <code>--print cfg</code> без <code>-C target-cpu=native</code>, то будет выведена стандартная конфигурация. Можно также изменить значение параметра <code>opt-level</code> на <code>3</code>, <code>s</code> или <code>z</code>, подробнее см. <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/rustc/codegen-options/index.html#opt-level">документацию компилятора Rust</a>.
</p>
<h3>
<span id=".D0.A1.D0.BE.D0.BA.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Сокращение_времени_компиляции">Сокращение времени компиляции</span>
</h3>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BB.D0.BB.D0.B5.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D1.8F"></span><span class="mw-headline" id="Параллельная_компиляция">Параллельная компиляция</span>
</h4>
<p>Для сборки пакетов с помощью <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> используется <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменная окружения</a> <code>MAKEFLAGS</code>, которая определяет дополнительные опции для утилиты <i>make</i>. Установить значение этой переменной можно также в файле <code>makepkg.conf</code>.
</p>
<p>Пользователи с многоядерными/многопроцессорными системами могут указать количество одновременно запускаемых задач. Это делается с помощью утилиты для определения количества доступных ядер <i>nproc</i>, например <code>MAKEFLAGS="-j$(nproc)"</code>. Некоторые файлы <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a> переопределяют это значение на <code>-j1</code>, чтобы избежать состояний гонки или просто потому что многопоточная работа не поддерживается изначально. Если сборка пакета завершилась неудачно из-за описанных выше изменений в <code>MAKEFLAGS</code>, то нужно создать <a href="../ru/Bug_reporting_guidelines.html" title="Bug reporting guidelines (Русский)">отчёт об ошибке</a> или, в случае пакета из <a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="AUR (Русский)">AUR</a>, сообщить сопроводителю пакета.
</p>
<p>Другие возможные опции можно найти в руководстве <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span>.
</p>
<h4>
<span id=".D0.A1.D0.B1.D0.BE.D1.80.D0.BA.D0.B0_.D0.B8.D0.B7_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B2_.D0.BF.D0.B0.D0.BC.D1.8F.D1.82.D0.B8"></span><span class="mw-headline" id="Сборка_из_файлов_в_памяти">Сборка из файлов в памяти</span>
</h4>
<p>Если компиляция требует много операций ввода-вывода и обработки маленьких файлов, перемещение рабочего каталога во временную файловую систему <a href="../ru/Tmpfs.html" title="Tmpfs (Русский)">tmpfs</a> может сократить время компиляции.
</p>
<p>Переменная <code>BUILDDIR</code> может быть временно экспортирована в <i>makepkg</i>, чтобы установить рабочий каталог в существующий раздел с tmpfs. Например:
</p>
<pre>$ BUILDDIR=/tmp/makepkg makepkg
</pre>
<p>Чтобы сделать эту настройку постоянной, нужно раскомментировать опцию <code>BUILDDIR</code> файла настроек <code>/etc/makepkg.conf</code>. Если, к примеру, установить это значение <code>BUILDDIR=/tmp/makepkg</code>, то будет использоваться обычная временная файловая система Arch <code>/tmp</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Старайтесь не компилировать большие пакеты в tmpfs, чтобы не произошло исчерпания памяти.</li>
<li>Каталог tmpfs должен быть смонтирован без опции <code>noexec</code>, потому что иначе собранный двоичный пакет будет невозможно исполнить.</li>
<li>Также помните, что собранные в tmpfs пакеты будут удалены при перезагрузке. Задайте параметр <a href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0">PKGDEST</a>, чтобы собранный пакет автоматически перемещался в "постоянный" каталог.</li>
</ul>
</div>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D1.8D.D1.88.D0.B0_.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Использование_кэша_компиляции">Использование кэша компиляции</span>
</h4>
<p>Применение <a href="../en/Ccache.html" title="Ccache">ccache</a> сокращает время сборки за счет многократного использования кэша компиляции.
</p>
<h3>
<span id=".D0.92.D1.8B.D1.87.D0.B8.D1.81.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BD.D0.BE.D0.B2.D1.8B.D1.85_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C.D0.BD.D1.8B.D1.85_.D1.81.D1.83.D0.BC.D0.BC"></span><span class="mw-headline" id="Вычисление_новых_контрольных_сумм">Вычисление новых контрольных сумм</span>
</h3>
<p>Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> и выполните следующую команду в каталоге с файлом <code>PKGBUILD</code>, чтобы сгенерировать новые контрольные суммы:
</p>
<pre>$ updpkgsums
</pre>
<p><code>updpkgsums</code> использует <code>makepkg --geninteg</code> для вычисления контрольных сумм. Подробнее см. <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1933763#p1933763">обсуждение на форуме</a>.
</p>
<p>Контрольные суммы также можно получить посредством команды <code>sha256sum</code>, после чего полученные значения следует вручную добавить к массиву <code>sha256sums</code> в файле <code>PKGBUILD</code>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D1.80.D1.83.D0.B3.D0.B8.D1.85_.D0.B0.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC.D0.BE.D0.B2_.D1.81.D0.B6.D0.B0.D1.82.D0.B8.D1.8F"></span><span class="mw-headline" id="Применение_других_алгоритмов_сжатия">Применение других алгоритмов сжатия</span>
</h3>
<p>Создание и установку пакета можно ускорить, заплатив за это увеличением размера. Для этого нужно изменить переменную окружения <code>PKGEXT</code>. Например, следующая команда создаст пакет в виде несжатого архива, вследствие чего не нужно будет выполнять его декомпрессию при установке:
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>Другой пример, с использованием алгоритма сжатия lzop (необходим пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzop">lzop</a></span>):
</p>
<pre>$ PKGEXT='.pkg.tar.lzo' makepkg
</pre>
<p>Чтобы сделать одну из этих настроек постоянной, нужно установить соответствующее значение <code>PKGEXT</code> в <code>/etc/makepkg.conf</code>.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D1.81.D0.BA.D0.BE.D0.BB.D1.8C.D0.BA.D0.B8.D1.85_.D1.8F.D0.B4.D0.B5.D1.80_.D0.BF.D1.80.D0.B8_.D1.81.D0.B6.D0.B0.D1.82.D0.B8.D0.B8"></span><span class="mw-headline" id="Использование_нескольких_ядер_при_сжатии">Использование нескольких ядер при сжатии</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> поддерживает <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F_%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C" class="extiw" title="wikipedia:ru:Симметричная многопроцессорность">симметричную многопроцессорность (SMP)</a> посредством флага <code>--threads</code> для ускорения сжатия. Например, чтобы разрешить <i>makepkg</i> использовать все имеющиеся в наличии ядра CPU, отредактируйте массив <code>COMPRESSXZ</code> в <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSXZ=(xz -c -z - --threads=0)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> — параллельная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span>, по умолчанию использует все доступные ядра CPU. Если необходимо задействовать меньшее количество ядер, то используется флаг <code>-p/--processes</code>:
</p>
<pre>COMPRESSGZ=(pigz -c -f -n)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> — параллельная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, также использует максимально возможное количество ядер по умолчанию. Флаг <code>-p#</code> используется для выбора меньшего количества ядер (примечание: между <code>-p</code> и числом ядер не должно быть пробелов):
</p>
<pre>COMPRESSBZ2=(pbzip2 -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> поддерживает <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F_%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C" class="extiw" title="wikipedia:ru:Симметричная многопроцессорность">симметричную многопроцессорность (SMP)</a> посредством флага <code>--threads</code> для ускорения сжатия. Например, чтобы разрешить <i>makepkg</i> использовать все имеющиеся в наличии ядра CPU, отредактируйте массив <code>COMPRESSZST</code> в <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSZST=(zstd -c -z -q - --threads=0)
</pre>
<h3>
<span id=".D0.92.D1.8B.D0.B2.D0.BE.D0.B4_.D1.81.D0.BF.D0.B8.D1.81.D0.BA.D0.B0_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2_.D0.BF.D0.BE_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Вывод_списка_пакетов_по_имени_создателя">Вывод списка пакетов по имени создателя</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=expac">expac</a></span> — программа для работы с базой данных pacman. Если необходимо вывести список всех установленных пакетов, создателем которых является <i>создатель-пакета</i>, выполните:
</p>
<pre>$ expac "%n %p" | grep "<i>создатель-пакета</i>" | column -t
</pre>
<p>Команда для вывода списка пакетов, создатель которых указан в переменной <code>PACKAGER</code> файла <code>/etc/makepkg.conf</code> (покажет только пакеты из репозиториев, определенных в <code>/etc/pacman.conf</code>):
</p>
<pre>$ . /etc/makepkg.conf; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</pre>
<h3>
<span id=".D0.A1.D0.B1.D0.BE.D1.80.D0.BA.D0.B0_32-.D0.B1.D0.B8.D1.82.D0.BD.D1.8B.D1.85_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2_.D0.B2_64-.D0.B1.D0.B8.D1.82.D0.BD.D0.BE.D0.B9_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B5"></span><span class="mw-headline" id="Сборка_32-битных_пакетов_в_64-битной_системе">Сборка 32-битных пакетов в 64-битной системе</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если вы попытаетесь собрать пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> указанным ниже способом, результатом будет сообщение об ошибке.</div>
<p>Предварительно разблокируйте репозиторий <a href="../ru/Official_repositories.html#multilib" class="mw-redirect" title="Multilib (Русский)">multilib</a> и <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> группу пакетов <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/multilib-devel/">multilib-devel</a></span>.
</p>
<p>Затем создайте 32-битный файл настроек
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.makepkg.i686.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CARCH="i686"
CHOST="i686-unknown-linux-gnu"
CFLAGS="-m32 -march=i686 -mtune=generic -O2 -pipe -fstack-protector-strong"
CXXFLAGS="${CFLAGS}"
LDFLAGS="-m32 -Wl,-O1,--sort-common,--as-needed,-z,relro"
</pre>
<p>и выполните:
</p>
<pre>$ linux32 makepkg --config ~/.makepkg.i686.conf
</pre>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id=".D0.92.D1.8B.D0.B1.D0.BE.D1.80_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0_.D1.83.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B8_.D0.BF.D1.80.D0.B8_.D1.81.D0.B1.D0.BE.D1.80.D0.BA.D0.B5_.D0.B2_QMake"></span><span class="mw-headline" id="Выбор_каталога_установки_при_сборке_в_QMake">Выбор каталога установки при сборке в QMake</span>
</h3>
<p>QMake генерирует файл <code>makefile</code>, в котором для указания каталога установки используется переменная окружения <code>INSTALL_ROOT</code>. Например, вот как будет выглядеть функция <i>package</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
package() {
	cd "$srcdir/${pkgname%-git}"
	make INSTALL_ROOT="$pkgdir" install
}
...</pre>
<p>Обратите внимание, что Qmake тоже должен быть соответствующим образом настроен. К примеру, добавьте следующие строки в ваш <i>.pro</i>-файл.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">YourProject.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
target.path = /usr/local/bin
INSTALLS += target
...</pre>
<h3>
<span id="WARNING:_Package_contains_reference_to_.24srcdir"></span><span class="mw-headline" id="WARNING:_Package_contains_reference_to_$srcdir">WARNING: Package contains reference to $srcdir</span>
</h3>
<p>Подобное предупреждение означает, что строковый литерал, указанный в переменных <code>$srcdir</code> или <code>$pkgdir</code>, каким-то образом оказался в одном или нескольких файлах вашего пакета  <a rel="nofollow" class="external autonumber" href="http://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[6]</a>.
</p>
<p>Чтобы определить, в каких именно файлах, выполните следующую команду в рабочем каталоге сборки:
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>Одной из причин появления этого предупреждения может быть использование в коде C/C++ макроса <code>__FILE__</code>, который содержит полный путь к каталогу <code>$srcdir</code>.
</p>
<h3>
<span id="makepkg_.D0.BD.D0.B5_.D0.BC.D0.BE.D0.B6.D0.B5.D1.82_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.B8.D1.82.D1.8C_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D0.B8_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D1.80.D0.BE.D0.BA.D1.81.D0.B8"></span><span class="mw-headline" id="makepkg_не_может_загрузить_зависимости_через_прокси">makepkg не может загрузить зависимости через прокси</span>
</h3>
<p>Когда <i>makepkg</i> проверяет зависимости, он вызывает <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a> для установки недостающих пакетов. Для работы <i>pacman</i> требует предоставления прав администратора посредством <i>sudo</i>. Однако команда <i>sudo</i> не передает никакие <a href="../ru/Environment_variables.html" class="mw-redirect" title="Переменные окружения">переменные окружения</a> в привилегированное окружение, в том числе и относящиеся к настройкам прокси переменные <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code> и <code>no_proxy</code>.
</p>
<p>Чтобы <i>makepkg</i> мог работать через прокси, воспользуйтесь одним из советов ниже.
</p>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80_XferCommand_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fpacman.conf"></span><span class="mw-headline" id="Параметр_XferCommand_в_файле_/etc/pacman.conf">Параметр XferCommand в файле /etc/pacman.conf</span>
</h4>
<p>Параметр <code>XferCommand</code> в файле <code>/etc/pacman.conf</code> позволяет настроить использование прокси. В этом параметре нужно указать URL прокси-сервера. Добавьте или раскомментируйте следующую строку:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl -x http://username:password@proxy.proxyhost.com:80 -L -C - -f -o %o %u
...
</pre>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80_env_keep_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fsudoers"></span><span class="mw-headline" id="Параметр_env_keep_в_файле_/etc/sudoers">Параметр env_keep в файле /etc/sudoers</span>
</h4>
<p>Опция <code>env_keep</code> в файле <code>/etc/sudoers</code> позволяет использовать упомянутые выше прокси-переменные в привилегированном окружении. Подробнее см. <a href="../ru/Sudo.html#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F" title="Sudo (Русский)">Sudo#Переменные окружения</a>.
</p>
<h3>
<span id="makepkg_.D0.BD.D0.B5_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82.2C_.D0.BD.D0.BE_make_.D0.B7.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D1.83.D1.81.D0.BF.D0.B5.D1.88.D0.BD.D0.BE"></span><span class="mw-headline" id="makepkg_не_работает,_но_make_завершается_успешно">makepkg не работает, но make завершается успешно</span>
</h3>
<p>Если удаётся скомпилировать пакет командой <i>make</i>, но не получается — командой <i>makepkg</i>, причиной могут быть переменные компиляции в файле <code>/etc/makepkg.conf</code>. Попробуйте добавить следующие флаги к параметру <code>options</code> файла <code>PKGBUILD</code>:
</p>
<p><code>!buildflags</code>, для отключения значений по умолчанию <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code>, и <code>LDFLAGS</code>.
</p>
<p><code>!makeflags</code>, для отключения <code>MAKEFLAGS</code>, если вы меняли <code>/etc/makepkg.conf</code>, чтобы разрешить параллельную сборку.
</p>
<p><code>!debug</code>, для отключения <code>DEBUG_CFLAGS</code> и <code>DEBUG_CXXFLAGS</code>, если вы собрали пакет для отладки.
</p>
<p>Если что-то из перечисленного выше решило проблему, выясните, какой именно флаг создавал проблему и сообщите о баге разработчикам.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">Краткое описание работы makepkg</a></li>
<li><a rel="nofollow" class="external text" href="https://projects.archlinux.org/pacman.git/tree/scripts/makepkg.sh.in">Исходный код makepkg</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Package_development.html" title="Category:Package development (Русский)">Package development (Русский)</a></li>
<li><a href="../ru/Category:About_Arch.html" title="Category:About Arch (Русский)">About Arch (Русский)</a></li>
<li><a href="../ru/Category:Commands.html" title="Category:Commands (Русский)">Commands (Русский)</a></li>
</ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=640438">https://wiki.archlinux.org/index.php?title=Makepkg_(Русский)&amp;oldid=640438</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 3 November 2020, at 06:33.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
