<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Zabbix with NGINX how-to (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Zabbix_with_NGINX_how-to_Русский rootpage-Zabbix_with_NGINX_how-to_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Zabbix with NGINX how-to (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../en/Zabbix.html" class="mw-redirect" title="Zabbix (Русский)">Zabbix (Русский)</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://www.zabbix.com/">Zabbix</a> — свободная система мониторинга и отслеживания статусов разнообразных сервисов компьютерной сети, серверов и сетевого оборудования, написанная Алексеем Владышевым.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Установка</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BD%D0%B5%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B8%D0%BC%D0%BE%D0%B9_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8_iksemel_%D0%B4%D0%BB%D1%8F_zabbix-server"><span class="tocnumber">1.1</span> <span class="toctext">Установка необходимой зависимости iksemel для zabbix-server</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_zabbix-server"><span class="tocnumber">1.2</span> <span class="toctext">Установка zabbix-server</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_PostgreSQL"><span class="tocnumber">2</span> <span class="toctext">Настройка PostgreSQL</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0_PostgreSQL_%D0%BA_%D0%BF%D0%B5%D1%80%D0%B2%D0%BE%D0%BC%D1%83_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D1%83"><span class="tocnumber">2.1</span> <span class="toctext">Подготовка PostgreSQL к первому запуску</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_PostgreSQL"><span class="tocnumber">2.2</span> <span class="toctext">Запуск PostgreSQL</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8E_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_postgres"><span class="tocnumber">2.3</span> <span class="toctext">Установка пароля пользователю системы postgres</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F_%D1%80%D0%BE%D0%BB%D0%B8_postgres_%D0%B8_%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BA_%D0%B1%D0%B0%D0%B7%D0%B0%D0%BC_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB_Unix"><span class="tocnumber">2.4</span> <span class="toctext">Установка пароля роли postgres и разрешение подключения к базам данных только через протокол Unix</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B1%D0%B0%D0%B7%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_zabbix_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B_%D1%81_Zabbix"><span class="tocnumber">2.5</span> <span class="toctext">Создание и настройка базы данных zabbix для работы с Zabbix</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#%D0%94%D0%9E%D0%9F%D0%9E%D0%9B%D0%9D%D0%98%D0%A2%D0%95%D0%9B%D0%AC%D0%9D%D0%9E._%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8F_%D0%B7%D0%B0_%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC%D0%BE%D0%BC_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D0%BE%D0%B3%D0%BE_Zabbix_%D0%B8_PostgreSQL_%D0%B4%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE_%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B5%D0%B4%D0%BA%D0%BE_%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D1%8F%D1%8E%D1%89%D0%B5%D0%B9%D1%81%D1%8F_%D0%B1%D0%B0%D0%B7%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85"><span class="tocnumber">2.6</span> <span class="toctext">ДОПОЛНИТЕЛЬНО. Настройка контроля за объемом используемого Zabbix и PostgreSQL дискового пространства для редко изменяющейся базы данных</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_PostgreSQL_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">2.7</span> <span class="toctext">Включение PostgreSQL в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_PHP_%D0%B8_FastCGI_Process_Manager"><span class="tocnumber">3</span> <span class="toctext">Настройка PHP и FastCGI Process Manager</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B9_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/php/php.ini"><span class="tocnumber">3.1</span> <span class="toctext">Проверка значений параметров в файле /etc/php/php.ini</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B9_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/php/php-fpm.conf"><span class="tocnumber">3.2</span> <span class="toctext">Проверка значений параметров в файле /etc/php/php-fpm.conf</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_FastCGI_Process_Manager"><span class="tocnumber">3.3</span> <span class="toctext">Запуск FastCGI Process Manager</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_FastCGI_Process_Manager_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">3.4</span> <span class="toctext">Включение FastCGI Process Manager в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_NGINX"><span class="tocnumber">4</span> <span class="toctext">Настройка NGINX</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B0%D0%BC%D0%BE%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D0%B2_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BA_Zabbix_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_HTTPS"><span class="tocnumber">4.1</span> <span class="toctext">Создание самоподписанных сертификатов для подключения к Zabbix через HTTPS</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BD%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB_%D0%BF%D1%80%D0%B8%D0%B2%D0%B0%D1%82%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_zabbix.key"><span class="tocnumber">4.2</span> <span class="toctext">Перемещение и изменение прав доступа на файл приватного ключа zabbix.key</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BD%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%B0_zabbix.pem"><span class="tocnumber">4.3</span> <span class="toctext">Перемещение и изменение прав доступа на файл сертификата zabbix.pem</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_/etc/nginx/nginx.conf"><span class="tocnumber">4.4</span> <span class="toctext">Изменение файла /etc/nginx/nginx.conf</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_NGINX"><span class="tocnumber">4.5</span> <span class="toctext">Запуск NGINX</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_NGINX_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">4.6</span> <span class="toctext">Включение NGINX в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24">
<a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B8_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0_Zabbix"><span class="tocnumber">5</span> <span class="toctext">Установка и настройка агента Zabbix</span></a>
<ul>
<li class="toclevel-2 tocsection-25"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_zabbix-agent"><span class="tocnumber">5.1</span> <span class="toctext">Установка zabbix-agent</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B9_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/zabbix/zabbix_agentd.conf"><span class="tocnumber">5.2</span> <span class="toctext">Проверка значений параметров в файле /etc/zabbix/zabbix_agentd.conf</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0_Zabbix"><span class="tocnumber">5.3</span> <span class="toctext">Запуск агента Zabbix</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0_Zabbix_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">5.4</span> <span class="toctext">Включение агента Zabbix в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-29">
<a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B8_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0_NTP"><span class="tocnumber">6</span> <span class="toctext">Установка и настройка клиента NTP</span></a>
<ul>
<li class="toclevel-2 tocsection-30"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_ntp"><span class="tocnumber">6.1</span> <span class="toctext">Установка ntp</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0_NTP"><span class="tocnumber">6.2</span> <span class="toctext">Запуск клиента NTP</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0_NTP_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">6.3</span> <span class="toctext">Включение клиента NTP в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_Zabbix"><span class="tocnumber">7</span> <span class="toctext">Настройка Zabbix</span></a>
<ul>
<li class="toclevel-2 tocsection-34"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B0%D0%BF%D0%BF%D0%B0%D1%80%D0%B0%D1%82%D0%BD%D1%8B%D1%85_%D1%87%D0%B0%D1%81%D0%BE%D0%B2"><span class="tocnumber">7.1</span> <span class="toctext">Установка аппаратных часов</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B9_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/zabbix/zabbix_server.conf"><span class="tocnumber">7.2</span> <span class="toctext">Проверка значений параметров в файле /etc/zabbix/zabbix_server.conf</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Zabbix"><span class="tocnumber">7.3</span> <span class="toctext">Запуск Zabbix</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_Zabbix_%D0%B2_%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA"><span class="tocnumber">7.4</span> <span class="toctext">Включение Zabbix в автозапуск</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-38"><a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_Zabbix_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B_%D1%81_NetFlow"><span class="tocnumber">8</span> <span class="toctext">Настройка Zabbix для работы с NetFlow</span></a></li>
<li class="toclevel-1 tocsection-39"><a href="#%D0%92%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D0%B5_%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B8"><span class="tocnumber">9</span> <span class="toctext">Внешние источники</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.BD.D0.B5.D0.BE.D0.B1.D1.85.D0.BE.D0.B4.D0.B8.D0.BC.D0.BE.D0.B9_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D0.B8_iksemel_.D0.B4.D0.BB.D1.8F_zabbix-server"></span><span class="mw-headline" id="Установка_необходимой_зависимости_iksemel_для_zabbix-server">Установка необходимой зависимости iksemel для zabbix-server</span>
</h3>
<p>Установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/iksemel/">iksemel</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup> из <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>.
</p>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_zabbix-server"></span><span class="mw-headline" id="Установка_zabbix-server">Установка zabbix-server</span>
</h3>
<p>Загрузите и распакуйте архив, содержащий необходимые файлы для сборки <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zabbix-server">zabbix-server</a></span> из <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>.
</p>
<p>Измените строку в файле <code>PKGBUILD</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nano ./PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
depends=('apache' 'postgresql' 'php' 'php-pgsql' 'php-gd' 'fping' 'net-snmp' 'curl' 'iksemel')
...
</pre>
<p>на
</p>
<pre>...
depends=('nginx' 'postgresql' 'php' 'php-pgsql' 'php-gd' 'php-fpm' 'fping' 'net-snmp' 'curl' 'iksemel')
...
</pre>
<p>Соберите пакет:
</p>
<pre>$ makepkg -s
</pre>
<p>Установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zabbix-server">zabbix-server</a></span>:
</p>
<pre>$ sudo pacman -U zabbix-server-2.0.5-1-x86_64.pkg.tar.xz
</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_PostgreSQL"></span><span class="mw-headline" id="Настройка_PostgreSQL">Настройка PostgreSQL</span>
</h2>
<h3>
<span id=".D0.9F.D0.BE.D0.B4.D0.B3.D0.BE.D1.82.D0.BE.D0.B2.D0.BA.D0.B0_PostgreSQL_.D0.BA_.D0.BF.D0.B5.D1.80.D0.B2.D0.BE.D0.BC.D1.83_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA.D1.83"></span><span class="mw-headline" id="Подготовка_PostgreSQL_к_первому_запуску">Подготовка PostgreSQL к первому запуску</span>
</h3>
<p>Создайте файл <code>tmpfiles.d</code> для <code>/run/postgresql</code>:
</p>
<pre>$ sudo systemd-tmpfiles --create postgresql.conf
</pre>
<p>Создайте папку для хранения баз данных:
</p>
<pre>$ sudo mkdir /var/lib/postgres/data
</pre>
<p>Установите права доступа на папку только для пользователя <code>postgres</code> и группы <code>postgres</code>:
</p>
<pre>$ sudo chown -c postgres:postgres /var/lib/postgres/data
</pre>
<p>Создайте новый кластер базы данных от пользователя <code>postgres</code>:
</p>
<pre>$ sudo su - postgres -c "initdb -D '/var/lib/postgres/data'"
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_PostgreSQL"></span><span class="mw-headline" id="Запуск_PostgreSQL">Запуск PostgreSQL</span>
</h3>
<pre>$ sudo systemctl start postgresql.service
</pre>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8E_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B_postgres"></span><span class="mw-headline" id="Установка_пароля_пользователю_системы_postgres">Установка пароля пользователю системы postgres</span>
</h3>
<pre>$ sudo passwd postgres
</pre>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F_.D1.80.D0.BE.D0.BB.D0.B8_postgres_.D0.B8_.D1.80.D0.B0.D0.B7.D1.80.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BA_.D0.B1.D0.B0.D0.B7.D0.B0.D0.BC_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85_.D1.82.D0.BE.D0.BB.D1.8C.D0.BA.D0.BE_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB_Unix"></span><span class="mw-headline" id="Установка_пароля_роли_postgres_и_разрешение_подключения_к_базам_данных_только_через_протокол_Unix">Установка пароля роли postgres и разрешение подключения к базам данных только через протокол Unix</span>
</h3>
<p>Войдите в консоль <a href="../ru/PostgreSQL.html" title="PostgreSQL (Русский)">PostgreSQL</a> от роли <code>postgres</code>:
</p>
<pre>$ psql -U postgres
</pre>
<p>Установите пароль роли <code>postgres</code>:
</p>
<pre>postgres=# alter user postgres with password '&lt;PASSWORD&gt;';
</pre>
<p>Выйдите из консоли <a href="../ru/PostgreSQL.html" title="PostgreSQL (Русский)">PostgreSQL</a>:
</p>
<pre>postgres=# \q
</pre>
<p>Измените файл <code>/var/lib/postgres/data/pg_hba.conf</code>:
</p>
<pre>$ sudoedit /var/lib/postgres/data/pg_hba.conf
</pre>
<p>Измените следующие строки для установки доступа ролей к базам данных только через протокол Unix:
</p>
<pre>...
host    all             all             127.0.0.1/32            trust
...
host    all             all             ::1/128                 trust
...
</pre>
<p>на
</p>
<pre>...
#host    all             all             127.0.0.1/32            trust
...
#host    all             all             ::1/128                 trust
...
</pre>
<p>Измените следующие строки для установки всем ролям метода аутентификации md5 через протокол Unix:
</p>
<pre>...
local   all             all                                     trust
...
</pre>
<p>на
</p>
<pre>...
local   all             all                                     md5
...
</pre>
<p>Измените строку в файле <code>/var/lib/postgres/data/postgresql.conf</code> для подключения к базам данных только через протокол Unix:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
#listen_addresses = 'localhost'         # what IP address(es) to listen on;
...
</pre>
<p>на
</p>
<pre>...
listen_addresses = ''                   # what IP address(es) to listen on;
...
</pre>
<p>Перезапустите <a href="../ru/PostgreSQL.html" title="PostgreSQL (Русский)">PostgreSQL</a>:
</p>
<pre>$ sudo systemctl restart postgresql.service
</pre>
<h3>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B8_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B1.D0.B0.D0.B7.D1.8B_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85_zabbix_.D0.B4.D0.BB.D1.8F_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D1.81_Zabbix"></span><span class="mw-headline" id="Создание_и_настройка_базы_данных_zabbix_для_работы_с_Zabbix">Создание и настройка базы данных zabbix для работы с Zabbix</span>
</h3>
<p>Создайте роль <code>zabbix</code>:
</p>
<pre>$ createuser -U postgres -d -S -R -P zabbix
</pre>
<p>где <code>-d</code> - роль с правом создания баз данных; <code>-S</code> - роль без полномочий суперпользователя; <code>-R</code> - роль без права создания ролей; <code>-P</code> - назначить пароль новой роли.
</p>
<p>ДОПОЛНИТЕЛЬНО. Измените пароль роли <code>zabbix</code>:
</p>
<pre>$ psql -U postgres
postgres=# \password zabbix
postgres=# \q
</pre>
<p>Создайте базу данных <code>zabbix</code> от роли <code>zabbix</code>:
</p>
<pre>$ createdb --username zabbix -E UTF8 zabbix
</pre>
<p>Проверьте успешность создания базы данных <code>zabbix</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ psql -U postgres -l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">                                  Список баз данных
    Имя    | Владелец | Кодировка | LC_COLLATE  |  LC_CTYPE   |     Права доступа     
-----------+----------+-----------+-------------+-------------+-----------------------
 postgres  | postgres | UTF8      | ru_RU.UTF-8 | ru_RU.UTF-8 | 
 template0 | postgres | UTF8      | ru_RU.UTF-8 | ru_RU.UTF-8 | =c/postgres          +
           |          |           |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8      | ru_RU.UTF-8 | ru_RU.UTF-8 | =c/postgres          +
           |          |           |             |             | postgres=CTc/postgres
 zabbix    | zabbix   | UTF8      | ru_RU.UTF-8 | ru_RU.UTF-8 | 
(4 строки)
</pre>
<p>Заполните базу данных <code>zabbix</code> от роли <code>zabbix</code> необходимой информацией:
</p>
<pre>$ cd /etc/zabbix/database/postgresql
$ psql -U zabbix zabbix &lt; schema.sql
$ psql -U zabbix zabbix &lt; images.sql
$ psql -U zabbix zabbix &lt; data.sql
</pre>
<p>Измените следующие строки в файле <code>/etc/zabbix/zabbix_server.conf</code> для работы Zabbix с <a href="../ru/PostgreSQL.html" title="PostgreSQL (Русский)">PostgreSQL</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/zabbix/zabbix_server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Default:
# DBHost=localhost
...
# Default:
# DBName=
...
# Default:
# DBUser=
...
# Default:
# DBPassword=
...
# Default (for MySQL):
# DBPort=3306
...
</pre>
<p>на
</p>
<pre>...
# Default:
# DBHost=localhost

DBHost=
...
# Default:
# DBName=

DBName=zabbix
...
# Default:
# DBUser=

DBUser=zabbix
...
# Default:
# DBPassword=

DBPassword=&lt;PASSWORD&gt;
...
# Default (for MySQL):
# DBPort=3306

DBPort=5432
</pre>
<h3>
<span id=".D0.94.D0.9E.D0.9F.D0.9E.D0.9B.D0.9D.D0.98.D0.A2.D0.95.D0.9B.D0.AC.D0.9D.D0.9E._.D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8F_.D0.B7.D0.B0_.D0.BE.D0.B1.D1.8A.D0.B5.D0.BC.D0.BE.D0.BC_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D0.B5.D0.BC.D0.BE.D0.B3.D0.BE_Zabbix_.D0.B8_PostgreSQL_.D0.B4.D0.B8.D1.81.D0.BA.D0.BE.D0.B2.D0.BE.D0.B3.D0.BE_.D0.BF.D1.80.D0.BE.D1.81.D1.82.D1.80.D0.B0.D0.BD.D1.81.D1.82.D0.B2.D0.B0_.D0.B4.D0.BB.D1.8F_.D1.80.D0.B5.D0.B4.D0.BA.D0.BE_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D1.8F.D1.8E.D1.89.D0.B5.D0.B9.D1.81.D1.8F_.D0.B1.D0.B0.D0.B7.D1.8B_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"></span><span class="mw-headline" id="ДОПОЛНИТЕЛЬНО._Настройка_контроля_за_объемом_используемого_Zabbix_и_PostgreSQL_дискового_пространства_для_редко_изменяющейся_базы_данных">ДОПОЛНИТЕЛЬНО. Настройка контроля за объемом используемого Zabbix и PostgreSQL дискового пространства для редко изменяющейся базы данных</span>
</h3>
<p>Измените файл <code>/etc/zabbix/zabbix_server.conf</code>:
</p>
<pre>$ sudoedit /etc/zabbix/zabbix_server.conf
</pre>
<p>Измените следующие строки для установки периодичности запуска процедуры очистки базы данных <code>zabbix</code> от устаревшей информации (в часах):
</p>
<pre>...
# Default:
# HousekeepingFrequency=1
...
</pre>
<p>на
</p>
<pre>...
# Default:
# HousekeepingFrequency=1

HousekeepingFrequency=24
...
</pre>
<p>Измените следующие строки для установки ограничения на количество удаляемых за один проход записей:
</p>
<pre>...
# Default:  
# MaxHousekeeperDelete=500
...
</pre>
<p>на
</p>
<pre>...
# Default:  
# MaxHousekeeperDelete=500

MaxHousekeeperDelete=5000
...
</pre>
<p>Проверьте включенность процедуры очистки:
</p>
<pre>...
# Default:  
# DisableHousekeeping=0
...
</pre>
<p>Измените файл <code>/var/lib/postgres/data/postgresql.conf</code>:
</p>
<pre>$ sudoedit /var/lib/postgres/data/postgresql.conf
</pre>
<p>Измените следующую строку для установки большего объема памяти для операций:
</p>
<pre>...
#maintenance_work_mem = 16MB            # min 1MB
...
</pre>
<p>на
</p>
<pre>...
maintenance_work_mem = 512MB            # min 1MB
...
</pre>
<p>Измените следующую строку для выключения процесса <code>autovacuum</code>:
</p>
<pre>...
#autovacuum = on                        # Enable autovacuum subprocess?  'on'
...
</pre>
<p>на
</p>
<pre>...
autovacuum = off                        # Enable autovacuum subprocess?  'on'
...
</pre>
<p>Перезапустите <a href="../ru/PostgreSQL.html" title="PostgreSQL (Русский)">PostgreSQL</a>:
</p>
<pre>$ sudo systemctl restart postgresql.service
</pre>
<p>Для включения запуска <code>vacuumdb</code> в расписание <code>cron</code> пользователя системы <code>postgres</code> создайте и измените файл <code>/var/lib/postgres/.pgpass</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u postgres nano /var/lib/postgres/.pgpass</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*:*:zabbix:postgres:&lt;PASSWORD&gt;
</pre>
<p>Измените права доступа на файл <code>/var/lib/postgres/.pgpass</code>:
</p>
<pre>$ sudo chmod 400 /var/lib/postgres/.pgpass
</pre>
<p>Включите запуск <code>vacuumdb</code> в расписание <code>cron</code> пользователя системы <code>postgres</code> ежедневно в заданное время:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u postgres crontab -e</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">00 00 * * * vacuumdb -U postgres -w -d zabbix -q -z &amp;
</pre>
<p>Запустите <a href="../en/Cron.html" title="Cron">cron</a>:
</p>
<pre>$ sudo systemctl start cronie.service
</pre>
<p>Включите <a href="../en/Cron.html" title="Cron">cron</a> в автозапуск:
</p>
<pre>$ sudo systemctl enable cronie.service
</pre>
<p>Во время проведения профилактических работ запустите <code>vacuumdb</code> для высвобождения дискового пространства:
</p>
<pre>$ sudo -u postgres vacuumdb -U postgres -w -d zabbix -f -v -z
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_PostgreSQL_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_PostgreSQL_в_автозапуск">Включение PostgreSQL в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable postgresql.service
</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_PHP_.D0.B8_FastCGI_Process_Manager"></span><span class="mw-headline" id="Настройка_PHP_и_FastCGI_Process_Manager">Настройка PHP и FastCGI Process Manager</span>
</h2>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9_.D0.BF.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.BE.D0.B2_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fphp.2Fphp.ini"></span><span class="mw-headline" id="Проверка_значений_параметров_в_файле_/etc/php/php.ini">Проверка значений параметров в файле /etc/php/php.ini</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/php/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
max_execution_time = 600
...
max_input_time = 600
...
memory_limit = 256M
...
post_max_size = 32M
...
cgi.fix_pathinfo = 0
...
upload_max_filesize = 16M
...
extension=bcmath.so
...
extension=curl.so
...
extension=gd.so
...
extension=gettext.so
...
extension=pgsql.so
...
extension=sockets.so
...
date.timezone = Europe/Moscow
...
</pre>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9_.D0.BF.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.BE.D0.B2_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fphp.2Fphp-fpm.conf"></span><span class="mw-headline" id="Проверка_значений_параметров_в_файле_/etc/php/php-fpm.conf">Проверка значений параметров в файле /etc/php/php-fpm.conf</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/php/php-fpm.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
;listen = 127.0.0.1:9000
...
listen = /run/php-fpm/php-fpm.sock
...
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_FastCGI_Process_Manager"></span><span class="mw-headline" id="Запуск_FastCGI_Process_Manager">Запуск FastCGI Process Manager</span>
</h3>
<pre>$ sudo systemctl start php-fpm.service
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_FastCGI_Process_Manager_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_FastCGI_Process_Manager_в_автозапуск">Включение FastCGI Process Manager в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable php-fpm.service
</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_NGINX"></span><span class="mw-headline" id="Настройка_NGINX">Настройка NGINX</span>
</h2>
<h3>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.B0.D0.BC.D0.BE.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.BD.D1.8B.D1.85_.D1.81.D0.B5.D1.80.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D0.B2_.D0.B4.D0.BB.D1.8F_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BA_Zabbix_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_HTTPS"></span><span class="mw-headline" id="Создание_самоподписанных_сертификатов_для_подключения_к_Zabbix_через_HTTPS">Создание самоподписанных сертификатов для подключения к Zabbix через HTTPS</span>
</h3>
<pre>$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout zabbix.key -out zabbix.pem
</pre>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D1.89.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.B0.D0.B2_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BD.D0.B0_.D1.84.D0.B0.D0.B9.D0.BB_.D0.BF.D1.80.D0.B8.D0.B2.D0.B0.D1.82.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_zabbix.key"></span><span class="mw-headline" id="Перемещение_и_изменение_прав_доступа_на_файл_приватного_ключа_zabbix.key">Перемещение и изменение прав доступа на файл приватного ключа zabbix.key</span>
</h3>
<pre>$ sudo mv zabbix.key /etc/ssl/private/
$ sudo chown root:root /etc/ssl/private/zabbix.key
$ sudo chmod 400 /etc/ssl/private/zabbix.key
</pre>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D1.89.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.B0.D0.B2_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BD.D0.B0_.D1.84.D0.B0.D0.B9.D0.BB_.D1.81.D0.B5.D1.80.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.B0_zabbix.pem"></span><span class="mw-headline" id="Перемещение_и_изменение_прав_доступа_на_файл_сертификата_zabbix.pem">Перемещение и изменение прав доступа на файл сертификата zabbix.pem</span>
</h3>
<pre>$ sudo mv zabbix.pem /etc/ssl/certs/
$ sudo chown root:root /etc/ssl/certs/zabbix.pem
$ sudo chmod 400 /etc/ssl/certs/zabbix.pem
</pre>
<h3>
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.2Fetc.2Fnginx.2Fnginx.conf"></span><span class="mw-headline" id="Изменение_файла_/etc/nginx/nginx.conf">Изменение файла /etc/nginx/nginx.conf</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">worker_processes  4;

error_log  /var/log/nginx/error.log;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;

    keepalive_timeout  65;

    gzip  off;

    server_tokens  off;

    server {
        listen &lt;IP-ADDRESS&gt;:80;
        server_name  &lt;IP-ADDRESS&gt;;
        rewrite ^ https://$server_name$request_uri? permanent;
    }

    server {
        listen       &lt;IP-ADDRESS&gt;:443;
        server_name  &lt;IP-ADDRESS&gt;;

        charset  utf-8;

        access_log  /var/log/nginx/host.access.log  main;

        ssl                  on;
        ssl_certificate      /etc/ssl/certs/zabbix.pem;
        ssl_certificate_key  /etc/ssl/private/zabbix.key;

        ssl_session_timeout  5m;

        ssl_protocols  SSLv3 TLSv1;
        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers  on;

        location / {
            root   /srv/http/zabbix;
            index  index.php;
        }

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
            root           html;
            fastcgi_pass   unix:/run/php-fpm/php-fpm.sock;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /srv/http/zabbix$fastcgi_script_name;
            include        fastcgi_params;
        }

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        location ~ /\.ht {
            deny  all;
        }

        # deny access to Zabbix files
        location ~* /(?:api|conf|include)/ {
            return 301 $server_name/index.php;
        }
    }
}
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_NGINX"></span><span class="mw-headline" id="Запуск_NGINX">Запуск NGINX</span>
</h3>
<pre>$ sudo systemctl start nginx.service
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_NGINX_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_NGINX_в_автозапуск">Включение NGINX в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable nginx.service
</pre>
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B8_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0_Zabbix"></span><span class="mw-headline" id="Установка_и_настройка_агента_Zabbix">Установка и настройка агента Zabbix</span>
</h2>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_zabbix-agent"></span><span class="mw-headline" id="Установка_zabbix-agent">Установка zabbix-agent</span>
</h3>
<p>Установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zabbix-agent">zabbix-agent</a></span> из <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9_.D0.BF.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.BE.D0.B2_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fzabbix.2Fzabbix_agentd.conf"></span><span class="mw-headline" id="Проверка_значений_параметров_в_файле_/etc/zabbix/zabbix_agentd.conf">Проверка значений параметров в файле /etc/zabbix/zabbix_agentd.conf</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/zabbix/zabbix_agentd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Default:
# Server=

Server=127.0.0.1
...
# Default:
# ListenIP=0.0.0.0

ListenIP=127.0.0.1
...
# Default:
# ServerActive=

ServerActive=127.0.0.1
...
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0_Zabbix"></span><span class="mw-headline" id="Запуск_агента_Zabbix">Запуск агента Zabbix</span>
</h3>
<pre>$ sudo systemctl start zabbix-agentd.service
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0_Zabbix_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_агента_Zabbix_в_автозапуск">Включение агента Zabbix в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable zabbix-agentd.service
</pre>
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B8_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0_NTP"></span><span class="mw-headline" id="Установка_и_настройка_клиента_NTP">Установка и настройка клиента NTP</span>
</h2>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_ntp"></span><span class="mw-headline" id="Установка_ntp">Установка ntp</span>
</h3>
<p>Установите <a href="../ru/Network_Time_Protocol_daemon.html" title="Network Time Protocol daemon (Русский)">ntp</a> из <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официального репозитория</a>:
</p>
<pre>$ sudo pacman -S ntp
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0_NTP"></span><span class="mw-headline" id="Запуск_клиента_NTP">Запуск клиента NTP</span>
</h3>
<pre>$ sudo systemctl start ntpdate.service
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0_NTP_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_клиента_NTP_в_автозапуск">Включение клиента NTP в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable ntpdate.service
</pre>
<p><br>
</p>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_Zabbix"></span><span class="mw-headline" id="Настройка_Zabbix">Настройка Zabbix</span>
</h2>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B0.D0.BF.D0.BF.D0.B0.D1.80.D0.B0.D1.82.D0.BD.D1.8B.D1.85_.D1.87.D0.B0.D1.81.D0.BE.D0.B2"></span><span class="mw-headline" id="Установка_аппаратных_часов">Установка аппаратных часов</span>
</h3>
<pre>$ sudo hwclock --systohc --utc
</pre>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9_.D0.BF.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.BE.D0.B2_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fzabbix.2Fzabbix_server.conf"></span><span class="mw-headline" id="Проверка_значений_параметров_в_файле_/etc/zabbix/zabbix_server.conf">Проверка значений параметров в файле /etc/zabbix/zabbix_server.conf</span>
</h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudoedit /etc/zabbix/zabbix_server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Default:
# StartPollers=5

StartPollers=50
...
# Default:
# ListenIP=0.0.0.0

ListenIP=&lt;IP-ADDRESS&gt;
...
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Zabbix"></span><span class="mw-headline" id="Запуск_Zabbix">Запуск Zabbix</span>
</h3>
<pre>$ sudo systemctl start zabbix-server.service
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_Zabbix_.D0.B2_.D0.B0.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA"></span><span class="mw-headline" id="Включение_Zabbix_в_автозапуск">Включение Zabbix в автозапуск</span>
</h3>
<pre>$ sudo systemctl enable zabbix-server.service
</pre>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_Zabbix_.D0.B4.D0.BB.D1.8F_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D1.81_NetFlow"></span><span class="mw-headline" id="Настройка_Zabbix_для_работы_с_NetFlow">Настройка Zabbix для работы с NetFlow</span>
</h2>
<h2>
<span id=".D0.92.D0.BD.D0.B5.D1.88.D0.BD.D0.B8.D0.B5_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.B8"></span><span class="mw-headline" id="Внешние_источники">Внешние источники</span>
</h2>
<ul>
<li><a rel="nofollow" class="external free" href="http://umgum.com:80/zabbix-server-installation">http://umgum.com:80/zabbix-server-installation</a></li>
<li><a rel="nofollow" class="external free" href="http://umgum.com:80/zabbix-nginx-php-fastcgi">http://umgum.com:80/zabbix-nginx-php-fastcgi</a></li>
<li><a rel="nofollow" class="external free" href="http://umgum.com:80/zabbix-housekeeper-postgresql-vacuum">http://umgum.com:80/zabbix-housekeeper-postgresql-vacuum</a></li>
<li><a rel="nofollow" class="external free" href="http://habrahabr.ru/post/139165/">http://habrahabr.ru/post/139165/</a></li>
<li><a rel="nofollow" class="external free" href="http://help.ubuntu.ru/wiki/nginx-phpfpm">http://help.ubuntu.ru/wiki/nginx-phpfpm</a></li>
<li><a rel="nofollow" class="external free" href="http://www.postgresql.org/docs/8.1/static/libpq-pgpass.html">http://www.postgresql.org/docs/8.1/static/libpq-pgpass.html</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Network_monitoring.html" title="Category:Network monitoring (Русский)">Network monitoring (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Zabbix_with_NGINX_how-to_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=640181">https://wiki.archlinux.org/index.php?title=Zabbix_with_NGINX_how-to_(Русский)&amp;oldid=640181</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 31 October 2020, at 18:20.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
