<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>SSH keys (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-SSH_keys_Русский rootpage-SSH_keys_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">SSH keys (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a>. Дата последней синхронизации: 2014-10-22. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=SSH_keys&amp;diff=0&amp;oldid=341131">изменения</a>.</div>
<p>Ключи SSH служат средством идентификации вас при подключении к серверу SSH с использованием <a href="https://en.wikipedia.org/wiki/ru:%D0%9A%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D1%81_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%BC_%D0%BA%D0%BB%D1%8E%D1%87%D0%BE%D0%BC" class="extiw" title="wikipedia:ru:Криптосистема с открытым ключом">криптосистемы с открытым ключом</a> и <a href="https://en.wikipedia.org/wiki/ru:%D0%92%D1%8B%D0%B7%D0%BE%D0%B2-%D0%BE%D1%82%D0%B2%D0%B5%D1%82_(%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F)" class="extiw" title="wikipedia:ru:Вызов-ответ (аутентификация)">аутентификации вызов-ответ</a>. Одним из непосредственных достоинств этого метода перед традиционной идентификацией с помощью пароля является то, что вы можете быть авторизованы на сервере без регулярной необходимости отсылать ваш пароль через сеть. Даже если кто-либо будет прослушивать ваше соединение, у него не будет возможности перехватить и взломать ваш пароль, поскольку фактически он никогда не передается. Также использование для идентификации ключей SSH устраняет риск, связанный с брут-форс (brute-force) атаками, за счет существенного уменьшения шанса атакующего угадать правильные учетные данные.
</p>
<p>Идентификация при помощи ключей SSH предоставляет дополнительную безопасность, а также может быть более удобным способом, чем традиционная идентификация при помощи пароля. При использовании вместе с программой, называемой агентом SSH, ключи SSH могут подключать вас к серверу или нескольким серверам без необходимости помнить и вводить ваш пароль отдельно для каждой системы.
</p>
<p>У метода использования ключей SSH есть определенные недостатки, и он подходит не для всех, но при этом во многих случаях он может предложить несколько существенных преимуществ. Общее понимание того, как работают ключи SSH, поможет вам решить, как и когда применять их для удовлетворения ваших потребностей. Если вы собираетесь читать эту статью, предполагается, что вы уже знаете основы работы протокола <a href="../ru/OpenSSH.html" class="mw-redirect" title="Secure Shell (Русский)">Secure Shell</a> и <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установили</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">1</span> <span class="toctext">Описание</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F_%D0%BF%D0%B0%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_SSH"><span class="tocnumber">2</span> <span class="toctext">Генерация пары ключей SSH</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#%D0%92%D1%8B%D0%B1%D0%BE%D1%80_%D1%82%D0%B8%D0%BF%D0%B0_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F"><span class="tocnumber">2.1</span> <span class="toctext">Выбор типа шифрования</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#ECDSA"><span class="tocnumber">2.1.1</span> <span class="toctext">ECDSA</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Ed25519"><span class="tocnumber">2.1.2</span> <span class="toctext">Ed25519</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6">
<a href="#%D0%92%D1%8B%D0%B1%D0%BE%D1%80_%D0%BC%D0%B5%D1%81%D1%82%D0%B0_%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_%D0%B8_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F"><span class="tocnumber">2.2</span> <span class="toctext">Выбор места расположения ключа и пароля</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F_%D0%B7%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_%D0%B1%D0%B5%D0%B7_%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%B0%D0%BC%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0"><span class="tocnumber">2.2.1</span> <span class="toctext">Изменение пароля закрытого ключа без изменения самого ключа</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%B8%D0%BC%D0%B8_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%BC%D0%B8"><span class="tocnumber">2.2.2</span> <span class="toctext">Управление несколькими ключами</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%D0%9A%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_%D0%BD%D0%B0_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D0%B9_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80"><span class="tocnumber">3</span> <span class="toctext">Копирование открытого ключа на удалённый сервер</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#%D0%9F%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B9_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4"><span class="tocnumber">3.1</span> <span class="toctext">Простой метод</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%D0%A2%D1%80%D0%B0%D0%B4%D0%B8%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4"><span class="tocnumber">3.2</span> <span class="toctext">Традиционный метод</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="tocnumber">4</span> <span class="toctext">Безопасность</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#%D0%9E%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_authorized_keys"><span class="tocnumber">4.1</span> <span class="toctext">Обеспечение безопасности файла authorized_keys</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0_%D0%BF%D0%BE_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8E"><span class="tocnumber">4.2</span> <span class="toctext">Отключение входа по паролю</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%D0%94%D0%B2%D1%83%D1%85%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%B0%D1%8F_%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F_%D0%B8_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B8"><span class="tocnumber">4.3</span> <span class="toctext">Двухфакторная аутентификация и открытые ключи</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16">
<a href="#%D0%90%D0%B3%D0%B5%D0%BD%D1%82%D1%8B_SSH"><span class="tocnumber">5</span> <span class="toctext">Агенты SSH</span></a>
<ul>
<li class="toclevel-2 tocsection-17">
<a href="#ssh-agent"><span class="tocnumber">5.1</span> <span class="toctext">ssh-agent</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#ssh-agent_%D0%B2_%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B-%D0%BE%D0%B1%D0%B5%D1%80%D1%82%D0%BA%D0%B8"><span class="tocnumber">5.1.1</span> <span class="toctext">ssh-agent в качестве программы-обертки</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#%D0%90%D0%B3%D0%B5%D0%BD%D1%82_GnuPG"><span class="tocnumber">5.2</span> <span class="toctext">Агент GnuPG</span></a></li>
<li class="toclevel-2 tocsection-20">
<a href="#Keychain"><span class="tocnumber">5.3</span> <span class="toctext">Keychain</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D0%B0"><span class="tocnumber">5.3.1</span> <span class="toctext">Альтернативные методы запуска</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22">
<a href="#envoy"><span class="tocnumber">5.4</span> <span class="toctext">envoy</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#envoy_%D1%81_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F%D0%BC%D0%B8_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9,_%D1%85%D1%80%D0%B0%D0%BD%D1%8F%D1%89%D0%B8%D0%BC%D0%B8%D1%81%D1%8F_%D0%B2_kwallet"><span class="tocnumber">5.4.1</span> <span class="toctext">envoy с паролями ключей, хранящимися в kwallet</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-24">
<a href="#x11-ssh-askpass"><span class="tocnumber">5.5</span> <span class="toctext">x11-ssh-askpass</span></a>
<ul>
<li class="toclevel-3 tocsection-25"><a href="#%D0%92%D1%8B%D0%B7%D0%BE%D0%B2_x11-ssh-askpass_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5_%D1%81_ssh-add"><span class="tocnumber">5.5.1</span> <span class="toctext">Вызов x11-ssh-askpass вместе с ssh-add</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B2%D0%BD%D0%B5%D1%88%D0%BD%D0%B5%D0%B3%D0%BE_%D0%B2%D0%B8%D0%B4%D0%B0"><span class="tocnumber">5.5.2</span> <span class="toctext">Настройка внешнего вида</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D1%8B%D0%B5_%D0%BE%D0%BA%D0%BD%D0%B0_%D0%B2%D0%B2%D0%BE%D0%B4%D0%B0_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F"><span class="tocnumber">5.5.3</span> <span class="toctext">Альтернативные диалоговые окна ввода пароля</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-28">
<a href="#pam_ssh"><span class="tocnumber">5.6</span> <span class="toctext">pam_ssh</span></a>
<ul>
<li class="toclevel-3 tocsection-29"><a href="#%D0%98%D0%B7%D0%B2%D0%B5%D1%81%D1%82%D0%BD%D1%8B%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B_pam_ssh"><span class="tocnumber">5.6.1</span> <span class="toctext">Известные проблемы pam_ssh</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-30"><a href="#GNOME_Keyring"><span class="tocnumber">5.7</span> <span class="toctext">GNOME Keyring</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-31">
<a href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC"><span class="tocnumber">6</span> <span class="toctext">Решение проблем</span></a>
<ul>
<li class="toclevel-2 tocsection-32"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_kdm"><span class="tocnumber">6.1</span> <span class="toctext">Использование kdm</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">7</span> <span class="toctext">Смотрите также</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.9E.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Описание">Описание</span>
</h2>
<p>Ключи SSH являются парными: один из них - закрытый, другой - открытый. Закрытый ключ известен только вам, и он должен быть в безопасности. С другой стороны, открытый ключ может свободно раздаваться с любого сервера SSH, к которому вы хотите подключиться.
</p>
<p>Когда у сервера SSH есть ваш открытый ключ в файле, и он видит, что вы запрашиваете соединение, он использует этот открытый ключ, чтобы создать и отправить вам т.н. вызов. Этот вызов является чем-то вроде зашифрованного сообщения, на которое должен поступить соответствующий ответ, чтобы сервер предоставил вам доступ. Безопасным это сообщение делает тот факт, что оно может быть прочитано только кем-то, у кого есть закрытый ключ. Открытый ключ может быть использован для зашифровки сообщения, но расшифровать то же самое сообщение он не сможет. Только вы, держатель закрытого ключа, будете иметь возможность корректно принять вызов и создать соответствующий ответ.
</p>
<p>Этот этап вызов-ответ проходит незаметно для пользователя. До тех пор, пока у вас есть закрытый ключ, который обычно хранится в каталоге <code>~/.ssh/</code>, ваш клиент SSH будет иметь возможность отправить правильный ответ серверу.
</p>
<p>Поскольку закрытые ключи считаются конфиденциальной информацией, обычно они хранятся на диске в зашифрованном виде. По этой причине, когда запрашивается закрытый ключ, необходимо ввести пароль для расшифровки этого ключа. Внешне это может быть похоже на ввод пароля непосредственно на сервере SSH, но это не так: этот пароль используется только для расшифровки закрытого ключа в вашей локальной системе. Этот пароль не передается и не должен передаваться через сеть.
</p>
<h2>
<span id=".D0.93.D0.B5.D0.BD.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D1.8F_.D0.BF.D0.B0.D1.80.D1.8B_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9_SSH"></span><span class="mw-headline" id="Генерация_пары_ключей_SSH">Генерация пары ключей SSH</span>
</h2>
<p>Пара ключей SSH может быть сгенерирована при помощи команды <code>ssh-keygen</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ssh-keygen -t ecdsa -b 521 -C "$(whoami)@$(hostname)-$(date -I)"
</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Generating public/private ecdsa key pair.
Enter file in which to save the key (/home/username/.ssh/id_ecdsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/username/.ssh/id_ecdsa.
Your public key has been saved in /home/username/.ssh/id_ecdsa.pub.
The key fingerprint is:
dd:15:ee:24:20:14:11:01:b8:72:a2:0f:99:4c:79:7f username@localhost-2011-12-22
The key's randomart image is:
+--[ECDSA  521]---+
|     ..oB=.   .  |
|    .    . . . . |
|  .  .      . +  |
| oo.o    . . =   |
|o+.+.   S . . .  |
|=.   . E         |
| o    .          |
|  .              |
|                 |
+-----------------+</pre>
<p>В данном примере команда <code>ssh-keygen</code> генерирует пару (открытый и закрытый) ключей ECDSA (<code>-t ecdsa</code>) длиной 521 бит (<code>-b 521</code>) с расширенным комментарием, включающим указанные данные (<code>-C "$(whoami)@$(hostname)-$(date -I)"</code>). <a rel="nofollow" class="external text" href="https://www.cs.berkeley.edu/~dawnsong/papers/randomart.pdf">Изображение randomart</a> было введено в OpenSSH 5.1 в качестве простого средства визуальной идентификации отпечатка ключа.
</p>
<h3>
<span id=".D0.92.D1.8B.D0.B1.D0.BE.D1.80_.D1.82.D0.B8.D0.BF.D0.B0_.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Выбор_типа_шифрования">Выбор типа шифрования</span>
</h3>
<p>Обеспечивая примерно такой же уровень безопасности, как и предыдущие методы, ECDSA (the Elliptic Curve Digital Signature Algorithm) предусматривает меньший размер ключей и более быстрое выполнение операций.  Он был введен в качестве предпочтительного алгоритма для аутентификации в OpenSSH 5.7 (смотрите <a rel="nofollow" class="external text" href="https://www.openssh.com/txt/release-5.7">примечания к выпуску OpenSSH 5.7</a>). <b>Ключи ECDSA могут быть несовместимы с системами, которые используют старые версии OpenSSH.</b> Некоторые производители также отключают необходимые реализации в связи с возможным появлением патентных вопросов.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> По состоянию на 28 декабря 2013 г. SSH-клиент для Windows "PuTTY" не поддерживает ECDSA и, следовательно, не может подключаться к серверам, использующим ключи ECDSA</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> По состоянию на 10 июня 2014 г. ключи ECDSA не будут работать в Gnome Keyring (связке ключей GNOME) из-за известного <a rel="nofollow" class="external text" href="https://bugzilla.gnome.org/show_bug.cgi?id=641082">бага GNOME</a>
</div>
<p>Если вы хотите создать пару ключей RSA (2048-16384 бит) или DSA (2048 бита) вместо ECDSA, используйте параметр <code>-t rsa</code> или <code>-t dsa</code> соответственно в вашей команде <code>ssh-keygen</code> и не забудьте увеличить размер ключа. Выполнение <code>ssh-keygen</code> без параметра <code>-b</code> установит разумные значения по умолчанию.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Эти ключи используются только для идентификации: выбор более сильных ключей не увеличит нагрузку на процессор, возникающую при передаче данных через SSH</div>
<h4><span class="mw-headline" id="ECDSA">ECDSA</span></h4>
<p>Алгоритм цифровой подписи эллиптической кривой (ECDSA) был введен в качестве предпочтительного алгоритма аутентификации в OpenSSH 5.7. Некоторые поставщики также отключают требуемые реализации из-за потенциальных проблем с патентами.
Есть два вида проблем:
</p>
<ol>
<li><i>Политические проблемы", достоверность кривых, подготовленных NIST, ставятся под сомнение после того, как откровения о том, что NSA охотно вставляют бэкдоры в программное обеспечение, аппаратные компоненты и опубликованные стандарты; Известные криптографы высказывали сомнения относительно того, как были разработаны кривые NIST, и добровольное заражение уже было доказано в прошлом.</i></li>
<li>'Технические проблемы", связанные с трудностью надлежащего внедрения стандарта, а также медлительностью и недостатками дизайна, снижающими безопасность в недостаточно ранних реализациях.</li>
</ol>
<p>Обе эти проблемы лучше всего изложены в libssh curve25519. Несмотря на то, что политические проблемы все еще обсуждаются, существует четкий консенсус в отношении того, что # Ed25519 технически превосходен и поэтому должен быть предпочтительным.
</p>
<h4><span class="mw-headline" id="Ed25519">Ed25519</span></h4>
<p>Ed25519 был представлен в OpenSSH 6.5: «Ed25519 - это схема сигнатур эллиптической кривой, которая обеспечивает лучшую защиту, чем ECDSA и DSA, и хорошую производительность». Его главными достоинствами являются его скорость, время работы с постоянным временем (и сопротивление боковым каналам) и отсутствие туманных жестко заданных констант [8]. См. Также этот пост в блоге разработчиком Mozilla о том, как он работает.
Он уже реализован во многих приложениях и библиотеках и является алгоритмом обмена ключами по умолчанию (который отличается от ключевой сигнатуры) в OpenSSH.
</p>
<p>Ed25519 пара может быть сгенерирована с помощью:
</p>
<pre>$ ssh-keygen -t ed25519
</pre>
<p>Нет необходимости устанавливать размер ключа, так как все ключи Ed25519 имеют 256 бит. Кроме того, они полагаются на новый формат ключа, который «использует функцию деривации ключа на основе bcrypt, которая делает атаки с грубой силой против украденных частных ключей намного медленнее».
По этой причине совместимость со старыми версиями OpenSSH или другими клиентами и серверами SSH может оказаться проблематичной.
</p>
<h3>
<span id=".D0.92.D1.8B.D0.B1.D0.BE.D1.80_.D0.BC.D0.B5.D1.81.D1.82.D0.B0_.D1.80.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_.D0.B8_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F"></span><span class="mw-headline" id="Выбор_места_расположения_ключа_и_пароля">Выбор места расположения ключа и пароля</span>
</h3>
<p>Во время выполнения команды <code>ssh-keygen</code> вам будет предложено выбрать подходящие имя и место расположения для вашего закрытого ключа. По умолчанию ключи будут расположены в каталоге <code>~/.ssh/</code> и названы в соответствии с используемым типом шифрования. Рекомендуем вам принять имя и расположение, предлагаемые по умолчанию, чтобы примеры, приведенные далее в этой статье, работали корректно.
</p>
<p>Когда вам будет предложено ввести пароль, введите что-нибудь сложное, если вы заботитесь о безопасности вашего закрытого ключа. Более длинный пароль с большим количеством случайных символов, как правило, будет сложнее подобрать. Это позволит снизить риск предоставления доступа неизвестным лицам.
</p>
<p>Также есть возможность создать ваш закрытый ключ без пароля. Это может быть удобным, но вы должны знать о возможных рисках. При отсутствии пароля ваш закрытый ключ будет храниться на диске в незашифрованном виде. Любой человек, который получит доступ к файлу вашего закрытого ключа, будет иметь возможность подключаться ко всем серверам SSH, к которым вы подключаетесь, используя аутентификацию при помощи ключей. Кроме того, без пароля вы должны доверять суперпользователю (root), поскольку он может обойти права доступа к файлу и получить незашифрованный закрытый ключ в любой момент.
</p>
<h4>
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F_.D0.B7.D0.B0.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_.D0.B1.D0.B5.D0.B7_.D0.B8.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F_.D1.81.D0.B0.D0.BC.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Изменение_пароля_закрытого_ключа_без_изменения_самого_ключа">Изменение пароля закрытого ключа без изменения самого ключа</span>
</h4>
<p>Если выбранный пароль для ключа SSH нежелателен или должен быть изменен, можно использовать команду <code>ssh-keygen</code>, не меняя при этом самого ключа.
</p>
<p>Для смены пароля закрытого ключа RSA выполните следующую команду:
</p>
<pre>$ ssh-keygen -f ~/.ssh/id_rsa -p
</pre>
<h4>
<span id=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D1.81.D0.BA.D0.BE.D0.BB.D1.8C.D0.BA.D0.B8.D0.BC.D0.B8_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0.D0.BC.D0.B8"></span><span class="mw-headline" id="Управление_несколькими_ключами">Управление несколькими ключами</span>
</h4>
<p>Существует возможность управления ключами каждого хоста при помощи создания файла <code>~/.ssh/config</code> и, в случае необходимости, присвоения каждому хосту другого ключа аутентификации. На самом деле в этом нет необходимости, поскольку вы можете использовать одинаковые идентификаторы для каждого хоста. Но все же, если вы не хотите использовать один и тот же ключ для каждого клиента, создайте файл, как показано здесь:
</p>
<pre>Host ИМЯ_СЕРВЕРА1
  IdentitiesOnly yes
  IdentityFile ~/.ssh/id_rsa_SERVER1
  # CheckHostIP yes
  # Port 22
Host ИМЯ_СЕРВЕРА2
  IdentitiesOnly yes
  IdentityFile ~/.ssh/id_rsa_SERVER2
  # CheckHostIP no
  # Port 2177
ControlMaster auto
ControlPath /tmp/%r@%h:%p
</pre>
<p>Гораздо больше опций вы найдете на странице справочного руководства:
</p>
<pre>$ man ssh_config 5
</pre>
<h2>
<span id=".D0.9A.D0.BE.D0.BF.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_.D0.BD.D0.B0_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D1.8B.D0.B9_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80"></span><span class="mw-headline" id="Копирование_открытого_ключа_на_удалённый_сервер">Копирование открытого ключа на удалённый сервер</span>
</h2>
<p>После того, как вы сгенерировали пару ключей, необходимо скопировать открытый ключ на удаленный сервер, чтобы он использовал аутентификацию по ключам SSH. Файл открытого ключа носит то же имя, что и файл закрытого, но имеет расширение <code>.pub</code>. Обратите внимание, что закрытый ключ не раздается, он должен оставаться только на локальной машине.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4"></span><span class="mw-headline" id="Простой_метод">Простой метод</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Этот метод может не сработать, если на удаленном сервере по умолчанию используется "не-<code>sh</code> оболочка", вроде <code>tcsh</code>. Смотрите <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=1045191">этот багрепорт</a>
</div>
<p>Если ваш ключ хранится в файле <code>~/.ssh/id_rsa.pub</code>, достаточно выполнить следующую команду:
</p>
<pre>$ ssh-copy-id remote-server.org
</pre>
<p>Если ваше имя пользователя на удаленной машине отличается, не забудьте предварить имя сервера именем пользователя, разделив их знаком <code>@</code>:
</p>
<pre>$ ssh-copy-id имя_пользователя@remote-server.org
</pre>
<p>Если имя файла вашего открытого ключа отличается от используемого по умолчанию <code>~/.ssh/id_rsa.pub</code>, вы увидите ошибку <code>/usr/bin/ssh-copy-id: ERROR: No identities found</code>. В этом случае вы должны прямо указать расположение открытого ключа:
</p>
<pre>$ ssh-copy-id -i ~/.ssh/id_ecdsa.pub имя_пользователя@remote-server.org
</pre>
<p>Если сервер ssh прослушивает порт, отличный от используемого по умолчанию порта 22, не забудьте указать это:
</p>
<pre>$ ssh-copy-id -i ~/.ssh/id_ecdsa.pub -p 221 имя_пользователя@remote-server.org
</pre>
<h3>
<span id=".D0.A2.D1.80.D0.B0.D0.B4.D0.B8.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4"></span><span class="mw-headline" id="Традиционный_метод">Традиционный метод</span>
</h3>
<p>По умолчанию, принятому в OpenSSH, открытый ключ должен быть "связан" (concatenated) с <code>~/.ssh/authorized_keys</code>. Начните копирование открытого ключа на удаленный сервер:
</p>
<pre>$ scp ~/.ssh/id_ecdsa.pub имя_пользователя@remote-server.org:
</pre>
<p>Приведенная команда копирует открытый ключ (<code>id_ecdsa.pub</code>) в ваш домашний каталог на удаленном сервере, используя <code>scp</code>. Не забудьте поставить двоеточие (<code>:</code>) в конце адреса сервера. Также помните, что имя вашего открытого ключа может отличаться от имени, использованного в приведенном примере.
</p>
<p>На удаленном сервере вам необходимо создать каталог <code>~/.ssh</code>, если он еще не существует, и добавить ваш открытый ключ в файл <code>authorized_keys</code>:
</p>
<pre>$ ssh имя_пользователя@remote-server.org
имя_пользователя@remote-server.org's password:
$ mkdir ~/.ssh
$ chmod 700 ~/.ssh
$ cat ~/id_ecdsa.pub &gt;&gt; ~/.ssh/authorized_keys
$ rm ~/id_ecdsa.pub
$ chmod 600 ~/.ssh/authorized_keys
</pre>
<p>Последние две команды удаляют файл открытого ключа с сервера и устанавливают права доступа для файла <code>authorized_keys</code> таким образом, чтобы чтение/запись могли производить только вы, владелец.
</p>
<h2>
<span id=".D0.91.D0.B5.D0.B7.D0.BE.D0.BF.D0.B0.D1.81.D0.BD.D0.BE.D1.81.D1.82.D1.8C"></span><span class="mw-headline" id="Безопасность">Безопасность</span>
</h2>
<h3>
<span id=".D0.9E.D0.B1.D0.B5.D1.81.D0.BF.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B1.D0.B5.D0.B7.D0.BE.D0.BF.D0.B0.D1.81.D0.BD.D0.BE.D1.81.D1.82.D0.B8_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_authorized_keys"></span><span class="mw-headline" id="Обеспечение_безопасности_файла_authorized_keys">Обеспечение безопасности файла authorized_keys</span>
</h3>
<p>Для дополнительной защиты вы можете запретить пользователям добавлять новые открытые ключи и подключаться с их помощью.
</p>
<p>Сделайте файл <code>authorized_keys</code> доступным только для чтения пользователям и запретите все остальное:
</p>
<pre>$ chmod 400 ~/.ssh/authorized_keys
</pre>
<p>Для того, чтобы лишить пользователей возможности вернуть права доступа обратно, установите защитный (immutable) бит для файла <code>authorized_keys</code>:
</p>
<pre># chattr +i ~/.ssh/authorized_keys
</pre>
<p>После этого у пользователей остается возможность переименовать каталог <code>~/.ssh</code> и создать другую директорию с именем <code>~/.ssh</code>, а в ней - другой файл <code>authorized_keys</code>. Чтобы запретить эти действия установите защитный (immutable) бит для каталога <code>~/.ssh</code>:
</p>
<pre># chattr +i ~/.ssh
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вам в дальнейшем будет необходимо добавить новый ключ, сперва понадобится убрать защитный бит с файла <code>authorized_keys</code> и предоставить права на запись. После того, как вы внесете необходимые изменения, следуйте инструкциям, приведенным выше, чтобы вновь обеспечить безопасность этого файла</div>
<h3>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0_.D0.BF.D0.BE_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8E"></span><span class="mw-headline" id="Отключение_входа_по_паролю">Отключение входа по паролю</span>
</h3>
<p>Несмотря на то, что копирование вашего открытого ключа на удаленный сервер SSH исключает необходимость передавать пароль через сеть, оно не дает никакой дополнительной защиты против брут-форс (brute-force) атак. В случае отсутствия нужного открытого ключа сервер SSH предложит аутентификацию по паролю, предоставляя таким образом злоумышленнику возможность попытаться получить доступ подбором пароля. Чтобы отключить подобное поведение, отредактируйте следующие строки в файле <code>/etc/ssh/sshd_config</code> на удаленном сервере:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PasswordAuthentication no
ChallengeResponseAuthentication no</pre>
<h3>
<span id=".D0.94.D0.B2.D1.83.D1.85.D1.84.D0.B0.D0.BA.D1.82.D0.BE.D1.80.D0.BD.D0.B0.D1.8F_.D0.B0.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D1.8F_.D0.B8_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D1.8B.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B8"></span><span class="mw-headline" id="Двухфакторная_аутентификация_и_открытые_ключи">Двухфакторная аутентификация и открытые ключи</span>
</h3>
<p>Начиная с OpenSSH версии 6.2, вы можете добавить свою собственную систему (chain) для аутентификации при помощи опции <code>AuthenticationMethods</code>. Это позволит вам использовать открытые ключи так же, как и двухфакторную авторизацию.
</p>
<p>Для настройки аутентификатора Google смотрите статью <a href="../en/Google_Authenticator.html" title="Google Authenticator">Google Authenticator</a>.
</p>
<p>Для использования PAM с OpenSSH отредактируйте следующие строки:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ChallengeResponseAuthentication yes
AuthenticationMethods publickey keyboard-interactive:pam
</pre>
<p>Теперь вы можете подключиться либо при помощи открытого ключа, либо при помощи комбинации пароля и проверочного кода.
</p>
<h2>
<span id=".D0.90.D0.B3.D0.B5.D0.BD.D1.82.D1.8B_SSH"></span><span class="mw-headline" id="Агенты_SSH">Агенты SSH</span>
</h2>
<p>Если ваш закрытый ключ зашифрован с использованием пароля, этот пароль должен вводиться каждый раз при попытке подключения к серверу SSH. Каждое использование <code>ssh</code> или <code>scp</code> потребует ввода пароля для расшифровки вашего закрытого ключа, чтобы доступ был разрешен.
</p>
<p>Агент SSH - это программа, которая кэширует ваши зашифрованные закрытые ключи и предоставляет их программам-клиентам SSH от вашего имени.  При их использовании вы должны будете ввести ваш пароль только один раз: при добавлении закрытого ключа в кэш агента. Это может быть очень удобно при частом подключении по SSH.
</p>
<p>Обычно агент настраивается таким образом, чтобы он запускался автоматически при входе в систему и работал на протяжении всего времени, пока вы не завершите сеанс. Существуют различные агенты, фронт-энды и конфигурации для достижения этой цели. Этот раздел описывает некоторые решения, которые могут быть адаптированы под ваши конкретные нужды.
</p>
<h3><span class="mw-headline" id="ssh-agent">ssh-agent</span></h3>
<p>ssh-agent - это агент по умолчанию, используемый в OpenSSH. Он может использоваться непосредственно или выступать в качестве бэкэнда для некоторых фронт-энд решений, упоминаемых далее в этом разделе. Когда <code>ssh-agent</code> запущен, он работает самостоятельно в фоновом режиме и отображает переменные окружения, которые использует.
</p>
<pre>$ ssh-agent
SSH_AUTH_SOCK=/tmp/ssh-vEGjCM2147/agent.2147; export SSH_AUTH_SOCK;
SSH_AGENT_PID=2148; export SSH_AGENT_PID;
echo Agent pid 2148;
</pre>
<p>Чтобы использовать эти переменные, выполните команду с использованием <code>eval</code>:
</p>
<pre>$ eval $(ssh-agent)
Agent pid 2157
</pre>
<p>Вы можете добавить приведенную команду в ваш <code>~/.bash_profile</code>, чтобы агент запускался автоматически при входе в систему:
</p>
<pre>$ echo 'eval $(ssh-agent)' &gt;&gt; ~/.bash_profile
</pre>
<p>Если вы хотите, чтобы ssh-agent запускался автоматически вне зависимости от того, кто из пользователей входит в систему, примените эту команду к другому файлу - <code>/etc/profile</code>:
</p>
<pre># echo 'eval $(ssh-agent)' &gt;&gt; /etc/profile
</pre>
<p>После запуска <code>ssh-agent</code> вам нужно будет добавить ваш закрытый ключ в его кэш:
</p>
<pre>$ ssh-add ~/.ssh/id_ecdsa
Enter passphrase for /home/user/.ssh/id_ecdsa:
Identity added: /home/user/.ssh/id_ecdsa (/home/user/.ssh/id_ecdsa)
</pre>
<p>Если вы захотите, чтобы ваши закрытые ключи добавлялись автоматически при входе в систему, добавьте следующую команду в ваш <code>~/.bash_profile</code>:
</p>
<pre>$ ssh-add
</pre>
<p>В этом случае, если ваш закрытый ключ зашифрован, <code>ssh-add</code> предложит ввести ваш пароль. После того, как ваш закрытый ключ будет успешно добавлен в агент, вы сможете подключаться по SSH без необходимости вводить пароль.
</p>
<p>Если вы хотите получать предложение ввести пароль только тогда, когда он понадобится, добавьте
</p>
<pre>$ ssh-add -l &gt;/dev/null || alias ssh='ssh-add -l &gt;/dev/null || ssh-add &amp;&amp; unalias ssh; ssh'
</pre>
<p>в файл <code>~/.bashrc</code>, чтобы <code>ssh-add</code> запускался при необходимости.
</p>
<p>Недостатком этого подхода является то, что новый экземпляр <code>ssh-agent</code> будет запускаться при каждом новом входе в систему, и каждый экземпляр будет сохраняться между сессиями. Через некоторое время вы можете столкнуться с тем, что будет запущено много ненужный копий <code>ssh-agent</code>. Существую фронт-энды к ssh-agent, а также альтернативные агенты, которые описаны далее в этом разделе, не допускающие подобного поведения.
</p>
<h4>
<span id="ssh-agent_.D0.B2_.D0.BA.D0.B0.D1.87.D0.B5.D1.81.D1.82.D0.B2.D0.B5_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.8B-.D0.BE.D0.B1.D0.B5.D1.80.D1.82.D0.BA.D0.B8"></span><span class="mw-headline" id="ssh-agent_в_качестве_программы-обертки">ssh-agent в качестве программы-обертки</span>
</h4>
<p>Альтернативная возможность запуска ssh-agent (например, с каждой X-сессией) описана в <a rel="nofollow" class="external text" href="http://upc.lbl.gov/docs/user/sshagent.shtml">этом руководстве по ssh-agent от UC Berkeley Labs</a>. Основной вариант использования - запуск X-сессии при помощи команды <code>startx</code>. В этом случае вы можете использовать префикс <code>ssh-agent</code>, как указано в следующем примере:
</p>
<pre>$ ssh-agent startx
</pre>
<p>В этом случае нет необходимости думать о том, чтобы добавлять алиасы в ваш файл <code>.bash_aliases</code> или ему подобные:
</p>
<pre>alias startx='ssh-agent startx'
</pre>
<p>Использование данного метода решает проблему запуска множества процессов <code>ssh-agent</code>. Только один процесс будет работать до тех пор, пока запущена X-сессия.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Также вы можете добавить строку <code>eval $(ssh-agent)</code> в файл <code>~/.xinitrc</code>.</div>
<p>Обратитесь к <a href="#%D0%92%D1%8B%D0%B7%D0%BE%D0%B2_x11-ssh-askpass_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5_%D1%81_ssh-add">данным заметкам для использования x11-ssh-askpass вместе с ssh-add</a> по вопросу, связанному с быстрым добавлением вашего ключа в агент.
</p>
<h3>
<span id=".D0.90.D0.B3.D0.B5.D0.BD.D1.82_GnuPG"></span><span class="mw-headline" id="Агент_GnuPG">Агент GnuPG</span>
</h3>
<p>Агент <a href="../ru/GnuPG.html" title="GnuPG (Русский)">GnuPG</a>, распространяемый в пакете <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span>, доступном в <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториях</a>, имеет поддержку эмуляции агента OpenSSH. Если вы уже используете GnuPG, вы можете также кэшировать ваши ключи SSH с его помощью. Также некоторые пользователи могут предпочесть диалог ввода PIN-кода, который имеется в агенте GnuPG как часть его системы управления паролями.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы используете KDE и у вас установлен пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kde-agent">kde-agent</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup>, вам необходимо лишь добавить <code>enable-ssh-support</code> в файл <code>~/.gnupg/gpg-agent.conf</code>! В ином случае продолжайте чтение</div>
<p>Чтобы начать использовать агент GnuPG для ваших ключей SSH, необходимо сперва запустить <i>gpg-agent</i> с опцией <code>--enable-ssh-support</code>. Пример (не забудьте сделать файл исполняемым):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/profile.d/gpg-agent.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

# Start the GnuPG agent and enable OpenSSH agent emulation
gnupginf="${HOME}/.gpg-agent-info"

if pgrep -x -u "${USER}" gpg-agent &gt;/dev/null 2&gt;&amp;1; then
    eval `cat $gnupginf`
    eval `cut -d= -f1 $gnupginf | xargs echo export`
else
    eval `gpg-agent -s --enable-ssh-support --daemon --write-env-file "$gnupginf"`
fi
</pre>
<p>После запуска <i>gpg-agent</i> вы можете использовать <i>ssh-add</i> для добавления ключей так же, как вы это делали с <i>ssh-agent</i>. Список санкционированных ключей находится в файле <code>~/.gnupg/sshcontrol</code>. Как только ваш ключ будет принят, вы увидите диалог ввода PIN-кода каждый раз, когда потребуется ваш пароль. Вы можете управлять кэшированием паролей в файле <code>~/.gnupg/gpg-agent.conf</code>. Следующий пример заставит <i>gpg-agent</i> кэшировать ваши ключи на протяжении трех часов:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  # Cache settings
  default-cache-ttl 10800
  default-cache-ttl-ssh 10800
</pre>
<p>Среди других полезных настроек в этом файле - программа ввода PIN-кода (версии GTK, QT или ncurses), захват клавиатуры (keyboard grabbing) и прочее...
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <code>gpg-agent.conf</code> должен быть создан, и должна быть установлена переменная <code>write-env-file</code>, чтобы позволить ключам <i>gpg-agent</i> вводиться в SSH, пока вы не перезапустите <i>gpg-agent</i>, и, следовательно, экспортировать эти настройки при каждом входе</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  # Environment file
  write-env-file /home/username/.gpg-agent-info
  
  # Keyboard control
  #no-grab
    
  # PIN entry program
  #pinentry-program /usr/bin/pinentry-curses
  #pinentry-program /usr/bin/pinentry-qt4
  #pinentry-program /usr/bin/pinentry-kwallet
  pinentry-program /usr/bin/pinentry-gtk-2

</pre>
<p>Чтобы использовать агент, вы можете указать в качестве источника и экспортировать переменные окружения, которые <i>gpg-agent</i> записывает в <code>.gpg-agent-info</code>, файл, указанный в <code>write-env-file</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

if [ -f "${HOME}/.gpg-agent-info" ]; then
  . "${HOME}/.gpg-agent-info"
  export GPG_AGENT_INFO
  export SSH_AUTH_SOCK
fi
</pre>
<h3><span class="mw-headline" id="Keychain">Keychain</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.funtoo.org/Keychain">Keychain</a> - это программа, разработанная, чтобы предоставить вам простой способ управления ключами  SSH при минимальном взаимодействии с пользователем. Она реализована как скрипт оболочки, который использует <i>ssh-agent</i> и <i>ssh-add</i>. Примечательная функция Keychain - то, что он может поддерживать один процесс <i>ssh-agent</i> во время работы нескольких пользователей. Это значит, что вам потребуется лишь один раз ввести ваш пароль при запуске системы.
</p>
<p><a href="../ru/Pacman.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BE%D1%82%D0%B4%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=keychain">keychain</a></span>, доступный в <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториях</a>.
</p>
<p>Добавьте следующую строку в файл <code>~/.bash_profile</code> или создайте <code>/etc/profile.d/keychain.sh</code> от имени суперпользователя, после чего сделайте его исполняемым (например, <code>chmod 755 keychain.sh</code>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bash_profile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">eval $(keychain --eval --agents ssh -Q --quiet id_ecdsa)
</pre>
<p>В данном примере флаг <code>--eval</code> выводит строки команды <code>eval</code>. Это позволяет необходимым переменным окружения клиента SSH использоваться в вашем агенте. Флаг <code>--agents</code> не столь необходим, поскольку Keychain создаст список автоматически, основываясь на существовании в системе <i>ssh-agent</i> или <i>gpg-agent</i>. Добавление флага <code>--quiet</code> ограничит вывод предупреждениями, ошибками и обращениями к пользователю. Если вам необходима дополнительная безопасность, замените флаг <code>-Q</code> на <code>--clear</code>, но вам будет не так удобно.
</p>
<p>Если необходимо, замените <code>~/.ssh/id_ecdsa</code> на путь к вашему закрытому ключу. Если вы используете несовместимую с Bash оболочку, смотрите <code>keychain --help</code> или <span class="plainlinks archwiki-template-man" title="$ man 1 keychain"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/keychain.1">keychain(1)</a></span> для получения информации по использованию.
</p>
<p>Чтобы протестировать Keychain, завершите вашу сессию и войдите заново. Если вы запустили Keychain первый раз, будет предложено ввести пароль от указанного закрытого ключа. Поскольку Keychain продолжает использовать тот же процесс <i>ssh-agent</i> в успешных входах в систему, у вас не будет необходимости вводить пароль в следующий раз: это потребуется только после перезагрузки машины.
</p>
<h4>
<span id=".D0.90.D0.BB.D1.8C.D1.82.D0.B5.D1.80.D0.BD.D0.B0.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BC.D0.B5.D1.82.D0.BE.D0.B4.D1.8B_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA.D0.B0"></span><span class="mw-headline" id="Альтернативные_методы_запуска">Альтернативные методы запуска</span>
</h4>
<p>Существуют разнообразные способы запуска Keychain, и вам предлагается поэксперементировать, чтобы выбрать то, что будет работать у вас. Команда <code>keychain</code> имеет множество опций командной строки, которые описаны на странице руководства (man) Keychain.
</p>
<p>Одна из доступных реализаций скрипта запуска Keychain - создание файла <code>/etc/profile.d/keychain.sh</code> от имени суперпользователя и добавление в него следующих строк:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/profile.d/keychain.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/usr/bin/keychain -Q -q --nogui ~/.ssh/id_ecdsa
[[ -f $HOME/.keychain/$HOSTNAME-sh ]] &amp;&amp; source $HOME/.keychain/$HOSTNAME-sh
</pre>
<p>Не забудьте также сделать файл <code>/etc/profile.d/keychain.sh</code> исполняемым, изменив его права доступа:
</p>
<pre># chmod 755 /etc/profile.d/keychain.sh
</pre>
<p>Если вы не хотите получать запрос на ввод пароля каждый раз, когда вы входите в систему, а желаете, чтобы он появлялся только при попытке подключения, можно добавить следующую строку в ваш <code>~/.bashrc</code>:
</p>
<pre>alias ssh='eval $(/usr/bin/keychain --eval --agents ssh -Q --quiet ~/.ssh/id_ecdsa) &amp;&amp; ssh'
</pre>
<p>При этом запрос появится тогда, когда вы используете SSH в первый раз. Помните, однако, что подобный запрос <i>будет лишь в том случае</i>, если <code>~/.bashrc</code> будет применим (applicable). Так что вам необходимо будет проверять, что ваша первая команда SSH будет выполняться в терминале.
</p>
<h3><span class="mw-headline" id="envoy">envoy</span></h3>
<p>Альтернативой keychain является <a rel="nofollow" class="external text" href="https://github.com/vodik/envoy">envoy</a>. Envoy доступен в пакете <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/envoy/">envoy</a></span><sup><small>AUR</small></sup> из <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториев</a>. Также можно воспользоваться Git-версией из <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>, установив пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/envoy-git/">envoy-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>После установки включите сокет командой
</p>
<pre> # systemctl enable envoy@ssh-agent.socket
</pre>
<p>и добавьте следующие строки в файл rc вашей оболочки:
</p>
<pre> envoy -t ssh-agent -a <i>ключ_ssh</i>
 source &lt;(envoy -p)
</pre>
<p>Если ключ расположен в файле <code>~/.ssh/id_rsa</code>, <code>~/.ssh/id_dsa</code>, <code>~/.ssh/id_ecdsa</code> или <code>~/.ssh/identity</code>, нет необходимости указывать параметр <code>-a <i>ключ_ssh</i></code>.
</p>
<h4>
<span id="envoy_.D1.81_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F.D0.BC.D0.B8_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9.2C_.D1.85.D1.80.D0.B0.D0.BD.D1.8F.D1.89.D0.B8.D0.BC.D0.B8.D1.81.D1.8F_.D0.B2_kwallet"></span><span class="mw-headline" id="envoy_с_паролями_ключей,_хранящимися_в_kwallet">envoy с паролями ключей, хранящимися в kwallet</span>
</h4>
<p>Если вы установили длинные пароли для ваших ключей SSH, возможно, вам будет трудно их помнить. Давайте сделаем так, чтобы этим занимался kwallet! Помимо пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/envoy/">envoy</a></span><sup><small>AUR</small></sup> установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ksshaskpass">ksshaskpass</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdeutils-kwalletmanager">kdeutils-kwalletmanager</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup> из <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториев</a>. После этого включите сокет envoy в systemd (см. выше).
</p>
<p>Создайте скрипт <code>~/.kde4/Autostart/ssh-agent.sh</code>:
</p>
<pre>#!/bin/sh
envoy -t ssh-agent -a <i>ключ_ssh</i>
</pre>
<p>Затем сделайте этот скрипт исполняемым, выполнив команду <code>chmod +x ~/.kde4/Autostart/ssh-agent.sh</code>
</p>
<p>Добавьте следующие строки в файл <code>~/.kde4/env/ssh-agent.sh</code>:
</p>
<pre>#!/bin/sh
eval $(envoy -p)
</pre>
<p>Когда вы войдете в сеанс KDE, запустится скрипт <code>ssh-agent.sh</code>. Он, в свою очередь, вызовет <i>ksshaskpass</i>, который предложит вам ввести пароль kwallet, когда envoy запустит <i>ssh-agent</i>.
</p>
<h3><span class="mw-headline" id="x11-ssh-askpass">x11-ssh-askpass</span></h3>
<p>Пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=x11-ssh-askpass">x11-ssh-askpass</a></span> предоставляет диалоговое окно с графическим интерфейсом для ввода вашего пароля в X-сессии. <i>x11-ssh-askpass</i> имеет в зависимостях только библиотеки <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libx11">libx11</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libxt">libxt</a></span>, а его внешний вид можно настраивать. Несмотря на то, что это диалоговое окно может быть вызвано программой <i>ssh-add</i>, которая затем загрузит ваши зашифрованные ключи в <a href="#ssh-agent">#ssh-agent</a>, приведенная инструкция позволит настроить <i>x11-ssh-askpass</i> на работу с приведенным выше скриптом <a href="#Keychain">#Keychain</a>.
</p>
<p>Установите пакеты <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=keychain">keychain</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=x11-ssh-askpass">x11-ssh-askpass</a></span>, доступные в <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториях</a>.
</p>
<p>Отредактируйте ваш файл <code>~/.xinitrc</code>, включив в него следующие строки, при этом заменив имя и местонахождение вашего закрытого ключа в случае необходимости. Требуется поместить эти строки <b>перед</b> строкой, запускающей ваш оконный менеджер.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.xinitrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">keychain ~/.ssh/id_ecdsa
[ -f ~/.keychain/$HOSTNAME-sh ] &amp;&amp; . ~/.keychain/$HOSTNAME-sh 2&gt;/dev/null
[ -f ~/.keychain/$HOSTNAME-sh-gpg ] &amp;&amp; . ~/.keychain/$HOSTNAME-sh-gpg 2&gt;/dev/null
...
exec openbox-session</pre>
<p>В данном примере первая строка запускает <i>keychain</i> и передает имя и место расположения вашего закрытого ключа. Если это не первый запуск <i>keychain</i>, следующие две строки загружают содержимое из <code>$HOSTNAME-sh</code> и <code>$HOSTNAME-sh-gpg</code>, если они существуют. Эти файлы хранят переменные окружения из предыдущих запусков <i>keychain</i>.
</p>
<h4>
<span id=".D0.92.D1.8B.D0.B7.D0.BE.D0.B2_x11-ssh-askpass_.D0.B2.D0.BC.D0.B5.D1.81.D1.82.D0.B5_.D1.81_ssh-add"></span><span class="mw-headline" id="Вызов_x11-ssh-askpass_вместе_с_ssh-add">Вызов x11-ssh-askpass вместе с ssh-add</span>
</h4>
<p>Страница руководства (man) по <i>ssh-add</i> указывает на то, что, помимо переменной <code>DISPLAY</code>, необходимо указать имя программы запроса пароля в переменной <code>SSH_ASKPASS</code> (в данном случае <i>x11-ssh-askpass</i>). Стоит иметь в виду, что стандартная установка Arch Linux разместит двоичный файл <i>x11-ssh-askpass</i> в каталоге <code>/usr/lib/ssh/</code>, который у большинства пользователей не прописан в <code>PATH</code>. Это лишь небольшое замечание, важное не только при указании значения переменной <code>SSH_ASKPASS</code>, но и при настройке внешнего вида. Везде необходимо будет указывать полный путь. Это неудобство можно исправить созданием символьной ссылки:
</p>
<pre>$ ln -sv /usr/lib/ssh/x11-ssh-askpass ~/bin/ssh-askpass
</pre>
<p>При этом предполагается, что каталог <code>~/bin</code> прописан в <code>PATH</code>. Теперь в вашем <code>.xinitrc</code>, перед запуском оконного менеджера, необходимо указать следующее:
</p>
<pre>$ export SSH_ASKPASS=ssh-askpass
</pre>
<p>и ваши <a href="../ru/X_resources.html" class="mw-redirect" title="Ресурсы Х">Ресурсы Х</a> будут содержать что-то вроде этого:
</p>
<pre>ssh-askpass*background: #000000
</pre>
<p>Данный метод хорошо работает при <a href="#ssh-agent_%D0%B2_%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B-%D0%BE%D0%B1%D0%B5%D1%80%D1%82%D0%BA%D0%B8">использовании <i>ssh-agent</i> в качестве программы-обертки</a>. Вы запускаете X командой <code>ssh-agent startx</code>, а затем добавляете <i>ssh-add</i> в список автоматически запускаемых приложений вашего оконного менеджера.
</p>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B2.D0.BD.D0.B5.D1.88.D0.BD.D0.B5.D0.B3.D0.BE_.D0.B2.D0.B8.D0.B4.D0.B0"></span><span class="mw-headline" id="Настройка_внешнего_вида">Настройка внешнего вида</span>
</h4>
<p>Внешний вид диалогового окна <i>x11-ssh-askpass</i> может быть настроен в соответствующих <a href="../ru/X_resources.html" class="mw-redirect" title="Ресурсы Х">Ресурсах Х</a>. На <a rel="nofollow" class="external text" href="http://www.jmknoble.net/software/x11-ssh-askpass/">домашней странице</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup> <i>x11-ssh-askpass</i> содержится несколько <a rel="nofollow" class="external text" href="http://www.jmknoble.net/software/x11-ssh-askpass/screenshots.html">примеров тем</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup>. Смотрите страницу руководства (man) <i>x11-ssh-askpass</i> для получения дополнительных подробностей.
</p>
<h4>
<span id=".D0.90.D0.BB.D1.8C.D1.82.D0.B5.D1.80.D0.BD.D0.B0.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D0.B5_.D0.B4.D0.B8.D0.B0.D0.BB.D0.BE.D0.B3.D0.BE.D0.B2.D1.8B.D0.B5_.D0.BE.D0.BA.D0.BD.D0.B0_.D0.B2.D0.B2.D0.BE.D0.B4.D0.B0_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F"></span><span class="mw-headline" id="Альтернативные_диалоговые_окна_ввода_пароля">Альтернативные диалоговые окна ввода пароля</span>
</h4>
<p>Существуют другие программы, предоставляющие диалоговые окна для ввода пароля, которые могут быть использованы вместо <i>x11-ssh-askpass</i>. В этом списке указаны некоторые из доступных решений:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ksshaskpass">ksshaskpass</a></span> доступна в официальных репозиториях. Зависит от пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kdelibs/">kdelibs</a></span><sup><small>AUR</small></sup> и подходит для тех, кто использует окружение <a href="../ru/KDE.html" title="KDE (Русский)">KDE</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh-askpass">openssh-askpass</a></span> зависит от библиотек <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/qt4/">qt4</a></span><sup><small>AUR</small></sup> и доступна в официальных репозиториях</li>
</ul>
<h3><span class="mw-headline" id="pam_ssh">pam_ssh</span></h3>
<p>Проект <a rel="nofollow" class="external text" href="http://pam-ssh.sourceforge.net/">pam_ssh</a> разрабатывается для использования <a href="https://en.wikipedia.org/wiki/ru:Pluggable_Authentication_Modules" class="extiw" title="wikipedia:ru:Pluggable Authentication Modules">подключаемых модулей аутентификации</a> (PAM) с закрытыми ключами SSH. Этот модуль может предоставлять единое поведение ( single sign-on behavior) для ваших подключений по SSH. При входе ваш пароль от закрытого ключа SSH может быть введен вместо или в качестве дополнения к вашему традиционному паролю системы. Как только произойдет аутентификация, модуль pam_ssh заставит ssh-agent хранить ваш зашифрованный закрытый ключ на протяжении времени работы сессии.
</p>
<p>Чтобы включить единое поведение в приглашении входа в tty, установите неофициальный пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pam_ssh/">pam_ssh</a></span><sup><small>AUR</small></sup>, доступный в <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> pam_ssh 2.0 теперь требует, чтобы все закрытые ключи, используемые в процессе аутентификации, были расположены в каталоге <code>~/.ssh/login-keys.d/</code>
</div>
<p>Создайте символьную ссылку на файл вашего закрытого ключа и разместите ее в <code>~/.ssh/login-keys.d/</code>. Замените <code>id_rsa</code> в приведенном ниже примере на имя вашего собственного файла закрытого ключа:
</p>
<pre>$ mkdir ~/.ssh/login-keys.d/
$ cd ~/.ssh/login-keys.d/
$ ln -s ../id_rsa
</pre>
<p>Отредактируйте конфигурационный файл <code>/etc/pam.d/login</code>, включив в него строки, отмеченные жирным шрифтом в приведенном ниже примере. Порядок следования строк является существенным и может повлиять на возможность входа в систему.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Создание неправильной конфигурации PAM может оставить систему в состоянии, при котором все пользователи окажутся заблокированными. Перед тем, как делать какие-либо изменения, вам необходимо понять, как работает конфигурация PAM. В качестве средства восстановления можно использовать, например, Arch Live CD, в случае, если вы заблокированы, и вам необходимо отменить изменения. В <a rel="nofollow" class="external text" href="http://www.ibm.com/developerworks/linux/library/l-pam/index.html">статье</a> от IBM developerWorks настройка PAM рассматривается более детально</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/login</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0

auth       required     pam_securetty.so
auth       requisite    pam_nologin.so
auth       include      system-local-login
<b>auth       optional     pam_ssh.so        try_first_pass</b>
account    include      system-local-login
session    include      system-local-login
<b>session    optional     pam_ssh.so</b></pre>
<p>В приведенном выше примере аутентификация проходит так, как обычно, с приглашением ввести пароль пользователя. Дополнительное правило аутентификации <code>auth</code>, добавленное в конце, говорит модулю pam_ssh попробовать расшифровать любые закрытые ключи, найденные в каталоге <code>~/.ssh/login-keys.d</code>. Опция <code>try_first_pass</code> передается модулю pam_ssh, говоря ему сперва попытаться расшифровать любые закрытые ключи SSH, используя только что введенный пароль пользователя. Если пароль пользователя и его закрытого ключа являются одинаковыми, ключ будет расшифрован, и не будет предлагаться ввести тот же пароль повторно. Если же они различаются, модуль pam_ssh предложит пользователю ввести пароль SSH после ввода пароля пользователя. Строка <code>optional</code> делает проверку того, что пользователи, у которых нет закрытых ключей SSH, по-прежнему могут входить в систему. В этом случае использование pam_ssh будет прозрачным для пользователей без закрытых ключей SSH.
</p>
<p>Если вы используете другой способ входа в систему, например, дисплейный менеджер вроде <a href="../en/SLiM.html" class="mw-redirect" title="SLiM (Русский)">SLiM</a> или <a href="../ru/XDM.html" title="XDM (Русский)">XDM</a>, и хотите, чтобы он предоставлял вам похожий функционал, необходимо отредактировать его связанный с PAM файл конфигурации в похожем виде. Пакеты, предоставляющие поддержку PAM, обычно располагают конфигурационный файл по умолчанию в каталоге <code>/etc/pam.d/</code>.
</p>
<p>Более подробную информацию по использованию pam_ssh, а также список его опций, вы можете найти на странице руководства (man) pam_ssh.
</p>
<h4>
<span id=".D0.98.D0.B7.D0.B2.D0.B5.D1.81.D1.82.D0.BD.D1.8B.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D1.8B_pam_ssh"></span><span class="mw-headline" id="Известные_проблемы_pam_ssh">Известные проблемы pam_ssh</span>
</h4>
<p>Работа над проектом pam_ssh непостоянна, и предоставляемая документация обновляется относительно редко. Вы должны знать о некоторых его ограничениях, которые в ней не упомянуты:
</p>
<ul>
<li>pam_ssh до версии 2.0 не поддерживает ключи SSH с новой криптографией ECDSA (elliptic curve). Если вы используете ранние версии pam_ssh, необходимо использовать ключи RSA или DSA</li>
<li>Процесс <code>ssh-agent</code>, вызываемый pam_ssh, не сохраняется между входами пользователей в систему. Если вам нравится сохранять сессию <a href="../ru/GNU_Screen.html" title="GNU Screen (Русский)">GNU Screen</a> между входами, вы можете заметить во время повторного присоединения к вашей сессии, что теперь невозможно соединиться с ssh-agent. Это происходит потому, что окружение GNU Screen и его производные будут ссылаться на процесс ssh-agent, вызванный во время первого запуска GNU Screen, который был завершен во время выхода из сеанса. <a href="#Keychain">Keychain</a> решает эту проблему, заставляя процесс ssh-agent работать между входами в систему.</li>
</ul>
<h3><span class="mw-headline" id="GNOME_Keyring">GNOME Keyring</span></h3>
<p>Если вы используете окружение <a href="../ru/GNOME.html" title="GNOME (Русский)">GNOME</a>, вы можете воспользоваться программой <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a> в качестве агента SSH. Смотрите статью <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a> для получения дополнительных подробностей.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<p>Если вам кажется, что сервер SSH игнорирует ваши ключи, убедитесь, что у вас есть необходимые права доступа ко всем соответствующим файлам.<br>
Для локальной машины:
</p>
<pre>$ chmod 700 ~/
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/id_ecdsa
</pre>
<p>Для удаленной машины:
</p>
<pre>$ chmod 700 ~/
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/authorized_keys
</pre>
<p>Если это не решает проблему, вы можете попробовать временно установить <code>StrictModes</code> в значние <code>no</code> в файле <code>sshd_config</code>. Если аутентификация с отключенным StrictModes удастся, это может быть связано с сохранением прав доступа.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Не забудьте установить <code>StrictModes</code> в значение <code>yes</code> ради безопасности</div>
<p>Удостоверьтесь, что удаленная машина поддерживает тип ключей, который вы используете. Попробуйте использовать ключи RSA или DSA вместо <a href="#%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F_%D0%BF%D0%B0%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_SSH">генерации пары ключей SSH</a>
</p>
<pre>Некоторые серверы не поддерживают ключи ECDSA
</pre>
<p>Если проблему не удалось решить, запустите sshd в режиме отладки и смотрите вывод при подключении:
</p>
<pre># /usr/bin/sshd -d
</pre>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_kdm"></span><span class="mw-headline" id="Использование_kdm">Использование kdm</span>
</h3>
<p>KDM не запускает процесс ssh-agent напрямую, он использует пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kde-agent">kde-agent</a></span><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup> для его запуска во время входа в систему, но, начиная с версии 20140102-1, он был <a rel="nofollow" class="external text" href="https://projects.archlinux.org/svntogit/packages.git/commit/trunk?h=packages/kde-agent&amp;id=1070467b0f74b2339ceca2b9471d1c4e2b9c9c8f">удален</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-07-28]</sup>.
</p>
<p>Чтобы запускать ssh-agent при старте KDE для пользователя, создайте скрипт. То же самое необходимо для остановки ssh-agent при выходе из сеанса:
</p>
<pre>echo -e '#!/bin/sh\n[ -n "$SSH_AGENT_PID" ] || eval "$(ssh-agent -s)"' &gt; ~/.kde4/env/ssh-agent-startup.sh
echo -e '#!/bin/sh\n[ -z "$SSH_AGENT_PID" ] || eval "$(ssh-agent -k)"' &gt; ~/.kde4/shutdown/ssh-agent-shutdown.sh
chmod 755 ~/.kde4/env/ssh-agent-startup.sh ~/.kde4/shutdown/ssh-agent-shutdown.sh
</pre>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www-106.ibm.com/developerworks/linux/library/l-keyc.html">Управление ключами OpenSSH, Часть 1</a></li>
<li><a rel="nofollow" class="external text" href="https://www-106.ibm.com/developerworks/linux/library/l-keyc2/">Управление ключами OpenSSH, Часть 2</a></li>
<li><a rel="nofollow" class="external text" href="https://www-106.ibm.com/developerworks/library/l-keyc3/">Управление ключами OpenSSH, Часть 3</a></li>
<li><a rel="nofollow" class="external text" href="http://kimmo.suominen.com/docs/ssh/">Приступая к работе с SSH</a></li>
<li><a rel="nofollow" class="external text" href="https://www.openssh.com/txt/release-5.7">Примечания к выпуску OpenSSH 5.7</a></li>
<li><a rel="nofollow" class="external text" href="https://stribika.github.io/2015/01/04/secure-secure-shell.html">Secure Secure Shell</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Secure_Shell.html" title="Category:Secure Shell (Русский)">Secure Shell (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=SSH_keys_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=662322">https://wiki.archlinux.org/index.php?title=SSH_keys_(Русский)&amp;oldid=662322</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 April 2021, at 20:50.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
