<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Swap (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Swap_Русский rootpage-Swap_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Swap (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Swap.html" title="Swap">Swap</a>. Дата последней синхронизации: 15 июня 2018. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Swap&amp;diff=0&amp;oldid=526278">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Fstab.html" title="Fstab (Русский)">fstab (Русский)</a></li>
<li><a href="../ru/00995774c6467004273878670910cee9.html#%D0%93%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F" class="mw-redirect" title="Управление питанием/Ждущий и спящий режимы">Управление питанием/Ждущий и спящий режимы#Гибернация</a></li>
<li><a href="../en/Zswap.html" title="Zswap">Zswap</a></li>
<li><a href="../en/Swap_on_video_RAM.html" class="mw-redirect" title="Swap on video ram">Swap on video ram</a></li>
<li><a href="../en/ZFS.html#Swap_volume" title="ZFS">ZFS#Swap volume</a></li>
<li><a href="../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a></li>
</ul>
</div>
<p>Эта страница дает ознакомление с <a href="https://en.wikipedia.org/wiki/ru:%D0%9F%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B0_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86" class="extiw" title="wikipedia:ru:Подкачка страниц">пространством подкачки и подкачкой страниц</a> в GNU/Linux. Охватывает создание, активацию файлов и разделов подкачки.
</p>
<p>Взято из <a rel="nofollow" class="external text" href="http://www.linux.com/news/software/applications/8208-all-about-linux-swap-space">All about Linux swap space</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-06]</sup>:
</p>
<dl><dd>Linux делит свою физическую RAM (оперативную память) на кусочки памяти, называемые страницами. Подкачка (swapping) это процесс, когда страницы памяти копируются на предварительно сконфигурированное пространство на жестком диске, называемое пространством подкачки, чтобы освободить эту страницу из памяти. Суммарный размер оперативной памяти и пространства подкачки это количество доступной виртуальной памяти.</dd></dl>
<p>Поддержка подкачки обеспечивается ядром Linux и утилитами в пользовательском пространстве из <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=util-linux">util-linux</a></span> пакета.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%D0%9F%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">1</span> <span class="toctext">Пространство подкачки</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">2</span> <span class="toctext">Раздел подкачки</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%D0%90%D0%BA%D1%82%D0%B8%D0%B2%D0%B0%D1%86%D0%B8%D1%8F_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D1%8F_systemd"><span class="tocnumber">2.1</span> <span class="toctext">Активация используя systemd</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">2.2</span> <span class="toctext">Отключение подкачки</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#%D0%A4%D0%B0%D0%B9%D0%BB_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">3</span> <span class="toctext">Файл подкачки</span></a>
<ul>
<li class="toclevel-2 tocsection-6">
<a href="#%D0%92%D1%80%D1%83%D1%87%D0%BD%D1%83%D1%8E"><span class="tocnumber">3.1</span> <span class="toctext">Вручную</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">3.1.1</span> <span class="toctext">Создание файла подкачки</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">3.1.2</span> <span class="toctext">Удаление файла подкачки</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9">
<a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8"><span class="tocnumber">3.2</span> <span class="toctext">Автоматически</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#systemd-swap"><span class="tocnumber">3.2.1</span> <span class="toctext">systemd-swap</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#%D0%9F%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B0_%D1%81_USB_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0"><span class="tocnumber">4</span> <span class="toctext">Подкачка с USB устройства</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8"><span class="tocnumber">5</span> <span class="toctext">Шифрование подкачки</span></a></li>
<li class="toclevel-1 tocsection-13">
<a href="#%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="tocnumber">6</span> <span class="toctext">Производительность</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Swappiness"><span class="tocnumber">6.1</span> <span class="toctext">Swappiness</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#VFS_cache_pressure"><span class="tocnumber">6.2</span> <span class="toctext">VFS cache pressure</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%D0%9F%D1%80%D0%B8%D0%BE%D1%80%D0%B8%D1%82%D0%B5%D1%82"><span class="tocnumber">6.3</span> <span class="toctext">Приоритет</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_zswap_%D0%B8%D0%BB%D0%B8_zram"><span class="tocnumber">6.4</span> <span class="toctext">Использование zswap или zram</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#%D0%A7%D0%B5%D1%80%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">6.5</span> <span class="toctext">Чередование</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D1.80.D0.B0.D0.BD.D1.81.D1.82.D0.B2.D0.BE_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Пространство_подкачки">Пространство подкачки</span>
</h2>
<p>Пространство подкачки может быть разделом диска или файлом. Пользователи могут создать пространство подкачки во время установки или позднее в любое желаемое время. Пространство подкачки может быть использовано для двух целей, расширить виртуальную память за пределы установленной оперативной памяти (RAM), а также для сохранения данных при гибернации (suspend-to-disk).
</p>
<p>Иногда стоит включать Swap в зависимости от установленной оперативной памяти и количества требований для запуска желаемых программ. Если количество оперативной памяти меньше требуемого, тогда стоит включить подкачку. Это позволяет избежать <a href="https://en.wikipedia.org/wiki/Out_of_memory" class="extiw" title="wikipedia:Out of memory">состояния нехватки памяти (OOM)</a>, при котором механизм ядра Linux, OOM Killer, будет автоматически пытаться освободить память, убивая процессы. Чтобы увеличить количество виртуальной памяти до требуемого уровня, добавьте необходимую разницу как пространство подкачки. Например, если программа требует 7,5 GB памяти для запуска, а у вас установлено 4 GB оперативной памяти, добавьте разницу 3,5 GB как подкачку. В будущем добавляйте больше пространства к подкачке, учитывая требования.
Это вопрос личных предпочтений если вы считаете, что программы должны быть убиты, вместо включения подкачки. Самый большой недостаток в подкачке это снижение производительности, см. раздел <a href="#%D0%9F%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C">#Производительность</a>
</p>
<p>Для проверки статуса подкачки, используйте:
</p>
<pre>$ swapon --show
</pre>
<p>Или
</p>
<pre>$ free -h
</pre>
<p><i>free</i> также покажет недостаток памяти, который может быть исправлен включением или увеличением подкачки.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Преимущества в производительности между файлом и разделом подкачки нет, оба варианта обрабатываются одинаково.</div>
<h2>
<span id=".D0.A0.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Раздел_подкачки">Раздел подкачки</span>
</h2>
<p>Раздел подкачки может быть создан различными GNU/Linux <a href="../ru/Partitioning.html" title="Partitioning (Русский)">утилитами разметки</a>. Разделы подкачки обычно обозначаются как тип <code>82</code>. Хотя есть возможность использовать разные типы как подкачку, рекомендуется использовать тип <code>82</code>, в большинстве случаев <a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a>, будет автоматически определять его и монтировать (см. ниже)
</p>
<p>Для установки раздела как область Linux подкачки, можно использовать <code>mkswap</code>. Например:
</p>
<pre># mkswap /dev/sd<i>xy</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Все данные на указанном разделе будут утеряны.</div>
<p>Для подключения устройства как подкачку:
</p>
<pre># swapon /dev/sd<i>xy</i>
</pre>
<p>Чтобы подключить этот раздел подкачки при загрузке, добавьте запись в <a href="../ru/Fstab.html" title="Fstab (Русский)">fstab</a>:
</p>
<pre>UUID=&lt;UUID&gt; none swap defaults 0 0
</pre>
<p>где &lt;UUID&gt; может быть получен из команды:
</p>
<pre>lsblk -no UUID /dev/sd<i>xy</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Предпочтительно использовать UUID и LABEL, чем имена устройств полученные от ядра <i>(/dev/sd*)</i>, т.к. порядок устройств может измениться в будущем. Смотри <a href="../ru/Fstab.html" title="Fstab (Русский)">fstab</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Эта fstab запись необязательна если раздел подкачки находится на устройстве, использующий GPT разметку, см. следующий подраздел.</li>
<li>Если используется SSD с поддержкой <a href="../ru/Solid_state_drive.html#TRIM" class="mw-redirect" title="Solid State Drives (Русский)">TRIM</a>, учтите использование <code>defaults,discard</code> в <a href="../ru/Fstab.html" title="Fstab (Русский)">fstab</a> строке подключения подкачки. Если вручную активировать подкачку с помощью <i>swapon</i>, используйте параметр <code>-d</code>/<code>--discard</code>, который делает тоже самое. Подробности смотри в <span class="plainlinks archwiki-template-man" title="$ man 8 swapon"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/swapon.8">swapon(8)</a></span>.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Включение discard в RAID установке с использованием mdadm, приведёт к блокировке системы при загрузке и во время выполнения, если использовать swapon.</div>
<h3>
<span id=".D0.90.D0.BA.D1.82.D0.B8.D0.B2.D0.B0.D1.86.D0.B8.D1.8F_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D1.8F_systemd"></span><span class="mw-headline" id="Активация_используя_systemd">Активация используя systemd</span>
</h3>
<p>Активация разделов подкачки в <a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a> базируется на двух различных механизмах. Оба исполняются в 
<code>/usr/lib/systemd/system-generators</code>. Генераторы запускаются при старте системы и создают нативные systemd юниты для монтирования. Первый <code>systemd-fstab-generator</code>, читает fstab, чтобы генерировать юниты, включая юнит для подкачки. Второй <code>systemd-gpt-auto-generator</code>, осматривает корневой диск, чтобы генерировать юниты. Это операция проходит только на GPT дисках и может идентифицировать разделы подкачки по их тип коду <code>82</code>.
</p>
<h3>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Отключение_подкачки">Отключение подкачки</span>
</h3>
<p>Чтобы деактивировать определенное пространство подкачки:
</p>
<pre># swapoff /dev/sd<i>xy</i>
</pre>
<p>Также можно использовать <code>-a</code> ключ, чтобы деактивировать все пространства подкачки.
</p>
<p>С тех пор, как systemd управляет подкачкой, она вновь будет активирована при старте системы, для долговременного отключения автоматической активации найденных пространств подкачки, выполните <code>systemctl --type swap</code>, чтобы найти связанные со <i>.swap</i> юниты и замаскируйте (<a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">systemctl mask <i>юнит</i></a>) их.
</p>
<h2>
<span id=".D0.A4.D0.B0.D0.B9.D0.BB_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Файл_подкачки">Файл подкачки</span>
</h2>
<p>Как альтернатива к созданию целого раздела, файл подкачки даёт возможность менять свой размер на лету, а также его гораздо легче полностью удалить. Это может быть особенно важно, если дисковое пространство ограничено (например, небольшие SSD)
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> <a href="../en/Btrfs.html" class="mw-redirect" title="Btrfs (Русский)">Btrfs</a> не поддерживает файлы подкачки. Несоблюдение этого предупреждения, может стать результатом разрушения файловой системы. Пока что, файл подкачки может быть использован в Btrfs, если смонтирован через loop-устройство, тогда будет сильно уменьшена производительность подкачки.</div>
<h3>
<span id=".D0.92.D1.80.D1.83.D1.87.D0.BD.D1.83.D1.8E"></span><span class="mw-headline" id="Вручную">Вручную</span>
</h3>
<h4>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Создание_файла_подкачки">Создание файла подкачки</span>
</h4>
<p>Использовать под суперпользователем <code>fallocate</code>, чтобы создать файл подкачки размером на свой выбор (M = <a href="https://en.wikipedia.org/wiki/Mebibyte" class="extiw" title="wikipedia:Mebibyte">Mebibytes</a>, G = <a href="https://en.wikipedia.org/wiki/Gibibyte" class="extiw" title="wikipedia:Gibibyte">Gibibytes</a>). Например создание 512 MiB файла подкачки:
</p>
<pre># fallocate -l 512M /swapfile
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <i>fallocate</i> может вызвать проблемы с некоторыми файловыми системами, такими как: <a href="../en/F2FS.html" title="F2FS">F2FS</a> или <a href="../ru/XFS.html" title="XFS (Русский)">XFS</a>.<a rel="nofollow" class="external autonumber" href="https://bugzilla.redhat.com/show_bug.cgi?id=1129205#c3">[1]</a>. Как вариант, используйте <i>dd</i>, наиболее надёжный, но медленный.
<pre># dd if=/dev/zero of=/swapfile bs=1M count=512</pre>
</div>
<p>Установите права доступа (всеми читаемый файл подкачки это огромная локальная уязвимость)
</p>
<pre># chmod 600 /swapfile
</pre>
<p>После создания файла нужного размера, форматируйте его в подкачку:
</p>
<pre># mkswap /swapfile
</pre>
<p>Активируйте файл подкачки:
</p>
<pre># swapon /swapfile
</pre>
<p>В завершении, отредактируйте <a href="../ru/Fstab.html" title="Fstab (Русский)">fstab</a>, добавив запись для файла подкачки:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/swapfile none swap defaults 0 0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong>  Не забудьте добавить discard, если у вас SSD с поддержкой TRIM
<pre># swapon --discard /swapfile
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/swapfile none swap defaults,discard 0 0</pre>
</div>
<h4>
<span id=".D0.A3.D0.B4.D0.B0.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Удаление_файла_подкачки">Удаление файла подкачки</span>
</h4>
<p>Чтобы удалить файл подкачки, сначала нужно отключить подкачку, а затем файл может быть удален:
</p>
<pre># swapoff -a
# rm -f /swapfile
</pre>
<p>В завершении, удалите соответствующую запись из <code>/etc/fstab</code>.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8"></span><span class="mw-headline" id="Автоматически">Автоматически</span>
</h3>
<h4><span class="mw-headline" id="systemd-swap">systemd-swap</span></h4>
<p><a href="../ru/Help:Reading.html" title="Help:Reading (Русский)">Установить</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-swap">systemd-swap</a></span> пакет.
Установить <code>swapfc_enabled=1</code> в <i>Swap File Chunked</i> разделе файла <code>/etc/systemd/swap.conf</code>.
<a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">Start/enable</a> <code>systemd-swap</code> сервис.
Посетить страницу <a rel="nofollow" class="external text" href="https://github.com/Nefelim4ag/systemd-swap">авторов на GitHub</a> для получения подробностей и установить <a rel="nofollow" class="external text" href="https://github.com/Nefelim4ag/systemd-swap/blob/master/README.md#about-configuration">рекомендуемую конфигурацию</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если журнал продолжает показывать следующее предупреждение <code>systemd-swap[..]: WARN: swapFC: ENOSPC</code> и файл подкачки не создаётся, вы должны установить параметр <code>swapfc_force_preallocated=1</code> в <code>/etc/systemd/swap.conf</code>.</div>
<h2>
<span id=".D0.9F.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B0_.D1.81_USB_.D1.83.D1.81.D1.82.D1.80.D0.BE.D0.B9.D1.81.D1.82.D0.B2.D0.B0"></span><span class="mw-headline" id="Подкачка_с_USB_устройства">Подкачка с USB устройства</span>
</h2>
<p>Благодаря модульности, предлагаемой Linux, мы можем иметь множество разделов подкачки на различных устройствах. Если у вас полностью заполнен жесткий диск, то можно использовать USB устройство как временный раздел подкачки. Однако, этот метод имеет серьёзные недостатки:
</p>
<ul>
<li>USB устройство медленнее чем жесткий диск</li>
<li>Flash память имеет ограниченное количество циклов записи. Использование его как раздела подкачки, может быстро убить его.</li>
</ul>
<p>Чтобы добавить USB устройство как подкачку, сначала необходимо разметить USB флешку для подкачки как описано в секции <a href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8">#Раздел подкачки</a>.
</p>
<p>Далее откройте <code>/etc/fstab</code> и добавьте
</p>
<pre>pri=0
</pre>
<p>в опции монтирования <i>первоначальной</i> записи подкачки, таким образом USB подкачка будет иметь приоритет записи над старым разделом.
</p>
<p>Данная инструкция будет работать и для других устройств хранения, таких как SD карты и т.д.
</p>
<h2>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span><span class="mw-headline" id="Шифрование_подкачки">Шифрование подкачки</span>
</h2>
<p>Смотри: <a href="../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a>.
</p>
<h2>
<span id=".D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.B4.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D0.BE.D1.81.D1.82.D1.8C"></span><span class="mw-headline" id="Производительность">Производительность</span>
</h2>
<p>Операции подкачки как правило существенно медленнее чем непосредственный доступ к RAM. Отключение подкачки полностью для повышения производительности, иногда может привести к ухудшению, поскольку это уменьшает доступную память для VFS кеша, вызывая более частые и дорогостоящие операции ввода/вывода.
</p>
<p>Значения подкачки можно настроить, чтобы помочь производительности:
</p>
<h3><span class="mw-headline" id="Swappiness">Swappiness</span></h3>
<p><i>Swappiness</i> <a href="../en/Sysctl.html" title="Sysctl">sysctl</a> параметр представляющий частоту использования пространства подкачки. Swappiness может иметь значение от 0 до 100, значение по умолчанию = 60. Низкое значение заставляет ядро избегать подкачки, высокое значение позволяет ядру использовать подкачку <i>наперёд</i>. Использование низкого значения на достаточном количестве памяти, улучшает отзывчивость на многих системах.
</p>
<p>Чтобы проверить текущее значение swappiness:
</p>
<pre>$ cat /sys/fs/cgroup/memory/memory.swappiness
</pre>
<p>или
</p>
<pre>$ cat /proc/sys/vm/swappiness
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong>  Т.к. <code>/proc</code> менее организован и сохраняется только для обратной совместимости, вместо него предпочтительнее использовать <code>/sys</code>.</div>
<p>Чтобы временно установить значение swappiness:
</p>
<pre># sysctl vm.swappiness=10
</pre>
<p>Чтобы постоянно установить значение swappiness, отредактируйте (создайте) конфигурационный файл <i>sysctl</i> 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/99-sysctl.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.swappiness=10</pre>
<p>Чтобы проверить и больше узнать, почему оно так работает, посмотрите <a rel="nofollow" class="external text" href="http://rudd-o.com/en/linux-and-free-software/tales-from-responsivenessland-why-linux-feels-slow-and-how-to-fix-that">эту статью</a>.
</p>
<h3><span class="mw-headline" id="VFS_cache_pressure">VFS cache pressure</span></h3>
<p>Другой <i>sysctl</i> параметр, который действует на производительность подкачки это <code>vm.vfs_cache_pressure</code>, он контролирует склонность ядра к применению памяти, которая используется для кэширования VFS caches, напротив кэширования страниц и подкачки. Увеличение этого значения увеличивает коэффициент с которым VFS caches применяется<a rel="nofollow" class="external autonumber" href="http://doc.opensuse.org/documentation/leap/tuning/html/book.sle.tuning/cha.tuning.memory.html#cha.tuning.memory.vm.reclaim">[2]</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-06]</sup>. Для подробной информации смотри <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/sysctl/vm.txt">документацию ядра Linux</a>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BE.D1.80.D0.B8.D1.82.D0.B5.D1.82"></span><span class="mw-headline" id="Приоритет">Приоритет</span>
</h3>
<p>Если у вас больше одного файла или раздела подкачки, вы должны учитывать присвоение приоритетного значения (от 0 до 32767) для каждой области подкачки. Система будет использовать области подкачки с высоким приоритетом, перед использованием областей с низким приоритетом. Например, если у вас быстрый диск (<code>/dev/sda</code>) и медленный (<code>/dev/sdb</code>), назначьте высокий приоритет для подкачки расположенной на быстром устройстве. Приоритет может быть назначен в <a href="../ru/Fstab.html" title="Fstab (Русский)">fstab</a> как <code>pri</code> параметр:
</p>
<pre>/dev/sda1 none swap defaults,pri=100 0 0
/dev/sdb2 none swap defaults,pri=10  0 0
</pre>
<p>Или как параметр в <i>swapon</i> <code>--priority</code> 
</p>
<pre># swapon --priority 100 /dev/sda1
</pre>
<p>Если две или более областей будут иметь одинаковый приоритет и он будет самым высоким из доступным приоритетов, то страницы будут распределяться по кругу между областями.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_zswap_.D0.B8.D0.BB.D0.B8_zram"></span><span class="mw-headline" id="Использование_zswap_или_zram">Использование zswap или zram</span>
</h3>
<p><a href="../en/Zswap.html" title="Zswap">Zswap</a> это особенность ядра Linux, обеспечивающая сжатие обратного кэша для страниц подкачки. Она увеличивает производительность и уменьшает операции ввода/вывода. <a href="../en/Improving_performance.html#Zram_or_zswap" class="mw-redirect" title="ZRAM">ZRAM</a> создаёт виртуальный сжатый файл подкачки в памяти, как альтернатива файлу подкачки на диске.
</p>
<h3>
<span id=".D0.A7.D0.B5.D1.80.D0.B5.D0.B4.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Чередование">Чередование</span>
</h3>
<p>Нет необходимости использовать <a href="../en/RAID.html" title="RAID">RAID</a> для повышения производительности подкачки. Ядро самостоятельно может чередовать подкачку на нескольких устройствах, если вы присвоите им одинаковый приоритет в <code>/etc/fstab</code>.
Для подробной информации смотри <a rel="nofollow" class="external text" href="http://unthought.net/Software-RAID.HOWTO/Software-RAID.HOWTO-2.html#ss2.3">The Software-RAID HOWTO</a>.
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:File_systems.html" title="Category:File systems (Русский)">File systems (Русский)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Swap_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=638640">https://wiki.archlinux.org/index.php?title=Swap_(Русский)&amp;oldid=638640</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 October 2020, at 07:18.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
