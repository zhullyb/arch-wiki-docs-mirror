<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Samba (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Samba_Русский rootpage-Samba_Русский skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Samba (Русский)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Active_Directory_integration.html" class="mw-redirect" title="Интеграция Active Directory">Интеграция Active Directory</a></li>
<li><a href="../ru/9f9da5d8c9d7660a5cc6df8e597cd14a.html" class="mw-redirect" title="Samba/Контроллер домена Active Directory">Samba/Контроллер домена Active Directory</a></li>
<li><a href="../en/NFS.html" class="mw-redirect" title="NFS (Русский)">NFS (Русский)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Samba.html" title="Samba">Samba</a>. Дата последней синхронизации: 2014-10-08. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Samba&amp;diff=0&amp;oldid=339341">изменения</a>.</div>
<p><a rel="nofollow" class="external text" href="https://www.samba.org/">Samba</a> — это реализация сетевого протокола <a href="https://en.wikipedia.org/wiki/ru:Server_Message_Block" class="extiw" title="wikipedia:ru:Server Message Block">SMB</a>. Она облегчает организацию общего доступа к файлам и принтерам между системами Linux и Windows и является альтернативой <a href="../en/NFS.html" class="mw-redirect" title="NFS (Русский)">NFS (Русский)</a>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0"><span class="tocnumber">1</span> <span class="toctext">Настройка сервера</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0"><span class="tocnumber">1.1</span> <span class="toctext">Установка</span></a>
<ul>
<li class="toclevel-3 tocsection-3">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B5%D0%B6%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B3%D0%BE_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0"><span class="tocnumber">1.1.1</span> <span class="toctext">Настройка межсетевого экрана</span></a>
<ul>
<li class="toclevel-4 tocsection-4"><a href="#%D0%9F%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%BE_UFW"><span class="tocnumber">1.1.1.1</span> <span class="toctext">Правило UFW</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-5">
<a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">1.2</span> <span class="toctext">Использование</span></a>
<ul>
<li class="toclevel-3 tocsection-6">
<a href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8"><span class="tocnumber">1.2.1</span> <span class="toctext">Управление пользователями</span></a>
<ul>
<li class="toclevel-4 tocsection-7"><a href="#%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">1.2.1.1</span> <span class="toctext">Добавление пользователя</span></a></li>
<li class="toclevel-4 tocsection-8"><a href="#%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80_%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9"><span class="tocnumber">1.2.1.2</span> <span class="toctext">Просмотр списка пользователей</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#%D0%A1%D0%BC%D0%B5%D0%BD%D0%B0_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F_Samba-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">1.2.1.3</span> <span class="toctext">Смена пароля Samba-пользователя</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10"><a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2_%D0%B4%D0%BB%D1%8F_%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0"><span class="tocnumber">1.2.2</span> <span class="toctext">Создание ресурсов для общего доступа</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D1%81%D0%BB%D1%83%D0%B6%D0%B1"><span class="tocnumber">1.2.3</span> <span class="toctext">Запуск служб</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12">
<a href="#%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F"><span class="tocnumber">1.3</span> <span class="toctext">Расширенная конфигурация</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2_%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F"><span class="tocnumber">1.3.1</span> <span class="toctext">Создание ресурсов общего доступа от имени обычного пользователя</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B8_%D1%84%D0%BE%D1%80%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%B0%D0%B2_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0"><span class="tocnumber">1.3.2</span> <span class="toctext">Установка и форсирование прав доступа</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#%D0%9E%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D0%B8_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%B2%D1%8B%D1%88%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8"><span class="tocnumber">1.3.3</span> <span class="toctext">Ограничение версии протокола для повышения безопасности</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_SMB"><span class="tocnumber">1.3.4</span> <span class="toctext">Использование шифрования SMB</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BA_%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B0%D0%BC"><span class="tocnumber">1.3.5</span> <span class="toctext">Отключение общего доступа к принтерам</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%82_%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D1%85_%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D0%B9_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%B2_%D0%BE%D0%B1%D1%89%D0%B5%D0%BC_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B5_Samba"><span class="tocnumber">1.3.6</span> <span class="toctext">Запрет определённых расширений файлов в общем ресурсе Samba</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#%D0%A3%D0%B2%D0%B5%D0%BB%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%BF%D1%83%D1%81%D0%BA%D0%BD%D0%BE%D0%B9_%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8"><span class="tocnumber">1.3.7</span> <span class="toctext">Увеличение пропускной способности</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%81%D1%82%D0%B0%D1%80%D1%8B%D1%85_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%BE%D0%B2_%D0%B8%D0%BB%D0%B8_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2"><span class="tocnumber">1.3.8</span> <span class="toctext">Включение доступа для старых клиентов или устройств</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-21">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0"><span class="tocnumber">2</span> <span class="toctext">Настройка клиента</span></a>
<ul>
<li class="toclevel-2 tocsection-22">
<a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%BE%D0%B5_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">2.1</span> <span class="toctext">Ручное монтирование</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0_%D0%B2_/etc/fstab"><span class="tocnumber">2.1.1</span> <span class="toctext">Добавление ресурса в /etc/fstab</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8"><span class="tocnumber">2.1.2</span> <span class="toctext">Монтирование пользователями</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#%D0%98%D0%BC%D0%B5%D0%BD%D0%B0_%D1%85%D0%BE%D1%81%D1%82%D0%BE%D0%B2_WINS"><span class="tocnumber">2.2</span> <span class="toctext">Имена хостов WINS</span></a></li>
<li class="toclevel-2 tocsection-26">
<a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="tocnumber">2.3</span> <span class="toctext">Автоматическое монтирование</span></a>
<ul>
<li class="toclevel-3 tocsection-27">
<a href="#smbnetfs"><span class="tocnumber">2.3.1</span> <span class="toctext">smbnetfs</span></a>
<ul>
<li class="toclevel-4 tocsection-28"><a href="#%D0%94%D0%B5%D0%BC%D0%BE%D0%BD"><span class="tocnumber">2.3.1.1</span> <span class="toctext">Демон</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-29"><a href="#autofs"><span class="tocnumber">2.3.2</span> <span class="toctext">autofs</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-30">
<a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%D0%B0"><span class="tocnumber">2.4</span> <span class="toctext">Настройка файлового менеджера</span></a>
<ul>
<li class="toclevel-3 tocsection-31"><a href="#Nautilus,_Nemo,_Thunar_%D0%B8_PCManFM"><span class="tocnumber">2.4.1</span> <span class="toctext">Nautilus, Nemo, Thunar и PCManFM</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="#KDE"><span class="tocnumber">2.4.2</span> <span class="toctext">KDE</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5_%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F"><span class="tocnumber">2.4.3</span> <span class="toctext">Другие графические окружения</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-34">
<a href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC"><span class="tocnumber">3</span> <span class="toctext">Решение проблем</span></a>
<ul>
<li class="toclevel-2 tocsection-35"><a href="#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BA_Windows_7_-_mount_error(12):_cannot_allocate_memory"><span class="tocnumber">3.1</span> <span class="toctext">Проблемы подключения к Windows 7 - mount error(12): cannot allocate memory</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BA_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0%D0%BC,_%D0%B7%D0%B0%D1%89%D0%B8%D1%89%D0%B5%D0%BD%D0%BD%D1%8B%D0%BC_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D0%B5%D0%BC,_%D0%B8%D0%B7_Windows"><span class="tocnumber">3.2</span> <span class="toctext">Проблемы получения доступа к ресурсам, защищенным паролем, из Windows</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#%D0%94%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D0%B5_%D0%BE%D0%BA%D0%BD%D0%BE_%D0%BF%D0%BE%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%D1%81%D1%8F_%D1%81_%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%BE%D0%B9_%D0%B7%D0%B0%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%BE%D0%B9"><span class="tocnumber">3.3</span> <span class="toctext">Диалоговое окно появляется с большой задержкой</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B0:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL"><span class="tocnumber">3.4</span> <span class="toctext">Ошибка: Failed to retrieve printer list: NT_STATUS_UNSUCCESSFUL</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#%D0%9D%D0%B5_%D1%83%D0%B4%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D1%80%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C_%D0%BE%D0%B1%D1%89%D0%B8%D0%B9_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF_%D0%BA_%D0%BF%D0%B0%D0%BF%D0%BA%D0%B5"><span class="tocnumber">3.5</span> <span class="toctext">Не удается предоставить общий доступ к папке</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#%22%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%22_%D1%81%D0%B5%D1%82%D0%B8_%D0%B2%D1%8B%D0%B4%D0%B0%D0%B5%D1%82_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D1%83_%22%D0%9D%D0%B5_%D1%83%D0%B4%D0%B0%D0%BB%D0%BE%D1%81%D1%8C_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C_%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2_%D1%81_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0%22_(Failed_to_retrieve_share_list_from_server)"><span class="tocnumber">3.6</span> <span class="toctext">"Просмотр" сети выдает ошибку "Не удалось получить список ресурсов с сервера" (Failed to retrieve share list from server)</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#%D0%92%D1%8B_%D0%BD%D0%B5_%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%D0%B5%D1%81%D1%8C_%D0%B2%D0%BB%D0%B0%D0%B4%D0%B5%D0%BB%D1%8C%D1%86%D0%B5%D0%BC_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0"><span class="tocnumber">3.7</span> <span class="toctext">Вы не являетесь владельцем каталога</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE"><span class="tocnumber">3.8</span> <span class="toctext">protocol negotiation failed: NT_STATUS_INVALID_NETWORK_RESPONSE</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D1%83_%D0%B7%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%BB%D0%BE%D1%81%D1%8C_%D0%BD%D0%B5%D1%83%D0%B4%D0%B0%D1%87%D0%B5%D0%B9:_(Error_NT_STATUS_UNSUCCESSFUL)"><span class="tocnumber">3.9</span> <span class="toctext">Подключение к серверу завершилось неудачей: (Error NT_STATUS_UNSUCCESSFUL)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-44"><a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5"><span class="tocnumber">4</span> <span class="toctext">Смотрите также</span></a></li>
<li class="toclevel-1 tocsection-45"><a href="#%D0%91%D0%BE%D0%BB%D1%8C%D1%88%D0%B5_%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8"><span class="tocnumber">5</span> <span class="toctext">Больше информации</span></a></li>
</ul>
</div>

<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Настройка_сервера">Настройка сервера</span>
</h2>
<h3>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h3>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span>.
</p>
<p>Samba настраивается с помощью конфигурационного файла <code>/etc/samba/smb.conf</code>, который широко документирован на странице руководства <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span>.
</p>
<p>В связи с тем, что пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> поставляется без данного файла, вам нужно создать его <b>перед</b> запуском <i>smb</i>.service.
</p>
<p>Вы можете воспользоваться документированным примером, как в  <code>smb.conf.default</code> из <a rel="nofollow" class="external text" href="https://git.samba.org/samba.git/?p=samba.git;a=blob_plain;f=examples/smb.conf.default;hb=HEAD">git-репозитория Samba</a> для создания <code>/etc/samba/smb.conf</code>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Файл настроек по умолчанию задаёт <code>log file</code> место, доступное только для чтения, что будет вызывать ошибки. Вы можете воспользоваться одним из следующих решений:
<ul>
<li>Задайте файлу регистрации расположение с возможностью записи: <code>log file = /var/log/samba/%m.log</code>
</li>
<li>Используйте бекенд для нефайлового журналирования: замените <code>logging = syslog</code> на <code>syslog only = yes</code> или используйте <code>logging = systemd</code>
</li>
</ul>
</li>
<li>Если требуется; <code>workgroup</code>, указанная в секции <code>[global]</code>, должна соответствовать домашней группе (workgroup) Windows (по умолчанию: <code>WORKGROUP</code>).</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Каждый раз, когда вы изменяете файл <code>smb.conf</code>, запускайте команду <span class="plainlinks archwiki-template-man" title="$ man 1 testparm"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/testparm.1">testparm(1)</a></span> для проверки файла на синтаксические ошибки.</div>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BC.D0.B5.D0.B6.D1.81.D0.B5.D1.82.D0.B5.D0.B2.D0.BE.D0.B3.D0.BE_.D1.8D.D0.BA.D1.80.D0.B0.D0.BD.D0.B0"></span><span class="mw-headline" id="Настройка_межсетевого_экрана">Настройка межсетевого экрана</span>
</h4>
<p>Если вы используете <a href="../ru/Category:Firewalls.html" class="mw-redirect" title="Межсетевой экран">межсетевой экран</a>, не забудьте открыть необходимые порты (как правило, 137-139 + 445). Для получения информации о полном списке портов, смотрите <a rel="nofollow" class="external text" href="https://www.samba.org/~tpot/articles/firewall.html">использование портов Samba</a>.
</p>
<h5>
<span id=".D0.9F.D1.80.D0.B0.D0.B2.D0.B8.D0.BB.D0.BE_UFW"></span><span class="mw-headline" id="Правило_UFW">Правило UFW</span>
</h5>
<p>Так как профиль приложения <a href="../en/Uncomplicated_Firewall.html" title="Uncomplicated Firewall">UFW</a> для Samba по умолчанию отсутствует, вы можете захотеть создать его.
</p>
<p>Создайте или отредактируйте файл <code>/etc/ufw/applications.d/samba</code>, добавив следующее:
</p>
<pre>[Samba]
title=LanManager-like file and printer server for Unix
description=The Samba software suite is a collection of programs that implements the SMB/CIFS protocol for unix systems, allowing you to serve 
files and printers to Windows, NT, OS/2 and DOS clients. This protocol is sometimes also referred to as the LanManager or NetBIOS protocol.
ports=137,138/udp|139,445/tcp
</pre>
<p>Затем загрузите этот профиль в UFW, запустив команду <code>ufw app update Samba</code> как root/sudo.
</p>
<p>После этого можно разрешить доступ к Samba командой <code>ufw allow Samba</code>
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h3>
<h4>
<span id=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F.D0.BC.D0.B8"></span><span class="mw-headline" id="Управление_пользователями">Управление пользователями</span>
</h4>
<h5>
<span id=".D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Добавление_пользователя">Добавление пользователя</span>
</h5>
<p>Для работы Samba требуется какой-нибудь Linux-пользователь — вы можете использовать существующего пользователя или <a href="../ru/Users_and_groups.html#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F" title="Users and groups (Русский)">создать нового</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Пользователь и группа <i>nobody</i> изначально существуют в системе, используются как гостевой аккаунт (<code>guest account</code>) по умолчанию и могут быть использованы в ресурсах для общего доступа с опцией <code>guest ok = yes</code>, благодаря чему пользователям не понадобится логиниться для доступа к таким ресурсам.</div>
<p>Хотя имена пользователей Samba общие с системными пользователями, Samba использует для них отдельные пароли. Чтобы добавить нового пользователя Samba, воспользуйтесь следующей, заменив <code>пользователь_samba</code> на имя нужного пользователя:
</p>
<pre># smbpasswd -a <i>пользователь_samba</i>
</pre>
<p>Будет предложено задать пароль для этого пользователя.
</p>
<p>Depending on the <a rel="nofollow" class="external text" href="https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html#SERVERROLE">server role</a>, existing <a href="../en/File_permissions_and_attributes.html" title="File permissions and attributes">File permissions and attributes</a> may need to be altered for the Samba user account.
</p>
<p>Если вы хотите разрешить новому пользователю только доступ к Samba-ресурсам и запретить полноценный вход в систему, можно ограничить возможности входа:
</p>
<ul>
<li>отключить командную оболочку - <code>usermod --shell /usr/bin/nologin --lock <i>пользователь_samba</i></code>
</li>
<li>отключить вход по SSH - измените опцию <code>AllowUsers</code> в файле <code>/etc/ssh/sshd_conf</code>
</li>
</ul>
<p>См. также <a href="../ru/Security.html" title="Security (Русский)">рекомендации по повышению защищённости системы</a>.
</p>
<h5>
<span id=".D0.9F.D1.80.D0.BE.D1.81.D0.BC.D0.BE.D1.82.D1.80_.D1.81.D0.BF.D0.B8.D1.81.D0.BA.D0.B0_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D0.B5.D0.B9"></span><span class="mw-headline" id="Просмотр_списка_пользователей">Просмотр списка пользователей</span>
</h5>
<p>Список добавленных в Samba пользователей можно посмотреть с помощью команды <span class="plainlinks archwiki-template-man" title="$ man 8 pdbedit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pdbedit.8">pdbedit(8)</a></span>:
</p>
<pre># pdbedit -L -v
</pre>
<h5>
<span id=".D0.A1.D0.BC.D0.B5.D0.BD.D0.B0_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F_Samba-.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Смена_пароля_Samba-пользователя">Смена пароля Samba-пользователя</span>
</h5>
<p>Чтобы сменить пароль пользователя, используйте <code>smbpasswd</code>:
</p>
<pre># smbpasswd <i>пользователь_samba</i>
</pre>
<h4>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.BE.D0.B2_.D0.B4.D0.BB.D1.8F_.D0.BE.D0.B1.D1.89.D0.B5.D0.B3.D0.BE_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0"></span><span class="mw-headline" id="Создание_ресурсов_для_общего_доступа">Создание ресурсов для общего доступа</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Чтобы разрешить использование ресурсов для <i>гостей</i>, нужно добавить опцию <code>map to guest = Bad User</code> в секцию <code>[global]</code> в файле конфигурации <code>/etc/samba/smb.conf</code>. Другой гостевой аккаунт (<code>guest account</code>) может быть использован вместо стандартного <code>nobody</code>.</div>
<p>Откройте файл <code>/etc/samba/smb.conf</code> и прокрутите текст вниз до секции <b>Share Definitions</b>. В конфигурации по умолчанию автоматически предоставляется общий доступ к домашним каталогам всех пользователей. Также по умолчанию он предоставляется для принтеров. Здесь есть несколько закомментированных примеров конфигурации. Больше информации о доступных опциях для ресурсов с общим доступом можно найти на странице руководства <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span>, которая также доступна в <a rel="nofollow" class="external text" href="http://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html">онлайн версии</a>.
</p>
<p>Со стороны Windows не забудьте изменить файл <code>smb.conf</code> для Windows Workgroup (в Windows по умолчанию: WORKGROUP).
</p>
<h4>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D1.81.D0.BB.D1.83.D0.B6.D0.B1"></span><span class="mw-headline" id="Запуск_служб">Запуск служб</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> В <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> 4.8.0-1, службы были переименованы из <code>smbd.service</code> и <code>nmbd.service</code> в <code>smb.service</code> и <code>nmb.service</code>.</div>
<p>Для организации базовых возможностей обмена файлами при помощи SMB <a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">запустите/включите</a> службы <code>smb.service</code> и <code>nmb.service</code>. Для получения дополнительной информации смотрите страницы справочного руководства (man) <a rel="nofollow" class="external text" href="http://www.samba.org/samba/docs/man/manpages-3/smbd.8.html">smbd</a> и <a rel="nofollow" class="external text" href="http://www.samba.org/samba/docs/man/manpages-3/nmbd.8.html">nmbd</a>. Служба <code>nmb.service</code> в некоторых случаях необязательна.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Вместо того, чтобы запускать службу сразу после каждой загрузки системы, вы можете включить <code>smb.socket</code>, благодаря чему она будет запускаться лишь при появлении первого входящего соединения. При этом не забудьте отключить службу <code>smb.service</code>
</div>
<h3>
<span id=".D0.A0.D0.B0.D1.81.D1.88.D0.B8.D1.80.D0.B5.D0.BD.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D1.8F"></span><span class="mw-headline" id="Расширенная_конфигурация">Расширенная конфигурация</span>
</h3>
<h4>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.BE.D0.B2_.D0.BE.D0.B1.D1.89.D0.B5.D0.B3.D0.BE_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BE.D1.82_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D0.BE.D0.B1.D1.8B.D1.87.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Создание_ресурсов_общего_доступа_от_имени_обычного_пользователя">Создание ресурсов общего доступа от имени обычного пользователя</span>
</h4>
<p>"Usershare" - это возможность, позволяющая обычным пользователям добавлять, изменять и удалять собственные ресурсы общего доступа.
</p>
<p>Эта команда создает необходимый каталог в <code>/var/lib/samba</code>:
</p>
<pre># mkdir -p /var/lib/samba/usershares
</pre>
<p>Эта команда создает группу sambashare:
</p>
<pre># groupadd -r sambashare
</pre>
<p>Эта команда меняет владельца и группу каталога, который вы только что создали, на суперпользователя:
</p>
<pre># chown root:sambashare /var/lib/samba/usershares
</pre>
<p>Эта команда меняет разрешения каталога usershares таким образом, что пользователи, входящие в группу sambashare, могут читать, записывать и выполнять файлы:
</p>
<pre># chmod 1770 /var/lib/samba/usershares
</pre>
<p>Задайте эти переменные в конфигурационном файле <code>smb.conf</code>: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[global]
  usershare path = /var/lib/samba/usershares
  usershare max shares = 100
  usershare allow guests = yes
  usershare owner only = yes
  ...</pre>
<p>Добавьте вашего пользователя в группу <i>sambashare</i>. Замените <code>ваше_имя_пользователя</code> на имя вашего linux-пользователя:
</p>
<pre># gpasswd sambashare -a <i>ваше_имя_пользователя</i>
</pre>
<p><a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Перезапустите">Перезапустите</a> службы <code>smb.service</code> и <code>nmb.service</code>.
</p>
<p>Завершите сеанс и войдите снова, чтобы применилось добавление новой группы к вашему пользователю.
</p>
<p>Теперь у вас должна появиться возможность настраивать общий доступ samba, используя графический интерфейс. Например, в <a href="../ru/Thunar.html" title="Thunar (Русский)">Thunar</a> вы можете нажать правую кнопку мыши на любом каталоге и предоставить для него общий доступ в сети.
</p>
<p>Для настройки общего доступа через командную строку используйте одну из следующих команд:
</p>
<pre># net usershare add <i>имя-ресурса</i> <i>абсолютный-путь</i> [<i>комментарий</i>] [<i>пользователь</i>:{R|D|F}] [guest_ok={y|n}]
# net usershare delete <i>имя-ресурса</i>
# net usershare list <i>wildcard-имя-ресурса</i>
# net usershare info <i>wildcard-имя-ресурса</i>
</pre>
<p>Если вы хотите предоставить общий доступ к файлам, находящимся в вашем домашнем каталоге, не забудьте задать доступ как минимум на чтение другим пользователям (<code>chmod a+rX</code>).
</p>
<h4>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B8_.D1.84.D0.BE.D1.80.D1.81.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.B0.D0.B2_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0"></span><span class="mw-headline" id="Установка_и_форсирование_прав_доступа">Установка и форсирование прав доступа</span>
</h4>
<p>Разрешения могут быть применены и к серверу, и к отдельным ресурсам:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  ;inherit owner = unix only ; Наследовать владельца родительского каталога для новых файлов и каталогов
  ;inherit permissions = yes ; Наследовать разрешения родительского каталога для новых файлов и каталогов
  create mask = 0664
  directory mask = 2755
  force create mode = 0644
  force directory mode = 2755
  ...

[media]
  comment = Ресурс, доступный для <i>greg</i> и <i>pcusers</i>
  path = <i>/path/to/media</i>
  valid users = <i>greg @pcusers</i>
  force group = <i>+pcusers</i>
  public = no
  writable = yes
  create mask = 0664
  directory mask = 2775
  force create mode = 0664
  force directory mode = 2775

[public]
  comment = Общий ресурс, в котором <i>archie</i> имеет доступ на запись
  path = <i>/path/to/public</i>
  public = yes
  read only = yes
  write list = <i>archie</i>
  printable = no

[guests]
  comment = Ресурс, разрешающий чтение и запись всем пользователям
  path = <i>/path/to/guests</i>
  public = yes
  only guest = yes
  writable = yes
  printable = no</pre>
<p>См. <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> для более подробной информации о настройке прав доступа.
</p>
<h4>
<span id=".D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D0.B5.D1.80.D1.81.D0.B8.D0.B8_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB.D0.B0_.D0.B4.D0.BB.D1.8F_.D0.BF.D0.BE.D0.B2.D1.8B.D1.88.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B1.D0.B5.D0.B7.D0.BE.D0.BF.D0.B0.D1.81.D0.BD.D0.BE.D1.81.D1.82.D0.B8"></span><span class="mw-headline" id="Ограничение_версии_протокола_для_повышения_безопасности">Ограничение версии протокола для повышения безопасности</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> По умолчанию Samba версии 4.11 допускает соединение с использованием устаревшего и небезопасного протокола SMB1. Для этих версий Samba крайне рекомендуется задать опцию <code>server min protocol = SMB2_02</code> для защиты от ransomware атак. В Samba 4.11 и новее по умолчанию используется SMB2, так что изменения не требуются.</div>
<p>В файле <code>/etc/samba/smb.conf</code> добавьте опции <code>server min protocol</code> и <code>server max protocol</code> для ограничения используемых версий протокола:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  server min protocol = SMB2_02
  ; server max protocol = SMB3</pre>
<p>См. <code>server max protocol</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> для обзора поддерживаемых протоколов.
</p>
<p>Для совместимости со старыми клиентами и/или серверами вам может понадобиться указать <code>client min protocol = CORE</code> или <code>server min protocol = CORE</code>, но имейте в виду, что это делает вас уязвимым в связи с эксплойтами в SMB1, в том числе к ransomware атакам.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Используйте <code>server min protocol = SMB3_00</code> если хотите использовать только самый новый протокол SMB3, например с клиентами на Windows 8 и новее.</div>
<p><a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%BE%D0%B5_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Клиентам</a>, использующим <code>mount.cifs</code>, может понадобиться указать правильный <code>vers=*</code>, например:
</p>
<pre># mount -t cifs //<i>SERVER</i>/<i>имя-ресурса</i> /mnt/<i>точка-монтирования</i> -o username=<i>пользователь</i>,password=<i>пароль</i>,iocharset=<i>utf8</i>,vers=<i>3.1.1</i>
</pre>
<p>Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8">mount.cifs(8)</a></span>.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_SMB"></span><span class="mw-headline" id="Использование_шифрования_SMB">Использование шифрования SMB</span>
</h4>
<p>Нативное шифрование транспорта SMB доступно с версии SMB 3.0. Среди клиентов, поддерживающих такое шифрование, имеются Windows 8 и новее, Windows Server 2012 новее, smbclient в Samba 4.1 и новее.
</p>
<p>Для использования шифрования по умолчанию установите параметр <code>smb encrypt</code> глобально или для отдельных ресурсов. Возможные значения — <code>off</code>, <code>enabled</code> (значение по умолчанию), <code>desired</code> или <code>required</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  smb encrypt = desired</pre>
<p>Смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> для более подробной информации, особенно разделы <i>Effects for SMB1</i> и <i>Effects for SMB2</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> При <a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%BE%D0%B5_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">ручном монтировании</a> ресурса укажите опцию монтирования <code>seal</code> чтобы принудительно включить шифрование.</div>
<h4>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE.D0.B1.D1.89.D0.B5.D0.B3.D0.BE_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BA_.D0.BF.D1.80.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D0.B0.D0.BC"></span><span class="mw-headline" id="Отключение_общего_доступа_к_принтерам">Отключение общего доступа к принтерам</span>
</h4>
<p>По умолчанию Samba предоставляет общий доступ к принтерам, настроенным через <a href="../ru/CUPS.html" title="CUPS (Русский)">CUPS</a>.
</p>
<p>Если вам это не нужно, используйте следующие опции для отключения:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  load printers = no
  printing = bsd
  printcap name = /dev/null
  disable spoolss = yes
  show add printer wizard = no</pre>
<h4>
<span id=".D0.97.D0.B0.D0.BF.D1.80.D0.B5.D1.82_.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D1.91.D0.BD.D0.BD.D1.8B.D1.85_.D1.80.D0.B0.D1.81.D1.88.D0.B8.D1.80.D0.B5.D0.BD.D0.B8.D0.B9_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B2_.D0.BE.D0.B1.D1.89.D0.B5.D0.BC_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.B5_Samba"></span><span class="mw-headline" id="Запрет_определённых_расширений_файлов_в_общем_ресурсе_Samba">Запрет определённых расширений файлов в общем ресурсе Samba</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Использование этой опции влияет на производительность Samba, так как вынуждает проверять все файлы и каталоги на совпадение по мере их сканирования.</div>
<p>Samba предоставляет опцию для блокирования файлов по определённым паттернам, вроде расширений файлов. Её можно использовать для предотвращения распространения вирусов или для того, чтобы пользователи не тратили место на определённые файлы. Более подробную информацию можно найти в <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[myshare]
  comment = Private
  path = /mnt/data
  read only = no
  veto files = /*.exe/*.com/*.dll/*.bat/*.vbs/*.tmp/*.mp3/*.avi/*.mp4/*.wmv/*.wma/</pre>
<h4>
<span id=".D0.A3.D0.B2.D0.B5.D0.BB.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.BF.D1.83.D1.81.D0.BA.D0.BD.D0.BE.D0.B9_.D1.81.D0.BF.D0.BE.D1.81.D0.BE.D0.B1.D0.BD.D0.BE.D1.81.D1.82.D0.B8"></span><span class="mw-headline" id="Увеличение_пропускной_способности">Увеличение пропускной способности</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Помните, что это может привести к проблемам с подключением и потенциально сломать ваш стек TCP/IP.</div>
<p>Большинству пользователей подойдут настройки по умолчанию. Однако корректное использование 'socket options' может улучшить производительность, но ошибки в настройке также могут и ухудшить её. Проверяйте эффекты, прежде чем вносить какие-либо серьезные изменения.
</p>
<p>Читайте <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> прежде чем применять описанные здесь опции.
</p>
<p>Эти опции прописываются в файле <code>/etc/samba/smb.conf</code> в секции <code>[global]</code>.
</p>
<p>SMB3 multi-channel может улучшить производительности, однако иногда может испортить данные из-за race conditions. В будущих версиях ситуация может улучшиться:
</p>
<pre>server multi channel support = yes
</pre>
<p>Ограничение времени бездействия полезно для предотвращения исчерпания ресурсов сервера из-за большого количества неактивных подключений:
</p>
<pre>deadtime = 30
</pre>
<p>Использование sendfile улучшает эффективность использования процессора и повышает скорость Samba:
</p>
<pre>use sendfile = yes
</pre>
<p>Установка min receivefile size разрешает zero-copy запись непосредственно из буфера сокета в кэш файловой системы (если доступен). Это может улучшить производительность, но требует тестирования:
</p>
<pre>min receivefile size = 16384
</pre>
<p>Асинхронное чтение/запись файлов может повысить производительность:
</p>
<pre>aio read size = 1
aio write size = 1
</pre>
<p>Увеличение размера буферов приёма/отправки и флаги оптимизации сокетов могут быть полезны для улучшения производительности. Рекомендуется протестировать каждый флаг отдельно, так как они могут вызывать проблемы в некоторых сетях:
</p>
<pre>socket options = IPTOS_LOWDELAY TCP_NODELAY IPTOS_THROUGHPUT SO_RCVBUF=131072 SO_SNDBUF=131072
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Для некоторых опций может понадобиться изменить настройки сетевого интерфейса, см. <a href="../en/Sysctl.html#Networking" title="Sysctl">Sysctl#Networking</a>.</div>
<h4>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.B4.D0.BB.D1.8F_.D1.81.D1.82.D0.B0.D1.80.D1.8B.D1.85_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.BE.D0.B2_.D0.B8.D0.BB.D0.B8_.D1.83.D1.81.D1.82.D1.80.D0.BE.D0.B9.D1.81.D1.82.D0.B2"></span><span class="mw-headline" id="Включение_доступа_для_старых_клиентов_или_устройств">Включение доступа для старых клиентов или устройств</span>
</h4>
<p>Последние версии Samba больше не предлагают старые методы аутентификации и протоколы, которые всё ещё используются некоторыми старыми клиентами (IP-камерами и т.д.). Такие устройства обычно требуют от сервера разрешения аутентификации NTLMv1 и протокола NT1, известного как CIFS. Чтобы эти устройства работали с последней версией Samba, добавьте эти два параметра в секцию <code>[global]</code>:
</p>
<pre>server min protocol = NT1
ntlm auth = yes
</pre>
<p>Для анонимного/гостевого доступа достаточно лишь первого параметра. Если старое устройство использует имя и пароль для доступа, то нужен и второй параметр тоже.
</p>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0"></span><span class="mw-headline" id="Настройка_клиента">Настройка клиента</span>
</h2>
<p>Для доступа к файлам с использованием сервера Samba/SMB/CIFS необходим только пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span>. Он доступен в <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториях</a>.
</p>
<p>Вы можете получать доступ и монтировать локально ресурсы, предоставленные для общего доступа другими компьютерами сети, используя графический интерфейс или интерфейс командной строки. Графический способ ограничен, так как большинство легковесных окружений рабочего стола не имеет родных средств настройки доступа к этим ресурсам.
</p>
<p>Существует две "части" предоставления общего доступа. Первая лежит в основе механизма работы файловой системы, а вторая является интерфейсом, который позволяет пользователю выбирать монтируемые ресурсы общего доступа. В некоторых окружениях первая часть уже встроена.
</p>
<h3>
<span id=".D0.A0.D1.83.D1.87.D0.BD.D0.BE.D0.B5_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Ручное_монтирование">Ручное монтирование</span>
</h3>
<p>Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> из официальных репозиториев. Если вы желаете получить более легкий подход и не нуждаетесь в возможности вывода списка общедоступных ресурсов, необходимо установить только <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cifs-utils">cifs-utils</a></span>, чтобы предоставить файл <code>/usr/bin/mount.cifs</code>.
</p>
<p>Чтобы вывести список общедоступных ресурсов на сервере:
</p>
<pre>$ smbclient -L <i>hostname</i> -U%
</pre>
<p>Создать точку монтирования для ресурса:
</p>
<pre># mkdir /mnt/<i>точка_монтирования</i>
</pre>
<p>Примонтируйте ресурс, используя в качестве образца файл <code>mount.cifs</code>. Не все опции из перечисленных ниже необходимы или хороши (например, <code>password</code>).
</p>
<pre># mount -t cifs //<i>СЕРВЕР</i>/<i>имя_ресурса</i> /mnt/<i>точка_монтирования</i> -o user=<i>имя_пользователя</i>,password=<i>пароль</i>,workgroup=<i>рабочая_группа</i>,ip=<i>IP_сервера</i></pre>
<p><i>SERVER</i>
</p>
<dl><dd>Имя системы Windows.</dd></dl>
<p><i>имя_ресурса</i>
</p>
<dl><dd>Каталог общего доступа.</dd></dl>
<p><i>точка_монтирования</i>
</p>
<dl><dd>Локальный каталог, в который будет примонтирован ресурс.</dd></dl>
<p><code>-o [options]</code>
</p>
<dl><dd>Смотрите страницу руководства <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8">mount.cifs(8)</a></span> для получения информации.</dd></dl>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Воздержитесь от использования слэша <code>/</code> на конце. <code>//<i>СЕРВЕР</i>/<i>имя_ресурса</i><b>/</b></code> не будет работать</li>
<li>Если примонтированный вами ресурс работает нестабильно или зависает (freeze), попробуйте включить другую версию протокола SMB, используя опцию <code>vers=</code>. Например, <code>vers=2.0</code> для Windows Vista.</li>
</ul>
</div>
<h4>
<span id=".D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.B0_.D0.B2_.2Fetc.2Ffstab"></span><span class="mw-headline" id="Добавление_ресурса_в_/etc/fstab">Добавление ресурса в /etc/fstab</span>
</h4>
<p>Самый простой способ добавить запись в fstab - использовать что-то вроде этого:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//<i>СЕРВЕР</i>/<i>имя_ресурса</i> /mnt/<i>точка_монтирования</i> cifs username=<i>имя_пользователя</i>,password=<i>пароль</i> 0 0</pre>
<p>Однако, хранение паролей в легкочитаемом файле не рекомендуется! Более безопасным методом является использование файла полномочий. Например, создайте файл и выполните команду <code>chmod 600 <i>имя_файла</i></code>, в результате чего только пользователь-владелец файла сможет читать и писать в него. Файл должен содержать следующую информацию:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/путь/к/полномочиям/sambacreds</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">username=<i>имя_пользователя</i>
password=<i>пароль</i></pre>
<p>а запись в вашем fstab должна выглядеть примерно так:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//СЕРВЕР/ИМЯ_РЕСУРСА /mnt/<i>точка_монтирования</i> cifs credentials=<i>/путь/к/полномочиям/sambacreds</i> 0 0</pre>
<p>При использовании <i>systemd</i> (современные установки) можно использовать опцию <code>comment=systemd.automount</code>, которая увеличивает скорость загрузки сервиса на несколько секунд. Также можно указать текущего пользователя и группу, чтобы сделать жизнь немного проще, используя опции <code>uid</code> и <code>gid</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Использование опций <code>uid</code> и <code>gid</code> может вызвать ошибки ввода-вывода в программах, пытающихся получить данные с сетевых устройств</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//<i>СЕРВЕР</i>/<i>ИМЯ_РЕСУРСА</i> /mnt/<i>точка_монтирования</i> cifs credentials=<i>/путь/к/полномочиям</i>,comment=systemd.automount,uid=<i>имя_пользователя</i>,gid=<i>группа_пользователя</i> 0 0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Пробелы в именах ресурсов должны быть заменены на <code>\040</code> (восьмеричный ASCII-код для пробелов). Например, <code>//<i>СЕРВЕР</i>/имя ресурса</code> должно быть заменено на <code>//<i>СЕРВЕР</i>/имя\040ресурса</code> в <code>/etc/fstab</code>
</div>
<h4>
<span id=".D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F.D0.BC.D0.B8"></span><span class="mw-headline" id="Монтирование_пользователями">Монтирование пользователями</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//<i>СЕРВЕР</i>/<i>ИМЯ_РЕСУРСА</i> /mnt/<i>точка_монтирования</i> cifs users,credentials=<i>/путь/к/полномочиям</i>,workgroup=<i>рабочая_группа</i>,ip=<i>IP_сервера</i> 0 0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Необходимо писать user<b>s</b> (во множественном числе). Для других типов файловых систем, обрабатываемых командой <code>mount</code>, эта опция обычно имеет вид <i>user</i>, без "<b>s</b>"</div>
<p>Это позволит пользователям монтировать ресурс, если точка монтирования находится в каталоге, владельцами которого они являются, например, в свою домашнюю директорию. Чтобы пользователи могли монтировать и размонтировать ресурсы Samba в точках монтирования, владельцами которых они не являются, используйте <a href="#smbnetfs">smbnetfs</a> или дайте им необходимые привилегии с помощью <a href="../ru/Sudo.html" title="Sudo (Русский)">sudo</a>.
</p>
<h3>
<span id=".D0.98.D0.BC.D0.B5.D0.BD.D0.B0_.D1.85.D0.BE.D1.81.D1.82.D0.BE.D0.B2_WINS"></span><span class="mw-headline" id="Имена_хостов_WINS">Имена хостов WINS</span>
</h3>
<p>Пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> предоставляет драйвер для использования имен хостов WINS. Чтобы его включить, добавьте “wins” в строку “hosts” файла /etc/nsswitch.conf.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B5_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Автоматическое_монтирование">Автоматическое монтирование</span>
</h3>
<p>Есть несколько способов легко просматривать ресурсы общего доступа:
</p>
<h4><span class="mw-headline" id="smbnetfs">smbnetfs</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> для smbnetfs необходима целая (нетронутая?) (intact) установка сервера Samba. Смотрите выше, как это сделать</div>
<p>Для начала удостоверьтесь, что вам доступны все ресурсы, которые вам нужны для монтирования:
</p>
<pre>$ smbtree -U <i>удаленный_пользователь</i>
</pre>
<p>Если это не работает, найдите и измените следующую строку в <code>/etc/samba/smb.conf</code> подобным образом:
</p>
<pre>domain master = auto
</pre>
<p>Теперь <a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">перезапустите</a> службы <code>smbd.service</code> и <code>nmbd.service</code>.
</p>
<p>Если все работает, как и ожидалось, <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbnetfs">smbnetfs</a></span> из официальных репозиториев.
</p>
<p>Затем добавьте следующую строку в файл <code>/etc/fuse.conf</code>:
</p>
<pre>user_allow_other
</pre>
<p>и загрузите <a href="../ru/Kernel_module.html" class="mw-redirect" title="Kernel modules (Русский)">модуль ядра</a> <code>fuse</code>:
</p>
<pre># modprobe fuse
</pre>
<p>Скопируйте каталог <code>/etc/smbnetfs/.smb</code> в вашу домашнюю директорию:
</p>
<pre>$ cp -a /etc/smbnetfs/.smb ~
</pre>
<p>Затем создайте ссылку на файл <code>smb.conf</code>:
</p>
<pre>$ ln -sf /etc/samba/smb.conf ~/.smb/smb.conf
</pre>
<p>Если для доступа к некоторым общим каталогам необходимы имя пользователя и пароль, отредактируйте файл <code>~/.smb/smbnetfs.auth</code>, включив одну или несколько записей, как эта:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.smb/smbnetfs.auth</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth			"hostname" "имя_пользователя" "пароль"
</pre>
<p>Также возможно добавление записей для специфичных хостов, чтобы они были примонтированы smbnetfs, если это необходимо. Больше  информации можно найти в <code>~/.smb/smbnetfs.conf</code>.
</p>
<p>Когда вы закончите настройку, необходимо выполнить
</p>
<pre>$ chmod 600 ~/.smb/smbnetfs.*
</pre>
<p>В противном случае smbnetfs пожалуется: 'insecure config file permissions'.
</p>
<p>Наконец, чтобы примонтировать сетевое окружение Samba в каталог по вашему выбору, выполните
</p>
<pre>$ smbnetfs <i>точка_монтирования</i>
</pre>
<h5>
<span id=".D0.94.D0.B5.D0.BC.D0.BE.D0.BD"></span><span class="mw-headline" id="Демон">Демон</span>
</h5>
<p>Пакет в Arch Linux также поддерживает дополнительный "общесистемный" режим для smbnetfs. Чтобы его включить, вам необходимо выполнить указанные изменения в каталоге <code>/etc/smbnetfs/.smb</code>.
</p>
<p>Затем вы можете запустить и/или включить в автозагрузку <a href="../ru/Daemons.html" class="mw-redirect" title="Daemon (Русский)">демон</a> <code>smbnetfs</code> обычным способом. Общесистемной точкой монтирования является <code>/mnt/smbnet/</code>.
</p>
<h4><span class="mw-headline" id="autofs">autofs</span></h4>
<p>Смотрите статью <a href="../ru/Autofs.html" title="Autofs (Русский)">Autofs</a> для получения информации об автомонтировщике ядра (kernel-based) Linux.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2.D0.BE.D0.B3.D0.BE_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Настройка_файлового_менеджера">Настройка файлового менеджера</span>
</h3>
<h4>
<span id="Nautilus.2C_Nemo.2C_Thunar_.D0.B8_PCManFM"></span><span class="mw-headline" id="Nautilus,_Nemo,_Thunar_и_PCManFM">Nautilus, Nemo, Thunar и PCManFM</span>
</h4>
<p>Чтобы получить доступ к ресурсам samba через Nautilus, Nemo, Thunar или PCManFM, установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gvfs-smb">gvfs-smb</a></span>, доступный в <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториях</a>.
</p>
<p>Нажмите <code>Ctrl+l</code> и введите <code>smb://<i>имя_сервера</i>/<i>ресурс</i></code> в панель адреса, чтобы получить доступ к ресурсу.
</p>
<p>Примонтированный ресурс, вероятно, будет представлен в файловой системе по пути <code>/run/user/<i>ваш_UID</i>/gvfs</code>.
</p>
<h4><span class="mw-headline" id="KDE">KDE</span></h4>
<p>KDE имеет встроенную возможность просмотра ресурсов Samba, в этом случае нет необходимости в дополнительных пакетах. Однако, для графического интерфейса в Системных Настройках KDE установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdenetwork-filesharing">kdenetwork-filesharing</a></span> из <a href="../ru/Official_repositories.html" title="Official repositories (Русский)">официальных репозиториев</a>.
</p>
<p>
Если при использовании Dolphin вы получите ошибку "Time Out", необходимо раскомментировать и отредактировать эту строку в файле smb.conf:</p>
<pre>name resolve order = lmhosts bcast host wins</pre>
<p>как показано <a rel="nofollow" class="external text" href="http://ubuntuforums.org/showthread.php?t=1605499">на этой странице</a>.
</p>
<h4>
<span id=".D0.94.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.B3.D1.80.D0.B0.D1.84.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D0.BE.D0.BA.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Другие_графические_окружения">Другие графические окружения</span>
</h4>
<p>Есть несколько полезных программ, но им могут требоваться пакеты, созданные для них. Это может быть сделано с помощью Arch package build system. Хорошая новость заключается в том, что они не нуждаются в особом окружении, устанавливаемом для их поддержки, так что они "тянут" за собой меньше пакетов.
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pyneighborhood/">pyneighborhood</a></span><sup><small>AUR</small></sup> доступен в официальных репозиториях</li>
<li>Плагины LinNeighborhood, RUmba, xffm-samba для Xffm недоступен в официальных репозиториях или в <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>. Поскольку они не поддерживаются официально (или поддерживаются, но неофициально), они могут быть устаревшими и не работать в полной мере</li>
</ul>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D1.8B_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BA_Windows_7_-_mount_error.2812.29:_cannot_allocate_memory"></span><span class="mw-headline" id="Проблемы_подключения_к_Windows_7_-_mount_error(12):_cannot_allocate_memory">Проблемы подключения к Windows 7 - mount error(12): cannot allocate memory</span>
</h3>
<p>Известная ошибка Windows 7 "mount error(12): cannot allocate memory" может быть исправлена установкой пары ключей в реестре системы Windows:
</p>
<ul>
<li>
<code>HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\LargeSystemCache</code> (установить значение <code>1</code>)</li>
<li>
<code>HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\Size</code> (установить значение <code>3</code>)</li>
</ul>
<p>В качестве альтернативы можно запустить командную строку от имени Администратора и выполнить следующее:
</p>
<pre>reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v "LargeSystemCache" /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v "Size" /t REG_DWORD /d 3 /f
</pre>
<p>Выполните одно из следующих действий, чтобы изменения вступили в силу:
</p>
<ul>
<li>Перезагрузите Windows</li>
<li>Перезапустите службу на сервере через services.msc</li>
<li>Выполните в командной строке <code>net stop lanmanserver</code> и <code>net start lanmanserver</code>; после остановки служба может перезапуститься автоматически</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Поиск решения в интернете подскажет другое решение, рекомендующее пользователям добавить ключ, изменяющий размер "IRPStackSize". Это неправильное решение для устранения проблемы в Windows 7. Не применяйте его</div>
<p><a rel="nofollow" class="external text" href="http://alan.lamielle.net/2009/09/03/windows-7-nonpaged-pool-srv-error-2017">Исходная статья</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D1.8B_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BA_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.B0.D0.BC.2C_.D0.B7.D0.B0.D1.89.D0.B8.D1.89.D0.B5.D0.BD.D0.BD.D1.8B.D0.BC_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D0.B5.D0.BC.2C_.D0.B8.D0.B7_Windows"></span><span class="mw-headline" id="Проблемы_получения_доступа_к_ресурсам,_защищенным_паролем,_из_Windows">Проблемы получения доступа к ресурсам, защищенным паролем, из Windows</span>
</h3>
<p>При проблемах получения доступа к ресурсам, защищенным паролем, из Windows попробуйте добавить следующее в файл <code>/etc/samba/smb.conf</code>:<a rel="nofollow" class="external autonumber" href="http://blogs.computerworld.com/networking_nightmare_ii_adding_linux">[1]</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup>
</p>
<p>Обратите внимание, что это должно быть добавлено в <b>локальный</b> файл smb.conf, а не в файл сервера
</p>
<pre>[global]
# lanman fix
client lanman auth = yes
client ntlmv2 auth = no
</pre>
<h3>
<span id=".D0.94.D0.B8.D0.B0.D0.BB.D0.BE.D0.B3.D0.BE.D0.B2.D0.BE.D0.B5_.D0.BE.D0.BA.D0.BD.D0.BE_.D0.BF.D0.BE.D1.8F.D0.B2.D0.BB.D1.8F.D0.B5.D1.82.D1.81.D1.8F_.D1.81_.D0.B1.D0.BE.D0.BB.D1.8C.D1.88.D0.BE.D0.B9_.D0.B7.D0.B0.D0.B4.D0.B5.D1.80.D0.B6.D0.BA.D0.BE.D0.B9"></span><span class="mw-headline" id="Диалоговое_окно_появляется_с_большой_задержкой">Диалоговое окно появляется с большой задержкой</span>
</h3>
<p>У меня была проблема, связанная с тем, что диалоговое окно для ввода пароля появлялось с задержкой около 30 секунд, когда я пытался установить соединение из Windows XP/Windows 7. Когда я посмотрел файл error.log на сервере, я увидел:
</p>
<pre>[2009/11/11 06:20:12,  0] printing/print_cups.c:cups_connect(103)
Unable to connect to CUPS server localhost:631 - Interrupted system call
</pre>
<p>Эта опция предотвращает поиск cups и файла /etc/printcap:
</p>
<pre>printing = bsd
printcap name = /dev/null
</pre>
<h3>
<span id=".D0.9E.D1.88.D0.B8.D0.B1.D0.BA.D0.B0:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL"></span><span class="mw-headline" id="Ошибка:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL">Ошибка: Failed to retrieve printer list: NT_STATUS_UNSUCCESSFUL</span>
</h3>
<p>Если вы являетесь домашним пользователем, используете samba исключительно для организации общего доступа к файлам с сервера или NAS и не заинтересованы в организации общего доступа к принтерам, вы можете исправить эту ошибку, добавив следующие строки в файл /etc/samba/smb.conf:
</p>
<pre>load printers = No
printing = bsd
printcap name = /dev/null
disable spoolss = Yes
</pre>
<p>Перезапустите samba:
</p>
<pre>systemctl restart smbd</pre>
<p>…проверьте ваши логи:
</p>
<pre>cat /var/log/samba/smbd.log</pre>
<p>и больше ошибка не должна появляться.
</p>
<h3>
<span id=".D0.9D.D0.B5_.D1.83.D0.B4.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BF.D1.80.D0.B5.D0.B4.D0.BE.D1.81.D1.82.D0.B0.D0.B2.D0.B8.D1.82.D1.8C_.D0.BE.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D0.BA_.D0.BF.D0.B0.D0.BF.D0.BA.D0.B5"></span><span class="mw-headline" id="Не_удается_предоставить_общий_доступ_к_папке">Не удается предоставить общий доступ к папке</span>
</h3>
<p>Проблема проявляется в том, что, когда вы пытаетесь предоставить общий доступ к папке через <i>Dolphin</i> (файловый менеджер), и вначале, вроде бы, все работает нормально, после перезапуска <i>Dolphin</i> иконка ресурса исчезла из папки, а в терминале (<i>Konsole</i>) вы видите следующий вывод:
</p>
<pre>‘net usershare’ returned error 255: net usershare: usershares are currently disabled
</pre>
<p>Для решения проблемы включите пользовательские общие ресурсы, как это описано в разделе <a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BE%D0%B2_%D0%BE%D0%B1%D1%89%D0%B5%D0%B3%D0%BE_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">#Создание ресурсов общего доступа от имени обычного пользователя</a>.
</p>
<h3>
<span id=".22.D0.9F.D1.80.D0.BE.D1.81.D0.BC.D0.BE.D1.82.D1.80.22_.D1.81.D0.B5.D1.82.D0.B8_.D0.B2.D1.8B.D0.B4.D0.B0.D0.B5.D1.82_.D0.BE.D1.88.D0.B8.D0.B1.D0.BA.D1.83_.22.D0.9D.D0.B5_.D1.83.D0.B4.D0.B0.D0.BB.D0.BE.D1.81.D1.8C_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B8.D1.82.D1.8C_.D1.81.D0.BF.D0.B8.D1.81.D0.BE.D0.BA_.D1.80.D0.B5.D1.81.D1.83.D1.80.D1.81.D0.BE.D0.B2_.D1.81_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B0.22_.28Failed_to_retrieve_share_list_from_server.29"></span><span class="mw-headline" id='"Просмотр"_сети_выдает_ошибку_"Не_удалось_получить_список_ресурсов_с_сервера"_(Failed_to_retrieve_share_list_from_server)'>"Просмотр" сети выдает ошибку "Не удалось получить список ресурсов с сервера" (Failed to retrieve share list from server)</span>
</h3>
<p>И вы используете firewall (iptables), поскольку не доверяете вашей локальной (школа, университет, отель) сети. Это может происходить по следующей причине: когда smbclient просматривает локальную сеть, он посылает широковещательный запрос на udp-порт 137. Затем серверы сети отвечают вашему клиенту, но, поскольку исходный адрес ответа отличается от адреса назначения, который видел iptables при отправке запроса, iptables не признает ответ как "установленное соединение" или "относящийся к запросу", и, следовательно, пакет отбрасывается. Возможное решение - добавление:
</p>
<pre>iptables -t raw -A OUTPUT -p udp -m udp --dport 137 -j CT --helper netbios-ns
</pre>
<p>в вашу конфигурацию iptables.
</p>
<h3>
<span id=".D0.92.D1.8B_.D0.BD.D0.B5_.D1.8F.D0.B2.D0.BB.D1.8F.D0.B5.D1.82.D0.B5.D1.81.D1.8C_.D0.B2.D0.BB.D0.B0.D0.B4.D0.B5.D0.BB.D1.8C.D1.86.D0.B5.D0.BC_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0"></span><span class="mw-headline" id="Вы_не_являетесь_владельцем_каталога">Вы не являетесь владельцем каталога</span>
</h3>
<p>Попробуйте просто перезагрузить систему.
</p>
<h3><span class="mw-headline" id="protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE">protocol negotiation failed: NT_STATUS_INVALID_NETWORK_RESPONSE</span></h3>
<p>Вероятно, клиент не имеет доступа к общим ресурсам. Удостоверьтесь, что IP-адрес клиента прописан в строке <code>hosts allow =</code> файла <code>/etc/samba/smb.conf</code>.
</p>
<h3>
<span id=".D0.9F.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D1.83_.D0.B7.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B8.D0.BB.D0.BE.D1.81.D1.8C_.D0.BD.D0.B5.D1.83.D0.B4.D0.B0.D1.87.D0.B5.D0.B9:_.28Error_NT_STATUS_UNSUCCESSFUL.29"></span><span class="mw-headline" id="Подключение_к_серверу_завершилось_неудачей:_(Error_NT_STATUS_UNSUCCESSFUL)">Подключение к серверу завершилось неудачей: (Error NT_STATUS_UNSUCCESSFUL)</span>
</h3>
<p>Вероятно, вы указываете <code>smbclient</code> неправильное имя сервера. Чтобы узнать его, запустите на сервере команду <code>hostnamectl</code> и найдите строку "Transient hostname".
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.samba.org/samba/docs/SambaIntro.html">Samba: An Introduction</a></li>
<li><a rel="nofollow" class="external text" href="http://www.samba.org/">Официальный сайт Samba</a></li>
</ul>
<h2>
<span id=".D0.91.D0.BE.D0.BB.D1.8C.D1.88.D0.B5_.D0.B8.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Больше_информации">Больше информации</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="http://wiki.archlinux.de/?title=Samba">Samba</a> Samba (German) (archlinux.de)</li>
<li>
<a rel="nofollow" class="external text" href="http://runos.ru/linux-v-windows-seti/sekretyi-optimizatsii-samba.html">Ускорение работы Samba</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">устаревшая ссылка</a> 2020-08-04]</sup>
</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Network_sharing.html" title="Category:Network sharing (Русский)">Network sharing (Русский)</a></li>
<li><a href="../ru/Category:Servers.html" title="Category:Servers (Русский)">Servers (Русский)</a></li>
</ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Samba_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=645149">https://wiki.archlinux.org/index.php?title=Samba_(Русский)&amp;oldid=645149</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 13 December 2020, at 14:24.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
