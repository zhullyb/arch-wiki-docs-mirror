<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>E4rat (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-E4rat_简体中文 rootpage-E4rat_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">E4rat (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/6d9695d7cc01d6e70cbdedb13033d4b2.html" class="mw-redirect" title="Improve Boot Performance (简体中文)">Improve Boot Performance (简体中文)</a></li>
<li><a href="../en/Preload.html" title="Preload">Preload</a></li>
<li><a href="../zh-CN/Ext4.html" title="Ext4 (简体中文)">Ext4 (简体中文)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/E4rat.html" title="E4rat">E4rat</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2012-07-11。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=E4rat&amp;diff=0&amp;oldid=212533">更改</a>，则您可以帮助同步翻译。</div>
<p><a rel="nofollow" class="external text" href="http://e4rat.sourceforge.net/">e4rat</a>，“Ext4 - Reducing Access Times”（减少ext4访问次数）之略，是一款优化<a href="../zh-CN/Ext4.html" title="Ext4 (简体中文)">ext4</a>文件系统、加速系统启动的工具。该项目由 Andreas Rid 和 Gundolf Kiefer 发起。<a rel="nofollow" class="external text" href="http://e4rat.sourceforge.net/">e4rat工具系列</a>包含e4rat-collect、e4rat-realloc、e4rat-preload。
</p>
<p>目前最新版本是0.21。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E6%9C%BA%E5%88%B6"><span class="tocnumber">1</span> <span class="toctext">机制</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E5%AF%B9%E8%B0%81%E6%9C%89%E6%95%88%EF%BC%9F"><span class="tocnumber">1.1</span> <span class="toctext">对谁有效？</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">2</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">3</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#e4rat-collect"><span class="tocnumber">3.1</span> <span class="toctext">e4rat-collect</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#e4rat-realloc"><span class="tocnumber">3.2</span> <span class="toctext">e4rat-realloc</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#e4rat-preload"><span class="tocnumber">3.3</span> <span class="toctext">e4rat-preload</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#%E5%8F%A6%E4%B8%80%E9%80%89%E6%8B%A9%EF%BC%9Ae4rat-preload-lite"><span class="tocnumber">3.4</span> <span class="toctext">另一选择：e4rat-preload-lite</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#%E5%85%B6%E4%BB%96_init_%E7%A8%8B%E5%BA%8F%E6%90%AD%E9%85%8D_e4rat"><span class="tocnumber">4</span> <span class="toctext">其他 init 程序搭配 e4rat</span></a></li>
<li class="toclevel-1 tocsection-10">
<a href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="tocnumber">5</span> <span class="toctext">启动流程图</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#bootchart_0.9-9"><span class="tocnumber">5.1</span> <span class="toctext">bootchart 0.9-9</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#bootchart2"><span class="tocnumber">5.2</span> <span class="toctext">bootchart2</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13">
<a href="#%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94"><span class="tocnumber">6</span> <span class="toctext">疑难解答</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#startup.log_%E6%9C%AA%E5%88%9B%E5%BB%BA"><span class="tocnumber">6.1</span> <span class="toctext">startup.log 未创建</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#e4rat_%E9%94%99%E8%AF%AF%E5%9C%B0%E6%8A%A5%E5%91%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%BA_ext2"><span class="tocnumber">6.2</span> <span class="toctext">e4rat 错误地报告文件系统为 ext2</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96_startup.log"><span class="tocnumber">6.3</span> <span class="toctext">无法读取 startup.log</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%E5%87%8F%E5%B0%91%E5%90%AF%E5%8A%A8%E6%97%B6%E7%9A%84%E4%BF%A1%E6%81%AF%E8%BE%93%E5%87%BA"><span class="tocnumber">6.4</span> <span class="toctext">减少启动时的信息输出</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E6.9C.BA.E5.88.B6"></span><span class="mw-headline" id="机制">机制</span>
</h2>
<p>如果你用<a href="../zh-CN/Bootchart.html" title="Bootchart (简体中文)">bootchart</a>监视开机过程，会发现CPU和磁盘均未全速运转。e4rat将改变这一状况，使系统启动时CPU和磁盘全速运转，从而加速启动过程。此优化包括三步：
</p>
<ul>
<li>
<b>e4rat-collect</b> - 收集文件，在特定时间（默认120s，可调整）内收集文件信息</li>
<li>
<b>e4rat-realloc</b> - 文件再分配，在磁盘上整理文件</li>
<li>
<b>e4rat-preload</b> - 预读取文件</li>
</ul>
<h3>
<span id=".E5.AF.B9.E8.B0.81.E6.9C.89.E6.95.88.EF.BC.9F"></span><span class="mw-headline" id="对谁有效？">对谁有效？</span>
</h3>
<p>经证实，e4rat对一般用户——直接进入X图形界面——特别有效，但对于服务器用户——启动到命令行——效果不怎么明显。此外，此工具对SSD（固态磁盘）用户也没用，因为SSD基本没有读取延迟。<a href="../en/Improving_performance/Boot_process.html" class="mw-redirect" title="Ureadahead">Ureadahead</a> 可能会有效。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <a rel="nofollow" class="external text" href="http://e4rat.sourceforge.net/wiki/index.php/Main_Page#Ubuntu_and_ureadahead">e4rat 官方手册</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup> 声称 ureadahead 与 e4rat 冲突，在 Ubuntu 中确实这样，但是 Arch 中并无冲突，但有 ureadahead 的情况下，速度提升效果有限。</div>
<p>为保险起见，请及时备份数据。
</p>
<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../zh-CN/Pacman.html" title="Pacman (简体中文)">安装</a>位于<a href="../zh-CN/Official_repositories.html" title="Official repositories (简体中文)">官方软件仓库</a>的 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/e4rat/">e4rat</a></span><sup><small>AUR</small></sup>.
</p>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p>现在进入正题。
</p>
<h3><span class="mw-headline" id="e4rat-collect">e4rat-collect</span></h3>
<p>首先，e4rat需要收集开机时预读的文件列表。添加如下内容到<code>/boot/grub/menu.lst</code>（grub）启动项的<code>linux</code>行末尾，或<code>/boot/grub/grub.cfg</code>（grub2）启动项的<code>kernel</code> 行：
</p>
<pre>kernel /vmlinuz0linux root=/dev/disk/by-label/ARCH init=/sbin/e4rat-collect ro 5</pre>
<p>)
</p>
<p>由于该过程只需进行一次，所以我建议直接在grub命令行修改即可，而不必修改启动菜单文件。
</p>
<p>启动后，e4rat-collect默认会监视系统120秒。所以请在两分钟内打开经常使用的程序，e4rat-collect会记录下来（译者注：我不建议预读太多东西，这样反而会拖慢开机速度）。可以在<code>/etc/e4rat.conf</code>中修改默认的120秒收集时间（<code>timeout 120</code>这一行，去掉注释）。或者手动停止e4rat-collect：
</p>
<pre>e4rat-collect -k
</pre>
<p>或者：
</p>
<pre>pkill e4rat-collect
</pre>
<p>收集完成后，应该会出现这个文件：<code>/var/lib/e4rat/startup.log</code>
</p>
<p>最后，不要忘记从<code>/boot/grub/grub.cfg</code>或<code>/boot/grub/menu.lst</code>中移除最开始添加的内容。
</p>
<h3><span class="mw-headline" id="e4rat-realloc">e4rat-realloc</span></h3>
<p>接着上一步进行文件再分配（通俗说就是磁盘整理）。先切换启动级别1：
</p>
<pre>sudo init 1
</pre>
<p>输入root密码，执行：
</p>
<pre>e4rat-realloc  /var/lib/e4rat/startup.log
</pre>
<p>根据<code>startup.log</code>中文件的多少，或长或短要等一段时间。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 使用纯 <a href="../en/Systemd.html" title="Systemd">systemd</a> 的用户不需要修改 <a href="../en/SysVinit.html" class="mw-redirect" title="Runlevels">runlevels</a>，用 root 登陆后执行 <i>e4rat-collect</i> 即可。</div>
<h3><span class="mw-headline" id="e4rat-preload">e4rat-preload</span></h3>
<p>永久性地，添加如下内容到<code>/boot/grub/grub.cfg</code>（grub）启动项的<code>linux</code>行末尾，或<code>/boot/grub/menu.lst</code>（grub2）启动项的<code>kernel</code>行：
</p>
<pre>init=/sbin/e4rat-preload
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 如果你正在使用grub2，内核参数最好添加到<code>/etc/default/grub</code> - <code>GRUB_CMDLINE_LINUX="..."</code>
</div>
<h3>
<span id=".E5.8F.A6.E4.B8.80.E9.80.89.E6.8B.A9.EF.BC.9Ae4rat-preload-lite"></span><span class="mw-headline" id="另一选择：e4rat-preload-lite">另一选择：e4rat-preload-lite</span>
</h3>
<p>论坛用户<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=117776&amp;p=1">jlindgren</a>提供了一个优化版本的preload程序，也许能帮你节约几秒的开机时间：
</p>
<p>优化之处在于：
</p>
<ul><li>启动<code>/sbin/init</code>前，只预读前100个文件（inode和文件内容），启动<code>/sbin/init</code>后再并行地预读其他文件。</li></ul>
<p>从<a href="../zh-CN/Arch_User_Repository.html" class="mw-redirect" title="AUR (简体中文)">AUR</a>中安装该工具（译者注，不要卸载e4rat，该包只提供preload）：<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/e4rat-preload-lite/">e4rat-preload-lite</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>
</p>
<p>添加（或替换）如下内容到<code>/boot/grub/grub.cfg</code>（grub）启动项的<code>linux</code>行末尾，或<code>/boot/grub/menu.lst</code>（grub2）启动项的<code>kernel</code>行：
</p>
<pre>init=/usr/sbin/e4rat-preload-lite
</pre>
<p>重启即可。
</p>
<h2>
<span id=".E5.85.B6.E4.BB.96_init_.E7.A8.8B.E5.BA.8F.E6.90.AD.E9.85.8D_e4rat"></span><span class="mw-headline" id="其他_init_程序搭配_e4rat">其他 init 程序搭配 e4rat</span>
</h2>
<p>e4rat-collect默认会使用<code>/sbin/init</code>替换自己。如果使用其他init程序（比如 <code>/bin/systemd</code>），修改<code>/etc/e4rat.conf</code>中的<code>init</code>参数，并去掉前面的分号（注释）即可。
</p>
<h2>
<span id=".E5.90.AF.E5.8A.A8.E6.B5.81.E7.A8.8B.E5.9B.BE"></span><span class="mw-headline" id="启动流程图">启动流程图</span>
</h2>
<p>通过<a href="../zh-CN/Bootchart.html" title="Bootchart (简体中文)">bootchart</a>绘制使用e4rat前后的启动流程图，可以直观地看到巨大的优化。
</p>
<h3><span class="mw-headline" id="bootchart_0.9-9">bootchart 0.9-9</span></h3>
<p>添加如下内容到<code>grub.cfg</code>或<code>menu.lst</code>的启动菜单项即可：
</p>
<pre>init=/sbin/bootchartd bootchart_init=/sbin/e4rat-preload
</pre>
<p>该版本bootchart会在<a href="../zh-CN/Display_manager.html" title="Display manager (简体中文)">登陆管理器</a>启动后停止监视。
</p>
<h3><span class="mw-headline" id="bootchart2">bootchart2</span></h3>
<p>添加如下内容到<code>grub.cfg</code>或<code>menu.lst</code>的启动菜单项：
</p>
<pre>init=/sbin/bootchartd
</pre>
<p>然后，手动修改<code>/sbin/bootchartd</code>的<code>init="/sbin/init"</code>这一行为<code>init="/sbin/e4rat-preload</code>。（译者注：虽然程序说明上说，应该通过添加启动参数设置init，但我试了，不行。）
</p>
<p><code>/etc/bootchartd.conf</code>的<code>EXIT_PROC</code>中可以设置哪些程序启动后停止监视：
</p>
<pre>EXIT_PROC="kdm_greet xterm konsole gnome-terminal metacity mutter compiz ldm icewm-session enlightenment"
</pre>
<p>留空的话，需要手动停止监视。
</p>
<h2>
<span id=".E7.96.91.E9.9A.BE.E8.A7.A3.E7.AD.94"></span><span class="mw-headline" id="疑难解答">疑难解答</span>
</h2>
<p>如果出现问题，请参考以下内容。
</p>
<h3>
<span id="startup.log_.E6.9C.AA.E5.88.9B.E5.BB.BA"></span><span class="mw-headline" id="startup.log_未创建">startup.log 未创建</span>
</h3>
<ul>
<li>在<code>/etc/rc.conf</code>注释掉<code>auditd</code>。</li>
<li>检查下列命令的输出：</li>
</ul>
<pre>dmesg | grep e4rat
</pre>
<ul><li>在<code>/etc/e4rat.conf</code>设置<code>loglevel</code>为<code>31</code>获取详细调试信息。</li></ul>
<h3>
<span id="e4rat_.E9.94.99.E8.AF.AF.E5.9C.B0.E6.8A.A5.E5.91.8A.E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F.E4.B8.BA_ext2"></span><span class="mw-headline" id="e4rat_错误地报告文件系统为_ext2">e4rat 错误地报告文件系统为 ext2</span>
</h3>
<ul><li>添加如下内容到<code>/boot/grub/grub.cfg</code>启动项的<code>linux</code>行末尾，或<code>/boot/grub/menu.lst</code>启动项的<code>kernel</code>行末尾：</li></ul>
<pre>rootfstype=ext4
</pre>
<h3>
<span id=".E6.97.A0.E6.B3.95.E8.AF.BB.E5.8F.96_startup.log"></span><span class="mw-headline" id="无法读取_startup.log">无法读取 startup.log</span>
</h3>
<ul><li>这说明你的<code>/var</code>和根目录不在同一分区，因而开机时为挂载。可以修改<code>startup.log</code>文件位置（比如{ic|/etc/startup.log}}），方法是修改<code>/etc/e4rat.conf</code>：</li></ul>
<pre>startup_log_file /etc/e4rat/startup.log
</pre>
<h3>
<span id=".E5.87.8F.E5.B0.91.E5.90.AF.E5.8A.A8.E6.97.B6.E7.9A.84.E4.BF.A1.E6.81.AF.E8.BE.93.E5.87.BA"></span><span class="mw-headline" id="减少启动时的信息输出">减少启动时的信息输出</span>
</h3>
<p>在 <code>/etc/e4rat.conf</code> 中将 <code>loglevel</code> 减小到 1。
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Boot_process.html" title="Category:Boot process (简体中文)">Boot process (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=E4rat_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=638365">https://wiki.archlinux.org/index.php?title=E4rat_(简体中文)&amp;oldid=638365</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 October 2020, at 07:10.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
