<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Tomcat (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Tomcat_简体中文 rootpage-Tomcat_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Tomcat (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Tomcat.html" title="Tomcat">Tomcat</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2017-11-30。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Tomcat&amp;diff=0&amp;oldid=498974">更改</a>，则您可以帮助同步翻译。</div>
<p>Tomcat 是一个由 Apache Software Foundation 开发的开源的 Java <a href="https://en.wikipedia.org/wiki/Java_Servlet#Servlet_containers" class="extiw" title="wikipedia:Java Servlet">Servlet 容器</a>。想要了解更多的配置信息，请参阅 <a href="../en/Tomcat_and_Apache.html" title="Tomcat and Apache">Tomcat and Apache</a> 。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 目前存在两个版本的稳定分支： <a rel="nofollow" class="external text" href="http://tomcat.apache.org/download-70.cgi">7</a> 和 <a rel="nofollow" class="external text" href="https://tomcat.apache.org/download-80.cgi">8</a>。没一个版本能完全替代另一个。相反，<a rel="nofollow" class="external text" href="http://tomcat.apache.org/whichversion.html#Apache_Tomcat_Versions">每个分支是一部分 "Servlet" 和 "JSP" Java 标准的实现</a>。两个版本都被 Arch Linux 官方支持：<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat7">tomcat7</a></span> 和 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat8">tomcat8</a></span>。选用哪个版本主要由你的 web 程序的需求来决定的。如果你只是为了试试 tomcat 或者你不打算花时间来区分，那么你选用 tomcat7 可能会更好点。这个页面针对的是 tomcat7 ，但是大部分内容也适用于 tomcat8。</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="tocnumber">1.1</span> <span class="toctext">文件系统层次结构</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">初始化配置</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#%E5%90%AF%E5%8A%A8/%E5%81%9C%E6%AD%A2_Tomcat"><span class="tocnumber">3</span> <span class="toctext">启动/停止 Tomcat</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#%E5%A4%87%E7%94%A8%E2%80%9C%E6%89%8B%E5%8A%A8%E2%80%9D%E6%96%B9%E6%B3%95"><span class="tocnumber">3.1</span> <span class="toctext">备用“手动”方法</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#%E9%83%A8%E7%BD%B2%E5%92%8C%E5%A4%84%E7%90%86_Web_%E7%A8%8B%E5%BA%8F"><span class="tocnumber">4</span> <span class="toctext">部署和处理 Web 程序</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#GUI_%E6%96%B9%E6%B3%95"><span class="tocnumber">4.1</span> <span class="toctext">GUI 方法</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#CLI_%E6%96%B9%E6%B3%95"><span class="tocnumber">4.2</span> <span class="toctext">CLI 方法</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%E6%8A%8A%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%88%AB%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="tocnumber">4.3</span> <span class="toctext">把项目部署在别的目录</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="tocnumber">5</span> <span class="toctext">日志记录</span></a></li>
<li class="toclevel-1 tocsection-11">
<a href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E8%AE%BE%E7%BD%AE"><span class="tocnumber">6</span> <span class="toctext">进一步设置</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#%E4%BB%8E%E4%BB%A5%E5%89%8D%E7%89%88%E6%9C%AC%E7%9A%84_Tomcat_%E4%B8%AD%E8%BF%81%E7%A7%BB"><span class="tocnumber">6.1</span> <span class="toctext">从以前版本的 Tomcat 中迁移</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84_JRE/JDK_%E6%9D%A5%E8%BF%90%E8%A1%8C_Tomcat"><span class="tocnumber">6.2</span> <span class="toctext">使用不同版本的 JRE/JDK 来运行 Tomcat</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="tocnumber">6.3</span> <span class="toctext">安全配置</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="tocnumber">7</span> <span class="toctext">故障排除</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Tomcat_%E6%9C%8D%E5%8A%A1%E5%B7%B2%E7%BB%8F%E5%90%AF%E5%8A%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2"><span class="tocnumber">7.1</span> <span class="toctext">Tomcat 服务已经启动，但是无法加载页面</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat7">tomcat7</a></span> 或者 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat8">tomcat8</a></span> 中的一个。
</p>
<p>如果打算部署 Tomcat 到一个生产环境，请考虑安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat-native">tomcat-native</a></span> 。Tomcat-native 将配置服务器来使用 Apache Portable Runtime (APR) 库的网络连接（socket）和 RNG 实现。它将使用原生的32位或64位代码来提升性能，对速度非常敏感的生产环境经常会用到。Tomcat 的安装不需要额外的配置。更多的信息请参阅 <a rel="nofollow" class="external text" href="http://tomcat.apache.org/native-doc/">Tomcat 官方文档</a> 。
</p>
<p>使用 tomcat-native 将会移除位于 <code>catalina.err</code> 的下列警告：
</p>
<pre>INFO: The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path [...]
</pre>
<h3>
<span id=".E6.96.87.E4.BB.B6.E7.B3.BB.E7.BB.9F.E5.B1.82.E6.AC.A1.E7.BB.93.E6.9E.84"></span><span class="mw-headline" id="文件系统层次结构">文件系统层次结构</span>
</h3>
<p>将 <code>*</code> 用你所安装的版本 (7 或者 8) 替代。
</p>
<table class="wikitable">
<tbody>
<tr>
<th>路径</th>
<th>用途
</th>
</tr>
<tr>
<td><code>/etc/tomcat*</code></td>
<td>配置文件。包括： <code>tomcat-users.xml</code> (defines users allowed to use administration tools and their roles), <code>server.xml</code> (Main Tomcat configuration file), <code>catalina.policy</code> (security policies configuration file)
</td>
</tr>
<tr>
<td><code>/usr/share/tomcat*</code></td>
<td>Tomcat 主文件夹。包括脚本文件及到其它文件夹的链接
</td>
</tr>
<tr>
<td><code>/usr/share/java/tomcat*</code></td>
<td>Tomcat 的 Java 库（jar文件）
</td>
</tr>
<tr>
<td><code>/var/log/tomcat*</code></td>
<td>
<b>不</b>被 <code>systemd</code> 记录的日志文件 (参阅 <a href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">#日志记录</a>)
</td>
</tr>
<tr>
<td><code>/var/lib/tomcat*/webapps</code></td>
<td>Tomcat 部署你的 Web 程序的地方
</td>
</tr>
<tr>
<td><code>/var/tmp/tomcat*</code></td>
<td>Tomcat 存储你的 Web 程序数据的地方
</td>
</tr>
</tbody>
</table>
<h2>
<span id=".E5.88.9D.E5.A7.8B.E5.8C.96.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="初始化配置">初始化配置</span>
</h2>
<p>你需要通过编辑下面这个文件来使用 manager 和 admin 管理界面：
<code>/etc/tomcat7/tomcat-users.xml</code>
</p>
<p>取消 XML 声明中"role and user"这一块的注释，然后根据你的需要，修改并启用 <code>tomcat</code>, {{Ic|admin-{gui,script} }} 和 {{Ic|manager-{gui,script,jmx,status} }} 等角色（详情请参阅 <a rel="nofollow" class="external text" href="http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Configuring_Manager_Application_Access">Configuring Manager Application Access</a>）。
</p>
<p>简单来说，<code>tomcat</code> 用于运行 Tomcat 服务器，<code>manager-*</code> 用于管理 Tomcat 服务器上的 web 程序，<code>admin-*</code> 是 Tomcat 服务器的全权管理员。
</p>
<p>下面是一个配置文件的样例，里面定义了一些包含用户名和密码的角色（请务必修改把 [CHANGE_ME] 改成更为更安全的密码）： 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/tomcat-users.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;tomcat-users&gt;
  &lt;role rolename="tomcat"/&gt;
  &lt;role rolename="manager-gui"/&gt;
  &lt;role rolename="manager-script"/&gt;
  &lt;role rolename="manager-jmx"/&gt;
  &lt;role rolename="manager-status"/&gt;
  &lt;role rolename="admin-gui"/&gt;
  &lt;role rolename="admin-script"/&gt;
  &lt;user username="tomcat" password="<b>[CHANGE_ME]</b>" roles="tomcat"/&gt;
  &lt;user username="manager" password="<b>[CHANGE_ME]</b>" roles="manager-gui,manager-script,manager-jmx,manager-status"/&gt;
  &lt;user username="admin" password="<b>[CHANGE_ME]</b>" roles="admin-gui"/&gt;
&lt;/tomcat-users&gt;</pre>
<p>请记住，每一次修改了这个文件都必须要重启 Tomcat 服务器。
</p>
<p><a rel="nofollow" class="external text" href="http://blog.techstacks.com/2010/07/new-manager-roles-in-tomcat-7-are-wonderful.html">这篇博文</a> 更好地介绍了这些角色。
</p>
<p>为了读取配置文件，以及为了和一些 IDE 更好地配合，你需要把你的用户加入 `tomcat7` (或者 `tomcat8`) 的组：
</p>
<pre> gpasswd -a &lt;user&gt; tomcat&lt;number&gt;
</pre>
<h2>
<span id=".E5.90.AF.E5.8A.A8.2F.E5.81.9C.E6.AD.A2_Tomcat"></span><span class="mw-headline" id="启动/停止_Tomcat">启动/停止 Tomcat</span>
</h2>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">启动</a> <code>tomcat7</code> 服务。
</p>
<p>一旦 Tomcat 启动了，你可以通过访问这个页面来查看结果：<a rel="nofollow" class="external text" href="http://localhost:8080">http://localhost:8080</a> 。如果显示了一个漂亮的 Tomcat 本地页面，表明你的 Servlet 容器正在运行，并且可以装载你的 web 程序了。如果启动脚本失败了，又或者你在浏览器里只看到了一个 Java 错误页面，你可以通过 <a href="../zh-CN/Systemd.html#%E6%97%A5%E5%BF%97" title="Systemd (简体中文)">systemd的 journalctl</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> 命令来查看启动日志。Google 上有 Tomcat 日志里常见问题的解决办法。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To improve security, Arch Linux's Tomcat packages use the <a rel="nofollow" class="external text" href="http://commons.apache.org/daemon/jsvc.html">jsvc</a> binary from Apache's <a rel="nofollow" class="external text" href="http://commons.apache.org/daemon/">common-daemons</a>. Tomcat's <code>systemd</code> service runs this Apache binary with root privileges which itself starts Tomcat with an underprivileged user (<code>tomcat7:tomcat7</code> in Arch Linux). This prevents malicious code that could be executed in a bad web application from causing too much damage. This also enables the use of ports under 1024 if needed. See <code>man jsvc</code> for options available and pass them through the <code>CATALINA_OPTS</code> environment variable declared in <code>/etc/conf.d/tomcat7</code>.</div>
<p><br>
</p>
<h3>
<span id=".E5.A4.87.E7.94.A8.E2.80.9C.E6.89.8B.E5.8A.A8.E2.80.9D.E6.96.B9.E6.B3.95"></span><span class="mw-headline" id="备用“手动”方法">备用“手动”方法</span>
</h3>
<p>Tomcat 也能通过上游脚本来直接控制：
</p>
<pre>/usr/share/tomcat/bin/{startup.sh,shutdown.sh,..}
</pre>
<p>这种方法对于调试程序甚至调试 Tomcat 非常有帮助。但不要在首次启动 Tomcat 的时候用这种方法，因为这会导致一些权限错误，从而使一些程序停止运行。为了使用这些脚本，可能需要做一些额外的配置。并且使用这些脚本将会阻止上面所提到的 jsvc 安全优势。
</p>
<h2>
<span id=".E9.83.A8.E7.BD.B2.E5.92.8C.E5.A4.84.E7.90.86_Web_.E7.A8.8B.E5.BA.8F"></span><span class="mw-headline" id="部署和处理_Web_程序">部署和处理 Web 程序</span>
</h2>
<p>Tomcat 7 捆绑了5个已经部署了的 Web 程序（有必要的话，把 localhost 换成你的服务器的全称域名）：
</p>
<ul>
<li>默认主页: <a rel="nofollow" class="external text" href="http://localhost:8080/">http://localhost:8080/</a>
</li>
<li>Tomcat 7 的本地文档: <a rel="nofollow" class="external text" href="http://localhost:8080/docs/">http://localhost:8080/docs/</a>
</li>
<li>Servlets 和 JSP 的示例: <a rel="nofollow" class="external text" href="http://localhost:8080/examples/">http://localhost:8080/examples/</a>
</li>
<li>用于处理虚拟主机的 host-manager: <a rel="nofollow" class="external text" href="http://localhost:8080/host-manager">http://localhost:8080/host-manager/</a>
</li>
<li>用于管理 web 程序的 manager: <a rel="nofollow" class="external text" href="http://localhost:8080/manager/html">http://localhost:8080/manager/html/</a>
</li>
</ul>
<h3>
<span id="GUI_.E6.96.B9.E6.B3.95"></span><span class="mw-headline" id="GUI_方法">GUI 方法</span>
</h3>
<p>最简单的方法是通过 manager 程序来部署 <a rel="nofollow" class="external text" href="http://localhost:8080/manager/html">http://localhost:8080/manager/html</a>。 使用你在 <code>tomcat-users.xml</code> 定义的 <code>manager</code> 角色的用户名和密码来登陆。登陆进去后，你将看到5个已经部署了的 Web 程序。通过 “Deploy” 区域来添加你自己的 Web 程序，通过 “Applications” 区域来停止/启动/取消部署。
</p>
<h3>
<span id="CLI_.E6.96.B9.E6.B3.95"></span><span class="mw-headline" id="CLI_方法">CLI 方法</span>
</h3>
<p>你也可以通过复制程序的 WAR 文件到 <code>/usr/share/tomcat7/webapps</code> 目录来部署。确保 <code>autoDeploy</code> 选项如下面所示，设置在了正确的主机：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/server.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;Host name="localhost"  appBase="webapps"
      unpackWARs="true" <b>autoDeploy="true"</b>&gt;
...</pre>
<h3>
<span id=".E6.8A.8A.E9.A1.B9.E7.9B.AE.E9.83.A8.E7.BD.B2.E5.9C.A8.E5.88.AB.E7.9A.84.E7.9B.AE.E5.BD.95"></span><span class="mw-headline" id="把项目部署在别的目录">把项目部署在别的目录</span>
</h3>
<p>你也可以通过设置 <code>Context</code> 来把你的项目部署在别的目录。
你需要在 <code>/etc/tomcat&lt;number&gt;/Catalina/localhost/</code> 目录下创建你的 context。Context 是一个用于指定 tomcat 查找目录的 xml 文件，其基本格式如下：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/Catalina/localhost/whatShouldFollowLocalhost.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;Context path="/whatSholdFollwLocalhost" docBase="/where/your/project/is/" reloadable="true"/&gt;</pre>
<p>假设项目放在用户 /home 目录下的某个文件夹里，则 context 像这样写：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/Catalina/localhost/myProject.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;Context path="/myProject" docBase="/home/archie/code/jsp/myProject" reloadable="true"/&gt;</pre>
<p>现在项目文件可以放在 <code>/home/archie/code/jsp/myProject/</code> 目录下了。要想在浏览器里查看这个项目，访问 <a rel="nofollow" class="external text" href="http://localhost:8080/myProject">http://localhost:8080/myProject</a> 。
如果 tomcat 无法加载这些文件，可能是遇到了权限问题，运行 <code>chmod o+x /home/archie/code/jsp/myProject</code> 应该可以解决这个问题。
</p>
<h2>
<span id=".E6.97.A5.E5.BF.97.E8.AE.B0.E5.BD.95"></span><span class="mw-headline" id="日志记录">日志记录</span>
</h2>
<p>如果使用的是 Arch Linux 官方的 Tomcat 包，则使用 <a href="../en/Systemd.html#Journal" title="Systemd">systemd的 journalctl</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> 来记录 <b>启动日志</b>。这意味着 <code>/var/log/tomcat7/catalina.err</code> 和 <code>/var/log/tomcat7/catalina.out</code> 将 <b>不会</b> 被使用。而其它的日志，例如作为 <code>Valve</code> 定义在 <code>/etc/tomcat7/server.xml</code> 里的 access logs 和 business logs 则默认会记录在 <code>/var/log/tomcat7/</code> 目录下。
</p>
<p>为了保存上游风格的日志，把 systemd 文件 <code>/lib/systemd/system/tomcat7.service</code> 复制到 <code>/etc/systemd/system/tomcat7.service</code> ，然后把两处 <code>SYSLOG</code> 改为日志文件的绝对路径。
</p>
<h2>
<span id=".E8.BF.9B.E4.B8.80.E6.AD.A5.E8.AE.BE.E7.BD.AE"></span><span class="mw-headline" id="进一步设置">进一步设置</span>
</h2>
<p>基本的配置，可以通过虚拟主机管理程序来设置：<a rel="nofollow" class="external free" href="http://localhost:8080/host-manager/html">http://localhost:8080/host-manager/html</a> 。使用你在 <code>tomcat-users.xml</code> 中设置的用户名和密码来登陆。其它选项可通过修改 <code>/etc/tomcat7</code> 下的配置文件来设置，最重要的莫过于 <code>server.xml</code>。对这些文件的修改已经超过了本入门页面的范围，请访问 <a rel="nofollow" class="external text" href="http://tomcat.apache.org/tomcat-7.0-doc/index.html">官方 Tomcat 7 文档</a> 来获得更多支持。
</p>
<h3>
<span id=".E4.BB.8E.E4.BB.A5.E5.89.8D.E7.89.88.E6.9C.AC.E7.9A.84_Tomcat_.E4.B8.AD.E8.BF.81.E7.A7.BB"></span><span class="mw-headline" id="从以前版本的_Tomcat_中迁移">从以前版本的 Tomcat 中迁移</span>
</h3>
<p>正如介绍里说的，“Tomcat 8 并不替代 Tomcat 7”。他们都是 Servlet/JSP 标准的实现。因此，你的程序使用了哪个版本的 Servlet/JSP 决定了你需要使用 <a rel="nofollow" class="external text" href="http://tomcat.apache.org/whichversion.html#Apache_Tomcat_Versions">哪个版本的</a> Tomcat 。如果你需要迁移，官方网站 <a rel="nofollow" class="external text" href="http://tomcat.apache.org/migration.html">会给你建议</a> 。
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E4.B8.8D.E5.90.8C.E7.89.88.E6.9C.AC.E7.9A.84_JRE.2FJDK_.E6.9D.A5.E8.BF.90.E8.A1.8C_Tomcat"></span><span class="mw-headline" id="使用不同版本的_JRE/JDK_来运行_Tomcat">使用不同版本的 JRE/JDK 来运行 Tomcat</span>
</h3>
<p>除了安装需要的 JRE/JDK 外，唯一要做的就是设置 Tomcat <code>systemd</code> service 文件的 TOMCAT_JAVA_HOME 变量。
</p>
<p>正如 <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">Systemd#Editing provided units</a> 里所说的，这个变量可以被用户配置覆盖：
</p>
<ol>
<li>创建 <i>/etc/systemd/system/tomcat7.service.d</i> 目录</li>
<li>在这个目录里，创建一个包含以下内容的 <i>start.conf</i> 文件（如果使用的是 Oracle JDK <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jdk/">jdk</a></span><sup><small>AUR</small></sup> ，则替换为<i>/usr/lib/jvm/java-8-jdk</i>）：</li>
</ol>
<pre>[Service]
Environment=TOMCAT_JAVA_HOME=/usr/lib/jvm/java-8-openjdk
</pre>
<p>另外，把 service 文件 <i>/usr/lib/systemd/system/tomcat7.service</i> ，复制到 <i>/etc/systemd/system/</i> ，并替换这一行
</p>
<pre>Environment=TOMCAT_JAVA_HOME=/usr/lib/jvm/java-7-openjdk
</pre>
<p>为 (以 Oracle JDK 为例)
</p>
<pre>Environment=TOMCAT_JAVA_HOME=/opt/java
</pre>
<h3>
<span id=".E5.AE.89.E5.85.A8.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="安全配置">安全配置</span>
</h3>
<p>本页面最低限度地使你的第一个 web 应用运行在 Tomcat 上，并不意味着这是一个管理 Tomcat （这是一项单独的工作）的明确的指导。Tomcat 官方网站提供了所有必须的官方事项。你也可以参考 <a rel="nofollow" class="external text" href="http://oreilly.com/java/archive/tomcat-tips.html">这个 O'Reilly 页面</a> 和 这个 <a rel="nofollow" class="external text" href="http://www.unidata.ucar.edu/projects/THREDDS/tech/reference/TomcatSecurity.html">页面</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-06 ⓘ]</sup> 。这里还是提供了一些安全方面的建议：
</p>
<ul>
<li>保持你的 Tomcat 更新到了最新版，以便获得安全问题的最新修复</li>
<li>移除不需要的默认程序，比如 <code>examples</code>，<code>docs</code>，默认的主页 <code>ROOT</code> ("_" 在 <code>manager</code> 程序里) 。这可以防止潜在的安全漏洞被利用。使用 <code>manager</code> 来管理。</li>
</ul>
<p>为了更安全，你甚至可以删除 host-manager 和 manager 应用。但是别忘了，后者对部署 web 应用非常有用。
</p>
<ul><li>关闭 WAR 自动部署选项。这可以防止某些获得限制权限的人复制 WAR 文件到 <code>/usr/share/java/webapps</code> 来直接运行它。编辑 <code>server.xml</code> 并把 <code>autoDeploy</code> 设为 <code>false</code>：</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/server.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
&lt;Host name="localhost"  appBase="webapps"
      unpackWARs="true" <b>autoDeploy="false"</b>&gt;
...</pre>
<ul><li>匿名化 Tomcat 的默认错误页面来防止潜在的攻击者取得 Tomcat 的版本。想知道 Tomcat 默认显示什么，只需要访问一个不存在的页面，比如 <a rel="nofollow" class="external text" href="http://localhost:8080/I_dont_exist">http://localhost:8080/I_dont_exist</a> ，你将会看到一个404错误页面，最底下标明了 Tomcat 的版本。</li></ul>
<p>要想匿名化这个，编辑或打开这个 JAR （像 <code>vim</code> 等编辑器能直接编辑 zip 文件）
</p>
<pre>/usr/share/tomcat7/lib/catalina.jar
</pre>
<p>然后编辑这个文件
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">org/apache/catalina/util/ServerInfo.properties</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
server.info=
server.number=
server.built=
...</pre>
<ul>
<li>禁用 <code>server.xml</code> 里不使用的 <code>connectors</code>
</li>
<li>保持对 <code>/etc/tomcat7/server.xml</code> 的访问限制。只有 <code>tomcat</code> 用户，和/或者 <code>root</code> 能读写这个文件</li>
<li>保持 <code>jsvc</code> 的使用。不要使用上游启动脚本，除非有上文安全部分提到的特别原因。</li>
<li>在 <code>tomcat-users.xml</code> 里为每个用户启用强壮并且不同的密码，给真正需要的用户角色，并且禁用你用不到的用户或者角色。</li>
</ul>
<p>你还可以用使用下列上游脚本来加密 <code>tomcat-users.xml</code> 里的密码：
</p>
<pre>/usr/share/tomcat7/bin/digest.sh -a SHA NEW_PASSWORD
</pre>
<p>这条命令将会输出类似于下面的信息：
</p>
<pre>NEW_PASSWORD:b7bbb48a5b7749f1f908eb3c0c021200c72738ce
</pre>
<p>然后用哈希的部分替换掉 <code>tomcat-users.xml</code> 里的密码部分，然后把下文加入到 <code>server.xml</code> 中：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/server.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;Host
  ...
  &lt;Realm
    ...
    <b>className="org.apache.catalina.realm.MemoryRealm" digest="SHA"</b>
    ...
  /&gt;
  ...
/&gt;</pre>
<p>注意，这个方法可能意义并不大。因为只有 root 和/或者 tomcat 能读写这个文件，而如果一个入侵者成功获得了 root 权限，那么他将不需要这些密码来混乱你的程序和数据。请确保对这个文件的读写限制！
</p>
<ul><li>永远弄清楚你在部署什么</li></ul>
<h2>
<span id=".E6.95.85.E9.9A.9C.E6.8E.92.E9.99.A4"></span><span class="mw-headline" id="故障排除">故障排除</span>
</h2>
<h3>
<span id="Tomcat_.E6.9C.8D.E5.8A.A1.E5.B7.B2.E7.BB.8F.E5.90.AF.E5.8A.A8.EF.BC.8C.E4.BD.86.E6.98.AF.E6.97.A0.E6.B3.95.E5.8A.A0.E8.BD.BD.E9.A1.B5.E9.9D.A2"></span><span class="mw-headline" id="Tomcat_服务已经启动，但是无法加载页面">Tomcat 服务已经启动，但是无法加载页面</span>
</h3>
<p>首先，检查 <code>/etc/tomcat7/tomcat-users.xml</code> 有没有语法错误。如果一切正常并且 <code>tomcat7</code> 正在运行，输入 <code>journalctl -r</code> 查看log，看看有没有抛出什么异常（参照 <a href="../en/Tomcat.html#Logging" title="Tomcat">Logging</a> ）。 
如果你看到有类似 <code>java.lang.Exception: Socket bind failed: [98] Address already in use</code> 的异常，说明其它服务正在监听这个端口。例如，有可能 <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache</a> 和 Tomcat 都在监听同一个端口（例如你在8080端口运行的 Apache 使用在80端口运行的<a href="../en/Nginx.html" title="Nginx">Nginx</a> 作为代理）。如果是这种情况，编辑 <code>/etc/tomcat7/server.xml</code> 文件，然后修改 <code>&lt;Service name="Catalina"&gt;</code> 下的 Connector port 为其它的值：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tomcat7/server.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;?xml version='1.0' encoding='utf-8'?&gt;
...
...
&lt;Service name="Catalina"&gt;
    &lt;Connector executor="tomcatThreadPool"
                 port="8090" protocol="HTTP/1.1"
                 connectionTimeout="20000"
                 redirectPort="8443" /&gt;
...
...
&lt;/Service&gt;</pre>
<p>最后 <a href="../zh-CN/Systemd.html#%E4%BD%BF%E7%94%A8%E5%8D%95%E5%85%83" title="Systemd (简体中文)">重启</a> <code>tomcat7</code> 和 <code>httpd</code> 服务。
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Web_server.html" title="Category:Web server (简体中文)">Web server (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Tomcat_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=630059">https://wiki.archlinux.org/index.php?title=Tomcat_(简体中文)&amp;oldid=630059</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 6 August 2020, at 11:09.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
