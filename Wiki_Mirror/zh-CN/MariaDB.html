<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>MariaDB (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-MariaDB_简体中文 rootpage-MariaDB_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">MariaDB (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../en/PhpMyAdmin.html" title="PhpMyAdmin">phpMyAdmin</a></li>
<li><a href="../en/Adminer.html" title="Adminer">Adminer</a></li>
<li><a href="../en/JDBC_and_MySQL.html" title="JDBC and MySQL">JDBC and MySQL</a></li>
<li><a href="../en/Open_Database_Connectivity.html" title="Open Database Connectivity">Open Database Connectivity</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/MySQL.html" title="MySQL">MySQL</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2016-06-07。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=MySQL&amp;diff=0&amp;oldid=435153">更改</a>，则您可以帮助同步翻译。</div>
<p>MySQL是一个可靠的、高性能的、功能全面的数据库，旨在为用户提供长期免费的、向下兼容的、可取代<a href="../en/MySQL.html" title="MySQL">MySQL</a>的数据库服务。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 自2013年起，MariaDB就被Arch Linux当作官方默认的MySQL实现<a rel="nofollow" class="external autonumber" href="https://archlinux.org/news/mariadb-replaces-mysql-in-repositories/">[1]</a>。Oracle MySQL 已被移动到 <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>，推荐所有用户<a href="#Upgrade_from_Oracle_MySQL_to_MariaDB">升级</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>到 MariaDB。参见<a rel="nofollow" class="external text" href="https://archlinux.org/news/mariadb-replaces-mysql-in-repositories/">这条公告</a>。</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E5%8D%87%E7%BA%A7"><span class="tocnumber">1.1</span> <span class="toctext">升级</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#%E7%94%B1_Oracle_MySQL_%E5%8D%87%E7%BA%A7%E5%88%B0_MariaDB"><span class="tocnumber">1.2</span> <span class="toctext">由 Oracle MySQL 升级到 MariaDB</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%94%A8%E6%88%B7"><span class="tocnumber">2.1</span> <span class="toctext">添加新用户</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2</span> <span class="toctext">配置文件</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#%E7%A6%81%E7%94%A8%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="tocnumber">2.3</span> <span class="toctext">禁用远程访问</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#%E5%90%AF%E7%94%A8%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="tocnumber">2.4</span> <span class="toctext">启用自动补全</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8_UTF-8_%E7%BC%96%E7%A0%81"><span class="tocnumber">2.5</span> <span class="toctext">为数据库使用 UTF-8 编码</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E4%BD%9C%E4%B8%BA%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E7%82%B9"><span class="tocnumber">2.6</span> <span class="toctext">使用内存作为临时文件存放点</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#%E5%A4%87%E4%BB%BD"><span class="tocnumber">3</span> <span class="toctext">备份</span></a></li>
<li class="toclevel-1 tocsection-12">
<a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="tocnumber">4</span> <span class="toctext">故障排除</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#MySQL_%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8"><span class="tocnumber">4.1</span> <span class="toctext">MySQL 守护进程无法启动</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E6%89%A7%E8%A1%8C_mysql_upgrade_%E5%90%8E_MySQL_%E4%B8%8D%E8%83%BD%E5%90%AF%E5%8A%A8"><span class="tocnumber">4.2</span> <span class="toctext">执行 mysql_upgrade 后 MySQL 不能启动</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%E9%87%8D%E7%BD%AE_root_%E5%AF%86%E7%A0%81"><span class="tocnumber">4.3</span> <span class="toctext">重置 root 密码</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#%E6%A3%80%E6%9F%A5%E5%B9%B6%E4%BF%AE%E5%A4%8D%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="tocnumber">4.4</span> <span class="toctext">检查并修复所有数据表</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#%E4%BC%98%E5%8C%96%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="tocnumber">4.5</span> <span class="toctext">优化所有数据表</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#OS_error_22_when_running_on_ZFS"><span class="tocnumber">4.6</span> <span class="toctext">OS error 22 when running on ZFS</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%99%BB%E9%99%86,_%E4%BD%86%E6%98%AF_phpmyadmin_%E6%AD%A3%E5%B8%B8%E5%B7%A5%E4%BD%9C"><span class="tocnumber">4.7</span> <span class="toctext">无法通过命令行登陆, 但是 phpmyadmin 正常工作</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#MySQL_%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A8%E5%A4%AA%E5%A4%9A%E7%A9%BA%E9%97%B4"><span class="tocnumber">4.8</span> <span class="toctext">MySQL 日志文件占用太多空间</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#%E6%9B%B4%E5%A4%9A%E8%B5%84%E6%BA%90"><span class="tocnumber">5</span> <span class="toctext">更多资源</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>Archlinux 选择的 MySQL <a rel="nofollow" class="external text" href="https://archlinux.org/news/mariadb-replaces-mysql-in-repositories/">默认实现</a> 被称为 <a rel="nofollow" class="external text" href="https://mariadb.com/">MariaDB</a>。
</p>
<p><a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb">mariadb</a></span>、<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb-libs">mariadb-libs</a></span>。
</p>
<p>其它实现有 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=percona-server">percona-server</a></span> 和 Oracle <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mysql/">mysql</a></span><sup><small>AUR</small></sup>。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>如果数据库 (位于 <code>/var/lib/mysql</code>) 运行在 <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> 分区之上, 你应当在创建数据库之前禁用 <a href="../en/Btrfs.html#Copy-on-Write_(CoW)" title="Btrfs">Copy-on-Write</a> 特性。</li>
<li>如果数据库运行在 <a href="../en/ZFS.html" title="ZFS">ZFS</a> 分区之上, 你应该在创建数据库之前参阅 <a href="../en/ZFS.html#Databases" title="ZFS">ZFS#Databases</a> 。</li>
</ul>
</div>
<p>安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb">mariadb</a></span> 软件包之后，你必须在启动 <code>mariadb.service</code> <b>之前</b>运行下面这条命令：
</p>
<pre># mariadb-install-db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 出于安全考虑，systemd 的 .service 文件设置了 <code>ProtectHome=true</code> 来禁止 MariaDB 访问 <code>/home</code>、<code>/root</code> 和 <code>/run/user</code> 目录内的文件。<code>datadir</code> 必须要放在以上文件夹之外，并且由 <code>mysql</code> 用户和用户组 <a href="../en/File_permissions_and_attributes.html#Changing_ownership" class="mw-redirect" title="Chown">所有</a>。
如果要改变这个设置，你可以根据以下链接创建一个替代的 service 文件：<a rel="nofollow" class="external autonumber" href="https://mariadb.com/kb/en/mariadb/systemd/">[2]</a>
</div>
<p>然后 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> 或者 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>mariadb.service</code>。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 如果数据目录使用的不是 <code>/var/lib/mysql</code>，需要在 <code>/etc/my.cnf.d/server.cnf</code> 文件的 <code>[mysqld]</code> 部分设置 <code>datadir=&lt;数据目录&gt;</code>
</div>
<p>用下面这个命令启动数据库级别的安全配置助手，来配置一些必要的安全选项：
</p>
<pre># mysql_secure_installation
</pre>
<p><br>
为了简化管理过程，可用的管理前端有 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbeaver">dbeaver</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mysql-workbench">mysql-workbench</a></span>, <a href="../en/Adminer.html" title="Adminer">Adminer</a> 或 <a href="../en/PhpMyAdmin.html" title="PhpMyAdmin">phpMyAdmin</a>. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mysql-workbench">mysql-workbench</a></span> 和 MariaDB 并不完全兼容，但是可以执行基本任务。
</p>
<h3>
<span id=".E5.8D.87.E7.BA.A7"></span><span class="mw-headline" id="升级">升级</span>
</h3>
<p>升级了 MySQL 并启动之后，要运行这条命令：
</p>
<pre># mysql_upgrade -u root -p
</pre>
<h3>
<span id=".E7.94.B1_Oracle_MySQL_.E5.8D.87.E7.BA.A7.E5.88.B0_MariaDB"></span><span class="mw-headline" id="由_Oracle_MySQL_升级到_MariaDB">由 Oracle MySQL 升级到 MariaDB</span>
</h3>
<p>想要切换的用户需要安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb">mariadb</a></span> 和 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb-clients">mariadb-clients</a></span>，然后执行 <code>mysql_upgrade</code> 来迁移系统：
</p>
<pre># systemctl stop mysqld
# pacman -S mariadb libmariadbclient mariadb-clients
# systemctl start mysqld
# mysql_upgrade -p
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 在重新启动守护进程前，请先删除 <code>/var/lib/mysql</code> 中的 <code>ib_logfile0</code>, <code>ib_logfile1</code> 以及 <code>aria_log_control</code>。</div>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p>一旦你启动了MySQL服务器，你最好增加一个root账号来维护你的MySQL用户和数据库。如上面的初始化脚本输出的信息里所述，有手动或自动完成两种方法 ── 可以运行命令来设置root账号的密码，或者运行安全安装脚本。
</p>
<p>现在可以使用你偏好的交互方式来进行进一步配置。例如可以用MySQL的命令行工具，以root账号登录你的MySQL服务器：
</p>
<pre>$ mysql -p -u root
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 默认密码为空，直接敲回车键登录</div>
<h3>
<span id=".E6.B7.BB.E5.8A.A0.E6.96.B0.E7.94.A8.E6.88.B7"></span><span class="mw-headline" id="添加新用户">添加新用户</span>
</h3>
<p>以下是创建一个密码为'some_pass'的'monty'用户的示例,并赋予 mydb 完全操作权限：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ mysql -u root -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MariaDB&gt; CREATE USER 'monty'@'localhost' IDENTIFIED BY 'some_pass';
MariaDB&gt; GRANT ALL PRIVILEGES ON mydb.* TO 'monty'@'localhost';
MariaDB&gt; FLUSH PRIVILEGES;
MariaDB&gt; quit</pre>
<h3>
<span id=".E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="配置文件">配置文件</span>
</h3>
<p><i>MariaDB</i> 会按照以下顺序读取配置文件 (根据 <code>mysqld --help --verbose </code> 的输出):
</p>
<pre>/etc/my.cnf /etc/my.cnf.d/ ~/.my.cnf
</pre>
<p>请根据你需要的配置作用范围(对系统, 对用户...)来修改对应的配置文件。 点击 <a rel="nofollow" class="external text" href="https://mariadb.com/kb/en/mariadb/documentation/getting-started/starting-and-stopping-mariadb/mysqld-configuration-files-and-groups/">这里</a> 了解更多信息。
</p>
<h3>
<span id=".E7.A6.81.E7.94.A8.E8.BF.9C.E7.A8.8B.E8.AE.BF.E9.97.AE"></span><span class="mw-headline" id="禁用远程访问">禁用远程访问</span>
</h3>
<p>MySQL 服务器默认可从网络访问。如果只有本机需要 MySQL，可以通过不监听 TCP 端口 3306 来增强安全性。要拒绝远程连接，取消注释 <code>/etc/mysql/my.cnf</code> 中以下这行：
</p>
<pre>skip-networking
</pre>
<p>你仍能从本机登录。
</p>
<h3>
<span id=".E5.90.AF.E7.94.A8.E8.87.AA.E5.8A.A8.E8.A1.A5.E5.85.A8"></span><span class="mw-headline" id="启用自动补全">启用自动补全</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 启用这项功能会增加客户端启动时间。</div>
<p>MySQL 默认禁用客户端自动补全功能。要在整个系统中启用它，编辑 <code>/etc/my.cnf.d/mysql-clients.cnf</code>，在<code>mysql</code>下 添加 <code>auto-rehash</code>。注意：不要将<code>auto-rehash</code>写在<code>mysqld</code>下，下次客户端启动时就会启用自动补全。
</p>
<h3>
<span id=".E4.B8.BA.E6.95.B0.E6.8D.AE.E5.BA.93.E4.BD.BF.E7.94.A8_UTF-8_.E7.BC.96.E7.A0.81"></span><span class="mw-headline" id="为数据库使用_UTF-8_编码">为数据库使用 UTF-8 编码</span>
</h3>
<p>在 <code>/etc/mysql/my.cnf</code> 的 <code>mysqld</code> 下, 添加:
</p>
<pre>[mysqld]
init_connect                = 'SET collation_connection = utf8_general_ci,NAMES utf8'
collation_server            = utf8_general_ci
character_set_client        = utf8
character_set_server        = utf8
</pre>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E5.86.85.E5.AD.98.E4.BD.9C.E4.B8.BA.E4.B8.B4.E6.97.B6.E6.96.87.E4.BB.B6.E5.AD.98.E6.94.BE.E7.82.B9"></span><span class="mw-headline" id="使用内存作为临时文件存放点">使用内存作为临时文件存放点</span>
</h3>
<p>MySQL 存储临时文件的目录名是 <i>tmpdir</i>。
</p>
<p>创建一个临时目录:
</p>
<pre># mkdir -pv /var/lib/mysqltmp
# chown mysql:mysql /var/lib/mysqltmp
</pre>
<p>通过命令找出 <code>mysql</code> 的id和gid:
</p>
<pre>$ id mysql
uid=27(mysql) gid=27(mysql) groups=27(mysql)
</pre>
<p>添加到 <code>/etc/fstab</code> 中。
</p>
<pre> tmpfs   /var/lib/mysqltmp   tmpfs   rw,gid=27,uid=27,size=100M,mode=0750,noatime   0 0
</pre>
<p>将以下配置添加到 <code>/etc/mysql/my.cnf</code> 的 <code>mysqld</code> 组下:
</p>
<pre> tmpdir      = /var/lib/mysqltmp
</pre>
<p>然后重启系统以使配置生效。
</p>
<h2>
<span id=".E5.A4.87.E4.BB.BD"></span><span class="mw-headline" id="备份">备份</span>
</h2>
<p>数据库可以转储到文件以简化备份。以下 shell 脚本会替你在脚本所在目录创建一个 <code>db_backup.gz</code> 文件，包含数据库的转储：
</p>
<pre>#!/bin/bash

THISDIR=$(dirname $(readlink -f "$0"))

mysqldump --single-transaction --flush-logs --master-data=2 --all-databases \
 | gzip &gt; $THISDIR/db_backup.gz
echo 'purge master logs before date_sub(now(), interval 7 day);' | mysql</pre>
<p>参见 MySQL 手册的官方 <code>mysqldump</code> <a rel="nofollow" class="external text" href="https://dev.mysql.com/doc/refman/5.6/en/mysqldump.html">页面</a>。
</p>
<h2>
<span id=".E6.95.85.E9.9A.9C.E6.8E.92.E9.99.A4"></span><span class="mw-headline" id="故障排除">故障排除</span>
</h2>
<h3>
<span id="MySQL_.E5.AE.88.E6.8A.A4.E8.BF.9B.E7.A8.8B.E6.97.A0.E6.B3.95.E5.90.AF.E5.8A.A8"></span><span class="mw-headline" id="MySQL_守护进程无法启动">MySQL 守护进程无法启动</span>
</h3>
<p>如果 MySQL 无法启动且日志文件中没有任何信息，你可能需要检查 <code>/var/lib/mysql</code> 和 <code>/var/lib/mysql/mysql</code> 目录中文件的权限。如果这些目录中文件的所有者不是 <code>mysql:mysql</code>，你应该这样做：
</p>
<pre># chown mysql:mysql /var/lib/mysql -R
</pre>
<p>如果你仍旧碰到了权限问题，确保已把 <code>my.cnf</code> 拷贝到 <code>/etc/</code> 目录：
</p>
<pre># cp /etc/mysql/my.cnf /etc/my.cnf
</pre>
<p>然后尝试重新启动守护进程。
</p>
<p>如果文件 <code>/var/lib/mysql/hostname.err</code> 中有如下错误：
</p>
<pre>[ERROR] Can't start server : Bind on unix socket: Permission denied
[ERROR] Do you already have another mysqld server running on socket: /var/run/mysqld/mysqld.sock ?
[ERROR] Aborting
</pre>
<p><code>/var/run/mysqld</code> 的权限可能是罪魁祸首：
</p>
<pre># chown mysql:mysql /var/run/mysqld -R
</pre>
<p>如果运行 mysqld 时出现了如下错误：
</p>
<pre>Fatal error: Can’t open and lock privilege tables: Table ‘mysql.host’ doesn’t exist
</pre>
<p>在 <code>/usr</code> 目录中运行下列命令来安装默认的表：
</p>
<pre># cd /usr
# mysql_install_db --user=mysql --ldata=/var/lib/mysql/
</pre>
<h3>
<span id=".E6.89.A7.E8.A1.8C_mysql_upgrade_.E5.90.8E_MySQL_.E4.B8.8D.E8.83.BD.E5.90.AF.E5.8A.A8"></span><span class="mw-headline" id="执行_mysql_upgrade_后_MySQL_不能启动">执行 mysql_upgrade 后 MySQL 不能启动</span>
</h3>
<p>试试安全模式下运行的 MySQL：
</p>
<pre># mysqld_safe --datadir=/var/lib/mysql/
</pre>
<p>然后再运行:
</p>
<pre># mysql_upgrade -u root -p
</pre>
<h3>
<span id=".E9.87.8D.E7.BD.AE_root_.E5.AF.86.E7.A0.81"></span><span class="mw-headline" id="重置_root_密码">重置 root 密码</span>
</h3>
<p>从 MariaDB 10.4 之后，<code>mysql.global_priv</code> 取代了原来的 <code>mysql.user</code>，所以更改用户密码的操作需要改变
</p>
<p>停止 <i>mysqld</i> <a href="../en/Daemons.html" class="mw-redirect" title="Daemon">守护进程</a>，再执行以下命令：
</p>
<pre># mysqld_safe --skip-grant-tables &amp;
</pre>
<p>连接到 MySQL 服务器，执行以下命令：
</p>
<pre># mysql -u root mysql
</pre>
<p>修改 root 密码：
</p>
<pre>mysql&gt; set password for 'root'@'localhost' = password('MyNewPass');
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; exit
</pre>
<p>再启动 <i>mysqld</i> 守护进程。
</p>
<h3>
<span id=".E6.A3.80.E6.9F.A5.E5.B9.B6.E4.BF.AE.E5.A4.8D.E6.89.80.E6.9C.89.E6.95.B0.E6.8D.AE.E8.A1.A8"></span><span class="mw-headline" id="检查并修复所有数据表">检查并修复所有数据表</span>
</h3>
<p>检查并自动修复所有数据库中的所有表，<a rel="nofollow" class="external text" href="https://dev.mysql.com/doc/refman/5.7/en/mysqlcheck.html">查看更多</a>
</p>
<pre># mysqlcheck -A --auto-repair -u root -p
</pre>
<h3>
<span id=".E4.BC.98.E5.8C.96.E6.89.80.E6.9C.89.E6.95.B0.E6.8D.AE.E8.A1.A8"></span><span class="mw-headline" id="优化所有数据表">优化所有数据表</span>
</h3>
<p>强制优化所有数据表，自动修复可能出现的数据表错误
</p>
<pre># mysqlcheck -A --auto-repair -f -o -u root -p
</pre>
<h3><span class="mw-headline" id="OS_error_22_when_running_on_ZFS">OS error 22 when running on ZFS</span></h3>
<p>如果您正在使用 <a href="../en/ZFS.html" title="ZFS">ZFS</a> 并且遇见了如下错误
</p>
<pre>InnoDB: Operating system error number 22 in a file operation.
</pre>
<p>那么就需要修改 <code>/etc/mysql/my.cnf</code> 中的设置来禁用 aio_writes
</p>
<pre>[mysqld]
...
innodb_use_native_aio = 0
</pre>
<p>但如果后续的安装脚本因为上述问题出错，那么 MySQL/MariaDB 可能会处于非法的状态中。可以执行以下命令从非法状态中恢复：
</p>
<pre>rm -rf /var/lib/mysql/*
mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
chown -R mysql:mysql /var/lib/mysql &amp;&gt;/dev/null
/usr/bin/systemd-tmpfiles --create mysql.conf
</pre>
<p>以上命令全部执行后，MySQL/MariaDB 应该就能正确安装了。
</p>
<h3>
<span id=".E6.97.A0.E6.B3.95.E9.80.9A.E8.BF.87.E5.91.BD.E4.BB.A4.E8.A1.8C.E7.99.BB.E9.99.86.2C_.E4.BD.86.E6.98.AF_phpmyadmin_.E6.AD.A3.E5.B8.B8.E5.B7.A5.E4.BD.9C"></span><span class="mw-headline" id="无法通过命令行登陆,_但是_phpmyadmin_正常工作">无法通过命令行登陆, 但是 phpmyadmin 正常工作</span>
</h3>
<p>当使用了超长 (&gt;70-75) 的密码后，这个问题有可能发生。
由于某些因素，5.5.36 版本的 mysql 的命令行不能在 readline 模式中处理那么多的字符。
所以如果打算使用推荐的密码输入方式：
</p>
<pre>$ mysql -u &lt;user&gt; -p
Password:
</pre>
<p>不妨考虑更换一个长度短一点的密码。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 您依然可以通过在命令行参数中指定密码来登陆
<pre>$ mysql -u &lt;user&gt; -p"&lt;some-veryveryveryveryveryveryveryveryveryveryveryveryveryveryvery-long-and-veryveryveryveryveryveryveryveryveryvery-strong-password&gt;"
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 但这样做很危险，因为您的密码很可能会泄漏到某个地方，例如，日志。只有当遇到紧急情况才能考虑这么做，并且事后不要忘记更改密码。</div>
</div>
<h3>
<span id="MySQL_.E6.97.A5.E5.BF.97.E6.96.87.E4.BB.B6.E5.8D.A0.E7.94.A8.E5.A4.AA.E5.A4.9A.E7.A9.BA.E9.97.B4"></span><span class="mw-headline" id="MySQL_日志文件占用太多空间">MySQL 日志文件占用太多空间</span>
</h3>
<p>默认情况下， mysqld 会在 <code>/var/lib/mysql</code> 下创建二进制日志文件。这在某些场景下是很有用的。但是这些日志文件也可能耗光您的硬盘空间。如果需要，您可以在 <code>/etc/mysql/my.cnf</code> 中注释掉以下两行来禁用日志：
</p>
<pre>#log-bin=mysql-bin
#binlog_format=mixed
</pre>
<p>或者限制 logfile 的大小：
</p>
<pre>expire_logs_days = 10
max_binlog_size  = 100M
</pre>
<p>另外，您也可以执行以下命令来清除 <code>/var/lib/mysql</code> 里的一些日志文件来释放硬盘空间：
</p>
<pre>#mysql -u root -p"PASSWORD" -e "PURGE BINARY LOGS TO 'mysql-bin.0000xx';"
</pre>
<h2>
<span id=".E6.9B.B4.E5.A4.9A.E8.B5.84.E6.BA.90"></span><span class="mw-headline" id="更多资源">更多资源</span>
</h2>
<ul>
<li>
<a href="../zh-CN/Category:Web_applications.html" class="mw-redirect" title="LAMP (简体中文)">LAMP (简体中文)</a> - Arch wiki 文章，涵盖安装 LAMP 服务器 (Linux Apache MySQL PHP)</li>
<li>
<a rel="nofollow" class="external free" href="https://mariadb.org/">https://mariadb.org/</a> - Community-driven 实现</li>
<li>
<a rel="nofollow" class="external free" href="https://www.mysql.com/">https://www.mysql.com/</a> - Oracle 实现</li>
<li>
<a rel="nofollow" class="external free" href="http://www.percona.com/software">http://www.percona.com/software</a> - Percona 实现</li>
<li><a rel="nofollow" class="external text" href="https://mariadb.com/kb/en/">MariaDB knowledge Base</a></li>
<li><a rel="nofollow" class="external text" href="https://dev.mysql.com/doc/">MySQL documentation </a></li>
<li>
<a href="../en/PHP.html" title="PHP">PHP</a> - ArchWiki article on PHP.</li>
<li><a rel="nofollow" class="external text" href="http://www.askapache.com/mysql/performance-tuning-mysql.html">MySQL Performance Tuning Scripts and Know-How</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Database_management_systems.html" title="Category:Database management systems (简体中文)">Database management systems (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=MariaDB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=661865">https://wiki.archlinux.org/index.php?title=MariaDB_(简体中文)&amp;oldid=661865</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 April 2021, at 14:29.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
