<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>CMake package guidelines (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-CMake_package_guidelines_简体中文 rootpage-CMake_package_guidelines_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">CMake package guidelines (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/CMake_package_guidelines.html" title="CMake package guidelines">CMake package guidelines</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2020-07-19。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=CMake_package_guidelines&amp;diff=0&amp;oldid=625876">更改</a>，则您可以帮助同步翻译。</div>
<div class="toc" style="display:block; text-align: center; margin-bottom: 1em;">
<b><a href="../en/Arch_package_guidelines.html" title="Arch package guidelines">Arch 软件包准则</a></b>
<hr>
<p><a href="../zh-CN/32-bit_package_guidelines.html" title="32-bit package guidelines (简体中文)">32-bit</a> – <a href="../zh-CN/CLR_package_guidelines.html" title="CLR package guidelines (简体中文)">CLR</a> – <a class="mw-selflink selflink">CMake</a> – <a href="/index.php?title=Cross-compiling_tools_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Cross-compiling tools package guidelines (简体中文) (page does not exist)">Cross</a> – <a href="/index.php?title=DKMS_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="DKMS package guidelines (简体中文) (page does not exist)">DKMS</a> – <a href="../zh-CN/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines (简体中文)">Eclipse</a> – <a href="/index.php?title=Electron_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Electron package guidelines (简体中文) (page does not exist)">Electron</a> – <a href="/index.php?title=Font_packaging_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Font packaging guidelines (简体中文) (page does not exist)">Font</a> – <a href="../zh-CN/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines (简体中文)">Free Pascal</a> – <a href="/index.php?title=GNOME_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="GNOME package guidelines (简体中文) (page does not exist)">GNOME</a> – <a href="../zh-CN/Go_package_guidelines.html" title="Go package guidelines (简体中文)">Go</a> – <a href="../zh-CN/Haskell_package_guidelines.html" title="Haskell package guidelines (简体中文)">Haskell</a> – <a href="../zh-CN/Java_package_guidelines.html" title="Java package guidelines (简体中文)">Java</a> – <a href="/index.php?title=KDE_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="KDE package guidelines (简体中文) (page does not exist)">KDE</a> – <a href="../zh-CN/Kernel_module_package_guidelines.html" title="Kernel module package guidelines (简体中文)">Kernel</a> – <a href="/index.php?title=Lisp_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Lisp package guidelines (简体中文) (page does not exist)">Lisp</a> – <a href="/index.php?title=Meson_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Meson package guidelines (简体中文) (page does not exist)">Meson</a> – <a href="/index.php?title=MinGW_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="MinGW package guidelines (简体中文) (page does not exist)">MinGW</a> – <a href="/index.php?title=Node.js_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Node.js package guidelines (简体中文) (page does not exist)">Node.js</a> – <a href="/index.php?title=Nonfree_applications_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Nonfree applications package guidelines (简体中文) (page does not exist)">Nonfree</a> – <a href="/index.php?title=OCaml_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="OCaml package guidelines (简体中文) (page does not exist)">OCaml</a> – <a href="/index.php?title=Perl_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Perl package guidelines (简体中文) (page does not exist)">Perl</a> – <a href="../zh-CN/PHP_package_guidelines.html" title="PHP package guidelines (简体中文)">PHP</a> – <a href="../zh-CN/Python_package_guidelines.html" title="Python package guidelines (简体中文)">Python</a> – <a href="/index.php?title=R_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="R package guidelines (简体中文) (page does not exist)">R</a> – <a href="/index.php?title=Ruby_Gem_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Ruby Gem package guidelines (简体中文) (page does not exist)">Ruby</a> – <a href="/index.php?title=Rust_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Rust package guidelines (简体中文) (page does not exist)">Rust</a> – <a href="../zh-CN/VCS_package_guidelines.html" title="VCS package guidelines (简体中文)">VCS</a> – <a href="/index.php?title=Web_application_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Web application package guidelines (简体中文) (page does not exist)">Web</a> – <a href="/index.php?title=Wine_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;action=edit&amp;redlink=1" class="new" title="Wine package guidelines (简体中文) (page does not exist)">Wine</a>
</p>
</div>
<p>本文档涵盖为使用 <a rel="nofollow" class="external text" href="https://cmake.org/">CMake</a> 的软件编写 <a href="../zh-CN/PKGBUILD.html" title="PKGBUILD (简体中文)">PKGBUILD</a> 的标准和准则。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E7%AE%80%E4%BB%8B"><span class="tocnumber">1</span> <span class="toctext">简介</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95"><span class="tocnumber">1.1</span> <span class="toctext">典型用法</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3">
<a href="#CMake_%E7%9A%84%E4%B8%8D%E8%89%AF%E8%A1%8C%E4%B8%BA"><span class="tocnumber">2</span> <span class="toctext">CMake 的不良行为</span></a>
<ul>
<li class="toclevel-2 tocsection-4">
<a href="#CMake_%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E7%9A%84%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96%E6%A0%87%E5%BF%97"><span class="tocnumber">2.1</span> <span class="toctext">CMake 可以自动覆盖默认的编译器优化标志</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#%E5%85%B3%E4%BA%8E_-O3_%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="tocnumber">2.1.1</span> <span class="toctext">关于 -O3 的注意事项</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#%E4%BF%AE%E5%A4%8D%E8%87%AA%E5%8A%A8%E4%BC%98%E5%8C%96%E6%A0%87%E5%BF%97%E8%A6%86%E7%9B%96"><span class="tocnumber">2.1.2</span> <span class="toctext">修复自动优化标志覆盖</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#%E9%AA%8C%E8%AF%81%E4%BF%AE%E5%A4%8D"><span class="tocnumber">2.2</span> <span class="toctext">验证修复</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#%E5%89%8D%E7%BC%80%E5%92%8C%E5%BA%93%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95"><span class="tocnumber">3</span> <span class="toctext">前缀和库安装目录</span></a></li>
<li class="toclevel-1 tocsection-9">
<a href="#%E6%8F%90%E7%A4%BA%E5%92%8C%E6%8A%80%E5%B7%A7"><span class="tocnumber">4</span> <span class="toctext">提示和技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95"><span class="tocnumber">4.1</span> <span class="toctext">指定目录</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E5%87%8F%E5%B0%91%E5%8F%AF%E8%83%BD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E8%BE%93%E5%87%BA"><span class="tocnumber">4.2</span> <span class="toctext">减少可能不需要的输出</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%E4%BB%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E4%B8%AD%E5%88%A0%E9%99%A4%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84_RPATH_%E5%BC%95%E7%94%A8"><span class="tocnumber">4.3</span> <span class="toctext">从二进制文件中删除不安全的 RPATH 引用</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%8F%AF%E7%94%A8%E7%9A%84_CMake_%E9%80%89%E9%A1%B9"><span class="tocnumber">4.4</span> <span class="toctext">获取所有可用的 CMake 选项</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#%E6%A8%A1%E6%9D%BF"><span class="tocnumber">5</span> <span class="toctext">模板</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#%E8%8C%83%E4%BE%8B%E5%8C%85"><span class="tocnumber">6</span> <span class="toctext">范例包</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#%E5%8F%A6%E8%AF%B7%E5%8F%82%E8%A7%81"><span class="tocnumber">7</span> <span class="toctext">另请参见</span></a></li>
</ul>
</div>

<h2>
<span id=".E7.AE.80.E4.BB.8B"></span><span class="mw-headline" id="简介">简介</span>
</h2>
<p>从 <a rel="nofollow" class="external text" href="https://cmake.org">CMake 网站</a>：
</p>
<dl><dd>CMake is an open-source, cross-platform family of tools designed to build, test and package software. CMake is used to control the software compilation process using simple platform and compiler independent configuration files, and generate native makefiles and workspaces that can be used in the compiler environment of your choice.</dd></dl>
<h3>
<span id=".E5.85.B8.E5.9E.8B.E7.94.A8.E6.B3.95"></span><span class="mw-headline" id="典型用法">典型用法</span>
</h3>
<p>典型用法是运行 <code>cmake</code> 命令，然后执行构建命令。该 <code>cmake</code> 命令通常会设置一些参数，检查所需的依赖关系并创建构建文件，从而使该软件可以通过诸如 <code>make</code> 和 <code>ninja</code> 的其他工具进行构建。
</p>
<h2>
<span id="CMake_.E7.9A.84.E4.B8.8D.E8.89.AF.E8.A1.8C.E4.B8.BA"></span><span class="mw-headline" id="CMake_的不良行为">CMake 的不良行为</span>
</h2>
<p>由于其自身的生成生成文件的内部特性，有时 CMake 可能会以不良方式运行。这样，在为基于 CMake 的软件编写 <a href="../zh-CN/PKGBUILD.html" title="PKGBUILD (简体中文)">PKGBUILD</a> 时，应注意一些步骤。
</p>
<h3>
<span id="CMake_.E5.8F.AF.E4.BB.A5.E8.87.AA.E5.8A.A8.E8.A6.86.E7.9B.96.E9.BB.98.E8.AE.A4.E7.9A.84.E7.BC.96.E8.AF.91.E5.99.A8.E4.BC.98.E5.8C.96.E6.A0.87.E5.BF.97"></span><span class="mw-headline" id="CMake_可以自动覆盖默认的编译器优化标志">CMake 可以自动覆盖默认的编译器优化标志</span>
</h3>
<p>使用 <code>-DCMAKE_BUILD_TYPE=Release</code> 选项运行 CMake 是很常见的。一些上游项目甚至无意中在其构建指令中包含此选项，但这会产生不希望的行为。
</p>
<p>每个构建类型都会导致 CMake 自动将一组标志附加到 <code>CFLAGS</code> 和 <code>CXXFLAGS</code>。当使用通用 <code>Release</code> build 类型时，它会自动附加<code>-O3</code><a rel="nofollow" class="external autonumber" href="https://github.com/Kitware/CMake/blob/v3.17.0/Modules/Compiler/GNU.cmake#L58">[1]</a> 编译器优化标志，这将覆盖当前为 <code>-O2</code> （在 <a href="../zh-CN/Makepkg.html#%E9%85%8D%E7%BD%AE" title="Makepkg (简体中文)">makepkg 配置文件</a>中定义）的默认 Arch Linux 标志。这是不希望的，因为它偏离了 Arch Linux 的目标优化级别。
</p>
<h4>
<span id=".E5.85.B3.E4.BA.8E_-O3_.E7.9A.84.E6.B3.A8.E6.84.8F.E4.BA.8B.E9.A1.B9"></span><span class="mw-headline" id="关于_-O3_的注意事项">关于 <code>-O3</code> 的注意事项</span>
</h4>
<p>使用 <code>-O3</code> 不能保证软件的性能会更好，有时甚至会减慢程序的速度。在某些情况下，它也会破坏软件。有一个很好的理由说明为什么 Linux 开发人员选择 <code>-O2</code> 作为目标优化级别，我们应该坚持使用它。除非您确切知道自己在做什么，或者如果上游明确告诉或暗示需要 <code>-O3</code> ，否则我们应该避免在包中使用它。
</p>
<h4>
<span id=".E4.BF.AE.E5.A4.8D.E8.87.AA.E5.8A.A8.E4.BC.98.E5.8C.96.E6.A0.87.E5.BF.97.E8.A6.86.E7.9B.96"></span><span class="mw-headline" id="修复自动优化标志覆盖">修复自动优化标志覆盖</span>
</h4>
<p>由于 CMake 的灵活性，以 100% 有保证的方式解决这个问题不是一个简单的问题。请注意，没有标准的解决方案可适用于所有情况。本节将讨论可能的解决方案和应遵守的一些要点。
</p>
<p>默认的 CMake 构建类型是 <code>None</code> ，默认情况下它不会向 <code>CFLAGS</code> 和 <code>CXXFLAGS</code> 附加任何标志，因此只要省略 <code>CMAKE_BUILD_TYPE</code> 选项的使用，就可以像默认为  <code>None</code>一样工作。但请注意，忽略此选项并不能保证解决问题，因为如果命令行中未设置  <code>CMAKE_BUILD_TYPE</code> ，则许多软件项目会自动将 CMake 文件中的生成类型设置为<code>Release</code> （或其他类型）。
</p>
<p>由于默认的 <code>None</code> build 类型在默认情况下不会向 <code>CFLAGS</code> 和 <code>CXXFLAGS</code> 追加任何标志，因此使用 <code>-DCMAKE_BUILD_TYPE=None</code> 选项也可以工作。一般来说，使用  <code>-DCMAKE_BUILD_TYPE=None</code> 选项比省略使用 <code>CMAKE_BUILD_TYPE</code> 要好。当上游自动将生成类型设置为 <code>Release</code> 时，它将覆盖以下情况：省略 <code>CMAKE_BUILD_TYPE</code> 时，它默认不会附加任何标志，并且很少看到软件为 <code>None</code> 构建类型设置不需要的标志。
</p>
<p>但不幸的是，事情并没有那么简单，比如只使用 <code>-DCMAKE_BUILD_TYPE=None</code> t来解决这个问题。当使用 <code>None</code> 构建类型修复 <code>-O3</code> 问题时，可能会遇到另一个问题。对于许多软件项目来说，在 CMake文 件中为版本生成类型定义一些必需的编译器标志是一种常见的做法（例如，设置 <code>CMAKE_C_FLAGS_RELEASE</code> and <code>CMAKE_CXX_FLAGS_RELEASE</code> 变量）。如果使用 <code>None</code> 构建类型，在没有这些上游定义标志的情况下编译时，此类软件可能会中断或出现错误行为。为了确定是否缺少某些标志，您需要查看 CMake 文件，或者可以比较 <code>make VERBOSE=1</code> 对于 <code>None</code> <code>Release</code> 构建类型的输出。如果 <code>None</code> 构建类型导致某些上游定义的标志丢失，该怎么办？在这种情况下，您可能正处于两种有问题的情况的中间，因为如果使用 <code>Release</code> 构建类型，您将丢失一些必需的上游定义的标志。解决这种情况没有标准的办法，应该逐案分析。如果上游为 <code>Release</code> 构建类型定义了 <code>-O2</code> ，则可以使用 <code>-DCMAKE_BUILD_TYPE=Release</code> （参见下文）。否则，修补C Make 文件可能是一个解决方案。
</p>
<p>一些软件项目在其 CMake 文件中为 <code>Release</code> 构建类型硬编码为 <code>-O2</code>，因此，如果您确定 <code>-O2</code> 是正在使用的优化级别，那么在这种情况下可以安全地设置 <code>-DCMAKE_BUILD_TYPE=Release</code>。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 
<ul>
<li>使用 <code>None</code> 类型时，某些软件可能会崩溃。当使用 <code>None</code> 构建类型检查软件是否会中断或丢失功能时，请测试软件。</li>
<li>某些软件可能只适用于 <code>Release</code> 构建类型。你需要实验和测试软件。</li>
</ul>
</div>
<h3>
<span id=".E9.AA.8C.E8.AF.81.E4.BF.AE.E5.A4.8D"></span><span class="mw-headline" id="验证修复">验证修复</span>
</h3>
<p>通过启用生成工具的详细模式，可以验证CMake是否正确使用了修复程序。例如，当使用 <code>make</code> （这是CMake的默认值）时，可以通过将 <code>VERBOSE=1</code> 添加到 <code>make</code> 中（比如 <code>make VERBOSE=1</code>)来完成。这将使 <code>make</code> 能够输出正在执行的编译器命令。然后，您可以运行 <a href="../zh-CN/Makepkg.html" title="Makepkg (简体中文)">makepkg</a> 并检查输出，看看编译器是否使用了 <code>-D_FORTIFY_SOURCE=2</code> 和 <code>-O2</code> 标志。如果在每个命令行中显示多个优化标志，则该行中的最后一个标志将是编译器使用的标志（这意味着 <code>-O2</code> 需要是最后一个优化标志才能生效）。
</p>
<h2>
<span id=".E5.89.8D.E7.BC.80.E5.92.8C.E5.BA.93.E5.AE.89.E8.A3.85.E7.9B.AE.E5.BD.95"></span><span class="mw-headline" id="前缀和库安装目录">前缀和库安装目录</span>
</h2>
<p>标准 Arch Linux <code>/usr</code> 前缀可以由 <code>-DCMAKE_INSTALL_PREFIX=/usr</code> CMake 选项指定。通常需要这样做，因为许多软件默认将文件安装到 <code>/usr/local</code> 前缀中。
</p>
<p>一些上游项目将 CMake 文件设置为将库安装到 <code>/usr/lib64</code> 目录中。如果是这种情况，可以使用 <code>-DCMAKE_INSTALL_LIBDIR=lib</code> CMake选项将库安装目录正确设置为 <code>/usr/lib</code>。
</p>
<h2>
<span id=".E6.8F.90.E7.A4.BA.E5.92.8C.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="提示和技巧">提示和技巧</span>
</h2>
<h3>
<span id=".E6.8C.87.E5.AE.9A.E7.9B.AE.E5.BD.95"></span><span class="mw-headline" id="指定目录">指定目录</span>
</h3>
<p>自从CMake 3.13版本以来，有一个 <code>-B</code> 选项可以自动创建构建目录。这样可以避免使用单独的mkdir（或install）命令创建生成目录。<code>-S</code> 选项指定源目录（搜索 <code>CMakeLists.txt</code> 文件的位置），并避免在执行 <code>cmake</code> 之前将 <code>cd</code> 插入源树。这两个选项结合在一起，是指定生成目录和源目录的方便方法。例如，对于构建名为 <i>foo</i> 的程序：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">build() {
    cmake -B build -S "foo-${pkgver}" [other_cmake_options]
    make -C build
}</pre>
<h3>
<span id=".E5.87.8F.E5.B0.91.E5.8F.AF.E8.83.BD.E4.B8.8D.E9.9C.80.E8.A6.81.E7.9A.84.E8.BE.93.E5.87.BA"></span><span class="mw-headline" id="减少可能不需要的输出">减少可能不需要的输出</span>
</h3>
<p><code>-Wno-dev</code> 选项将抑制某些警告的输出，这些警告仅适用于编写 <code>CMakeLists.txt</code> 文件的上游项目开发人员。删除这些警告将使 CMake 输出更好，并减少检查它的负担。一般来说，这些警告通常可以被打包程序安全地忽略。
</p>
<h3>
<span id=".E4.BB.8E.E4.BA.8C.E8.BF.9B.E5.88.B6.E6.96.87.E4.BB.B6.E4.B8.AD.E5.88.A0.E9.99.A4.E4.B8.8D.E5.AE.89.E5.85.A8.E7.9A.84_RPATH_.E5.BC.95.E7.94.A8"></span><span class="mw-headline" id="从二进制文件中删除不安全的_RPATH_引用">从二进制文件中删除不安全的 <code>RPATH</code> 引用</span>
</h3>
<p>有时生成的二进制文件可能在 <code>RPATH</code>中包含不安全的引用。这可以通过在构建的包上运行 <a href="../en/Namcap.html" title="Namcap">Namcap</a> 来验证，并且包含一个应该修复的安全问题。使用 <code>CMAKE_SKIP_INSTALL_RPATH=YES</code> <b>或</b> <code>CMAKE_SKIP_RPATH=YES</code> CMake 选项很有可能解决此问题。您需要同时使用这两个选项进行实验，并查看在所讨论的软件中什么可以工作（不需要同时使用这两个选项）。
</p>
<h3>
<span id=".E8.8E.B7.E5.8F.96.E6.89.80.E6.9C.89.E5.8F.AF.E7.94.A8.E7.9A.84_CMake_.E9.80.89.E9.A1.B9"></span><span class="mw-headline" id="获取所有可用的_CMake_选项">获取所有可用的 CMake 选项</span>
</h3>
<p>要获取软件项目可用的所有“可见”CMake选项，请在源树（主 <code>CMakeLists.txt</code> 文件所在）中执行 <code>cmake -LAH</code>。
</p>
<p>如果要保存输出以供以后参考，可以将其重定向到文件：
</p>
<pre>$ cmake -LAH &gt;options.txt 2&gt;&amp;1
</pre>
<h2>
<span id=".E6.A8.A1.E6.9D.BF"></span><span class="mw-headline" id="模板">模板</span>
</h2>
<p>下面是 <code>build()</code> 函数的通用模板，它是基于 CMake 的包的起点。假设包被命名为 <i>foo</i>，它是基于 C 和 C++ 的，并且它不为 CMake 文件中的 <code>Release</code> 构建类型定义任何必需的编译器标志：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">build() {
    cmake -B build -S "foo-${pkgver}" \
        -DCMAKE_BUILD_TYPE='None' \
        -DCMAKE_INSTALL_PREFIX='/usr' \
        -Wno-dev
    make -C build
}</pre>
<p>不要忘记将 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cmake">cmake</a></span> 放在 <a href="../zh-CN/PKGBUILD.html#makedepends" title="PKGBUILD (简体中文)">makedepends</a>。
</p>
<h2>
<span id=".E8.8C.83.E4.BE.8B.E5.8C.85"></span><span class="mw-headline" id="范例包">范例包</span>
</h2>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=i2pd">i2pd</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libmysofa">libmysofa</a></span></li>
</ul>
<h2>
<span id=".E5.8F.A6.E8.AF.B7.E5.8F.82.E8.A7.81"></span><span class="mw-headline" id="另请参见">另请参见</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://cmake.org/documentation/">CMake 文档</a></li>
<li><a rel="nofollow" class="external text" href="https://cmake.org/cmake/help/latest/">最新版本的文档参考</a></li>
<li><a href="https://en.wikipedia.org/wiki/CMake" class="extiw" title="wikipedia:CMake">Wikipedia 文章</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 1 cmake"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cmake.1">cmake(1)</a></span></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Arch_package_guidelines.html" title="Category:Arch package guidelines (简体中文)">Arch package guidelines (简体中文)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=CMake_package_guidelines_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=625881">https://wiki.archlinux.org/index.php?title=CMake_package_guidelines_(简体中文)&amp;oldid=625881</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 19 July 2020, at 01:31.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
