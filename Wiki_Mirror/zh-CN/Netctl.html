<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>netctl (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Netctl_简体中文 rootpage-Netctl_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">netctl (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/Network_configuration.html" class="mw-redirect" title="网络配置">网络配置</a></li>
<li><a href="../zh-CN/aa29dd559001de6a26e3fe87e084eb6e.html" class="mw-redirect" title="无线网络配置">无线网络配置</a></li>
<li><a href="../zh-CN/Wicd.html" title="Wicd (简体中文)">Wicd (简体中文)</a></li>
<li><a href="../zh-CN/Network_bridge.html" class="mw-redirect" title="网桥">网桥</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Netctl.html" title="Netctl">Netctl</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2018-01-10。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Netctl&amp;diff=0&amp;oldid=504831">更改</a>，则您可以帮助同步翻译。</div>
<p>Netctl 是基于命令行的网络管理器，支持场景配置。它是 Arch Linux 网络管理方面的原生项目。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#%E4%BD%BF%E7%94%A8"><span class="tocnumber">3</span> <span class="toctext">使用</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">3.1</span> <span class="toctext">启动配置文件</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#%E5%90%AF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">3.2</span> <span class="toctext">启用配置文件</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#%E7%89%B9%E6%AE%8A_systemd_%E5%8D%95%E5%85%83"><span class="tocnumber">3.3</span> <span class="toctext">特殊 systemd 单元</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#%E6%9C%89%E7%BA%BF%E8%BF%9E%E6%8E%A5"><span class="tocnumber">3.3.1</span> <span class="toctext">有线连接</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#%E6%97%A0%E7%BA%BF%E8%BF%9E%E6%8E%A5"><span class="tocnumber">3.3.2</span> <span class="toctext">无线连接</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%E6%8F%90%E7%A4%BA%E4%B8%8E%E6%8A%80%E5%B7%A7"><span class="tocnumber">4</span> <span class="toctext">提示与技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="tocnumber">4.1</span> <span class="toctext">配置示例</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#%E6%9C%89%E7%BA%BF%E8%BF%9E%E6%8E%A5_2"><span class="tocnumber">4.1.1</span> <span class="toctext">有线连接</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#%E6%97%A0%E7%BA%BF%E8%BF%9E%E6%8E%A5(WPA-PSK)"><span class="tocnumber">4.1.2</span> <span class="toctext">无线连接(WPA-PSK)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#%E9%9A%90%E8%97%8F%E6%97%A0%E7%BA%BF%E5%AF%86%E7%A0%81"><span class="tocnumber">4.2</span> <span class="toctext">隐藏无线密码</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C%E7%89%88%E5%9B%BE%E5%BD%A2%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="tocnumber">4.3</span> <span class="toctext">使用体验版图形用户界面</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Eduroam"><span class="tocnumber">4.4</span> <span class="toctext">Eduroam</span></a></li>
<li class="toclevel-2 tocsection-16">
<a href="#%E7%BB%91%E5%AE%9A"><span class="tocnumber">4.5</span> <span class="toctext">绑定</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="tocnumber">4.5.1</span> <span class="toctext">负载均衡</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#%E6%9C%89%E7%BA%BF_-&gt;_%E6%97%A0%E7%BA%BF%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2"><span class="tocnumber">4.5.2</span> <span class="toctext">有线 -&gt; 无线故障切换</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#%E4%BD%BF%E7%94%A8%E4%BB%BB%E6%84%8F%E6%8E%A5%E5%8F%A3"><span class="tocnumber">4.6</span> <span class="toctext">使用任意接口</span></a></li>
<li class="toclevel-2 tocsection-20">
<a href="#%E4%BD%BF%E7%94%A8%E9%92%A9%E5%AD%90"><span class="tocnumber">4.7</span> <span class="toctext">使用钩子</span></a>
<ul>
<li class="toclevel-3 tocsection-21">
<a href="#%E8%8C%83%E4%BE%8B"><span class="tocnumber">4.7.1</span> <span class="toctext">范例</span></a>
<ul>
<li class="toclevel-4 tocsection-22"><a href="#%E5%9C%A8%E5%B7%B2%E6%9C%89%E8%BF%9E%E6%8E%A5%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="tocnumber">4.7.1.1</span> <span class="toctext">在已有连接上执行命令</span></a></li>
<li class="toclevel-4 tocsection-23"><a href="#%E6%BF%80%E6%B4%BB_network-online.target"><span class="tocnumber">4.7.1.2</span> <span class="toctext">激活 network-online.target</span></a></li>
<li class="toclevel-4 tocsection-24"><a href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4_DHCP_%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="tocnumber">4.7.1.3</span> <span class="toctext">设置默认 DHCP 客户端</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-25">
<a href="#%E6%8E%92%E9%94%99"><span class="tocnumber">5</span> <span class="toctext">排错</span></a>
<ul>
<li class="toclevel-2 tocsection-26"><a href="#Job_for_netctl@wlan(...).service_failed"><span class="tocnumber">5.1</span> <span class="toctext">Job for netctl@wlan(...).service failed</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#dhcpcd:_ipv4_addroute:_File_exists"><span class="tocnumber">5.2</span> <span class="toctext">dhcpcd: ipv4_addroute: File exists</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#DHCP_timeout_issues"><span class="tocnumber">5.3</span> <span class="toctext">DHCP timeout issues</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#Connection_timeout_issues"><span class="tocnumber">5.4</span> <span class="toctext">Connection timeout issues</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#Problems_with_netctl-auto_on_resume"><span class="tocnumber">5.5</span> <span class="toctext">Problems with netctl-auto on resume</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#netctl-auto_suddenly_stopped_working_for_WiFi_adapters"><span class="tocnumber">5.6</span> <span class="toctext">netctl-auto suddenly stopped working for WiFi adapters</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#netctl-auto_does_not_automatically_unblock_a_wireless_card_to_use_an_interface"><span class="tocnumber">5.7</span> <span class="toctext">netctl-auto does not automatically unblock a wireless card to use an interface</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#RTNETLINK_answers:_File_exists_(with_multiple_NICs)"><span class="tocnumber">5.8</span> <span class="toctext">RTNETLINK answers: File exists (with multiple NICs)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-34"><a href="#%E5%8F%82%E8%A7%81"><span class="tocnumber">6</span> <span class="toctext">参见</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">安装</a><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=netctl">netctl</a></span>。
netctl 有一些用于自动连接的<a href="#%E7%89%B9%E6%AE%8A_systemd_%E5%8D%95%E5%85%83">#特殊 systemd 单元</a>需要一些附加依赖包，详情参阅该章节。
下表列出 netctl 的其他可选依赖包：
</p>
<table class="wikitable">
<tbody>
<tr>
<th>功能
</th>
<th>依赖
</th>
</tr>
<tr>
<td>WPA</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span>
</td>
</tr>
<tr>
<td>DHCP</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>
</td>
</tr>
<tr>
<td>Wifi menus</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dialog">dialog</a></span>
</td>
</tr>
<tr>
<td>PPPoE</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ppp">ppp</a></span>
</td>
</tr>
</tbody>
</table>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 请使用<code>systemctl --type=service</code>确保其它可以配置网络的服务都没有运行，同时使用多个网络配置工具会导致冲突。</div>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p><code>netctl</code> 使用配置文件来管理网络连接，并按需自动或手动启动不同的操作模式
</p>
<p><i>netctl</i>的配置文件保存在 <code>/etc/netctl/</code> 。一些配置文件的示例位于 <code>/etc/netctl/examples/</code>。
</p>
<p>若要使用上述示例配置文件，只需将其从 <code>/etc/netctl/examples/</code> 复制到 <code>/etc/netctl/</code> 并按需配置。参见下述<a href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B">#配置示例</a>。编辑配置文件所需的首要参数是网络<i>端口(interface)</i>，详阅<a href="../zh-CN/Network_configuration.html#%E6%9B%B4%E6%94%B9%E8%AE%BE%E5%A4%87%E5%90%8D%E7%A7%B0" class="mw-redirect" title="网络配置">网络配置#更改设备名称</a>。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 
<p>如要配置无线网络，可以用 root 身份运行 <code>wifi-menu -o</code> 以自动在 <code>/etc/netctl/</code> 中生成配置文件。<i>wifi-menu</i> 需要 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dialog">dialog</a></span> 包。
</p>
<p>如要在有线网络接口上启用静态IP，并忽略线缆连接状况，可以在配置文件中添加 <code>SkipNoCarrier=yes</code> 配置项
</p>
</div>
<p>配置文件的完整配置项清单请参阅：<span class="plainlinks archwiki-template-man" title="$ man 5 netctl.profile"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/netctl.profile.5">netctl.profile(5)</a></span>
</p>
<h2>
<span id=".E4.BD.BF.E7.94.A8"></span><span class="mw-headline" id="使用">使用</span>
</h2>
<p>netctl 的完整命令清单请参阅：<span class="plainlinks archwiki-template-man" title="$ man 1 netctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/netctl.1">netctl(1)</a></span>
</p>
<h3>
<span id=".E5.90.AF.E5.8A.A8.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="启动配置文件">启动配置文件</span>
</h3>
<p>创建了一个配置文件之后请尝试用它建立一个连接。下例中的 <i>profile</i> 仅使用配置文件的文件名，不要带全路径名。
</p>
<pre># netctl start profile
</pre>
<p>如果上面的命令返回失败，可以使用 <code>journalctl -xn</code> 和 <code>netctl status <i>profile</i></code> 命令获取进一步的失败原因信息。
</p>
<h3>
<span id=".E5.90.AF.E7.94.A8.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="启用配置文件">启用配置文件</span>
</h3>
<p>下列命令实现开机时自动启动配置文件：
</p>
<pre># netctl enable <i>profile</i>
</pre>
<p>这条命令将创建并启用一个随计算机启动而自动运行的 <a href="../zh-CN/Systemd.html" title="Systemd (简体中文)">systemd</a> 服务。对配置文件本身的修改无法自动关联到前述创建的服务文件，修改之后，需用下述命令重新启用该配置：
</p>
<pre># netctl reenable <i>profile</i>
</pre>
<p>启用的配置文件将在下次引导时自动启动。显然，只有线缆已连接或已处于无线信号覆盖区域时，配置文件才能成功启动。
</p>
<p>如果需要在多个配置文件之间频繁切换（比如携带笔记本电脑旅行），应改用 <a href="#%E7%89%B9%E6%AE%8A_systemd_%E5%8D%95%E5%85%83">#特殊 systemd 单元</a> 一节的方法代替本节所述方法。
</p>
<h3>
<span id=".E7.89.B9.E6.AE.8A_systemd_.E5.8D.95.E5.85.83"></span><span class="mw-headline" id="特殊_systemd_单元">特殊 systemd 单元</span>
</h3>
<p><i>netctl</i> 提供了特殊的 <a href="../en/Systemd.html" title="Systemd">systemd</a> 服务以实现有线与无线连接的自动切换。这些特殊的 systemd 单元的完整清单请参阅 <span class="plainlinks archwiki-template-man" title="$ man 7 netctl.special"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/netctl.special.7">netctl.special(7)</a></span>。
</p>
<h4>
<span id=".E6.9C.89.E7.BA.BF.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="有线连接">有线连接</span>
</h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ifplugd">ifplugd</a></span> 包，并且<a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start/enable">启动/启用</a> <code>netctl-ifplugd@<i>interface</i>.service</code> systemd 单元。网线插入/拔出时，DHCP 配置文件将被启动/停止。
</p>
<ul>
<li>
<code>netctl-ifplugd@<i>interface</i>.service</code> 优先启用使用了 <a href="https://en.wikipedia.org/wiki/DHCP" class="extiw" title="wikipedia:DHCP">DHCP</a> 的配置文件。</li>
<li>若要自动启动一个静态 IP 配置文件，需要在其中增加 <code>ExcludeAuto=no</code> 配置项。</li>
<li>若要使某个静态 IP 配置文件的优先级高于使用 DHCP 的配置文件，可以增加 <code>Priority=2</code> 配置项，这将使其优先级高于使用 DHCP 的配置文件默认的 <code>Priority=1</code>。</li>
</ul>
<h4>
<span id=".E6.97.A0.E7.BA.BF.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="无线连接">无线连接</span>
</h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wpa_actiond/">wpa_actiond</a></span><sup><small>AUR</small></sup> 包并<a href="../zh-CN/Systemd.html#%E4%BD%BF%E7%94%A8%E5%8D%95%E5%85%83" title="Systemd (简体中文)">启动/启用</a> <code>netctl-auto@<i>interface</i>.service</code> systemd 单元。当在不同网络覆盖区域间移动（漫游）时，<i>netctl</i> 配置文件将会自动启动/停止。
</p>
<ul><li>
<i>netctl-auto</i> 要求配置文件必须使用 <code>Security=wpa-configsection</code> 或 <code>Security=wpa</code> 配置项才能工作，不能使用 <code>Security=wpa-config</code> 配置项。</li></ul>
<ul>
<li>如果希望某些无线网络配置<b>不要</b>被 <code>netctl-auto@<i>interface</i>.service</code>自动启用，需要特别在该配置文件中加入 <code>ExcludeAuto=yes</code> 。</li>
<li>如果存在多个无线访问点可用，可以在 <i>WPAConfigSection</i> 配置节中加入 <code>priority=</code> 配置项（参阅 <code>/etc/netctl/examples/wireless-wpa-configsection</code>）。</li>
</ul>
<p>注意，服务单元名称中的 <i>interface</i> 一词不要原文照抄，应当替换成实际的接口设备名，如 <code>netctl-auto@wlp4s0.service</code>。详情参阅 <code>netctl.profile(5)</code>。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>如果任何一个配置文件包含错误，例如包含空变量 <code>Key=</code>，即使这个文件未被使用，也将加载失败并报错 <code>"Failed to read or parse configuration '/run/network/wpa_supplicant_wlan0.conf'</code>。</li>
<li>本方法与 <a href="#%E5%90%AF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">启用配置文件</a> 矛盾。如果你之前已经通过netctl启用了一个配置文件，运行 <code>netctl disable <i>profile</i></code> 来防止这个配置在计算机启动时被启用两次。</li>
</ul>
</div>
<p>通过 netctl-auto 的命令动作可以在不停止 <code>netctl-auto.service</code> 服务的情况下手工控制一个不受 netctl-auto 管理的网络接口。完整的 netctl-auto 命令动作列表参阅 <span class="plainlinks archwiki-template-man" title="$ man 1 netctl-auto"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/netctl-auto.1">netctl-auto(1)</a></span>。
</p>
<h2>
<span id=".E6.8F.90.E7.A4.BA.E4.B8.8E.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="提示与技巧">提示与技巧</span>
</h2>
<h3>
<span id=".E9.85.8D.E7.BD.AE.E7.A4.BA.E4.BE.8B"></span><span class="mw-headline" id="配置示例">配置示例</span>
</h3>
<h4>
<span id=".E6.9C.89.E7.BA.BF.E8.BF.9E.E6.8E.A5_2"></span><span class="mw-headline" id="有线连接_2">有线连接</span>
</h4>
<p>For a DHCP connection, only the <code>Interface</code> has to be configured after copying the <code>/etc/netctl/examples/ethernet-dhcp</code> example profile to <code>/etc/netctl</code>. 
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>my_dhcp_profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Interface=enp1s0
Connection=ethernet
IP=dhcp
</pre>
<p>For a static IP configuration copy the <code>/etc/netctl/examples/ethernet-static</code> example profile to <code>/etc/netctl</code> and modify <code>Interface</code>, <code>Address</code>, <code>Gateway</code> and <code>DNS</code>) as needed. 
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>my_static_profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Interface=enp1s0
Connection=ethernet
IP=static
Address=('10.1.10.2/24')
Gateway=('10.1.10.1')
DNS=('10.1.10.1')
</pre>
<p>Take care to include the subnet notation of <code>/24</code>. It equates to a netmask of <code>255.255.255.0</code>) and without it the profile will fail to start. See also <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation" class="extiw" title="wikipedia:Classless Inter-Domain Routing">CIDR notation</a>. To alias more than one IP address per a NIC set <code>Address=('10.1.10.2/24' '192.168.1.2/24')</code>.
</p>
<h4>
<span id=".E6.97.A0.E7.BA.BF.E8.BF.9E.E6.8E.A5.28WPA-PSK.29"></span><span class="mw-headline" id="无线连接(WPA-PSK)">无线连接(WPA-PSK)</span>
</h4>
<p>The following applies for the standard wireless connections using a pre-shared key (WPA-PSK).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wireless-wpa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='A simple WPA encrypted wireless connection using 256-bit PSK'
Interface=wlp2s2
Connection=wireless
Security=wpa
IP=dhcp
ESSID=<i>your_essid</i>
Key=\"64cf3ced850ecef39197bb7b7b301fc39437a6aa6c6a599d0534b16af578e04a</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>Make sure to use the <b>special quoting rules</b> for the <code>Key</code> variable as explained at the end of <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile(5)</a>.</li>
<li>If the passphrase fails, try removing the <code>\"</code> in the <code>Key</code> variable.</li>
<li>Although "encrypted", the key that you put in the profile configuration is enough to connect to a WPA-PSK network. Therefore this process is only useful for hiding the human-readable version of the passphrase. This will not prevent anyone with read access to this file from connecting to the network.</li>
</ul>
</div>
<h3>
<span id=".E9.9A.90.E8.97.8F.E6.97.A0.E7.BA.BF.E5.AF.86.E7.A0.81"></span><span class="mw-headline" id="隐藏无线密码">隐藏无线密码</span>
</h3>
<p>You can also follow the following step to obfuscate the wireless passphrase (<i>wifi-menu</i> does it automatically when using the <code>-o</code> flag): 
</p>
<p>Users <b>not</b> wishing to have the passphrase to their wireless network stored in <i>plain text</i> have the option of storing the corresponding 256-bit pre-shared key instead, which is calculated from the passphrase and the SSID using standard algorithms.
</p>
<p>Calculate your 256-bit PSK using <a href="../en/Wpa_supplicant.html#Connecting_with_wpa_passphrase" class="mw-redirect" title="WPA supplicant">wpa_passphrase</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ wpa_passphrase <i>your_essid</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">network={
  ssid="<i>your_essid</i>"
  #psk="<i>passphrase</i>"
  psk=64cf3ced850ecef39197bb7b7b301fc39437a6aa6c6a599d0534b16af578e04a
}</pre>
<p>The <i>pre-shared key</i> (psk) now needs to replace the plain text passphrase of the <code>Key</code> variable in the profile.
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E4.BD.93.E9.AA.8C.E7.89.88.E5.9B.BE.E5.BD.A2.E7.94.A8.E6.88.B7.E7.95.8C.E9.9D.A2"></span><span class="mw-headline" id="使用体验版图形用户界面">使用体验版图形用户界面</span>
</h3>
<p>如果你想使用图形用户界面管理 <i>netctl</i> 和你的网络连接，并且不在意使用非官方体验版软件包的话，可以从 <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> 安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/netgui/">netgui</a></span><sup><small>AUR</small></sup>。注意：它毕竟还只是一个 beta 版，你应该熟悉 <i>netctl</i> 的语法以便解决可能出现的问题。另一个图形用户界面程序的替代品是 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/netctl-gui/">netctl-gui</a></span><sup><small>AUR</small></sup>，它提供了基于 Qt 的图形界面、DBus  守护进程和 KDE 桌面小部件。第三个替代品是 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/netmenu/">netmenu</a></span><sup><small>AUR</small></sup>，它使用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmenu">dmenu</a></span> 作为图形界面。
</p>
<h3><span class="mw-headline" id="Eduroam">Eduroam</span></h3>
<p>参阅 <a href="../en/Network_configuration/Wireless.html#netctl" class="mw-redirect" title="WPA2 Enterprise">WPA2 Enterprise#netctl</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>
</p>
<h3>
<span id=".E7.BB.91.E5.AE.9A"></span><span class="mw-headline" id="绑定">绑定</span>
</h3>
<p>引自 <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/networking/bonding.html">内核文档</a>:
</p>
<dl><dd><i>The Linux bonding driver provides a method for aggregating multiple network interfaces into a single logical "bonded" interface. The behavior of the bonded interfaces depends on the mode. Generally speaking, modes provide either hot standby or load balancing services. Additionally, link integrity monitoring may be performed.</i></dd></dl>
<dl><dd><i>（Linux bonding 驱动提供了把多个网络接口聚合成一个“绑定”的单一逻辑接口的途径。绑定后接口的行为取决于绑定的模式，一般来说，提供“主备”和“负载均衡”两种模式。另外，可以提供对连接总体情况的监测功能。）</i></dd></dl>
<h4>
<span id=".E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1"></span><span class="mw-headline" id="负载均衡">负载均衡</span>
</h4>
<p>要用 netctl 配合 bonding，需要从官方软件源安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ifenslave">ifenslave</a></span>。
</p>
<p>复制 <code>/etc/netctl/examples/bonding</code> 到 <code>/etc/netctl/bond0</code> 然后进行编辑。例如: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/bond0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='Bond Interface'
Interface='bond0'
Connection=bond
BindsToInterfaces=('eth0' 'eth1')
IP=dhcp
IP6=stateless</pre>
<p>现在你可以停用之前的配置文件。然后设置 bonding 为自动启动，切换到新的配置。例如：
</p>
<pre># netctl switch-to bond0
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 这将使用 <code>bonding</code> 驱动的默认策略 round-robin（负载均衡）。详见<a rel="nofollow" class="external text" href="https://www.kernel.org/doc/html/latest/networking/bonding.html">官方文档</a>。</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 查看状态和绑定模式：<pre>$ cat /proc/net/bonding/bond0</pre>
</div>
<h4>
<span id=".E6.9C.89.E7.BA.BF_-.3E_.E6.97.A0.E7.BA.BF.E6.95.85.E9.9A.9C.E5.88.87.E6.8D.A2"></span><span class="mw-headline" id="有线_-&gt;_无线故障切换">有线 -&gt; 无线故障切换</span>
</h4>
<p>这一部分探讨怎样用bonding来实现当有线以太网无法工作时自动切换至无线网络。我们假设所有的网络接口默认启动dhcdpcd服务。
</p>
<p>你需要从官方源安装软件包：<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ifenslave">ifenslave</a></span> 和 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span>.
</p>
<p>首先设置 <code>bonding</code> 驱动使用 <code>active-backup</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/bonding.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options bonding mode=active-backup
options bonding miimon=100
options bonding primary=eth0
options bonding max_bonds=0</pre>
<p><code>max_bonds</code> 选项避免了 <code>Interface bond0 already exists</code> 错误。如果使用了MAC过滤，应当添加设置 <code>fail_over_mac=active</code>。
</p>
<p>接下来，编写一个netctl配置文件来绑定两个网络接口：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/failover</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='A wired connection with failover to wireless'
Interface='bond0'
Connection=bond
BindsToInterfaces=('eth0' 'wlan0')
IP='dhcp'
SkipNoCarrier='no'</pre>
<p>设置该配置文件自启动：
</p>
<pre># netctl enable failover
</pre>
<p>将 wpa_supplicant 配置为关联一个已知网络，可以通过 netctl profile (记得设置 IP='no'), 和一个长期运行的 wpa_supplicant 服务或者 wpa_cli 命令实现。具体方法请访问  <a href="../zh-CN/Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant (简体中文)">wpa_supplicant</a> 页面。想要长期运行 wpa_supplicant 服务，创建一个wpa_supplicant配置文件<code>/etc/wpa_supplicant/wpa_supplicant-wlan0.conf</code> 然后运行：
</p>
<pre># systemctl enable wpa_supplicant@wlan0
</pre>
<p>在有线网络配置中设置<code>IP='no'</code>。IP地址应当只被分配到bond0接口。
</p>
<p>如果你有一个有线连接和无线连接连接到同一个网络，现在可以将有线网络断开连接，然后重新连接而依然保持网络通畅。在大多数情况下，甚至连流媒体音乐都不会卡顿。
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E4.BB.BB.E6.84.8F.E6.8E.A5.E5.8F.A3"></span><span class="mw-headline" id="使用任意接口">使用任意接口</span>
</h3>
<p>In some cases it may be desirable to allow a profile to use any interface on the system. A common example use case is using a common disk image across many machines with differing hardware (this is especially useful if they are headless). If you use the kernel's naming scheme, and your machine has only one ethernet interface, you can probably guess that eth0 is the right interface. If you use udev's <a rel="nofollow" class="external text" href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/">Predictable Network Interface Names</a>, however, names will be assigned based on the specific hardware itself (e.g. enp1s0), rather than simply the order that the hardware was detected (e.g. eth0, eth1). This means that a netctl profile may work on one machine and not another, because they each have different interface names.
</p>
<p>A quick and dirty solution is to make use of the <code>/etc/netctl/interfaces/</code> directory. Choose a name for your interface alias (<code>en-any</code> in this example), and write the following to a file with that name (making sure it is executable).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/interfaces/en-any</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
for interface in /sys/class/net/en*; do
        break;
done
Interface=$(basename $interface)
echo "en-any: using interface $Interface";
</pre>
<p>Then create a profile that uses the interface. Pay special attention to the <code>Interface</code> directive. The rest are only provided as examples.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wired</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Description='Wired'
Interface=en-any
Connection=ethernet
IP=static
Address=('192.168.1.15/24')
Gateway='192.168.1.1'
DNS=('192.168.1.1')
</pre>
<p>When the <code>wired</code> profile is started, any machine using the two files above will automatically bring up and configure the first ethernet interface found on the system, regardless of what name udev assigned to it. Note that this is not the most robust way to go about configuring interfaces. If you use multiple interfaces, netctl may try to assign the same interface to them, and will likely cause a disruption in connectivity. If you do not mind a more complicated solution, <code>netctl-auto</code> is likely to be more reliable.
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E9.92.A9.E5.AD.90"></span><span class="mw-headline" id="使用钩子">使用钩子</span>
</h3>
<p>netctl supports hooks in <code>/etc/netctl/hooks/</code> and per interface hooks in <code>/etc/netctl/interfaces/</code>. You can set any option in a hook/interface that you can
in a profile. They are read the same way! Most importantly this includes <code>ExecUpPost</code> and <code>ExecDownPre</code>. 
</p>
<p>When a profile is read, netctl sources <i>all executable</i> scripts in <code>hooks</code>, then it reads the profile file for the connection and finally it sources an executable script with the name of the interface used in the profile from the <code>interfaces</code> directory. Therefore, declarations in an interface script override declarations in the profile, which override declarations in hooks. 
</p>
<p>The variables <code>$INTERFACE</code>, <code>$SSID</code>, <code>$ACTION</code> and <code>$Profile</code> are available in hooks/interfaces <b>only</b> when using <code>netctl-auto</code> 
</p>
<h4>
<span id=".E8.8C.83.E4.BE.8B"></span><span class="mw-headline" id="范例">范例</span>
</h4>
<h5>
<span id=".E5.9C.A8.E5.B7.B2.E6.9C.89.E8.BF.9E.E6.8E.A5.E4.B8.8A.E6.89.A7.E8.A1.8C.E5.91.BD.E4.BB.A4"></span><span class="mw-headline" id="在已有连接上执行命令">在已有连接上执行命令</span>
</h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/myservices</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
ExecUpPost="systemctl start crashplan.service; systemctl start dropbox@&lt;username&gt;.service"
ExecDownPre="systemctl stop crashplan.service; systemctl stop dropbox@&lt;username&gt;.service"
</pre>
<h5>
<span id=".E6.BF.80.E6.B4.BB_network-online.target"></span><span class="mw-headline" id="激活_network-online.target">激活 network-online.target</span>
</h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/status</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
ExecUpPost="systemctl start network-online.target"
ExecDownPre="systemctl stop network-online.target"
</pre>	
<p>Using this, systemd services requiring an active network connection can be <a href="../en/Systemd.html#Handling_dependencies" title="Systemd">ordered</a> to start only after the <code>network-online.target</code> is reached, and can be stopped before the connection is brought down. 
</p>
<h5>
<span id=".E8.AE.BE.E7.BD.AE.E9.BB.98.E8.AE.A4_DHCP_.E5.AE.A2.E6.88.B7.E7.AB.AF"></span><span class="mw-headline" id="设置默认_DHCP_客户端">设置默认 DHCP 客户端</span>
</h5>
<p>To set or change the DHCP client used for all profiles: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/hooks/dhcp</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
DHCPClient='dhclient'
</pre>
<p>Alternatively, it may also be specified for a specific network interface by creating an executable file <code>/etc/netctl/interfaces/&lt;interface&gt;</code> with the following line:
</p>
<pre>DHCPClient='dhclient'
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> It would be useful to replace the example with a general hook that executes different actions depending on <code>$ACTION</code> being CONNECT and DISCONNECT. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Netctl_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:Netctl (简体中文)#</a>)</div>
</div>
<h2>
<span id=".E6.8E.92.E9.94.99"></span><span class="mw-headline" id="排错">排错</span>
</h2>
<h3>
<span id="Job_for_netctl.40wlan.28....29.service_failed"></span><span class="mw-headline" id="Job_for_netctl@wlan(...).service_failed">Job for netctl@wlan(...).service failed</span>
</h3>
<p>Some people have an issue when they connect to a network with <i>netctl</i>, for example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># netctl start wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Job for netctl@wlan0\x2ssid.service failed. See 'systemctl status netctl@wlan0\x2ssid.service' and 'journalctl -xn' for details.
</pre>
<p>When then looking at <code>journalctl -xn</code>, either of the following are shown:
</p>
<p>1. If your device (<code>wlan0</code> in this case) is up:
</p>
<pre>network[2322]: The interface of network profile 'wlan0-ssid' is already up
</pre>
<p>Setting the interface down should resolve the problem:
</p>
<pre># ip link set wlan0 down
</pre>
<p>Then retry:
</p>
<pre># netctl start wlan0-ssid
</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> The following is an unsolved issue, using different DHCP client is just a poor/unexplained workaround. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Netctl_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:Netctl (简体中文)#</a>)</div>
</div>
<p>2. If it is down:
</p>
<pre>dhcpcd[261]: wlan0: ipv4_sendrawpacket: Network is down
</pre>
<p>One way to solve this is to use a different DHCP client, for example <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>. After installing the package configure <i>netctl</i> to use it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
DHCPClient='dhclient'
</pre>
<p>Adding the <code>ForceConnect</code> option may also be helpful:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/wlan0-ssid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

...

ForceConnect=yes
</pre>
<p>Save it and try to connect with the profile:
</p>
<pre># netctl start wlan0-ssid
</pre>
<h3><span class="mw-headline" id="dhcpcd:_ipv4_addroute:_File_exists">dhcpcd: ipv4_addroute: File exists</span></h3>
<p>On some systems dhcpcd in combination with netctl causes timeout issues on resume, particularly when having switched networks in the meantime. netctl will report that you are successfully connected but you still receive timeout issues. In this case, the old default route still exists and is not being renewed. A workaround to avoid this misbehaviour is to switch to <a href="#Set_default_DHCP_client">dhclient</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> as the default dhcp client. More information on the issue can be found <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1399842#p1399842">here</a>.
</p>
<h3><span class="mw-headline" id="DHCP_timeout_issues">DHCP timeout issues</span></h3>
<p>If you are having timeout issues when requesting leases via DHCP you can set the timeout value higher than netctl's 30 seconds by default. Create a file in <code>/etc/netctl/hooks/</code> or <code>/etc/netctl/interfaces/</code>, add <code>TimeoutDHCP=40</code> to it for a timeout of 40 seconds and make the file executable.
</p>
<h3><span class="mw-headline" id="Connection_timeout_issues">Connection timeout issues</span></h3>
<p>If you are having timeout issues that are unrelated to DHCP (on a static ethernet connection for example), and are experiencing errors similar to the following when starting your profile:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># journalctl _SYSTEMD_UNIT=netctl@<i>profile</i>.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Starting network profile '<i>profile</i>'...
No connection found on interface 'eth0' (timeout)
Failed to bring the network up for profile '<i>profile</i>'
</pre>
<p>Then you should increase carrier and up timeouts by adding <code>TimeoutUp=</code> and <code>TimeoutCarrier=</code> to your profile file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/<i>profile</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
TimeoutUp=300
TimeoutCarrier=300
</pre>
<p>Do not forget to reenable your profile:
</p>
<pre># netctl reenable <i>profile</i>
</pre>
<h3><span class="mw-headline" id="Problems_with_netctl-auto_on_resume">Problems with netctl-auto on resume</span></h3>
<p>Sometimes <i>netctl-auto</i> fails to reconnect when the system resumes from suspend. An easy solution is to restart the service for <i>netctl-auto</i>. 
This can be automated with an additional service like the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/netctl-auto-resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=restart netctl-auto on resume.
Requisite=netctl-auto@%i.service
After=suspend.target

[Service]
Type=oneshot
ExecStart=/usr/bin/systemctl restart netctl-auto@%i.service

[Install]
WantedBy=suspend.target
</pre>
<p>To <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> this service for your wireless card, for example, enable <code>netctl-auto-resume@wlan0.service</code> as root. Change <code>wlan0</code> to the required network interface.
</p>
<p>If the device is not yet running on resume when the unit is started, this will fail. It can be fixed by adding the following dependency in the <i>After</i> line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/netctl-auto-resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
After=suspend.target sys-subsystem-net-devices-%i.device
...
</pre>
<h3><span class="mw-headline" id="netctl-auto_suddenly_stopped_working_for_WiFi_adapters">netctl-auto suddenly stopped working for WiFi adapters</span></h3>
<p>This problem seems to be related to a recent wpa_supplicant update (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/44731">FS#44731</a>), but a work-around is quite trivial. Just create a file for your interface (e.g. wlp3s0) in /etc/netctl/interfaces with the following content and make it executable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/netctl/interfaces/wlp3s0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WPAOptions="-m ''"
</pre>
<p>After that, try to restart your netctl-auto service and WiFi auto detection should work well again.
</p>
<h3><span class="mw-headline" id="netctl-auto_does_not_automatically_unblock_a_wireless_card_to_use_an_interface">netctl-auto does not automatically unblock a wireless card to use an interface</span></h3>
<p>Many laptops have a hardware button (or switch) to turn off wireless card, however, the card can also be blocked by the kernel. This can be handled by <a href="../en/Network_configuration/Wireless.html#Rfkill_caveat" class="mw-redirect" title="Rfkill">rfkill</a>.
</p>
<p>If you want <i>netctl-auto</i> to automatically unblock your wireless card to connect to a particular network, set <code>RFKill=++auto++</code> option for the wireless connection of your choice, as specified in the <a rel="nofollow" class="external text" href="https://github.com/joukewitteveen/netctl/blob/master/docs/netctl.profile.5.txt">netctl.profile(5)</a> man page.
</p>
<h3>
<span id="RTNETLINK_answers:_File_exists_.28with_multiple_NICs.29"></span><span class="mw-headline" id="RTNETLINK_answers:_File_exists_(with_multiple_NICs)">RTNETLINK answers: File exists (with multiple NICs)</span>
</h3>
<p>This is a very misleading response, it really means that you have assigned a default gateway in an earlier netctl control file. When netctl starts up the n-th NIC and goes to set its local route, it fails because there is already a default route from n-1.
</p>
<p>Remove it and everything works, except you no longer have a default route and so cannot access things such as the internet. <code>ExecUpPost</code> does not work as it gets executed for each network card.
</p>
<p>A possible solution is creating a new service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/defaultrouter.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description
Requires=netctl.service
After=netctl.service
Before=ntpd.service,dnsmasq.service

[Service]
Type=oneshot
ExecStart=/usr/bin/ip route add default via 192.168.xxx.yyy</pre>
<h2>
<span id=".E5.8F.82.E8.A7.81"></span><span class="mw-headline" id="参见">参见</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://lists.archlinux.org/pipermail/arch-projects/2012-December/003473.html">Initial mailing list announcement</a></li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=157670">官方陈述页面</a></li>
<li>在AUR中有一个可用的cinnamon applet: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cinnamon-applet-netctl-systray-menu/">cinnamon-applet-netctl-systray-menu</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>
</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:Network_managers.html" title="Category:Network managers (简体中文)">Network managers (简体中文)</a></li>
<li><a href="../zh-CN/Category:Arch_projects.html" title="Category:Arch projects (简体中文)">Arch projects (简体中文)</a></li>
<li><a href="../zh-CN/Category:Commands.html" title="Category:Commands (简体中文)">Commands (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Netctl_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=649052">https://wiki.archlinux.org/index.php?title=Netctl_(简体中文)&amp;oldid=649052</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 16 January 2021, at 17:18.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
