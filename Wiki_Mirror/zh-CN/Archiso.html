<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Archiso (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Archiso_简体中文 rootpage-Archiso_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Archiso (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="/title/Archiso" title="Archiso">Archiso</a> 的<a href="/title/ArchWiki:Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2020-05-02。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Archiso&amp;diff=0&amp;oldid=608987">更改</a>，则您可以帮助同步翻译。</div>
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="/title/Remastering_the_Install_ISO" class="mw-redirect" title="Remastering the Install ISO">Remastering the Install ISO</a></li>
<li><a href="/title/PXE_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="PXE (简体中文)">PXE</a></li>
<li><a href="/title/Archboot_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Archboot (简体中文)">Archboot</a></li>
</ul>
</div>
<p><b>Archiso</b> 是用于构建 Arch Linux Live CD ISO 映像的工具。 <a rel="nofollow" class="external text" href="https://archlinux.org/download/">官方映像</a> 是使用 Archiso 构建的。 Archiso 是可配置的，并且可以用作不同系统的基础，例如救援系统或 Linux 安装程序。 这篇 Wiki 文章介绍了如何安装 Archiso，以及如何配置它以控制生成的 ISO 映像的各个方面，例如随附的软件包和文件。 技术需求和构建步骤可以在 <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/tree/master/docs">官方项目文档</a> 中找到。 Archiso 通过许多 bash 脚本实现。 Archiso 的核心组件是 <i>mkarchiso</i> 命令。 其选项记录在其用法输出中，此处未涉及。 用户不需要直接与 <i>mkarchiso</i> 交互。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="tocnumber">1</span> <span class="toctext">安装和配置</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E9%85%8D%E7%BD%AE_Live_%E4%BB%8B%E8%B4%A8"><span class="tocnumber">2</span> <span class="toctext">配置 Live 介质</span></a>
<ul>
<li class="toclevel-2 tocsection-3">
<a href="#%E5%AE%89%E8%A3%85%E5%8C%85"><span class="tocnumber">2.1</span> <span class="toctext">安装包</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%AC%E5%9C%B0%E5%BA%93"><span class="tocnumber">2.1.1</span> <span class="toctext">自定义本地库</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#%E5%AE%89%E8%A3%85_multilib_%E4%B8%AD%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">2.1.2</span> <span class="toctext">安装 multilib 中的软件包</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#%E5%90%91%E6%98%A0%E5%83%8F%E9%87%8C%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2</span> <span class="toctext">向映像里添加文件</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#%E5%86%85%E6%A0%B8"><span class="tocnumber">2.3</span> <span class="toctext">内核</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#%E5%BC%95%E5%AF%BC%E5%99%A8"><span class="tocnumber">2.4</span> <span class="toctext">引导器</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#UEFI_%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8"><span class="tocnumber">2.4.1</span> <span class="toctext">UEFI 安全启动</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#%E7%99%BB%E5%BD%95%E7%AE%A1%E7%90%86%E5%99%A8"><span class="tocnumber">2.5</span> <span class="toctext">登录管理器</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E6%94%B9%E5%8F%98%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95"><span class="tocnumber">2.6</span> <span class="toctext">改变自动登录</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%E6%9E%84%E5%BB%BAISO"><span class="tocnumber">3</span> <span class="toctext">构建ISO</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#%E9%87%8D%E5%BB%BAISO"><span class="tocnumber">3.1</span> <span class="toctext">重建ISO</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E5%88%A0%E9%99%A4%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="tocnumber">3.2</span> <span class="toctext">删除工作目录</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#%E4%BD%BF%E7%94%A8_ISO"><span class="tocnumber">4</span> <span class="toctext">使用 ISO</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#%E5%9C%A8_QEMU_%E4%B8%AD%E8%BF%90%E8%A1%8C_ISO"><span class="tocnumber">5</span> <span class="toctext">在 QEMU 中运行 ISO</span></a></li>
<li class="toclevel-1 tocsection-17">
<a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">6</span> <span class="toctext">参阅</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#%E6%96%87%E6%A1%A3%E5%92%8C%E6%95%99%E7%A8%8B"><span class="tocnumber">6.1</span> <span class="toctext">文档和教程</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#%E7%A4%BA%E4%BE%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF"><span class="tocnumber">6.2</span> <span class="toctext">示例自定义模板</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#%E5%88%9B%E5%BB%BA%E8%84%B1%E6%9C%BA%E5%AE%89%E8%A3%85_ISO"><span class="tocnumber">6.3</span> <span class="toctext">创建脱机安装 ISO</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#%E6%9F%A5%E6%89%BE%E4%BB%A5%E5%89%8D%E7%89%88%E6%9C%AC%E7%9A%84_ISO_%E6%98%A0%E5%83%8F"><span class="tocnumber">6.4</span> <span class="toctext">查找以前版本的 ISO 映像</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85.E5.92.8C.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="安装和配置">安装和配置</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 以下操作请在ROOT权限下使用，在错误的权限下操作会造成问题。</div>
<p><a href="/title/Install" class="mw-redirect" title="Install">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archiso">archiso</a></span> 或 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archiso-git/">archiso-git</a></span><sup><small>AUR</small></sup>。
</p>
<p>Archiso 附带2个预定义配置（profiles）: <i>releng</i> 和<i>baseline</i>。
</p>
<ul><li>
<i>releng</i>用于创建正式的每月安装ISO。它可以作为创建自定义ISO映像的起点。</li></ul>
<ul><li>
<i>baseline</i>是一种最低限度的配置，它只包括从介质启动实时环境所需的最低限度的软件包。</li></ul>
<p>使用以下命令将您选择的配置文件复制到目录中。 用 <code>releng</code> 或 <code>baseline</code> 替换 <code><b>profile</b></code>，并用你选择的目录名称替换 <code><i>archlive</i></code>。
</p>
<pre># cp -r /usr/share/archiso/configs/<b>profile</b> <i>archlive</i>
</pre>
<p>现在，根据所选的配置文件和您的目标进入不同的章节。
</p>
<ul>
<li>
<i>releng</i>：如果您选择了 <i>releng</i> ，并且
<ul>
<li>如果要自定义映像，请继续进行章节 <a href="#%E9%85%8D%E7%BD%AE_Live_%E4%BB%8B%E8%B4%A8">#配置 Live 介质</a>。</li>
<li>如果要复制官方映像，请继续进行 <a href="#%E6%9E%84%E5%BB%BAISO">#构建ISO</a>。</li>
</ul>
</li>
<li>
<i>baseline</i>：如果您选择了 <i>baseline</i> 配置文件，请继续进行 <a href="#%E6%9E%84%E5%BB%BAISO">#构建ISO</a>。</li>
</ul>
<h2>
<span id=".E9.85.8D.E7.BD.AE_Live_.E4.BB.8B.E8.B4.A8"></span><span class="mw-headline" id="配置_Live_介质">配置 Live 介质</span>
</h2>
<p>本节详细介绍如何配置映像，以及定义以后将复制到映像的软件包和配置。
</p>
<p>在 <a href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE">#安装和配置</a> 中创建的<code><i>archlive</i></code>目录中有许多文件和目录; 我们只关注以下的：
</p>
<ul>
<li>
<code>packages.x86_64</code> - 此文件列出了 Live 系统映像上安装的软件包。</li>
<li>
<code>airootfs</code> - 此目录用作覆盖，并允许您进行自定义。</li>
</ul>
<p>您可以通过编辑 <code><i>archlive</i>/airootfs/root/customize_airootfs.sh</code> 来编写遵循安装指南（或安装后）的所有管理任务的脚本，除了软件包安装。该脚本是从正在运行的 Live 系统的角度编写的，即，在脚本中，路径 <code>/</code> 是指正在运行的 Live 系统的根目录。
</p>
<h3>
<span id=".E5.AE.89.E8.A3.85.E5.8C.85"></span><span class="mw-headline" id="安装包">安装包</span>
</h3>
<p>编辑 <code>packages.x86_64</code> 中的软件包列表，以配置将哪些软件包安装在 Live 系统映像上，逐行列出软件包。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果要在 Live CD 中使用 <a href="/title/%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86%E5%99%A8" class="mw-redirect" title="窗口管理器">窗口管理器</a>，则必须添加必要且正确的 <a href="/title/Video_drivers" class="mw-redirect" title="Video drivers">video drivers</a>，否则 WM 可能在加载时冻结。</div>
<h4>
<span id=".E8.87.AA.E5.AE.9A.E4.B9.89.E6.9C.AC.E5.9C.B0.E5.BA.93"></span><span class="mw-headline" id="自定义本地库">自定义本地库</span>
</h4>
<p>为了准备自定义软件包或从 <a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a>/<a href="/title/ABS" class="mw-redirect" title="ABS">ABS</a> 准备软件包，您还可以 <a href="/title/Pacman/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E8%87%AA%E5%BB%BA%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93" class="mw-redirect" title="Pacman/Tips and tricks (简体中文)">自建本地仓库</a>。
</p>
<p>然后，您可以将以下内容放入 <code>~/archlive/pacman.conf</code> 中，添加到其他仓库条目上方（最高优先级）：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/archlive/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# custom repository
[customrepo]
SigLevel = Optional TrustAll
Server = file:///home/<b>user</b>/customrepo/$arch
...</pre>
<h4>
<span id=".E5.AE.89.E8.A3.85_multilib_.E4.B8.AD.E7.9A.84.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="安装_multilib_中的软件包">安装 multilib 中的软件包</span>
</h4>
<p>要从 <a href="/title/Multilib_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="Multilib (简体中文)">Multilib</a> 资源库中安装软件包，仅需在<code>~/archlive/pacman.conf</code>中取消注释以下行以启用 <i>multilib</i>：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[multilib]
SigLevel = PackageRequired
Include = /etc/pacman.d/mirrorlist</pre>
<h3>
<span id=".E5.90.91.E6.98.A0.E5.83.8F.E9.87.8C.E6.B7.BB.E5.8A.A0.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="向映像里添加文件">向映像里添加文件</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 你必须使用 root 权限来完成这件事，不要改变任何你复制过来的文件的所有权，airootfs 中的<b>所有</b>文件必须为 root 用户所有。适当的所有制将在不久被解决。</div>
<p>airootfs 目录作为要覆盖的文件，把它看作是在当前系统上的根目录'/'，所以你在这个目录中放置的任何文件都将在开机时被复制。
</p>
<p>所以，如果你在当前系统上有一组 iptables 脚本且想要在 Live 映像上使用，请这样复制:
</p>
<pre># cp -r /etc/iptables ~/archlive/airootfs/etc
</pre>
<p>在用户 home 文件夹里放置文件的方法有些许不同。不要把它们放在 <code>airootfs/home</code>，而是在 airootfs/ 里创建 skel 目录并将其放置在那里。然后我们会将相关命令添加到 <code>customize_airootfs.sh</code>——我们要使用它在引导时复制文件以及梳理权限。
</p>
<p>首先，创建 skel 目录
</p>
<pre># mkdir ~/archlive/airootfs/etc/skel
</pre>
<p>现在，复制 'home' 的文件到 skel 目录。例如，对于 <code>.bashrc</code>：
</p>
<pre># cp ~/.bashrc ~/archlive/airootfs/etc/skel/
</pre>
<p>当 <code>~/archlive/airootfs/root/customize_airootfs.sh</code> 被执行，并且一个新用户已被创建, skel 目录中的文件将自动被复制到新的 home 文件夹中，并被设置正确的权限。
</p>
<p>类似地，需要注意位于层次结构下方的特殊配置文件。作为示例，配置文件 <code>/etc/X11/xinit/xinitrc</code> 位于可能被安装包覆盖的路径上。要将 <code>xinitrc</code> 的配置文件放在 <code>~/archlive/airootfs/etc/skel/</code> ，然后修改 <code>customize_airootfs.sh</code> 以适当地移动。
</p>
<h3>
<span id=".E5.86.85.E6.A0.B8"></span><span class="mw-headline" id="内核">内核</span>
</h3>
<p>默认archiso使用linux内核和模块，但创建的ISO映像文件可以包含其他或多重内核。
首先，编辑<code>packages.x86_64</code>，将想要的内核包名写入，<i>mkarchiso</i>运行时会将映像（以及用于UEFI引导的FAT映像）<code><i>work_dir</i>/airootfs/boot/vmlinuz-*</code>和<code><i>work_dir</i>/boot/initramfs-*.img</code>中的所有文件导入。
默认的<a href="/title/Mkinitcpio" title="Mkinitcpio">mkinitcpio</a>将构建fallback镜像。对于映像文件，主initramfs镜像不包含<b>autodetect</b>钩子拓展，因此没有必要创建一个额外的fallback镜像。
自定义替换<code><i>archlive</i>/airootfs/etc/mkinitcpio.d/<i>pkgbase</i>.preset</code>，以跳过不必要的创建，如<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/mkinitcpio.d/linux-lts.preset</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PRESETS=('archiso')

ALL_kver='/boot/vmlinuz-linux-lts'
ALL_config='/etc/mkinitcpio.conf'

archiso_image="/boot/initramfs-linux-lts.img"</pre>
<p>最后，创建<a href="#%E5%BC%95%E5%AF%BC%E5%99%A8">boot loader configuration</a>配置文件来启动内核。
</p>
<h3>
<span id=".E5.BC.95.E5.AF.BC.E5.99.A8"></span><span class="mw-headline" id="引导器">引导器</span>
</h3>
<p>默认的文件应该可以正常工作，所以你应该不需要去碰它。
</p>
<p>由于 isolinux 的模块化性质，你能够使用很多插件，因为所有 *.c32 都被复制且可以可供您使用。看看 <a rel="nofollow" class="external text" href="https://wiki.syslinux.org/wiki/index.php/SYSLINUX">syslinux 官方网站</a> 和 <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/tree/master/configs/releng/syslinux">Archiso Git Repo</a>。使用所述插件，便有可能做出更具视觉吸引力及复杂的菜单。参见 <a rel="nofollow" class="external text" href="https://wiki.syslinux.org/wiki/index.php/Comboot/menu.c32">此处</a>。
</p>
<h4>
<span id="UEFI_.E5.AE.89.E5.85.A8.E5.90.AF.E5.8A.A8"></span><span class="mw-headline" id="UEFI_安全启动">UEFI 安全启动</span>
</h4>
<p>如果要使 Archiso 在启用 UEFI 安全启动的环境下可启动，则必须使用签名过的启动加载程序。您可以按照 <a href="/title/Secure_Boot#Booting_an_installation_medium" class="mw-redirect" title="Secure Boot">Secure Boot#Booting an installation medium</a> 中的说明进行操作。
</p>
<h3>
<span id=".E7.99.BB.E5.BD.95.E7.AE.A1.E7.90.86.E5.99.A8"></span><span class="mw-headline" id="登录管理器">登录管理器</span>
</h3>
<p>通过启用您登录管理器的 <a href="/title/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Systemd (简体中文)">systemd</a> 服务来做到在引导时启动 X 。如果您知道哪一个 .service 文件需要软链接，那就太好了。如果不知道，你也可以轻松找出——如果你在创建 iso 所用的系统上使用相同的程序的话。只需使用：
</p>
<pre> $ ls -l /etc/systemd/system/display-manager.service
</pre>
<p>现在在 <code>~/archlive/airootfs/etc/systemd/system</code> 中创建相同的软链接。如 LXDM：
</p>
<pre># ln -s /usr/lib/systemd/system/lxdm.service ~/archlive/airootfs/etc/systemd/system/display-manager.service
</pre>
<p>这将使您在 live 系统启用在系统上启动 LXDM。(This will enable LXDM at system start on your live system.)
</p>
<p>或者，您也可以启用 <code>airootfs/root/customize_airootfs.sh</code> 中的服务以及其中启用的其他服务。
</p>
<p>如果您希望图形环境在启动过程中自动启动，请确保编辑 <code>airootfs/root/customize_airootfs.sh</code> 并替换
</p>
<pre>systemctl set-default multi-user.target
</pre>
<p>为
</p>
<pre>systemctl set-default graphical.target
</pre>
<h3>
<span id=".E6.94.B9.E5.8F.98.E8.87.AA.E5.8A.A8.E7.99.BB.E5.BD.95"></span><span class="mw-headline" id="改变自动登录">改变自动登录</span>
</h3>
<p>Getty 的自动登录配置位于 <code>airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf</code>。 
</p>
<p>您可以修改这个文件来更改自动登录用户：
</p>
<pre>[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin <b>isouser</b> --noclear %I 38400 linux
</pre>
<p>或者干脆删除它来禁用自动登录。
</p>
<h2>
<span id=".E6.9E.84.E5.BB.BAISO"></span><span class="mw-headline" id="构建ISO">构建ISO</span>
</h2>
<p>现在，你已经准备好把你的文件转换成 .iso，以便可以刻录到 CD 或 USB。
</p>
<p>在 <code>~/archlive</code> 中执行：
</p>
<pre># mkarchiso -v -w /path/to/work_dir -o /path/to/out_dir /path/to/profile/
</pre>
<ul>
<li>
<code>-w</code> 指定工作目录。如果未指定该选项，它将默认在当前目录中工作。</li>
<li>
<code>-o</code> 指定将放置生成的ISO映像的目录。如果未指定该选项，则默认为在当前目录中输出。</li>
<li>应该注意配置文件<code>profiledef.sh</code>运行mkarchiso时无法指定，只能指定文件的路径。</li>
</ul>
<p>如果您正在构建未修改的概要文件或自定义概要文件的路径，请将/path/to/profile/替换为/usr/share/archiso/configs/releng/。
</p>
<p>该脚本将现在下载并安装你指定的软件包到 <code>work/*/airootfs</code>，创建内核和 init 映像（initramfs），应用您的修改，并最终把 ISO 建立到 <code>out/</code>。
</p>
<h3>
<span id=".E9.87.8D.E5.BB.BAISO"></span><span class="mw-headline" id="重建ISO">重建ISO</span>
</h3>
<p>在修改之后重建 ISO 不被官方支持。但是，通过应用两个步骤很容易。首先，您必须删除工作目录中的锁定文件：
</p>
<pre># rm -v work/build.make_*
</pre>
<p>如果您编辑了 <code>airootfs/root/customize_airootfs.sh</code>以创建非特权用户，则重建将在创建时失败，因为该用户已经存在（<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/41865">FS#41865</a>）。 为避免此问题，您需要在运行 <code>useradd</code> 之前检查用户是否存在，例如 通过运行 <code>id</code>：
</p>
<pre>! id arch &amp;&amp; useradd -m -p "" -g users -G "adm,audio,floppy,log,network,rfkill,scanner,storage,optical,power,wheel" -s /usr/bin/zsh arch
</pre>
<p>同时删除创建的用户或符号链接，如 <code>/etc/sudoers</code> 等持久性数据。
</p>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="/title/File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> 报告需要删除或重置的更多数据。 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Archiso_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:Archiso (简体中文)#</a>)</div>
</div>
<p>通过编辑 pacstrap 脚本（位于 /bin/pacstrap）并在第 361 行更改以下内容，可以稍微加快重建速度：
</p>
<p>修改前:
</p>
<pre>if ! pacman -r "$newroot" -Sy "${pacman_args[@]}"; then
</pre>
<p>修改后:
</p>
<pre>if ! pacman -r "$newroot" -Sy --needed "${pacman_args[@]}"; then
</pre>
<p>这增加了初始引导的速度，因为它不必下载和安装任何已经安装的基础包。
</p>
<h3>
<span id=".E5.88.A0.E9.99.A4.E5.B7.A5.E4.BD.9C.E7.9B.AE.E5.BD.95"></span><span class="mw-headline" id="删除工作目录">删除工作目录</span>
</h3>
<p>临时文件将复制到工作目录中。 如果碰巧 build.sh 脚本被中断，请确保在删除之前没有 mount binds - 否则，您可能会丢失数据（例如，安装在 <code>/run/media/$user/$label</code> 的外部设备在构建过程中被绑定在 <code>work/x86_64/airootfs/run/media/$user/$label</code> 中。
</p>
<h2>
<span id=".E4.BD.BF.E7.94.A8_ISO"></span><span class="mw-headline" id="使用_ISO">使用 ISO</span>
</h2>
<p>有关各种选项，请参见 <a href="/title/Installation_guide_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%90%AF%E5%8A%A8%E5%88%B0_Live_%E7%8E%AF%E5%A2%83" title="Installation guide (简体中文)">Installation guide (简体中文)#启动到 Live 环境</a>。
</p>
<h2>
<span id=".E5.9C.A8_QEMU_.E4.B8.AD.E8.BF.90.E8.A1.8C_ISO"></span><span class="mw-headline" id="在_QEMU_中运行_ISO">在 QEMU 中运行 ISO</span>
</h2>
<pre> qemu-system-x86_64 \
   -accel kvm \
   -boot order=d,menu=on,reboot-timeout=5000 \
   -m size=3072,slots=0,maxmem=$((3072*1024*1024)) \
   -k en \
   -name archiso,process=archiso_0 \
   -drive file=/path/to/archlinux-yyyy.mm.dd-x86_64.iso,media=cdrom,readonly=on \
   -display sdl \
   -vga virtio \
   -enable-kvm \
   -no-reboot \
   -no-shutdown
</pre>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<h3>
<span id=".E6.96.87.E6.A1.A3.E5.92.8C.E6.95.99.E7.A8.8B"></span><span class="mw-headline" id="文档和教程">文档和教程</span>
</h3>
<ul>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso">Archiso 项目页面</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/tree/master/docs">官方文档</a></li>
</ul>
<h3>
<span id=".E7.A4.BA.E4.BE.8B.E8.87.AA.E5.AE.9A.E4.B9.89.E6.A8.A1.E6.9D.BF"></span><span class="mw-headline" id="示例自定义模板">示例自定义模板</span>
</h3>
<ul><li><a rel="nofollow" class="external text" href="http://easy.open.and.free.fr/didjix/">A live DJ distribution powered by ArchLinux and built with Archiso</a></li></ul>
<h3>
<span id=".E5.88.9B.E5.BB.BA.E8.84.B1.E6.9C.BA.E5.AE.89.E8.A3.85_ISO"></span><span class="mw-headline" id="创建脱机安装_ISO">创建脱机安装 ISO</span>
</h3>
<ul><li><a href="/index.php?title=Archiso_offline&amp;action=edit&amp;redlink=1" class="new" title="Archiso offline (page does not exist)">Archiso offline</a></li></ul>
<h3>
<span id=".E6.9F.A5.E6.89.BE.E4.BB.A5.E5.89.8D.E7.89.88.E6.9C.AC.E7.9A.84_ISO_.E6.98.A0.E5.83.8F"></span><span class="mw-headline" id="查找以前版本的_ISO_映像">查找以前版本的 ISO 映像</span>
</h3>
<ul><li><a href="/title/Arch_Linux_Archive" title="Arch Linux Archive">Arch Linux Archive</a></li></ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Categories</a>: <ul>
<li><a href="/title/Category:Live_Arch_systems_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Live Arch systems (简体中文)">Live Arch systems (简体中文)</a></li>
<li><a href="/title/Category:Installation_process_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Installation process (简体中文)">Installation process (简体中文)</a></li>
<li><a href="/title/Category:Arch_projects_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Arch projects (简体中文)">Arch projects (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Expansion" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Archiso_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=668430">https://wiki.archlinux.org/index.php?title=Archiso_(简体中文)&amp;oldid=668430</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 8 May 2021, at 06:20.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
