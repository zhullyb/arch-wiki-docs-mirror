<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd-networkd (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd-networkd_简体中文 rootpage-Systemd-networkd_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">systemd-networkd (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="/title/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Systemd (简体中文)">systemd (简体中文)</a></li>
<li><a href="/title/Systemd-resolved" title="Systemd-resolved">systemd-resolved</a></li>
<li><a href="/title/Systemd-nspawn" title="Systemd-nspawn">systemd-nspawn</a></li>
<li><a href="/title/Network_bridge_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Network bridge (简体中文)">Network bridge (简体中文)</a></li>
<li><a href="/title/Network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Network configuration (简体中文)">Network configuration (简体中文)</a></li>
<li><a href="/title/Wireless_network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="Wireless network configuration (简体中文)">Wireless network configuration (简体中文)</a></li>
<li><a href="/title/Category:Network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Network configuration (简体中文)">Category:Network configuration (简体中文)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="/title/Systemd-networkd" title="Systemd-networkd">Systemd-networkd</a> 的<a href="/title/ArchWiki:Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2020-06-25。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Systemd-networkd&amp;diff=0&amp;oldid=620567">更改</a>，则您可以帮助同步翻译。</div>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本文或本节需要<a href="/title/ArchWiki:Contributing_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E7%BF%BB%E8%AF%91" title="ArchWiki:Contributing (简体中文)">翻译</a>。要贡献翻译，请访问<a href="/title/ArchWiki_Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>附注：</b> 请持续完成翻译。（在 <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:Systemd-networkd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:Systemd-networkd (简体中文)#</a> 中讨论）</div>
</div>
<p><i>systemd-networkd</i> 是一个管理网络配置的系统守护进程。它会在网络设备出现时检测和配置；它还可以创建虚拟网络设备。这个服务对被 <a href="/title/Systemd-nspawn" title="Systemd-nspawn">systemd-nspawn</a> 管理的容器或者虚拟机的复杂网络配置尤其有用，同样也适用于简单的网络配置。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="tocnumber">1</span> <span class="toctext">基本用法</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E5%BF%85%E9%9C%80%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%92%8C%E8%AE%BE%E7%BD%AE"><span class="tocnumber">1.1</span> <span class="toctext">必需的服务和设置</span></a></li>
<li class="toclevel-2 tocsection-3">
<a href="#%E9%85%8D%E7%BD%AE%E6%A0%B7%E4%BE%8B"><span class="tocnumber">1.2</span> <span class="toctext">配置样例</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#%E4%BD%BF%E7%94%A8_DHCP_%E7%9A%84%E6%9C%89%E7%BA%BF%E9%80%82%E9%85%8D%E5%99%A8"><span class="tocnumber">1.2.1</span> <span class="toctext">使用 DHCP 的有线适配器</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81_IP_%E7%9A%84%E6%9C%89%E7%BA%BF%E9%80%82%E9%85%8D%E5%99%A8"><span class="tocnumber">1.2.2</span> <span class="toctext">使用静态 IP 的有线适配器</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#%E6%97%A0%E7%BA%BF%E9%80%82%E9%85%8D%E5%99%A8"><span class="tocnumber">1.2.3</span> <span class="toctext">无线适配器</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%E7%9A%84%E6%9C%89%E7%BA%BF%E5%92%8C%E6%97%A0%E7%BA%BF%E9%80%82%E9%85%8D%E5%99%A8"><span class="tocnumber">1.2.4</span> <span class="toctext">同一台机器上的有线和无线适配器</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%91%BD%E5%90%8D"><span class="tocnumber">1.2.5</span> <span class="toctext">网络接口重命名</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9">
<a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">2</span> <span class="toctext">配置文件</span></a>
<ul>
<li class="toclevel-2 tocsection-10">
<a href="#network_%E6%96%87%E4%BB%B6"><span class="tocnumber">2.1</span> <span class="toctext">network 文件</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#%5BMatch%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.1</span> <span class="toctext">[Match] 小节</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#%5BLink%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.2</span> <span class="toctext">[Link] 小节</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#%5BNetwork%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.3</span> <span class="toctext">[Network] 小节</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#%5BAddress%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.4</span> <span class="toctext">[Address] 小节</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#%5BRoute%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.5</span> <span class="toctext">[Route] 小节</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#%5BDHCP%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.1.6</span> <span class="toctext">[DHCP] 小节</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17">
<a href="#netdev_%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2</span> <span class="toctext">netdev 文件</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#%5BMatch%5D_%E5%B0%8F%E8%8A%82_2"><span class="tocnumber">2.2.1</span> <span class="toctext">[Match] 小节</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#%5BNetDev%5D_%E5%B0%8F%E8%8A%82"><span class="tocnumber">2.2.2</span> <span class="toctext">[NetDev] 小节</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20">
<a href="#link_%E6%96%87%E4%BB%B6"><span class="tocnumber">2.3</span> <span class="toctext">link 文件</span></a>
<ul>
<li class="toclevel-3 tocsection-21"><a href="#%5BMatch%5D_%E5%B0%8F%E8%8A%82_3"><span class="tocnumber">2.3.1</span> <span class="toctext">[Match] 小节</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#%5BLink%5D_%E5%B0%8F%E8%8A%82_2"><span class="tocnumber">2.3.2</span> <span class="toctext">[Link] 小节</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-23">
<a href="#%E5%AE%B9%E5%99%A8%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8"><span class="tocnumber">3</span> <span class="toctext">容器下的应用</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#%E5%9F%BA%E6%9C%AC_DHCP_%E7%BD%91%E7%BB%9C"><span class="tocnumber">3.1</span> <span class="toctext">基本 DHCP 网络</span></a></li>
<li class="toclevel-2 tocsection-25">
<a href="#DHCP_%E7%94%A8%E4%BA%8E%E4%B8%A4%E4%B8%AA%E7%8B%AC%E7%AB%8B_IP"><span class="tocnumber">3.2</span> <span class="toctext">DHCP 用于两个独立 IP</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#%E6%A1%A5%E6%8E%A5%E7%AB%AF%E5%8F%A3"><span class="tocnumber">3.2.1</span> <span class="toctext">桥接端口</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#%E7%BB%91%E5%AE%9A%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%88%B0%E6%A1%A5%E6%8E%A5%E7%AB%AF%E5%8F%A3"><span class="tocnumber">3.2.2</span> <span class="toctext">绑定以太网到桥接端口</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C"><span class="tocnumber">3.2.3</span> <span class="toctext">桥接网络</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#%E6%B7%BB%E5%8A%A0%E9%80%89%E9%A1%B9%E4%BB%A5%E5%BC%95%E5%AF%BC%E5%AE%B9%E5%99%A8"><span class="tocnumber">3.2.4</span> <span class="toctext">添加选项以引导容器</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#%E6%88%90%E6%9E%9C"><span class="tocnumber">3.2.5</span> <span class="toctext">成果</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="#%E6%B3%A8%E6%84%8F"><span class="tocnumber">3.2.6</span> <span class="toctext">注意</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-32"><a href="#%E9%9D%99%E6%80%81_IP_%E7%BD%91%E7%BB%9C"><span class="tocnumber">3.3</span> <span class="toctext">静态 IP 网络</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#%E4%BA%A4%E4%BA%92%E7%95%8C%E9%9D%A2%E5%8F%8A%E6%A1%8C%E9%9D%A2%E9%9B%86%E6%88%90"><span class="tocnumber">4</span> <span class="toctext">交互界面及桌面集成</span></a></li>
<li class="toclevel-1 tocsection-34">
<a href="#%E6%8E%92%E9%94%99"><span class="tocnumber">5</span> <span class="toctext">排错</span></a>
<ul>
<li class="toclevel-2 tocsection-35"><a href="#%E5%BC%95%E5%AF%BC%E6%97%B6%E7%9A%84%E2%80%9C%E6%8C%82%E8%BD%BD%E2%80%9D%E6%9C%8D%E5%8A%A1%E5%A4%B1%E8%B4%A5"><span class="tocnumber">5.1</span> <span class="toctext">引导时的“挂载”服务失败</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#systemd-resolve_%E4%B8%8D%E6%90%9C%E7%B4%A2%E6%9C%AC%E5%9C%B0%E5%9F%9F"><span class="tocnumber">5.2</span> <span class="toctext">systemd-resolve 不搜索本地域</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#Connected_second_PC_unable_to_use_bridged_LAN"><span class="tocnumber">5.3</span> <span class="toctext">Connected second PC unable to use bridged LAN</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-38"><a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">6</span> <span class="toctext">参阅</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.9F.BA.E6.9C.AC.E7.94.A8.E6.B3.95"></span><span class="mw-headline" id="基本用法">基本用法</span>
</h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> 是默认 Arch 安装的一部分，包含操作有线网络所需的所有文件。无线适配器可以通过其他服务（比如 <a href="/title/Wpa_supplicant" title="Wpa supplicant">wpa_supplicant</a> 或者 <a href="/title/Iwd" title="Iwd">iwd</a>）来配置，本文后面的部分也会介绍相关内容。
</p>
<h3>
<span id=".E5.BF.85.E9.9C.80.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.92.8C.E8.AE.BE.E7.BD.AE"></span><span class="mw-headline" id="必需的服务和设置">必需的服务和设置</span>
</h3>
<p><a href="/title/Start/enable" class="mw-redirect" title="Start/enable">start/enable</a> <code>systemd-networkd.service</code> 以使用 <i>systemd-networkd</i>。
</p>
<p><a href="/title/Start/enable" class="mw-redirect" title="Start/enable">start/enable</a> <code>systemd-resolved.service</code> 是可选的，它为本地应用程序提供网络名称（DNS）解析服务。是否使用它可以考虑下面几条：
</p>
<ul>
<li>如果 <i>.network</i> 文件中指定了 DNS 条目，<a href="/title/Systemd-resolved" title="Systemd-resolved">systemd-resolved</a> 服务是必需的</li>
<li>它能够自动地从 DHCP 客户端获取 DNS 地址</li>
<li>请搞明白 <a href="/title/Resolv.conf" class="mw-redirect" title="Resolv.conf">resolv.conf</a> 和 <i>systemd-resolved</i> 如何互相影响，以便正确配置要使用的 DNS 服务器。更多相关信息可以参见 <a href="/title/Systemd-resolved" title="Systemd-resolved">systemd-resolved</a>
</li>
<li>注意：即使没有启用 <i>systemd-networkd</i>， <i>systemd-resolved</i> 也能够提供服务。</li>
</ul>
<h3>
<span id=".E9.85.8D.E7.BD.AE.E6.A0.B7.E4.BE.8B"></span><span class="mw-headline" id="配置样例">配置样例</span>
</h3>
<p>在本节中，所有配置都存储为在 <code>/etc/systemd/network/</code> 目录下 形如 <code>foo.network</code> 的文件。有关选项的完整列表和处理顺序可以参考 <a href="#Configuration_files">#Configuration files</a><sup>[<a href="/title/ArchWiki:Requests#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> 和 <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span>。
</p>
<p>Systemd/udev 会自动为所有本地以太网，WLAN 和 WWAN 接口分配可预测，稳定的网络接口名。使用 <code>networkctl list</code> 以列出系统上所有设备。
</p>
<p>在修改了配置文件之后，<a href="/title/Restart" class="mw-redirect" title="Restart">restart</a> <code>systemd-networkd.service</code> 以使得它们生效。
</p>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>配置文件中指定的选项区分大小写。</li>
<li>在下面的示例中，<code>enp1s0</code> 是有线适配器，<code>wlp2s0</code> 是无线适配器。他们的名字在不同系统上可能会有不同的名字。也可以使用通配符，例如，<code>Name=en*</code>。</li>
<li>如果想要禁用 IPv6 的话，参考 <a href="/title/IPv6#systemd-networkd_2" title="IPv6">IPv6#systemd-networkd</a>。</li>
<li>在 <code>[Network]</code> 段设置 <code>DHCP=yes</code> 来同时接收 IPv4 <b>和</b> IPv6 DHCP 请求。</li>
</ul>
</div>
<h4>
<span id=".E4.BD.BF.E7.94.A8_DHCP_.E7.9A.84.E6.9C.89.E7.BA.BF.E9.80.82.E9.85.8D.E5.99.A8"></span><span class="mw-headline" id="使用_DHCP_的有线适配器">使用 DHCP 的有线适配器</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/20-wired.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=enp1s0

[Network]
DHCP=ipv4</pre>
<h4>
<span id=".E4.BD.BF.E7.94.A8.E9.9D.99.E6.80.81_IP_.E7.9A.84.E6.9C.89.E7.BA.BF.E9.80.82.E9.85.8D.E5.99.A8"></span><span class="mw-headline" id="使用静态_IP_的有线适配器">使用静态 IP 的有线适配器</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/20-wired.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=enp1s0

[Network]
Address=10.1.10.9/24
Gateway=10.1.10.1
DNS=10.1.10.1
#DNS=8.8.8.8</pre>
<p><code>Address=</code> 能够被使用多次来指定多个 IPv4 或者 IPv6 地址。
参见 <a href="#network_files">#network files</a><sup>[<a href="/title/ArchWiki:Requests#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> 或者 <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span> 了解更多配置项。
</p>
<h4>
<span id=".E6.97.A0.E7.BA.BF.E9.80.82.E9.85.8D.E5.99.A8"></span><span class="mw-headline" id="无线适配器">无线适配器</span>
</h4>
<p>为了能够使用 <i>systemd-networkd</i> 连接一个无线网络，需要一个被其他应用，比如 <a href="/title/Wpa_supplicant" title="Wpa supplicant">wpa_supplicant</a> 或 <a href="/title/Iwd" title="Iwd">Iwd</a>，配置好的无线适配器。
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/25-wireless.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=wlp2s0

[Network]
DHCP=ipv4
</pre>
<p>如果无线适配器有一个静态地址，它的配置（除了接口的名字）跟有线适配器是一样的。
</p>
<h4>
<span id=".E5.90.8C.E4.B8.80.E5.8F.B0.E6.9C.BA.E5.99.A8.E4.B8.8A.E7.9A.84.E6.9C.89.E7.BA.BF.E5.92.8C.E6.97.A0.E7.BA.BF.E9.80.82.E9.85.8D.E5.99.A8"></span><span class="mw-headline" id="同一台机器上的有线和无线适配器">同一台机器上的有线和无线适配器</span>
</h4>
<p>This setup will enable a DHCP IP for both a wired and wireless connection making use of the metric directive to allow the kernel to decide on-the-fly which one to use.  This way, no connection downtime is observed when the wired connection is unplugged.
</p>
<p>The kernel's route metric (same as configured with <i>ip</i>) decides which route to use for outgoing packets, in cases when several match. This will be the case when both wireless and wired devices on the system have active connections. To break the tie, the kernel uses the metric. If one of the connections is terminated, the other automatically wins without there being a gap with nothing configured (ongoing transfers may still not deal with this nicely but that is at a different OSI layer).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> The <code>Metric</code> option is for static routes while the <code>RouteMetric</code> option is for setups not using static routes. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span> for more details.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/20-wired.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=enp1s0

[Network]
DHCP=ipv4

[DHCP]
RouteMetric=10</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/25-wireless.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=wlp2s0

[Network]
DHCP=ipv4

[DHCP]
RouteMetric=20</pre>
<h4>
<span id=".E7.BD.91.E7.BB.9C.E6.8E.A5.E5.8F.A3.E9.87.8D.E5.91.BD.E5.90.8D"></span><span class="mw-headline" id="网络接口重命名">网络接口重命名</span>
</h4>
<p>作为<a href="/title/Network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E6%9B%B4%E6%94%B9%E6%8E%A5%E5%8F%A3%E5%90%8D%E7%A7%B0" title="Network configuration (简体中文)">更改设备名称</a>的替代方案，systemd 使用<i>.link</i>文件用于接口重命名。常见的例子是基于 MAC 地址给一个 USB 接口以太网适配器设置一个可预见的接口名称。这类设备依其连接到不同 USB 接口而具有不同的接口名称。
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/10-ethusb0.link</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
MACAddress=12:34:56:78:90:ab

[Link]
Description=USB to Ethernet Adapter
Name=ethusb0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 任何由用户提供的<i>.link</i>文件名<b>必须</b>是依字典顺序先于默认配置文件名<code>99-default.link</code>才能生效。例如，必须是<code>10-ethusb0.link</code>而不能是 <code>ethusb0.link</code>。</div>
<h2>
<span id=".E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="配置文件">配置文件</span>
</h2>
<p>配置文件位于 <code>/usr/lib/systemd/network</code>，非持久化的运行时网络配置目录位于 <code>/run/systemd/network</code> ，本地管理网络配置位于  <code>/etc/systemd/network</code>。<code>/etc/systemd/network</code> 中的配置文件具有最高优先级。
</p>
<p>配置文件有三类。它们均使用类似于 <a href="/title/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E7%BC%96%E5%86%99%E5%8D%95%E5%85%83%E6%96%87%E4%BB%B6" title="Systemd (简体中文)">systemd 单元文件</a> 的格式。 
</p>
<ul>
<li>
<i><b>.network</b></i> 文件，为<i>匹配</i>的设备提供一个网络配置</li>
<li>
<i><b>.netdev</b></i> 文件，为<i>匹配</i>的环境创建一个<i>虚拟网络设备</i>
</li>
<li>
<i><b>.link</b></i> 文件，当网络设备出现时，<a href="/title/Udev_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Udev (简体中文)">udev</a> 将查找第一个<i>匹配</i>的<i>.link</i>文件</li>
</ul>
<p>它们均遵循下列规则：
</p>
<ul>
<li>如果位于<code>[Match]</code>小节的<b>全部</b>条件相匹配，配置项将被激活</li>
<li>一个空的<code>[Match]</code>小节意味着配置项适用任何情况（相当于<code>*</code>通配符）</li>
<li>所有配置文件将按字典顺序集中保存和处理，不管它们在目录中的实际顺序如何。</li>
<li>同名文件将彼此替换</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 
<ul>
<li>To override a system-supplied file in <code>/usr/lib/systemd/network</code> in a permanent manner (i.e even after upgrade), place a file with same name in <code>/etc/systemd/network</code> and symlink it to <code>/dev/null</code>
</li>
<li>The <code>*</code> wildcard can be used in <code>VALUE</code> (e.g <code>en*</code> will match any Ethernet device), a boolean can be simple written as <code>yes</code> or <code>no</code>.</li>
<li>Following this <a rel="nofollow" class="external text" href="https://mailman.archlinux.org/pipermail/arch-general/2014-March/035381.html">Arch-general thread</a>, the best practice is to setup specific container network settings <i>inside the container</i> with <b>networkd</b> configuration files.</li>
<li>Systemd 使用<code>1, true, yes, on</code>作为逻辑“真”值，<code>0, false, no, off</code>作为逻辑“假”值</li>
</ul>
</div>
<h3>
<span id="network_.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="network_文件">network 文件</span>
</h3>
<p>这类文件用于设置网络配置变量，尤其适用于服务器和容器。
</p>
<p><i>.network</i>文件含有下列小节：<code>[Match]</code>、<code>[Link]</code>、<code>[Network]</code>、<code>[Address]</code>、<code>[Route]</code>以及<code>[DHCP]</code>。下列为每小节的通用配置。详情及范例请参阅<span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span>。
</p>
<h4>
<span id=".5BMatch.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[Match]_小节">[Match] 小节</span>
</h4>
<ul>
<li>
<code>MACAddress=</code> 由空白字符分割的网卡硬件地址列表</li>
<li>
<code>Name=</code> 由空白字符分割的设备名列表，可以包含集合字符（如：<code>en*</code>）。使用前缀字符<code>!</code>禁用列表中的名字。</li>
<li>
<code>Host=</code> 机器的主机名</li>
<li>
<code>Virtualization=</code> 检查系统是否运行于虚拟化环境。<code>Virtualization=no</code>选项值表示仅应用于物理主机，<code>Virtualization=yes</code>选项值表示应用于任何容器或虚拟机。</li>
</ul>
<h4>
<span id=".5BLink.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[Link]_小节">[Link] 小节</span>
</h4>
<ul>
<li>
<code>MACAddress=</code> useful for <a href="/title/MAC_address_spoofing#systemd-networkd" title="MAC address spoofing">MAC address spoofing</a>
</li>
<li>
<code>MTUBytes=</code> setting a larger MTU value (e.g. when using <a href="/title/Jumbo_frames" title="Jumbo frames">jumbo frames</a>) can significantly speed up your network transfers</li>
<li>
<code>Multicast</code> allow the usage of <a href="https://en.wikipedia.org/wiki/Multicast_address" class="extiw" title="wikipedia:Multicast address">multicast</a> on interface(s)</li>
</ul>
<h4>
<span id=".5BNetwork.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[Network]_小节">[Network] 小节</span>
</h4>
<table class="wikitable">
<tbody>
<tr>
<th>参数</th>
<th>说明</th>
<th>值类型</th>
<th>默认值
</th>
</tr>
<tr>
<td><code>DHCP=</code></td>
<td>Controls DHCPv4 and/or DHCPv6 client support.</td>
<td>boolean, <code>ipv4</code>, <code>ipv6</code>
</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>DHCPServer=</code></td>
<td>If enabled, a DHCPv4 server will be started.</td>
<td>boolean</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>MulticastDNS=</code></td>
<td>Enables <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc6762">multicast DNS</a> support. When set to <code>resolve</code>, only resolution is enabled, but not host or service registration and announcement.</td>
<td>boolean, <code>resolve</code>
</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>DNSSEC=</code></td>
<td>Controls DNSSEC DNS validation support on the link. When set to <code>allow-downgrade</code>, compatibility with non-DNSSEC capable networks is increased, by automatically turning off DNSSEC in this case.</td>
<td>boolean, <code>allow-downgrade</code>
</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>DNS=</code></td>
<td>Configure static <a href="/title/DNS" class="mw-redirect" title="DNS">DNS</a> addresses. May be specified more than once.</td>
<td><a rel="nofollow" class="external text" href="https://man7.org/linux/man-pages/man3/inet_pton.3.html"><code>inet_pton</code></a></td>
<td>
</td>
</tr>
<tr>
<td><code>Domains=</code></td>
<td>A list of domains which should be resolved using the DNS servers on this link. <a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/systemd.network.html#Domains=">more information</a>
</td>
<td>domain name, optionally prefixed with a tilde (<code>~</code>)</td>
<td>
</td>
</tr>
<tr>
<td><code>IPForward=</code></td>
<td>If enabled, incoming packets on any network interface will be forwarded to any other interfaces according to the routing table.</td>
<td>boolean, <code>ipv4</code>, <code>ipv6</code>
</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>IPv6PrivacyExtensions=</code></td>
<td>Configures use of stateless temporary addresses that change over time (see <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc4941">RFC 4941</a>). When <code>prefer-public</code>, enables the privacy extensions, but prefers public addresses over temporary addresses. When <code>kernel</code>, the kernel's default setting will be left in place.</td>
<td>boolean, <code>prefer-public</code>, <code>kernel</code>
</td>
<td>
<code>false</code>
</td>
</tr>
</tbody>
</table>
<h4>
<span id=".5BAddress.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[Address]_小节">[Address] 小节</span>
</h4>
<ul><li>
<code>Address=</code> 这个选项<b>必选</b>，除非使用了 DHCP。</li></ul>
<h4>
<span id=".5BRoute.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[Route]_小节">[Route] 小节</span>
</h4>
<ul>
<li>
<code>Gateway=</code> 这个选项<b>必选</b>，除非使用了 DHCP</li>
<li>
<code>Destination=</code> 路由的目的地前缀，可能后接一个斜线字符和前缀长度</li>
</ul>
<p>如果<code>Destination</code>选项没有出现在<code>[Route]</code>小节，本节将视为默认路由。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 如果<code>[Address]</code>小节仅包含 Address 选项值并且<code>[Route]</code>小节仅包含 Gateway 选项值，可以把这两项放在<code>[Network]</code>小节中以简化配置。</div>
<h4>
<span id=".5BDHCP.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[DHCP]_小节">[DHCP] 小节</span>
</h4>
<table class="wikitable">
<tbody>
<tr>
<th>参数</th>
<th>说明</th>
<th>值类型</th>
<th>默认值
</th>
</tr>
<tr>
<td><code>UseDNS=</code></td>
<td>controls whether the DNS servers advertised by the DHCP server are used</td>
<td>布尔值</td>
<td>
<code>true</code>
</td>
</tr>
<tr>
<td><code>Anonymize=</code></td>
<td>when true, the options sent to the DHCP server will follow the <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc7844">RFC7844</a> (Anonymity Profiles for DHCP Clients) to minimize disclosure of identifying information</td>
<td>布尔值</td>
<td>
<code>false</code>
</td>
</tr>
<tr>
<td><code>UseDomains=</code></td>
<td>controls whether the domain name received from the DHCP server will be used as DNS search domain. If set to <code>route</code>, the domain name received from the DHCP server will be used for routing DNS queries only, but not for searching. This option can sometimes fix local name resolving when using <a href="/title/Systemd-resolved" title="Systemd-resolved">systemd-resolved</a>
</td>
<td>布尔值，<code>route</code>
</td>
<td>
<code>false</code>
</td>
</tr>
</tbody>
</table>
<h3>
<span id="netdev_.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="netdev_文件">netdev 文件</span>
</h3>
<p>这类文件将创建虚拟网络设备。包含两个小节：<code>[Match]</code> 和 <code>[NetDev]</code>。下列为每小节的通用配置。详情及范例请参阅<span class="plainlinks archwiki-template-man" title="$ man 5 systemd.netdev"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.netdev.5">systemd.netdev(5)</a></span>。
</p>
<h4>
<span id=".5BMatch.5D_.E5.B0.8F.E8.8A.82_2"></span><span class="mw-headline" id="[Match]_小节_2">[Match] 小节</span>
</h4>
<ul>
<li>
<code>Host=</code> 主机名</li>
<li>
<code>Virtualization=</code> 检查是否运行于虚拟机中</li>
</ul>
<h4>
<span id=".5BNetDev.5D_.E5.B0.8F.E8.8A.82"></span><span class="mw-headline" id="[NetDev]_小节">[NetDev] 小节</span>
</h4>
<p>最通用的配置为：
</p>
<ul>
<li>
<code>Name=</code> 接口名称。<b>必须提供</b>
</li>
<li>
<code>Kind=</code> 例如：<i>bridge</i>, <i>bond</i>, <i>vlan</i>, <i>veth</i>, <i>sit</i>，等等。<b>必须提供</b>
</li>
</ul>
<h3>
<span id="link_.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="link_文件">link 文件</span>
</h3>
<p>These files are an alternative to custom udev rules and will be applied by <a href="/title/Udev" title="Udev">udev</a> as the device appears. They have two sections: <code>[Match]</code> and <code>[Link]</code>. Below are commonly configured keys for each section. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.link"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.link.5">systemd.link(5)</a></span> for more information and examples.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use <code># udevadm test-builtin net_setup_link /sys/path/to/network/device</code> to diagnose problems with <i>.link</i> files.</div>
<h4>
<span id=".5BMatch.5D_.E5.B0.8F.E8.8A.82_3"></span><span class="mw-headline" id="[Match]_小节_3">[Match] 小节</span>
</h4>
<ul>
<li>
<code>MACAddress=</code> the MAC address</li>
<li>
<code>Host=</code> the host name</li>
<li><code>Virtualization=</code></li>
<li>
<code>Type=</code> the device type e.g. vlan</li>
</ul>
<h4>
<span id=".5BLink.5D_.E5.B0.8F.E8.8A.82_2"></span><span class="mw-headline" id="[Link]_小节_2">[Link] 小节</span>
</h4>
<ul>
<li>
<code>MACAddressPolicy=</code> persistent or random addresses, or</li>
<li>
<code>MACAddress=</code> a specific address</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> the system <code>/usr/lib/systemd/network/99-default.link</code> is generally sufficient for most of the basic cases.</div>
<h2>
<span id=".E5.AE.B9.E5.99.A8.E4.B8.8B.E7.9A.84.E5.BA.94.E7.94.A8"></span><span class="mw-headline" id="容器下的应用">容器下的应用</span>
</h2>
<p>The service is available with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span>. You will want to <a href="/title/Enable" class="mw-redirect" title="Enable">enable</a> and <a href="/title/Start" class="mw-redirect" title="Start">start</a> the <code>systemd-networkd.service</code> unit on the host and container.
</p>
<p>For debugging purposes, it is strongly advised to <a href="/title/Install" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bridge-utils">bridge-utils</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=net-tools">net-tools</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span> packages.
</p>
<p>If you are using <a href="/title/Systemd-nspawn" title="Systemd-nspawn">systemd-nspawn</a>, you may need to modify the <code>systemd-nspawn@.service</code> and append boot options to the <code>ExecStart</code> line. Please refer to <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1">systemd-nspawn(1)</a></span> for an exhaustive list of options.
</p>
<p>Note that if you want to take advantage of automatic DNS configuration from DHCP, you need to enable <code>systemd-resolved</code> and symlink <code>/run/systemd/resolve/resolv.conf</code> to <code>/etc/resolv.conf</code>. See <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-resolved.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-resolved.service.8">systemd-resolved.service(8)</a></span> for more details.
</p>
<p>Before you start to configure your container network, it is useful to:
</p>
<ul>
<li>disable all your <a href="/title/Netctl" title="Netctl">netctl</a> (host and container), <a href="/title/Dhcpcd" title="Dhcpcd">dhcpcd</a> (host and container), <a href="/title/Systemd-networkd" title="Systemd-networkd">systemd-networkd</a> (container only) and <code>systemd-nspawn@.service</code> (host only) services to avoid potential conflicts and to ease debugging</li>
<li>make sure <a href="/title/Internet_sharing#Enable_packet_forwarding" title="Internet sharing">packet forwarding</a> is enabled if you want to let containers access the internet. Make sure that your <i>.network</i> file does not accidentally turn off forwarding because if you do not have a <code>IPForward=1</code> setting in it, <code>systemd-networkd</code> will turn off forwarding on this interface, even if you have it enabled globally.</li>
<li>make sure you do not have any <a href="/title/Iptables" title="Iptables">iptables</a> rules which can block traffic</li>
<li>when the daemon is started the systemd <code>networkctl</code> command displays the status of network interfaces.</li>
</ul>
<p>For the set-up described below, 
</p>
<ul>
<li>we will limit the output of the <code>ip a</code> command to the concerned interfaces</li>
<li>we assume the <i>host</i> is your main OS you are booting to and the <i>container</i> is your guest virtual machine</li>
<li>all interface names and IP addresses are only examples</li>
</ul>
<h3>
<span id=".E5.9F.BA.E6.9C.AC_DHCP_.E7.BD.91.E7.BB.9C"></span><span class="mw-headline" id="基本_DHCP_网络">基本 DHCP 网络</span>
</h3>
<p>This setup will enable a DHCP IP for host and container. In this case, both systems will share the same IP as they share the same interfaces.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDhcp</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=en*

[Network]
DHCP=ipv4
</pre>
<p>Then, <a href="/title/Enable" class="mw-redirect" title="Enable">enable</a> and start <code>systemd-networkd.service</code> on your container.
</p>
<p>You can of course replace <code>en*</code> by the full name of your ethernet device given by the output of the <code>ip link</code> command.
</p>
<ul><li>on host and container:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">2: enp7s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 14:da:e9:b5:7a:88 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.72/24 brd 192.168.1.255 scope global enp7s0
       valid_lft forever preferred_lft forever
    inet6 fe80::16da:e9ff:feb5:7a88/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<p>By default, hostname received from the DHCP server will be used as the transient hostname.
</p>
<p>To change it add <code>UseHostname=false</code> in section <code>[DHCPv4]</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyDhcp</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[DHCPv4]
UseHostname=false
</pre>
<p>If you did not want to configure a DNS in <code>/etc/resolv.conf</code> and want to rely on DHCP for setting it up, you need to <a href="/title/Enable" class="mw-redirect" title="Enable">enable</a> <code>systemd-resolved.service</code> and symlink <code>/run/systemd/resolve/resolv.conf</code> to <code>/etc/resolv.conf</code>
</p>
<pre># ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-resolved.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-resolved.service.8">systemd-resolved.service(8)</a></span> for more details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Users accessing a system partition via <code>/usr/bin/arch-chroot</code> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span>, will need to create the symlink outside of the chroot, on the mounted partition.  This is due to arch-chroot linking the file to the live environment.</div>
<h3>
<span id="DHCP_.E7.94.A8.E4.BA.8E.E4.B8.A4.E4.B8.AA.E7.8B.AC.E7.AB.8B_IP"></span><span class="mw-headline" id="DHCP_用于两个独立_IP">DHCP 用于两个独立 IP</span>
</h3>
<h4>
<span id=".E6.A1.A5.E6.8E.A5.E7.AB.AF.E5.8F.A3"></span><span class="mw-headline" id="桥接端口">桥接端口</span>
</h4>
<p>First, create a virtual bridge interface. We tell systemd to create a device named <i>br0</i> that functions as an ethernet bridge.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyBridge</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=br0
Kind=bridge</pre>
<p><a href="/title/Restart" class="mw-redirect" title="Restart">Restart</a> <code>systemd-networkd.service</code> to have systemd create the bridge.
</p>
<p>On host and container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default 
    link/ether ae:bd:35:ea:0c:c9 brd ff:ff:ff:ff:ff:ff
</pre>
<p>Note that the interface <i>br0</i> is listed but is still DOWN at this stage.
</p>
<h4>
<span id=".E7.BB.91.E5.AE.9A.E4.BB.A5.E5.A4.AA.E7.BD.91.E5.88.B0.E6.A1.A5.E6.8E.A5.E7.AB.AF.E5.8F.A3"></span><span class="mw-headline" id="绑定以太网到桥接端口">绑定以太网到桥接端口</span>
</h4>
<p>The next step is to add to the newly created bridge a network interface. In the example below, we add any interface that matches the name <i>en*</i> into the bridge <i>br0</i>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>bind</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=en*

[Network]
Bridge=br0</pre>
<p>The ethernet interface must not have DHCP or an IP address associated as the bridge requires an interface to bind to with no IP: modify the corresponding <code>/etc/systemd/network/<i>MyEth</i>.network</code> accordingly to remove the addressing.
</p>
<h4>
<span id=".E6.A1.A5.E6.8E.A5.E7.BD.91.E7.BB.9C"></span><span class="mw-headline" id="桥接网络">桥接网络</span>
</h4>
<p>Now that the bridge has been created and has been bound to an existing network interface, the IP configuration of the bridge interface must be specified. This is defined in a third <i>.network</i> file, the example below uses DHCP.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>mybridge</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=br0

[Network]
DHCP=ipv4</pre>
<h4>
<span id=".E6.B7.BB.E5.8A.A0.E9.80.89.E9.A1.B9.E4.BB.A5.E5.BC.95.E5.AF.BC.E5.AE.B9.E5.99.A8"></span><span class="mw-headline" id="添加选项以引导容器">添加选项以引导容器</span>
</h4>
<p>As we want to give a separate IP for host and container, we need to <i>Disconnect</i> networking of the container from the host. To do this, add this option <code>--network-bridge=br0</code> to your container boot command.
</p>
<pre># systemd-nspawn --network-bridge=br0 -bD /path_to/my_container
</pre>
<h4>
<span id=".E6.88.90.E6.9E.9C"></span><span class="mw-headline" id="成果">成果</span>
</h4>
<ul><li>在宿主机上</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">3: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 14:da:e9:b5:7a:88 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.87/24 brd 192.168.1.255 scope global br0
       valid_lft forever preferred_lft forever
    inet6 fe80::16da:e9ff:feb5:7a88/64 scope link 
       valid_lft forever preferred_lft forever
6: vb-<i>MyContainer</i>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000
    link/ether d2:7c:97:97:37:25 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::d07c:97ff:fe97:3725/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<ul><li>在容器中</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip a</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">2: host0: &lt;BROADCAST,MULTICAST,ALLMULTI,AUTOMEDIA,NOTRAILERS,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 5e:96:85:83:a8:5d brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.73/24 brd 192.168.1.255 scope global host0
       valid_lft forever preferred_lft forever
    inet6 fe80::5c96:85ff:fe83:a85d/64 scope link 
       valid_lft forever preferred_lft forever
</pre>
<h4>
<span id=".E6.B3.A8.E6.84.8F"></span><span class="mw-headline" id="注意">注意</span>
</h4>
<ul>
<li>we have now one IP address for <code>br0</code> on the host, and one for <code>host0</code> in the container</li>
<li>two new interfaces have appeared: <code>vb-<i>MyContainer</i></code> in the host and <code>host0</code> in the container. This comes as a result of the <code>--network-bridge=br0</code> option. This option <i>implies</i> another option, <code>--network-veth</code>. This means a <i>virtual Ethernet link</i> has been created between host and container.</li>
<li>the DHCP address on <code>host0</code> comes from the system <code>/usr/lib/systemd/network/80-container-host0.network</code> file.</li>
<li>on host</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ brctl show</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">bridge name	bridge id		STP enabled	interfaces
br0		8000.14dae9b57a88	no		enp7s0
							vb-<i>MyContainer</i>
</pre>
<p>the above command output confirms we have a bridge with two interfaces binded to.
</p>
<ul><li>在宿主机上</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip route</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default via 192.168.1.254 dev br0 
192.168.1.0/24 dev br0  proto kernel  scope link  src 192.168.1.87
</pre>
<ul><li>在容器中</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ip route</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default via 192.168.1.254 dev host0 
192.168.1.0/24 dev host0  proto kernel  scope link  src 192.168.1.73
</pre>
<p>the above command outputs confirm we have activated <code>br0</code> and <code>host0</code> interfaces with an IP address and Gateway 192.168.1.254. The gateway address has been automatically grabbed by <i>systemd-networkd</i>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /run/systemd/resolve/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver 192.168.1.254
</pre>
<h3>
<span id=".E9.9D.99.E6.80.81_IP_.E7.BD.91.E7.BB.9C"></span><span class="mw-headline" id="静态_IP_网络">静态 IP 网络</span>
</h3>
<p>Setting a static IP for each device can be helpful in case of deployed web services (e.g FTP, http, SSH). Each device will keep the same MAC address across reboots if your system <code>/usr/lib/systemd/network/99-default.link</code> file has the <code>MACAddressPolicy=persistent</code> option (it has by default). Thus, you will easily route any service on your Gateway to the desired device.
</p>
<p>The following configuration needs to be done for this setup:
</p>
<ul><li>on host</li></ul>
<p>The configuration is very similar to that of <a href="#DHCP_with_two_distinct_IP">#DHCP with two distinct IP</a><sup>[<a href="/title/ArchWiki:Requests#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>. First, a virtual bridge interface needs to be created and the main physical interface needs to be bound to it. This task can be accomplished with the following two files, with contents equal to those available at the DHCP section.
</p>
<pre>/etc/systemd/network/<i>MyBridge</i>.netdev
/etc/systemd/network/<i>MyEth</i>.network
</pre>
<p>Next, you need to configure the IP and DNS of the newly created virtual bridge interface. The following <i>MyBridge</i>.network provides an example configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyBridge</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=br0

[Network]
DNS=192.168.1.254
Address=192.168.1.87/24
Gateway=192.168.1.254
</pre>
<ul><li>on container</li></ul>
<p>First, we shall get rid of the system <code>/usr/lib/systemd/network/80-container-host0.network</code> file, which provides a DHCP configuration for the default network interface of the container. To do it in a permanent way (e.g. even after <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> upgrades), do the following on the container. This will mask the file <code>/usr/lib/systemd/network/80-container-host0.network</code> since files of the same name in <code>/etc/systemd/network</code> take priority over <code>/usr/lib/systemd/network</code>. Keep in mind that this file can be kept if you only want a static IP on the host, and want the IP address of your containers to be assigned via DHCP.
</p>
<pre># ln -sf /dev/null /etc/systemd/network/80-container-host0.network
</pre>
<p>Then, configure an static IP for the default <code>host0</code> network interface and <a href="/title/Systemd#Basic_systemctl_usage" title="Systemd">enable and start</a> <code>systemd-networkd.service</code> on your container. An example configuration is provided below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>MyVeth</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=host0

[Network]
DNS=192.168.1.254
Address=192.168.1.94/24
Gateway=192.168.1.254
</pre>
<h2>
<span id=".E4.BA.A4.E4.BA.92.E7.95.8C.E9.9D.A2.E5.8F.8A.E6.A1.8C.E9.9D.A2.E9.9B.86.E6.88.90"></span><span class="mw-headline" id="交互界面及桌面集成">交互界面及桌面集成</span>
</h2>
<p>无论是命令行或是图形桌面，<i>systemd-networkd</i>都没有相应的交互式管理界面。但某些工具可以显示当前网络状态、接收通知或提供无线网络配置界面的功能：
</p>
<ul><li>
<i>networkctl</i> （命令行）提供简单的网络接口状态展示。</li></ul>
<ul><li>如果<i>networkd</i>配置了<a href="/title/Wpa_supplicant" title="Wpa supplicant">wpa_supplicant</a>，那么<i>wpa_cli</i> 和 <i>wpa_gui</i> 都提供了动态关联和配置 WLAN 接口的功能。</li></ul>
<ul><li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkd-notify-git/">networkd-notify-git</a></span><sup><small>AUR</small></sup> 可以生成简单的接口状态改变的通知消息（如：连接/断开以及重新关联等）。</li></ul>
<ul><li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkd-dispatcher/">networkd-dispatcher</a></span><sup><small>AUR</small></sup> 后台进程允许执行一个脚本以响应网络接口状态变化事件，类似于<i>NetworkManager-dispatcher</i>。</li></ul>
<ul><li>
<i>systemd-resolved</i>作为 DNS 解析器，<code>resolvectl status</code>命令可以将当前 DNS 服务器的信息做可视化呈现。</li></ul>
<h2>
<span id=".E6.8E.92.E9.94.99"></span><span class="mw-headline" id="排错">排错</span>
</h2>
<h3>
<span id=".E5.BC.95.E5.AF.BC.E6.97.B6.E7.9A.84.E2.80.9C.E6.8C.82.E8.BD.BD.E2.80.9D.E6.9C.8D.E5.8A.A1.E5.A4.B1.E8.B4.A5"></span><span class="mw-headline" id="引导时的“挂载”服务失败">引导时的“挂载”服务失败</span>
</h3>
<p>If running services like <a href="/title/Samba" title="Samba">Samba</a>/<a href="/title/NFS" title="NFS">NFS</a> which fail if they are started before the network is up, you may want to <a href="/title/Enable" class="mw-redirect" title="Enable">enable</a> the <code>systemd-networkd-wait-online.service</code>. This is, however, rarely necessary because most networked daemons start up okay, even if the network has not been configured yet.
</p>
<h3>
<span id="systemd-resolve_.E4.B8.8D.E6.90.9C.E7.B4.A2.E6.9C.AC.E5.9C.B0.E5.9F.9F"></span><span class="mw-headline" id="systemd-resolve_不搜索本地域">systemd-resolve 不搜索本地域</span>
</h3>
<p><a href="/title/Systemd-resolved" title="Systemd-resolved">systemd-resolved</a> may not search the local domain when given just the hostname, even when <code>UseDomains=yes</code> or <code>Domains=[domain-list]</code> is present in the appropriate <i>.network</i> file, and that file produces the expected <code>search [domain-list]</code> in <code>resolv.conf</code>. You can run <code>networkctl status</code> or <code>resolvectl status</code> to check if the search domains are actually being picked up.
</p>
<p>Possible workarounds:
</p>
<ul>
<li>Disable <a href="/title/Systemd-resolved#LLMNR" title="Systemd-resolved">LLMNR</a> to let <i>systemd-resolved</i> immediately continue with appending the DNS suffixes</li>
<li>Trim <code>/etc/nsswitch.conf</code>'s <code>hosts</code> database (e.g., by removing <code>[!UNAVAIL=return]</code> option after <code>resolve</code> service)</li>
<li>Switch to using fully-qualified domain names</li>
<li>Use <code>/etc/hosts</code> to resolve hostnames</li>
<li>Fall back to using glibc's <code>dns</code> instead of using systemd's <code>resolve</code>
</li>
</ul>
<h3><span class="mw-headline" id="Connected_second_PC_unable_to_use_bridged_LAN">Connected second PC unable to use bridged LAN</span></h3>
<p>First PC have two LAN. Second PC have one LAN and connected to first PC. Lets go second PC to give all access to LAN after bridged interface:
</p>
<pre># sysctl net.bridge.bridge-nf-filter-pppoe-tagged=0
# sysctl net.bridge.bridge-nf-filter-vlan-tagged=0
# sysctl net.bridge.bridge-nf-call-ip6tables=0
# sysctl net.bridge.bridge-nf-call-iptables=0
# sysctl net.bridge.bridge-nf-call-arptables=0
</pre>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/systemd-networkd.service.html">systemd.networkd man page</a></li>
<li><a rel="nofollow" class="external text" href="https://plus.google.com/u/0/+TomGundersen/posts">Tom Gundersen, main systemd-networkd developer, G+ home page</a></li>
<li><a rel="nofollow" class="external text" href="https://coreos.com/blog/intro-to-systemd-networkd/">Tom Gundersen posts on Core OS blog</a></li>
<li>
<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1393759#p1393759">How to set up systemd-networkd with wpa_supplicant</a> (WonderWoofy's walkthrough on Arch forums)</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Categories</a>: <ul>
<li><a href="/title/Category:Network_managers_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Network managers (简体中文)">Network managers (简体中文)</a></li>
<li><a href="/title/Category:Virtualization_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Virtualization (简体中文)">Virtualization (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Translateme_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Pages or sections flagged with Template:Translateme (简体中文)">Pages or sections flagged with Template:Translateme (简体中文)</a></li>
<li><a href="/title/Category:Pages_with_broken_section_links" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd-networkd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=669424">https://wiki.archlinux.org/index.php?title=Systemd-networkd_(简体中文)&amp;oldid=669424</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 8 May 2021, at 11:48.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
