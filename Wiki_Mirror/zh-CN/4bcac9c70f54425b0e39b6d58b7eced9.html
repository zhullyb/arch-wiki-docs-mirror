<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>NFS (简体中文)/Troubleshooting (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-NFS_简体中文_Troubleshooting_简体中文 rootpage-NFS_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">NFS (简体中文)/Troubleshooting (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="/title/NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="NFS (简体中文)">NFS (简体中文)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="/title/NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="NFS (简体中文)">NFS (简体中文)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="/title/NFS/Troubleshooting" title="NFS/Troubleshooting">NFS/Troubleshooting</a> 的<a href="/title/ArchWiki:Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2016-10-17。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=NFS/Troubleshooting&amp;diff=0&amp;oldid=449910">更改</a>，则您可以帮助同步翻译。</div>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本文或本节需要<a href="/title/ArchWiki:Contributing_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E7%BF%BB%E8%AF%91" title="ArchWiki:Contributing (简体中文)">翻译</a>。要贡献翻译，请访问<a href="/title/ArchWiki_Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>附注：</b> （在 <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Troubleshooting_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:NFS (简体中文)/Troubleshooting (简体中文)#</a> 中讨论）</div>
</div>
<p>本篇专述共性问题及其解决方案。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E9%97%AE%E9%A2%98"><span class="tocnumber">1</span> <span class="toctext">服务器端问题</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#exportfs:_/etc/exports:2:_syntax_error:_bad_option_list"><span class="tocnumber">1.1</span> <span class="toctext">exportfs: /etc/exports:2: syntax error: bad option list</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Group/GID_%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="tocnumber">1.2</span> <span class="toctext">Group/GID 权限问题</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%E5%B0%9D%E8%AF%95%E4%BB%A5root%E8%BA%AB%E4%BB%BD%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E6%97%B6%E6%8A%A5%E2%80%9C%E6%9D%83%E9%99%90%E8%A2%AB%E6%8B%92%E7%BB%9D(%22Permission_denied%22)%E2%80%9D"><span class="tocnumber">1.3</span> <span class="toctext">尝试以root身份写入文件时报“权限被拒绝("Permission denied")”</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#showmount_-e_%E5%91%BD%E4%BB%A4%E6%8A%A5%E9%94%99%EF%BC%9A%22RPC:_Program_not_registered%22"><span class="tocnumber">1.4</span> <span class="toctext">showmount -e 命令报错："RPC: Program not registered"</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%97%AE%E9%A2%98"><span class="tocnumber">2</span> <span class="toctext">客户端问题</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#mount.nfs4:_No_such_device"><span class="tocnumber">2.1</span> <span class="toctext">mount.nfs4: No such device</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#mount.nfs4:_access_denied_by_server_while_mounting"><span class="tocnumber">2.2</span> <span class="toctext">mount.nfs4: access denied by server while mounting</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%E4%B8%8D%E8%83%BD%E8%BF%9E%E6%8E%A5%E5%88%B0_OS_X_%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="tocnumber">2.3</span> <span class="toctext">不能连接到 OS X 客户端</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Unreliable_connection_from_OS_X_clients"><span class="tocnumber">2.4</span> <span class="toctext">Unreliable connection from OS X clients</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E6%8B%B7%E8%B4%9D%E5%A4%A7%E6%96%87%E4%BB%B6%E6%97%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%BC%E4%B9%8E%E5%8D%A1%E4%BD%8F%E4%BA%86"><span class="tocnumber">2.5</span> <span class="toctext">拷贝大文件时客户端似乎卡住了</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#mount.nfs:_Operation_not_permitted"><span class="tocnumber">2.6</span> <span class="toctext">mount.nfs: Operation not permitted</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#mount.nfs:_Protocol_not_supported"><span class="tocnumber">2.7</span> <span class="toctext">mount.nfs: Protocol not supported</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Problems_with_Vagrant_and_synced_folders"><span class="tocnumber">2.8</span> <span class="toctext">Problems with Vagrant and synced_folders</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="tocnumber">3</span> <span class="toctext">性能问题</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%E8%AF%8A%E6%96%AD%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0"><span class="tocnumber">3.1</span> <span class="toctext">诊断问题原因</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Server_threads"><span class="tocnumber">3.2</span> <span class="toctext">Server threads</span></a></li>
<li class="toclevel-2 tocsection-18">
<a href="#Close-to-open/flush-on-close"><span class="tocnumber">3.3</span> <span class="toctext">Close-to-open/flush-on-close</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#The_nocto_mount_option"><span class="tocnumber">3.3.1</span> <span class="toctext">The nocto mount option</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#The_async_export_option"><span class="tocnumber">3.3.2</span> <span class="toctext">The async export option</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E5%A4%A7%E5%B0%8F%E4%B8%8E_MTU"><span class="tocnumber">3.4</span> <span class="toctext">缓冲区大小与 MTU</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22">
<a href="#%E8%B0%83%E8%AF%95"><span class="tocnumber">4</span> <span class="toctext">调试</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#%E4%BD%BF%E7%94%A8rpcdebug"><span class="tocnumber">4.1</span> <span class="toctext">使用rpcdebug</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Using_mountstats"><span class="tocnumber">4.2</span> <span class="toctext">Using mountstats</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#%E5%86%85%E6%A0%B8%E6%8E%A5%E5%8F%A3"><span class="tocnumber">4.3</span> <span class="toctext">内核接口</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#NFSD_debug_flags"><span class="tocnumber">4.4</span> <span class="toctext">NFSD debug flags</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#NFS_debug_flags"><span class="tocnumber">4.5</span> <span class="toctext">NFS debug flags</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#NLM_debug_flags"><span class="tocnumber">4.6</span> <span class="toctext">NLM debug flags</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#RPC_debug_flags"><span class="tocnumber">4.7</span> <span class="toctext">RPC debug flags</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#General_Notes"><span class="tocnumber">4.8</span> <span class="toctext">General Notes</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#References"><span class="tocnumber">4.9</span> <span class="toctext">References</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-32">
<a href="#%E5%85%B6%E5%AE%83%E9%97%AE%E9%A2%98"><span class="tocnumber">5</span> <span class="toctext">其它问题</span></a>
<ul>
<li class="toclevel-2 tocsection-33"><a href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="tocnumber">5.1</span> <span class="toctext">权限问题</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E7.AB.AF.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="服务器端问题">服务器端问题</span>
</h2>
<h3>
<span id="exportfs:_.2Fetc.2Fexports:2:_syntax_error:_bad_option_list"></span><span class="mw-headline" id="exportfs:_/etc/exports:2:_syntax_error:_bad_option_list">exportfs: /etc/exports:2: syntax error: bad option list</span>
</h3>
<p>请将<code>/etc/exports</code>文件里选项列表定义中的所有空格都删除
</p>
<h3>
<span id="Group.2FGID_.E6.9D.83.E9.99.90.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="Group/GID_权限问题">Group/GID 权限问题</span>
</h3>
<p>如果挂载NFS共享正常，所有者也可以完全访问，但同组用户无法访问，请检查该所有者用户所属用户组的数量。NFS限制每个用户最多只能归属于16个用户组。如果某用户超出了这个限度，请在NFS服务器上为<code>rpc.mountd</code>进程启用<code>--manage-gids</code>启动标志。
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/conf.d/nfs-server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Options for rpc.mountd.
# If you have a port-based firewall, you might want to set up
# a fixed port here using the --port option.
# See rpc.mountd(8) for more details.

MOUNTD_OPTS="--manage-gids"</pre>
<h3>
<span id=".E5.B0.9D.E8.AF.95.E4.BB.A5root.E8.BA.AB.E4.BB.BD.E5.86.99.E5.85.A5.E6.96.87.E4.BB.B6.E6.97.B6.E6.8A.A5.E2.80.9C.E6.9D.83.E9.99.90.E8.A2.AB.E6.8B.92.E7.BB.9D.28.22Permission_denied.22.29.E2.80.9D"></span><span class="mw-headline" id='尝试以root身份写入文件时报“权限被拒绝("Permission_denied")”'>尝试以root身份写入文件时报“权限被拒绝("Permission denied")”</span>
</h3>
<ul><li>如果需要以root身份挂载共享并在客户端获得全部读写权限，请在<code>/etc/exports</code>文件中添加<b>no_root_squash</b>选项：</li></ul>
<pre>/var/cache/pacman/pkg 192.168.1.0/24(rw,no_subtree_check,no_root_squash)
</pre>
<ul><li>同时也必须在<code>/etc/exports</code>文件的第一行添加<b>no_root_squash</b>：</li></ul>
<pre>/ 192.168.1.0/24(rw,fsid=root,no_root_squash,no_subtree_check)
</pre>
<h3>
<span id="showmount_-e_.E5.91.BD.E4.BB.A4.E6.8A.A5.E9.94.99.EF.BC.9A.22RPC:_Program_not_registered.22"></span><span class="mw-headline" id='showmount_-e_命令报错："RPC:_Program_not_registered"'>showmount -e 命令报错："RPC: Program not registered"</span>
</h3>
<p>请确保服务器端<code>nfs-server.service</code>和<code>rpcbind.service</code>两个服务已运行。参阅<a href="/title/Systemd" title="Systemd">systemd</a>。
</p>
<h2>
<span id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="客户端问题">客户端问题</span>
</h2>
<h3><span class="mw-headline" id="mount.nfs4:_No_such_device">mount.nfs4: No such device</span></h3>
<p>检查是否加载了<code>nfs</code>模块
</p>
<pre>lsmod | grep nfs
</pre>
<p>如果上述命令输出为空或仅有 nfsd-stuff，运行：
</p>
<pre># modprobe nfs
</pre>
<h3><span class="mw-headline" id="mount.nfs4:_access_denied_by_server_while_mounting">mount.nfs4: access denied by server while mounting</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本文或本节需要<a href="/title/ArchWiki:Contributing_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E7%BF%BB%E8%AF%91" title="ArchWiki:Contributing (简体中文)">翻译</a>。要贡献翻译，请访问<a href="/title/ArchWiki_Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>附注：</b> 英文章不正。（在 <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Troubleshooting_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:NFS (简体中文)/Troubleshooting (简体中文)#</a> 中讨论）</div>
</div>
<p>NFS shares have to reside in /srv - check your <code>/etc/exports</code> file and if necessary create the proper folder structure as described in the <a href="/title/NFS#File_system" title="NFS">NFS#File system</a><sup>[<a href="/title/ArchWiki:Requests#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> page.
</p>
<p>Check that the permissions on your client's folder are correct. Try using 755.
</p>
<p>or try "exportfs -rav" reload <code>/etc/exports</code> file.
</p>
<h3>
<span id=".E4.B8.8D.E8.83.BD.E8.BF.9E.E6.8E.A5.E5.88.B0_OS_X_.E5.AE.A2.E6.88.B7.E7.AB.AF"></span><span class="mw-headline" id="不能连接到_OS_X_客户端">不能连接到 OS X 客户端</span>
</h3>
<p>When trying to connect from a OS X client, you will see that everything is ok at logs, but MacOS X refuses to mount your NFS share. You have to add <code>insecure</code> option to your share and re-run <code>exportfs -r</code>.
</p>
<h3><span class="mw-headline" id="Unreliable_connection_from_OS_X_clients">Unreliable connection from OS X clients</span></h3>
<p>OS X's NFS client is optimized for OS X Servers and might present some issues with Linux servers. If you are experiencing slow performance, frequent disconnects and problems with international characters edit the default mount options by adding the line <code>nfs.client.mount.options = intr,locallocks,nfc</code> to <code>/etc/nfs.conf</code> on your Mac client. More information about the mount options can be found <a rel="nofollow" class="external text" href="https://web.archive.org/web/20180422153229/https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man8/mount_nfs.8.html">here</a>.
</p>
<h3>
<span id=".E6.8B.B7.E8.B4.9D.E5.A4.A7.E6.96.87.E4.BB.B6.E6.97.B6.E5.AE.A2.E6.88.B7.E7.AB.AF.E4.BC.BC.E4.B9.8E.E5.8D.A1.E4.BD.8F.E4.BA.86"></span><span class="mw-headline" id="拷贝大文件时客户端似乎卡住了">拷贝大文件时客户端似乎卡住了</span>
</h3>
<p>从客户端向 NFS 服务器拷贝大文件时，传输速度极快，但若干秒钟后速度掉下来了，客户端似乎完全被锁住一段时间直至传输结束。
</p>
<p>试试在客户端挂载时增加 <code>sync</code> 选项（例如在 <code>/etc/fstab</code> 中）以修复此问题。
</p>
<h3><span class="mw-headline" id="mount.nfs:_Operation_not_permitted">mount.nfs: Operation not permitted</span></h3>
<p>After updating to <i>nfs-utils</i> 1.2.1-2 or higher, mounting NFS shares stopped working. Henceforth, <i>nfs-utils</i> uses NFSv4 per default instead of NFSv3. The problem can be solved by using either mount option <code>'vers=3'</code> or <code>'nfsvers=3'</code> on the command line: 
</p>
<pre># mount.nfs <i>remote target</i> <i>directory</i> -o ...,vers=3,...
# mount.nfs <i>remote target</i> <i>directory</i> -o ...,nfsvers=3,...
</pre>
<p>or in <code>/etc/fstab</code>:
</p>
<pre><i>remote target</i> <i>directory</i> nfs ...,vers=3,... 0 0
<i>remote target</i> <i>directory</i> nfs ...,nfsvers=3,... 0 0
</pre>
<h3><span class="mw-headline" id="mount.nfs:_Protocol_not_supported">mount.nfs: Protocol not supported</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本文或本节需要<a href="/title/ArchWiki:Contributing_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E7%BF%BB%E8%AF%91" title="ArchWiki:Contributing (简体中文)">翻译</a>。要贡献翻译，请访问<a href="/title/ArchWiki_Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="/title/File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>附注：</b> 英文章不正。（在 <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/title/Talk:NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Troubleshooting_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:NFS (简体中文)/Troubleshooting (简体中文)#</a> 中讨论）</div>
</div>
<p>Check you are not mounting including the export root.
Use:
</p>
<pre># mount SERVER:/ /mnt
</pre>
<p>instead of, i.e.:
</p>
<pre># mount SERVER:/srv/nfs4/ /mnt
</pre>
<p>Sometimes it could be the same problem with "Operation not permitted" : <i>nfs-utils</i> uses NFSv4 per default instead of NFSv3. Go and see the previons section
</p>
<h3><span class="mw-headline" id="Problems_with_Vagrant_and_synced_folders">Problems with Vagrant and synced_folders</span></h3>
<p>If Vagrant scripts are unable to mount folders over NFS, installing the <i>net-tools</i> package may solve the issue.
</p>
<h2>
<span id=".E6.80.A7.E8.83.BD.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="性能问题">性能问题</span>
</h2>
<p>This <a rel="nofollow" class="external text" href="http://nfs.sourceforge.net/nfs-howto/ar01s05.html">NFS Howto page</a> has some useful information regarding performance.  Here are some further tips:
</p>
<h3>
<span id=".E8.AF.8A.E6.96.AD.E9.97.AE.E9.A2.98.E5.8E.9F.E5.9B.A0"></span><span class="mw-headline" id="诊断问题原因">诊断问题原因</span>
</h3>
<ul>
<li>推荐首选 <b>Htop</b> 作为诊断工具。大部分明显症状会表现为占满CPU。</li>
<li>按 F2 键，在“显示选项(Display options)”下启用“详细CPU时间(Detailed CPU time)”。按 F1 键查看 CPU 图示中各种颜色的含义。特别要查看 CPU 的 IRQs 或 Wait-IO(wio) 响应时间。</li>
</ul>
<h3><span class="mw-headline" id="Server_threads">Server threads</span></h3>
<p><b>Symptoms:</b> Nothing seems to be very heavily loaded, but some operations on the client take a long time to complete for no apparent reason.
</p>
<p>If your workload involves lots of small reads and writes (or if there are a lot of clients), there may not be enough threads running on the server to handle the quantity of queries.  To check if this is the case, run the following command on one or more of the clients:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nfsstat -rc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Client rpc stats:
calls      retrans    authrefrsh
113482     0          113484
</pre>
<p>If the <code>retrans</code> column contains a number larger than 0, the server is failing to respond to some NFS requests, and the number of threads should be increased.
</p>
<p>To increase the number of threads on the server, edit the file <code>/etc/conf.d/nfs-server.conf</code> and set the value in the <code>NFSD_OPTS</code> variable. 
For example, to set the number of threads to 32:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/conf.d/nfs-server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NFSD_OPTS="32"
</pre>
<p>The default number of threads is 8.  Try doubling this number until <code>retrans</code> remains consistently at zero.  Do not be afraid of increasing the number quite substantially.  256 threads may be quite reasonable, depending on the workload.  You will need to restart the NFS server daemon each time you modify the configuration file.  Bear in mind that the client statistics will only be reset to zero when the client is rebooted.
</p>
<p>Use <b>htop</b> (disable the hiding of kernel threads) to keep an eye on how much work each nfsd thread is doing.  If you reach a point where the <code>retrans</code> values are non-zero, but you can see <code>nfsd</code> threads on the server doing no work, something different is now causing your bottleneck, and you will need to re-diagnose this new problem.
</p>
<h3>
<span id="Close-to-open.2Fflush-on-close"></span><span class="mw-headline" id="Close-to-open/flush-on-close">Close-to-open/flush-on-close</span>
</h3>
<p><b>Symptoms:</b> Your clients are writing many small files.  The server CPU is not maxed out, but there is very high wait-IO, and the server disk seems to be churning more than you might expect.
</p>
<p>In order to ensure data consistency across clients, the NFS protocol requires that the client's cache is flushed (all data is pushed to the server) whenever a file is closed after writing.  Because the server is not allowed to buffer disk writes (if it crashes, the client will not realise the data was not written properly), the data is written to disk immediately before the client's request is completed.  When you are writing lots of small files from the client, this means that the server spends most of its time waiting for small files to be written to its disk, which can cause a significant reduction in throughput.
</p>
<p>See <a rel="nofollow" class="external text" href="https://docstore.mik.ua/orelly/networking_2ndEd/nfs/ch07_04.htm">this excellent article</a> or the <b>nfs</b> manpage for more details on the close-to-open policy.  There are several approaches to solving this problem:
</p>
<h4><span class="mw-headline" id="The_nocto_mount_option">The nocto mount option</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The linux kernel does not seem to honour this option properly. Files are still flushed when they are closed.</div>
<p>Does your situation match these conditions?
</p>
<ul>
<li>The export you have mounted on the client is only going to be used by the one client.</li>
<li>It does not matter too much if a file written on one client does not immediately appear on other clients.</li>
<li>It does not matter if after a client has written a file, and the client thinks the file has been saved, and then the client crashes, the file may be lost.</li>
</ul>
<p>If you are happy with the above conditions, you can use the <b>nocto</b> mount option, which will disable the close-to-open behaviour.  See the <b>nfs</b> manpage for details.
</p>
<h4><span class="mw-headline" id="The_async_export_option">The async export option</span></h4>
<p>Does your situation match these conditions?
</p>
<ul>
<li>It's important that when a file is closed after writing on one client, it is:
<ul>
<li>Immediately visible on all the other clients.</li>
<li>Safely stored on the server, even if the client crashes immediately after closing the file.</li>
</ul>
</li>
<li>It's not important to you that if the server crashes:
<ul>
<li>You may loose the files that were most recently written by clients.</li>
<li>When the server is restarted, the clients will believe their recent files exist, even though they were actually lost.</li>
</ul>
</li>
</ul>
<p>In this situation, you can use <code>async</code> instead of <code>sync</code> in the server's <code>/etc/exports</code> file for those specific exports.  See the <b>exports</b> manual page for details.  In this case, it does not make sense to use the <code>nocto</code> mount option on the client.
</p>
<h3>
<span id=".E7.BC.93.E5.86.B2.E5.8C.BA.E5.A4.A7.E5.B0.8F.E4.B8.8E_MTU"></span><span class="mw-headline" id="缓冲区大小与_MTU">缓冲区大小与 MTU</span>
</h3>
<p><b>Symptoms:</b> High kernel or IRQ CPU usage, a very high packet count through the network card.
</p>
<p>This is a trickier optimisation. Make sure this is definitely the problem before spending too much time on this. The default values are usually fine for most situations.
</p>
<p>See <a rel="nofollow" class="external text" href="https://docstore.mik.ua/orelly/networking_2ndEd/nfs/ch07_03.htm">this excellent article</a> for information about I/O buffering in NFS. Essentially, data is accumulated into buffers before being sent. The size of the buffer will affect the way data is transmitted over the network. The Maximum Transmission Unit (MTU) of the network equipment will also affect throughput, as the buffers need to be split into MTU-sized chunks before they are sent over the network. If your buffer size is too big, the kernel or hardware may spend too much time splitting it into MTU-sized chunks. If the buffer size is too small, there will be overhead involved in sending a very large number of small packets. You can use the <b>rsize</b> and <b>wsize</b> mount options on the client to alter the buffer cache size. To achieve the best throughput, you need to experiment and discover the best values for your setup.
</p>
<p>It is possible to change the MTU of many network cards. If your clients are on a separate subnet (e.g. for a Beowulf cluster), it may be safe to configure all of the network cards to use a high MTU. This should be done in very-high-bandwidth environments.
</p>
<p>See also the <b>nfs</b> manual page for more about <b>rsize</b> and <b>wsize</b>.
</p>
<h2>
<span id=".E8.B0.83.E8.AF.95"></span><span class="mw-headline" id="调试">调试</span>
</h2>
<h3>
<span id=".E4.BD.BF.E7.94.A8rpcdebug"></span><span class="mw-headline" id="使用rpcdebug">使用rpcdebug</span>
</h3>
<p>Using <code>rpcdebug</code> is the easiest way to manipulate the kernel interfaces in place of echoing bitmasks to /proc.
</p>
<table class="wikitable">

<tbody>
<tr>
<th>Option</th>
<th>Description
</th>
</tr>
<tr>
<td>-c</td>
<td>Clear the given debug flags
</td>
</tr>
<tr>
<td>-s</td>
<td>Set the given debug flags
</td>
</tr>
<tr>
<td>-m <i>module</i>
</td>
<td>Specify which module's flags to set or clear.
</td>
</tr>
<tr>
<td>-v</td>
<td>Increase the verbosity of rpcdebug's output
</td>
</tr>
<tr>
<td>-h</td>
<td>Print a help message and exit. When combined with the -v option, also prints the available debug flags.
</td>
</tr>
</tbody>
</table>
<p>For the <b>-m</b> option, the available modules are:
</p>
<table class="wikitable">

<tbody>
<tr>
<th>Module</th>
<th>Description
</th>
</tr>
<tr>
<td>nfsd</td>
<td>The NFS server
</td>
</tr>
<tr>
<td>nfs</td>
<td>The NFS client
</td>
</tr>
<tr>
<td>nlm</td>
<td>The Network Lock Manager, in either an NFS client or server
</td>
</tr>
<tr>
<td>rpc</td>
<td>The Remote Procedure Call module, in either an NFS client or server
</td>
</tr>
</tbody>
</table>
<p>Examples:
</p>
<pre>rpcdebug -m rpc -s all    # sets all debug flags for RPC
rpcdebug -m rpc -c all    # clears all debug flags for RPC

rpcdebug -m nfsd -s all   # sets all debug flags for NFS Server
rpcdebug -m nfsd -c all   # clears all debug flags for NFS Server
</pre>
<p>Once the flags are set you can tail the journal for the debug output, usually <code>journalctl -fl</code> or similar.
</p>
<h3><span class="mw-headline" id="Using_mountstats">Using mountstats</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nfs-utils">nfs-utils</a></span> package contains the <code>mountstats</code> tool, which can retrieve a lot of statistics about NFS mounts, including average timings and packet size.
</p>
<pre>$ mountstats 
Stats for example:/tank mounted on /tank:
  NFS mount options: rw,sync,vers=4.2,rsize=524288,wsize=524288,namlen=255,acregmin=3,acregmax=60,acdirmin=30,acdirmax=60,soft,proto=tcp,port=0,timeo=15,retrans=2,sec=sys,clientaddr=xx.yy.zz.tt,local_lock=none
  NFS server capabilities: caps=0xfbffdf,wtmult=512,dtsize=32768,bsize=0,namlen=255
  NFSv4 capability flags: bm0=0xfdffbfff,bm1=0x40f9be3e,bm2=0x803,acl=0x3,sessions,pnfs=notconfigured
  NFS security flavor: 1  pseudoflavor: 0

NFS byte counts:
  applications read 248542089 bytes via read(2)
  applications wrote 0 bytes via write(2)
  applications read 0 bytes via O_DIRECT read(2)
  applications wrote 0 bytes via O_DIRECT write(2)
  client read 171375125 bytes via NFS READ
  client wrote 0 bytes via NFS WRITE

RPC statistics:
  699 RPC requests sent, 699 RPC replies received (0 XIDs not found)
  average backlog queue length: 0

READ:
	338 ops (48%) 
	avg bytes sent per op: 216	avg bytes received per op: 507131
	backlog wait: 0.005917 	RTT: 548.736686 	total execute time: 548.775148 (milliseconds)
GETATTR:
	115 ops (16%) 
	avg bytes sent per op: 199	avg bytes received per op: 240
	backlog wait: 0.008696 	RTT: 15.756522 	total execute time: 15.843478 (milliseconds)
ACCESS:
	93 ops (13%) 
	avg bytes sent per op: 203	avg bytes received per op: 168
	backlog wait: 0.010753 	RTT: 2.967742 	total execute time: 3.032258 (milliseconds)
LOOKUP:
	32 ops (4%) 
	avg bytes sent per op: 220	avg bytes received per op: 274
	backlog wait: 0.000000 	RTT: 3.906250 	total execute time: 3.968750 (milliseconds)
OPEN_NOATTR:
	25 ops (3%) 
	avg bytes sent per op: 268	avg bytes received per op: 350
	backlog wait: 0.000000 	RTT: 2.320000 	total execute time: 2.360000 (milliseconds)
CLOSE:
	24 ops (3%) 
	avg bytes sent per op: 224	avg bytes received per op: 176
	backlog wait: 0.000000 	RTT: 30.250000 	total execute time: 30.291667 (milliseconds)
DELEGRETURN:
	23 ops (3%) 
	avg bytes sent per op: 220	avg bytes received per op: 160
	backlog wait: 0.000000 	RTT: 6.782609 	total execute time: 6.826087 (milliseconds)
READDIR:
	4 ops (0%) 
	avg bytes sent per op: 224	avg bytes received per op: 14372
	backlog wait: 0.000000 	RTT: 198.000000 	total execute time: 198.250000 (milliseconds)
SERVER_CAPS:
	2 ops (0%) 
	avg bytes sent per op: 172	avg bytes received per op: 164
	backlog wait: 0.000000 	RTT: 1.500000 	total execute time: 1.500000 (milliseconds)
FSINFO:
	1 ops (0%) 
	avg bytes sent per op: 172	avg bytes received per op: 164
	backlog wait: 0.000000 	RTT: 2.000000 	total execute time: 2.000000 (milliseconds)
PATHCONF:
	1 ops (0%) 
	avg bytes sent per op: 164	avg bytes received per op: 116
	backlog wait: 0.000000 	RTT: 1.000000 	total execute time: 1.000000 (milliseconds)</pre>
<h3>
<span id=".E5.86.85.E6.A0.B8.E6.8E.A5.E5.8F.A3"></span><span class="mw-headline" id="内核接口">内核接口</span>
</h3>
<p>A bitmask of the debug flags can be echoed into the interface to enable output to syslog; 0 is the default:
</p>
<pre>/proc/sys/sunrpc/nfsd_debug
/proc/sys/sunrpc/nfs_debug
/proc/sys/sunrpc/nlm_debug
/proc/sys/sunrpc/rpc_debug
</pre>
<p>Sysctl controls are registered for these interfaces, so they can be used instead of echo:
</p>
<pre>sysctl -w sunrpc.rpc_debug=1023
sysctl -w sunrpc.rpc_debug=0

sysctl -w sunrpc.nfsd_debug=1023
sysctl -w sunrpc.nfsd_debug=0</pre>
<p>At runtime the server holds information that can be examined:
</p>
<pre>grep . /proc/net/rpc/*/content
cat /proc/fs/nfs/exports
cat /proc/net/rpc/nfsd
ls -l /proc/fs/nfsd
</pre>
<p>A rundown of <code>/proc/net/rpc/nfsd</code> (the userspace tool <code>nfsstat</code> pretty-prints this info):
</p>
<pre>* rc (reply cache): &lt;hits&gt; &lt;misses&gt; &lt;nocache&gt;
- hits: client it's retransmitting
- misses: a operation that requires caching
- nocache: a operation that no requires caching

* fh (filehandle): &lt;stale&gt; &lt;total-lookups&gt; &lt;anonlookups&gt; &lt;dir-not-in-cache&gt; &lt;nodir-not-in-cache&gt;
- stale: file handle errors
- total-lookups, anonlookups, dir-not-in-cache, nodir-not-in-cache
  . always seem to be zeros

* io (input/output): &lt;bytes-read&gt; &lt;bytes-written&gt;
- bytes-read: bytes read directly from disk
- bytes-written: bytes written to disk

* th (threads): &lt;threads&gt; &lt;fullcnt&gt; &lt;10%-20%&gt; &lt;20%-30%&gt; ... &lt;90%-100%&gt; &lt;100%&gt;
- threads: number of nfsd threads
- fullcnt: number of times that the last 10% of threads are busy
- 10%-20%, 20%-30% ... 90%-100%: 10 numbers representing 10-20%, 20-30% to 100%
  . Counts the number of times a given interval are busy

* ra (read-ahead): &lt;cache-size&gt; &lt;10%&gt; &lt;20%&gt; ... &lt;100%&gt; &lt;not-found&gt;
- cache-size: always the double of number threads
- 10%, 20% ... 100%: how deep it found what was looking for
- not-found: not found in the read-ahead cache

* net: &lt;netcnt&gt; &lt;netudpcnt&gt; &lt;nettcpcnt&gt; &lt;nettcpconn&gt;
- netcnt: counts every read
- netudpcnt: counts every UDP packet it receives
- nettcpcnt: counts every time it receives data from a TCP connection
- nettcpconn: count every TCP connection it receives

* rpc: &lt;rpccnt&gt; &lt;rpcbadfmt+rpcbadauth+rpcbadclnt&gt; &lt;rpcbadfmt&gt; &lt;rpcbadauth&gt; &lt;rpcbadclnt&gt;
- rpccnt: counts all rpc operations
- rpcbadfmt: counts if while processing a RPC it encounters the following errors:
  . err_bad_dir, err_bad_rpc, err_bad_prog, err_bad_vers, err_bad_proc, err_bad
- rpcbadauth: bad authentication
  . does not count if you try to mount from a machine that it's not in your exports file
- rpcbadclnt: unused

* procN (N = vers): &lt;vs_nproc&gt; &lt;null&gt; &lt;getattr&gt; &lt;setattr&gt; &lt;lookup&gt; &lt;access&gt; &lt;readlink&gt; &lt;read&gt; &lt;write&gt; &lt;create&gt; &lt;mkdir&gt; &lt;symlink&gt; &lt;mknod&gt; &lt;remove&gt; &lt;rmdir&gt; &lt;rename&gt; &lt;link&gt; &lt;readdir&gt; &lt;readdirplus&gt; &lt;fsstat&gt; &lt;fsinfo&gt; &lt;pathconf&gt; &lt;commit&gt;
- vs_nproc: number of procedures for NFS version
  . v2: nfsproc.c, 18
  . v3: nfs3proc.c, 22
  - v4, nfs4proc.c, 2
- statistics: generated from NFS operations at runtime

* proc4ops: &lt;ops&gt; &lt;x..y&gt;
- ops: the definition of LAST_NFS4_OP, OP_RELEASE_LOCKOWNER = 39, plus 1 (so 40); defined in nfs4.h
- x..y: the array of nfs_opcount up to LAST_NFS4_OP (nfsdstats.nfs4_opcount[i])</pre>
<h3><span class="mw-headline" id="NFSD_debug_flags">NFSD debug flags</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/include/linux/nfsd/debug.h</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/*
 * knfsd debug flags
 */
#define NFSDDBG_SOCK            0x0001
#define NFSDDBG_FH              0x0002
#define NFSDDBG_EXPORT          0x0004
#define NFSDDBG_SVC             0x0008
#define NFSDDBG_PROC            0x0010
#define NFSDDBG_FILEOP          0x0020
#define NFSDDBG_AUTH            0x0040
#define NFSDDBG_REPCACHE        0x0080
#define NFSDDBG_XDR             0x0100
#define NFSDDBG_LOCKD           0x0200
#define NFSDDBG_ALL             0x7FFF
#define NFSDDBG_NOCHANGE        0xFFFF</pre>
<h3><span class="mw-headline" id="NFS_debug_flags">NFS debug flags</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/include/linux/nfs_fs.h</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/*
 * NFS debug flags
 */
#define NFSDBG_VFS              0x0001
#define NFSDBG_DIRCACHE         0x0002
#define NFSDBG_LOOKUPCACHE      0x0004
#define NFSDBG_PAGECACHE        0x0008
#define NFSDBG_PROC             0x0010
#define NFSDBG_XDR              0x0020
#define NFSDBG_FILE             0x0040
#define NFSDBG_ROOT             0x0080
#define NFSDBG_CALLBACK         0x0100
#define NFSDBG_CLIENT           0x0200
#define NFSDBG_MOUNT            0x0400
#define NFSDBG_FSCACHE          0x0800
#define NFSDBG_PNFS             0x1000
#define NFSDBG_PNFS_LD          0x2000
#define NFSDBG_STATE            0x4000
#define NFSDBG_ALL              0xFFFF</pre>
<h3><span class="mw-headline" id="NLM_debug_flags">NLM debug flags</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/include/linux/lockd/debug.h</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/*
 * Debug flags
 */
#define NLMDBG_SVC		0x0001
#define NLMDBG_CLIENT		0x0002
#define NLMDBG_CLNTLOCK		0x0004
#define NLMDBG_SVCLOCK		0x0008
#define NLMDBG_MONITOR		0x0010
#define NLMDBG_CLNTSUBS		0x0020
#define NLMDBG_SVCSUBS		0x0040
#define NLMDBG_HOSTCACHE	0x0080
#define NLMDBG_XDR		0x0100
#define NLMDBG_ALL		0x7fff</pre>
<h3><span class="mw-headline" id="RPC_debug_flags">RPC debug flags</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/include/linux/sunrpc/debug.h</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/*
 * RPC debug facilities
 */
#define RPCDBG_XPRT             0x0001
#define RPCDBG_CALL             0x0002
#define RPCDBG_DEBUG            0x0004
#define RPCDBG_NFS              0x0008
#define RPCDBG_AUTH             0x0010
#define RPCDBG_BIND             0x0020
#define RPCDBG_SCHED            0x0040
#define RPCDBG_TRANS            0x0080
#define RPCDBG_SVCXPRT          0x0100
#define RPCDBG_SVCDSP           0x0200
#define RPCDBG_MISC             0x0400
#define RPCDBG_CACHE            0x0800
#define RPCDBG_ALL              0x7fff</pre>
<h3><span class="mw-headline" id="General_Notes">General Notes</span></h3>
<ul><li>While the number of threads can be increased at runtime via an echo to <code>/proc/fs/nfsd/threads</code>, the cache size (double the threads, see the <b>ra</b> line of /proc/net/rpc/nfsd) is not dynamic. The NFS daemon must be restarted with the new thread size during initialization in order for the thread cache to properly adjust.</li></ul>
<h3><span class="mw-headline" id="References">References</span></h3>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/tree/master/include/linux">https://github.com/torvalds/linux/tree/master/include/linux</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 rpcdebug"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/rpcdebug.8">rpcdebug(8)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://cns.utoronto.ca/~cks/space/blog/linux/NFSClientDebuggingBits">http://utcc.utoronto.ca/~cks/space/blog/linux/NFSClientDebuggingBits</a></li>
<li><a rel="nofollow" class="external text" href="https://www.novell.com/support/kb/doc.php?id=7011571">http://www.novell.com/support/kb/doc.php?id=7011571</a></li>
<li><a rel="nofollow" class="external text" href="https://stromberg.dnsalias.org/~strombrg/NFS-troubleshooting-2.html">http://stromberg.dnsalias.org/~strombrg/NFS-troubleshooting-2.html</a></li>
<li><a rel="nofollow" class="external text" href="http://www.opensubscriber.com/message/nfs@lists.sourceforge.net/7833588.html">http://www.opensubscriber.com/message/nfs@lists.sourceforge.net/7833588.html</a></li>
</ul>
<h2>
<span id=".E5.85.B6.E5.AE.83.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="其它问题">其它问题</span>
</h2>
<h3>
<span id=".E6.9D.83.E9.99.90.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="权限问题">权限问题</span>
</h3>
<p>如果发现文件权限无法按需设置成功，请确认在客户端和服务器端同时修改了用户/组权限。
</p>
<p>如果所有文件的属主都是 <code>nobody</code> 并且使用了 NFSv4，请在客户端和服务器端同时做到：
</p>
<ul>
<li>在使用 systemd 时，确认 <code>nfs-idmapd</code> 服务已启动。</li>
<li>在使用初始化脚本（initscripts）时，确认<code>/etc/conf.d/nfs-common.conf</code> 文件中的 <code>NEED_IDMAPD</code> 选项已设置为 <code>YES</code>。</li>
</ul>
<p>某些系统在侦测“FQDN-主机名”这种格式时似乎工作不正常。On some systems detecting the domain from FQDN minus hostname does not seem to work reliably. 如果经过上述更正以后文件仍然显示属主为 <code>nobody</code>， 请编辑 /etc/idmapd.conf 文件，确认 <code>Domain</code> 选项已设置为 <code>FQDN-主机名</code> 形式。例如：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/idmapd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[General]

Verbosity = 7
Pipefs-Directory = /var/lib/nfs/rpc_pipefs
Domain = yourdomain.local

[Mapping]

Nobody-User = nobody
Nobody-Group = nobody

[Translation]

Method = nsswitch</pre>
<p>如果 nfs-idmapd.service 因无法打开 Pipefs-directory 而拒绝启动，请创建 /etc/idmapd.conf 并添加 '/nfs'，然后重启守护进程。
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Network_sharing_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Network sharing (简体中文)">Network sharing (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="/title/Category:Pages_or_sections_flagged_with_Template:Translateme_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Pages or sections flagged with Template:Translateme (简体中文)">Pages or sections flagged with Template:Translateme (简体中文)</a></li>
<li><a href="/title/Category:Pages_with_broken_section_links" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NFS_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Troubleshooting_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=669127">https://wiki.archlinux.org/index.php?title=NFS_(简体中文)/Troubleshooting_(简体中文)&amp;oldid=669127</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 8 May 2021, at 11:18.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
