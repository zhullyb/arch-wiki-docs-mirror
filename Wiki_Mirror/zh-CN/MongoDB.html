<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>MongoDB (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-MongoDB_简体中文 rootpage-MongoDB_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">MongoDB (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/MongoDB.html" title="MongoDB">MongoDB</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2016-12-15。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=MongoDB&amp;diff=0&amp;oldid=459380">更改</a>，则您可以帮助同步翻译。</div>
<p>MongoDB (from hu<b>mongo</b>us) 是一个开源的，面向文档的数据库系统，由 <a rel="nofollow" class="external text" href="http://www.mongodb.com/">MongoDB Inc. (formerly 10gen)</a>开发并提供支持. 它是NoSQL家族中的一员， 替代用表储存数据的经典的关系型数据库， MongoDB的数据储存结构类似于用动态视图（dynamic schemas）储存类JSON文档（JSON-like documents) （MongoDB称这种格式为<a rel="nofollow" class="external text" href="http://bsonspec.org/">BSON</a>， 将数据尽早尽快地整合成对应的应用类型.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%E4%BD%BF%E7%94%A8"><span class="tocnumber">2</span> <span class="toctext">使用</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Troubleshooting"><span class="tocnumber">3</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8_MongoDB"><span class="tocnumber">3.1</span> <span class="toctext">无法启动 MongoDB</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#transparent_hugepage%E5%86%85%E6%A0%B8%E8%AE%BE%E7%BD%AE%E8%AD%A6%E5%91%8A"><span class="tocnumber">3.2</span> <span class="toctext">transparent_hugepage内核设置警告</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>由于 MongoDB 修改了软件授权协议，<a href="../en/Official_repositories.html" title="Official repositories">官方软件仓库</a>已经删除了此软件包，需要的用户可以选择安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> 或 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-bin/">mongodb-bin</a></span><sup><small>AUR</small></sup> 软件包。请注意从代码编译 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> 需要 ~160GB 磁盘空间，需要花费几个小时时间。
</p>
<p>可以选择安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-tools/">mongodb-tools</a></span><sup><small>AUR</small></sup>，这个软件包提供了 <code>mongoimport</code>, <code>mongoexport</code>, <code>mongodump</code>, <code>mongorestore</code> 等工具。
</p>
<p><a href="../en/Systemd.html#Using_units" title="Systemd">Start/Enable</a> 服务 <code>mongodb.service</code>。
</p>
<p>第一次启动 mongodb 服务时，会为记录和日志文件预先分配空间，在此期间不能使用数据库 shell。
</p>
<h2>
<span id=".E4.BD.BF.E7.94.A8"></span><span class="mw-headline" id="使用">使用</span>
</h2>
<p>启动 Mongo Shell， 在终端输入:
</p>
<pre>$ mongo
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id=".E6.97.A0.E6.B3.95.E5.90.AF.E5.8A.A8_MongoDB"></span><span class="mw-headline" id="无法启动_MongoDB">无法启动 MongoDB</span>
</h3>
<p>检查 systemctl 的服务是否使用了正确的数据库位置:
</p>
<pre>$ vi /usr/lib/systemd/system/mongodb.service
</pre>
<p>在 "ExecStart" 中加入 "--dbpath /var/lib/mongodb"：
</p>
<pre>ExecStart=/usr/bin/numactl --interleave=all mongod --quiet --config /etc/mongodb.conf --dbpath /var/lib/mongodb
</pre>
<p>检查是否存在3G以上的剩余磁盘空间用于记录文件的储存，否则，MongoDB将启动启动失败
</p>
<pre>$ df -h /var/lib/mongodb/
</pre>
<p>检查是否存在非空 mongod.lock 锁文件
</p>
<pre># ls  -lisa /var/lib/mongodb
</pre>
<p>锁文件不是空文件， 停止 <code>mongodb.service</code>，运行mongo自带的数据库修复程序，指定dbpath (/var/lib/mongodb/ 是Arch Linux 的默认 dbpath)：
</p>
<pre># mongod --dbpath /var/lib/mongodb/ --repair
</pre>
<p>完成后 dbpath 中应该包含修复的文件和空 mongod.lock 文件. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 在特殊情况下，可以删除锁文件，并用损坏的文件重启，数据库也会尝试恢复，但是结果是不可预测的。详情请参考<a rel="nofollow" class="external text" href="https://docs.mongodb.com/manual/tutorial/recover-data-following-unexpected-shutdown/">上游文档</a>.</div>
<p>在用root权限运行完修复程序之后，文件的拥有者将变为root用户，然而在Arch Linux里，mongodb可能会被不同用户运行。 需要使用chown命令将文件的拥有者改回正确的用户。点击以下的链接查看更多细节：<a rel="nofollow" class="external text" href="http://earlz.net/view/2011/03/11/0015/mongodb-and-arch-linux">Further reference</a>
</p>
<pre># chown -R mongodb: /var/{log,lib}/mongodb/
</pre>
<p>最后，从 mongodb <a rel="nofollow" class="external text" href="https://docs.mongodb.com/manual/reference/configuration-options/">文档</a> 复制配置文件，删除下面两行并 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Restart">重启</a> mongodb.service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mongodb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">processManagement:
   fork: true
</pre>
<h3>
<span id="transparent_hugepage.E5.86.85.E6.A0.B8.E8.AE.BE.E7.BD.AE.E8.AD.A6.E5.91.8A"></span><span class="mw-headline" id="transparent_hugepage内核设置警告">transparent_hugepage内核设置警告</span>
</h3>
<p>在启动 MongoDB 之后，如果看到关于 transparent_hugepage 的警告，可以通过以下链接提供的方式永久禁用 transparent_hugepage内核设置 (参考 <a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html">FreeDesktop tmpfiles.d 手册</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tmpfiles.d/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">w /sys/kernel/mm/transparent_hugepage/enabled - - - - never
w /sys/kernel/mm/transparent_hugepage/defrag - - - - never
</pre>
<p>如果希望只在本次启动时禁用，可以使用SysCtl或者下面的 echo 命令实现：
</p>
<pre># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</pre>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Database_management_systems.html" title="Category:Database management systems (简体中文)">Database management systems (简体中文)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=MongoDB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=567274">https://wiki.archlinux.org/index.php?title=MongoDB_(简体中文)&amp;oldid=567274</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 24 February 2019, at 16:56.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
