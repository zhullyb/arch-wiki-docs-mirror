<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Cron (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Cron_简体中文 rootpage-Cron_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Cron (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/ac55e32d4dfdaeb996fb6e2ed9ab24e5.html" class="mw-redirect" title="Systemd/Timers (简体中文)">systemd/Timers (简体中文)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Cron.html" title="Cron">Cron</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2018-06-30。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Cron&amp;diff=0&amp;oldid=517790">更改</a>，则您可以帮助同步翻译。</div>
<p>摘自 <a href="https://en.wikipedia.org/wiki/Cron" class="extiw" title="wikipedia:Cron">Wikipedia</a>:
</p>
<dl><dd>
<i>cron</i> 是一个在 Unix 及类似操作系统上执行计划任务的程序。用户可以在指定的时间段周期性地运行命令或 shell 脚本，通常用于系统的自动化维护或者管理。</dd></dl>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E6%BF%80%E6%B4%BB%E5%8F%8A%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="tocnumber">2.1</span> <span class="toctext">激活及开机启动</span></a></li>
<li class="toclevel-2 tocsection-4">
<a href="#%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF"><span class="tocnumber">2.2</span> <span class="toctext">处理任务中的错误</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#%E4%BD%BF%E7%94%A8_ssmtp"><span class="tocnumber">2.2.1</span> <span class="toctext">使用 ssmtp</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Example_with_msmtp"><span class="tocnumber">2.2.2</span> <span class="toctext">Example with msmtp</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Example_with_esmtp"><span class="tocnumber">2.2.3</span> <span class="toctext">Example with esmtp</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Example_with_opensmtpd"><span class="tocnumber">2.2.4</span> <span class="toctext">Example with opensmtpd</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Long_cron_job"><span class="tocnumber">2.2.5</span> <span class="toctext">Long cron job</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Crontab_%E6%A0%BC%E5%BC%8F"><span class="tocnumber">3</span> <span class="toctext">Crontab 格式</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="tocnumber">4</span> <span class="toctext">基本命令</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#%E8%8C%83%E4%BE%8B"><span class="tocnumber">5</span> <span class="toctext">范例</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Examples"><span class="tocnumber">6</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Default_editor"><span class="tocnumber">7</span> <span class="toctext">Default editor</span></a></li>
<li class="toclevel-1 tocsection-15"><a href="#Running_X.org_server-based_applications"><span class="tocnumber">8</span> <span class="toctext">Running X.org server-based applications</span></a></li>
<li class="toclevel-1 tocsection-16">
<a href="#Asynchronous_job_processing"><span class="tocnumber">9</span> <span class="toctext">Asynchronous job processing</span></a>
<ul>
<li class="toclevel-2 tocsection-17"><a href="#Cronie"><span class="tocnumber">9.1</span> <span class="toctext">Cronie</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Dcron"><span class="tocnumber">9.2</span> <span class="toctext">Dcron</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Cronwhip"><span class="tocnumber">9.3</span> <span class="toctext">Cronwhip</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Anacron"><span class="tocnumber">9.4</span> <span class="toctext">Anacron</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Fcron"><span class="tocnumber">9.5</span> <span class="toctext">Fcron</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href="#Ensuring_exclusivity"><span class="tocnumber">10</span> <span class="toctext">Ensuring exclusivity</span></a></li>
<li class="toclevel-1 tocsection-23"><a href="#Cronie_2"><span class="tocnumber">11</span> <span class="toctext">Cronie</span></a></li>
<li class="toclevel-1 tocsection-24"><a href="#Dcron_2"><span class="tocnumber">12</span> <span class="toctext">Dcron</span></a></li>
<li class="toclevel-1 tocsection-25"><a href="#See_also"><span class="tocnumber">13</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>cron 有多个实现程序，但是基础系统默认使用 <a href="../zh-CN/ac55e32d4dfdaeb996fb6e2ed9ab24e5.html" class="mw-redirect" title="Systemd/Timers (简体中文)">systemd/Timers</a>。下面的实现都没有安装，用户可以选择其一进行安装。<a rel="nofollow" class="external text" href="http://www.gentoo.org/doc/en/cron-guide.xml">Gentoo Linux Cron 指南</a> 提供了一个这些实现之间的比较。软件包:
</p>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cronie">cronie</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcron">fcron</a></span></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dcron/">dcron</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/vixie-cron/">vixie-cron</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/scron-git/">scron-git</a></span><sup><small>AUR</small></sup>
</li>
</ul>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<h3>
<span id=".E6.BF.80.E6.B4.BB.E5.8F.8A.E5.BC.80.E6.9C.BA.E5.90.AF.E5.8A.A8"></span><span class="mw-headline" id="激活及开机启动">激活及开机启动</span>
</h3>
<p>安装后，默认的守护进程不会启动。安装的软件包都提供了可以用 <a href="../en/Systemd.html#Using_units" title="Systemd">systemctl</a> 控制的服务文件。例如 <i>cronie</i> 使用 <code>cronie.service</code>.
</p>
<p><code>/etc/cron.daily/</code> 目录包含当前的任务，启动 cron 服务时会触发所有当天任务。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>cronie</i> 提供了 <code>0anacron</code>任务，每小时执行一次，可以执行其它因为未开机而延迟的任务。</div>
<h3>
<span id=".E5.A4.84.E7.90.86.E4.BB.BB.E5.8A.A1.E4.B8.AD.E7.9A.84.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id="处理任务中的错误">处理任务中的错误</span>
</h3>
<p>cron 会记录 <i>stdout</i> 和 <i>stderr</i> 的输出并尝试通过 <code>sendmail</code> 命令发送邮件给用户。如果 Cronie 未找到 <code>/usr/bin/sendmail</code>，则会禁用邮件通知。要发送邮件到用户的 spool，需要在系统上运行 smtp 进程，例如 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=opensmtpd">opensmtpd</a></span>。也可以安装提供 sendmail 命令的软件包，然后配置成通过外部邮件服务器发送邮件。或者使用 <code>-m</code> 选项将错误记录到日志并通过定制的脚本进行处理。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 通过 <a href="../en/Postfix.html#Local_mail" title="Postfix">Postfix#Local mail</a> 可以发送邮件到本地系统。</div>
<ol>
<li>
<a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">编辑</a> <code>cronie.service</code> 服务。</li>
<li>安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/esmtp/">esmtp</a></span><sup><small>AUR</small></sup>, <a href="../en/Msmtp.html" title="Msmtp">msmtp</a>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=opensmtpd">opensmtpd</a></span>, <a href="../en/SSMTP.html" title="SSMTP">ssmtp</a> 或编写自定义脚本。</li>
</ol>
<h4>
<span id=".E4.BD.BF.E7.94.A8_ssmtp"></span><span class="mw-headline" id="使用_ssmtp">使用 ssmtp</span>
</h4>
<p>ssmtp 是一个仅包含发送功能的 sendmail 模拟器，可以从本地计算机向 smtp 服务器发送邮件。尽管目前已经没用活跃维护者，这个程序依然是发送邮件的最简单方式。没用需要运行的后台进程，最简单的配置只需要一个包含三行内容的配置文件(发送服务提供商支持未认证转发的时候)。ssmtp 无法收取邮件、展开扩展或管理队列。
</p>
<p>安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ssmtp/">ssmtp</a></span><sup><small>AUR</small></sup>，安装时会创建 <code>/usr/bin/sendmail</code> 链接，指向 <code>/usr/bin/ssmtp</code>. 安装后编辑 <code>/etc/ssmtp/ssmtp.conf</code> 配置文件。详情请参考 <a href="../en/SSMTP.html" title="SSMTP">ssmtp</a>，到 <code>/usr/bin/sendmail</code> 的软链接可以确保 <a href="../en/S-nail.html" title="S-nail">S-nail</a> 等提供 <code>/usr/bin/mail</code> 的程序可以无需修改直接使用。
</p>
<p>安装配置完成后重启 <code>cronie</code> 以重新确认 <code>/usr/bin/sendmail</code> 已经被安装。
</p>
<h4><span class="mw-headline" id="Example_with_msmtp">Example with msmtp</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=msmtp-mta">msmtp-mta</a></span>, which creates a symbolic link from <code>/usr/bin/sendmail</code> to <code>/usr/bin/msmtp</code>. Restart <code>cronie</code> to make sure it detects the new <code>sendmail</code> command. You must then provide a way for <code>msmtp</code> to convert your username into an email address.
</p>
<p>Then either add <code>MAILTO</code> line to your crontab, like so:
</p>
<pre>MAILTO=your@email.com
</pre>
<p><b>or</b> create <code>/etc/msmtprc</code> and append this line:
</p>
<pre>aliases /etc/aliases
</pre>
<p>and create <code>/etc/aliases</code>: 
</p>
<pre>your_username: your@email.com
# Optional:
default: your@email.com
</pre>
<p>Then <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">modify the configuration</a> of <i>cronie</i> daemon by replacing the <code>ExecStart</code> command with:
</p>
<pre>ExecStart=/usr/bin/crond -n -m '/usr/bin/msmtp -t'
</pre>
<h4><span class="mw-headline" id="Example_with_esmtp">Example with esmtp</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/esmtp/">esmtp</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=procmail">procmail</a></span>.
</p>
<p>After installation configure the routing:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/esmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">identity <i>myself</i>@myisp.com
       hostname mail.myisp.com:25
       username <i>"myself"</i>
       password <i>"secret"</i>
       starttls enabled
       default
mda "/usr/bin/procmail -d %T"
</pre>
<p>Procmail needs root privileges to work in delivery mode but it is not an issue if you are running the cronjobs as root anyway.
</p>
<p>To test that everything works correctly, create a file <code>message.txt</code> with <code>"test message"</code> in it. 
</p>
<p>From the same directory run:
</p>
<pre>$ sendmail <i>user_name</i> &lt; message.txt 
</pre>
<p>then:
</p>
<pre>$ cat /var/spool/mail/<i>user_name</i>
</pre>
<p>You should now see the test message and the time and date it was sent.
</p>
<p>The error output of all jobs will now be redirected to <code>/var/spool/mail/<i>user_name</i></code>.
</p>
<p>Due to the privileged issue, it is hard to create and send emails to root (e.g. <code>su -c ""</code>). You can ask <code>esmtp</code> to forward all root's email to an ordinary user with:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/esmtprc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">force_mda="<i>user-name</i>"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the above test didn't work, you may try creating a local configuration in <code>~/.esmtprc</code> with the same content.
<p>Run the following command to make sure it has the correct permission: 
</p>
<pre>$ chmod 710 ~/.esmtprc
</pre>
Then repeat the test with <code>message.txt</code> exactly as before.</div>
<h4><span class="mw-headline" id="Example_with_opensmtpd">Example with opensmtpd</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=opensmtpd">opensmtpd</a></span>.
</p>
<p>Edit <code>/etc/smtpd/smtpd.conf</code>. The following configuration allows for local delivery:
</p>
<pre>listen on localhost
accept for local deliver to mbox
</pre>
<p>You can proceed to test it. First <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">start</a> <code>smtpd.service</code>. Then do:
</p>
<pre>$ echo test | sendmail user
</pre>
<p><i>user</i> can check his/her mail in with any <a href="../en/Category:Email_clients.html" title="Category:Email clients">reader</a> able to handle mbox format, or just have a look at the file <code>/var/spool/mail/<i>user</i></code>. If everything goes as expected, you can <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">enable</a> opensmtpd for future boots.
</p>
<p>This approach has the advantage of not sending local cron notifications to a remote server. On the downside, you need a new daemon running.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>At the moment of writing the Arch opensmtpd package does not create all needed directories under <code>/var/spool/smtpd</code>, but the daemon will warn about that specifying the required ownerships and permissions. Just create them as suggested.</li>
<li>Even though the suggested configuration does not accept remote connections, it's a healthy precaution to add an additional layer of security blocking port 25 with <a href="../en/Iptables.html" title="Iptables">iptables</a> or similar.</li>
</ul>
</div>
<h4><span class="mw-headline" id="Long_cron_job">Long cron job</span></h4>
<p>Suppose this program is invoked by cron :
</p>
<pre>#!/bin/sh
echo "I had a recoverable error!"
sleep 1h
</pre>
<p>What happens is this:
</p>
<ol>
<li>cron runs the script</li>
<li>as soon as cron sees some output, it runs your MTA, and provides it with the headers. It leaves the pipe open, because the job hasn't finished and there might be more output.</li>
<li>the MTA opens the connection to postfix and leaves that connection open while it waits for the rest of the body.</li>
<li>postfix closes the idle connection after less than an hour and you get an error like this :</li>
</ol>
<pre>smtpmsg='421 … Error: timeout exceeded' errormsg='the server did not accept the mail'
</pre>
<p>To solve this problem you can use the command chronic or sponge from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=moreutils">moreutils</a></span>.
From their respective man page:
</p>
<dl>
<dt>chronic</dt>
<dd>chronic runs a command, and arranges for its standard out and standard error to only be displayed if the command fails (exits nonzero or crashes). If the command succeeds, any extraneous output will be hidden.</dd>
<dt>sponge</dt>
<dd>sponge reads standard input and writes it out to the specified file. Unlike a shell redirect, sponge soaks up all its input before opening the output file… If no output file is specified, sponge outputs to stdout.</dd>
</dl>
<p>Chronic too buffers the command output before opening its standard output.
</p>
<h2>
<span id="Crontab_.E6.A0.BC.E5.BC.8F"></span><span class="mw-headline" id="Crontab_格式">Crontab 格式</span>
</h2>
<p>crontab 的基本格式是：
</p>
<pre>&lt;分钟&gt; &lt;小时&gt; &lt;日&gt; &lt;月份&gt; &lt;星期&gt; &lt;命令&gt;
</pre>
<ul>
<li>
<i>分钟</i> 值从 0 到 59.</li>
<li>
<i>小时</i> 值从 0 到 23.</li>
<li>
<i>日</i> 值从 1 到 31.</li>
<li>
<i>月</i> 值从 1 到 12.</li>
<li>
<i>星期</i> 值从 0 到 6, 0 代表星期日.</li>
</ul>
<p>空格用来分开字段，可以用下面特殊字符设定范围:
</p>
<table class="wikitable" style="text-align: center">
<tbody>
<tr>
<th>符号</th>
<th>描述
</th>
</tr>
<tr>
<td><b>*</b></td>
<td>通配符，表示所有支持的时间值
</td>
</tr>
<tr>
<td><b>,</b></td>
<td>用逗号分隔多个时间
</td>
</tr>
<tr>
<td><b>-</b></td>
<td>连接两个数值，给出一个范围
</td>
</tr>
<tr>
<td><b>/</b></td>
<td>指定一个周期或频率
</td>
</tr>
</tbody>
</table>
<p>例如，下面一行：
</p>
<pre>*0,*5 9-16 * 1-5,9-12 1-5 /home/user/bin/i_love_cron.sh
</pre>
<p>会在夏天(六、七、八月)之外的每周周一到周五的上午9点到下午4点之间每5分钟执行一次 <code>i_love_cron.sh</code>。更多范例和高级配置方法见下文。
</p>
<p>Besides, crontab has some special keywords:
</p>
<pre>@reboot at startup 
@yearly once a year
@annually ( == @yearly)
@monthly once a month
@weekly once a week
@daily once a day
@midnight ( == @daily)
@hourly once an hour
</pre>
<p>For example:
</p>
<pre>@reboot ~/bin/i_love_cron.sh
</pre>
<p>Will execute the script <code>i_love_cron.sh</code> at startup.
</p>
<p>See more at: <a rel="nofollow" class="external free" href="http://www.adminschoice.com/crontab-quick-reference">http://www.adminschoice.com/crontab-quick-reference</a>
</p>
<h2>
<span id=".E5.9F.BA.E6.9C.AC.E5.91.BD.E4.BB.A4"></span><span class="mw-headline" id="基本命令">基本命令</span>
</h2>
<p>Crontabs 不应该直接编辑；用户应该使用 <i>crontab</i> 程序来处理他们的 crontabs。为了能够访问这个命令，用户必须添加到 users 用户组 (见 gpasswd 命令).
</p>
<p>要查看 crontabs，用户应该运行下面的命令：
</p>
<pre>$ crontab -l
</pre>
<p>要编辑 crontabs，可以使用：
</p>
<pre>$ crontab -e
</pre>
<p>要移除 crontabs, 可以使用：
</p>
<pre>$ crontab -d
</pre>
<p>如果用户有一个保存好的 crontab 想要用它完全覆盖旧的 crontab，可以使用：
</p>
<pre>$ crontab <i>saved_crontab_filename</i>
</pre>
<p>想从命令行(<a href="https://en.wikipedia.org/wiki/stdin" class="extiw" title="wikipedia:stdin">Wikipedia:stdin</a>)覆盖一个 crontab，使用：
</p>
<pre>$ crontab - 
</pre>
<p>想编辑别的用户的 crontab, 使用root运行下面的命令:
</p>
<pre># crontab -u <i>username</i> -e
</pre>
<p>同一个格式 (追加 "-u <i>username</i>" 到命令后) 也可以用来列出或删除 crontabs。
</p>
<p>如果想使用 nano 而不是 vi 作为 crontab 编辑器，添加下面的变量到 <code>/etc/bash.bashrc</code>:
</p>
<pre>export EDITOR="/usr/bin/nano"
</pre>
<p>然后重启终端
</p>
<h2>
<span id=".E8.8C.83.E4.BE.8B"></span><span class="mw-headline" id="范例">范例</span>
</h2>
<p>下面的条目:
</p>
<pre>01 * * * * /bin/echo Hello, world!
</pre>
<p>将会在每个月的每一天的每一个小时的第一分钟（例如，在12：01，1：01，2：01等）执行命令 <code>/bin/echo Hello, world!</code> 
</p>
<p>类似地,
</p>
<pre>*/5 * * jan mon-fri /bin/echo Hello, world!
</pre>
<p>将会在一月的每个工作日每五分钟（例如，在12：00，12：05，12：10等）执行一次相同的命令。
</p>
<p>As noted in the <i>Crontab Format</i> section, the line:
</p>
<pre>*0,*5 9-16 * 1-5,9-12 1-5 /home/user/bin/i_love_cron.sh
</pre>
<p>Will execute the script <code>i_love_cron.sh</code> at five minute intervals from 9 AM to 5 PM (excluding 5 PM itself) every weekday (Mon-Fri) of every month except during the summer (June, July, and August).
</p>
<h2><span class="mw-headline" id="Examples">Examples</span></h2>
<p>The entry:
</p>
<pre>01 * * * * /bin/echo Hello, world!
</pre>
<p>runs the command <code>/bin/echo Hello, world!</code> on the first minute of every hour of every day of every month (i.e. at 12:01, 1:01, 2:01, etc.).
</p>
<p>Similarly:
</p>
<pre>*/5 * * jan mon-fri /bin/echo Hello, world!
</pre>
<p>runs the same job every five minutes on weekdays during the month of January (i.e. at 12:00, 12:05, 12:10, etc.).
</p>
<p>The line (as noted in "man 5 crontab"):
</p>
<pre>*0,*5 9-16 * 1-5,9-12 1-5 /home/user/bin/i_love_cron.sh
</pre>
<p>will execute the script <code>i_love_cron.sh</code> at five minute intervals from 9 AM to 5 PM (excluding 5 PM itself) every weekday (Mon-Fri) of every month except during the summer (June, July, and August).
</p>
<p>Periodical settings can also be entered as in this crontab template:
</p>
<pre># Chronological table of program loadings                                       
# Edit with "crontab" for proper functionality, "man 5 crontab" for formatting
# User: johndoe

# mm  hh  DD  MM  W /path/progam [--option]...  ( W = weekday: 0-6 [Sun=0] )
  21  01  *   *   * /usr/bin/systemctl hibernate
  @weekly           $HOME/.local/bin/trash-empty
</pre>
<p>Here are some self-explanatory crontab syntax examples:
</p>
<pre>30 4 echo "It is now 4:30 am."
0 22 echo "It is now 10 pm."
30 15 25 12 echo "It is 3:30pm on Christmas Day."
30 3 * * * echo "Remind me that it's 3:30am every day."
0 * * * * echo "It is the start of a new hour."
0 6 1,15 * * echo "At 6am on the 1st and 15th of every month."
0 6 * * 2,3,5 echo "At 6am on Tuesday, Wednesday and Thursdays."
59 23 * * 1-5 echo "Just before midnight on weekdays."
0 */2 * * * echo "Every two hours."
0 20 * * 4 echo "8pm on a Thursday."
0 20 * * Thu echo "8pm on a Thursday."
*/15 9-17 * * 2-5 echo "Every 15 minutes from 9am-5pm on weekdays."
@yearly echo "Happy New Year!"
</pre>
<h2><span class="mw-headline" id="Default_editor">Default editor</span></h2>
<p>To use an alternate default editor, define the <code>EDITOR</code> environment variable in a shell initialization script as described in <a href="../en/Environment_variables.html" title="Environment variables">Environment variables</a>.
</p>
<p>As a regular user, <code>su</code> will need to be used instead of <code>sudo</code> for the environment variable to be pulled correctly:
</p>
<pre>$ su -c "crontab -e"
</pre>
<p>To have an alias to this <code>printf</code> is required to carry the arbitrary string because <code>su</code> launches in a new shell:
</p>
<pre>alias scron="su -c $(printf "%q " "crontab -e")"
</pre>
<h2><span class="mw-headline" id="Running_X.org_server-based_applications">Running X.org server-based applications</span></h2>
<p>Cron does not run under the X.org server therefore it cannot know the environmental variable necessary to be able to start an X.org server application so they will have to be defined. One can use a program like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xuserrun-git/">xuserrun-git</a></span><sup><small>AUR</small></sup> to do it:
</p>
<pre>17 02 * ... /usr/bin/xuserrun /usr/bin/xclock
</pre>
<p>Or they can be defined manually (<code>echo $DISPLAY</code> will give the current DISPLAY value):
</p>
<pre>17 02 * ... env DISPLAY=:0 /usr/bin/xclock
</pre>
<p>If running notify-send for desktop notifications in cron, notify-send is sending values to dbus. So it needs to tell dbus to connect to the right bus. 
The address can be found by examining DBUS_SESSION_BUS_ADDRESS environment variable and setting it to the same value. Therefore: 
</p>
<pre>17 02 * ... env DBUS_SESSION_BUS_ADDRESS=your-address notify-send 'Foo bar'
</pre>
<p>If done through say SSH, permission will need be given:
</p>
<pre># xhost +si:localuser:$(whoami)
</pre>
<h2><span class="mw-headline" id="Asynchronous_job_processing">Asynchronous job processing</span></h2>
<p>If you regularly turn off your computer but do not want to miss jobs, there are some solutions available (easiest to hardest):
</p>
<h3><span class="mw-headline" id="Cronie">Cronie</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cronie">cronie</a></span> comes with anacron included. The project homepage says:
</p>
<p>Cronie contains the standard UNIX daemon crond that runs specified programs at scheduled times and related tools.
It is based on the original cron and has security and configuration enhancements like the ability to use pam and SELinux.
</p>
<h3><span class="mw-headline" id="Dcron">Dcron</span></h3>
<p>Vanilla <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dcron/">dcron</a></span><sup><small>AUR</small></sup> supports asynchronous job processing. Just put it with @hourly, @daily, @weekly or @monthly with a jobname, like this:
</p>
<pre>@hourly         ID=greatest_ever_job      echo This job is very useful.
</pre>
<h3><span class="mw-headline" id="Cronwhip">Cronwhip</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cronwhip/">cronwhip</a></span><sup><small>AUR</small></sup> is a script to automatically run missed cron jobs; it works with the former default cron implementation, <i>dcron</i>.
See also the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=57973">forum thread</a>.
</p>
<h3><span class="mw-headline" id="Anacron">Anacron</span></h3>
<p>Anacron is a full replacement for <i>dcron</i> which processes jobs asynchronously.
</p>
<p>It is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cronie">cronie</a></span>. The configuration file is <code>/etc/anacrontab</code>. Information on the format can be found in the <code>anacrontab(5)</code> <a href="../en/Man_page.html" title="Man page">man page</a>. Running <code>anacron -T</code> will test <code>/etc/anacrontab</code> for validity.
</p>
<h3><span class="mw-headline" id="Fcron">Fcron</span></h3>
<p>Like <i>anacron</i>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcron">fcron</a></span> assumes the computer is not always running and, unlike <i>anacron</i>, it can schedule events at intervals shorter than a single day which may be useful for systems which suspend/hibernate regularly (such as a laptop). Like cronwhip, fcron can run jobs that should have been run during the computer's downtime.
</p>
<p>When replacing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cronie">cronie</a></span> with fcron be aware the spool directory is <code>/var/spool/fcron</code> and the <code>fcrontab</code> command is used instead of <i>crontab</i> to edit the user crontabs. These crontabs are stored in a binary format with the text version next to them as <i>foo</i>.orig in the spool directory. Any scripts which manually edit user crontabs may need to be adjusted due to this difference in behavior.
</p>
<p>A quick scriptlet which may aide in converting traditional user crontabs to fcron format:
</p>
<pre>cd /var/spool/cron &amp;&amp; (
 for ctab in *; do
  fcrontab ${ctab} -u ${ctab}
 done
)
</pre>
<p>See also the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=140497">forum thread</a>.
</p>
<h2><span class="mw-headline" id="Ensuring_exclusivity">Ensuring exclusivity</span></h2>
<p>If you run potentially long-running jobs (e.g., a backup might all of a sudden run for a long time, because of many changes or a particular slow network connection), then <code>flock</code> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=util-linux">util-linux</a></span>) can ensure that the cron job won't start a second time.
</p>
<pre>  5,35 * * * * /usr/bin/flock -n /tmp/lock.backup /root/make-backup.sh
</pre>
<h2><span class="mw-headline" id="Cronie_2">Cronie</span></h2>
<p>The relevant file hierarchy for cronie is the following:
</p>
<pre>   /etc/
     |----- cron.d/
              | ----- 0hourly
     |----- cron.minutely/
     |----- cron.hourly/
              | ----- 0anacron
     |----- anacrontab
     |----- cron.daily/
     |----- cron.monthly/
     |----- cron.weekly/
     |----- crontab
     |----- cron.deny
</pre>
<p>Cronie provides both <i>cron</i> and <i>anacron</i> functionalities: <i>cron</i> runs jobs at regular time intervals (down to a granularity of one minute) as long as the system is available at the specified time, while <i>anacron</i> executes commands at
intervals specified in days.  Unlike cron, it does not assume that the system is running continuously. Whenever the system is up, <i>anacron</i> checks if there are any jobs that should have been run and handles them accordingly. 
</p>
<p>A <i>cron</i> job can be defined in a crontab-like file in the <code>/etc/cron.d</code> directory or added within the <code>/etc/crontab</code> file. Note the latter is not present by default but is used if it exists. As instructed by <code>/etc/cron.d/0hourly</code>, any executable file in <code>/etc/cron.hourly</code> will be run every hour (by default at minute 1 of the hour). Files in <code>/etc/cron.minutely</code> are executed every minute if instructed accordingly in <code>/etc/cron.d/0hourly</code>. The executables are typically shell scripts, symlinks to executable files can also be used. 
The <code>/etc/cron.deny</code> file includes the list of users not allowed to use crontab, without this file, only users listed in <code>/etc/cron.allow</code> can use it. 
</p>
<p><i>Anacron</i> works similarly, by executing the files in the <code>/etc/cron.daily</code>, <code>/etc/cron.weekly</code> and <code>/etc/cron.monthly</code> directories, placed there depending on the desired job frequency. The cron job <code>/etc/cron.hourly/0anacron</code> makes sure that <i>anacron</i> is run once daily to perform its pending tasks.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Cronie uses <code>run-parts</code> to carry out scripts in the different directories. The filenames should not include any dot (.) since <code>run-parts</code> in its default mode will silently ignore them (see <span class="plainlinks archwiki-template-man" title="$ man 8 run-parts"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/run-parts.8">run-parts(8)</a></span>). The names must consist only of upper and lower-case letters, digits, underscores and minus-hyphens.</li>
<li>The output of <code>systemctl status cronie</code> might show a message such as <code>CAN'T OPEN (/etc/crontab): No such file or directory</code>. However, this can be ignored since cronie does not require one.</li>
<li>Cronie is particular about the permissions for <code>/etc/cron.d/0hourly</code>. None of the tasks in <code>/etc/cron.d/{hourly,weekly,daily} ... etc</code> will be run (including the anacron launcher) if <code>/etc/cron.d/0hourly</code> is damaged or has improper permissions. <code>pacman -Qkk cronie</code> can show if you have any such issues.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To prevent the sending of output and stop email alert, add <code>&gt;/dev/null 2&gt;&amp;1</code> at the end of the line for each cron job to redirect output to /dev/null. 
<pre>0 1 5 10 * /path/to/script.sh &gt;/dev/null 2&gt;&amp;1
</pre>
You can also set <code>MAILTO=””</code> variable in your crontab file to  disable email alerts.</div>
<h2><span class="mw-headline" id="Dcron_2">Dcron</span></h2>
<p>The cron daemon parses a configuration file known as <code>crontab</code>. Each user on the system can maintain a separate crontab file to schedule commands individually. The root user's crontab is used to schedule system-wide tasks (though users may opt to use <code>/etc/crontab</code> or the <code>/etc/cron.d</code> directory, depending on which cron implementation they choose).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/spool/cron/root
</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Run command at a scheduled time
# Edit this 'crontab -e' for error checking, man 1 crontab for acceptable format

# &lt;@freq&gt;                       &lt;tags and command&gt;
@hourly         ID=sys-hourly   /usr/sbin/run-cron /etc/cron.hourly
@daily          ID=sys-daily    /usr/sbin/run-cron /etc/cron.daily
@weekly         ID=sys-weekly   /usr/sbin/run-cron /etc/cron.weekly
@monthly        ID=sys-monthly  /usr/sbin/run-cron /etc/cron.monthly

# mm  hh  DD  MM  W /path/command (or tags) # W = week: 0-6, Sun=0
  21  01  *   *   * /usr/bin/systemctl suspend
</pre>
<p>These lines exemplify one of the formats that crontab entries can have, namely whitespace-separated fields specifying:
</p>
<ol>
<li>@period</li>
<li>ID=jobname (this tag is specific to dcron)</li>
<li>command</li>
</ol>
<p>The other standard format for crontab entries is:
</p>
<ol>
<li>minute</li>
<li>hour</li>
<li>day</li>
<li>month</li>
<li>day of week</li>
<li>command</li>
</ol>
<p>The crontab files themselves are usually stored as <code>/var/spool/cron/username</code>. For example, root's crontab is found at <code>/var/spool/cron/root</code>
</p>
<p>See the crontab <a href="../en/Man_page.html" title="Man page">man page</a> for further information and configuration examples.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://www.gentoo.org/doc/en/cron-guide.xml">Gentoo Linux Cron Guide</a></li>
<li>
<a rel="nofollow" class="external text" href="https://crontab.guru/">crontab.guru</a> - online editor for cronjob expressions</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:System_administration.html" title="Category:System administration (简体中文)">System administration (简体中文)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Cron_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=618332">https://wiki.archlinux.org/index.php?title=Cron_(简体中文)&amp;oldid=618332</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 5 June 2020, at 07:01.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
