<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GnuPG (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GnuPG_简体中文 rootpage-GnuPG_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">GnuPG (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Related articles</p>
<ul>
<li><a href="../zh-CN/0306e39ac7285139de785bf9297b3d25.html" class="mw-redirect" title="Pacman/Package signing (简体中文)">pacman/Package signing (简体中文)</a></li>
<li><a href="../en/Data-at-rest_encryption.html" class="mw-redirect" title="Disk encryption">Disk encryption</a></li>
<li><a href="../en/List_of_applications/Security.html#Encryption,_signing,_steganography" title="List of applications/Security">List of applications/Security#Encryption, signing, steganography</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/GnuPG.html" title="GnuPG">GnuPG</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2016-07-27。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=GnuPG&amp;diff=0&amp;oldid=441685">更改</a>，则您可以帮助同步翻译。</div> 
<p>根据 <a rel="nofollow" class="external text" href="http://www.gnupg.org">官方网站</a>:
</p>
<dl><dd>GnuPG 是 RFC4880 OpenPGP 标准 PGP 的完整实现，自由软件。GnuPG 可以加密和签名数据和信息传递，包含一个通用的密钥管理系统，包含的访问模块可以访问各种公钥目录。 GnuPG, 简称 GPG, 是命令行工具，很方便和其它程序进行整合，具有很多前端程序和函数库。 GnuPG V2 还支持 S/MIME 和 Secure Shell (ssh).</dd></dl>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E7%9B%AE%E5%BD%95%E4%BD%8D%E7%BD%AE"><span class="tocnumber">2.1</span> <span class="toctext">目录位置</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2</span> <span class="toctext">配置文件</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#%E6%96%B0%E7%94%A8%E6%88%B7%E7%9A%84%E9%BB%98%E8%AE%A4%E9%80%89%E9%A1%B9"><span class="tocnumber">2.3</span> <span class="toctext">新用户的默认选项</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#%E7%94%A8%E6%B3%95"><span class="tocnumber">3</span> <span class="toctext">用法</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#%E5%88%9B%E5%BB%BA%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="tocnumber">3.1</span> <span class="toctext">创建密钥对</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#%E6%9F%A5%E7%9C%8B%E5%AF%86%E9%92%A5"><span class="tocnumber">3.2</span> <span class="toctext">查看密钥</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%E5%AF%BC%E5%87%BA%E5%85%AC%E9%92%A5"><span class="tocnumber">3.3</span> <span class="toctext">导出公钥</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#%E5%AF%BC%E5%85%A5%E5%85%AC%E5%85%B1%E5%AF%86%E9%92%A5"><span class="tocnumber">3.4</span> <span class="toctext">导入公共密钥</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E4%BD%BF%E7%94%A8%E5%85%AC%E9%92%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="tocnumber">3.5</span> <span class="toctext">使用公钥服务器</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86"><span class="tocnumber">3.6</span> <span class="toctext">加密与解密</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13">
<a href="#%E5%AF%86%E9%92%A5%E7%BB%B4%E6%8A%A4"><span class="tocnumber">4</span> <span class="toctext">密钥维护</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#%E7%BC%96%E8%BE%91%E4%BD%A0%E7%9A%84%E5%AF%86%E9%92%A5"><span class="tocnumber">4.1</span> <span class="toctext">编辑你的密钥</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Exporting_subkey"><span class="tocnumber">4.2</span> <span class="toctext">Exporting subkey</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Rotating_subkeys"><span class="tocnumber">4.3</span> <span class="toctext">Rotating subkeys</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17">
<a href="#%E7%AD%BE%E5%90%8D"><span class="tocnumber">5</span> <span class="toctext">签名</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Sign_a_file"><span class="tocnumber">5.1</span> <span class="toctext">Sign a file</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Clearsign_a_file_or_message"><span class="tocnumber">5.2</span> <span class="toctext">Clearsign a file or message</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Make_a_detached_signature"><span class="tocnumber">5.3</span> <span class="toctext">Make a detached signature</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Verify_a_signature"><span class="tocnumber">5.4</span> <span class="toctext">Verify a signature</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22">
<a href="#gpg-agent"><span class="tocnumber">6</span> <span class="toctext">gpg-agent</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#Configuration"><span class="tocnumber">6.1</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Reload_the_agent"><span class="tocnumber">6.2</span> <span class="toctext">Reload the agent</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#pinentry"><span class="tocnumber">6.3</span> <span class="toctext">pinentry</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Start_gpg-agent_with_systemd_user"><span class="tocnumber">6.4</span> <span class="toctext">Start gpg-agent with systemd user</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Unattended_passphrase"><span class="tocnumber">6.5</span> <span class="toctext">Unattended passphrase</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#SSH_agent"><span class="tocnumber">6.6</span> <span class="toctext">SSH agent</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-29">
<a href="#Smartcards"><span class="tocnumber">7</span> <span class="toctext">Smartcards</span></a>
<ul>
<li class="toclevel-2 tocsection-30"><a href="#GnuPG_only_setups"><span class="tocnumber">7.1</span> <span class="toctext">GnuPG only setups</span></a></li>
<li class="toclevel-2 tocsection-31">
<a href="#GnuPG_with_PSCD-Lite"><span class="tocnumber">7.2</span> <span class="toctext">GnuPG with PSCD-Lite</span></a>
<ul>
<li class="toclevel-3 tocsection-32"><a href="#Always_use_PSCD-Light"><span class="tocnumber">7.2.1</span> <span class="toctext">Always use PSCD-Light</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-33">
<a href="#%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="tocnumber">8</span> <span class="toctext">使用技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-34"><a href="#Different_algorithm"><span class="tocnumber">8.1</span> <span class="toctext">Different algorithm</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#Encrypt_a_password"><span class="tocnumber">8.2</span> <span class="toctext">Encrypt a password</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Revoking_a_key"><span class="tocnumber">8.3</span> <span class="toctext">Revoking a key</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#Change_trust_model"><span class="tocnumber">8.4</span> <span class="toctext">Change trust model</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#Hide_all_recipient_id's"><span class="tocnumber">8.5</span> <span class="toctext">Hide all recipient id's</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Using_caff_for_keysigning_parties"><span class="tocnumber">8.6</span> <span class="toctext">Using caff for keysigning parties</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-40">
<a href="#Troubleshooting"><span class="tocnumber">9</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="#Not_enough_random_bytes_available"><span class="tocnumber">9.1</span> <span class="toctext">Not enough random bytes available</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#su"><span class="tocnumber">9.2</span> <span class="toctext">su</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Agent_complains_end_of_file"><span class="tocnumber">9.3</span> <span class="toctext">Agent complains end of file</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#KGpg_configuration_permissions"><span class="tocnumber">9.4</span> <span class="toctext">KGpg configuration permissions</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="#Conflicts_between_gnome-keyring_and_gpg-agent"><span class="tocnumber">9.5</span> <span class="toctext">Conflicts between gnome-keyring and gpg-agent</span></a></li>
<li class="toclevel-2 tocsection-46"><a href="#mutt_and_gpg"><span class="tocnumber">9.6</span> <span class="toctext">mutt and gpg</span></a></li>
<li class="toclevel-2 tocsection-47"><a href="#%22Lost%22_keys,_upgrading_to_gnupg_version_2.1"><span class="tocnumber">9.7</span> <span class="toctext">"Lost" keys, upgrading to gnupg version 2.1</span></a></li>
<li class="toclevel-2 tocsection-48"><a href="#gpg_hanged_for_all_keyservers_(when_trying_to_receive_keys)"><span class="tocnumber">9.8</span> <span class="toctext">gpg hanged for all keyservers (when trying to receive keys)</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="#Smartcard_not_detected"><span class="tocnumber">9.9</span> <span class="toctext">Smartcard not detected</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-50"><a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">10</span> <span class="toctext">参阅</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../zh-CN/Help:Reading.html#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85" class="mw-redirect" title="安装">安装</a> 软件包 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span>.
</p>
<p>软件包 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pinentry">pinentry</a></span> 也会被同时安装，它是一个简单的 PIN 或 passphrase 输入对话框集合，GnuPG 用来输入密码，<i>pinentry</i> 的对话框是由软链接<code>/usr/bin/pinentry</code> 确定，默认指向 <code>/usr/bin/pinentry-gtk-2</code>.
</p>
<p>如果要图形界面和 GnuPG 进行整合，请查看 <a href="../en/List_of_applications/Security.html#Encryption,_signing,_steganography" title="List of applications/Security">List of applications/Security#Encryption, signing, steganography</a>.
</p>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<h3>
<span id=".E7.9B.AE.E5.BD.95.E4.BD.8D.E7.BD.AE"></span><span class="mw-headline" id="目录位置">目录位置</span>
</h3>
<p>GnuPG 用环境变量 <code>$GNUPGHOME</code> 定位配置文件的位置，默认情况下此变量并未被设置，会直接使用 <code>$HOME</code>，所以默认的配置目录是 <code>~/.gnupg</code>。
</p>
<p>要改变默认位置，执行 <code>$ gpg --homedir <i>path/to/file</i></code> 或在 <a href="../en/Autostarting.html" class="mw-redirect" title="Startup files">startup files</a> 中设置 <code>GNUPGHOME</code>。
</p>
<h3>
<span id=".E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="配置文件">配置文件</span>
</h3>
<p>默认的配置文件是 <code>~/.gnupg/gpg.conf</code> 和 <code>~/.gnupg/dirmngr.conf</code>. 
</p>
<p>gnupg 目录的默认 <a href="../en/File_permissions_and_attributes.html" class="mw-redirect" title="Permissions">权限</a> 是 <code>700</code>，其中文件的权限是 <code>600</code>. 仅目录的所有者有权读写，访问这些文件。这是基于安全考虑，请不要变更。如果不使用这样的安全权限设置，会收到不安全文件的警告。
</p>
<p>在文件中附加需要的文件，<code>/usr/share/gnupg</code> 包含基本架构文件. gpg 第一次运行时，如果配置文件不存在，会自动复制文件到 <code>~/.gnupg</code>.
</p>
<p>此外, <a href="../en/Pacman.html" title="Pacman">pacman</a> 使用单独的配置文件进行软件包的权限验证。详情请参考 <a href="../en/Pacman/Package_signing.html" title="Pacman/Package signing">Pacman/Package signing</a>。
</p>
<h3>
<span id=".E6.96.B0.E7.94.A8.E6.88.B7.E7.9A.84.E9.BB.98.E8.AE.A4.E9.80.89.E9.A1.B9"></span><span class="mw-headline" id="新用户的默认选项">新用户的默认选项</span>
</h3>
<p>要给新建用户设定一些默认选项，把配置文件放到 <code>/etc/skel/.gnupg/</code>. 系统创建新用户时，就会把文件复制到 GnuPG 目录。还有一个 <i>addgnupghome</i> 命令可以为已有用户创建新 GnuPG 主目录：
</p>
<pre># addgnupghome user1 user2
</pre>
<p>此命令会将对检查 <code>/home/user1/.gnupg</code> 和 <code>/home/user2/.gnupg</code>，如果用户的 GnuPG 主目录不存在，就会从 skeleton 目录复制文件过去。
</p>
<h2>
<span id=".E7.94.A8.E6.B3.95"></span><span class="mw-headline" id="用法">用法</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 如果命令需要一个 <i><code>&lt;user-id&gt;</code></i>， 可以使用 key ID, 指纹, 用户名和密码对等替代，GnuPG 这的处理很灵活。</div>
<h3>
<span id=".E5.88.9B.E5.BB.BA.E5.AF.86.E9.92.A5.E5.AF.B9"></span><span class="mw-headline" id="创建密钥对">创建密钥对</span>
</h3>
<p>用下面命令创建一个密钥对：
</p>
<pre>$ gpg --full-gen-key
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 使用 <code>--expert</code> 选项可以选择其它的 option for getting alternative 密码算法，比如 <a href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography" class="extiw" title="wikipedia:Elliptic curve cryptography">ECC</a>.</div>
<p>命令执行后会需要用户回答一些问题，大部分用户应该需要的是：
</p>
<ul>
<li>RSA (sign only) 和 a RSA (encrypt only) 密钥.</li>
<li>默认的密钥长度 (2048). 增大长度到 4096 "收益不大，但是付出很大"<a rel="nofollow" class="external autonumber" href="https://www.gnupg.org/faq/gnupg-faq.html#no_default_of_rsa4096">[1]</a>.</li>
<li>过期日期. 大部分用户可以选择一年. 这样即使无法访问 keyring, 用户也知道密钥已经过期。如果需要可以不重新建立密钥就延长过期时间。</li>
<li>用户名和电子邮件。可以给同样的密钥不同的身份，比如给同一个密钥关联多个电子邮件。</li>
<li>
<i>无</i> 可选注释，注释字段并没有被<a rel="nofollow" class="external text" href="https://lists.gnupg.org/pipermail/gnupg-devel/2015-July/030150.html">很好的定义</a>，作用有限。</li>
<li>
<a href="../en/Security.html#Choosing_secure_passwords" title="Security">a secure passphrase</a>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 任何导入密钥的人都可以看到这里的用户名和电子邮件地址。</div>
<h3>
<span id=".E6.9F.A5.E7.9C.8B.E5.AF.86.E9.92.A5"></span><span class="mw-headline" id="查看密钥">查看密钥</span>
</h3>
<p>查看公钥：
</p>
<pre>$ gpg --list-keys
</pre>
<p>查看私钥:
</p>
<pre>$ gpg --list-secret-keys
</pre>
<h3>
<span id=".E5.AF.BC.E5.87.BA.E5.85.AC.E9.92.A5"></span><span class="mw-headline" id="导出公钥">导出公钥</span>
</h3>
<p>gpg的主要用途即通过公钥加密信息以确保其私密性，你可以分发自己的公钥，而其他人通过该公钥加密发给你的信息。而你的私钥必须始终保密，否则将会威胁信息的私密性。相关内容，请参见<a href="https://en.wikipedia.org/wiki/Public-key_cryptopraphy" class="extiw" title="w:Public-key cryptopraphy">w:Public-key cryptopraphy</a>
所以其他人需要有你的公钥才能给你发加密信息。
</p>
<p>要生成公钥的 ASCII 版本，(例如通过电子邮件发布):
</p>
<pre>$ gpg --output <i>public.key</i> --armor --export <i>&lt;user-id&gt;</i>  
</pre>
<p>此外，还可以通过 <a href="#%E4%BD%BF%E7%94%A8%E5%85%AC%E9%92%A5%E6%9C%8D%E5%8A%A1%E5%99%A8">密钥服务器</a>分发公钥.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 使用 <code>--no-emit-version</code> 可以避免打印版本号，通过配置文件也可以进行此设置。</div>
<h3>
<span id=".E5.AF.BC.E5.85.A5.E5.85.AC.E5.85.B1.E5.AF.86.E9.92.A5"></span><span class="mw-headline" id="导入公共密钥">导入公共密钥</span>
</h3>
<p>要给其他人发送加密信息，或者验证他们的签名，就需要他们的公钥。通过文件 <code><i>public.key</i></code> 导入公钥到密钥环：
</p>
<pre>$ gpg --import <i>public.key</i>
</pre>
<p>此外，还可以通过密钥服务器导入公钥。
</p>
<h3>
<span id=".E4.BD.BF.E7.94.A8.E5.85.AC.E9.92.A5.E6.9C.8D.E5.8A.A1.E5.99.A8"></span><span class="mw-headline" id="使用公钥服务器">使用公钥服务器</span>
</h3>
<p>你可以将你的公钥注册到一个公共的密钥服务器，这样其他人不用联系你就能获取到你的公钥：
</p>
<pre>$ gpg --send-keys <i>&lt;key-id&gt;</i>
</pre>
<p>要查询公钥的详细信息而不是导入，执行：
</p>
<pre>$ gpg --search-keys <i>&lt;key-id&gt;</i>
</pre>
<p>要导入一个公钥：
</p>
<pre>$ gpg --recv-keys <i>&lt;key-id&gt;</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 任何人都可以将公钥注册到密钥服务器上，因此不应该完全信任从密钥服务器上所检索到的某人的公钥。你应该通过将你检索到的公钥的指纹与该公钥所有者在可信任的来源（如该公钥所有者的博客或网站）所发布的指纹进行比较，或是直接通过电话或邮件联系该公钥所有者进行确认，以确保你检索到的公钥的真实性。使用多种方式进行验证可以提高你所检索到的公钥的可信度。更多相关信息，请参见<a href="https://en.wikipedia.org/wiki/Public_key_fingerprint" class="extiw" title="wikipedia:Public key fingerprint">Wikipedia:Public key fingerprint</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>在 <code>gnupg.conf</code> 中加入 <code>keyserver-options auto-key-retrieve</code> 则会根据需要自动从密钥服务器中获取公钥.</li>
<li>另一个可用的密钥服务器为 <code>pool.sks-keyservers.net</code> ，可以在 <code>dirmngr.conf</code>中通过 <code>keyserver</code> 指定 . 详见 <a href="https://en.wikipedia.org/wiki/Key_server_(cryptographic)#Keyserver_examples" class="extiw" title="wikipedia:Key server (cryptographic)">wikipedia:Key server (cryptographic)#Keyserver examples</a>.</li>
<li>你也可以通过 <code>--use-tor</code> 来使用 <a href="../en/Tor.html" title="Tor">Tor</a> 连接密钥服务器. <code>hkp://jijrk5u4osbsr34t5.onion</code>  是sks-keyservers pool的洋葱网络地址. 详见<a rel="nofollow" class="external text" href="https://gnupg.org/blog/20151224-gnupg-in-november-and-december.html">See this GnuPG blog post</a> .</li>
<li>你可以通过设置环境变量 <code>http_proxy</code> 并在 <code>dirmngr.conf</code> 中写入 <code>honor-http-proxy</code> 以使用代理访问密钥服务器。或者，你也可以通过在 <code>dirmngr.conf</code> 中写入 <code>http-proxy host[:port]</code> 以直接覆盖环境变量<code>http_proxy</code>来使用代理. </li>
</ul>
</div>
<h3>
<span id=".E5.8A.A0.E5.AF.86.E4.B8.8E.E8.A7.A3.E5.AF.86"></span><span class="mw-headline" id="加密与解密">加密与解密</span>
</h3>
<p>在加密(参数<code>--encrypt</code>或<code>-e</code>)一个文件或一条信息给另外一个人(参数<code>--recipient</code>或<code>-r</code>)之前，你需要先<a href="#%E5%AF%BC%E5%85%A5%E5%85%AC%E5%85%B1%E5%AF%86%E9%92%A5">导入他的公钥</a>
</p>
<p>为加密一个名为<i>doc</i>的文件:
</p>
<pre>$ gpg --recipient <i>&lt;user-id&gt;</i> --encrypt <i>doc</i>
</pre>
<p>为解密 (option <code>--decrypt</code> or <code>-d</code>) 一个通过你的公钥加密的名为 <i>doc.gpg</i> 的文件:
</p>
<pre>$ gpg --output <i>doc</i> --decrypt <i>doc.gpg</i>
</pre>
<p><i>gpg</i> 会提示你输入passphrase并将 <i>doc.gpg</i> 中的数据解密到 <i>doc</i>. 如果你忽略了参数 <code>-o</code> (<code>--output</code>) , <i>gpg</i> 将会直接输出解密的信息.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>使用参数 <code>--armor</code> 以ASCII编码的形式解密文件 (适用于复制与粘贴文本文件格式的消息)</li>
<li>使用 <code>-R <i>&lt;user-id&gt;</i></code> 或 <code>--hidden-recipient <i>&lt;user-id&gt;</i></code> 代替 <code>-r</code> 可以不将收件人的指纹ID放入加密的消息中. 这有助于隐藏收件人的信息，是针对流量分析的一个有限对策.</li>
<li>使用 <code>--no-emit-version</code> 以避免打印版本号，或者用以将相应配置添加到你的配置文件中.</li>
<li>你可以通过<i>gpg</i>将自己作为收件人来加密敏感文件，但是每次只能压缩一个文件——尽管你可以将多个文件压缩后再进行加密。如果需要加密一个目录或一整个文件系统，请参见 <a href="../en/Data-at-rest_encryption.html#Available_methods" class="mw-redirect" title="Disk encryption">Disk encryption#Available methods</a> .</li>
</ul>
</div>
<h2>
<span id=".E5.AF.86.E9.92.A5.E7.BB.B4.E6.8A.A4"></span><span class="mw-headline" id="密钥维护">密钥维护</span>
</h2>
<h3>
<span id=".E7.BC.96.E8.BE.91.E4.BD.A0.E7.9A.84.E5.AF.86.E9.92.A5"></span><span class="mw-headline" id="编辑你的密钥">编辑你的密钥</span>
</h3>
<p>Running the <code>gpg --edit-key <i>&lt;user-id&gt;</i></code> command will present a menu which enables you to do most of your key management related tasks.
</p>
<p>Some useful commands in the edit key sub menu:
</p>
<pre>&gt; passwd       # change the passphrase
&gt; clean        # compact any user ID that is no longer usable (e.g revoked or expired)
&gt; revkey       # revoke a key
&gt; addkey       # add a subkey to this key
&gt; expire       # change the key expiration time
</pre>
<p>Type <code>help</code> in the edit key sub menu for more commands.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you have multiple email accounts you can add each one of them as an identity, using <code>adduid</code> command. You can then set your favourite one as <code>primary</code>.</div>
<h3><span class="mw-headline" id="Exporting_subkey">Exporting subkey</span></h3>
<p>If you plan to use the same key across multiple devices, you may want to strip out your master key and only keep the bare minimum encryption subkey on less secure systems.
</p>
<p>First, find out which subkey you want to export.
</p>
<pre>$ gpg -K
</pre>
<p>Select only that subkey to export.
</p>
<pre>$ gpg -a --export-secret-subkeys [subkey id]! &gt; /tmp/subkey.gpg
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you forget to add the !, all of your subkeys will be exported.</div>
<p>At this point you could stop, but it is most likely a good idea to change the passphrase as well. Import the key into a temporary folder. 
</p>
<pre>$ gpg --homedir /tmp/gpg --import /tmp/subkey.gpg
$ gpg --homedir /tmp/gpg --edit-key <i>&lt;user-id&gt;</i>
&gt; passwd
&gt; save
$ gpg --homedir /tmp/gpg -a --export-secret-subkeys [subkey id]! &gt; /tmp/subkey.altpass.gpg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You will get a warning that the master key was not available and the password was not changed, but that can safely be ignored as the subkey password was.</div>
<p>At this point, you can now use <code>/tmp/subkey.altpass.gpg</code> on your other devices.
</p>
<h3><span class="mw-headline" id="Rotating_subkeys">Rotating subkeys</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <b>Never</b> delete your expired or revoked subkeys unless you have a good reason. Doing so will cause you to lose the ability to decrypt files encrypted with the old subkey. Please <b>only</b> delete expired or revoked keys from other users to clean your keyring.</div>
<p>If you have set your subkeys to expire after a set time, you can create new ones. Do this a few weeks in advance to allow others to update their keyring.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You do not need to create a new key simply because it is expired. You can extend the expiration date.</div>
<p>Create new subkey (repeat for both signing and encrypting key)
</p>
<pre>$ gpg --edit-key <i>&lt;user-id&gt;</i>
&gt; addkey
</pre>
<p>And answer the following questions it asks (see previous section for suggested settings).
</p>
<p>Save changes
</p>
<pre>&gt; save
</pre>
<p>Update it to a keyserver.
</p>
<pre>$ gpg --keyserver pgp.mit.edu --send-keys <i>&lt;user-id&gt;</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Revoking expired subkeys is unnecessary and arguably bad form. If you are constantly revoking keys, it may cause others to lack confidence in you.</div>
<h2>
<span id=".E7.AD.BE.E5.90.8D"></span><span class="mw-headline" id="签名">签名</span>
</h2>
<p>Signatures certify and timestamp documents. If the document is modified, verification of the signature will fail. Unlike encryption which uses public keys to encrypt a document, signatures are created with the user's private key. The recipient of a signed document then verifies the signature using the sender's public key.
</p>
<h3><span class="mw-headline" id="Sign_a_file">Sign a file</span></h3>
<p>To sign a file use the <code>--sign</code> or <code>-s</code> flag:
</p>
<pre> $ gpg --output <i>doc.sig</i> --sign <i>doc</i>
</pre>
<p>The above also encrypts the file and stores it in binary format.
</p>
<h3><span class="mw-headline" id="Clearsign_a_file_or_message">Clearsign a file or message</span></h3>
<p>To sign a file without compressing it into binary format use:
</p>
<pre> $ gpg --clearsign <i>doc</i>
</pre>
<p>This wraps the document into an ASCII-armored signature, but does not modify the document.
</p>
<h3><span class="mw-headline" id="Make_a_detached_signature">Make a detached signature</span></h3>
<p>To create a separate signature file to be distributed separately from the document or file itself, use the <code>--detach-sig</code> flag:
</p>
<pre> $ gpg --output <i>doc.sig</i> --detach-sig <i>doc</i>
</pre>
<p>This method is often used in distributing software projects to allow users to verify that the program has not been modified by a third part.
</p>
<h3><span class="mw-headline" id="Verify_a_signature">Verify a signature</span></h3>
<p>To verify a signature use the <code>--verify</code> flag:
</p>
<pre> $ gpg --verify <i>doc.sig</i>
</pre>
<p>where <code><i>doc.sig</i></code> is the signature you wish to verify.
</p>
<p>To verify and decrypt a file at the same time, use the <code>--decrypt</code> flag as you normally would in decrypting a file.
</p>
<p>If you are verifying a detached signature, both the file and the signature must be present when verifying. For example, to verify Arch Linux's latest iso you would do:
</p>
<pre> $ gpg --verify <i>archlinux-&lt;version&gt;-dual.iso.sig</i>
</pre>
<p>where <code><i>archlinux-&lt;version&gt;-dual.iso</i></code> must be located in the same directory.
</p>
<h2><span class="mw-headline" id="gpg-agent">gpg-agent</span></h2>
<p><i>gpg-agent</i> is mostly used as daemon to request and cache the password for the keychain. This is useful if GnuPG is used from an external program like a mail client.
</p>
<p>Starting with GnuPG 2.1.0 the use of <i>gpg-agent</i> is required. <i>gpg-agent</i> is started on-demand by the GnuPG tools, so there is usually no reason to start it manually.
</p>
<h3><span class="mw-headline" id="Configuration">Configuration</span></h3>
<p>gpg-agent can be configured via <code>~/.gnupg/gpg-agent.conf</code> file. The configuration options are listed in <span class="plainlinks archwiki-template-man" title="$ man 1 gpg-agent"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg-agent.1">gpg-agent(1)</a></span>. For example you can change cache ttl for unused keys:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default-cache-ttl 3600
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To cache your passphrase for the whole session, please run the following command:
<pre>$ /usr/lib/gnupg/gpg-preset-passphrase --preset XXXXXX
</pre>
<p>where XXXX is the keygrip. You can get its value when running <code>gpg --with-keygrip -K</code>. Passphrase will be stored until <code>gpg-agent</code> is restarted. If you set up <code>default-cache-ttl</code> value, it will take precedence.
</p>
</div>
<h3><span class="mw-headline" id="Reload_the_agent">Reload the agent</span></h3>
<p>After changing the configuration, reload the agent using <i>gpg-connect-agent</i>:
</p>
<pre>$ gpg-connect-agent reloadagent /bye
</pre>
<p>The command should print <code>OK</code>.
</p>
<h3><span class="mw-headline" id="pinentry">pinentry</span></h3>
<p>Finally, the agent needs to know how to ask the user for the password. This can be set in the gpg-agent configuration file.
</p>
<p>The default uses a gtk dialog. There are other options - see <code>info pinentry</code>. To change the dialog implementation set <code>pinentry-program</code> configuration option:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

# PIN entry program
# pinentry-program /usr/bin/pinentry-curses
# pinentry-program /usr/bin/pinentry-qt
# pinentry-program /usr/bin/pinentry-kwallet

pinentry-program /usr/bin/pinentry-gtk-2
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> For using <code>/usr/bin/pinentry-kwallet</code> you have to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kwalletcli/">kwalletcli</a></span><sup><small>AUR</small></sup> package.</div>
<p>After making this change, reload the gpg-agent.
</p>
<h3><span class="mw-headline" id="Start_gpg-agent_with_systemd_user">Start gpg-agent with systemd user</span></h3>
<p>It is possible to use the <a href="../en/Systemd/User.html" title="Systemd/User">Systemd/User</a> facilities to start the agent.
</p>
<p>Create a systemd unit file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/gpg-agent.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=GnuPG private key agent
IgnoreOnIsolate=true

[Service]
Type=forking
ExecStart=/usr/bin/gpg-agent --daemon
Restart=on-abort

[Install]
WantedBy=default.target</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you use non-default value for the <a href="#GNUPGHOME">#GNUPGHOME</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> environment variable, you need to pass it to the service. See <a href="../en/Systemd/User.html#Environment_variables" title="Systemd/User">systemd/User#Environment variables</a> for details.</div>
<h3><span class="mw-headline" id="Unattended_passphrase">Unattended passphrase</span></h3>
<p>Starting with GnuPG 2.1.0 the use of gpg-agent and pinentry is required, which may break backwards compatibility for passphrases piped in from STDIN using the <code>--passphrase-fd 0</code> commandline option. In order to have the same type of functionality as the older releases two things must be done:
</p>
<p>First, edit the gpg-agent configuration to allow <i>loopback</i> pinentry mode:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allow-loopback-pinentry</pre>
<p>Restart the gpg-agent process if it is running to let the change take effect.
</p>
<p>Second, either the application needs to be updated to include a commandline parameter to use loopback mode like so:
</p>
<pre>$ gpg --pinentry-mode loopback ...
</pre>
<p>...or if this is not possible, add the option to the configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pinentry-mode loopback</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The upstream author indicates setting <code>pinentry-mode loopback</code> in <code>gpg.conf</code> may break other usage, using the commandline option should be preferred if at all possible. <a rel="nofollow" class="external autonumber" href="https://bugs.g10code.com/gnupg/issue1772">[2]</a><sup title="最后检查状态：SSL error">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup>
</div>
<h3><span class="mw-headline" id="SSH_agent">SSH agent</span></h3>
<p><i>gpg-agent</i> has OpenSSH agent emulation. If you already use the GnuPG suite, you might consider using its agent to also cache your SSH keys.  Additionally, some users may prefer the PIN entry dialog GnuPG agent provides as part of its passphrase management.
</p>
<p>To start using GnuPG agent for your SSH keys, enable SSH support in the <code>~/.gnupg/gpg-agent.conf</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">enable-ssh-support
</pre>
<p>Next, make sure that <i>gpg-agent</i> is always started. Either follow <a href="#Start_gpg-agent_with_systemd_user">#Start gpg-agent with systemd user</a>, or add the following to your <code>.bashrc</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Start the gpg-agent if not already running
if ! pgrep -x -u "${USER}" gpg-agent &gt;/dev/null 2&gt;&amp;1; then
  gpg-connect-agent /bye &gt;/dev/null 2&gt;&amp;1
fi
</pre>
<p>Then set <code>SSH_AUTH_SOCK</code> so that SSH will use <i>gpg-agent</i> instead of <i>ssh-agent</i>. To make sure each process can find your <i>gpg-agent</i> instance regardless of e.g. the type of shell it is child of use <a href="../en/Environment_variables.html#Using_pam_env" title="Environment variables">pam_env</a>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.pam_environment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SSH_AGENT_PID	DEFAULT=
SSH_AUTH_SOCK	DEFAULT="${XDG_RUNTIME_DIR}/gnupg/S.gpg-agent.ssh"</pre>
<p>Alternatively, depend on Bash:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Set SSH to use gpg-agent
unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
  export SSH_AUTH_SOCK="/run/user/$UID/gnupg/S.gpg-agent.ssh"
fi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you use non-default GnuPG <a href="#Directory_location">#Directory location</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>, run <code>gpgconf --create-socketdir</code> to create a socket directory under <code>/run/user/$UID/gnupg/</code>. Otherwise the socket will be placed in the GnuPG home directory.</li>
<li>The test involving the <code>gnupg_SSH_AUTH_SOCK_by</code> variable is for the case where the agent is started as <code>gpg-agent --daemon /bin/sh</code>, in which case the shell inherits the <code>SSH_AUTH_SOCK</code> variable from the parent, <i>gpg-agent</i> <a rel="nofollow" class="external autonumber" href="http://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=agent/gpg-agent.c;hb=7bca3be65e510eda40572327b87922834ebe07eb#l1307">[3]</a>.</li>
</ul>
</div>
<p>Also set the GPG_TTY and refresh the TTY in case user has switched into an X session as stated in <span class="plainlinks archwiki-template-man" title="$ man 1 gpg-agent"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg-agent.1">gpg-agent(1)</a></span>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Set GPG TTY
export GPG_TTY=$(tty)

# Refresh gpg-agent tty in case user switches into an X session
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
</pre>
<p>Once <i>gpg-agent</i> is running you can use <i>ssh-add</i> to approve keys, following the same steps as for <a href="../en/SSH_keys.html#ssh-agent" title="SSH keys">ssh-agent</a>. The list of approved keys is stored in the <code>~/.gnupg/sshcontrol</code> file. Once your key is approved, you will get a <i>pinentry</i> dialog every time your passphrase is needed. You can control passphrase caching in the <code>~/.gnupg/gpg-agent.conf</code> file. The following example would have <i>gpg-agent</i> cache your keys for 3 hours:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default-cache-ttl-ssh 10800
</pre>
<h2><span class="mw-headline" id="Smartcards">Smartcards</span></h2>
<p>GnuPG uses <i>scdaemon</i> as an interface to your smartcard reader, please refer to the <a href="../en/Man_page.html" title="Man page">man page</a> for details.
</p>
<h3><span class="mw-headline" id="GnuPG_only_setups">GnuPG only setups</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  To allow scdaemon direct access to USB smarcard readers the optional dependency <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libusb-compat">libusb-compat</a></span> have to be installed</div>
<p>If you do not plan to use other cards but those based on GnuPG, you should check the <code>reader-port</code> parameter in <code>~/.gnupg/scdaemon.conf</code>. The value '0' refers to the first available serial port reader and a value of '32768' (default) refers to the first USB reader.
</p>
<h3><span class="mw-headline" id="GnuPG_with_PSCD-Lite">GnuPG with PSCD-Lite</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pcsclite">pcsclite</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ccid">ccid</a></span> have to be installed, and the contained <a href="../en/Systemd.html#Using_units" title="Systemd">systemd</a> service <code>pcscd.service</code> has to be running, or the socket <code>pcscd.socket</code> has to be listening.</div>
<p>PSCD-Lite is a daemon which handles access to smartcard (SCard API). If GnuPG's scdaemon fails to connect the smartcard directly (e.g. by using its integrated CCID support), it will fallback and try to find a smartcard using the PSCD-Lite driver.
</p>
<h4><span class="mw-headline" id="Always_use_PSCD-Light">Always use PSCD-Light</span></h4>
<p>If you are using any smartcard with an opensc driver (e.g.: ID cards from some countries) you should pay some attention to GnuPG configuration. Out of the box you might receive a message like this when using <code>gpg --card-status</code>
</p>
<pre>gpg: selecting openpgp failed: ec=6.108
</pre>
<p>By default, scdaemon will try to connect directly to the device. This connection will fail if the reader is being used by another process. For example: the pcscd daemon used by OpenSC. To cope with this situation we should use the same underlying driver as opensc so they can work well together. In order to point scdaemon to use pcscd you should remove <code>reader-port</code> from <code>~/.gnupg/scdaemon.conf</code>, specify the location to <code>libpcsclite.so</code> library and disable ccid so we make sure that we use pcscd:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/scdaemon.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pcsc-driver /usr/lib/libpcsclite.so
card-timeout 5
disable-ccid
</pre>
<p>Please check <span class="plainlinks archwiki-template-man" title="$ man 1 scdaemon"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/scdaemon.1">scdaemon(1)</a></span> if you do not use OpenSC.
</p>
<h2>
<span id=".E4.BD.BF.E7.94.A8.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="使用技巧">使用技巧</span>
</h2>
<h3><span class="mw-headline" id="Different_algorithm">Different algorithm</span></h3>
<p>You may want to use stronger algorithms:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed
personal-cipher-preferences TWOFISH CAMELLIA256 AES 3DES
</pre>
<p>In the latest version of GnuPG, the default algorithms used are SHA256 and AES, both of which are secure enough for most people. However, if you are using a version of GnuPG older than 2.1, or if you want an even higher level of security, then you should follow the above step.
</p>
<h3><span class="mw-headline" id="Encrypt_a_password">Encrypt a password</span></h3>
<p>It can be useful to encrypt some password, so it will not be written in clear on a configuration file. A good example is your email password.
</p>
<p>First create a file with your password. You <b>need</b> to leave <b>one</b> empty line after the password, otherwise gpg will return an error message when evaluating the file.
</p>
<p>Then run:
</p>
<pre>$ gpg -e -a -r <i>&lt;user-id&gt;</i> <i>your_password_file</i>
</pre>
<p><code>-e</code> is for encrypt, <code>-a</code> for armor (ASCII output), <code>-r</code> for recipient user ID.
</p>
<p>You will be left with a new <code><i>your_password_file</i>.asc</code> file.
</p>
<h3><span class="mw-headline" id="Revoking_a_key">Revoking a key</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Anybody having access to your revocation certificate can revoke your key, rendering it useless.</li>
<li>Key revocation should only be performed if your key is compromised or lost, or you forget your passphrase.</li>
</ul>
</div>
<p>Revocation certificates are automatically generated for newly generated keys, although one can be generated manually by the user later. These are located at <code>~/.gnupg/openpgp-revocs.d/</code>. The filename of the certificate is the fingerprint of the key it will revoke.
</p>
<p>To revoke your key, simply import the revocation certificate:
</p>
<pre>$ gpg --import <i>&lt;fingerprint&gt;</i>.rev
</pre>
<p>Now update the keyserver:
</p>
<pre>$ gpg --keyserver subkeys.pgp.net --send <i>&lt;userid&gt;</i>
</pre>
<h3><span class="mw-headline" id="Change_trust_model">Change trust model</span></h3>
<p>By default GnuPG uses the <a href="https://en.wikipedia.org/wiki/Web_of_Trust" class="extiw" title="wikipedia:Web of Trust">Web of Trust</a> as the trust model. You can change this to <a href="https://en.wikipedia.org/wiki/Trust_on_First" class="extiw" title="wikipedia:Trust on First">Trust on First</a> Use by adding <code>--trust-model=tofu</code> when adding a key or adding this option to your GnuPG configuration file. More details are in <a rel="nofollow" class="external text" href="https://lists.gnupg.org/pipermail/gnupg-devel/2015-October/030341.html">this email to the GnuPG list</a>.
</p>
<h3>
<span id="Hide_all_recipient_id.27s"></span><span class="mw-headline" id="Hide_all_recipient_id's">Hide all recipient id's</span>
</h3>
<p>By default the recipient's key ID is in the encrypted message. This can be removed at encryption time for a recipient by using <code>hidden-recipient <i>&lt;user-id&gt;</i></code>. To remove it for all recipients add <code>throw-keyids</code> to your configuration file. This helps to hide the receivers of the message and is a limited countermeasure against traffic analysis. (Using a little social engineering anyone who is able to decrypt the message can check whether one of the other recipients is the one he suspects.)  On the receiving side, it may slow down the decryption process because all available secret keys must be tried (<i>e.g.</i> with <code>--try-secret-key <i>&lt;user-id&gt;</i></code>).
</p>
<h3><span class="mw-headline" id="Using_caff_for_keysigning_parties">Using caff for keysigning parties</span></h3>
<p>To allow users to validate keys on the keyservers and in their keyrings (i.e. make sure they are from whom they claim to be), PGP/GPG uses he <a href="https://en.wikipedia.org/wiki/Web_of_Trust" class="extiw" title="wikipedia:Web of Trust">Web of Trust</a>. Keysigning parties allow users to get together in physical location to validate keys. The <a href="https://en.wikipedia.org/wiki/Zimmermann%E2%80%93Sassaman_key-signing_protocol" class="extiw" title="wikipedia:Zimmermann–Sassaman key-signing protocol">Zimmermann-Sassaman</a> key-signing protocol is a way of making these very effective. <a rel="nofollow" class="external text" href="http://www.cryptnet.net/fdp/crypto/keysigning_party/en/keysigning_party.html">Here</a> you will find a how-to article.
</p>
<p>For an easier process of signing keys and sending signatures to the owners after a keysigning party, you can use the tool <i>caff</i>. It can be installed from the AUR with the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/caff-svn/">caff-svn</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>.
</p>
<p>To send the signatures to their owners you need a working <a href="https://en.wikipedia.org/wiki/Message_transfer_agent" class="extiw" title="wikipedia:Message transfer agent">MTA</a>. If you do not have already one, install <a href="../en/Msmtp.html" title="Msmtp">msmtp</a>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Not_enough_random_bytes_available">Not enough random bytes available</span></h3>
<p>When generating a key, gpg can run into this error:
</p>
<pre>Not enough random bytes available. Please do some other work to give the OS a chance to collect more entropy!
</pre>
<p>To check the available entropy, check the kernel parameters:
</p>
<pre>cat /proc/sys/kernel/random/entropy_avail
</pre>
<p>A healthy Linux system with a lot of entropy available will have return close to the full 4,096 bits of entropy. If the value returned is less than 200, the system is running low on entropy. 
</p>
<p>To solve it, remember you do not often need to create keys and best just do what the message suggests (e.g. create disk activity, move the mouse, edit the wiki - all will create entropy). If that does not help, check which service is using up the entropy and consider stopping it for the time. If that is no alternative, see <a href="../en/Random_number_generation.html#Alternatives" title="Random number generation">Random number generation#Alternatives</a>.
</p>
<h3><span class="mw-headline" id="su">su</span></h3>
<p>When using <code>pinentry</code>, you must have the proper permissions of the terminal device (e.g. <code>/dev/tty1</code>) in use. However, with <i>su</i> (or <i>sudo</i>), the ownership stays with the original user, not the new one. This means that pinentry will fail, even as root. The fix is to change the permissions of the device at some point before the use of pinentry (i.e. using gpg with an agent). If doing gpg as root, simply change the ownership to root right before using gpg:
</p>
<pre>chown root /dev/ttyN  # where N is the current tty
</pre>
<p>and then change it back after using gpg the first time. The equivalent is likely to be true with <code>/dev/pts/</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The owner of tty <i>must</i> match with the user for which pinentry is running. Being part of the group <code>tty</code> <b>is not</b> enough.</div>
<h3><span class="mw-headline" id="Agent_complains_end_of_file">Agent complains end of file</span></h3>
<p>The default pinentry program is pinentry-gtk-2, which needs a DBus session bus to run properly. See <a href="../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">General troubleshooting#Session permissions</a> for details.
</p>
<p>Alternatively, you can use <code>pinentry-qt</code>. See <a href="#pinentry">#pinentry</a>.
</p>
<h3><span class="mw-headline" id="KGpg_configuration_permissions">KGpg configuration permissions</span></h3>
<p>There have been issues with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdeutils-kgpg">kdeutils-kgpg</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> being able to access the <code>~/.gnupg/</code> options. One issue might be a result of a deprecated <i>options</i> file, see the <a rel="nofollow" class="external text" href="https://bugs.kde.org/show_bug.cgi?id=290221">bug</a> report.
</p>
<p>Another user reported that <i>KGpg</i> failed to start until the <code>~/.gnupg</code> folder is set to <code>drwxr-xr-x</code> permissions. If you require this work-around, ensure that the directory contents retain <code>-rw-------</code> permissions! Further, report it as a bug to the <a rel="nofollow" class="external text" href="https://bugs.kde.org/buglist.cgi?quicksearch=kgpg">developers</a>.
</p>
<h3><span class="mw-headline" id="Conflicts_between_gnome-keyring_and_gpg-agent">Conflicts between gnome-keyring and gpg-agent</span></h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> See <a href="#GPG_AGENT_INFO">#GPG_AGENT_INFO</a> (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:GnuPG_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:GnuPG (简体中文)#</a>)</div>
</div>
<p>While the Gnome keyring implements a GPG agent component, as of GnuPG version 2.1, GnuPG ignores the <code>GPG_AGENT_INFO</code> environment variable, so that Gnome keyring can no longer be used as a GPG agent.
</p>
<p>However, since version 0.9.6 the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pinentry">pinentry</a></span> provides the <code>pinentry-gnome3</code> program. You may set the following option in your <code>gpg-agent.conf</code> file
</p>
<pre> pinentry-program /usr/bin/pinentry-gnome3
</pre>
<p>in order to make use of that pinentry program.
</p>
<p>Since version 0.9.2 all pinentry programs can be configured to optionally save a passphrase with libsecret. For example, when the user is asked for a passphrase via <code>pinentry-gnome3</code>, a checkbox is shown whether to save the passphrase using a password manager. Unfortunately, the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pinentry">pinentry</a></span> does not have this feature enabled (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/46059">FS#46059</a> for the reasons). You may use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pinentry-libsecret/">pinentry-libsecret</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> as a replacement for it, which has support for libsecret enabled.
</p>
<h3><span class="mw-headline" id="mutt_and_gpg">mutt and gpg</span></h3>
<p>To be asked for your GnuPG password only once per session as of GnuPG 2.1, see <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1490821#p1490821">this forum thread</a>.
</p>
<h3>
<span id=".22Lost.22_keys.2C_upgrading_to_gnupg_version_2.1"></span><span class="mw-headline" id='"Lost"_keys,_upgrading_to_gnupg_version_2.1'>"Lost" keys, upgrading to gnupg version 2.1</span>
</h3>
<p>When <code>gpg --list-keys</code> fails to show keys that used to be there, and applications complain about missing or invalid keys, some keys may not have been migrated to the new format.
</p>
<p>Please read <a rel="nofollow" class="external text" href="http://jo-ke.name/wp/?p=111">GnuPG invalid packet workaround</a><sup title="最后检查状态：domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-02 ⓘ]</sup>. Basically, it says that there is a bug with keys in the old <code>pubring.gpg</code> and <code>secring.gpg</code> files, which have now been superseded by the new <code>pubring.kbx</code> file and the <code>private-keys-v1.d/</code> subdirectory and files.  Your missing keys can be recovered with the following commnads:
</p>
<pre>$ cd
$ cp -r .gnupg gnupgOLD
$ gpg --export-ownertrust &gt; otrust.txt
$ gpg --import .gnupg/pubring.gpg
$ gpg --import-ownertrust otrust.txt
$ gpg --list-keys
</pre>
<h3>
<span id="gpg_hanged_for_all_keyservers_.28when_trying_to_receive_keys.29"></span><span class="mw-headline" id="gpg_hanged_for_all_keyservers_(when_trying_to_receive_keys)">gpg hanged for all keyservers (when trying to receive keys)</span>
</h3>
<p>If gpg hanged with a certain keyserver when trying to receive keys, you might need to kill dirmngr in order to get access to other keyservers which are actually working, otherwise it might keeping hanging for all of them.
</p>
<h3><span class="mw-headline" id="Smartcard_not_detected">Smartcard not detected</span></h3>
<p>Your user might not have the permission to access the smartcard which results in a <code>card error</code> to be thrown, even though the card is correctly set up and inserted.
</p>
<p>One possible solution is to add a new group <code>scard</code> including the users who need access to the smartcard.
</p>
<p>Then use an <a href="../en/Udev.html#Writing_udev_rules" title="Udev">udev</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> rule, similar to the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/71-gnupg-ccid.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="usb", ENV{ID_VENDOR_ID}=="1050", ENV{ID_MODEL_ID}=="0116|0111", MODE="660", GROUP="scard"
</pre>
<p>One needs to adapt VENDOR and MODEL according to the <code>lsusb</code> output, the above example is for a YubikeyNEO.
</p>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://gnupg.org/">GNU Privacy Guard Homepage</a></li>
<li><a rel="nofollow" class="external text" href="https://fedoraproject.org/wiki/Creating_GPG_Keys">Creating GPG Keys (Fedora)</a></li>
<li><a rel="nofollow" class="external text" href="https://wiki.debian.org/Subkeys">OpenPGP subkeys in Debian</a></li>
<li><a rel="nofollow" class="external text" href="http://blog.sanctum.geek.nz/series/linux-crypto/">A more comprehensive gpg Tutorial</a></li>
<li><a rel="nofollow" class="external text" href="https://help.riseup.net/en/security/message-security/openpgp/gpg-best-practices">gpg.conf recommendations and best practices</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/ioerror/torbirdy/blob/master/gpg.conf">Torbirdy gpg.conf</a></li>
<li><a rel="nofollow" class="external text" href="https://www.reddit.com/r/GPGpractice/">/r/GPGpractice - a subreddit to practice using GnuPG.</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Encryption.html" title="Category:Encryption (简体中文)">Encryption (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GnuPG_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=652206">https://wiki.archlinux.org/index.php?title=GnuPG_(简体中文)&amp;oldid=652206</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 13 February 2021, at 18:27.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
