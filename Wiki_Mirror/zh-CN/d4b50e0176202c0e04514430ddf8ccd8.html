<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GRUB (简体中文)/Tips and tricks (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GRUB_简体中文_Tips_and_tricks_简体中文 rootpage-GRUB_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">GRUB (简体中文)/Tips and tricks (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../zh-CN/GRUB.html" title="GRUB (简体中文)">GRUB (简体中文)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/GRUB/Tips_and_tricks.html" title="GRUB/Tips and tricks">GRUB/Tips and tricks</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2019-06-12。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=GRUB/Tips_and_tricks&amp;diff=0&amp;oldid=573028">更改</a>，则您可以帮助同步翻译。</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E5%85%B6%E5%AE%83%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="tocnumber">1</span> <span class="toctext">其它安装方式</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#%E5%AE%89%E8%A3%85%E5%88%B0_U_%E7%9B%98"><span class="tocnumber">1.1</span> <span class="toctext">安装到 U 盘</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#BIOS"><span class="tocnumber">1.1.1</span> <span class="toctext">BIOS</span></a></li>
<li class="toclevel-3 tocsection-4"><a href="#EFI"><span class="tocnumber">1.1.2</span> <span class="toctext">EFI</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-5"><a href="#%E5%AE%89%E8%A3%85%E5%88%B0%E5%88%86%E5%8C%BA%E4%B8%8A%E6%88%96%E8%80%85%E6%97%A0%E5%88%86%E5%8C%BA%E7%A3%81%E7%9B%98%E4%B8%8A"><span class="tocnumber">1.2</span> <span class="toctext">安装到分区上或者无分区磁盘上</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#%E5%8F%AA%E7%94%9F%E6%88%90_core.img"><span class="tocnumber">1.3</span> <span class="toctext">只生成 core.img</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#%E5%9B%BE%E5%BD%A2%E5%8C%96%E9%85%8D%E7%BD%AE%E5%B7%A5%E5%85%B7"><span class="tocnumber">2</span> <span class="toctext">图形化配置工具</span></a></li>
<li class="toclevel-1 tocsection-8">
<a href="#%E8%A7%86%E8%A7%89%E9%85%8D%E7%BD%AE"><span class="tocnumber">3</span> <span class="toctext">视觉配置</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#%E8%AE%BE%E7%BD%AE%E5%B8%A7%E7%BC%93%E5%86%B2%E5%88%86%E8%BE%A8%E7%8E%87"><span class="tocnumber">3.1</span> <span class="toctext">设置帧缓冲分辨率</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#915resolution_%E7%A0%B4%E8%A7%A3"><span class="tocnumber">3.2</span> <span class="toctext">915resolution 破解</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#%E8%83%8C%E6%99%AF%E5%9B%BE%E5%83%8F%E5%92%8C%E7%82%B9%E9%98%B5%E5%AD%97%E4%BD%93"><span class="tocnumber">3.3</span> <span class="toctext">背景图像和点阵字体</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%E4%B8%BB%E9%A2%98"><span class="tocnumber">3.4</span> <span class="toctext">主题</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%E8%8F%9C%E5%8D%95%E9%A2%9C%E8%89%B2"><span class="tocnumber">3.5</span> <span class="toctext">菜单颜色</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E9%9A%90%E8%97%8F%E8%8F%9C%E5%8D%95"><span class="tocnumber">3.6</span> <span class="toctext">隐藏菜单</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%E7%A6%81%E7%94%A8_framebuffer"><span class="tocnumber">3.7</span> <span class="toctext">禁用 framebuffer</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#%E9%80%9A%E8%BF%87_GRUB_%E7%9B%B4%E6%8E%A5%E5%90%AF%E5%8A%A8_ISO9660_%E6%98%A0%E5%83%8F%E6%96%87%E4%BB%B6"><span class="tocnumber">4</span> <span class="toctext">通过 GRUB 直接启动 ISO9660 映像文件</span></a></li>
<li class="toclevel-1 tocsection-17"><a href="#%E6%8C%81%E4%B9%85%E5%9D%97%E8%AE%BE%E5%A4%87%E5%91%BD%E5%90%8D%E6%B3%95"><span class="tocnumber">5</span> <span class="toctext">持久块设备命名法</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#%E4%BD%BF%E7%94%A8%E5%8D%B7%E6%A0%87"><span class="tocnumber">6</span> <span class="toctext">使用卷标</span></a></li>
<li class="toclevel-1 tocsection-19">
<a href="#%E7%94%A8%E5%AF%86%E7%A0%81%E4%BF%9D%E6%8A%A4_GRUB_%E8%8F%9C%E5%8D%95"><span class="tocnumber">7</span> <span class="toctext">用密码保护 GRUB 菜单</span></a>
<ul>
<li class="toclevel-2 tocsection-20"><a href="#%E5%8F%AA%E9%92%88%E5%AF%B9%E7%BC%96%E8%BE%91_GRUB_%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%80%89%E9%A1%B9%E8%BF%9B%E8%A1%8C%E5%AF%86%E7%A0%81%E4%BF%9D%E6%8A%A4"><span class="tocnumber">7.1</span> <span class="toctext">只针对编辑 GRUB 和控制台选项进行密码保护</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#%E5%9C%A8%E6%B2%A1%E6%9C%89%E6%8C%89%E7%9D%80_SHIFT_%E9%94%AE%E6%97%B6%E9%9A%90%E8%97%8F_GRUB_%E7%95%8C%E9%9D%A2"><span class="tocnumber">8</span> <span class="toctext">在没有按着 SHIFT 键时隐藏 GRUB 界面</span></a></li>
<li class="toclevel-1 tocsection-22"><a href="#%E5%B0%86_UUID_%E5%92%8C%E5%9F%BA%E7%A1%80%E8%84%9A%E6%9C%AC%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8"><span class="tocnumber">9</span> <span class="toctext">将 UUID 和基础脚本结合使用</span></a></li>
<li class="toclevel-1 tocsection-23">
<a href="#%E5%A4%9A%E4%B8%AA%E5%90%AF%E5%8A%A8%E6%9D%A1%E7%9B%AE"><span class="tocnumber">10</span> <span class="toctext">多个启动条目</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#%E5%8F%96%E6%B6%88%E5%AD%90%E8%8F%9C%E5%8D%95"><span class="tocnumber">10.1</span> <span class="toctext">取消子菜单</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#%E8%B0%83%E7%94%A8%E4%B9%8B%E5%89%8D%E7%9A%84%E5%90%AF%E5%8A%A8%E6%9D%A1%E7%9B%AE"><span class="tocnumber">10.2</span> <span class="toctext">调用之前的启动条目</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E8%8F%9C%E5%8D%95%E6%9D%A1%E7%9B%AE"><span class="tocnumber">10.3</span> <span class="toctext">修改默认菜单条目</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E9%9D%9E%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E6%9D%A1%E7%9B%AE%EF%BC%88%E4%BB%85%E4%B8%80%E6%AC%A1%EF%BC%89"><span class="tocnumber">10.4</span> <span class="toctext">自动启动非默认启动条目（仅一次）</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#%E6%BC%94%E5%A5%8F%E4%B8%80%E6%9B%B2"><span class="tocnumber">11</span> <span class="toctext">演奏一曲</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#%E4%B8%BA%E6%97%A9%E6%9C%9F%E5%90%AF%E5%8A%A8%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A0%B8%E5%BF%83%E6%98%A0%E5%83%8F"><span class="tocnumber">12</span> <span class="toctext">为早期启动手动配置核心映像</span></a></li>
<li class="toclevel-1 tocsection-30">
<a href="#UEFI_%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB"><span class="tocnumber">13</span> <span class="toctext">UEFI 延伸阅读</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#%E5%8F%A6%E4%B8%80%E7%A7%8D%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95"><span class="tocnumber">13.1</span> <span class="toctext">另一种安装方法</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#UEFI_%E5%9B%BA%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="tocnumber">13.2</span> <span class="toctext">UEFI 固件解决方案</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#%E5%9C%A8%E5%9B%BA%E4%BB%B6%E5%90%AF%E5%8A%A8%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%AD%E5%88%9B%E5%BB%BA_GRUB_%E6%9D%A1%E7%9B%AE"><span class="tocnumber">13.3</span> <span class="toctext">在固件启动管理器中创建 GRUB 条目</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#%E7%8B%AC%E7%AB%8B%E7%9A%84_GRUB"><span class="tocnumber">13.4</span> <span class="toctext">独立的 GRUB</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#%E6%8A%80%E6%9C%AF%E4%BF%A1%E6%81%AF"><span class="tocnumber">13.5</span> <span class="toctext">技术信息</span></a></li>
</ul>
</li>
</ul>
</div>

<h2>
<span id=".E5.85.B6.E5.AE.83.E5.AE.89.E8.A3.85.E6.96.B9.E5.BC.8F"></span><span class="mw-headline" id="其它安装方式">其它安装方式</span>
</h2>
<h3>
<span id=".E5.AE.89.E8.A3.85.E5.88.B0_U_.E7.9B.98"></span><span class="mw-headline" id="安装到_U_盘">安装到 U 盘</span>
</h3>
<h4><span class="mw-headline" id="BIOS">BIOS</span></h4>
<p>假设 U 盘的第一个分区是 FAT32格式，其分区是/dev/sdy1
</p>
<pre># mkdir -p /mnt/usb
# mount /dev/sdy1 /mnt/usb
# grub-install --target=i386-pc --debug --boot-directory=/mnt/usb/boot /dev/sdy
# grub-mkconfig -o /mnt/usb/boot/grub/grub.cfg
</pre>
<p>可以选择将配置备份到 <code>grub.cfg</code>：
</p>
<pre># mkdir -p /mnt/usb/etc/default
# cp /etc/default/grub /mnt/usb/etc/default
# cp -a /etc/grub.d /mnt/usb/etc
</pre>
<pre># sync; umount /mnt/usb
</pre>
<h4><span class="mw-headline" id="EFI">EFI</span></h4>
<p>在你运行 <code>grub-install</code> 的时候使用 <code>--removable</code> 选项，就可以让 GRUB 把它的 EFI 映像写入到 <code>/boot/efi/EFI/BOOT/BOOTX64.efi</code>，这样启动固件就可以在没有 UEFI 启动条目的的情况下找到。
</p>
<h3>
<span id=".E5.AE.89.E8.A3.85.E5.88.B0.E5.88.86.E5.8C.BA.E4.B8.8A.E6.88.96.E8.80.85.E6.97.A0.E5.88.86.E5.8C.BA.E7.A3.81.E7.9B.98.E4.B8.8A"></span><span class="mw-headline" id="安装到分区上或者无分区磁盘上">安装到分区上或者无分区磁盘上</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> GRUB <b>极不推荐</b> 将其安装到分区启动扇区或者无分区磁盘上（Grub Legacy 和 syslinux 相反）。这种安装方式不安全，当升级时可能会损坏。Arch 开发人员也 <b>不支持</b> 这种方式.</div>
<p>下面的命令将会将 GRUB 安装到分区扇区或者无分区磁盘（也称作超级软盘），或者安装到软盘上。下面例子中以 <code>/dev/sdaX</code> 作为 <code>/boot</code> 分区。 
</p>
<pre># chattr -i /boot/grub/i386-pc/core.img
# grub-install --target=i386-pc --debug --force /dev/sdaX
# chattr +i /boot/grub/i386-pc/core.img
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>
<code>/dev/sdaX</code> 仅用作示例。</li>
<li>
<code>--target=i386-pc</code> 令 <code>grub-install</code> 仅为 BIOS 系统安装。建议总是使用这个选项来排除 grub-install 命令中的模糊性。</li>
</ul>
</div>
<p>你应该使用 <code>--force</code> 选项来启用对 blocklists（块列表）的支持，而不应该使用 <code>--grub-setup=/bin/true</code>，后者类似于单纯地生成 <code>core.img</code>。
</p>
<p><code>grub-install</code> 会生成以下警告，来提醒你哪里有可能出现问题。
</p>
<pre>/sbin/grub-setup: warn: Attempting to install GRUB to a partitionless disk or to a partition. This is a BAD idea.
/sbin/grub-setup: warn: Embedding is not possible. GRUB can only be installed in this setup by using blocklists.
                        However, blocklists are UNRELIABLE and their use is discouraged.
</pre>
<p>不使用 <code>--force</code> 选项则可能会出现以下错误，并且 <code>grub-setup</code> 不会将启动代码安装到启动扇区上：
</p>
<pre>/sbin/grub-setup: error: will not proceed with blocklists
</pre>
<p>而指定了 <code>--force</code>，会出现：
</p>
<pre>Installation finished. No error reported.
</pre>
<p><code>grub-setup</code> 默认不启用这个选项，是因为在分区或者无分区磁盘上，<code>grub</code> 依赖于嵌入分区引导扇区的块列表 (blocklists) 来定位 <code>/boot/grub/i386-pc/core.img</code> 和前缀目录 <code>/boot/grub</code>。而 <code>core.img</code> 在分区上的扇区位置很有可能随着分区文件系统的更改而变化（复制文件，删除文件等）。详情请参考 <a rel="nofollow" class="external free" href="https://bugzilla.redhat.com/show_bug.cgi?id=728742">https://bugzilla.redhat.com/show_bug.cgi?id=728742</a> 和 <a rel="nofollow" class="external free" href="https://bugzilla.redhat.com/show_bug.cgi?id=730915">https://bugzilla.redhat.com/show_bug.cgi?id=730915</a>.
</p>
<p>临时解决方案是给 <code>/boot/grub/i386-pc/core.img</code> 文件加“不可变”(immutable) 标志（按照上面提过的，使用 <code>chattr</code> 命令）。这样 <code>core.img</code> 文件的位置就不会变。只有当将 GRUB 安装到分区启动扇区或者无分区磁盘上时才需要给 <code>/boot/grub/i386-pc/core.img</code> 加上“不可变”标志，在安装到 MBR 或者单纯地生成 <code>core.img</code> 而不嵌入到其他引导扇区里的时候，就不用添加（正如上面所述）。
</p>
<p>然而即使没有报错，生成的 <code>grub.cfg</code> 文件也不会包含正确的 UUID。参考 <a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=1294604#p1294604">https://bbs.archlinux.org/viewtopic.php?pid=1294604#p1294604</a> 。
要解决这个问题，使用如下命令：
</p>
<pre># mount /dev/sdxY /mnt        #Your root partition.
# mount /dev/sdxZ /mnt/boot   #Your boot partition (if you have one).
# arch-chroot /mnt
# pacman -S linux
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<h3>
<span id=".E5.8F.AA.E7.94.9F.E6.88.90_core.img"></span><span class="mw-headline" id="只生成_core.img">只生成 core.img</span>
</h3>
<p>通过添加 <code>--grub-setup=/bin/true</code> 选项，<code>grub-install</code> 命令会填充 <code>/boot/grub</code> 文件夹并生成 <code>/boot/grub/i386-pc/core.img</code>，但是 <b>不会</b> 将 GRUB 启动引导代码嵌入到 MBR、MBR 后部区域或者分区引导扇区中。 
</p>
<pre># grub-install --target=i386-pc --grub-setup=/bin/true --debug /dev/sda
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>
<code>/dev/sda</code> 仅是示例。</li>
<li>
<code>--target=i386-pc</code> 令 <code>grub-install</code> 仅为 BIOS 系统安装。建议总是使用这个选项来排除 grub-install 命令中的模糊性。</li>
</ul>
</div>
<p>生成后，Grub Legacy 或者 syslinux 就可以通过链式加载 GRUB 的 <code>core.img</code> 来间接加载 Linux 内核或者多启动内核了。参阅<a href="../zh-CN/Syslinux.html#Chainloading" title="Syslinux (简体中文)">Syslinux (简体中文)#Chainloading</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>。
</p>
<h2>
<span id=".E5.9B.BE.E5.BD.A2.E5.8C.96.E9.85.8D.E7.BD.AE.E5.B7.A5.E5.85.B7"></span><span class="mw-headline" id="图形化配置工具">图形化配置工具</span>
</h2>
<p>可以安装下列软件包：
</p>
<ul><li>
<b>grub-customizer</b> — GRUB 或者 BURG 的 GTK+ 定制器</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://launchpad.net/grub-customizer">https://launchpad.net/grub-customizer</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-customizer">grub-customizer</a></span>
</dd></dl>
<ul><li>
<b>grub2-editor-frameworks</b> — grub2-editor 的非官方 KF5 port</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/maz-1/grub2-editor">https://github.com/maz-1/grub2-editor</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub2-editor-frameworks/">grub2-editor-frameworks</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>
</dd></dl>
<ul><li>
<b>startupmanager</b> — 用来修改 GRUB Legacy, GRUB, Usplash 和 Splashy 设置的图形应用 (<a rel="nofollow" class="external text" href="https://launchpad.net/startup-manager/+announcement/8300">已被废止</a>)</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://sourceforge.net/projects/startup-manager/">https://sourceforge.net/projects/startup-manager/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/startupmanager/">startupmanager</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup>
</dd></dl>
<h2>
<span id=".E8.A7.86.E8.A7.89.E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="视觉配置">视觉配置</span>
</h2>
<p>GRUB 默认支持改变菜单外观。如果你没有初始化，请务必以视频模式 gfxmode 初始化 GRUB 图形终端 gfxterm，你可以在 <a href="../zh-CN/GRUB.html#%22No_suitable_mode_found%22_%E9%94%99%E8%AF%AF" title="GRUB (简体中文)">GRUB (简体中文)#"No suitable mode found" 错误</a>一节找到这部分内容。此视频模式由 GRUB 通过 gfxpayload 传递给 Linux 内核，任何视觉配置都需要这种模式才能够有效果。
</p>
<h3>
<span id=".E8.AE.BE.E7.BD.AE.E5.B8.A7.E7.BC.93.E5.86.B2.E5.88.86.E8.BE.A8.E7.8E.87"></span><span class="mw-headline" id="设置帧缓冲分辨率">设置帧缓冲分辨率</span>
</h3>
<p>GRUB 既可以为自己，也可以为内核设定帧缓冲。现在已经不使用老的 <code>vga=</code> 配置了，推荐方法是在 <code>/etc/default/grub</code> 文件中按照下面的例子编辑，来设定宽度（像素）x高度（像素）x<a href="https://en.wikipedia.org/wiki/color_depth" class="extiw" title="wikipedia:color depth">颜色深度</a>：
</p>
<pre>GRUB_GFXMODE=1024x768x32
GRUB_GFXPAYLOAD_LINUX=keep
</pre>
<p>可以指定多种分辨率，包括默认的 <code>auto</code>，所以建议你编辑成这个样：<code>GRUB_GFXMODE=&lt;心仪的分辨率&gt;,&lt;后备分辨率比如 1024x768&gt;,auto</code>。更多信息请见 <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/grub/html_node/gfxmode.html">GRUB gfxmode 文档</a>。 <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/html_node/gfxpayload.html#gfxpayload">gfxpayload</a> 属性可以确保内核也保持该分辨率。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>只有显卡通过 <a href="https://en.wikipedia.org/wiki/VESA_BIOS_Extensions" class="extiw" title="wikipedia:VESA BIOS Extensions">VESA BIOS 拓展</a>支持的模式才能用。要查看所支持的模式列表，安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=hwinfo">hwinfo</a></span> 然后以 root 权限运行 <code>hwinfo --framebuffer</code>。或者进入 GRUB 命令行运行 <code>videoinfo</code> 命令。</li>
<li>早期版本的 <a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> 专有驱动（使用显卡 GeForce GTX 970，驱动 nvidia 370 进行了测试）支持的  <code>GRUB_GFXMODE</code> 格式为 <code><i>&lt;宽&gt;</i>x<i>&lt;高&gt;</i>-<i>&lt;色深&gt;</i></code>（例如 <code>1920x1200-24</code>，而不是 <code>1920x1200x24</code>）。这应该不会影响新的显卡和驱动。使用比较新的驱动的 Pascal 显卡（以 GeForce GTX 1060 显卡和 nvidia 381.22 驱动测试）没法使用上文建议的格式，而且会引发严重的问题，包括但不限于系统崩溃以及 hard lock。当前的驱动和显卡最好使用标准的 <code><i>&lt;width&gt;</i>x<i>&lt;height&gt;</i>x<i>&lt;depth&gt;</i></code> 格式来配置 <code>GRUB_GFXMODE</code>。</li>
<li>确保在修改完后运行 <code>grub-mkconfig -o /boot/grub/grub.cfg</code>。</li>
</ul>
</div>
<p>这种方法不管用的话，可以试试老的 <code>vga=</code> 方法。将它添加到 <code>/etc/default/grub</code> 文件中的 <code>"GRUB_CMDLINE_LINUX_DEFAULT="</code> 一行就行了。比如 <code>"GRUB_CMDLINE_LINUX_DEFAULT="quiet splash vga=792"</code> 可以将系统的分辨率设定为 <code>1024x768</code>。
</p>
<h3>
<span id="915resolution_.E7.A0.B4.E8.A7.A3"></span><span class="mw-headline" id="915resolution_破解">915resolution 破解</span>
</h3>
<p>有些时候,Intel 显卡无法通过 <code># hwinfo --framebuffer</code> 或 <code>vbeinfo</code> 显示你需要的分辨率。这种情况下，你可以使用 <code>915resolution</code> 破解。这种破解会临时性的修改显卡 BIOS 来添加所需的分辨率。详情请参考<a rel="nofollow" class="external text" href="http://915resolution.mango-lang.org/">915resolution 主页</a>。这个包可以在这里找到：<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/915resolution/">915resolution</a></span><sup><small>AUR</small></sup>
</p>
<p>首先，找一个你想要修改的视频模式。为此需要在 GRUB 命令行模式下运行：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">sh:grub&gt; 915resolution -l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Intel 800/900 Series VBIOS Hack : version 0.5.3
[...]
<b>Mode 30</b> : 640x480, 8 bits/pixel
[...]
</pre>
<p>然后，使用 <code>1440x900</code> 分辨率覆盖 <code>Mode 30</code>：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/00_header</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
<b>915resolution 30 1440 900  # 添加这行</b>
set gfxmode=${GRUB_GFXMODE}
[...]
</pre>
<p>最后按照之前描述的方式设置 <code>GRUB_GFXMODE</code>，再重新生成 GRUB 配置文件，重启并测试是否生效。
</p>
<h3>
<span id=".E8.83.8C.E6.99.AF.E5.9B.BE.E5.83.8F.E5.92.8C.E7.82.B9.E9.98.B5.E5.AD.97.E4.BD.93"></span><span class="mw-headline" id="背景图像和点阵字体">背景图像和点阵字体</span>
</h3>
<p>GRUB 原生支持设置背景图像和 <code>pf2</code> 格式的点阵字体。<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> 包中包含了 unifont 字体，名为<code>unicode.pf2</code>，（也有可能只包含名为 <code>ascii.pf2</code> 的ASCII字符字体）。
</p>
<p>在载入正确的模块之后，GRUB 支持的图像格式有 tga, png 和 jpeg。所支持的最大图像分辨率跟硬件有关。
</p>
<p>请确保你已经设定了合适的<a href="#%E8%AE%BE%E7%BD%AE%E5%B8%A7%E7%BC%93%E5%86%B2%E5%88%86%E8%BE%A8%E7%8E%87">帧缓冲分辨率</a>。
</p>
<p>按如下方式编辑 <code>/etc/default/grub</code>：
</p>
<pre>GRUB_BACKGROUND="/boot/grub/myimage"
#GRUB_THEME="/path/to/gfxtheme"
GRUB_FONT="/path/to/font.pf2"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果你将 GRUB 安装在单独的分区上，<code>grub.cfg</code> 文件中会自动将 <code>/boot/grub/myimage</code> 改成 <code>/grub/myimage</code>。</div>
<p>需要<a href="../zh-CN/GRUB.html#%E7%94%9F%E6%88%90%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" title="GRUB (简体中文)">重新生成</a> <code>grub.cfg</code> 来让修改起作用。如果成功添加了背景图片，用户会在运行命令的终端中看到 <code>"Found background image..."</code>。如果句话没有出现，你设定的图像信息可能没有成功添加进 <code>grub.cfg</code> 文件。
</p>
<p>如果图像没有正确显示，执行如下检查：
</p>
<ul>
<li>在 <code>/etc/default/grub</code> 文件中，图像的路径和名字要正确</li>
<li>图像的大小和格式要合适 (tga, png, 8-bit jpg)</li>
<li>图像需要以 RGB 模式存储，而且没有索引</li>
<li>
<code>/etc/default/grub</code> 文件里面开启了 console 模式</li>
<li>需要执行 <code>grub-mkconfig</code> 命令以将图像信息写入 <code>/boot/grub/grub.cfg</code> 文件</li>
<li>
<code>grub-mkconfig</code> 脚本不会对 <code>grub.cfg</code> 文件中所写的文件名添加引号，所以要确保这些名字里没有空格</li>
</ul>
<h3>
<span id=".E4.B8.BB.E9.A2.98"></span><span class="mw-headline" id="主题">主题</span>
</h3>
<p>下面的例子将展示如何使用 GRUB 包里面的 Starfield 主题：
</p>
<p>编辑 <code>/etc/default/grub</code>
</p>
<pre>GRUB_THEME="/usr/share/grub/themes/starfield/theme.txt"
</pre>
<p>需要<a href="../zh-CN/GRUB.html#%E7%94%9F%E6%88%90%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" title="GRUB (简体中文)">重新生成</a> <code>grub.cfg</code> 来让修改起作用。如果配置成功的话，在重生成配置过程中，会在终端里出现 <code>Found theme: /usr/share/grub/themes/starfield/theme.txt</code>。
</p>
<p>一旦使用了主题，你设置的背景图像通常就不起作用了。
</p>
<h3>
<span id=".E8.8F.9C.E5.8D.95.E9.A2.9C.E8.89.B2"></span><span class="mw-headline" id="菜单颜色">菜单颜色</span>
</h3>
<p>GRUB 支持设置菜单颜色。可使用的颜色能从 <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html">GRUB 手册</a>里面找到。示例如下：
</p>
<p>编辑 <code>/etc/default/grub</code>：
</p>
<pre>GRUB_COLOR_NORMAL="light-blue/black"
GRUB_COLOR_HIGHLIGHT="light-cyan/blue"
</pre>
<h3>
<span id=".E9.9A.90.E8.97.8F.E8.8F.9C.E5.8D.95"></span><span class="mw-headline" id="隐藏菜单">隐藏菜单</span>
</h3>
<p>GRUB 特性之一就是支持隐藏/跳过菜单，可以在需要的时候按 <code>Esc</code> 来取消隐藏/跳过。同时还支持设置是否显示 timeout 计时器。
</p>
<p>按照你的想法来编辑 <code>/etc/default/grub</code>。添加下面的几行可以启动这个功能，其中计时器被设定为 5 秒钟，而且可以被用户看到：
</p>
<pre>GRUB_TIMEOUT=5
GRUB_TIMEOUT_STYLE='countdown'
</pre>
<p>GRUB_TIMEOUT 是设置显示菜单前等待几秒。
</p>
<h3>
<span id=".E7.A6.81.E7.94.A8_framebuffer"></span><span class="mw-headline" id="禁用_framebuffer">禁用 framebuffer</span>
</h3>
<p>使用 NVIDIA 私有驱动的用户可能希望禁用 GRUB 的 framebuffer，因为它会导致驱动错误。
</p>
<p>要禁用 framebuffer，只要在 <code>/etc/default/grub</code> 中取消下面这行的注释：
</p>
<pre>GRUB_TERMINAL_OUTPUT=console
</pre>
<p>如果你想保留 GRUB 的 framebuffer，解决方法是在 GRUB 载入内核前进入文字模式。可以通过在 <code>/etc/default/grub</code> 中进行如下修改：
</p>
<pre>GRUB_GFXPAYLOAD_LINUX=text
</pre>
<h2>
<span id=".E9.80.9A.E8.BF.87_GRUB_.E7.9B.B4.E6.8E.A5.E5.90.AF.E5.8A.A8_ISO9660_.E6.98.A0.E5.83.8F.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="通过_GRUB_直接启动_ISO9660_映像文件">通过 GRUB 直接启动 ISO9660 映像文件</span>
</h2>
<p>GRUB 支持通过 loopback 设备直接从 ISO 映像启动，例如参考 <a href="../en/Multiboot_USB_drive.html#Using_GRUB_and_loopback_devices" title="Multiboot USB drive">Multiboot USB drive#Using GRUB and loopback devices</a>。
</p>
<h2>
<span id=".E6.8C.81.E4.B9.85.E5.9D.97.E8.AE.BE.E5.A4.87.E5.91.BD.E5.90.8D.E6.B3.95"></span><span class="mw-headline" id="持久块设备命名法">持久块设备命名法</span>
</h2>
<p>为<a href="../zh-CN/Persistent_block_device_naming.html" title="Persistent block device naming (简体中文)">块设备持久命名</a> (Persistent block device naming) 的一种方式是使用全局的 UUID 来区分分区，而不是用老的 <code>/dev/sd*</code> 表示法。其好处在上面链接中已详述。
</p>
<p>GRUB 默认就使用文件系统的 UUID 来为块设备持久命名。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 每次相关的文件系统调整后，就需要在 <code>/etc/default/grub</code> 中使用新的 UUID，然后更新<code>/boot/grub.cfg</code>。通过 Live-CD 调整分区和文件系统后要特别注意这点。</div>
<p>是否使用 UUID 由 <code>/etc/default/grub</code> 里的这个选项控制：
</p>
<pre>GRUB_DISABLE_LINUX_UUID=true
</pre>
<h2>
<span id=".E4.BD.BF.E7.94.A8.E5.8D.B7.E6.A0.87"></span><span class="mw-headline" id="使用卷标">使用卷标</span>
</h2>
<p>通过使用 <code>search</code> 命令的 <code>--label</code>参数，可以使用卷标，即附加在文件系统上方便人阅读的字符串。首先，给文件系统设置一个卷标：
</p>
<pre># tune2fs -L <i>卷标</i> <i>分区</i>
</pre>
<p>然后使用这个卷标添加启动条目。例如这样：
</p>
<pre>menuentry "Arch Linux, session texte" {
  search --label --set=root archroot
  linux /boot/vmlinuz-linux root=/dev/disk/by-label/archroot ro
  initrd /boot/initramfs-linux.img
}
</pre>
<h2>
<span id=".E7.94.A8.E5.AF.86.E7.A0.81.E4.BF.9D.E6.8A.A4_GRUB_.E8.8F.9C.E5.8D.95"></span><span class="mw-headline" id="用密码保护_GRUB_菜单">用密码保护 GRUB 菜单</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 如果有人能对你的机器进行物理上的访问，而且可以使用 Live USB 或磁盘启动（例如 BIOS 允许从外接磁盘启动），而 <code>/boot</code> 又处于一个没有加密的分区上面，那他就可以非常简单地通过编辑 GRUB 设置文件来绕过下面的这些。参考<a href="../zh-CN/GRUB.html#/boot_%E5%8A%A0%E5%AF%86" title="GRUB (简体中文)">GRUB (简体中文)#/boot 加密</a>和<a href="../zh-CN/Security.html#%E7%A3%81%E7%9B%98%E5%8A%A0%E5%AF%86" title="Security (简体中文)">Security (简体中文)#磁盘加密</a>。</div>
<p>如果你想禁止其他人改变启动参数或者使用 GRUB 命令行，可以给 GRUB 的配置文件关联一个用户名/密码。只需
运行 <code>grub-mkpasswd-pbkdf2</code>，输入密码然后确认：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">grub-mkpasswd-pbkdf2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[...]
Your PBKDF2 is grub.pbkdf2.sha512.10000.C8ABD3E93C4DFC83138B0C7A3D719BC650E6234310DA069E6FDB0DD4156313DA3D0D9BFFC2846C21D5A2DDA515114CF6378F8A064C94198D0618E70D23717E82.509BFA8A4217EAD0B33C87432524C0B6B64B34FBAD22D3E6E6874D9B101996C5F98AB1746FE7C7199147ECF4ABD8661C222EEEDB7D14A843261FFF2C07B1269A
</pre>
<p>然后将下面的内容添加到 <code>/etc/grub.d/40_custom</code>：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/40_custom</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set superusers="<b>用户名</b>"
password_pbkdf2 <b>用户名</b> <b>&lt;密码&gt;</b></pre>
<p>这里的 <code>&lt;密码&gt;</code> 是由 <code>grub-mkpasswd_pbkdf2</code> 所生成的那个字符串。
</p>
<p>然后重新生成主配置文件，现在你的 GRUB 命令行、启动参数和所有的启动条目都得到保护了。
</p>
<p>可以参考 <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/grub.html#Security">GRUB 手册</a>中的 "Security" 部分来将设置放宽或者针对多用户进行更复杂的定制。
</p>
<h3>
<span id=".E5.8F.AA.E9.92.88.E5.AF.B9.E7.BC.96.E8.BE.91_GRUB_.E5.92.8C.E6.8E.A7.E5.88.B6.E5.8F.B0.E9.80.89.E9.A1.B9.E8.BF.9B.E8.A1.8C.E5.AF.86.E7.A0.81.E4.BF.9D.E6.8A.A4"></span><span class="mw-headline" id="只针对编辑_GRUB_和控制台选项进行密码保护">只针对编辑 GRUB 和控制台选项进行密码保护</span>
</h3>
<p>对一个菜单条目添加 <code>--unrestricted</code> 选项将会允许所有的用户启动这个操作系统，但却不能修改这个条目，也不能进入 GRUB 命令行控制台。
只有超级用户或者由 <code>--user</code> 开关指定的用户才能修改这个菜单条目。
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">menuentry 'Arch Linux' --unrestricted --class arch --class gnu-linux --class os ...</pre>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a><b>The factual accuracy of this article or section is disputed.</b><a href="../File:Tango-inaccurate.png" class="image"><img alt="Tango-inaccurate.png" src="../File:Tango-inaccurate.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> <code>/etc/grub.d/10_linux</code> 文件不应该被手工编辑，每次升级 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> 包都会自动把它覆盖掉。 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:GRUB (简体中文)/Tips and tricks (简体中文)#</a>)</div>
</div>
<p>要给 Linux 启动条目添加 <code>--unrestricted</code>，可以修改 <code>/etc/grub.d/10_linux</code> 文件开头的 <code>CLASS</code> 变量。
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/grub.d/10_linux</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CLASS="--class gnu-linux --class gnu --class os --unrestricted"</pre>
<h2>
<span id=".E5.9C.A8.E6.B2.A1.E6.9C.89.E6.8C.89.E7.9D.80_SHIFT_.E9.94.AE.E6.97.B6.E9.9A.90.E8.97.8F_GRUB_.E7.95.8C.E9.9D.A2"></span><span class="mw-headline" id="在没有按着_SHIFT_键时隐藏_GRUB_界面">在没有按着 SHIFT 键时隐藏 GRUB 界面</span>
</h2>
<p>为了获取更快的启动速度，而不用等 GRUB 倒计时，可以命令 GRUB 在启动时隐藏目录，仅在 <code>Shift</code> 被按住的时候才显示。
</p>
<p>将如下行添加到<code>/etc/default/grub</code>来启动这个功能：
</p>
<pre> GRUB_FORCE_HIDDEN_MENU="true"
</pre>
<p>然后创建连接里的文件<a rel="nofollow" class="external autonumber" href="https://gist.githubusercontent.com/anonymous/8eb2019db2e278ba99be/raw/257f15100fd46aeeb8e33a7629b209d0a14b9975/gistfile1.sh">[1]</a>，给它可执行权限，然后重新生成主配置文件：
</p>
<pre># chmod a+x /etc/grub.d/31_hold_shift
# grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 这个设置使用 keystatus 来检测按键事件，所以可能在某些机器上不能用。</div>
<h2>
<span id=".E5.B0.86_UUID_.E5.92.8C.E5.9F.BA.E7.A1.80.E8.84.9A.E6.9C.AC.E7.BB.93.E5.90.88.E4.BD.BF.E7.94.A8"></span><span class="mw-headline" id="将_UUID_和基础脚本结合使用">将 UUID 和基础脚本结合使用</span>
</h2>
<p>如果你想要使用 UUID 来避免不可靠的 BIOS 设备命名或者正在研究 GRUB 语法，这里有个使用了 UUID 的启动菜单项，和一个让 GRUB 使用你系统中正确的磁盘分区的小脚本。如果你想要将其移植到自己的系统上，只需要把 UUID 改成你的系统上的就行了。这个例子假设系统的 boot 和 root 文件系统是在不同的分区上，如果你还有其他分区，请相应地修改 GRUB 设置。
</p>
<pre>menuentry "Arch Linux 64" {
    # Set the UUIDs for your boot and root partition respectively
    set the_boot_uuid=ece0448f-bb08-486d-9864-ac3271bd8d07
    set the_root_uuid=c55da16f-e2af-4603-9e0b-03f5f565ec4a

    # (Note: This may be the same as your boot partition)

    # Get the boot/root devices and set them in the root and grub_boot variables
    search --fs-uuid $the_root_uuid --set=root
    search --fs-uuid $the_boot_uuid --set=grub_boot

    # Check to see if boot and root are equal.
    # If they are, then append /boot to $grub_boot (Since $grub_boot is actually the root partition)
    if [ $the_boot_uuid == $the_root_uuid ] ; then
        set grub_boot=($grub_boot)/boot
    else
        set grub_boot=($grub_boot)
    fi

    # $grub_boot now points to the correct location, so the following will properly find the kernel and initrd
    linux $grub_boot/vmlinuz-linux root=/dev/disk/by-uuid/$the_root_uuid ro
    initrd $grub_boot/initramfs-linux.img
}
</pre>
<h2>
<span id=".E5.A4.9A.E4.B8.AA.E5.90.AF.E5.8A.A8.E6.9D.A1.E7.9B.AE"></span><span class="mw-headline" id="多个启动条目">多个启动条目</span>
</h2>
<h3>
<span id=".E5.8F.96.E6.B6.88.E5.AD.90.E8.8F.9C.E5.8D.95"></span><span class="mw-headline" id="取消子菜单">取消子菜单</span>
</h3>
<p>如果你安装了多个内核，比如说 linux 和 linux-lts，那么 <code>grub-mkconfig</code> 默认会把他们分成一组建立一个子菜单。如果你不想这样，可以在 <code>/etc/default/grub</code> 文件里添加下面这行来回到仅有一个菜单的情形：
</p>
<pre> GRUB_DISABLE_SUBMENU=y
</pre>
<h3>
<span id=".E8.B0.83.E7.94.A8.E4.B9.8B.E5.89.8D.E7.9A.84.E5.90.AF.E5.8A.A8.E6.9D.A1.E7.9B.AE"></span><span class="mw-headline" id="调用之前的启动条目">调用之前的启动条目</span>
</h3>
<p>GRUB 能够记住你最近一次使用的启动项，并且在下次启动时将其作为默认项。当你使用多个内核或操作系统时（比如当前的 Arch 和一个用来做后备选项的 LTS 内核），这个特性很有用。要开启这个功能，编辑 <code>/etc/default/grub</code> 中的 <code>GRUB_DEFAULT</code> 选项：
</p>
<pre>GRUB_DEFAULT=saved
</pre>
<p>上面的命令会告诉 GRUB 使用记住的启动项为默认启动项。要想让 GRUB 记住当前选择的启动项，将下面的行添加到 <code>/etc/default/grub</code>：
</p>
<pre>GRUB_SAVEDEFAULT=true
</pre>
<p>仅当 /boot 不是 btrfs 文件系统的时候才能用，因为 GRUB 没法对 btrfs 进行写入操作。但它会生成一个容易误导人的错误信息："sparse file not allowed. Press any key to continue."
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 手动添加启动项到 <code>/etc/grub.d/40_custom</code> 或 <code>/boot/grub/custom.cfg</code>中，比如添加 Windows 启动项，需要先添加<code>savedefault</code>选项。</div>
<h3>
<span id=".E4.BF.AE.E6.94.B9.E9.BB.98.E8.AE.A4.E8.8F.9C.E5.8D.95.E6.9D.A1.E7.9B.AE"></span><span class="mw-headline" id="修改默认菜单条目">修改默认菜单条目</span>
</h3>
<p>可以通过修改 <code>/etc/default/grub</code> 中的 <code>GRUB_DEFAULT</code> 值来改变默认启动项：
</p>
<p>使用菜单标题：
</p>
<pre>GRUB_DEFAULT='Advanced options for Arch Linux&gt;Arch Linux, with Linux linux'
</pre>
<p>使用数字编号：
</p>
<pre> GRUB_DEFAULT="1&gt;2"
</pre>
<p>GRUB 启动项序号从 0 开始计数，0 代表第一个启动项，也是上述选项的默认值，1 表示第二个启动项，以此类推。主菜单和子菜单项之间用 <code>&gt;</code> 隔开。
</p>
<p>上面的例子启动的是主菜单项 'Advanced options for Arch Linux' 下子菜单的第三项。
</p>
<h3>
<span id=".E8.87.AA.E5.8A.A8.E5.90.AF.E5.8A.A8.E9.9D.9E.E9.BB.98.E8.AE.A4.E5.90.AF.E5.8A.A8.E6.9D.A1.E7.9B.AE.EF.BC.88.E4.BB.85.E4.B8.80.E6.AC.A1.EF.BC.89"></span><span class="mw-headline" id="自动启动非默认启动条目（仅一次）">自动启动非默认启动条目（仅一次）</span>
</h3>
<p>如果你想在下一次启动的时候启动一个非默认的启动项，命令 <code>grub-reboot</code> 非常有用。当系统下一次启动时，GRUB 会自动载入这个命令后的第一个参数所指的那个启动项，而以后再次启动时，GRUB 会回到正常状态加载默认条目。这样就不用修改配置文件或者在启动时进行手动选择了。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 这个功能需要在 <code>/etc/default/grub</code> 中设定 <code>GRUB_DEFAULT=saved</code>，然后重新生成<code>grub.cfg</code>；或者在手动生成的 <code>grub.cfg</code> 中, 使用 <code>set default="${saved_entry}"</code>。</div>
<h2>
<span id=".E6.BC.94.E5.A5.8F.E4.B8.80.E6.9B.B2"></span><span class="mw-headline" id="演奏一曲">演奏一曲</span>
</h2>
<p>通过修改 <code>GRUB_INIT_TUNE</code> 变量，你可以在启动时让 PC-speaker 演奏曲子。比如要演奏柏辽兹《幻想交响曲》“妖魔夜宴”乐章片段（大管部分），你可以添加下面的设置：
</p>
<p><code>GRUB_INIT_TUNE="312 262 3 247 3 262 3 220 3 247 3 196 3 220 3 220 3 262 3 262 3 294 3 262 3 247 3 220 3 196 3 247 3 262 3 247 5 220 1 220 5"</code>
</p>
<p>更多相关信息可以查看 <code>info grub -n play</code>。
</p>
<h2>
<span id=".E4.B8.BA.E6.97.A9.E6.9C.9F.E5.90.AF.E5.8A.A8.E6.89.8B.E5.8A.A8.E9.85.8D.E7.BD.AE.E6.A0.B8.E5.BF.83.E6.98.A0.E5.83.8F"></span><span class="mw-headline" id="为早期启动手动配置核心映像">为早期启动手动配置核心映像</span>
</h2>
<p>如果你需要用一个特殊的键盘布局，或者要让 GRUB 环境访问 <code>/boot</code> 的配置步骤太过复杂，导致 GRUB 没法自动配置，你可以自己生成一个核心映像。在 UEFI 系统上，核心映像就是在启动时需要被固件载入的 <code>grubx64.efi</code> 文件。自己建立一个核心映像，就可以嵌入在早期启动过程中需要用到的所有模块，以及用来引导 GRUB 配置脚本。
</p>
<p>首先，假设在一个 UEFI 系统中，我们需要在早期启动过程中载入 <code>dvorak</code> 键盘布局，以输入 <code>/boot</code> 加密分区的密码。
</p>
<p>从生成的 <code>/boot/grub/grub.cfg</code> 文件中查看需要使用哪些模块来挂载加密的 <code>/boot</code> 分区。例如在你的 <code>menuentry</code> 一项中你应该看到类似下面的内容：
</p>
<pre>insmod diskfilter cryptodisk luks gcry_rijndael gcry_rijndael gcry_sha256
insmod ext2
cryptomount -u 1234abcdef1234abcdef1234abcdef
set root='cryptouuid/1234abcdef1234abcdef1234abcdef'</pre>
<p>把这些模块都记下来，他们都应该被包含到核心映像里面。现在把你的键盘布局打包，它应该作为一个 memdisk 来嵌入到核心映像里：
</p>
<pre># grub-kbdcomp -o dvorak.gkb dvorak
# tar cf memdisk.tar dvorak.gkb
</pre>
<p>现在创建需要在 GRUB 核心映像中使用的配置文件。这和正常的 GRUB 配置文件的格式是一样的，但只需要简单几行来载入 <code>/boot</code> 分区里的主配置文件就可以了：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">early-grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">set root=(memdisk)
set prefix=($root)/

terminal_input at_keyboard
keymap /dvorak.gkb

cryptomount -u 1234abcdef1234abcdef1234abcdef
set root='cryptouuid/1234abcdef1234abcdef1234abcdef'
set prefix=($root)/grub

configfile grub.cfg</pre>
<p>最后，生成核心映像，列出在 <code>grub.cfg</code> 文件中所需要的所有模块，再加上 <code>early-grub.cfg</code> 脚本中所使用的模块。上例中需要的模块有 <code>memdisk</code>, <code>tar</code>, <code>at_keyboard</code>, <code>keylayouts</code> 和 <code>configfile</code>。
</p>
<pre># grub-mkimage -c early-grub.cfg -o grubx64.efi -O x86_64-efi -m memdisk.tar diskfilter cryptodisk luks gcry_rijndael gcry_sha256 ext2 memdisk tar at_keyboard keylayouts configfile
</pre>
<p>生成的 EFI 核心映像可以和由 <code>grub-install</code> 所自动生成的一样使用，把它放在你的 EFI 分区，然后使用 <code>efibootmgr</code> 来启用它，或者依照你的系统固件来适当地进行配置。
</p>
<h2>
<span id="UEFI_.E5.BB.B6.E4.BC.B8.E9.98.85.E8.AF.BB"></span><span class="mw-headline" id="UEFI_延伸阅读">UEFI 延伸阅读</span>
</h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b><a href="../File:Tango-edit-clear.png" class="image"><img alt="Tango-edit-clear.png" src="../File:Tango-edit-clear.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> 本节还可以更加简明有序。 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:GRUB (简体中文)/Tips and tricks (简体中文)#</a>)</div>
</div>
<p>下面是关于通过 UEFI 安装 Arch 的其他相关信息。 
</p>
<h3>
<span id=".E5.8F.A6.E4.B8.80.E7.A7.8D.E5.AE.89.E8.A3.85.E6.96.B9.E6.B3.95"></span><span class="mw-headline" id="另一种安装方法">另一种安装方法</span>
</h3>
<p>通常，不管 EFI 系统分区挂载到哪，GRUB 都会将所有文件包括配置文件放到 <code>/boot</code>。
</p>
<p>如果你想将所有的文件放在 EFI 系统分区中，请给 grub-install 命令添加 <code>--boot-directory=<i>esp</i></code> 选项：
</p>
<pre># grub-install --target=x86_64-efi --efi-directory=<i>esp</i> --bootloader-id=grub --boot-directory=<i>esp</i> --debug
</pre>
<p>这个命令会将 GRUB 文件放在 {{ic|<i>esp</i>/grub} 而不是  <code>/boot/grub</code> 中。使用这个方法，请确保 grub-mkconfig 将配置文件放在与上面一样的目录里：
</p>
<pre># grub-mkconfig -o <i>esp</i>/grub/grub.cfg
</pre>
<p>其他的配置是完全一样的。
</p>
<h3>
<span id="UEFI_.E5.9B.BA.E4.BB.B6.E8.A7.A3.E5.86.B3.E6.96.B9.E6.A1.88"></span><span class="mw-headline" id="UEFI_固件解决方案">UEFI 固件解决方案</span>
</h3>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-edit-cut.png" class="image"><img alt="Tango-edit-cut.png" src="../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a><b>This section is being considered for removal.</b><a href="../File:Tango-edit-cut.png" class="image"><img alt="Tango-edit-cut.png" src="../File:Tango-edit-cut.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> 与 <a href="../zh-CN/GRUB.html#%E7%BC%BA%E7%9C%81/%E5%90%8E%E5%A4%87%E5%90%AF%E5%8A%A8%E8%B7%AF%E5%BE%84" title="GRUB (简体中文)">GRUB (简体中文)#缺省/后备启动路径</a>一节重复。 (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:GRUB (简体中文)/Tips and tricks (简体中文)#</a>)</div>
</div>
<p>一些 UEFI 固件要求可启动 <i>.efi</i> 文件叫一个特定的名字而且放在一个特定的位置中： <code><i>esp</i>/EFI/boot/bootx64.efi</code>（其中 <code><i>esp</i></code> 是 UEFI 分区挂载点）。这时如果不能满足这些条件，就会不能启动。好在这对那些没有这些要求的固件没有影响。
</p>
<p>要满足要求，首先创建必要的目录，然后通过如下方式复制 <code>.efi</code> 并重新命名：
</p>
<pre># mkdir <i>esp</i>/EFI/boot
# cp <i>esp</i>/EFI/grub_uefi/grubx64.efi <i>esp</i>/EFI/boot/bootx64.efi
</pre>
<h3>
<span id=".E5.9C.A8.E5.9B.BA.E4.BB.B6.E5.90.AF.E5.8A.A8.E7.AE.A1.E7.90.86.E5.99.A8.E4.B8.AD.E5.88.9B.E5.BB.BA_GRUB_.E6.9D.A1.E7.9B.AE"></span><span class="mw-headline" id="在固件启动管理器中创建_GRUB_条目">在固件启动管理器中创建 GRUB 条目</span>
</h3>
<p><code>grub-install</code> 会自动尝试在启动管理器中创建 GRUB 条目。如果没有成功，请参考 <a href="../zh-CN/Unified_Extensible_Firmware_Interface.html#efibootmgr" title="Unified Extensible Firmware Interface (简体中文)">Unified Extensible Firmware Interface (简体中文)#efibootmgr</a>，里面有如何使用 <code>efibootmgr</code> 创建启动目录条目的介绍。一般来说，这个问题都是因为你没有以 UEFI 模式启动 CD/USB 造成的。请参考 <a href="../zh-CN/Unified_Extensible_Firmware_Interface.html#%E4%BB%8E_ISO_%E5%88%9B%E5%BB%BA_UEFI_%E5%8F%AF%E5%90%AF%E5%8A%A8_USB" title="Unified Extensible Firmware Interface (简体中文)">Unified Extensible Firmware Interface (简体中文)#从 ISO 创建 UEFI 可启动 USB</a>。
</p>
<h3>
<span id=".E7.8B.AC.E7.AB.8B.E7.9A.84_GRUB"></span><span class="mw-headline" id="独立的_GRUB">独立的 GRUB</span>
</h3>
<p>本节假设你要为  x86_64 系统 (x86_64-efi) 创建一个独立的 GRUB。至于 32 位 (IA32) EFI 系统，适当地将 <code>x86_64-efi</code> 修改成 <code>i386-efi</code> 就可以了。
</p>
<p>你可以建立一个 <code>grubx64_standalone.efi</code> 应用，这个 UEFI 应用将所有的模组嵌入应用内部的一个 tar 包中，所以就不需要使用单独的目录来存放 GRUB UEFI 模组和其他相关文件了。使用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> 包里的 <code>grub-mkstandalone</code> 命令按照下面的方法操作来实现这个功能：
</p>
<pre># echo 'configfile ${cmdpath}/grub.cfg' &gt; /tmp/grub.cfg
# grub-mkstandalone -d /usr/lib/grub/x86_64-efi/ -O x86_64-efi --modules="part_gpt part_msdos" --locales="en@quot" --themes="" -o "<i>esp</i>/EFI/grub/grubx64_standalone.efi" "boot/grub/grub.cfg=/tmp/grub.cfg" -v
</pre>
<p>然后把 GRUB 配置文件复制到 <code><i>esp</i>/EFI/grub/grub.cfg</code>，再使用 <a href="../zh-CN/Unified_Extensible_Firmware_Interface.html#efibootmgr" title="Unified Extensible Firmware Interface (简体中文)">efibootmgr</a> 为 <code><i>esp</i>/EFI/grub/grubx64_standalone.efi</code> 创建一个 UEFI 启动管理器条目。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 要让 <code>${cmdpath} </code> 功能正常工作，<code>--modules="part_gpt part_msdos"</code> 选项（包含引号）是必要的。</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 如果你在填写 <code>${cmdpath} </code> 的时候漏掉一个斜杠（比如把 <code>(hd1,msdos2)/EFI/Boot</code> 写成 <code>(hd1,msdos2)EFI/Boot</code>），你就会发现 <code>grub.cfg</code> 文件没法读取，然后被迫进入 GRUB 命令行中。如果出现这样的问题，检查 <code>${cmdpath} </code> 设置成了什么 (<code>echo ${cmdpath} </code>)，然后手工载入配置文件（例如 <code>configfile (hd1,msdos2)/EFI/Boot/grub.cfg</code>）。</div>
<h3>
<span id=".E6.8A.80.E6.9C.AF.E4.BF.A1.E6.81.AF"></span><span class="mw-headline" id="技术信息">技术信息</span>
</h3>
<p>GRUB EFI 文件总是要配置文件放在 <code>${prefix}/grub.cfg</code>。当然在独立的 GRUB EFI 文件中，<code>${prefix} </code> 位于一个 tar 包的内部，嵌入在 GRUB EFI 文件自身之中（在 GRUB 环境中，这被称作 <code>(memdisk)</code>）。这个 tar 包包含了所有在正常的 GRUB EFI 下存储在 <code>/boot/grub</code> 中的文件。
</p>
<p>因为将 <code>/boot/grub</code> 中的内容嵌入到了独立映像的内部，它就不再对任何实际的（外部的） <code>/boot/grub</code> 有任何依赖了。因此在独立 GRUB EFI 文件的情形下 <code>${prefix}==(memdisk)/boot/grub</code>，而且独立的 GRUB EFI 文件认为其配置文件存放于 <code>${prefix}/grub.cfg==(memdisk)/boot/grub/grub.cfg</code>。
</p>
<p>因此要让独立的 GRUB EFI 文件读取存储在与 EFI 文件相同目录（在 GRUB 环境中用 <code>${cmdpath} </code> 表示）下的外部 <code>grub.cfg</code> 时，我们创建一个简单的 <code>/tmp/grub.cfg</code> 来让 GRUB 使用 <code>${cmdpath}/grub.cfg</code> 来做其配置文件。（在 <code>(memdisk)/boot/grub/grub.cfg</code> 中使用 <code>configfile ${cmdpath}/grub.cfg</code> 命令。）然后我们给 grub-mkstandalone 添加 <code>"boot/grub/grub.cfg=/tmp/grub.cfg"</code> 选项，把这个 <code>/tmp/grub.cfg</code> 文件复制到 <code>${prefix}/grub.cfg</code>（事实上就是 <code>(memdisk)/boot/grub/grub.cfg</code>）。
</p>
<p>这样，独立的 GRUB EFI 文件和这个 <code>grub.cfg</code> 可以存放在 EFI 系统分区中的任何一个目录里，只有它们处在同一个目录中就可以。这样它们就变得可移植了。
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Boot_loaders.html" title="Category:Boot loaders (简体中文)">Boot loaders (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Tips_and_tricks_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=644756">https://wiki.archlinux.org/index.php?title=GRUB_(简体中文)/Tips_and_tricks_(简体中文)&amp;oldid=644756</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 12 December 2020, at 09:28.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
