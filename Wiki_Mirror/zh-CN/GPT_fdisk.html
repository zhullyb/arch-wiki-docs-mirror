<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>gPT fdisk (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GPT_fdisk_简体中文 rootpage-GPT_fdisk_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">gPT fdisk (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a><b>本文或本节需要<a href="../zh-CN/ArchWiki:Contributing.html#%E7%BF%BB%E8%AF%91" title="ArchWiki:Contributing (简体中文)">翻译</a>。要贡献翻译，请访问<a href="../zh-CN/ArchWiki:Translation_Team.html" class="mw-redirect" title="ArchWiki Translation Team (简体中文)">简体中文翻译团队</a>。</b><a href="../File:Tango-preferences-desktop-locale.png" class="image"><img alt="Tango-preferences-desktop-locale.png" src="../File:Tango-preferences-desktop-locale.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>附注：</b> <span style="color:red;">请使用模板的第一个参数进行更详细的指示。</span>（在 <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:GPT_fdisk_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Talk:GPT fdisk (简体中文)#</a> 中讨论）</div>
</div>
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/Partitioning.html" title="Partitioning (简体中文)">Partitioning (简体中文)</a></li>
<li><a href="../zh-CN/Fdisk.html" title="Fdisk (简体中文)">fdisk (简体中文)</a></li>
<li><a href="../zh-CN/Parted.html" class="mw-redirect" title="GNU Parted (简体中文)">GNU Parted (简体中文)</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/">GPT fdisk</a> 是编辑 GPT（Globally Unique Identifier Partition Table）硬盘的文本模式工具集。由 gdisk, sgdisk 和 cgdisk 组成. 用于 GPT 而不是老的 MBR(Master Boot Record) 分区表。
</p>
<p>本文介绍 <span class="plainlinks archwiki-template-man" title="$ man 8 gdisk"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gdisk.8">gdisk(8)</a></span> 和 <span class="plainlinks archwiki-template-man" title="$ man 8 sgdisk"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sgdisk.8">sgdisk(8)</a></span> 工具。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>
<span class="plainlinks archwiki-template-man" title="$ man 8 cgdisk"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cgdisk.8">cgdisk(8)</a></span> 提供了基本的功能和命令行用户界面。</li>
<li>GPT fdisk 网站包含了一个 <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/walkthrough.html">gdisk</a>, <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/cgdisk-walkthrough.html">cgdisk</a>, <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/sgdisk-walkthrough.html">sgdisk</a> 和<a rel="nofollow" class="external text" href="https://www.rodsbooks.com/fixparts/">FixParts</a> 的详细使用步骤。</li>
</ul>
</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%E6%98%BE%E7%A4%BA%E5%88%86%E5%8C%BA"><span class="tocnumber">2</span> <span class="toctext">显示分区</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="tocnumber">3</span> <span class="toctext">备份和恢复分区表</span></a></li>
<li class="toclevel-1 tocsection-4">
<a href="#%E5%88%9B%E5%BB%BA%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E5%88%86%E5%8C%BA"><span class="tocnumber">4</span> <span class="toctext">创建分区表和分区</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="tocnumber">4.1</span> <span class="toctext">创建新分区表</span></a></li>
<li class="toclevel-2 tocsection-6">
<a href="#%E5%88%9B%E5%BB%BA%E5%88%86%E5%8C%BA"><span class="tocnumber">4.2</span> <span class="toctext">创建分区</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#%E5%88%86%E5%8C%BA%E7%BC%96%E5%8F%B7"><span class="tocnumber">4.2.1</span> <span class="toctext">分区编号</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#First_and_last_sector"><span class="tocnumber">4.2.2</span> <span class="toctext">First and last sector</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Partition_type"><span class="tocnumber">4.2.3</span> <span class="toctext">Partition type</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Write_changes_to_disk"><span class="tocnumber">4.3</span> <span class="toctext">Write changes to disk</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#%E6%8F%90%E7%A4%BA%E5%92%8C%E6%8A%80%E5%B7%A7"><span class="tocnumber">5</span> <span class="toctext">提示和技巧</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#%E5%9C%A8_MBR_%E5%92%8C_GPT_%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="tocnumber">5.1</span> <span class="toctext">在 MBR 和 GPT 之间转换</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Sort_partitions"><span class="tocnumber">5.2</span> <span class="toctext">Sort partitions</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Recover_GPT_header"><span class="tocnumber">5.3</span> <span class="toctext">Recover GPT header</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Expand_a_GPT_disk"><span class="tocnumber">5.4</span> <span class="toctext">Expand a GPT disk</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Prevent_GPT_partition_automounting"><span class="tocnumber">5.5</span> <span class="toctext">Prevent GPT partition automounting</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">6</span> <span class="toctext">参阅</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">安装</a> 软件包 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gptfdisk">gptfdisk</a></span>。
</p>
<h2>
<span id=".E6.98.BE.E7.A4.BA.E5.88.86.E5.8C.BA"></span><span class="mw-headline" id="显示分区">显示分区</span>
</h2>
<p>要显示分区表和分区信息，以 <code>/dev/sda</code> 磁盘为例: 
</p>
<pre># gdisk -l /dev/sda
</pre>
<p>或者使用 <i>sgdisk</i> 命令:
</p>
<pre># sgdisk -p /dev/sda
</pre>
<h2>
<span id=".E5.A4.87.E4.BB.BD.E5.92.8C.E6.81.A2.E5.A4.8D.E5.88.86.E5.8C.BA.E8.A1.A8"></span><span class="mw-headline" id="备份和恢复分区表">备份和恢复分区表</span>
</h2>
<p>习惯磁盘前，请先备份磁盘的分区表，也可以将磁盘信息备份到相同的设备上。
</p>
<p><i>sgdisk</i> 可以创建一个二进制备份，包含 MBR, GPT 主表头，GPT 备份表头和分区表。下面示例将 <code>/dev/sda</code> 的分区表信息备份到 <code>sgdisk-sda.bin</code>:
</p>
<pre># sgdisk -b=sgdisk-sda.bin /dev/sda
</pre>
<p>通过下面命令恢复备份:
</p>
<pre># sgdisk -l=sgdisk-sda.bin /dev/sda
</pre>
<p>如果要复制分区到其它磁盘，例如从 <code>/dev/sda</code> 复制到 <code>/dev/sdc</code>:
</p>
<pre># sgdisk -R=/dev/sdc /dev/sda
</pre>
<p>如果两个磁盘位于同一个计算机，使用下面命令设置随机的分区 GUIDs:
</p>
<pre># sgdisk -G /dev/sdc
</pre>
<h2>
<span id=".E5.88.9B.E5.BB.BA.E5.88.86.E5.8C.BA.E8.A1.A8.E5.92.8C.E5.88.86.E5.8C.BA"></span><span class="mw-headline" id="创建分区表和分区">创建分区表和分区</span>
</h2>
<p>The first step to <a href="../en/Partitioning.html" title="Partitioning">partitioning</a> a disk is making a partition table. After that, the actual partitions are created according to the desired <a href="../en/Partitioning.html#Partition_scheme" class="mw-redirect" title="Partition scheme">partition scheme</a>.
</p>
<p>Before beginning, you may wish to <a href="#Backup_and_restore_partition_table">backup</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> your current partition table and scheme.
</p>
<p>The following shows how to use <i>gdisk</i> to perform both the creation of a partition table and the creation of the actual partitions. Alternatively, you may use the curses-based version called <i>cgdisk</i>; however, the following instructions do not apply to it. See <span class="plainlinks archwiki-template-man" title="$ man 8 cgdisk"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cgdisk.8">cgdisk(8)</a></span> for its usage.
</p>
<p>performs partition alignment automatically on a 2048 512-byte sector (1 MiB) block size base which should be compatible with all <a href="../en/Advanced_Format.html" title="Advanced Format">Advanced Format</a> HDDs and the vast majority of <a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSDs</a> if not all.
</p>
<p><i>gdisk</i> 自动将分区按 2048 512-byte 扇区（1 MiB）对齐，这个设置兼容所有 <a href="../en/Advanced_Format.html" title="Advanced Format">Advanced Format</a> HDD 和大部分的 <a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a>。
</p>
<p>要使用 <i>gdisk</i>, 将要编辑的分区作为命令参数, 例如要编辑 <code>/dev/sda</code>:
</p>
<pre># gdisk /dev/sda
</pre>
<h3>
<span id=".E5.88.9B.E5.BB.BA.E6.96.B0.E5.88.86.E5.8C.BA.E8.A1.A8"></span><span class="mw-headline" id="创建新分区表">创建新分区表</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you create a new partition table on a disk with data on it, it will erase all the data on the disk. Make sure this is what you want to do.</div>
<p>如果是全新的磁盘，或要清空所有当前分区表数据，使用 <code>o</code> 命令建立一个新的空 GUID 分区表，如果分区已经创建分区，请跳过此步骤。
</p>
<h3>
<span id=".E5.88.9B.E5.BB.BA.E5.88.86.E5.8C.BA"></span><span class="mw-headline" id="创建分区">创建分区</span>
</h3>
<p>使用 <code>n</code> 命令创建一个新的分区. You must enter the partition number, first sector, last sector and the partition type.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="../en/Partitioning.html#Partition_scheme" title="Partitioning">Partitioning#Partition scheme</a> for considerations concerning the size and location of partitions.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>It is advised to follow the <a rel="nofollow" class="external text" href="https://systemd.io/DISCOVERABLE_PARTITIONS/">Discoverable Partitions Specification</a> since <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-gpt-auto-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-gpt-auto-generator.8">systemd-gpt-auto-generator(8)</a></span> will automount them. See <a href="#Prevent_GPT_partition_automounting">#Prevent GPT partition automounting</a> if you want to disable automounting for a partition.</li>
<li>Leave a 1 MiB free space somewhere in the first 2 TiB of the disk (e.g. by using <code>+1M</code> as the first sector of a partition) in case you ever need to create a <a href="../en/GRUB.html#GUID_Partition_Table_(GPT)_specific_instructions" class="mw-redirect" title="BIOS boot partition">BIOS boot partition</a>.</li>
</ul>
<ul><li>如果可能需要建立一个 <a href="../en/GRUB.html#GUID_Partition_Table_(GPT)_specific_instructions" class="mw-redirect" title="BIOS boot partition">BIOS boot partition</a>，在磁盘前 2TiB 内预留一个 1MiB 的空间，例如用 <code>+1M</code> 在磁盘最前面空出一段。</li></ul>
</div>
<h4>
<span id=".E5.88.86.E5.8C.BA.E7.BC.96.E5.8F.B7"></span><span class="mw-headline" id="分区编号">分区编号</span>
</h4>
<p>A partition number is the number assigned to a partition, e.g. a partition with number <code>1</code> on a disk <code>/dev/sda</code> would be <code>/dev/sda1</code>. Partition numbers may not always match the order of partitions on disk, in which case they can be <a href="#Sort_partitions">sorted</a>.
</p>
<p>It is advised to choose the default number suggested by <i>gdisk</i>.
</p>
<h4><span class="mw-headline" id="First_and_last_sector">First and last sector</span></h4>
<p>The first and last sectors of the partition can be specified in sector numbers or as positions measured in kibibytes (<code>K</code>), mebibytes (<code>M</code>), gibibytes (<code>G</code>), tebibytes (<code>T</code>), or pebibytes (<code>P</code>);
</p>
<p>The position can be specified in:
</p>
<ul>
<li>absolute terms from the star of the disk. E.g. <code>40M</code> as a first sector specifies a position 40 MiB from the start of the disk.</li>
<li>relative terms by preceding the size with <code><b>+</b><i>size</i></code> or <code><b>-</b><i>size</i></code>. E.g. <code>+2G</code> to specify a point 2 GiB after the default start sector, or <code>-200M</code> to specify a point 200 MiB before the last available sector.</li>
</ul>
<p>Pressing the <code>Enter</code> key with no input specifies the default value, which is the start of the largest available block for the first sector and the end of the same block for the last sector.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> When partitioning it is always a good idea to specify partition sizes using relative terms with the <code>+<i>size{M,G,T,P}</i></code> notation and not use sizes smaller than 1 MiB. Such partitions will always be aligned according to the device properties.</div>
<h4><span class="mw-headline" id="Partition_type">Partition type</span></h4>
<p>Select the partition's type by entering gdisk's internal type code or specifying the  manually. The default, <code>Linux filesystem</code> (GUID <code>0FC63DAF-8483-4772-8E79-3D69D8477DE4</code>, gdisk's internal code <code>8300</code>), should be fine for most use cases.
</p>
<p>选择 gdisk 类型编码或手动输入<a href="https://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs" class="extiw" title="wikipedia:GUID Partition Table">分区类型 GUID</a>，默认的 <code>Linux filesystem</code> 的 gdisk 代码是 <code>8300</code>，GUID 是 <code>0FC63DAF-8483-4772-8E79-3D69D8477DE4</code>，在大多数情况下都可以使用此类型。
</p>
<table class="wikitable">
<caption>Common partition types
</caption>
<tbody>
<tr>
<th>Partition type
</th>
<th>Mountpoint
</th>
<th>gdisk's
<p>code
</p>
</th>
<th>
<a href="https://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs" class="extiw" title="wikipedia:GUID Partition Table">Partition type GUID</a>
</th>
</tr>
<tr>
<td>Linux filesystem
</td>
<td>Any
</td>
<td>
<code>8300</code>
</td>
<td>
<code>0FC63DAF-8483-4772-8E79-3D69D8477DE4</code>
</td>
</tr>
<tr>
<td>
<a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>
</td>
<td>Any
</td>
<td>
<code>ef00</code>
</td>
<td>
<code>C12A7328-F81F-11D2-BA4B-00A0C93EC93B</code>
</td>
</tr>
<tr>
<td>
<a href="../en/GRUB.html#GUID_Partition_Table_(GPT)_specific_instructions" class="mw-redirect" title="BIOS boot partition">BIOS boot partition</a>
</td>
<td>None
</td>
<td>
<code>ef02</code>
</td>
<td>
<code>21686148-6449-6E6F-744E-656564454649</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Partitioning.html#/" title="Partitioning">Linux x86-64 root (/)</a>
</td>
<td>
<code>/</code>
</td>
<td>
<code>8304</code>
</td>
<td>
<code>4F68BCE3-E8CD-4DB1-96E7-FBCAF984B709</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Partitioning.html#Swap" title="Partitioning">Linux swap</a>
</td>
<td>
<code>[SWAP]</code>
</td>
<td>
<code>8200</code>
</td>
<td>
<code>0657FD6D-A4AB-43C4-84E5-0933C84B4F4F</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Partitioning.html#/home" title="Partitioning">Linux /home</a>
</td>
<td>
<code>/home</code>
</td>
<td>
<code>8302</code>
</td>
<td>
<code>933AC7E1-2EB4-4F13-B844-0E14E2AEF915</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Partitioning.html#Discrete_partitions" title="Partitioning">Linux /srv</a>
</td>
<td>
<code>/srv</code>
</td>
<td>
<code>8306</code>
</td>
<td>
<code>3B8F8425-20E0-4F3B-907F-1A25A76F98E8</code>
</td>
</tr>
<tr>
<td>
<a href="../en/LVM.html#Create_partitions" title="LVM">Linux LVM</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>
</td>
<td>Any
</td>
<td>
<code>8e00</code>
</td>
<td>
<code>E6D6D379-F507-44C2-A23C-238F2A3DF928</code>
</td>
</tr>
<tr>
<td>
<a href="../en/RAID.html#GUID_Partition_Table" title="RAID">Linux RAID</a>
</td>
<td>Any
</td>
<td>
<code>fd00</code>
</td>
<td>
<code>A19D880F-05FC-4D3B-A006-743F0F84911E</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Dm-crypt/Drive_preparation.html#Physical_partitions" title="Dm-crypt/Drive preparation">Linux LUKS</a>
</td>
<td>Any
</td>
<td>
<code>8309</code>
</td>
<td>
<code>CA7D7CCB-63ED-4C53-861C-1742536059CC</code>
</td>
</tr>
<tr>
<td>
<a href="../en/Dm-crypt/Drive_preparation.html#Physical_partitions" title="Dm-crypt/Drive preparation">Linux dm-crypt</a>
</td>
<td>Any
</td>
<td>
<code>8308</code>
</td>
<td>
<code>7FFEC5C9-2D00-49B7-8941-3EA10A5586B7</code>
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 按下 <code>L</code> 可以显示 gdisk 的内部编码列表。</div>
<p>Repeat this procedure until you have the partitions you desire.
</p>
<h3><span class="mw-headline" id="Write_changes_to_disk">Write changes to disk</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use the command <code>c</code> to change a partition's name (<a href="../en/Persistent_block_device_naming.html#by-partlabel" title="Persistent block device naming">PARTLABEL</a>) for easy identification.</div>
<p>使用 <code>w</code> 命令将分区表写入磁盘并退出。
</p>
<h2>
<span id=".E6.8F.90.E7.A4.BA.E5.92.8C.E6.8A.80.E5.B7.A7"></span><span class="mw-headline" id="提示和技巧">提示和技巧</span>
</h2>
<h3>
<span id=".E5.9C.A8_MBR_.E5.92.8C_GPT_.E4.B9.8B.E9.97.B4.E8.BD.AC.E6.8D.A2"></span><span class="mw-headline" id="在_MBR_和_GPT_之间转换">在 MBR 和 GPT 之间转换</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 更多信息请阅读 Rod Smith 的 <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/mbr2gpt.html">MBR 到 GPT 转换说明</a>。</div>
<p>转换之后，需要重新安装 <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loaders</a> 并配置为从 GPT 启动。
</p>
<p>gdisk、sgdisk 和 cgdisk 能将 MBR 和 <a href="https://en.wikipedia.org/wiki/BSD_disklabel" class="extiw" title="wikipedia:BSD disklabel">BSD 盘符</a> 无损转换为 GPT。转换时，所有 MBR 主分区和逻辑分区都会变成 GPT 分区并生成有正确的分区类型 GUID 和唯一分区 GUID. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>GPT 在硬盘末尾存储了第二分区表。这个数据结构默认有 33512B 空间。MBR 不具有类似数据结构，这意味着 MBR 硬盘的最后一个分区的最后一部分可能被占用进而妨碍到完全的转换。如果这发生在你身上，你必须放弃转换，改变最后一个分区的大小。</li>
<li>在 RAID 模式下的基于 Intel的笔记本有一些关于备份 GPT 表损坏的问题，解决方法是尽可能使用 AHCI 替代 RAID.</li>
</ul>
</div>
<p>只需打开 MBR, 用 gdisk 的"w"选项来把改变写入到硬盘(和 fdisk 类似)以转换到 GPT. <b>警惕所有错误并在写入硬盘之前修复它们</b>，因为你会有损失数据的风险。
</p>
<p>要用 <i>sgdisk</i> 将 MBR 分区表转换为 GPT，使用 <code>-g</code>/<code>--mbrtogpt</code> 选项:
</p>
<pre># sgdisk -g /dev/sda
</pre>
<p>要将 GPT 转换为 MBR，使用 <code>-m</code>/<code>--gpttombr</code> 选项，注意最多只能转换四个分区。
</p>
<pre># sgdisk -m /dev/sda
</pre>
<h3><span class="mw-headline" id="Sort_partitions">Sort partitions</span></h3>
<p>This applies for when a new partition is created in the space between two partitions or a partition is deleted. <code>/dev/sda</code> is used in this example.
</p>
<pre># sgdisk -s /dev/sda
</pre>
<p>After sorting the partitions if you are not using <a href="../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a>, it might be required to adjust the <code>/etc/fstab</code> and/or the <code>/etc/crypttab</code> configuration files.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The kernel must read the new partition table for the partitions (e.g. <code>/dev/sda1</code>) to be usable. Reboot the system or tell the kernel to <a rel="nofollow" class="external text" href="https://serverfault.com/questions/36038/reread-partition-table-without-rebooting">reread the partition table</a>.</div>
<h3><span class="mw-headline" id="Recover_GPT_header">Recover GPT header</span></h3>
<p>In case main GPT header or backup GPT header gets damaged, you can recover one from the other with <i>gdisk</i>. <code>/dev/sda</code> is used in this example.
</p>
<pre># gdisk /dev/sda
</pre>
<p>choose <code>r</code> for recovery and transformation options (experts only). From there choose either
</p>
<ul>
<li>
<code>b</code>: use backup GPT header (rebuilding main)</li>
<li>
<code>d</code>: use main GPT header (rebuilding backup)</li>
</ul>
<p>When done write the table to disk and exit via the <code>w</code> command.
</p>
<h3><span class="mw-headline" id="Expand_a_GPT_disk">Expand a GPT disk</span></h3>
<p>After enlarging a disk (e.g. in hardware <a href="../en/RAID.html" title="RAID">RAID</a> or a <a href="../en/Category:Virtualization.html" class="mw-redirect" title="Virtual machine">virtual machine</a> disk) the newly added free space will not be immediately usable since GPT keeps data at the end of the disk. You must relocate the backup GPT header to the new end of the disk.
</p>
<p>Run <i>sgdisk</i> with the option <code>-e</code>/<code>--move-second-header</code>, e.g.:
</p>
<pre># sgdisk -e /dev/sda
</pre>
<p>Afterwards <a href="#List_partitions">print the partition table</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>; the total free space should now be increased.
</p>
<h3><span class="mw-headline" id="Prevent_GPT_partition_automounting">Prevent GPT partition automounting</span></h3>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 systemd-gpt-auto-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-gpt-auto-generator.8">systemd-gpt-auto-generator(8)</a></span> will automount partitions following the <a rel="nofollow" class="external text" href="https://systemd.io/DISCOVERABLE_PARTITIONS/">Discoverable Partitions Specification</a>. Sometimes that may not be desirable.
</p>
<p>The automounting can be disabled by setting the <a href="https://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_entries_.28LBA_2-33.29" class="extiw" title="wikipedia:GUID Partition Table">partition attribute</a> <code>63</code> "do not automount" on the partition.
</p>
<p>Start <i>gdisk</i>, e.g.:
</p>
<pre># gdisk /dev/sda
</pre>
<p>Press <code>p</code> to print the partition table and take note of the partition number(s) of the for which you want to disable automounting.
</p>
<p>Press <code>x</code> <i>extra functionality (experts only)</i>.
</p>
<p>Press <code>a</code> <i>set attributes</i>. Input the partition number and set the attribute <code>63</code>. Under <code>Set fields are:</code> it should now show <code>63 (do not automount)</code>. Press <code>Enter</code> to end attribute changing. Repeat this for all partitions you want to prevent from automounting.
</p>
<p>When done write the table to disk and exit via the <code>w</code> command.
</p>
<p>Alternatively using <i>sgdisk</i>, the attribute can be set using the <code>-A</code>/<code>--attributes=</code> option; see <span class="plainlinks archwiki-template-man" title="$ man 8 sgdisk"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sgdisk.8">sgdisk(8)</a></span> for usage. For example, to set partition attribute <code>63</code> "do not automount" on <code>/dev/sda2</code> run:
</p>
<pre># sgdisk -A 2:set:63 /dev/sda
</pre>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://www.rodsbooks.com/gdisk/index.html">GPT fdisk Tutorial</a> - offical webpage of GPT fdisk with detailed walkthroughs.</li>
<li><a rel="nofollow" class="external text" href="https://sourceforge.net/projects/gptfdisk/">GPT fdisk's SourceForge page</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:File_systems.html" title="Category:File systems (简体中文)">File systems (简体中文)</a></li>
<li><a href="../zh-CN/Category:System_recovery.html" title="Category:System recovery (简体中文)">System recovery (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../zh-CN/Category:Pages_or_sections_flagged_with_Template:Translateme.html" title="Category:Pages or sections flagged with Template:Translateme (简体中文)">Pages or sections flagged with Template:Translateme (简体中文)</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GPT_fdisk_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=638411">https://wiki.archlinux.org/index.php?title=GPT_fdisk_(简体中文)&amp;oldid=638411</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 October 2020, at 07:12.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
