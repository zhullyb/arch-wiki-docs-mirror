<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Wpa supplicant (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Wpa_supplicant_简体中文 rootpage-Wpa_supplicant_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Wpa supplicant (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/Network_configuration.html" class="mw-redirect" title="网络配置">网络配置</a></li>
<li><a href="../zh-CN/aa29dd559001de6a26e3fe87e084eb6e.html" class="mw-redirect" title="无线网络配置">无线网络配置</a></li>
<li><a href="../en/Iwd.html" title="Iwd">iwd</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Wpa_supplicant.html" class="mw-redirect" title="WPA supplicant">WPA supplicant</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2019-03-12。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=WPA_supplicant&amp;diff=0&amp;oldid=557354">更改</a>，则您可以帮助同步翻译。</div>
<p><a rel="nofollow" class="external text" href="http://hostap.epitest.fi/wpa_supplicant/">wpa_supplicant</a> 是跨平台的 WPA <a href="https://en.wikipedia.org/wiki/Supplicant_(computer)" class="extiw" title="wikipedia:Supplicant (computer)">请求者程序（supplicant）</a>，支持 WEP、WPA 和 WPA2(<a href="https://en.wikipedia.org/wiki/IEEE_802.11i-2004" class="extiw" title="wikipedia:IEEE 802.11i-2004">IEEE 802.11i</a>).。可以在桌面、笔记本甚至嵌入式系统中使用。
</p>
<p><i>wpa_supplicant</i> 是在客户端使用的 IEEE 802.1X/WPA 组件，支持与 WPA Authenticator 的交互，控制漫游和无线驱动的<a href="https://en.wikipedia.org/wiki/IEEE_802.11" class="extiw" title="wikipedia:IEEE 802.11">IEEE 802.11</a> 验证和关联。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%E6%A6%82%E8%A7%88"><span class="tocnumber">2</span> <span class="toctext">概览</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#%E7%94%A8_wpa_cli_%E8%BF%9E%E6%8E%A5"><span class="tocnumber">3</span> <span class="toctext">用 wpa_cli 连接</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#%E5%B8%A6_wpa_%E9%80%9A%E8%A1%8C%E5%AD%97%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="tocnumber">4</span> <span class="toctext">带 wpa 通行字的连接</span></a></li>
<li class="toclevel-1 tocsection-5">
<a href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="tocnumber">5</span> <span class="toctext">高级用法</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">5.1</span> <span class="toctext">配置</span></a></li>
<li class="toclevel-2 tocsection-7">
<a href="#%E8%BF%9E%E6%8E%A5"><span class="tocnumber">5.2</span> <span class="toctext">连接</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#%E6%89%8B%E5%8A%A8%E8%BF%9E%E6%8E%A5"><span class="tocnumber">5.2.1</span> <span class="toctext">手动连接</span></a></li>
<li class="toclevel-3 tocsection-9">
<a href="#%E5%BC%95%E5%AF%BC%E6%97%B6%E8%BF%9E%E6%8E%A5%EF%BC%88systemd%EF%BC%89"><span class="tocnumber">5.2.2</span> <span class="toctext">引导时连接（systemd）</span></a>
<ul>
<li class="toclevel-4 tocsection-10"><a href="#802.1x/radius"><span class="tocnumber">5.2.2.1</span> <span class="toctext">802.1x/radius</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#wpa_cli_%E6%93%8D%E4%BD%9C%E8%84%9A%E6%9C%AC"><span class="tocnumber">5.3</span> <span class="toctext">wpa_cli 操作脚本</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%E6%8E%92%E9%94%99"><span class="tocnumber">6</span> <span class="toctext">排错</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#%E6%9F%90%E4%BA%9B%E7%A1%AC%E4%BB%B6%E4%B8%8A_nl80211_%E9%A9%B1%E5%8A%A8%E4%B8%8D%E6%94%AF%E6%8C%81"><span class="tocnumber">6.1</span> <span class="toctext">某些硬件上 nl80211 驱动不支持</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E6%8C%82%E8%BD%BD%E4%BA%86%E7%BD%91%E7%BB%9C%E5%85%B1%E4%BA%AB%EF%BC%88CIFS%EF%BC%89%E6%97%B6%E7%9A%84%E5%85%B3%E6%9C%BA%E9%97%AE%E9%A2%98"><span class="tocnumber">6.2</span> <span class="toctext">挂载了网络共享（CIFS）时的关机问题</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#%E5%8F%A3%E4%BB%A4%E7%9B%B8%E5%85%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="tocnumber">6.3</span> <span class="toctext">口令相关的问题</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">7</span> <span class="toctext">参阅</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">安装</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span> 软件包。此软件包提供了主程序 <i>wpa_supplicant</i>，密码工具 <i>wpa_passphrase</i> 和文字界面前端 <i>wpa_cli</i>.
</p>
<p>此外软件包 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wpa_supplicant_gui/">wpa_supplicant_gui</a></span><sup><small>AUR</small></sup> 提供了图形界面 <i>wpa_gui</i>。 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wpa-cute/">wpa-cute</a></span><sup><small>AUR</small></sup> 是 <i>wpa_gui</i> 的一个分支，提供了额外的修正和改进。
</p>
<h2>
<span id=".E6.A6.82.E8.A7.88"></span><span class="mw-headline" id="概览">概览</span>
</h2>
<p>连接到加密无线网络的第一步是让 <i>wpa_supplicant</i> 获取 WPA 认证者的认证。为此， <i>wpa_supplicant</i> 必须进行配置以使其能够向认证者提交认证信息。
</p>
<p>完成认证后需要分配 IP 地址，请参考:<a href="../en/Network_configuration.html#IP_addresses" title="Network configuration">Network configuration#IP addresses</a>。
</p>
<h2>
<span id=".E7.94.A8_wpa_cli_.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="用_wpa_cli_连接">用 wpa_cli 连接</span>
</h2>
<p>This connection method allows scanning for available networks, making use of <i>wpa_cli</i>, a command line tool which can be used to  configure <i>wpa_supplicant</i>. See <span class="plainlinks archwiki-template-man" title="$ man 8 wpa_cli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_cli.8">wpa_cli(8)</a></span> for details.
</p>
<p>In order to use <i>wpa_cli</i>, a control interface must be specified for <i>wpa_supplicant</i>, and it must be given the rights to update the configuration. Do this by creating a minimal configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wpa_supplicant/wpa_supplicant.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ctrl_interface=/run/wpa_supplicant
update_config=1</pre>
<p>Now start <i>wpa_supplicant</i> with:
</p>
<pre># wpa_supplicant -B -i <i>interface</i> -c /etc/wpa_supplicant/wpa_supplicant.conf
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> To discover your wireless network interface name, issue the <code>ip link</code> command.</div>
<p>At this point run:
</p>
<pre># wpa_cli
</pre>
<p>This will present an interactive prompt (<code>&gt;</code>), which has tab completion and descriptions of completed commands.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> The default location of the control socket is <code>/var/run/wpa_supplicant/</code>, custom path can be set manually with the <code>-p</code> option to match the <i>wpa_supplicant</i> configuration. It is also possible to specify the interface to be configured with the <code>-i</code> option, otherwise the first found wireless interface managed by <i>wpa_supplicant</i> will be used.</div>
<p>Use the <code>scan</code> and <code>scan_results</code> commands to see the available networks:
</p>
<pre>&gt; scan
OK
&lt;3&gt;CTRL-EVENT-SCAN-RESULTS
&gt; scan_results
bssid / frequency / signal level / flags / ssid
00:00:00:00:00:00 2462 -49 [WPA2-PSK-CCMP][ESS] MYSSID
11:11:11:11:11:11 2437 -64 [WPA2-PSK-CCMP][ESS] ANOTHERSSID
</pre>
<p>To associate with <code>MYSSID</code>, add the network, set the credentials and enable it:
</p>
<pre>&gt; add_network
0
&gt; set_network 0 ssid "MYSSID"
&gt; set_network 0 psk "passphrase"
&gt; enable_network 0
&lt;2&gt;CTRL-EVENT-CONNECTED - Connection to 00:00:00:00:00:00 completed (reauth) [id=0 id_str=]
</pre>
<p>If the SSID does not have password authentication, you must explicitly configure the network as keyless by replacing the command <code>set_network 0 psk "passphrase"</code> with <code>set_network 0 key_mgmt NONE</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>Each network is indexed numerically, so the first network will have index 0.</li>
<li>The <a href="https://en.wikipedia.org/wiki/Pre-shared_key" class="extiw" title="wikipedia:Pre-shared key">PSK</a> is computed from the <i>quoted</i> "passphrase" string, as also shown by the <a href="#Connecting_with_wpa_passphrase">wpa_passphrase</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> command. Nonetheless, you can enter the PSK directly by passing it to <code>psk</code> <i>without</i> quotes.</li>
</ul>
</div>
<p>Finally save this network in the configuration file:
</p>
<pre>&gt; save_config
OK
</pre>
<p>Once association is complete, you must obtain an IP address, for example, using <a href="../en/Dhcpcd.html#Running" title="Dhcpcd">dhcpcd</a>.
</p>
<h2>
<span id=".E5.B8.A6_wpa_.E9.80.9A.E8.A1.8C.E5.AD.97.E7.9A.84.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="带_wpa_通行字的连接">带 wpa 通行字的连接</span>
</h2>
<p>用命令行工具 <i>wpa_passphrase</i> 生成 <i>wpa_supplicant</i> 所需的最小配置，可以快速连接到已知 SSID 的无线网络。例如：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ wpa_passphrase MYSSID passphrase</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">network={
    ssid="MYSSID"
    #psk="passphrase"
    psk=59e0d07fa4c7741797a4e394f38a5c321e3bed51d54ad5fcbd3f84bc7415d73d
}</pre>
<p>上例表明，<i>wpa_supplicant</i> 可以与 <i>wpa_passphrase</i> 协同工作，只需简单地这样即可做：
</p>
<pre># wpa_supplicant -B -i <i>interface</i> -c &lt;(wpa_passphrase MYSSID passphrase)
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 由于存在进程替换，这个命令<b>不能</b>以 <a href="../en/Sudo.html" title="Sudo">sudo</a> 方式执行，必须切换到 root 身份。否则会报错：
<pre>Successfully initialized wpa_supplicant
Failed to open config file '/dev/fd/63', error: No such file or directory
Failed to read or parse configuration '/dev/fd/63'
</pre>
参阅：<a href="../zh-CN/Help:Reading.html#%E4%B8%80%E8%88%AC%E7%94%A8%E6%88%B7%E8%BF%98%E6%98%AF_root_%E7%94%A8%E6%88%B7" title="Help:Reading (简体中文)">Help:Reading (简体中文)#一般用户还是 root 用户</a>。</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 
<ul>
<li>如果输入内容包含空格请使用引号。例如：<code>"secret passphrase"</code>。</li>
<li>要找出无线网卡的名字，使用 <code>ip link</code> 命令。</li>
<li>某些不常用的复杂通行字要求从文件输入，例如：<code>wpa_passphrase MYSSID &lt; passphrase.txt</code>；或者从命令行输入，例如：<code>wpa_passphrase MYSSID &lt;&lt;&lt; "passphrase"</code>。</li>
</ul>
</div>
<p>连接后需要获取 IP 地址，可以使用 <a href="../en/Dhcpcd.html#Running" title="Dhcpcd">dhcpcd</a>.
</p>
<h2>
<span id=".E9.AB.98.E7.BA.A7.E7.94.A8.E6.B3.95"></span><span class="mw-headline" id="高级用法">高级用法</span>
</h2>
<p>对于各种纷繁复杂的网络，更常见的场景是使用 <a rel="nofollow" class="external text" href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E8%AE%A4%E8%AF%81%E5%8D%8F%E8%AE%AE">EAP</a> 管理配置文件。各种配置及其范例可参阅手册页<span class="plainlinks archwiki-template-man" title="$ man 5 wpa_supplicant.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_supplicant.conf.5">wpa_supplicant.conf(5)</a></span>；所有可支持的配置参数可参考范例文件 <code>/etc/wpa_supplicant/wpa_supplicant.conf</code>。
</p>
<h3>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h3>
<p>如上文中<a href="#%E5%B8%A6_wpa_%E9%80%9A%E8%A1%8C%E5%AD%97%E7%9A%84%E8%BF%9E%E6%8E%A5">#带 wpa 通行字的连接</a>一节所述，一个基本的配置文件可以这样生成：
</p>
<pre># wpa_passphrase MYSSID passphrase &gt; /etc/wpa_supplicant/example.conf
</pre>
<p>这样仅仅是创建了一个网络配置节段。包含更多通用配置项的配置文件类似下面这样：
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wpa_supplicant/example.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=wheel
update_config=1
fast_reauth=1
ap_scan=1

network={
    ssid="MYSSID"
    psk=59e0d07fa4c7741797a4e394f38a5c321e3bed51d54ad5fcbd3f84bc7415d73d
}</pre>
<p>如果可以不顾及安全问题，其中的通行字可以换成由引号包围的纯文本：
</p>
<pre>network={
    ssid="MYSSID"
    psk="passphrase"
}</pre>
<p>如果某一网络没有设置通行字，比如一个公共无线网络，就是这样：
</p>
<pre>network={
    ssid="MYSSID"
    key_mgmt=NONE
}</pre>
<p>Further <code>network</code> blocks may be added manually, or using <i>wpa_cli</i> as illustrated in <a href="#Connecting_with_wpa_cli">#Connecting with wpa_cli</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>. In order to use <i>wpa_cli</i>, a control interface must be set with the <code>ctrl_interface</code> option. Setting <code>ctrl_interface_group=wheel</code> allows users belonging to such group to execute <i>wpa_cli</i>. This setting can be used to enable users without root access (or equivalent via sudo etc) to connect to wireless networks. Also add <code>update_config=1</code> so that changes made with <i>wpa_cli</i> to <code>example.conf</code> can be saved. Note that any user that is a member of the <code>ctrl_interface_group</code> group will be able to make changes to the file if this is turned on.
</p>
<p><code>fast_reauth=1</code> and <code>ap_scan=1</code> are the <i>wpa_supplicant</i> options active globally at the time of writing. Whether you need them, or other global options too for that matter, depends on the type of network to connect to. If you need other global options, simply copy them over to the file from <code>/etc/wpa_supplicant/wpa_supplicant.conf</code>. 
</p>
<p>Alternatively, <code>wpa_cli set</code> can be used to see options' status or set new ones. Multiple network blocks may be appended to this configuration: the supplicant will handle association to and roaming between all of them. The strongest signal defined with a network block usually is connected to by default, one may define <code>priority=</code> to influence behaviour. 
</p>
<p>An advantage to be mentioned in using a customized configuration file at <code>/etc/wpa_supplicant/wpa_supplicant.conf</code> is that it is used by default by <a href="../en/Dhcpcd.html" title="Dhcpcd">dhcpcd</a>. If you do so, you might want to make a backup of the original and delete the extensive network block examples in it. Otherwise, do not be surprised if your device suddenly connects to networks defined in them. In any case, changes to new versions of the configuration file should of course be <a href="../en/Pacman/Pacnew_and_Pacsave.html" class="mw-redirect" title="Pacnew and Pacsave files">merged</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> To configure a network block to a hidden wireless <i>SSID</i>, which by definition will not turn up in a regular scan, the option <code>scan_ssid=1</code> has to be defined in the network block.</div>
<h3>
<span id=".E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="连接">连接</span>
</h3>
<h4>
<span id=".E6.89.8B.E5.8A.A8.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="手动连接">手动连接</span>
</h4>
<p>First start <i>wpa_supplicant</i> command, whose most commonly used arguments are:
</p>
<ul>
<li>
<code>-B</code> - Fork into background.</li>
<li>
<code>-c <i>filename</i></code> - Path to configuration file.</li>
<li>
<code>-i <i>interface</i></code> - Interface to listen on.</li>
<li>
<code>-D <i>driver</i></code> - Optionally specify the driver to be used. For a list of supported drivers see the output of <code>wpa_supplicant -h</code>.
<ul>
<li>
<code>nl80211</code> is the current standard, but not all wireless chip's modules support it.</li>
<li>
<code>wext</code> is currently deprecated, but still widely supported.</li>
</ul>
</li>
</ul>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 wpa_supplicant"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_supplicant.8">wpa_supplicant(8)</a></span> for the full argument list. For example:
</p>
<pre># wpa_supplicant -B -i <i>interface</i> -c /etc/wpa_supplicant/example.conf
</pre>
<p>followed by a method to obtain an ip address manually as indicated in the <a href="#Overview">#Overview</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>, for example:
</p>
<pre># dhcpcd <i>interface</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> <i>dhcpcd</i> has a hook that can lauch <i>wpa_supplicant</i> implicitly, see <a href="../en/Dhcpcd.html#10-wpa_supplicant" title="Dhcpcd">dhcpcd#10-wpa_supplicant</a>.</div>
<h4>
<span id=".E5.BC.95.E5.AF.BC.E6.97.B6.E8.BF.9E.E6.8E.A5.EF.BC.88systemd.EF.BC.89"></span><span class="mw-headline" id="引导时连接（systemd）">引导时连接（systemd）</span>
</h4>
<p><i>wpa_supplicant</i> 软件包中提供了多个 <a href="../zh-CN/Systemd.html" title="Systemd (简体中文)">systemd</a> 服务文件：
</p>
<ul>
<li>
<code>wpa_supplicant.service</code> - 使用 <a href="../zh-CN/D-Bus.html" title="D-Bus (简体中文)">D-Bus</a> ，建议 <a href="../zh-CN/NetworkManager.html" title="NetworkManager (简体中文)">NetworkManager</a> 用户使用。</li>
<li>
<code>wpa_supplicant@.service</code> - 接受网口名作为参数，启动服务于该网口的 <i>wpa_supplicant</i> 守护进程。这个服务将读取 <code>/etc/wpa_supplicant/wpa_supplicant-<i>interface</i>.conf</code> 这个配置文件。</li>
<li>
<code>wpa_supplicant-nl80211@.service</code> - 同样接受网口名作为参数，但明确限定使用 <code>nl80211</code> 驱动（详阅下文）。它的配置文件是 <code>/etc/wpa_supplicant/wpa_supplicant-nl80211-<i>interface</i>.conf</code>。</li>
<li>
<code>wpa_supplicant-wired@.service</code> - 同样接受网口名作为参数，使用 <code>wired</code>（有线网络）驱动。它的配置文件是 <code>/etc/wpa_supplicant/wpa_supplicant-wired-<i>interface</i>.conf</code>。</li>
</ul>
<p>在引导时激活无线网络，就是激活服务于某个无线网络接口的上述服务单元之一。
</p>
<p>现在就可以像<a href="#%E6%A6%82%E8%A7%88">概览</a>一节所述，可以选定某个网络接口并<a href="../zh-CN/Systemd.html" title="Systemd (简体中文)">激活</a>其服务单元的一个实例，从而获取一个 IP 地址。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> <i>dhcpcd</i> 可以后台加载 <i>wpa_supplicant</i> ，参阅 <a href="../zh-CN/Dhcpcd.html#10-wpa_supplicant" title="Dhcpcd (简体中文)">dhcpcd (简体中文)#10-wpa_supplicant</a>.</div>
<h5>
<span id="802.1x.2Fradius"></span><span class="mw-headline" id="802.1x/radius">802.1x/radius</span>
</h5>
<p>To connect a wired adapter using 802.1x/radius you will need to specify some configurations and enable the necessary service for the adapter. This is useful for headless servers using <i>networkd</i>.
</p>
<p>Replace <code><i>adapter</i></code> with the wired adapter you wish to connect, and adapt the settings to match your 802.1x/radius requirements.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/wpa_supplicant/wpa_supplicant-wired-<i>adapter</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ctrl_interface=/var/run/wpa_supplicant
ap_scan=0
network={
  key_mgmt=IEEE8021X
  eap=PEAP
  identity="<i>user_name</i>"
  password="<i>user_password</i>"
  phase2="autheap=MSCHAPV2"
}</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The same configuration, but for a wireless adapter, would require changing <code>IEEE8021X</code> to <code>WPA-EAP</code> and removing the <code>ap_scan=0</code> line</div>
<p>Since this file is storing a plaintext password, <a href="../en/File_permissions_and_attributes.html#Changing_ownership" class="mw-redirect" title="Chown">chown</a> it to <code>root:root</code> and <a href="../en/File_permissions_and_attributes.html#Changing_permissions" class="mw-redirect" title="Chmod">chmod</a> it to <code>600</code>.
</p>
<p>Before running the <code>wpa_supplicant-wired@<i>adapter</i>.service</code> service, make sure to set the device down:
</p>
<pre># ip link set <i>adapter</i> down
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> This setup can be used during system installation as well, though you may want to run using <code>dhcpcd@<i>adapter</i>.service</code> to solicit an address.</div>
<h3>
<span id="wpa_cli_.E6.93.8D.E4.BD.9C.E8.84.9A.E6.9C.AC"></span><span class="mw-headline" id="wpa_cli_操作脚本">wpa_cli 操作脚本</span>
</h3>
<p><i>wpa_cli</i> can run in daemon mode and execute a specified script based on events from <i>wpa_supplicant</i>. Two events are supported: <code>CONNECTED</code> and <code>DISCONNECTED</code>. Some <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a> are available to the script, see <span class="plainlinks archwiki-template-man" title="$ man 8 wpa_cli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_cli.8">wpa_cli(8)</a></span> for details.
</p>
<p>The following example will use <a href="../en/Desktop_notifications.html" title="Desktop notifications">desktop notifications</a> to notify the user about the events:
</p>
<pre>#!/bin/bash

case "$2" in
    CONNECTED)
        notify-send "WPA supplicant: connection established";
        ;;
    DISCONNECTED)
        notify-send "WPA supplicant: connection lost";
        ;;
esac
</pre>
<p>Remember to make the script executable, then use the <code>-a</code> flag to pass the script path to <i>wpa_cli</i>:
</p>
<pre>$ wpa_cli -a <i>/path/to/script</i>
</pre>
<h2>
<span id=".E6.8E.92.E9.94.99"></span><span class="mw-headline" id="排错">排错</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> Make sure that you are <b>not</b> using the default configuration file at <code>/etc/wpa_supplicant/wpa_supplicant.conf</code>, which is filled with uncommented examples that will lead to lots of random errors in practice. This is a known packaging bug of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span> package: <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/40661">FS#40661</a>.</div>
<h3>
<span id=".E6.9F.90.E4.BA.9B.E7.A1.AC.E4.BB.B6.E4.B8.8A_nl80211_.E9.A9.B1.E5.8A.A8.E4.B8.8D.E6.94.AF.E6.8C.81"></span><span class="mw-headline" id="某些硬件上_nl80211_驱动不支持">某些硬件上 nl80211 驱动不支持</span>
</h3>
<p>On some (especially old) hardware, <i>wpa_supplicant</i> may fail with the following error:
</p>
<pre>Successfully initialized wpa_supplicant
nl80211: Driver does not support authentication/association or connect commands
wlan0: Failed to initialize driver interface
</pre>
<p>This indicates that the standard <code>nl80211</code> driver does not support the given hardware. The deprecated <code>wext</code> driver might still support the device:
</p>
<pre># wpa_supplicant -B -i wlan0 <b>-D wext</b> -c /etc/wpa_supplicant/example.conf
</pre>
<p>If the command works to connect, and the user wishes to use <a href="../en/Systemd.html" title="Systemd">systemd</a> to manage the wireless connection, it is necessary to <a href="../en/Systemd.html#Drop-in_files" title="Systemd">edit</a> the <code>wpa_supplicant@.service</code> unit provided by the package and modify the <code>ExecStart</code> line accordingly:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wpa_supplicant@.service.d/wext.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/wpa_supplicant -c/etc/wpa_supplicant/wpa_supplicant-%I.conf -i%I <b>-Dnl80211,wext</b></pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> Multiple comma separated driver wrappers in option <code>-Dnl80211,wext</code> makes <i>wpa_supplicant</i> use the first driver wrapper that is able to initialize the interface (see <span class="plainlinks archwiki-template-man" title="$ man 8 wpa_supplicant"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_supplicant.8">wpa_supplicant(8)</a></span>). This is useful when using mutiple or removable (e.g. USB) wireless devices which use different drivers.</div>
<h3>
<span id=".E6.8C.82.E8.BD.BD.E4.BA.86.E7.BD.91.E7.BB.9C.E5.85.B1.E4.BA.AB.EF.BC.88CIFS.EF.BC.89.E6.97.B6.E7.9A.84.E5.85.B3.E6.9C.BA.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="挂载了网络共享（CIFS）时的关机问题">挂载了网络共享（CIFS）时的关机问题</span>
</h3>
<p>When you use wireless to connect to network shares you might have the problem that the shutdown takes a very long time. That is because systemd runs against a 3 minute timeout. The reason is that WPA supplicant is shut down too early, i.e. before systemd tries to unmount the share(s). A <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/1435">bug report</a> suggests a work-around by <a href="../en/Systemd.html#Drop-in_files" title="Systemd">editing</a> the <code>wpa_supplicant@.service</code> as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wpa_supplicant.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
After=dbus.service</pre>
<h3>
<span id=".E5.8F.A3.E4.BB.A4.E7.9B.B8.E5.85.B3.E7.9A.84.E9.97.AE.E9.A2.98"></span><span class="mw-headline" id="口令相关的问题">口令相关的问题</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span> may not work properly if directly passed via stdin particularly long or complex passphrases which include special characters. This may lead to errors such as <code>failed 4-way WPA handshake, PSK may be wrong</code> when launching <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wpa_supplicant">wpa_supplicant</a></span>.
</p>
<p>In order to solve this try using here strings <code>wpa_passphrase &lt;MYSSID&gt; &lt;&lt;&lt; "&lt;passphrase&gt;"</code> or passing a file to the <code>-c</code>  flag instead:
</p>
<pre>$ wpa_supplicant -i &lt;interface&gt; -c /etc/wpa_supplicant/wpa_supplicant.conf
</pre>
<p>In some instances it was found that storing the passphrase cleartext in the <code>psk</code> key of the <code>wpa_supplicant.conf</code> <code>network</code> block gave positive results (see <a rel="nofollow" class="external autonumber" href="https://www.linuxquestions.org/questions/linux-wireless-networking-41/wpa-4-way-handshake-failed-843394/">[1]</a>). However, this approach is rather insecure. Using <code>wpa_cli</code> to create this file instead of manually writing it gives the best results most of the time and therefore is the recommended way to proceed.
</p>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://w1.fi/wpa_supplicant/">wpa_supplicant 主页</a></li>
<li>
<a rel="nofollow" class="external text" href="https://w1.fi/cgit/hostap/plain/wpa_supplicant/README">wpa_supplicant README</a> - 包含项目完整文档.</li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/buhman/7162560">wpa_cli 用例</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 wpa_supplicant"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_supplicant.8">wpa_supplicant(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 wpa_supplicant.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_supplicant.conf.5">wpa_supplicant.conf(5)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 wpa_cli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/wpa_cli.8">wpa_cli(8)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://wireless.wiki.kernel.org/en/users/Documentation/wpa_supplicant">Kernel.org wpa_supplicant 文档</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:Wireless_networking.html" title="Category:Wireless networking (简体中文)">Wireless networking (简体中文)</a></li>
<li><a href="../zh-CN/Category:Network_configuration.html" title="Category:Network configuration (简体中文)">Network configuration (简体中文)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Wpa_supplicant_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=662599">https://wiki.archlinux.org/index.php?title=Wpa_supplicant_(简体中文)&amp;oldid=662599</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 April 2021, at 21:30.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
