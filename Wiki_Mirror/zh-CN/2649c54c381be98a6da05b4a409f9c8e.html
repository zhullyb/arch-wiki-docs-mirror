<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Pacman (简体中文)/Pacnew and Pacsave (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Pacman_简体中文_Pacnew_and_Pacsave_简体中文 rootpage-Pacman_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Pacman (简体中文)/Pacnew and Pacsave (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="/title/Pacman_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Pacman (简体中文)">Pacman (简体中文)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="/title/Pacman/Pacnew_and_Pacsave" title="Pacman/Pacnew and Pacsave">Pacman/Pacnew and Pacsave</a> 的<a href="/title/ArchWiki:Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2019-10-26。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Pacman/Pacnew_and_Pacsave&amp;diff=0&amp;oldid=582907">更改</a>，则您可以帮助同步翻译。</div>
<p>在使用 pacman 移除一个带有配置文档的软件包时，pacman 通常会将配置文档复制为一个后缀名为 .pacsave 的备份文档。
</p>
<p>同样的，当 pacman 升级一个软件包，而新软件包含有与与当前配置不同的新配置文件时，pacman 会将新配置写入 .pacnew 文件。当写入这些文件时，pacman 会输出提示信息。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%88%9B%E5%BB%BA%E4%BA%86%E8%BF%99%E6%A0%B7%E7%9A%84%E6%96%87%E4%BB%B6"><span class="tocnumber">1</span> <span class="toctext">为什么创建了这样的文件</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#%E5%8C%85%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6"><span class="tocnumber">2</span> <span class="toctext">包备份文件</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#%E7%B1%BB%E5%9E%8B%E8%AF%B4%E6%98%8E"><span class="tocnumber">3</span> <span class="toctext">类型说明</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#.pacnew"><span class="tocnumber">3.1</span> <span class="toctext">.pacnew</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.pacsave"><span class="tocnumber">3.2</span> <span class="toctext">.pacsave</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#%E5%AE%9A%E4%BD%8D_.pac*_%E6%96%87%E4%BB%B6"><span class="tocnumber">4</span> <span class="toctext">定位 .pac* 文件</span></a></li>
<li class="toclevel-1 tocsection-7">
<a href="#.%E7%AE%A1%E7%90%86_.pac*_%E6%96%87%E4%BB%B6"><span class="tocnumber">5</span> <span class="toctext">.管理 .pac* 文件</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#pacdiff"><span class="tocnumber">5.1</span> <span class="toctext">pacdiff</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7"><span class="tocnumber">5.2</span> <span class="toctext">三方工具</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#%E5%8F%82%E9%98%85"><span class="tocnumber">6</span> <span class="toctext">参阅</span></a></li>
</ul>
</div>

<h2>
<span id=".E4.B8.BA.E4.BB.80.E4.B9.88.E5.88.9B.E5.BB.BA.E4.BA.86.E8.BF.99.E6.A0.B7.E7.9A.84.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="为什么创建了这样的文件">为什么创建了这样的文件</span>
</h2>
<p>当升级某个软件包（命令为 <code>pacman -Syu</code>，<code>pacman -Su</code> 或者<code>pacman -U</code>）时，可能会创建一个 <code>.pacnew</code> 文件，以避免覆盖一个之前被用户修改过的已存在文件。此时，pacman会输出如下信息：
</p>
<pre>warning: /etc/pam.d/usermod installed as /etc/pam.d/usermod.pacnew
</pre>
<p>当卸载某个软件包（命令为 <code>pacman -R</code>）或升级某个软件包（该软件包必须首先被卸载）时，可能会创建一个 <code>.pacsave</code> 文件。当 pacman 数据库记录了应当备份该软件包的某个文件时，pacman 会创建一个 <code>.pacsave</code> 文件。此时，pacman 会输出如下信息：
</p>
<pre>warning: /etc/pam.d/usermod saved as /etc/pam.d/usermod.pacsave
</pre>
<p>这些文件需要用户手动干预，我们推荐您在每次软件包升级或卸载之后马上处理它们。如果不处理，不当的配置可能导致软件功能出问题，甚至完全无法使用。
</p>
<h2>
<span id=".E5.8C.85.E5.A4.87.E4.BB.BD.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="包备份文件">包备份文件</span>
</h2>
<p>软件包的 <code>PKGBUILD</code> 文件指定了升级或卸载软件包时哪写文件需要被保存或备份。例如，<code>puslseaudio</code> 的 <code>PKGBUILD</code> 文件包含如下行：
</p>
<pre>backup=('etc/pulse/client.conf' 'etc/pulse/daemon.conf' 'etc/pulse/default.pa')
</pre>
<p>要阻止任何软件包覆盖一个文件，请阅读 <a href="/title/Pacman#Skip_file_from_being_upgraded" title="Pacman">Pacman#Skip file from being upgraded</a>.
</p>
<h2>
<span id=".E7.B1.BB.E5.9E.8B.E8.AF.B4.E6.98.8E"></span><span class="mw-headline" id="类型说明">类型说明</span>
</h2>
<h3><span class="mw-headline" id=".pacnew">.pacnew</span></h3>
<p>对于包升级过程中的每个备份文件，pacman 会交叉校验三个版本的文件内容生成的 <a href="https://en.wikipedia.org/wiki/zh:Md5sum" class="extiw" title="wikipedia:zh:Md5sum">md5sums</a> 值：一个为软件包最初创建的版本，一个为文件系统中当前的版本，还有一个为新软件包中的版本。如果软件包安装的版本被修改为文件系统中当前的版本，pacman 不知道如何将这些修改合并到新版本的文件中。因此，pacman 以扩展名 <code>.pacnew</code> 保存新版本的文件，修改过的版本保持不变，而不是被覆盖。
</p>
<p>更细一步来说，3路MD5值校验结果为下述输出之一：
</p>
<dl>
<dt>original = <i>X</i>, current = <i>X</i>, new = <i>X</i>
</dt>
<dd>三个版本的文件具有相同的内容，因此覆盖不会产生问题。pacman 将用新版本覆盖当前版本而不通知用户。（尽管文件内容相同，覆盖操作会更新文件系统中和文件创建，修改和访问时间有关的信息，也确保了任何文件权限的修改被实施。）</dd>
</dl>
<dl>
<dt>original = <i>X</i>, current = <i>X</i>, new = <i>Y</i>
</dt>
<dd>当前版本文件的内容和原始版本的相同，但与新版本不同。既然用户没有修改过当前版本文件，且新版本可能包含改进和 bug 修正，pacman 用新版本覆盖当前版本，而不通知用户。这是 pacman 有能力执行的唯一一个新改动的自动合并。</dd>
</dl>
<dl>
<dt>original = <i>X</i>, current = <i>Y</i>, new = <i>X</i>
</dt>
<dd>原始软件包和新软件包都包含版本完全相同的文件，但当前文件系统中的版本是被修改过的。此时 pacman 保留当前版本，忽略新版本，且不通知用户。</dd>
</dl>
<dl>
<dt>original = <i>X</i>, current = <i>Y</i>, new = <i>Y</i>
</dt>
<dd>新版本和当前版本相同。此时 pacman 将用新版本覆盖当前版本且不通知用户。（尽管文件内容相同，覆盖操作会更新文件系统中和文件创建，修改和访问时间有关的信息，也确保了任何文件权限的修改被实施。）</dd>
</dl>
<dl>
<dt>original = <i>X</i>, current = <i>Y</i>, new = <i>Z</i>
</dt>
<dd>三个版本的文件都不相同，所以保留当前版本，以扩展名 <code>.pacnew</code> 创建新版本，且警告用户创建了新版本。希望用户手动将需要的更改由新版本合并至当前版本。</dd>
</dl>
<h3><span class="mw-headline" id=".pacsave">.pacsave</span></h3>
<p>如果用户修改了 <code>backup</code> 中指定的某个文件，那么那个文件将被重命名，带上 <code>.pacsave</code> 扩展名，且在其他软件包移除之后仍然存在于文件系统中。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 使用命令 <code>pacman -R</code> 中的 <code>-n</code> 选项会移除指定软件包中的所有文件，因此不会创建 <code>.pacsave</code> 文件。</div>
<h2>
<span id=".E5.AE.9A.E4.BD.8D_.pac.2A_.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="定位_.pac*_文件">定位 .pac* 文件</span>
</h2>
<p>首先需要确定这些文件的位置，才能手动维护这些文件。当升级或卸载大量软件包时，可能会错过升级的 *.pac* 的信息。你需要寻找是否产生了 <code>*.pac*</code> 文件：
</p>
<p>仅搜索绝大多数全局配置文件所存放的位置：
</p>
<pre>$ find /etc -regextype posix-extended -regex ".+\.pac(new|save)" 2&gt; /dev/null
</pre>
<p>或全盘搜索：
</p>
<pre>$ find / -regextype posix-extended -regex ".+\.pac(new|save)" 2&gt; /dev/null
</pre>
<p>如果你安装了 <a href="/title/Locate" title="Locate">locate</a>，还可以使用它来搜索。首先需要更新索引数据库：
</p>
<pre># updatedb
</pre>
<p>然后:
</p>
<pre>$ locate --existing --regex "\.pac(new|save)$"</pre>
<p>或者使用pacman日志来找到它们：
</p>
<pre>$ egrep "pac(new|save)" /var/log/pacman.log
</pre>
<p>注意：日志不会记录文件系统里现在有哪些文件，也不会记录哪些文件已经被移除。
</p>
<h2>
<span id="..E7.AE.A1.E7.90.86_.pac.2A_.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id=".管理_.pac*_文件">.管理 .pac* 文件</span>
</h2>
<h3><span class="mw-headline" id="pacdiff">pacdiff</span></h3>
<p>Pacman 包含了 <i>pacdiff</i> 工具管理 pacnew/pacsave 文件。这个工具会搜索所有的 <code>pacnew</code> 和 <code>pacsave</code> 文件并询问要执行的操作。默认使用  <a href="/title/Vim#Merging_files" title="Vim">vimdiff</a> 工具，可以通过 <code>DIFFPROG=your_editor pacdiff</code> 指定要使用的差异比较工具。参考 <a href="/title/List_of_applications/Utilities#Comparison,_diff,_merge" title="List of applications/Utilities">List of applications/Utilities#Comparison, diff, merge</a>.
</p>
<h3>
<span id=".E4.B8.89.E6.96.B9.E5.B7.A5.E5.85.B7"></span><span class="mw-headline" id="三方工具">三方工具</span>
</h3>
<p>下面一些 <a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a> 三方工具可以自动处理这些文件： 
</p>
<ul><li>
<b>dotpac</b> — Basic interactive script with ncurses-based text interface and helpful walkthrough. No merging or auto-merging features.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/AladW/dotpac">https://github.com/AladW/dotpac</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dotpac/">dotpac</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>etc-update</b> — <i>Gentoo</i>'s utility, compatible with other distributions including Arch. It provides a simple CLI to view, merge and interactively edit changes. Trivial changes, such as comments, can be merged automatically.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://wiki.gentoo.org/wiki/Handbook:Parts/Portage/Tools#etc-update">https://wiki.gentoo.org/wiki/Handbook:Parts/Portage/Tools#etc-update</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/etc-update/">etc-update</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>pacnews-git</b> — A simple script aimed at finding all <i>.pacnew</i> files, then editing them with <a href="/title/Vim#Merging_files" title="Vim">vimdiff</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/pbrisbin/scripts/blob/master/pacnews">https://github.com/pbrisbin/scripts/blob/master/pacnews</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pacnews-git/">pacnews-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>pacfiles-mode</b> — A package for <a href="/title/Emacs" title="Emacs">Emacs</a> to manage and merge <i>.pacnew</i> files, available in <a rel="nofollow" class="external text" href="https://melpa.org/#/pacfiles-mode">melpa</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/UndeadKernel/pacfiles-mode">https://github.com/UndeadKernel/pacfiles-mode</a> || <small>not packaged? <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/">search in AUR</a></small>
</dd></dl>
<h2>
<span id=".E5.8F.82.E9.98.85"></span><span class="mw-headline" id="参阅">参阅</span>
</h2>
<ul><li>Arch Linux 论坛: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=53532">处理 .pacnew 文件</a>
</li></ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Package_management_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Package management (简体中文)">Package management (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="/title/Category:Pages_with_missing_package_links" title="Category:Pages with missing package links">Pages with missing package links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Pacman_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Pacnew_and_Pacsave_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=667620">https://wiki.archlinux.org/index.php?title=Pacman_(简体中文)/Pacnew_and_Pacsave_(简体中文)&amp;oldid=667620</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 3 May 2021, at 06:39.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
