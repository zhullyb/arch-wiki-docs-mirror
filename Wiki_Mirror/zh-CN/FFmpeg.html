<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>FFmpeg (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-FFmpeg_简体中文 rootpage-FFmpeg_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">FFmpeg (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="/title/FFmpeg" title="FFmpeg">FFmpeg</a> 的<a href="/title/ArchWiki:Translation_Team_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2015-06-07。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=FFmpeg&amp;diff=0&amp;oldid=376055">更改</a>，则您可以帮助同步翻译。</div>
<p>From the project <a rel="nofollow" class="external text" href="https://www.ffmpeg.org/">home page</a>:
</p>
<dl><dd><i>FFmpeg is a complete, cross-platform solution to record, convert and stream audio and video. It includes libavcodec - the leading audio/video codec library.</i></dd></dl>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85"><span class="tocnumber">1</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E7%BC%96%E7%A0%81%E4%BE%8B%E5%AD%90"><span class="tocnumber">2</span> <span class="toctext">编码例子</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E5%B1%8F%E5%B9%95%E6%8D%95%E8%8E%B7%EF%BC%88%E5%BD%95%E5%B1%8F%EF%BC%89"><span class="tocnumber">2.1</span> <span class="toctext">屏幕捕获（录屏）</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Recording_webcam"><span class="tocnumber">2.2</span> <span class="toctext">Recording webcam</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#VOB_to_any_container"><span class="tocnumber">2.3</span> <span class="toctext">VOB to any container</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#x264_lossless"><span class="tocnumber">2.4</span> <span class="toctext">x264 lossless</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#x265"><span class="tocnumber">2.5</span> <span class="toctext">x265</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Single-pass_MPEG-2_(near_lossless)"><span class="tocnumber">2.6</span> <span class="toctext">Single-pass MPEG-2 (near lossless)</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#x264:_constant_rate_factor"><span class="tocnumber">2.7</span> <span class="toctext">x264: constant rate factor</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#YouTube"><span class="tocnumber">2.8</span> <span class="toctext">YouTube</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Two-pass_x264_(very_high-quality)"><span class="tocnumber">2.9</span> <span class="toctext">Two-pass x264 (very high-quality)</span></a></li>
<li class="toclevel-2 tocsection-12">
<a href="#Two-pass_MPEG-4_(very_high-quality)"><span class="tocnumber">2.10</span> <span class="toctext">Two-pass MPEG-4 (very high-quality)</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#Determining_bitrates_with_fixed_output_file_sizes"><span class="tocnumber">2.10.1</span> <span class="toctext">Determining bitrates with fixed output file sizes</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-14">
<a href="#x264_video_stabilization"><span class="tocnumber">2.11</span> <span class="toctext">x264 video stabilization</span></a>
<ul>
<li class="toclevel-3 tocsection-15"><a href="#First_pass"><span class="tocnumber">2.11.1</span> <span class="toctext">First pass</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Second_pass"><span class="tocnumber">2.11.2</span> <span class="toctext">Second pass</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17">
<a href="#Subtitles"><span class="tocnumber">2.12</span> <span class="toctext">Subtitles</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#Extracting"><span class="tocnumber">2.12.1</span> <span class="toctext">Extracting</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#Hardsubbing"><span class="tocnumber">2.12.2</span> <span class="toctext">Hardsubbing</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-20"><a href="#Volume_gain"><span class="tocnumber">2.13</span> <span class="toctext">Volume gain</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Extracting_audio"><span class="tocnumber">2.14</span> <span class="toctext">Extracting audio</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Stripping_audio"><span class="tocnumber">2.15</span> <span class="toctext">Stripping audio</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Splitting_files"><span class="tocnumber">2.16</span> <span class="toctext">Splitting files</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24">
<a href="#Preset_files"><span class="tocnumber">3</span> <span class="toctext">Preset files</span></a>
<ul>
<li class="toclevel-2 tocsection-25">
<a href="#Using_preset_files"><span class="tocnumber">3.1</span> <span class="toctext">Using preset files</span></a>
<ul>
<li class="toclevel-3 tocsection-26">
<a href="#libavcodec-vhq.ffpreset"><span class="tocnumber">3.1.1</span> <span class="toctext">libavcodec-vhq.ffpreset</span></a>
<ul>
<li class="toclevel-4 tocsection-27"><a href="#Two-pass_MPEG-4_(very_high_quality)"><span class="tocnumber">3.1.1.1</span> <span class="toctext">Two-pass MPEG-4 (very high quality)</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#Package_removal"><span class="tocnumber">4</span> <span class="toctext">Package removal</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#See_also"><span class="tocnumber">5</span> <span class="toctext">See also</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="安装">安装</span>
</h2>
<p>你能够从<a href="/title/Official_repositories" title="Official repositories">official repositories</a>和<a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a>安装（<a href="/title/Pacman" title="Pacman">installed</a>）各种口味相关的项目：
</p>
<ul><li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ffmpeg">ffmpeg</a></span> – 官方安装包</li></ul>
<p>不同版本:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ffmpeg-git/">ffmpeg-git</a></span><sup><small>AUR</small></sup> – 开发版</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ffmpeg-full/">ffmpeg-full</a></span><sup><small>AUR</small></sup> – 包含尽可能多的选定特征</li>
</ul>
<p>Forks:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ffmbc/">ffmbc</a></span><sup><small>AUR</small></sup><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> – 以培养习惯为目标</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/libav-git/">libav-git</a></span><sup><small>AUR</small></sup><sup>[<a href="/title/Help:Procedures#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> –<code>avconv</code>提供替代<code>ffmpeg</code>的二进制安装包</li>
</ul>
<h2>
<span id=".E7.BC.96.E7.A0.81.E4.BE.8B.E5.AD.90"></span><span class="mw-headline" id="编码例子">编码例子</span>
</h2>
<h3>
<span id=".E5.B1.8F.E5.B9.95.E6.8D.95.E8.8E.B7.EF.BC.88.E5.BD.95.E5.B1.8F.EF.BC.89"></span><span class="mw-headline" id="屏幕捕获（录屏）">屏幕捕获（录屏）</span>
</h3>
<p>FFmpeg 包含 <a rel="nofollow" class="external text" href="https://www.ffmpeg.org/ffmpeg-devices.html#x11grab">x11grab</a> 和 <a rel="nofollow" class="external text" href="https://www.ffmpeg.org/ffmpeg-devices.html#alsa-1">ALSA</a> 虚拟化设备，使它能够捕捉用户的全部全部图像和音频输出。
</p>
<p>伴随无损编码创建<code>test.mkv</code>：
</p>
<pre>$ ffmpeg -f x11grab -video_size 1920x1080 -i $DISPLAY -f alsa -i default -c:v ffvhuff -c:a flac test.mkv
</pre>
<p>where <code>-video_size</code> specifies the size of the area to capture. Check the FFmpeg manual for examples of how to change the screen or position of the capture area. 
</p>
<p>To implicitely encode to a shareable size use :
</p>
<pre>$ ffmpeg -f x11grab -s 1920x1080 -r 25 -i $DISPLAY   -f alsa -i default   -c:v libx264 -b:v 200k -s 1280x720 test.mp4
</pre>
<p>You may want to adjust the parameters (left-to-right): input <b>f</b>ormat, [input]<b>s</b>ize, frame<b>r</b>ate, <b>i</b>nput (in this case display, but could be a file too), input <b>f</b>ormat, <b>i</b>nput, <b>c</b>odec:<b>v</b>ideo, <b>b</b>itrate:<b>v</b>ideo, [output]<b>s</b>ize of output. Without context the meaning of the parameters may seem ambigious. See the manpage for the synopsis.
</p>
<h3><span class="mw-headline" id="Recording_webcam">Recording webcam</span></h3>
<p>FFmpeg supports grabbing input from Video4Linux2 devices.  The following command will record a video from the webcam, assuming that the webcam is correctly recognized under <code>/dev/video0</code>:
</p>
<pre>$ ffmpeg -f v4l2 -s 640x480 -i /dev/video0 <i>output</i>.mpg
</pre>
<p>The above produces a silent video. It is also possible to include audio sources from a microphone.  The following command will include a stream from the default <a href="/title/Advanced_Linux_Sound_Architecture" title="Advanced Linux Sound Architecture">ALSA</a> recording device into the video:
</p>
<pre>$ ffmpeg -f alsa -i default -f v4l2 -s 640x480 -i /dev/video0 <i>output</i>.mpg
</pre>
<p>To use <a href="/title/PulseAudio" title="PulseAudio">PulseAudio</a> with an ALSA backend:
</p>
<pre>$ ffmpeg -f alsa -i pulse -f v4l2 -s 640x480 -i /dev/video0 <i>output</i>.mpg
</pre>
<p>For a higher quality capture, try encoding the output using higher quality codecs:
</p>
<pre>$ ffmpeg -f alsa -i default -f v4l2 -s 640x480 -i /dev/video0 -acodec flac \
-vcodec libx264 <i>output</i>.mkv
</pre>
<h3><span class="mw-headline" id="VOB_to_any_container">VOB to any container</span></h3>
<p>Concatenate the desired <a href="https://en.wikipedia.org/wiki/VOB" class="extiw" title="wikipedia:VOB">VOB</a> files into a single stream and mux them to MPEG-2:
</p>
<pre>$ cat f0.VOB f1.VOB f2.VOB | ffmpeg -i - out.mp2
</pre>
<h3><span class="mw-headline" id="x264_lossless">x264 lossless</span></h3>
<p>The <i>ultrafast</i> preset will provide the fastest encoding and is useful for quick capturing (such as screencasting):
</p>
<pre>$ ffmpeg -i input -c:v libx264 -preset ultrafast -qp 0 -c:a copy output
</pre>
<p>On the opposite end of the preset spectrum is <i>veryslow</i> and will encode slower than <i>ultrafast</i> but provide a smaller output file size:
</p>
<pre>$ ffmpeg -i input -c:v libx264 -preset veryslow -qp 0 -c:a copy output
</pre>
<p>Both examples will provide the same quality output.
</p>
<h3><span class="mw-headline" id="x265">x265</span></h3>
<p>In encoding x265 files, you may need to specify the aspect ratio of the file via <code>-aspect &lt;width:height&gt;</code>. Example :
</p>
<pre> ffmpeg -i input -c:v libx265 -aspect 1920:1080 -preset veryslow -x265-params crf 20 output</pre>
<h3>
<span id="Single-pass_MPEG-2_.28near_lossless.29"></span><span class="mw-headline" id="Single-pass_MPEG-2_(near_lossless)">Single-pass MPEG-2 (near lossless)</span>
</h3>
<p>Allow FFmpeg to automatically set DVD standardized parameters. Encode to DVD <a href="https://en.wikipedia.org/wiki/MPEG-2" class="extiw" title="wikipedia:MPEG-2">MPEG-2</a> at ~30 FPS:
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -target ntsc-dvd <i>output</i>.mpg
</pre>
<p>Encode to DVD MPEG-2 at ~24 FPS:
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -target film-dvd <i>output</i>.mpg
</pre>
<h3><span class="mw-headline" id="x264:_constant_rate_factor">x264: constant rate factor</span></h3>
<p>Used when you want a specific quality output. General usage is to use the highest <code>-crf</code> value that still provides an acceptable quality. Lower values are higher quality; 0 is lossless, 18 is visually lossless, and 23 is the default value. A sane range is between 18 and 28. Use the slowest <code>-preset</code> you have patience for. See the <a rel="nofollow" class="external text" href="https://ffmpeg.org/trac/ffmpeg/wiki/x264EncodingGuide">x264 Encoding Guide</a> for more information.
</p>
<pre>$ ffmpeg -i <i>video</i> -c:v libx264 -tune film -preset slow -crf 22 -x264opts fast_pskip=0 -c:a libmp3lame -aq 4 <i>output</i>.mkv
</pre>
<p><code>-tune</code> option can be used to <a rel="nofollow" class="external text" href="https://forum.doom9.org/showthread.php?t=149394">match the type and content of the of media being encoded</a>.
</p>
<h3><span class="mw-headline" id="YouTube">YouTube</span></h3>
<p>FFmpeg is very useful to encode videos and strip their size before you upload them on YouTube. The following single line of code takes an input file and outputs a mkv container. 
</p>
<pre>$ ffmpeg -i <i>video</i> -c:v libx264 -crf 18 -preset slow -pix_fmt yuv420p -c:a copy <i>output</i>.mkv
</pre>
<p>For more information see the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1200667#p1200667">forums</a>. You can also create a shell function <code>ytconvert</code> which takes the name of the input file as first argument and the name of the .mkv container as second argument. To do so add the following to your <code>~/.bashrc</code>:
</p>
<pre>ytconvert() {
        ffmpeg -i "$1" -c:v libx264 -crf 18 -preset slow -pix_fmt yuv420p -c:a copy "$2.mkv"
}
</pre>
<p>See also <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1200542#p1200542">Arch Linux forum thread</a>.
</p>
<h3>
<span id="Two-pass_x264_.28very_high-quality.29"></span><span class="mw-headline" id="Two-pass_x264_(very_high-quality)">Two-pass x264 (very high-quality)</span>
</h3>
<p>Audio deactivated as only video statistics are recorded during the first of multiple pass runs: 
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -an -vcodec libx264 -pass 1  -preset veryslow \
-threads 0 -b 3000k -x264opts frameref=15:fast_pskip=0 -f rawvideo -y /dev/null
</pre>
<p>Container format is automatically detected and muxed into from the output file extenstion (<code>.mkv</code>):
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -acodec libvo-aacenc -ab 256k -ar 96000 -vcodec libx264 \
-pass 2 -preset veryslow -threads 0 -b 3000k -x264opts frameref=15:fast_pskip=0 <i>video</i>.mkv
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you receive <code>Unknown encoder 'libvo-aacenc'</code> error (given the fact that your ffmpeg is compiled with libvo-aacenc enabled), you may want to try <code>-acodec libvo_aacenc</code>, an underscore instead of hyphen.</div>
<h3>
<span id="Two-pass_MPEG-4_.28very_high-quality.29"></span><span class="mw-headline" id="Two-pass_MPEG-4_(very_high-quality)">Two-pass MPEG-4 (very high-quality)</span>
</h3>
<p>Audio deactivated as only video statistics are logged during the first of multiple pass runs: 
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -an -vcodec mpeg4 -pass 1 -mbd 2 -trellis 2 -flags +cbp+mv0 \
-pre_dia_size 4 -dia_size 4 -precmp 4 -cmp 4 -subcmp 4 -preme 2 -qns 2 -b 3000k \
-f rawvideo -y /dev/null
</pre>
<p>Container format is automatically detected and muxed into from the output file extenstion (<code>.avi</code>):
</p>
<pre>$ ffmpeg -i <i>video</i>.VOB -acodec copy -vcodec mpeg4 -vtag DX50 -pass 2 -mbd 2 -trellis 2 \
-flags +cbp+mv0 -pre_dia_size 4 -dia_size 4 -precmp 4 -cmp 4 -subcmp 4 -preme 2 -qns 2 \
-b 3000k <i>video</i>.avi
</pre>
<ul>
<li>Introducing <code>threads</code>=<code>n</code>&gt;<code>1</code> for <code>-vcodec mpeg4</code> may skew the effects of <a href="https://en.wikipedia.org/wiki/Motion_estimation" class="extiw" title="wikipedia:Motion estimation">motion estimation</a> and lead to <a rel="nofollow" class="external text" href="https://ffmpeg.org/faq.html#Why-do-I-see-a-slight-quality-degradation-with-multithreaded-MPEG_002a-encoding_003f">reduced video quality</a> and compression efficiency.</li>
<li>The two-pass MPEG-4 example above also supports output to the <a href="https://en.wikipedia.org/wiki/MPEG-4_Part_14" class="extiw" title="wikipedia:MPEG-4 Part 14">MP4</a> container (replace <code>.avi</code> with <code>.mp4</code>).</li>
</ul>
<h4><span class="mw-headline" id="Determining_bitrates_with_fixed_output_file_sizes">Determining bitrates with fixed output file sizes</span></h4>
<ul><li>(Desired File Size in MB - Audio File Size in MB) <b>x</b> 8192 kb/MB <b>/</b> Length of Media in Seconds (s) <b>=</b> <a href="https://en.wikipedia.org/wiki/Bitrate" class="extiw" title="wikipedia:Bitrate">Bitrate</a> in kb/s</li></ul>
<dl><dd><ul><li>(3900 MB - 275 MB) = 3625 MB <b>x</b> 8192 kb/MB <b>/</b> 8830 s = 3363 kb/s required to achieve an approximate total output file size of 3900 MB</li></ul></dd></dl>
<h3><span class="mw-headline" id="x264_video_stabilization">x264 video stabilization</span></h3>
<p>Video stablization using the vbid.stab plugin entails two passes.
</p>
<h4><span class="mw-headline" id="First_pass">First pass</span></h4>
<p>The first pass records stabilization parameters to a file and/or a test video for visual analysis.
</p>
<ul><li>Records stabilization parameters to a file only</li></ul>
<pre>$ ffmpeg -i input -vf vidstabdetect=stepsize=4:mincontrast=0:result=transforms.trf -f null -
</pre>
<ul><li>Records stabilization parameters to a file and create test video "output-stab" for visual analysis</li></ul>
<pre>$ ffmpeg -i input -vf vidstabdetect=stepsize=4:mincontrast=0:result=transforms.trf -f output-stab
</pre>
<h4><span class="mw-headline" id="Second_pass">Second pass</span></h4>
<p>The second pass parses the stabilization parameters generated from the first pass and applies them to produce "output-stab_final".  You will want to apply any additional filters at this point so as to aboid subsequent transcoding to preserve as much video quality as possible.  The following example performs the following in addition to video stabilization:
</p>
<ul>
<li>
<code>unsharp</code> is recommended by the author of vid.stab. Here we are simply using the defaults of 5:5:1.0:5:5:1.0</li>
<li>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> fade=t=in:st=0:d=4</div> fade in from black starting from the beginning of the file for four seconds</li>
<li>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> fade=t=out:st=60:d=4</div> fade out to black starting from sixty seconds into the video for four seconds</li>
<li>
<code>-c:a pcm_s16le</code> XAVC-S codec records in pcm_s16be which is losslessly transcoded to pcm_s16le</li>
</ul>
<pre>$  ffmpeg -i input -vf vidstabtransform=smoothing=30:interpol=bicubic:input=transforms.trf,unsharp,fade=t=in:st=0:d=4,fade=t=out:st=60:d=4 -c:v libx264 -tune film -preset veryslow -crf 8 -x264opts fast_pskip=0 -c:a pcm_s16le output-stab_final
</pre>
<h3><span class="mw-headline" id="Subtitles">Subtitles</span></h3>
<h4><span class="mw-headline" id="Extracting">Extracting</span></h4>
<p>Subtitles embedded in container files, such as MPEG-2 and Matroska, can be extracted and converted into SRT, SSA, among other subtitle formats.
</p>
<ul><li>Inspect a file to determine if it contains a subtitle stream:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ffprobe foo.mkv</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Stream #0:0(und): Video: h264 (High), yuv420p, 1920x800 [SAR 1:1 DAR 12:5], 23.98 fps, 23.98 tbr, 1k tbn, 47.95 tbc (default)
  Metadata:
  CREATION_TIME   : 2012-06-05 05:04:15
  LANGUAGE        : und
Stream #0:1(und): Audio: aac, 44100 Hz, stereo, fltp (default)
 Metadata:
 CREATION_TIME   : 2012-06-05 05:10:34
 LANGUAGE        : und
 HANDLER_NAME    : GPAC ISO Audio Handler
<b>Stream #0:2: Subtitle: ssa (default)</b></pre>
<ul><li>
<code>foo.mkv</code> has an embedded SSA subtitle which can be extracted into an independent file:</li></ul>
<pre>$ ffmpeg -i foo.mkv foo.ssa
</pre>
<h4><span class="mw-headline" id="Hardsubbing">Hardsubbing</span></h4>
<p>(instructions based on an <a rel="nofollow" class="external text" href="https://trac.ffmpeg.org/wiki/How%20to%20burn%20subtitles%20into%20the%20video">FFmpeg wiki article</a>)
</p>
<p><a href="https://en.wikipedia.org/wiki/Hardsub" class="extiw" title="wikipedia:Hardsub">Hardsubbing</a> entails merging subtitles with the video. Hardsubs cannot be disabled, nor language switched.
</p>
<ul><li>Overlay <code>foo.mpg</code> with the subtitles in <code>foo.ssa</code>:</li></ul>
<pre>$ ffmpeg -i foo.mpg -c copy -vf subtitles=foo.ssa out.mpg
</pre>
<h3><span class="mw-headline" id="Volume_gain">Volume gain</span></h3>
<p>Change the audio volume in multiples of 256 where <b>256 = 100%</b> (normal) volume. Additional values such as 400 are also valid options. 
</p>
<pre>-vol 256  = 100%
-vol 512  = 200%
-vol 768  = 300%
-vol 1024 = 400%
-vol 2048 = 800%
</pre>
<p>To double the volume <b>(512 = 200%)</b> of an <a href="https://en.wikipedia.org/wiki/Mp3" class="extiw" title="wikipedia:Mp3">MP3</a> file:
</p>
<pre>$ ffmpeg -i <i>file</i>.mp3 -vol 512 <i>louder_file</i>.mp3
</pre>
<p>To quadruple the volume <b>(1024 = 400%)</b> of an <a href="https://en.wikipedia.org/wiki/Ogg" class="extiw" title="wikipedia:Ogg">Ogg</a> file:
</p>
<pre>$ ffmpeg -i <i>file</i>.ogg -vol 1024 <i>louder_file</i>.ogg
</pre>
<p>Note that gain metadata is only written to the output file. Unlike mp3gain or ogggain, the source sound file is untouched.
</p>
<h3><span class="mw-headline" id="Extracting_audio">Extracting audio</span></h3>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ffmpeg -i <i>video</i>.mpg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Input #0, avi, from '<i>video</i>.mpg':
  Duration: 01:58:28.96, start: 0.000000, bitrate: 3000 kb/s
    Stream #0.0: Video: mpeg4, yuv420p, 720x480 [PAR 1:1 DAR 16:9], 29.97 tbr, 29.97 tbn, 29.97 tbc
    Stream #0.1: Audio: ac3, 48000 Hz, stereo, s16, 384 kb/s
    Stream #0.2: Audio: ac3, 48000 Hz, 5.1, s16, 448 kb/s
    Stream #0.3: Audio: dts, 48000 Hz, 5.1 768 kb/s
...
</pre>
<p>Extract the first (<code>-map 0:1</code>) <a href="https://en.wikipedia.org/wiki/Dolby_Digital" class="extiw" title="wikipedia:Dolby Digital">AC-3</a> encoded audio stream exactly as it was multiplexed into the file: 
</p>
<pre>$ ffmpeg -i <i>video</i>.mpg -map 0:1 -acodec copy -vn <i>video</i>.ac3
</pre>
<p>Convert the third (<code>-map 0:3</code>) <a href="https://en.wikipedia.org/wiki/DTS_(sound_system)" class="extiw" title="wikipedia:DTS (sound system)">DTS</a> audio stream to an <a href="https://en.wikipedia.org/wiki/Advanced_Audio_Coding" class="extiw" title="wikipedia:Advanced Audio Coding">AAC</a> file with a bitrate of 192 kb/s and a <a href="https://en.wikipedia.org/wiki/Sampling_rate" class="extiw" title="wikipedia:Sampling rate">sampling rate</a> of 96000 Hz:
</p>
<pre>$ ffmpeg -i <i>video</i>.mpg -map 0:3 -acodec libvo-aacenc -ab 192k -ar 96000 -vn <i>output</i>.aac
</pre>
<p><code>-vn</code> disables the processing of the video stream.
</p>
<p>Extract audio stream with certain time interval: 
</p>
<pre>$ ffmpeg -ss 00:01:25 -t 00:00:05 -i <i>video</i>.mpg -map 0:1 -acodec copy -vn <i>output</i>.ac3
</pre>
<p><code>-ss</code> specifies the start point, and <code>-t</code> specifies the duration.
</p>
<h3><span class="mw-headline" id="Stripping_audio">Stripping audio</span></h3>
<ol>
<li>Copy the first video stream (<code>-map 0:0</code>) along with the second AC-3 audio stream (<code>-map 0:2</code>).</li>
<li>Convert the AC-3 audio stream to two-channel MP3 with a bitrate of 128 kb/s and a sampling rate of 48000 Hz.</li>
</ol>
<pre>$ ffmpeg -i <i>video</i>.mpg -map 0:0 -map 0:2 -vcodec copy -acodec libmp3lame \
-ab 128k -ar 48000 -ac 2 <i>video</i>.mkv
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ffmpeg -i <i>video</i>.mkv</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Input #0, avi, from '<i>video</i>.mpg':
  Duration: 01:58:28.96, start: 0.000000, bitrate: 3000 kb/s
    Stream #0.0: Video: mpeg4, yuv420p, 720x480 [PAR 1:1 DAR 16:9], 29.97 tbr, 29.97 tbn, 29.97 tbc
    Stream #0.1: Audio: mp3, 48000 Hz, stereo, s16, 128 kb/s
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Removing undesired audio streams allows for additional bits to be allocated towards improving video quality.</div>
<h3><span class="mw-headline" id="Splitting_files">Splitting files</span></h3>
<p>You can use the <code>copy</code> codec to perform operations on a file without changing the encoding. For example, this allows you to easily split any kind of media file into two
</p>
<pre>$ ffmpeg -i file.ext -t 00:05:30 -c copy part1.ext -ss 00:05:30 -c copy part2.ext
</pre>
<h2><span class="mw-headline" id="Preset_files">Preset files</span></h2>
<p>Populate <code>~/.ffmpeg</code> with the default <a rel="nofollow" class="external text" href="https://ffmpeg.org/ffmpeg-doc.html#SEC13">preset files</a>: 
</p>
<pre>$ cp -iR /usr/share/ffmpeg ~/.ffmpeg
</pre>
<p>Create new and/or modify the default preset files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ffmpeg/libavcodec-vhq.ffpreset</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vtag=DX50
mbd=2
trellis=2
flags=+cbp+mv0
pre_dia_size=4
dia_size=4
precmp=4
cmp=4
subcmp=4
preme=2
qns=2</pre>
<h3><span class="mw-headline" id="Using_preset_files">Using preset files</span></h3>
<p>Enable the <code>-vpre</code> option after declaring the desired  <code>-vcodec</code>
</p>
<h4><span class="mw-headline" id="libavcodec-vhq.ffpreset">libavcodec-vhq.ffpreset</span></h4>
<ul>
<li>
<code>libavcodec</code> <b>=</b> Name of the vcodec/acodec</li>
<li>
<code>vhq</code> <b>=</b> Name of specific preset to be called out</li>
<li>
<code>ffpreset</code> <b>=</b> FFmpeg preset filetype suffix</li>
</ul>
<h5>
<span id="Two-pass_MPEG-4_.28very_high_quality.29"></span><span class="mw-headline" id="Two-pass_MPEG-4_(very_high_quality)">Two-pass MPEG-4 (very high quality)</span>
</h5>
<p>First pass of a multipass (bitrate) ratecontrol transcode:
</p>
<pre>$ ffmpeg -i <i>video</i>.mpg -an -vcodec mpeg4 -pass 1 -vpre vhq -f rawvideo -y /dev/null
</pre>
<p>Ratecontrol based on the video statistics logged from the first pass: 
</p>
<pre>$ ffmpeg -i <i>video</i>.mpg -acodec libvorbis -aq 8 -ar 48000 -vcodec mpeg4 \
-pass 2 -vpre vhq -b 3000k <i>output</i>.mp4
</pre>
<ul><li><b>libvorbis quality settings (VBR)</b></li></ul>
<dl><dd><ul>
<li>
<code>-aq 4</code> = 128 kb/s</li>
<li>
<code>-aq 5</code> = 160 kb/s</li>
<li>
<code>-aq 6</code> = 192 kb/s</li>
<li>
<code>-aq 7</code> = 224 kb/s</li>
<li>
<code>-aq 8</code> = 256 kb/s</li>
</ul></dd></dl>
<ul><li>
<a rel="nofollow" class="external text" href="http://www.geocities.jp/aoyoume/aotuv/">aoTuV</a> is generally preferred over <a rel="nofollow" class="external text" href="http://vorbis.com/">libvorbis</a> provided by <a rel="nofollow" class="external text" href="https://www.xiph.org/">Xiph.Org</a> and is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/libvorbis-aotuv/">libvorbis-aotuv</a></span><sup><small>AUR</small></sup> in the <a href="/title/AUR" class="mw-redirect" title="AUR">AUR</a>.</li></ul>
<h2><span class="mw-headline" id="Package_removal">Package removal</span></h2>
<p><a href="/title/Pacman" title="Pacman">pacman</a> will not <a href="/title/Pacman#Removing_packages" title="Pacman">remove</a> configuration files outside of the defaults that were created during package installation. This includes user-created preset files.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://ffmpeg.org/ffmpeg.html">FFmpeg documentation</a> - official documentation</li>
<li>
<a rel="nofollow" class="external text" href="https://trac.ffmpeg.org/wiki">FFmpeg Wiki</a> - official wiki</li>
<li>
<a rel="nofollow" class="external text" href="http://www.mplayerhq.hu/DOCS/HTML/en/menc-feat-x264.html">Encoding with the x264 codec</a> - MEncoder documentation</li>
<li>
<a rel="nofollow" class="external text" href="https://avidemux.org/admWiki/doku.php?id=tutorial:h.264">H.264 encoding guide</a> - Avidemux wiki</li>
<li>
<a rel="nofollow" class="external text" href="http://howto-pages.org/ffmpeg/">Using FFmpeg</a> - Linux how to pages</li>
<li>
<a rel="nofollow" class="external text" href="https://ffmpeg.org/general.html#Supported-File-Formats-and-Codecs">List</a> of supported audio and video streams</li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="/title/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/title/Category:Multimedia_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" title="Category:Multimedia (简体中文)">Multimedia (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="/title/Category:Pages_with_broken_package_links" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=FFmpeg_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=664909">https://wiki.archlinux.org/index.php?title=FFmpeg_(简体中文)&amp;oldid=664909</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 28 April 2021, at 12:40.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="/title/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="/title/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="/title/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
