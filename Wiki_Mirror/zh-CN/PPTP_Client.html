<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PPTP Client (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PPTP_Client_简体中文 rootpage-PPTP_Client_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">PPTP Client (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p>pptpclient是一个实现Microsoft PPTP协议的程序。因此它能够被用来接入另一个Microsoft VPN网络，比如学校和单位。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#%E5%AE%89%E8%A3%85PPTPClient"><span class="tocnumber">1</span> <span class="toctext">安装PPTPClient</span></a></li>
<li class="toclevel-1 tocsection-2">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">2.1</span> <span class="toctext">编辑配置文件</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#%E7%BC%96%E8%BE%91%E5%AF%86%E7%A0%81%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2</span> <span class="toctext">编辑密码文件</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#%E5%91%BD%E5%90%8D%E4%BD%A0%E7%9A%84VPN%E9%9A%A7%E9%81%93"><span class="tocnumber">2.3</span> <span class="toctext">命名你的VPN隧道</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6">
<a href="#%E5%88%9B%E5%BB%BA%E4%BD%A0%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="tocnumber">3</span> <span class="toctext">创建你的连接</span></a>
<ul>
<li class="toclevel-2 tocsection-7">
<a href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="tocnumber">3.1</span> <span class="toctext">配置路由</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#%E9%80%89%E6%8B%A9%E8%B7%AF%E7%94%B1"><span class="tocnumber">3.1.1</span> <span class="toctext">选择路由</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#%E9%85%8D%E7%BD%AE%E4%B8%BA%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1"><span class="tocnumber">3.1.2</span> <span class="toctext">配置为默认路由</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#%E4%BD%BF%E7%94%A8ip-up.d%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1"><span class="tocnumber">3.1.3</span> <span class="toctext">使用ip-up.d设置默认路由</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5"><span class="tocnumber">4</span> <span class="toctext">断开连接</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#%E6%8A%8A%E4%B8%80%E4%B8%AAVPN%E8%BF%9E%E6%8E%A5%E9%85%8D%E4%B8%BA%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8"><span class="tocnumber">5</span> <span class="toctext">把一个VPN连接配为默认启动</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#%E6%B3%A8%E6%84%8F"><span class="tocnumber">6</span> <span class="toctext">注意</span></a></li>
</ul>
</div>

<h2>
<span id=".E5.AE.89.E8.A3.85PPTPClient"></span><span class="mw-headline" id="安装PPTPClient">安装PPTPClient</span>
</h2>
<p>pptpclient由安装包pptpclient提供，运行下列命令可以安装：
</p>
<pre># pacman -S pptpclient
</pre>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p>你需要从网络管理员获取以下信息来配置pptpclient:
</p>
<ul>
<li>VPN服务器的ip或者域名</li>
<li>VPN隧道名称</li>
<li>Windows域（不是所有网络都需要）</li>
<li>VPN用户名</li>
<li>VPN密码</li>
</ul>
<h3>
<span id=".E7.BC.96.E8.BE.91.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="编辑配置文件">编辑配置文件</span>
</h3>
<p>用你称手的编辑器打开/etc/ppp/options.pptp。这个文件为你的VPN连接启用了一系列默认安全设置。如果你连接时候出现问题，你可以自定义配置。你的options.pptp文件最少需要包含以下内容：
</p>
<pre>lock
noauth
nobsdcomp
nodeflate
</pre>
<h3>
<span id=".E7.BC.96.E8.BE.91.E5.AF.86.E7.A0.81.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="编辑密码文件">编辑密码文件</span>
</h3>
<p>下一步，打开或者创建/etc/ppp/chap-secrets。我们将在这个文件里面存储你的密码，记得修改权限让除root之外所有用户不能访问它。这个文件的格式如下：
</p>
<pre>&lt;DOMAIN&gt;\\&lt;USERNAME&gt; PPTP &lt;PASSWORD&gt; *
</pre>
<p>如果你的服务器不要求域，则配置如下：
</p>
<pre>&lt;USERNAME&gt; PPTP &lt;PASSWORD&gt; *
</pre>
<p>替换掉上文中范例中的占位符。注意，如果你的密码包含特殊字符，比如“$”，你需要用双引号把它们包起来。
</p>
<h3>
<span id=".E5.91.BD.E5.90.8D.E4.BD.A0.E7.9A.84VPN.E9.9A.A7.E9.81.93"></span><span class="mw-headline" id="命名你的VPN隧道">命名你的VPN隧道</span>
</h3>
<p>用你称手的编辑器创建类似/etc/ppp/peers/&lt;TUNNEL&gt;的文件，把&lt;TUNNEL&gt;这里替换成你的VPN连接名。这个文件设置之后看起来如下：
</p>
<pre>pty "pptp &lt;SERVER&gt; --nolaunchpppd"
name &lt;DOMAIN&gt;\\&lt;USERNAME&gt;
remotename PPTP
require-mppe-128
file /etc/ppp/options.pptp
ipparam &lt;TUNNEL&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 跟刚才一样，如果你的连接不要求域，忽略范例中的"&lt;DOMAIN&gt;\\"</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> PPTP远程主机使用Chap-Secrets文件中的&lt;PASSWORD&gt;</div>
<p>&lt;SERVER&gt;是VPN服务器的地址，&lt;DOMAIN&gt;是你所属的域，&lt;USERNAME&gt;是你将要用来连接服务器的用户名，&lt;TUNNEL&gt;是连接的名称。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果你不需要使用MPPE，你应当从/etc/ppp/options.pptp中移除require-mppe-128这个选项</div>
<h2>
<span id=".E5.88.9B.E5.BB.BA.E4.BD.A0.E7.9A.84.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="创建你的连接">创建你的连接</span>
</h2>
<p>用root执行以下命令来确保配置是正确的：
</p>
<pre># pon $TUNNEL debug dump logfd 2 nodetach
</pre>
<p>如果一切都配置好了，pon命令应当不会自动结束。一旦你感觉差不多OK了，就可以终止这个命令。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 另一个用来确保配置正确的命令是ifconfig -a，看看里面时候有一个名叫ppp0的新驱动，并且还是可用的</div>
<p>执行以下命令来连接VPN隧道：
</p>
<pre># pon &lt;TUNNEL&gt;
</pre>
<p>&lt;TUNNEL&gt;是你之前命名过的VPN隧道名称。注意使用root命令执行。
</p>
<h3>
<span id=".E9.85.8D.E7.BD.AE.E8.B7.AF.E7.94.B1"></span><span class="mw-headline" id="配置路由">配置路由</span>
</h3>
<p>一旦你成功连接上VPN，你就可以和VPN服务器交互了。当然在此之前，咱们需要添加一个新的路由到你的路由表，从而可以接入远程网络。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 根据你的环境配置，你可能需要每次都重复添加路由信息</div>
<p>你可以阅读<a rel="nofollow" class="external text" href="http://pptpclient.sourceforge.net/routing.phtml">PPTP Routing Howto</a>来获得更多如何添加路由的信息，里面还有很多范例。
</p>
<h4>
<span id=".E9.80.89.E6.8B.A9.E8.B7.AF.E7.94.B1"></span><span class="mw-headline" id="选择路由">选择路由</span>
</h4>
<p>对我来说，只有传输到VPN网络的数据包才应该走VPN连接，所以我添加如下路由条目：
</p>
<pre># ip route add 192.168.10.0/24 dev ppp0
</pre>
<p>这将路由所有目的地址为191.168.10.xxx的数据到VPN连接。
</p>
<h4>
<span id=".E9.85.8D.E7.BD.AE.E4.B8.BA.E9.BB.98.E8.AE.A4.E8.B7.AF.E7.94.B1"></span><span class="mw-headline" id="配置为默认路由">配置为默认路由</span>
</h4>
<p>如果你想要所有数据从VPN连接走，下面这条命令包你爽：
</p>
<pre># ip route add default dev ppp0
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 所有数据从VPN连接走的话会比正常连接慢一些</div>
<h4>
<span id=".E4.BD.BF.E7.94.A8ip-up.d.E8.AE.BE.E7.BD.AE.E9.BB.98.E8.AE.A4.E8.B7.AF.E7.94.B1"></span><span class="mw-headline" id="使用ip-up.d设置默认路由">使用ip-up.d设置默认路由</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> /etc/ppp/ip-up.d/下所有脚本将在VPN连接建立的时候自动执行</div>
<pre>#!/bin/bash

# This script is called with the following arguments:
# Arg Name
# $1 接口名字
# $2 The tty
# $3 连接速度
# $4 本地ip地址
# $5 Peer IP number
# $6 可选``ipparam'' 的参数

route add default gw $4
</pre>
<p>把这个脚本命名为01-routes.sh,然后放在/etc/ppp/ip-up.d/下面。
</p>
<h2>
<span id=".E6.96.AD.E5.BC.80.E8.BF.9E.E6.8E.A5"></span><span class="mw-headline" id="断开连接">断开连接</span>
</h2>
<p>下面这条命令用来断开VPN连接：
</p>
<pre># poff &lt;TUNNEL&gt;
</pre>
<p>&lt;TUNNEL&gt;是你VPN连接的名称。
</p>
<h2>
<span id=".E6.8A.8A.E4.B8.80.E4.B8.AAVPN.E8.BF.9E.E6.8E.A5.E9.85.8D.E4.B8.BA.E9.BB.98.E8.AE.A4.E5.90.AF.E5.8A.A8"></span><span class="mw-headline" id="把一个VPN连接配为默认启动">把一个VPN连接配为默认启动</span>
</h2>
<p>你可以在rc.d创建一个快捷命令来实现自动在后台连接VPN网络。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 和平常一样，&lt;TUNNEL&gt;是你隧道的名字，&lt;ROUTING COMMAND&gt;是你加入路由表的命令。</div>
<pre>#!/bin/bash

. /etc/rc.conf
. /etc/rc.d/functions

DAEMON=&lt;TUNNEL&gt;-vpn
ARGS=

[ -r /etc/conf.d/$DAEMON ] &amp;&amp; . /etc/conf.d/$DAEMON


case "$1" in
 start)
   stat_busy "Starting $DAEMON"
   pon &lt;TUNNEL&gt; updetach persist &amp;&gt; /dev/null &amp;&amp; &lt;ROUTING COMMAND&gt; &amp;&gt;/dev/null
   if [ $? = 0 ]; then
     add_daemon $DAEMON
     stat_done
   else
     stat_fail
     exit 1
   fi
   ;;
 stop)
   stat_busy "Stopping $DAEMON"
   poff MST &amp;&gt;/dev/null
   if [ $? = 0 ]; then
     rm_daemon $DAEMON
     stat_done
   else
     stat_fail
     exit 1
   fi
   ;;
 restart)
   $0 stop
   sleep 1
   $0 start
   ;;
 *)
   echo "usage: $0 {start|stop|restart}"  
esac
</pre>
<p><br>
注意，我们可以使用updetach和persist这两个附加命令在pon上。updetach保证pon阻塞知道连接被建立。另外一个命令persist保证网络自动重练。如果需要开机自动启动，则添加@&lt;TUNNEL&gt;-vpn到rc.conf的DAEMONS中去。
</p>
<h2>
<span id=".E6.B3.A8.E6.84.8F"></span><span class="mw-headline" id="注意">注意</span>
</h2>
<p>你可以在<a rel="nofollow" class="external text" href="http://pptpclient.sourceforge.net/">pptpclient website</a>查到更多关于pptpclient的配置信息。Ubuntu的帮助手册也有一些帮助你配置的信息。这些范例能够很轻松的稍加变换从而添加到daemons中去，从而帮助你自动化运行。
</p>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Virtual_Private_Network.html" title="Category:Virtual Private Network (简体中文)">Virtual Private Network (简体中文)</a></li></ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PPTP_Client_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=434392">https://wiki.archlinux.org/index.php?title=PPTP_Client_(简体中文)&amp;oldid=434392</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 9 May 2016, at 06:24.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
