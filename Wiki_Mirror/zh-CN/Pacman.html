<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>pacman (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Pacman_简体中文 rootpage-Pacman_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">pacman (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>相关文章</p>
<ul>
<li><a href="../zh-CN/Creating_packages.html" title="Creating packages (简体中文)">Creating packages (简体中文)</a></li>
<li><a href="../zh-CN/Downgrading_packages.html" class="mw-redirect" title="软件包降级">软件包降级</a></li>
<li><a href="../zh-CN/0306e39ac7285139de785bf9297b3d25.html" class="mw-redirect" title="Pacman/Package signing (简体中文)">pacman/Package signing (简体中文)</a></li>
<li><a href="../zh-CN/2649c54c381be98a6da05b4a409f9c8e.html" class="mw-redirect" title="Pacman/Pacnew and Pacsave (简体中文)">pacman/Pacnew and Pacsave (简体中文)</a></li>
<li><a href="../zh-CN/faeb08953ef8de149ce932afcb597c79.html" class="mw-redirect" title="Pacman/Rosetta (简体中文)">pacman/Rosetta (简体中文)</a></li>
<li><a href="../zh-CN/a1951c746056374ca00c0c6c2bbae92a.html" class="mw-redirect" title="Pacman/Tips and tricks (简体中文)">pacman/Tips and tricks (简体中文)</a></li>
<li><a href="../zh-CN/Frequently_asked_questions.html" class="mw-redirect" title="FAQ (简体中文)">FAQ (简体中文)</a></li>
<li><a href="../zh-CN/System_maintenance.html" title="System maintenance (简体中文)">System maintenance (简体中文)</a></li>
<li><a href="../zh-CN/Arch_Build_System.html" title="Arch Build System (简体中文)">Arch Build System (简体中文)</a></li>
<li><a href="../zh-CN/Official_repositories.html" title="Official repositories (简体中文)">Official repositories (简体中文)</a></li>
<li><a href="../zh-CN/Arch_User_Repository.html" title="Arch User Repository (简体中文)">Arch User Repository (简体中文)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>翻译状态：</strong>本文是 <a href="../en/Pacman.html" title="Pacman">pacman</a> 的<a href="../zh-CN/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (简体中文)">翻译</a>。上次翻译日期：2020-10-20。如果英文版本有所<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Pacman&amp;diff=0&amp;oldid=639260">更改</a>，则您可以帮助同步翻译。</div>
<p><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/">pacman</a><a href="https://en.wikipedia.org/wiki/Package_management_system" class="extiw" title="wikipedia:Package management system">软件包管理器</a>是 Arch Linux 的一大亮点。它将一个简单的二进制包格式和易用的<a href="../zh-CN/Arch_Build_System.html" title="Arch Build System (简体中文)">构建系统</a>结合了起来。<i>pacman</i>的目标是简化对软件包的管理，无论软件包是来自<a href="../zh-CN/Official_repositories.html" title="Official repositories (简体中文)">官方软件仓库</a>还是来自用户自己的创建。
</p>
<p><i>pacman</i> 通过和主服务器同步软件包列表来进行系统更新。这种服务器/客户端模式可在使用一条命令就下载或安装软件包的同时，也安装其必需的依赖包。
</p>
<p><i>pacman</i> 用 <a href="../zh-CN/C.html" title="C (简体中文)">C 语言</a>编写，使用<span class="plainlinks archwiki-template-man" title="$ man 1 bsdtar"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/bsdtar.1">bsdtar(1)</a></span><a href="https://en.wikipedia.org/wiki/tar_(computing)" class="extiw" title="w:tar (computing)">tar</a>作为打包格式。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span> 软件包除提供了<a href="../zh-CN/Makepkg.html" title="Makepkg (简体中文)">makepkg</a>和<span class="plainlinks archwiki-template-man" title="$ man 8 vercmp"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/vercmp.8">vercmp(8)</a></span>等工具外，其它的有用工具如 <b>pactree</b>、<a href="../zh-CN/System_maintenance.html#%E4%B8%8D%E6%94%AF%E6%8C%81%E9%83%A8%E5%88%86%E5%8D%87%E7%BA%A7" title="System maintenance (简体中文)">checkupdates</a>等可在<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>（<a rel="nofollow" class="external text" href="https://git.archlinux.org/pacman.git/commit/?id=0c99eabd50752310f42ec808c8734a338122ec86">曾</a>是 <i>pacman</i> 的内置工具）中找到。你可以通过 <code>pacman -Ql pacman | grep -E 'bin/.+'</code> 获取全部的工具列表。</div>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E7%94%A8%E6%B3%95"><span class="tocnumber">1</span> <span class="toctext">用法</span></a>
<ul>
<li class="toclevel-2 tocsection-2">
<a href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">1.1</span> <span class="toctext">安装软件包</span></a>
<ul>
<li class="toclevel-3 tocsection-3">
<a href="#%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8C%85"><span class="tocnumber">1.1.1</span> <span class="toctext">安装指定的包</span></a>
<ul>
<li class="toclevel-4 tocsection-4"><a href="#%E8%99%9A%E5%8C%85"><span class="tocnumber">1.1.1.1</span> <span class="toctext">虚包</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-5"><a href="#%E5%AE%89%E8%A3%85%E5%8C%85%E7%BB%84"><span class="tocnumber">1.1.2</span> <span class="toctext">安装包组</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#%E5%88%A0%E9%99%A4%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">1.2</span> <span class="toctext">删除软件包</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#%E5%8D%87%E7%BA%A7%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">1.3</span> <span class="toctext">升级软件包</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#%E6%9F%A5%E8%AF%A2%E5%8C%85%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="tocnumber">1.4</span> <span class="toctext">查询包数据库</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Pactree"><span class="tocnumber">1.4.1</span> <span class="toctext">Pactree</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84"><span class="tocnumber">1.4.2</span> <span class="toctext">数据库结构</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#%E6%B8%85%E7%90%86%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%BC%93%E5%AD%98"><span class="tocnumber">1.5</span> <span class="toctext">清理软件包缓存</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#%E5%85%B6%E5%AE%83%E5%91%BD%E4%BB%A4"><span class="tocnumber">1.6</span> <span class="toctext">其它命令</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#%E5%AE%89%E8%A3%85%E5%8E%9F%E5%9B%A0"><span class="tocnumber">1.7</span> <span class="toctext">安装原因</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E5%85%B7%E4%BD%93%E6%96%87%E4%BB%B6%E7%9A%84%E5%8C%85%E5%90%8D"><span class="tocnumber">1.8</span> <span class="toctext">查询一个包含具体文件的包名</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15">
<a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">2</span> <span class="toctext">配置</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#%E9%80%9A%E7%94%A8%E9%80%89%E9%A1%B9"><span class="tocnumber">2.1</span> <span class="toctext">通用选项</span></a></li>
<li class="toclevel-2 tocsection-17">
<a href="#%E5%8D%87%E7%BA%A7%E5%89%8D%E5%AF%B9%E6%AF%94%E7%89%88%E6%9C%AC"><span class="tocnumber">2.2</span> <span class="toctext">升级前对比版本</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#%E5%9C%A8%E5%8D%87%E7%BA%A7%E6%97%B6%E8%B7%B3%E8%BF%87%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">2.2.1</span> <span class="toctext">在升级时跳过软件包</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#%E5%9C%A8%E5%8D%87%E7%BA%A7%E6%97%B6%E8%B7%B3%E8%BF%87%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%BB%84"><span class="tocnumber">2.2.2</span> <span class="toctext">在升级时跳过软件包组</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#%E5%9C%A8%E5%8D%87%E7%BA%A7%E6%97%B6%E8%B7%B3%E8%BF%87%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2.3</span> <span class="toctext">在升级时跳过文件</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#%E5%9C%A8%E5%AE%89%E8%A3%85%E6%97%B6%E8%B7%B3%E8%BF%87%E6%96%87%E4%BB%B6"><span class="tocnumber">2.2.4</span> <span class="toctext">在安装时跳过文件</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="#%E4%BF%9D%E7%95%99%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="tocnumber">2.3</span> <span class="toctext">保留多个配置文件</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#Hooks"><span class="tocnumber">2.4</span> <span class="toctext">Hooks</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93"><span class="tocnumber">2.5</span> <span class="toctext">软件仓库</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="tocnumber">2.6</span> <span class="toctext">软件包的安全性</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26">
<a href="#%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94"><span class="tocnumber">3</span> <span class="toctext">疑难解答</span></a>
<ul>
<li class="toclevel-2 tocsection-27"><a href="#%22Failed_to_commit_transaction_(conflicting_files)%22_%E9%94%99%E8%AF%AF"><span class="tocnumber">3.1</span> <span class="toctext">"Failed to commit transaction (conflicting files)" 错误</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#%22Failed_to_commit_transaction_(invalid_or_corrupted_package)%22_%E9%94%99%E8%AF%AF"><span class="tocnumber">3.2</span> <span class="toctext">"Failed to commit transaction (invalid or corrupted package)" 错误</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#%22Failed_to_init_transaction_(unable_to_lock_database)%22_%E9%94%99%E8%AF%AF"><span class="tocnumber">3.3</span> <span class="toctext">"Failed to init transaction (unable to lock database)" 错误</span></a></li>
<li class="toclevel-2 tocsection-30"><a href="#%E5%AE%89%E8%A3%85%E6%97%B6%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="tocnumber">3.4</span> <span class="toctext">安装时无法获取软件包</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#pacman_%E6%9B%B4%E6%96%B0%E6%97%B6%E5%B4%A9%E6%BA%83"><span class="tocnumber">3.5</span> <span class="toctext">pacman 更新时崩溃</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#%E6%89%8B%E5%8A%A8%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85_pacman"><span class="tocnumber">3.6</span> <span class="toctext">手动重新安装 pacman</span></a></li>
<li class="toclevel-2 tocsection-33"><a href="#%E5%8D%87%E7%BA%A7%E7%B3%BB%E7%BB%9F%E9%87%8D%E5%90%AF%E5%90%8E%EF%BC%8C%E5%87%BA%E7%8E%B0%22unable_to_find_root_device%22%E9%94%99%E8%AF%AF%EF%BC%8C%E6%97%A0%E6%B3%95%E7%99%BB%E9%99%86"><span class="tocnumber">3.7</span> <span class="toctext">升级系统重启后，出现"unable to find root device"错误，无法登陆</span></a></li>
<li class="toclevel-2 tocsection-34"><a href="#Signature_from_%22User_&lt;email@gmail.com&gt;%22_is_unknown_trust,_installation_failed"><span class="tocnumber">3.8</span> <span class="toctext">Signature from "User &lt;email@gmail.com&gt;" is unknown trust, installation failed</span></a></li>
<li class="toclevel-2 tocsection-35"><a href="#%E8%AF%B7%E6%B1%82%E5%AF%BC%E5%85%A5_PGP_keys"><span class="tocnumber">3.9</span> <span class="toctext">请求导入 PGP keys</span></a></li>
<li class="toclevel-2 tocsection-36"><a href="#Error:_key_%220123456789ABCDEF%22_could_not_be_looked_up_remotely"><span class="tocnumber">3.10</span> <span class="toctext">Error: key "0123456789ABCDEF" could not be looked up remotely</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#%E4%B8%8D%E5%81%9C%E7%9C%8B%E5%88%B0%E9%94%99%E8%AF%AF_%22PackageName:_signature_from_%22User_&lt;email@archlinux.org&gt;%22_is_invalid%22"><span class="tocnumber">3.11</span> <span class="toctext">不停看到错误 "PackageName: signature from "User &lt;email@archlinux.org&gt;" is invalid"</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#'warning:_current_locale_is_invalid;_using_default_%22C%22_locale'_%E9%94%99%E8%AF%AF"><span class="tocnumber">3.12</span> <span class="toctext">'warning: current locale is invalid; using default "C" locale' 错误</span></a></li>
<li class="toclevel-2 tocsection-39"><a href="#Pacman_%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%88%91%E7%9A%84%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE"><span class="tocnumber">3.13</span> <span class="toctext">Pacman 不使用我的代理设置</span></a></li>
<li class="toclevel-2 tocsection-40"><a href="#%E5%A6%82%E4%BD%95%E9%87%8D%E8%A3%85%E6%89%80%E6%9C%89%E5%8C%85%E5%B9%B6%E4%BF%9D%E7%95%99%E5%AE%89%E8%A3%85%E5%92%8C%E4%BE%9D%E8%B5%96%E4%BF%A1%E6%81%AF%EF%BC%9F"><span class="tocnumber">3.14</span> <span class="toctext">如何重装所有包并保留安装和依赖信息？</span></a></li>
<li class="toclevel-2 tocsection-41"><a href="#%22Cannot_open_shared_object_file%22_%E9%94%99%E8%AF%AF"><span class="tocnumber">3.15</span> <span class="toctext">"Cannot open shared object file" 错误</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#%E8%BD%AF%E4%BB%B6%E5%8C%85%E4%B8%8B%E8%BD%BD%E5%81%9C%E6%BB%9E"><span class="tocnumber">3.16</span> <span class="toctext">软件包下载停滞</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#%E6%97%A0%E6%B3%95%E4%BB%8E%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%8E%B7%E5%8F%96_'core.db'"><span class="tocnumber">3.17</span> <span class="toctext">无法从镜像服务器获取 'core.db'</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#error:_'local-package.pkg.tar':_permission_denied"><span class="tocnumber">3.18</span> <span class="toctext">error: 'local-package.pkg.tar': permission denied</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-45"><a href="#%E5%8F%A6%E8%AF%B7%E5%8F%82%E8%A7%81"><span class="tocnumber">4</span> <span class="toctext">另请参见</span></a></li>
</ul>
</div>

<h2>
<span id=".E7.94.A8.E6.B3.95"></span><span class="mw-headline" id="用法">用法</span>
</h2>
<p>下面<i>pacman</i>可以执行的操作的一小部分，<i>pacman</i> 的其他示例请阅读<span class="plainlinks archwiki-template-man" title="$ man 8 pacman"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pacman.8">pacman(8)</a></span>。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 使用过其它发行版的用户，可以参考 <a href="../en/Pacman/Rosetta.html" class="mw-redirect" title="Pacman Rosetta">Pacman Rosetta</a> 中的对比.</div>
<h3>
<span id=".E5.AE.89.E8.A3.85.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="安装软件包">安装软件包</span>
</h3>
<p>一个软件包是一个归档，它包含：
</p>
<ul>
<li>一个应用的所有（编译好的）文件</li>
<li>有关该应用的元数据，例如应用名称，版本，依赖……</li>
<li>供 pacman 使用的安装文件和指令</li>
<li>（可选）使软件更易操作的额外文件，例如启动/终止脚本</li>
</ul>
<p>Arch 的软件包管理器 pacman 可以安装，更新，和删除这些软件包。使用软件包而不是自己编译安装有如下优势：
</p>
<ul>
<li>轻松升级：pacman 会在更新可用时立即更新已安装的软件包</li>
<li>依赖检查：pacman 负责为你处理依赖问题，你只需要指明程序，pacman 就会把它和它所需的所有其他程序都一起安装。</li>
<li>干净卸载：pacman 有着一个软件包所有文件的列表。这样，当你决定移除软件包时，不会无意留下文件。</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 软件包通常有很多<a href="../en/PKGBUILD.html#optdepends" title="PKGBUILD">可选依赖</a>， 它们为软件提供额外功能， 并不强制要求安装它们。 安装软件时, <i>pacman</i> 将会输出它的可选依赖, 但是这个输出不会在 <code>pacman.log</code>中；当你想浏览已安装软件的可选依赖时可以使用<code>pacman -Si</code> ，得到关于可选依赖的简短描述。</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 在Arch下安装软件包时，未<a href="#%E5%8D%87%E7%BA%A7%E8%BD%AF%E4%BB%B6%E5%8C%85">更新</a>系统前，<b>不要</b>更新软件包数据库（例如，可能出现某软件包不再出现在官方库）。操作时，应使用<code>pacman -Syu <i>package_name</i></code>, 而不要使用（<code>pacman -Sy <i>package_name</i></code>），否则可能会有依赖问题。参见 <a href="../zh-CN/System_maintenance.html#%E4%B8%8D%E6%94%AF%E6%8C%81%E9%83%A8%E5%88%86%E5%8D%87%E7%BA%A7" title="System maintenance (简体中文)">System maintenance (简体中文)#不支持部分升级</a> 和 <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=89328">BBS#89328</a>.</div>
<h4>
<span id=".E5.AE.89.E8.A3.85.E6.8C.87.E5.AE.9A.E7.9A.84.E5.8C.85"></span><span class="mw-headline" id="安装指定的包">安装指定的包</span>
</h4>
<p>安装或者升级单个软件包，或者一列软件包（包含依赖包），使用如下命令：
</p>
<pre># pacman -S <i>package_name1</i> <i>package_name2</i> <i>...</i>
</pre>
<p>用正则表达式安装多个软件包（参见 <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=7179">这个帖子</a>）：
</p>
<pre># pacman -S $(pacman -Ssq <i>package_regex</i>)
</pre>
<p>有时候在不同的软件仓库中，一个软件包有多个版本（比如[extra]和[testing]）。可以选择一个来安装：
</p>
<pre># pacman -S extra/<i>package_name</i>
</pre>
<p>安装多个含有相似名称的软件包，而并非整个包组或全部匹配的软件包； 例如，<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/plasma/">plasma</a></span>:
</p>
<pre># pacman -S plasma-{desktop,mediacenter,nm}
</pre>
<p>当然，可以多层扩展，并不作限制：
</p>
<pre># pacman -S plasma-{workspace{,-wallpapers},pa}
</pre>
<h5>
<span id=".E8.99.9A.E5.8C.85"></span><span class="mw-headline" id="虚包">虚包</span>
</h5>
<p>虚拟软件包是一个特殊的软件包，它本身并不存在，但由一或多个其它软件包提供。虚拟软件包允许其它软件包不以某一个特定的包为依赖，以应对有多个候选的情况。虚包不能用它们的名称安装，相反它们会在你安装<i>提供</i>虚包的软件包时被安装到你的系统中。
</p>
<h4>
<span id=".E5.AE.89.E8.A3.85.E5.8C.85.E7.BB.84"></span><span class="mw-headline" id="安装包组">安装包组</span>
</h4>
<p>一些包属于一个可以同时安装的<a href="../zh-CN/Meta_package_and_package_group.html" title="Meta package and package group (简体中文)">软件包组</a>。例如，运行下面的命令
</p>
<pre># pacman -S gnome
</pre>
<p>会提醒用户选择 <code>gnome</code> 内需要安装的包。
</p>
<p>有的包组包含大量的软件包，有时用户只需其中几个。除了逐一键入序号外，pacman 还支持选择或排除某个区间内的的软件包：
</p>
<pre>Enter a selection (default=all): 1-10 15
</pre>
<p>这将选中序号 1 至 10 和 15 的软件包。而
</p>
<pre>Enter a selection (default=all): ^5-8 ^2
</pre>
<p>将会选中除了序号 5 至 8 和 2 之外的所有软件包。
</p>
<p>想要查看哪些包属于 gnome 组，运行：
</p>
<pre># pacman -Sg gnome
</pre>
<p>也可以访问 <a rel="nofollow" class="external free" href="https://archlinux.org/groups/">https://archlinux.org/groups/</a> 查看可用的包组。
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果列表中的包已经安装在系统中，它会被重新安装，即使它已经是最新的。可以用 <code>--needed</code> 选项覆盖这种行为。</div>
<h3>
<span id=".E5.88.A0.E9.99.A4.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="删除软件包">删除软件包</span>
</h3>
<p>删除单个软件包，保留其全部已经安装的依赖关系
</p>
<pre># pacman -R <i>package_name</i>
</pre>
<p>删除指定软件包，及其所有没有被其他已安装软件包使用的依赖关系：
</p>
<pre># pacman -Rs <i>package_name</i>
</pre>
<p>上面这条命令在移除包含其他所需包的组时有时候会拒绝运行。这种情况下可以尝试
</p>
<pre># pacman -Rsu <i>package_name</i>
</pre>
<p>要删除软件包和所有依赖这个软件包的程序:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 此操作是递归的，请小心检查，可能会一次删除大量的软件包。</div>
<pre># pacman -Rsc <i>package_name</i>
</pre>
<p>要删除一个被其他软件包依赖的软件包，但是不删除依赖这个软件包的其他软件包：
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 此操作有破坏系统的能力，应该尽量避免使用。详情请看 <a href="../en/System_maintenance.html#Avoid_certain_pacman_commands" title="System maintenance">避免某些 Pacman 命令</a>。</div>
<pre># pacman -Rdd <i>package_name</i>
</pre>
<p><i>pacman</i> 删除某些程序时会备份重要配置文件，在其后面加上*.pacsave扩展名。-n 选项可以避免备份这些文件：
</p>
<pre>pacman -Rn <i>package_name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> <i>pacman</i> 不会删除软件自己创建的文件（例如主目录中的“点文件”不会被删除。）</div>
<h3>
<span id=".E5.8D.87.E7.BA.A7.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="升级软件包">升级软件包</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 
<ul>
<li>建议用户遵守<a href="../zh-CN/System_maintenance.html#%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F" title="System maintenance (简体中文)">System maintenance (简体中文)#更新系统</a>的指导，定期更新系统，并不盲目地执行这些命令。</li>
<li>Arch 只支持系统完整升级，详细参见<a href="../zh-CN/System_maintenance.html#%E4%B8%8D%E6%94%AF%E6%8C%81%E9%83%A8%E5%88%86%E5%8D%87%E7%BA%A7" title="System maintenance (简体中文)">System maintenance (简体中文)#不支持部分升级</a>和<a href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85">#安装软件包</a>。</li>
</ul>
</div>
<p>一个 <i>pacman</i> 命令就可以升级整个系统。花费的时间取决于系统有多老。这个命令会同步非本地(local)软件仓库并升级系统的软件包：
</p>
<pre># pacman -Syu
</pre>
<h3>
<span id=".E6.9F.A5.E8.AF.A2.E5.8C.85.E6.95.B0.E6.8D.AE.E5.BA.93"></span><span class="mw-headline" id="查询包数据库">查询包数据库</span>
</h3>
<p><i>pacman</i> 使用 <code>-Q</code> 参数查询本地软件包数据库， <code>-S</code> 查询同步数据库，以及 <code>-F</code>查询文件数据库。要了解每个参数的子选项，分别参见 <a href="/index.php?title=Template:Pacman_-Q_--help&amp;action=edit&amp;redlink=1" class="new" title="Template:Pacman -Q --help (page does not exist)">Template:Pacman -Q --help</a>，<a href="/index.php?title=Template:Pacman_-S_--help&amp;action=edit&amp;redlink=1" class="new" title="Template:Pacman -S --help (page does not exist)">Template:Pacman -S --help</a>和<a href="/index.php?title=Template:Pacman_-F_--help&amp;action=edit&amp;redlink=1" class="new" title="Template:Pacman -F --help (page does not exist)">Template:Pacman -F --help</a>。
</p>
<p><i>pacman</i> 可以在包数据库中查询软件包，查询位置包含了软件包的名字和描述：
</p>
<pre>$ pacman -Ss <i>string1</i> <i>string2</i> ...
</pre>
<p>有时，<code>-s</code>的内置正则会匹配很多不需要的结果，所以应当指定仅搜索包名，而非描述或其他子段:
</p>
<pre>$ pacman -Ss '^vim-'
</pre>
<p>要查询已安装的软件包：
</p>
<pre>$ pacman -Qs <i>string1</i> <i>string2</i> ...
</pre>
<p>按文件名查找软件库：
</p>
<pre>$ pacman -F <i>string1</i> <i>string2</i> ...
</pre>
<p>显示软件包的详尽的信息：
</p>
<pre>$ pacman -Si <i>package_name</i>
</pre>
<p>查询本地安装包的详细信息：
</p>
<pre>$ pacman -Qi <i>package_name</i>
</pre>
<p>使用两个 <code>-i</code> 将同时显示备份文件和修改状态：
</p>
<pre>$ pacman -Qii <i>package_name</i>
</pre>
<p>要获取已安装软件包所包含文件的列表：
</p>
<pre>$ pacman -Ql <i>package_name</i>
</pre>
<p>查询远程库中软件包包含的文件：
</p>
<pre>$ pacman -Fl <i>package_name</i>
</pre>
<p>检查软件包安装的文件是否都存在：
</p>
<pre>$ pacman -Qk <i>package_name</i>
</pre>
<p>两个参数<code>k</code>将会执行一次更彻底的检查。
查询数据库获取某个文件属于哪个软件包：
</p>
<pre>$ pacman -Qo <i>/path/to/file_name</i>
</pre>
<p>查询文件属于远程数据库中的哪个软件包：
</p>
<pre>$ pacman -F <i>/path/to/file_name</i>
</pre>
<p>要罗列所有不再作为依赖的软件包(孤立orphans)：
</p>
<pre>$ pacman -Qdt
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 将上述命令添加到 pacman 的一个处理后 <a href="#Hooks">hook</a>用于在如果有处理产生孤立包后获得提示。这在当有软件包被仓库放弃时是有用的，因为任何被抛弃的包都会成为本地的一个孤立包（除非它是被显式安装的）。要避免在没有找到孤立包时"failed to execute command”的错误，在你的 hook 中为<code>Exec</code>使用如下的指令: <code>/usr/bin/bash -c "/usr/bin/pacman -Qtd || /usr/bin/echo '=&gt; None found.'"</code>
</div>
<p>要罗列所有明确安装而且不被其它包依赖的软件包：
</p>
<pre>$ pacman -Qet
</pre>
<p>更多例子查看<a href="../en/Pacman/Tips_and_tricks.html" class="mw-redirect" title="Pacman tips">pacman tips</a>。
</p>
<h4><span class="mw-headline" id="Pactree">Pactree</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> <span class="plainlinks archwiki-template-man" title="$ man 8 pactree"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pactree.8">pactree(8)</a></span>不再是<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>的一部分。它现在在<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>中。</div>
<p>要显示软件包的依赖树：
</p>
<pre>$ pactree <i>package_name</i>
</pre>
<p>检查一个<i>安装</i>的软件包被那些包依赖，将递归标识<code>-r</code>传递给 <i>pactree</i>，或者使用 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pkgtools/">pkgtools</a></span><sup><small>AUR</small></sup>中的<i>whoneeds</i>
</p>
<h4>
<span id=".E6.95.B0.E6.8D.AE.E5.BA.93.E7.BB.93.E6.9E.84"></span><span class="mw-headline" id="数据库结构">数据库结构</span>
</h4>
<p>pacman数据库通常位于 <code>/var/lib/pacman/sync</code>. 对于每一个在<code>/etc/pacman.conf</code>中指定的软件仓库， 这里都有一个一致的数据库。数据库文件夹里每个tar.gz文件都包含着一个仓库的软件包信息。例如<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=which">which</a></span> 包:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ tree which-2.21-5</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">which-2.21-5
|-- desc
</pre>
<p>这个 <code>depends</code> 项列出了该软件的依赖包， 而<code>desc</code>有该包的介绍，例如文件大小和MD5值 。
</p>
<h3>
<span id=".E6.B8.85.E7.90.86.E8.BD.AF.E4.BB.B6.E5.8C.85.E7.BC.93.E5.AD.98"></span><span class="mw-headline" id="清理软件包缓存">清理软件包缓存</span>
</h3>
<p><i>pacman</i> 将下载的软件包保存在 <code>/var/cache/pacman/pkg/</code> 并且不会自动移除旧的和未安装版本的软件包。这样做有一些好处：
</p>
<ol>
<li>这样允许<a href="../zh-CN/Downgrading_packages.html" title="Downgrading packages (简体中文)">降级</a>软件包而不需要通过其他方式提取旧版本，例如 <a href="../zh-CN/Arch_Linux_Archive.html" title="Arch Linux Archive (简体中文)">Arch Linux Archive</a>.</li>
<li>被卸载的软件包可以轻易地直接从缓存文件夹重新安装，不需要重新从软件仓库下载。</li>
</ol>
<p>然而，需要定期手动清理缓存来避免该文件夹无限制增大。
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> 提供的 <span class="plainlinks archwiki-template-man" title="$ man 8 paccache"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/paccache.8">paccache(8)</a></span> 脚本默认会删除所有缓存的版本和已卸载的软件包，除了最近的3个会被保留：
</p>
<pre># paccache -r
</pre>
<p><a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Enable">启用</a> 和 <a href="../en/Systemd.html#Using_units" class="mw-redirect" title="Start">启动</a> <code>paccache.timer</code>来每周删除不使用的包。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 可以使用 <a href="#Hooks">hook</a> 自动执行清理，参考<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1694743#p1694743">[1]</a>和<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pacman-cleanup-hook/">pacman-cleanup-hook</a></span><sup><small>AUR</small></sup>。</div>
<p>也可以自己设置保留最近几个版本：
</p>
<pre># paccache -rk1
</pre>
<p>添加<code>-u</code>/<code>--uninstalled</code>开关来限制<i>paccache</i>的行为只作用于卸载的包。例如清理所有卸载的包的缓存版本，可以用以下命令:
</p>
<pre># paccache -ruk0
</pre>
<p>或者你可以将安装其结合，同时作用于安装的和卸载的包，例如想要保留最近两个安装的包但是移除所有卸载的包的缓存版本，使用以下命令：
</p>
<pre># paccache -rk2 -ruk0
</pre>
<p>更多参数参见<code>paccache -h</code>。
</p>
<p><i>pacman</i>也有一些内建参数用于清除缓存和那些不再在<code>/etc/pacman.conf</code>配置文件中列出的软件仓库残留数据库文件。然而<i>pacman</i>并不提供保留一定数量的过去版本的功能，因此它比<i>paccache</i>的默认选项更加激进。
</p>
<p>要删除目前没有安装的所有缓存的包，和没有被使用的同步数据库，执行：
</p>
<pre># pacman -Sc
</pre>
<p>要删除缓存中的全部文件，使用两次<code>-c</code>开关。这是最为激进的方式，将会清空缓存文件夹：
</p>
<pre># pacman -Scc
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 应当避免从缓存中删除所有过去版本和卸载的包，除非需要更多磁盘空间。这样会导致无法降级或重新安装包而不再次下载他们</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pkgcacheclean/">pkgcacheclean</a></span><sup><small>AUR</small></sup>以及<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pacleaner/">pacleaner</a></span><sup><small>AUR</small></sup>是两个进一步清理缓存的替代工具
</p>
<h3>
<span id=".E5.85.B6.E5.AE.83.E5.91.BD.E4.BB.A4"></span><span class="mw-headline" id="其它命令">其它命令</span>
</h3>
<p>升级系统时安装其他软件包：
</p>
<pre># pacman -Syu <i>package_name1</i> <i>package_name2</i> ...
</pre>
<p>下载包而不安装它：
</p>
<pre># pacman -Sw package_name
</pre>
<p>安装一个<b>本地</b>包(不从源里下载）：
</p>
<pre># pacman -U <i>/path/to/package/package_name-version.pkg.tar.xz</i>
</pre>
<p>要将本地包保存至缓存，可执行：
</p>
<pre># pacman -U file:///<i>path/to/package/package_name-version.pkg.tar.xz</i>
</pre>
<p>安装一个<b>远程</b>包（不在 <i>pacman</i> 配置的源里面）：
</p>
<pre># pacman -U <i>http://www.example.com/repo/example.pkg.tar.xz</i>
</pre>
<p>要禁用 <code>-S</code>, <code>-U</code> 和 <code>-R</code> 动作，可以使用 <code>-p</code> 选项.
</p>
<p><i>pacman</i> 会列出需要安装和删除的软件，并在执行动作前要求需要的权限。
</p>
<h3>
<span id=".E5.AE.89.E8.A3.85.E5.8E.9F.E5.9B.A0"></span><span class="mw-headline" id="安装原因">安装原因</span>
</h3>
<p><i>pacman</i>数据库按照软件包被安装的原因，将其分为两类：
</p>
<ul>
<li>
<b>显式安装</b>：那些真正地被传递给通用<i>pacman</i><code>-S</code>和<code>-U</code>命令的包；</li>
<li>
<b>依赖</b>：那些虽然（一般）从未被传递给<i>pacman</i>安装命令，但由于被其它显式安装的包<a href="../en/PKGBUILD.html#Dependencies" class="mw-redirect" title="Dependency">需要</a>从而被隐式安装的包</li>
</ul>
<p>当安装软件包时，可以把安装原因强制设为<b>依赖</b>:
</p>
<pre># pacman -S --asdeps <i>package_name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 用<code>--asdeps</code>安装可选依赖将导致如果你<a href="../en/Pacman/Tips_and_tricks.html#Removing_unused_packages_.28orphans.29" title="Pacman/Tips and tricks">移除孤立包</a>，<i>pacman</i>将会一同移除剩下的可选依赖。</div>
<p>但是当重新安装该软件包时，安装原因将会被设为软件包所默认的。
</p>
<p>显式安装的软件包列表可用<code>pacman -Qe</code>获取, 与之互补的已安装的依赖包可用<code>pacman -Qd</code>获取。
</p>
<p>改变某个已安装软件包的安装原因，可以执行：
</p>
<pre># pacman -D --asdeps <i>package_name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 在升级时使用<code>--asdeps</code>和<code>--asexplicit</code>选项，例如<code>pacman -Syu <i>package_name</i> --asdeps</code>，是不被推荐的。这会导致不仅改变要被安装的软件包的安装原因，也会改变被升级的软件包的安装原因。</div>
<h3>
<span id=".E6.9F.A5.E8.AF.A2.E4.B8.80.E4.B8.AA.E5.8C.85.E5.90.AB.E5.85.B7.E4.BD.93.E6.96.87.E4.BB.B6.E7.9A.84.E5.8C.85.E5.90.8D"></span><span class="mw-headline" id="查询一个包含具体文件的包名">查询一个包含具体文件的包名</span>
</h3>
<p>同步文件数据库:
</p>
<pre># pacman -Fy
</pre>
<p>查询包含某个文件的包名，比如:
</p>
<pre># pacman -F pacman
core/pacman 5.0.1-4
    usr/bin/pacman
    usr/share/bash-completion/completions/pacman
extra/xscreensaver 5.36-1
    usr/lib/xscreensaver/pacman
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong>  可以设置一个 <code>crontab</code> 或者 <code>systemd timer</code> 来定期同步文件信息数据库。</div>
<p>如果需要高级功能请安装 <a href="../en/Pkgfile.html" title="Pkgfile">pkgfile</a>，它使用一个单独的数据库来保存文件和它们所关联的软件包的信息。
</p>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p><i>pacman</i> 的配置文件位于<code>/etc/pacman.conf</code>。 <a rel="nofollow" class="external text" href="https://archlinux.org/pacman/pacman.conf.5.html">man pacman.conf</a> 可以查看配置文件的进一步信息。
</p>
<h3>
<span id=".E9.80.9A.E7.94.A8.E9.80.89.E9.A1.B9"></span><span class="mw-headline" id="通用选项">通用选项</span>
</h3>
<p>通用选项都在<code>[options]</code>段。阅读 man 手册或者查看默认的 pacman.conf 可以获得有关信息和用法。
</p>
<h3>
<span id=".E5.8D.87.E7.BA.A7.E5.89.8D.E5.AF.B9.E6.AF.94.E7.89.88.E6.9C.AC"></span><span class="mw-headline" id="升级前对比版本">升级前对比版本</span>
</h3>
<p>要查看旧版和新版的有效安装包，请取消<code>/etc/pacman.conf</code>中"VerbosePkgLists"的注释。修改后的<code>pacman -Syu</code>输出如下：
</p>
<pre>Package (6)             Old Version  New Version  Net Change  Download Size

extra/libmariadbclient  10.1.9-4     10.1.10-1      0.03 MiB       4.35 MiB
extra/libpng            1.6.19-1     1.6.20-1       0.00 MiB       0.23 MiB
extra/mariadb           10.1.9-4     10.1.10-1      0.26 MiB      13.80 MiB
</pre>
<h4>
<span id=".E5.9C.A8.E5.8D.87.E7.BA.A7.E6.97.B6.E8.B7.B3.E8.BF.87.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="在升级时跳过软件包">在升级时跳过软件包</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 在跳过软件包时要小心，因为<a href="../zh-CN/System_maintenance.html#%E4%B8%8D%E6%94%AF%E6%8C%81%E9%83%A8%E5%88%86%E5%8D%87%E7%BA%A7" title="System maintenance (简体中文)">部分升级不受支持</a>
</div>
<p>要想在<a href="#%E5%8D%87%E7%BA%A7%E8%BD%AF%E4%BB%B6%E5%8C%85">升级</a>系统时跳过特定的软件包，用像如下的命令指明：
</p>
<pre>IgnorePkg=linux
</pre>
<p>多软件包可以用空格隔开，或者用另外的<code>IgnorePkg</code>行。也可使用 <a href="https://en.wikipedia.org/wiki/glob_(programming)" class="extiw" title="wikipedia:glob (programming)">glob</a> 模式。如果只打算忽略一次升级，可以使用 <code>--ignore</code> 选项，这时使用逗号隔开的列表。
</p>
<p>忽略了的软件包依然可通过 <code>pacman -S</code> 升级。这种情况下<i>pacman</i>会提醒你这些软件包已经被包含在<code>IgnorePkg</code>声明中。
</p>
<h4>
<span id=".E5.9C.A8.E5.8D.87.E7.BA.A7.E6.97.B6.E8.B7.B3.E8.BF.87.E8.BD.AF.E4.BB.B6.E5.8C.85.E7.BB.84"></span><span class="mw-headline" id="在升级时跳过软件包组">在升级时跳过软件包组</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 在跳过软件包时要小心，因为<a href="../zh-CN/System_maintenance.html#%E4%B8%8D%E6%94%AF%E6%8C%81%E9%83%A8%E5%88%86%E5%8D%87%E7%BA%A7" title="System maintenance (简体中文)">部分升级不受支持</a>
</div>
<p>和软件包一样，也可以不升级某个软件包组：
</p>
<pre>IgnoreGroup = gnome
</pre>
<h4>
<span id=".E5.9C.A8.E5.8D.87.E7.BA.A7.E6.97.B6.E8.B7.B3.E8.BF.87.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="在升级时跳过文件">在升级时跳过文件</span>
</h4>
<p>所有在<code>NoUpgrade</code>指令中列出的文件都会在软件包被安装/升级时不会被更改，并且新文件会以带有<i>.pacnew</i>后缀名的形式安装
</p>
<pre>NoUpgrade=<i>path/to/file</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 这个路径指软件包中的文件，所以不要包括开头的斜线。</div>
<h4>
<span id=".E5.9C.A8.E5.AE.89.E8.A3.85.E6.97.B6.E8.B7.B3.E8.BF.87.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="在安装时跳过文件">在安装时跳过文件</span>
</h4>
<p>要总是跳过某些文件夹的安装，可以将它们放到 <code>NoExtract</code> 中，例如不想安装 <a href="../en/Systemd.html" title="Systemd">systemd</a> 模块：
</p>
<pre>NoExtract=usr/lib/systemd/system/*
</pre>
<p>后面的规则覆盖前面的规则，加上 <code>!</code> 可以取消跳过效果。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> <i>pacman</i>会在更新locales已经被<i>localepurge</i>或者<i>bleachbit</i>清除的包时发出警告。将<code>CheckSpace</code>参数加入<code>pacman.conf</code>能够抑制这种警告，但是要意识到space-check功能将会对所有软件包禁用。</div>
<h3>
<span id=".E4.BF.9D.E7.95.99.E5.A4.9A.E4.B8.AA.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"></span><span class="mw-headline" id="保留多个配置文件">保留多个配置文件</span>
</h3>
<p>如果你有多个配置文件（比如，主配置和启用了<a href="../zh-CN/Official_repositories.html#testing_%E4%BB%93%E5%BA%93" title="Official repositories (简体中文)">测试仓库</a>的配置文件），需要共享一些设置，你可以在配置文件中使用<code>Include</code>选项，例如：
</p>
<pre>Include = <i>/path/to/common/settings</i>
</pre>
<p><code><i>/path/to/common/settings</i></code>文件中是两个配置文件共享的相同配置。
</p>
<h3><span class="mw-headline" id="Hooks">Hooks</span></h3>
<p><i>pacman</i>可以在处理前后，运行<code>/usr/share/libalpm/hooks/</code>文件夹下的hooks，更多的hooks文件夹可以通过<code>HooDir</code>选项在<code>pacman.conf</code>中指明，默认<code>/etc/pacman.d/hooks</code>。Hook文件必须以<i>.hook</i>为后缀。Pacman hooks不是交互式的。
</p>
<p><i>pacman</i> hooks用于，比如说，和<code>systemd-sysusers</code>和<code>systemd-tmpfiles</code>结合来在安装包时自动创建系统用户和文件。例如，<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat8">tomcat8</a></span>指明它想要创建一个叫做<code>tomcat8</code>的系统用户和一些属于该用户的文件。当<i>pacman</i>确定<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tomcat8">tomcat8</a></span>包含文件指明用户和临时文件时，<i>pacman</i> hooks <code>systemd-sysusers.hook</code>和<code>systemd-tmpfiles.hook</code>唤起<code>systemd-sysusers</code>和<code>systemd-tmpfiles</code>。
</p>
<p>有关 alpm hooks 的更多信息，参见<span class="plainlinks archwiki-template-man" title="$ man 5 alpm-hooks"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/alpm-hooks.5">alpm-hooks(5)</a></span>。
</p>
<h3>
<span id=".E8.BD.AF.E4.BB.B6.E4.BB.93.E5.BA.93"></span><span class="mw-headline" id="软件仓库">软件仓库</span>
</h3>
<p>除了特殊的<a href="#%E9%80%9A%E7%94%A8%E9%80%89%E9%A1%B9">通用选项</a>节, 每个<code>pacman.conf</code>中的<code>[section]</code>都定义了一个使用的软件包仓库，<i>仓库</i>是多个软件包的<i>逻辑</i>上的集合，他们<i>物理</i>上存储在一个或多个服务器：这也是为什么每一个服务器都叫做这个仓库的<i>镜像</i>。
</p>
<p>仓库区分为<a href="../zh-CN/Official_repositories.html" title="Official repositories (简体中文)">官方仓库</a>与<a href="../zh-CN/Unofficial_user_repositories.html" title="Unofficial user repositories (简体中文)">非官方仓库</a>。配置文件中仓库的顺序十分重要；当几个仓库出现同名安装包，不管版本号如何，<i>pacman</i>将使用配置文件中排前的仓库。要在添加后使用某个仓库，你需要先<a href="#%E5%8D%87%E7%BA%A7%E8%BD%AF%E4%BB%B6%E5%8C%85">升级</a>整个系统
</p>
<p>每个仓库节都可以直接指定镜像列表或者<code>Include</code>引用其他的文件：例如，官方镜像引用了<code>/etc/pacman.d/mirrorlist/</code>。具体查看<a href="../zh-CN/Mirrors.html" title="Mirrors (简体中文)">Mirrors (简体中文)</a>。
</p>
<h3>
<span id=".E8.BD.AF.E4.BB.B6.E5.8C.85.E7.9A.84.E5.AE.89.E5.85.A8.E6.80.A7"></span><span class="mw-headline" id="软件包的安全性">软件包的安全性</span>
</h3>
<p><i>pacman</i> 支持软件包签名，会为软件包提供额外的安全性。默认配置，<code>SigLevel = Required DatabaseOptional</code> 将启用全局签名验证，但会被每个软件仓库的 <code>SigLevel</code> 行所覆盖。有关软件包签名和签名验证的更多细节，参见 <a href="../zh-CN/0306e39ac7285139de785bf9297b3d25.html" class="mw-redirect" title="Pacman-key (简体中文)">pacman-key</a>。
</p>
<h2>
<span id=".E7.96.91.E9.9A.BE.E8.A7.A3.E7.AD.94"></span><span class="mw-headline" id="疑难解答">疑难解答</span>
</h2>
<h3>
<span id=".22Failed_to_commit_transaction_.28conflicting_files.29.22_.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id='"Failed_to_commit_transaction_(conflicting_files)"_错误'>"Failed to commit transaction (conflicting files)" 错误</span>
</h3>
<p>如果碰到如下错误：<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=56373">[2]</a>
</p>
<pre>error: could not prepare transaction
error: failed to commit transaction (conflicting files)
package: <i>/path/to/file</i> exists in filesystem
Errors occurred, no packages were upgraded.
</pre>
<p>这是因为 <i>pacman</i> 检测到文件冲突，而且按照设计，<i>pacman</i> 不会覆盖文件。这是设计功能，不是缺陷。
</p>
<p>这个问题通常很容易解决。一个安全的方式是，首先检查是否有另一个软件包提供了这个文件 (<code>pacman -Qo <i>/path/to/file</i></code>)。如果文件被另一个软件包所有，请<a href="../zh-CN/Bug_reporting_guidelines.html" title="Bug reporting guidelines (简体中文)">报告问题</a>。如果不是其它软件包提供，将 'exists in filesystem' 的文件重命名并重新运行update命令。如果一切顺利，可以删掉这个文件。
</p>
<p>如果你手动安装了一个软件，没有通过<i>pacman</i>，例如用<code>make install</code>，你必须将软件连同它的全部文件一起移除/卸载。参见<a href="../en/Pacman/Tips_and_tricks.html#Identify_files_not_owned_by_any_package" title="Pacman/Tips and tricks">Pacman/Tips and tricks#Identify files not owned by any package</a>。
</p>
<p>每一个安装的软件包都会提供一个 <code>/var/lib/pacman/local/<i>$package-$version</i>/files</code> 文件，包含此软件包的元数据。如果文件损坏或者丢失，将会导致升级时出现<code>file exists in filesystem</code> 错误。此错误通常只会影响一个软件包，除了手动删除或移动所有的问题文件，你也可以显式地使用<code>pacman -S --overwrite <i>glob package</i></code>让 <i>pacman</i> 强制覆盖匹配<code><i>glob</i></code>的文件。
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 尽量避免使用<code>--overwrite</code>开关。参见<a href="../zh-CN/System_maintenance.html#%E9%81%BF%E5%85%8D%E6%9F%90%E4%BA%9B_Pacman_%E5%91%BD%E4%BB%A4" title="System maintenance (简体中文)">System maintenance (简体中文)#避免某些 Pacman 命令</a>
</div>
<h3>
<span id=".22Failed_to_commit_transaction_.28invalid_or_corrupted_package.29.22_.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id='"Failed_to_commit_transaction_(invalid_or_corrupted_package)"_错误'>"Failed to commit transaction (invalid or corrupted package)" 错误</span>
</h3>
<p>看看<code>/var/cache/pacman/pkg</code>中是否有<code>*.part</code>结尾的文件，它们是没有完全下载的文件，删除它们并重新执行更新。这些程序一般是自定义的<code>XferCommand</code> 下载命令造成的。
</p>
<pre># find /var/cache/pacman/pkg/ -iname "*.part" -delete
</pre>
<h3>
<span id=".22Failed_to_init_transaction_.28unable_to_lock_database.29.22_.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id='"Failed_to_init_transaction_(unable_to_lock_database)"_错误'>"Failed to init transaction (unable to lock database)" 错误</span>
</h3>
<p><i>pacman</i> 在改变软件包数据库前，比如安装软件包时，会创建一个文件锁 <code>/var/lib/pacman/db.lck</code>。这会阻止其他 <i>pacman</i> 实例在同一时间修改软件包数据库。
</p>
<p>如果 <i>pacman</i> 在更新数据库时被打断，旧锁可能保留下来。如果确认没有 <i>pacman</i> 实例在运行，那么删掉文件锁：
</p>
<pre># rm /var/lib/pacman/db.lck
</pre>
<h3>
<span id=".E5.AE.89.E8.A3.85.E6.97.B6.E6.97.A0.E6.B3.95.E8.8E.B7.E5.8F.96.E8.BD.AF.E4.BB.B6.E5.8C.85"></span><span class="mw-headline" id="安装时无法获取软件包">安装时无法获取软件包</span>
</h3>
<p>错误内容包含：<code>Not found in sync db</code>, <code>Target not found</code> 或 <code>Failed retrieving file</code>.
</p>
<p>首先确认软件包确实存在（并注意错别字）。如果确认软件包存在，可能本地数据库过时了或者软件仓库没有配置好，试试 <code>pacman -Syyu</code> 强制数据库更新和升级。
</p>
<p>也有可能包含该软件包的软件仓库没有启动。例如，该软件包可能在 <i>multilib</i> 仓库里，但该仓库没有在 <i>pacman.conf</i> 中启用。
</p>
<p>参阅<a href="../en/Frequently_asked_questions.html#Why_is_there_only_a_single_version_of_each_shared_library_in_the_official_repositories?" class="mw-redirect" title="FAQ">FAQ#Why is there only a single version of each shared library in the official repositories?</a>.
</p>
<h3>
<span id="pacman_.E6.9B.B4.E6.96.B0.E6.97.B6.E5.B4.A9.E6.BA.83"></span><span class="mw-headline" id="pacman_更新时崩溃">pacman 更新时崩溃</span>
</h3>
<p>如果 <i>pacman</i> 在删除、重新安装或更新软件包时 "数据库写入" 出错：
</p>
<ol>
<li>从 Arch 安装媒体启动，最好用最新的安装媒体</li>
<li>挂载根文件系统，例如以 root 身份<code>mount /dev/sdaX /mnt</code>，通过 <code>df -h</code> 确认根文件目录包含足够的空间</li>
<li>同样挂载 proc, sys 和 dev 文件系统：<code>mount -t proc proc /mnt/proc; mount --rbind /sys /mnt/sys; mount --rbind /dev /mnt/dev</code>
</li>
<li>如果系统使用默认的数据库目录位置，可以通过 root 用户执行下面命令<code>pacman --sysroot /mnt -Syu</code>来更新系统的 <i>pacman</i> 数据库。</li>
<li>更新之后，可以通过下面命令确认是否还存在损坏的包：<code>find /mnt/usr/lib -size 0</code>
</li>
<li>通过<code>pacman --sysroot /mnt -S <i>package</i></code>重新安装依然损坏的软件包</li>
</ol>
<h3>
<span id=".E6.89.8B.E5.8A.A8.E9.87.8D.E6.96.B0.E5.AE.89.E8.A3.85_pacman"></span><span class="mw-headline" id="手动重新安装_pacman">手动重新安装 pacman</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>警告：</strong> 这种方式极其容易破坏你的系统，把它变得更糟。这个方式只是作为最后的措施，以防万一<a href="#pacman_%E6%9B%B4%E6%96%B0%E6%97%B6%E5%B4%A9%E6%BA%83">#pacman 更新时崩溃</a>不起作用</div>
<p>即使 <i>pacman</i> 严重损坏，你仍可以手动修复它，这需要下载最新的包并把它们解压到正确的目录。大致步骤如下：
</p>
<ol>
<li>确定要安装的<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>依赖项</li>
<li>从你选择的<a href="../en/Mirrors.html" class="mw-redirect" title="Mirror">mirror</a>下载每个包</li>
<li>把每个包解压到 root</li>
<li>使用<code>pacman -S --overwrite</code>重新安装这些包来更新相应的软件包数据库</li>
<li>进行完整系统更新</li>
</ol>
<p>如果你拥有一个健康的 Arch 系统，你可以这样查看依赖项的完整列表：
</p>
<pre>$ pacman -Q $(pactree -u pacman)
</pre>
<p>但是依据你遇到的问题，你可能只需要更新其中的几个。解压一个包的示例是：
</p>
<pre># tar -xvpwf <i>package.tar.xz</i> -C / --exclude .PKGINFO --exclude .INSTALL --exclude .MTREE --exclude .BUILDINFO
</pre>
<p>注意<code>w</code>参数表示交互模式。以非交互方式运行是非常冒险的，因为你可能就此覆盖了一个重要文件。你也要注意以正确的顺序解压软件包（例如先解压依赖）。
<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=95007">这个帖子</a>包含了一些这个过程的例子，这些例子中只有少量<i>pacman</i>依赖项损坏。
</p>
<h3>
<span id=".E5.8D.87.E7.BA.A7.E7.B3.BB.E7.BB.9F.E9.87.8D.E5.90.AF.E5.90.8E.EF.BC.8C.E5.87.BA.E7.8E.B0.22unable_to_find_root_device.22.E9.94.99.E8.AF.AF.EF.BC.8C.E6.97.A0.E6.B3.95.E7.99.BB.E9.99.86"></span><span class="mw-headline" id='升级系统重启后，出现"unable_to_find_root_device"错误，无法登陆'>升级系统重启后，出现"unable to find root device"错误，无法登陆</span>
</h3>
<p>很有可能 <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> 在<a href="../zh-CN/Kernel.html" title="Kernel (简体中文)">内核</a>升级时损坏（例如由错误地使用 <i>pacman</i> 的 <code>--overwrite</code> 选项导致）。有两个选择；首先尝试 <i>Fallback</i>启动项。
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>提示：</strong> 万一你删除了 <i>Fallback</i> 启动项，你总可以在启动加载器菜单显示出来的时候按<code>Tab</code>键（对于 Syslinux）或者按<code>e</code>键（对于 GRUB 或者 systemd-boot），将它重命名为<code>initramfs-linux-fallback.img</code>然后按<code>Enter</code>或者<code>b</code>（取决于你的<a href="../zh-CN/Arch_boot_process.html#%E5%90%AF%E5%8A%A8%E5%8A%A0%E8%BD%BD%E5%99%A8" class="mw-redirect" title="启动加载器">启动加载器</a>以新参数启动的方式）</div>
<p>一旦系统启动，从控制台或终端（为备用<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>内核）运行这条命令来重建 initramfs 映像：
</p>
<pre># mkinitcpio -p linux
</pre>
<p>如果上面方法不行，从一个当前的 Arch 发行（CD/DVD 或者 U盘），<a href="../zh-CN/File_systems.html#%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" class="mw-redirect" title="挂载">挂载</a>你的根目录和启动分区，然后用 <i>arch-chroot</i> <a href="../en/Chroot.html" title="Chroot">chroot</a>
</p>
<pre># arch-chroot /mnt
# pacman -Syu mkinitcpio systemd linux
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 
<ul>
<li>如果你没有一个当前的发行或者你只有某些其他的 "live" Linux 发行版，你可以用老式的方法<a href="../en/Chroot.html" title="Chroot">chroot</a>。显然，这种方式比简单地运行<code>arch-chroot</code>脚本需要更多的输入</li>
<li>如果 <i>pacman</i> 伴随<code>Could not resolve host</code>运行失败，请<a href="../zh-CN/Network_configuration.html#%E6%A3%80%E6%9F%A5%E8%BF%9E%E6%8E%A5" title="Network configuration (简体中文)">检查你的网络连接</a>
</li>
<li>如果无法进入 arch-chroot 或 chroot 环境，但是需要重新安装软件包，可以使用 <code>pacman --sysroot /mnt -Syu foo bar</code> 从而在你的根分区下使用 <i>pacman</i> </li>
</ul>
</div>
<p>重新安装内核(<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> 软件包)将会自动运行 <code>mkinitcpio -p linux</code> 重新生成 initramfs 镜像，不需要单独生成。
</p>
<p>之后建议执行 <code>exit</code>, <code>umount /mnt/{boot,} </code> 然后 <code>reboot</code>.
</p>
<h3>
<span id="Signature_from_.22User_.3Cemail.40gmail.com.3E.22_is_unknown_trust.2C_installation_failed"></span><span class="mw-headline" id='Signature_from_"User_&lt;email@gmail.com&gt;"_is_unknown_trust,_installation_failed'>Signature from "User &lt;email@gmail.com&gt;" is unknown trust, installation failed</span>
</h3>
<p>试试以下途径：
</p>
<ul>
<li>更新已知密钥：<code>pacman-key --refresh-keys</code>;</li>
<li>手动升级<code>archlinux-keyring</code>软件包：<code>pacman -Sy archlinux-keyring &amp;&amp; pacman -Su</code>.</li>
<li>查看<a href="../en/Pacman/Package_signing.html#Resetting_all_the_keys" class="mw-redirect" title="Pacman-key">pacman-key#Resetting all the keys</a>.</li>
</ul>
<h3>
<span id=".E8.AF.B7.E6.B1.82.E5.AF.BC.E5.85.A5_PGP_keys"></span><span class="mw-headline" id="请求导入_PGP_keys">请求导入 PGP keys</span>
</h3>
<p>如果用过时的 ISO <a href="../zh-CN/Installation_guide.html" title="Installation guide (简体中文)">安装</a> Arch，你很有可能被提示要导入 PGP keys。同意下载密钥来继续。如果你无法成功添加 PGP keys，更新或升级 keyring <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archlinux-keyring">archlinux-keyring</a></span> (浏览 <a href="#Signature_from_%22User_&lt;email@gmail.com&gt;%22_is_unknown_trust,_installation_failed">above</a>).
</p>
<h3>
<span id="Error:_key_.220123456789ABCDEF.22_could_not_be_looked_up_remotely"></span><span class="mw-headline" id='Error:_key_"0123456789ABCDEF"_could_not_be_looked_up_remotely'>Error: key "0123456789ABCDEF" could not be looked up remotely</span>
</h3>
<p>如果软件包使用了新的密钥，且该密钥最近才被添加到 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archlinux-keyring">archlinux-keyring</a></span>，那么这些密钥在更新过程中不可用于本地（先有鸡还是先有蛋的问题）。安装的 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archlinux-keyring">archlinux-keyring</a></span> 不会包含这个密钥直到它被更新。Pacman 试图通过一个密钥服务器查询来绕过这个问题，这可能并不能完成（例如在代理或者防火墙后，导致上述错误）。先按照<a href="#Signature_from_%22User_&lt;email@example.org&gt;%22_is_unknown_trust,_installation_failed">#Signature from "User &lt;email@example.org&gt;" is unknown trust, installation failed</a> 所述更新 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archlinux-keyring">archlinux-keyring</a></span>
</p>
<h3>
<span id=".E4.B8.8D.E5.81.9C.E7.9C.8B.E5.88.B0.E9.94.99.E8.AF.AF_.22PackageName:_signature_from_.22User_.3Cemail.40archlinux.org.3E.22_is_invalid.22"></span><span class="mw-headline" id='不停看到错误_"PackageName:_signature_from_"User_&lt;email@archlinux.org&gt;"_is_invalid"'>不停看到错误 "PackageName: signature from "User &lt;email@archlinux.org&gt;" is invalid"</span>
</h3>
<p>当系统时间错误时，签名密钥将会被认为过期（或无效）并且签名检查将会失败，提示以下错误信息：
</p>
<pre>error: PackageName: signature from "User &lt;email@archlinux.org&gt;" is invalid
error: failed to commit transaction (invalid or corrupted package (PGP signature))
Errors occured, no packages were upgraded. 
</pre>
<p>确保矫正<a href="../zh-CN/System_time.html" title="System time (简体中文)">系统时间</a>，例如在安装或升级前从 root 执行 <code>ntpd -qg</code> ，和 <code>hwclock -w</code>。
</p>
<h3>
<span id=".27warning:_current_locale_is_invalid.3B_using_default_.22C.22_locale.27_.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id="'warning:_current_locale_is_invalid;_using_default_&quot;C&quot;_locale'_错误">'warning: current locale is invalid; using default "C" locale' 错误</span>
</h3>
<p>错误信息已经很明确了，locale 设置不正确，请阅读<a href="../en/Locale.html" title="Locale">Locale</a>进行设置。
</p>
<h3>
<span id="Pacman_.E4.B8.8D.E4.BD.BF.E7.94.A8.E6.88.91.E7.9A.84.E4.BB.A3.E7.90.86.E8.AE.BE.E7.BD.AE"></span><span class="mw-headline" id="Pacman_不使用我的代理设置">Pacman 不使用我的代理设置</span>
</h3>
<p>正确设置环境变量（<code>$http_proxy</code>, <code>$ftp_proxy</code> 等）如果使用 <a href="../en/Sudo.html" title="Sudo">sudo</a>，需要让 sudo <a href="../en/Sudo.html#Environment_variables" title="Sudo">将这些变量传递给 pacman</a>.
</p>
<h3>
<span id=".E5.A6.82.E4.BD.95.E9.87.8D.E8.A3.85.E6.89.80.E6.9C.89.E5.8C.85.E5.B9.B6.E4.BF.9D.E7.95.99.E5.AE.89.E8.A3.85.E5.92.8C.E4.BE.9D.E8.B5.96.E4.BF.A1.E6.81.AF.EF.BC.9F"></span><span class="mw-headline" id="如何重装所有包并保留安装和依赖信息？">如何重装所有包并保留安装和依赖信息？</span>
</h3>
<p>重装所有软件包：<code>pacman -S $(pacman -Qnq)</code>（<code>-S</code> 选项会保留安装缘由）。
</p>
<p>接着需要重装外来包（不在官方仓库里的软件包）。外来包可通过<code>pacman -Qmq</code>查看。
</p>
<h3>
<span id=".22Cannot_open_shared_object_file.22_.E9.94.99.E8.AF.AF"></span><span class="mw-headline" id='"Cannot_open_shared_object_file"_错误'>"Cannot open shared object file" 错误</span>
</h3>
<p>有可能是前一次 <i>pacman</i> 事务中删除或者损坏了 pacman 自身需要的一些共享库。
</p>
<p>要修复这种情况，你需要手动解压那些共享库文件到文件系统中合适的地方。首先请查明哪个包中包含有所需的库文件，然后在 <i>pacman</i> 缓存中 (<code>/var/cache/pacman/pkg/</code>) 找到对应的包。解压出需要的库文件到文件系统的对应位置，如此可以继续使用 <i>pacman</i> 。
</p>
<p>之后需要重新安装损坏的软件包。注意你可能需要使用 <code>--overwrite</code> 选项覆盖掉你刚刚解压出的系统文件，因为 <i>pacman</i> 可能没有跟踪到对应的文件信息。  <i>pacman</i> 随后会使用包中的文件正确替换掉共享库文件。如此能修好您的 pacman ，然后请继续更新系统中剩下的软件包。
</p>
<h3>
<span id=".E8.BD.AF.E4.BB.B6.E5.8C.85.E4.B8.8B.E8.BD.BD.E5.81.9C.E6.BB.9E"></span><span class="mw-headline" id="软件包下载停滞">软件包下载停滞</span>
</h3>
<p>Some issues have been reported regarding network problems that prevent <i>pacman</i> from updating/synchronizing repositories. <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=68944">[3]</a> <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=65728">[4]</a> When installing Arch Linux natively, these issues have been resolved by replacing the default <i>pacman</i> file downloader with an alternative (see <a href="../en/Pacman/Tips_and_tricks.html#Performance" class="mw-redirect" title="Improve pacman performance">Improve pacman performance</a> for more details). When installing Arch Linux as a guest OS in <a href="../en/VirtualBox.html" title="VirtualBox">VirtualBox</a>, this issue has also been addressed by using <i>Host interface</i> instead of <i>NAT</i> in the machine properties.
</p>
<h3>
<span id=".E6.97.A0.E6.B3.95.E4.BB.8E.E9.95.9C.E5.83.8F.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.8E.B7.E5.8F.96_.27core.db.27"></span><span class="mw-headline" id="无法从镜像服务器获取_'core.db'">无法从镜像服务器获取 'core.db'</span>
</h3>
<p>如果从正确的<a href="../en/Mirrors.html" title="Mirrors">镜像服务器</a>收到此错误，请换一个<a href="../en/Domain_name_resolution.html" class="mw-redirect" title="Resolv.conf">域名解析服务器</a>。
</p>
<h3>
<span id="error:_.27local-package.pkg.tar.27:_permission_denied"></span><span class="mw-headline" id="error:_'local-package.pkg.tar':_permission_denied">error: 'local-package.pkg.tar': permission denied</span>
</h3>
<p>如果你想要在一个 sshfs 上使用<code>pacman -U</code>安装软件包并遇到了这个错误，将包移动到本地目录，再试一次。
</p>
<h2>
<span id=".E5.8F.A6.E8.AF.B7.E5.8F.82.E8.A7.81"></span><span class="mw-headline" id="另请参见">另请参见</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/">Pacman Home Page</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 3 libalpm"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/libalpm.3">libalpm(3)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 pacman"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pacman.8">pacman(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 pacman.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pacman.conf.5">pacman.conf(5)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 repo-add"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/repo-add.8">repo-add(8)</a></span></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../zh-CN/Category:Package_management.html" title="Category:Package management (简体中文)">Package management (简体中文)</a></li>
<li><a href="../zh-CN/Category:Arch_projects.html" title="Category:Arch projects (简体中文)">Arch projects (简体中文)</a></li>
<li><a href="../zh-CN/Category:Commands.html" title="Category:Commands (简体中文)">Commands (简体中文)</a></li>
</ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Pacman_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=647160">https://wiki.archlinux.org/index.php?title=Pacman_(简体中文)&amp;oldid=647160</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 13:54.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
