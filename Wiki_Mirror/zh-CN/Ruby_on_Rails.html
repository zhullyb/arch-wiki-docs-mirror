<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Ruby on Rails (简体中文) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Ruby_on_Rails_简体中文 rootpage-Ruby_on_Rails_简体中文 skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Ruby on Rails (简体中文)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><a rel="nofollow" class="external text" href="http://rubyonrails.org/">Ruby on Rails</a>，通常简写为 Rails 或者 RoR，是一个 Ruby 语言的开源的 web 应用框架。它通常被 web 开发人员使用敏捷开发方法做快速开发使用。
</p>
<p>本文档描述如何在Archlinux下建立Ruby on Rails开发环境。
</p>
<p>Ruby on Rails 需要首先安装 <a href="../en/Ruby.html" title="Ruby">Ruby</a>，所以阅读首先阅读那篇文章查看安装说明。
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#%E9%80%89%E9%A1%B9A%EF%BC%9A%E9%80%9A%E8%BF%87RubyGems%E6%9D%A5%E5%AE%89%E8%A3%85_(%E6%8E%A8%E8%8D%90)"><span class="tocnumber">1</span> <span class="toctext">选项A：通过RubyGems来安装 (推荐)</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#%E6%9B%B4%E6%96%B0gems"><span class="tocnumber">1.1</span> <span class="toctext">更新gems</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#%E9%80%89%E9%A1%B9B%EF%BC%9A%E9%80%9A%E8%BF%87_AUR_%E5%AE%89%E8%A3%85"><span class="tocnumber">2</span> <span class="toctext">选项B：通过 AUR 安装</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#%E9%85%8D%E7%BD%AE"><span class="tocnumber">3</span> <span class="toctext">配置</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Web_%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="tocnumber">4</span> <span class="toctext">Web 服务器</span></a></li>
<li class="toclevel-1 tocsection-6">
<a href="#Mongrel"><span class="tocnumber">5</span> <span class="toctext">Mongrel</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Apache/Nginx_(using_Phusion_Passenger)"><span class="tocnumber">5.1</span> <span class="toctext">Apache/Nginx (using Phusion Passenger)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8">
<a href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="tocnumber">6</span> <span class="toctext">数据库</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#SQLite"><span class="tocnumber">6.1</span> <span class="toctext">SQLite</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#PostgreSQL"><span class="tocnumber">6.2</span> <span class="toctext">PostgreSQL</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#MySQL"><span class="tocnumber">6.3</span> <span class="toctext">MySQL</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12">
<a href="#%E9%80%89%E9%A1%B9C%EF%BC%9A%E5%AE%8C%E7%BE%8E%E7%9A%84_Rails_%E5%AE%89%E8%A3%85"><span class="tocnumber">7</span> <span class="toctext">选项C：完美的 Rails 安装</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#%E6%AD%A5%E9%AA%A4_0:_SQLite"><span class="tocnumber">7.1</span> <span class="toctext">步骤 0: SQLite</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#%E6%AD%A5%E9%AA%A4_1:_RVM"><span class="tocnumber">7.2</span> <span class="toctext">步骤 1: RVM</span></a></li>
<li class="toclevel-2 tocsection-15">
<a href="#%E6%AD%A5%E9%AA%A4_2:_Rubies"><span class="tocnumber">7.3</span> <span class="toctext">步骤 2: Rubies</span></a>
<ul>
<li class="toclevel-3 tocsection-16"><a href="#Advice"><span class="tocnumber">7.3.1</span> <span class="toctext">Advice</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="#%E6%AD%A5%E9%AA%A4_3:_Nginx_with_Passenger_support"><span class="tocnumber">7.4</span> <span class="toctext">步骤 3: Nginx with Passenger support</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#%E6%AD%A5%E9%AA%A4_4:_Gemsets_and_Apps"><span class="tocnumber">7.5</span> <span class="toctext">步骤 4: Gemsets and Apps</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Passenger_for_Nginx_and_Passenger_Standalone"><span class="tocnumber">7.6</span> <span class="toctext">Passenger for Nginx and Passenger Standalone</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#%E6%AD%A5%E9%AA%A4_5:_.rvmrc_%E6%96%87%E4%BB%B6%E5%92%8C%E6%89%80%E6%9C%89%E8%80%85"><span class="tocnumber">7.7</span> <span class="toctext">步骤 5: .rvmrc 文件和所有者</span></a></li>
<li class="toclevel-2 tocsection-21">
<a href="#%E6%AD%A5%E9%AA%A4_6:_%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="tocnumber">7.8</span> <span class="toctext">步骤 6: 反向代理</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#Launch_Passenger_Standalone_daemons_at_system_start-up"><span class="tocnumber">7.8.1</span> <span class="toctext">Launch Passenger Standalone daemons at system start-up</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="#%E6%AD%A5%E9%AA%A4_7:_%E9%83%A8%E7%BD%B2"><span class="tocnumber">7.9</span> <span class="toctext">步骤 7: 部署</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="tocnumber">7.10</span> <span class="toctext">参考文献</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25"><a href="#%E5%8F%82%E8%A7%81"><span class="tocnumber">8</span> <span class="toctext">参见</span></a></li>
<li class="toclevel-1 tocsection-26"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE_2"><span class="tocnumber">9</span> <span class="toctext">参考文献</span></a></li>
</ul>
</div>

<h2>
<span id=".E9.80.89.E9.A1.B9A.EF.BC.9A.E9.80.9A.E8.BF.87RubyGems.E6.9D.A5.E5.AE.89.E8.A3.85_.28.E6.8E.A8.E8.8D.90.29"></span><span class="mw-headline" id="选项A：通过RubyGems来安装_(推荐)">选项A：通过RubyGems来安装 (推荐)</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果这个命令不是用root运行的，那么gem会把它安装到用户的家目录中。</div>
<pre># gem install rails
</pre>
<p>创建文档需要一会时间. 如果不想要它,加上 --no-ri --no-rdoc 参数到安装命令中.
</p>
<pre># gem install rails --no-ri --no-rdoc
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 如果安装完成后提示警告在PATH中没有~/.gem/ruby/2.0.0/bin,gem executables will not run，那么要使用命令export PATH="$PATH:$(ruby -rubygems -e 'puts Gem.user_dir')/bin"将rails加入环境变量，最后可以通过命令rails -v查看安装的rails版本确认rails可用。</div>
<h3>
<span id=".E6.9B.B4.E6.96.B0gems"></span><span class="mw-headline" id="更新gems">更新gems</span>
</h3>
<p>gem 是一个ruby模块包管理器, 类似pacman. 去更新gem, 简单的使用gem命令:
</p>
<pre># gem update
</pre>
<h2>
<span id=".E9.80.89.E9.A1.B9B.EF.BC.9A.E9.80.9A.E8.BF.87_AUR_.E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="选项B：通过_AUR_安装">选项B：通过 AUR 安装</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This is not recommended, as this might not include the latest Rails version, and additional dependencies may be introduced that may require you to run <code>gem install</code> anyway.</div>
<p>There is a <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/rails/">rails</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">断开的链接</a>：package not found]</sup> package available in the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>. Note that this is not in an <a href="../en/Official_repositories.html" title="Official repositories">official repository</a>, so you will need to <a href="../en/Arch_User_Repository.html#Build_the_package" class="mw-redirect" title="AUR">build it manually</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup>.
</p>
<h2>
<span id=".E9.85.8D.E7.BD.AE"></span><span class="mw-headline" id="配置">配置</span>
</h2>
<p>Rails 自带了一个基本的HTTP服务器 WeBrick. 你可以创建一个测试应用来测试它. 首先, 创建一个应用使用rails 命令:
</p>
<pre># rails new testapp_name
</pre>
<p>然后开始Web服务器. 它默认监听3000端口 :
</p>
<pre># cd testapp_name
# rails server 
</pre>
<p>完成后打开浏览器输入你服务器地址和3000端口. 例如, 如果服务器在本机 :
</p>
<pre>在浏览器地址栏输入http://127.0.0.1:3000/ 
</pre>
<p>你将看到Rails默认欢迎界面 "Welcome aboard".
</p>
<h2>
<span id="Web_.E6.9C.8D.E5.8A.A1.E5.99.A8"></span><span class="mw-headline" id="Web_服务器">Web 服务器</span>
</h2>
<p>Ruby On Rails 默认HTTP 服务器(WeBrick) 可以方便去测试，但是不推荐在产品中使用。以下是一些合适的选择：
</p>
<h2><span class="mw-headline" id="Mongrel">Mongrel</span></h2>
<p>Mongrel is a drop-in replacement for WeBrick, that can be run in precisely the same way, but offers better performance. 
</p>
<p>通过gem来安装mongrel:
</p>
<pre># gem install mongrel
</pre>
<p>然后开始mongrel:
</p>
<pre># mongrel_rails start
</pre>
<p>Alternatively, you can just run "ruby script/server" again, as it replaces WeBrick by default.
</p>
<p>Generally, Mongrel is used in a production environment by running multiple instances of mongrel_rails, which are load-balanced behind an <a href="../en/Nginx.html" title="Nginx">Nginx</a> or <a href="../en/Category:Apache.html" class="mw-redirect" title="Apache">Apache</a> reverse proxy. However, you might find Phusion Passenger (see below) a much simpler solution for running a production environment.
</p>
<h3>
<span id="Apache.2FNginx_.28using_Phusion_Passenger.29"></span><span class="mw-headline" id="Apache/Nginx_(using_Phusion_Passenger)">Apache/Nginx (using Phusion Passenger)</span>
</h3>
<p><a rel="nofollow" class="external text" href="http://www.modrails.com/">Passenger</a> also known as <code>mod_rails</code> is a module available for <a href="../en/Nginx.html" title="Nginx">Nginx</a> and <a href="../en/Category:Apache.html" class="mw-redirect" title="Apache">Apache</a>, that greatly simplifies setting up a Rails server environment.
</p>
<p>Start by installing the Passenger gem:
</p>
<pre># gem install passenger
</pre>
<p>If you are aiming to use <a href="../en/Category:Apache.html" class="mw-redirect" title="Apache">Apache</a> with Passenger, run:
</p>
<pre># passenger-install-apache2-module
</pre>
<p>For <a href="../en/Nginx.html" title="Nginx">Nginx</a>:
</p>
<pre># passenger-install-nginx-module
</pre>
<p>The installer will provide you with any additional information regarding the installation (such as installing additional libraries).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="../en/Nginx.html#Ruby_Integration_(Ruby_on_Rails_and_Rack-based)" title="Nginx">Nginx#Ruby Integration (Ruby on Rails and Rack-based)</a><sup>[<a href="../en/ArchWiki:Requests.html#Broken_section_links" class="mw-redirect" title="ArchWiki:Requests">断开的链接</a>：无效的部分]</sup> for more information on configuring a Rails Nginx-Passenger web stack.</div>
<h2>
<span id=".E6.95.B0.E6.8D.AE.E5.BA.93"></span><span class="mw-headline" id="数据库">数据库</span>
</h2>
<p>多数Web应用都需要数据库去保存数据。ActiveRecord (the ORM used by Rails to provide database abstraction) supports several database vendors, the most popular of which are MySQL, SQLite, and PostgreSQL.
</p>
<h3><span class="mw-headline" id="SQLite">SQLite</span></h3>
<p>SQLite 是Ruby on Rails默认的数据库. 要去激活 SQLite, 安装ruby-sqlite3
</p>
<pre># pacman -S ruby-sqlite3
</pre>
<h3><span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h3>
<p>（待补充）
安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span>.
</p>
<h3><span class="mw-headline" id="MySQL">MySQL</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>注意：</strong> 在尝试安装 Ruby MySQL 扩展之前，你必须首先安装带有合适头文件(位于<code>/usr/include</code>) 的 <a href="../en/MySQL.html" title="MySQL">MySQL</a>(只需要安装 <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mysql/">mysql</a></span><sup><small>AUR</small></sup> 就可以了)。</div>
<p>关于如何安装 MySQL 服务器请参考 <a href="../en/MySQL.html" title="MySQL">MySQL</a>。
</p>
<p>首先安装通过gem安装mysql模块:
</p>
<pre># gem install mysql
</pre>
<p>你可以创建使用mysql的Rails应用使用 <code>-d</code> 参数:
</p>
<pre>$ rails new testapp_name -d mysql
</pre>
<p>然后你需要编辑 config/database.yml. Rails 为production/tests/development使用3种数据库。下面示例使用development数据库. 填写数据库，用户名，密码字段：
</p>
<pre> development:
   adapter: mysql
   database: my_application_database
   username: development
   password: my_secret_password
</pre>
<p>Note that you do not have to actually create the database using MySQL, as this can be done via Rails with:
</p>
<pre># rake db:migrate
</pre>
<p>如果没有错误显示, 那么表示建立正确，并且Rails可以和MySQL数据库通信了。
</p>
<h2>
<span id=".E9.80.89.E9.A1.B9C.EF.BC.9A.E5.AE.8C.E7.BE.8E.E7.9A.84_Rails_.E5.AE.89.E8.A3.85"></span><span class="mw-headline" id="选项C：完美的_Rails_安装">选项C：完美的 Rails 安装</span>
</h2>
<p><i>Phusion Passenger running multiple Ruby versions.</i>
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://archlinux.org/">Archlinux</a>: A simple, lightweight distribution. ;)</li>
<li>
<a rel="nofollow" class="external text" href="http://www.nginx.org/">Nginx</a>: A fast and lightweight <b>web server</b> with a strong focus on high concurrency, performance and low memory usage.</li>
<li>
<a rel="nofollow" class="external text" href="http://www.modrails.com/">Passenger</a> (a.k.a. mod_rails or mod_rack): Supports both Apache and Nginx web servers. It makes deployment of Ruby web applications, such as those built on Ruby on Rails web framework, a breeze.</li>
<li>
<a rel="nofollow" class="external text" href="http://www.rubyenterpriseedition.com/">Ruby Enterprise Edition</a> (REE): Passenger allows Ruby on Rails applications to use about 33% less memory, when used in combination with REE.</li>
<li>
<a rel="nofollow" class="external text" href="http://rvm.beginrescueend.com/">Ruby Version Manager</a> (RVM): A command-line tool which allows you to easily install, manage, and work with multiple Ruby environments from interpreters to sets of gems. RVM lets you deploy each project with its own completely self-contained and dedicated environment —from the specific version of ruby, all the way down to the precise set of required gems to run your application—.</li>
<li>
<a rel="nofollow" class="external text" href="http://sqlite.org/">SQLite</a>: The default lightweight <b>database</b> for Ruby on Rails.</li>
</ul>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_0:_SQLite"></span><span class="mw-headline" id="步骤_0:_SQLite">步骤 0: SQLite</span>
</h3>
<p>Easy as:
</p>
<pre>$ sudo pacman -S sqlite
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Of course SQLite is not critical in this setup, you can use MySQL and PostgreSQL as well.</div>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_1:_RVM"></span><span class="mw-headline" id="步骤_1:_RVM">步骤 1: RVM</span>
</h3>
<p>Make a multi-user <a href="../en/RVM.html" title="RVM">RVM</a> installation as specified <a href="../en/RVM.html#Multi-user_installation" title="RVM">here</a>.
</p>
<p>In the 'adding users to the rvm group' step, do
</p>
<pre>$ sudo usermod -a -G rvm http
$ sudo usermod -a -G rvm nobody
</pre>
<p>. http and nobody are the users related to Nginx and Passenger, respectively.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Maybe adding the 'nodody' user to the 'rvm' group is not necessary.</div> 
<h3>
<span id=".E6.AD.A5.E9.AA.A4_2:_Rubies"></span><span class="mw-headline" id="步骤_2:_Rubies">步骤 2: Rubies</span>
</h3>
<p>Once you have a working RVM installation in your hands, it is time to install the Ruby Enterprise Edition interpreter
</p>
<pre>$ rvm install ree
</pre>
<p>. Also take the chance to include other interpreters you want to use, like the last Ruby version
</p>
<pre>$ rvm install 1.9.3
</pre>
<h4><span class="mw-headline" id="Advice">Advice</span></h4>
<p>I have found useful to delete the 'global' gemsets of the environments that have web applications. Their gems were somehow interfering with Passenger. Do not do
</p>
<pre>$ rvm ree do gemset delete global
$ rvm 1.9.3 do gemset delete global
</pre>
<p>now, but consider this later if you encounter complications.
</p>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_3:_Nginx_with_Passenger_support"></span><span class="mw-headline" id="步骤_3:_Nginx_with_Passenger_support">步骤 3: Nginx with Passenger support</span>
</h3>
<p>Do not install Nginx via pacman. This web server does not support modules as Apache, so it must be compiled from source with the functionality of <i>mod_rails</i> (Passenger). Fortunately this is straightforward thanks to the passenger gem. Get it:
</p>
<pre>$ rvm use ree
$ gem install passenger
</pre>
<p>. The gem will be put into the 'default' gemset. Now execute the following script:
</p>
<pre>$ rvmsudo passenger-install-nginx-module
</pre>
<p>. It will download the sources of Nginx, compile and install it for you. It will guide you through all the process. (The default location for Nginx is /opt/nginx.)
</p>
<p>After completion, the script will require you to add two lines into the 'http block' at /opt/nginx/conf/nginx.conf that look like:
</p>
<pre>http { 
  ...
  passenger_root /usr/local/rvm/gems/ree-1.8.7-2011.03/gems/passenger-3.0.9;
  passenger_ruby /usr/local/rvm/wrappers/ree-1.8.7-2011.03/ruby;
  ...
}
</pre>
<p>For everything that is not Ruby, use <a href="../en/Nginx.html" title="Nginx">Nginx</a> as usual to serve static pages, PHP and Python. Check the wiki page for more information.
</p>
<p>To enable the Nnginx service by default at start-up just add <code>nginx</code> to the <code>DAEMONS</code> array in <code>/etc/rc.conf</code>:
</p>
<pre>DAEMONS=(ntpd syslog-ng ... nginx)
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is possible that your Nginx installation has not come with an init script; check your /etc/rc.d/ directory for a file called <i>nginx</i>, if that is your case manually create it.</div>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_4:_Gemsets_and_Apps"></span><span class="mw-headline" id="步骤_4:_Gemsets_and_Apps">步骤 4: Gemsets and Apps</span>
</h3>
<p>For each Rails application you should have a gemset. Suppose that you want to try <a rel="nofollow" class="external text" href="http://refinerycms.com">RefineryCMS</a> against <a rel="nofollow" class="external text" href="http://www.browsercms.org">BrowserCMS</a>, two open-source Content Management Systems based on Rails. Then you should do:
</p>
<pre>$ rvm use ree@refinery --create
$ gem install rails -v 3.0.11
$ gem install passenger
$ gem install refinerycms refinerycms-i18n sqlite3
</pre>
<p>Deploy a RefineryCMS instance called <i>refineria</i>:
</p>
<pre>$ cd /srv/http/
$ rvmsudo refinerycms refineria
</pre>
<p>Again:
</p>
<pre>$ rvm use 1.9.3@browser --create
$ gem install passenger
$ gem install browsercms sqlite3
</pre>
<p>Deploy a BrowserCMS instance called <i>navegador</i>:
</p>
<pre>$ cd /srv/http/
$ rvmsudo browsercms demo navegador
$ cd /srv/http/navegador
$ rvmsudo rake db:install
</pre>
<h3><span class="mw-headline" id="Passenger_for_Nginx_and_Passenger_Standalone">Passenger for Nginx and Passenger Standalone</span></h3>
<p>Observe that the passenger gem was installed three times and with different intentions; in the environments
</p>
<ul>
<li>
<i>ree</i> =&gt; for Nginx,</li>
<li>
<i>ree@refinery</i> =&gt; Standalone, and</li>
<li>
<i>1.9.3@browser</i> =&gt; Standalone.</li>
</ul>
<p>The strategy is to combine Passenger for Nginx with Passenger Standalone. One must first identify the Ruby environment (interpreter plus gemset) that one uses the most; in this setup the REE interpreter and the default gemset were selected. One then proceeds with setting up Passenger for Nginx to use that environment. All applications that are to use a different Ruby version and/or gemset can be served separately through Passenger Standalone and hook into the main web server via a reverse proxy configuration.
</p>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_5:_.rvmrc_.E6.96.87.E4.BB.B6.E5.92.8C.E6.89.80.E6.9C.89.E8.80.85"></span><span class="mw-headline" id="步骤_5:_.rvmrc_文件和所有者">步骤 5: .rvmrc 文件和所有者</span>
</h3>
<p>This step is crucial for the correct behaviour of the setup. RVM seeks for .rvmrc files when changing folders; if it finds one, it reads it. In these files normally one stores a line like
</p>
<pre>rvm &lt;ruby_version&gt;@&lt;gemset_name&gt;
</pre>
<p>so the specified environment is set at the entrance of applications' root folder.
</p>
<p>Create /srv/http/refineria/.rvmrc and put
</p>
<pre>sudo sh -c 'echo "rvm ree@refinery" &gt; /srv/http/navegador/.rvmrc'
</pre>
<p>while in /srv/http/navegador/.rvmrc,
</p>
<pre>sudo sh -c 'echo "rvm 1.9.3@browser" &gt; /srv/http/navegador/.rvmrc'
</pre>
<p>You have to enter to both application root folders now, because every first time that RVM finds a .rvmrc it asks you if you trust the given file, consequently you must validate the two files you have just created.
</p>
<p>These files aid the programs involved to find the correct gems.
</p>
<p>Apart, if applications' files and folders are not owned by the right user you will face database write-access problems. The use of rvmsudo produces <i>root</i>-owned archives when generated by Rails; in the other hand, <i>nobody</i> is the user for Passenger —if you have not changed it—: who will use and should posses them. Fix this doing
</p>
<pre>$ sudo chown -R nobody.nobody /srv/http/refineria /srv/http/navegador
</pre>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_6:_.E5.8F.8D.E5.90.91.E4.BB.A3.E7.90.86"></span><span class="mw-headline" id="步骤_6:_反向代理">步骤 6: 反向代理</span>
</h3>
<p>You have to start the Passenger Standalone web servers for your applications. So, do
</p>
<pre>$ cd /srv/http/refineria
$ rvmsudo passenger start --socket refineria.socket -d
</pre>
<p>and
</p>
<pre>$ cd /srv/http/navegador
$ rvmsudo passenger start --socket navegador.socket -d
</pre>
<p>. The first time that you run a Passenger Standalone it will perform a minor installation.
</p>
<p>Note that you are using <i>unix domain</i> sockets instead of the commonly-used <i>TCP</i> sockets; it turns out that unix domain are significantly faster than TCP sockets.
</p>
<h4><span class="mw-headline" id="Launch_Passenger_Standalone_daemons_at_system_start-up">Launch Passenger Standalone daemons at system start-up</span></h4>
<p><i>Coming soon!</i>
</p>
<h3>
<span id=".E6.AD.A5.E9.AA.A4_7:_.E9.83.A8.E7.BD.B2"></span><span class="mw-headline" id="步骤_7:_部署">步骤 7: 部署</span>
</h3>
<p>Once again edit /opt/nginx/conf/nginx.conf to include some vital instructions:
</p>
<pre>## RefineryCMS ##

upstream refineria_upstream {
    server unix:/srv/http/refineria/refineria.socket;
}

server {
    server_name refinery.domain.com;
    root /srv/http/refineria/public;
    location / {
        proxy_pass http://refineria_upstream;
        proxy_set_header Host $host;
    }
}

## BrowserCMS ##

upstream navegador_upstream {
    server unix:/srv/http/navegador/navegador.socket;
}

server {
    server_name browser.domain.com;
    root /srv/http/navegador/public;
    location / {
        proxy_pass http://navegador_upstream;
        proxy_set_header Host $host;
    }
}
</pre>
<p>At this point you are in conditions to run Nginx with:
</p>
<pre>$ sudo rc.d start nginx
</pre>
<p>and to access both CMSs through <i>refinery.domain.com</i> and <i>browser.domain.com</i>.
</p>
<h3>
<span id=".E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE"></span><span class="mw-headline" id="参考文献">参考文献</span>
</h3>
<ul>
<li>
<a rel="nofollow" class="external free" href="http://beginrescueend.com/integration/passenger">http://beginrescueend.com/integration/passenger</a><sup title="最后检查状态：404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">失效链接</a> 2020-08-04 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external free" href="http://blog.phusion.nl/2010/09/21/phusion-passenger-running-multiple-ruby-versions">http://blog.phusion.nl/2010/09/21/phusion-passenger-running-multiple-ruby-versions</a></li>
</ul>
<h2>
<span id=".E5.8F.82.E8.A7.81"></span><span class="mw-headline" id="参见">参见</span>
</h2>
<ul>
<li><a href="../en/Ruby.html" title="Ruby">Ruby</a></li>
<li><a href="../en/Nginx.html" title="Nginx">Nginx</a></li>
<li><a href="../en/Category:Web_applications.html" class="mw-redirect" title="LAMP">LAMP</a></li>
<li><a href="../en/MySQL.html" title="MySQL">MySQL</a></li>
</ul>
<h2>
<span id=".E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE_2"></span><span class="mw-headline" id="参考文献_2">参考文献</span>
</h2>
<ul><li><a rel="nofollow" class="external text" href="http://rubyonrails.org">Ruby on Rails</a></li></ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../zh-CN/Category:Web_frameworks.html" title="Category:Web frameworks (简体中文)">Web frameworks (简体中文)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Ruby_on_Rails_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)&amp;oldid=647045">https://wiki.archlinux.org/index.php?title=Ruby_on_Rails_(简体中文)&amp;oldid=647045</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 26 December 2020, at 12:25.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
