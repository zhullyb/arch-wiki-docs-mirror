<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Chroot (Español) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Chroot_Español rootpage-Chroot_Español skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">Chroot (Español)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles-start">
<p>Artículos relacionados</p>
<ul>
<li><a href="../en/ArchWiki:Archive.html" class="mw-redirect" title="Install bundled 32-bit system in Arch64">Install bundled 32-bit system in Arch64</a></li>
<li><a href="../en/PRoot.html" title="PRoot">PRoot</a></li>
<li><a href="../es/Systemd-nspawn.html" title="Systemd-nspawn (Español)">systemd-nspawn (Español)</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Chroot" class="extiw" title="wikipedia:Chroot">Chroot</a> es el proceso por el que se cambia el directorio root del disco aparente (y el actual proceso en marcha y sus descendientes) a otro directorio root. Al cambiar a otro directorio root no se puede acceder a los archivos y órdenes fuera de ese directorio. Este directorio se llama <i>jaula chroot</i>. El cambio de root se hace comúnmente para el mantenimiento del sistema, como puede ser volver a instalar el gestor de arranque o restablecer una contraseña olvidada.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Requisitos"><span class="tocnumber">1</span> <span class="toctext">Requisitos</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Montar_las_particiones"><span class="tocnumber">2</span> <span class="toctext">Montar las particiones</span></a></li>
<li class="toclevel-1 tocsection-3">
<a href="#Cambiar_root"><span class="tocnumber">3</span> <span class="toctext">Cambiar root</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Usando_arch-chroot"><span class="tocnumber">3.1</span> <span class="toctext">Usando arch-chroot</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Usando_chroot"><span class="tocnumber">3.2</span> <span class="toctext">Usando chroot</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Usando_systemd-nspawn"><span class="tocnumber">3.3</span> <span class="toctext">Usando systemd-nspawn</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Ejecutar_aplicaciones_gr%C3%A1ficas_en_entornos_chroot"><span class="tocnumber">4</span> <span class="toctext">Ejecutar aplicaciones gráficas en entornos chroot</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Realizar_el_mantenimiento_del_sistema"><span class="tocnumber">5</span> <span class="toctext">Realizar el mantenimiento del sistema</span></a></li>
<li class="toclevel-1 tocsection-9">
<a href="#Salir_del_entorno_chroot"><span class="tocnumber">6</span> <span class="toctext">Salir del entorno chroot</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Desmonte_recursivo"><span class="tocnumber">6.1</span> <span class="toctext">Desmonte recursivo</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Ejemplo"><span class="tocnumber">7</span> <span class="toctext">Ejemplo</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#V%C3%A9ase_tambi%C3%A9n"><span class="tocnumber">8</span> <span class="toctext">Véase también</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Requisitos">Requisitos</span></h2>
<ul><li>Tendrá que arrancar desde otro entorno Linux para funcionar (por ejemplo, desde un LiveCD o un medio flash USB, o desde otra distribución Linux instalada).</li></ul>
<ul><li>Se requieren privilegios de root con el fin de efectuar chroot.</li></ul>
<ul><li>Asegúrese de que la arquitectura del entorno de Linux que haya arrancado coincide con la arquitectura del directorio root que desea introducir (es decir, i686, x86_64). Puede encontrar la arquitectura de su entorno actual con la orden:</li></ul>
<dl><dd><pre># uname -m</pre></dd></dl>
<ul><li>Si necesita algún módulo del kernel cargado en el entorno chroot, cárguelos antes de efectuar el cambio de root. Dichos módulos pueden ser útiles para inicializar la partición de intercambio (<code>swapon /dev/sdxY</code>) y para establecer una conexión a Internet antes de efectuar chroot.</li></ul>
<h2><span class="mw-headline" id="Montar_las_particiones">Montar las particiones</span></h2>
<p>La partición root del sistema Linux, donde se está tratando de efectuar chroot, necesita estar montada previamente. Para saber el nombre asignado por el kernel a dicha partición, ejecute:
</p>
<pre># lsblk /dev/sda
</pre>
<p>También puede ejecutar la siguiente orden para tener una idea de la distribución de las particiones.
</p>
<pre># fdisk -l
</pre>
<p>Ahora cree un directorio (por ejemplo, arch) en el que desee montar la partición root (por ejemplo, la partición sda3) y móntela:
</p>
<pre># mkdir /mnt/arch                 # crea el directorio
# mount /dev/sda3 /mnt/arch       # monta la partición root
</pre>
<p>A continuación, si tiene particiones separadas para otras partes del sistema (por ejemplo, <code>/boot</code>, <code>/home</code>, <code>/var</code>, etc.), debe montarlas, de este modo:
</p>
<pre># mount /dev/sda1 /mnt/arch/boot/
# mount /dev/sdb5 /mnt/arch/home/
# mount ...
</pre>
<p>Si bien es posible montar sistemas de archivos después de efectuar chroot, es más conveniente hacerlo antes. La razón de esto es que se tendrán que desmontar los sistemas de archivos creados temporalmente después de salir de la jaula, así que este procedimiento le permite desmontar todos los sistemas de archivos con una sola orden. Por otro lado, esto también permite un cierre más seguro. Debido a que el entorno de Linux externo conoce todas las particiones montadas, puede desmontarlas con seguridad  durante el apagado.
</p>
<h2><span class="mw-headline" id="Cambiar_root">Cambiar root</span></h2>
<h3><span class="mw-headline" id="Usando_arch-chroot">Usando arch-chroot</span></h3>
<p>El script <code>arch-chroot</code> es parte del paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span> de los <a href="../es/Official_repositories.html" title="Official repositories (Español)">repositorios oficiales</a>.  El script monta los sistemas de archivos de la API como <code>/proc</code> y pone disponible al chroot <code>/etc/resolv.conf</code>  antes de ejecutar <code>/usr/bin/chroot</code>.
</p>
<p>Ejecute arch-chroot con el nuevo directorio raíz como primer argumento:
</p>
<pre># arch-chroot /mnt/arch
</pre>
<p>Para usar la shell bash en vez de sh usado por defecto:
</p>
<pre># arch-chroot /mnt/arch /bin/bash
</pre>
<p>Para ejecutar <code>mkinitcpio -p linux</code> desde el chroot y salir inmediatamente:
</p>
<pre># arch-chroot /mnt/arch /usr/bin/mkinitcpio -p linux
</pre>
<h3><span class="mw-headline" id="Usando_chroot">Usando chroot</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Al usar el parámetro <code>--rbind</code>, algunos sub directorios <code>dev/</code> y <code>sys/</code> no se va a poder desmontar. Al intentar el desmonte con <code>umount -l</code> romperá la sesión, requiriendo reiniciar el sistema. En lo posible use <code>-o bind</code> en su lugar.</div>
<p>Monte los sistemas de archivos temporales:
</p>
<pre># cd /mnt/arch
# mount -t proc proc proc/
# mount -t sysfs sys sys/
# mount -o bind /dev dev/
# mount -t devpts pts dev/pts/
</pre>
<p>Si se establece una conexión a Internet y desea utilizarla en el entorno chroot, puede que tenga que copiar sus servidores DNS para que se conecten a la red:
</p>
<pre># cp -L /etc/resolv.conf etc/resolv.conf
</pre>
<p>Ahora efectúe chroot en el sistema instalado y defina la shell:
</p>
<pre># chroot /mnt/arch /usr/bin/bash
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Si ve el error <code>chroot: cannot run command '/bin/bash': Exec format error</code>, es probable que las dos arquitecturas no coincidan.</li>
<li>Si ve el error <code>chroot: '/usr/bin/bash': permission denied</code>, vuelva a montar con el permiso exec: <code>mount -o remount,exec /mnt/arch</code>.</li>
</ul>
</div>
<p>De manera opcional, para suministrar una configuración propia a Bash (<code>~/.bashrc</code> y <code>/etc/bash.bashrc</code>), ejecute:
</p>
<pre># source ~/.bashrc
# source /etc/profile
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Opcionalmente también puede crear un prompt único capaz de diferenciar el entorno chroot:
<pre># export PS1="(chroot) $PS1"</pre>
</div>
<h3><span class="mw-headline" id="Usando_systemd-nspawn">Usando systemd-nspawn</span></h3>
<p>Como alternativa, puede usar <code>systemd-nspawn</code> para lograr lo mismo, con beneficios adicionales (ver la página del manual de «systemd-nspawn»).
</p>
<p>Los pasos son muy similares:
</p>
<ul><li>Primero monte la partición <code>root</code>:</li></ul>
<pre># mkdir /mnt/arch
# mount /dev/sdx3 /mnt/arch
</pre>
<ul><li>A continuación, monte las particiones <code>boot</code> y <code>home</code> en la partición root:</li></ul>
<pre># mount /dev/sdx1 /mnt/arch/boot
# mount /dev/sdx4 /mnt/arch/home
</pre>
<ul><li>Luego, basta con hacer <code>cd</code> en la partición root y ejecutar systemd-nspawn:</li></ul>
<pre># cd /mnt/arch
# systemd-nspawn
</pre>
<p>Como puede ver, no hay necesidad de preocuparse por montar <code>proc</code>, <code>sys</code>, <code>dev</code> o <code>dev/pts</code>. <code>systemd-nspawn</code> inicia un proceso init nuevo en el entorno creado, que se encarga de todo. Es como arrancar un segundo sistema operativo Linux en la misma máquina, pero que no se comporta como una máquina virtual.
</p>
<p>Para salir, simplemente cierre la sesión o ejecute la orden <code>poweroff</code>. A continuación, puede desmontar las particiones como se ha descrito anteriormente (sin tener que preocuparse de proc, sys, etc).
</p>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a><b>This article or section needs expansion.</b><a href="../File:Tango-view-fullscreen.png" class="image"><img alt="Tango-view-fullscreen.png" src="../File:Tango-view-fullscreen.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> Describe the steps to run an X server inside the systemd-nspawn container. (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Chroot_(Espa%C3%B1ol)">Talk:Chroot (Español)#</a>)</div>
</div>
<h2>
<span id="Ejecutar_aplicaciones_gr.C3.A1ficas_en_entornos_chroot"></span><span class="mw-headline" id="Ejecutar_aplicaciones_gráficas_en_entornos_chroot">Ejecutar aplicaciones gráficas en entornos chroot</span>
</h2>
<p>Si tiene <a href="../es/Xorg.html" title="Xorg (Español)">X</a> ejecutándose en el sistema, puede iniciar aplicaciones gráficas desde el entorno chroot.
</p>
<p>Para permitir la conexión a un servidor X en un entorno chroot, abra un terminal dentro del servidor X (es decir, dentro del escritorio del usuario donde se ha iniciado actualmente sesión), y, a continuación, ejecute la siguiente orden que concede permisos a cualquiera para conectarse al servidor X del usuario:
</p>
<pre>$ xhost +
</pre>
<p>Después, para dirigir las aplicaciones al servidor X desde el entorno chroot, establezca  la variable de entorno del DISPLAY  dentro del entorno chroot, para que coincida con la variable del DISPLAY del usuario al que pertenece el servidor X. Así, por ejemplo, ejecute: 
</p>
<pre>$ echo $DISPLAY
</pre>
<p>como el usuario que es propietario del servidor X para ver el valor de DISPLAY. Si el valor es Y. If the value is ":0" (por ejemplo), entonces en el entorno chroot ejecute:
</p>
<pre># export DISPLAY=:0
</pre>
<p>Ahora puede iniciar aplicaciones gráficas desde la línea de órdenes del entorno chroot.
</p>
<h2><span class="mw-headline" id="Realizar_el_mantenimiento_del_sistema">Realizar el mantenimiento del sistema</span></h2>
<p>En este punto puede realizar cualquier mantenimiento del sistema  que necesite dentro del entorno chroot. Algunos ejemplos comunes son:
</p>
<ul>
<li>Volver a instalar el gestor de arranque.</li>
<li>Reconstruir la imagen <a href="../es/Mkinitcpio.html" title="Mkinitcpio (Español)">initramfs</a>.</li>
<li>Actualizar o realizar <a href="../en/Downgrading_packages.html" title="Downgrading packages">downgrade</a> de paquetes.</li>
<li>Restablecer una <a href="../en/Reset_lost_root_password.html" class="mw-redirect" title="Password recovery">contraseña olvidada</a>.</li>
</ul>
<h2><span class="mw-headline" id="Salir_del_entorno_chroot">Salir del entorno chroot</span></h2>
<p>Cuando haya terminado con el mantenimiento del sistema, salga de chroot:
</p>
<pre># exit
</pre>
<p>A continuación, desmonte los sistemas de archivos temporales y los dispositivos montados:
</p>
<pre># umount {proc,sys,dev,boot,[...],}
</pre>
<p>Por último, desmonte la partición root:
</p>
<pre># cd ..
# umount arch/
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Si obtiene un error diciendo que <code>/mnt</code> (o cualquier otra partición) está ocupada, esto puede significar una de estas dos cosas:
<ul><li>Que un programa ha quedado ejecutándose dentro del entorno chroot.</li></ul>
<ul><li>O, más normalmente, que un submontaje todavía existe (por ejemplo, <code>/mnt/arch/boot</code> en <code>/mnt/arch</code>). Compruebe, con la orden <code>lsblk</code>, si hay puntos de montaje pendientes:</li></ul>
<dl><dd><pre>lsblk /dev/sda</pre></dd></dl>
<dl><dd>Si aún sigue sin poder desmontar una partición, use la opción <code>--force</code>:</dd></dl>
<dl><dd><pre># umount -f /mnt</pre></dd></dl>
</div>
<p>Después de esto, será capaz de reiniciar el sistema de forma segura.
</p>
<h3><span class="mw-headline" id="Desmonte_recursivo">Desmonte recursivo</span></h3>
<p>Para desmontar de manera recursiva, sin necesidad de desmontar cada directorio manualmente, ejecute:
</p>
<pre># cd /
# umount --recursive <i>/mnt</i>
</pre>
<h2><span class="mw-headline" id="Ejemplo">Ejemplo</span></h2>
<p>Esto puede proteger su sistema contra ataques desde Internet durante la navegación: 
</p>
<pre># # as root: 
# cd /home/<i>user</i>
# mkdir myroot
# pacman -S arch-install-scripts
# # pacstrap must see myroot as mounted: 
# mount --bind myroot myroot
# pacstrap -i myroot base base-devel
# mount -t proc proc myroot/proc/
# mount -t sysfs sys myroot/sys/
# mount -o bind /dev myroot/dev/
# mount -t devpts pts myroot/dev/pts/
# cp -i /etc/resolv.conf myroot/etc/
# chroot myroot
# # inside chroot: 
# passwd # set a password 
# useradd -m -s /bin/bash <i>user</i>
# passwd <i>user</i> # set a password
# # in a shell outside the chroot: 
# pacman -S xorg-server-xnest
# # in a shell outside the chroot you can run this as <i>user</i>: 
$ Xnest -ac -geometry 1024x716+0+0 :1
# # continue inside the chroot: 
# pacman -S xterm
# DISPLAY=:1
# xterm
# # xterm is now running in Xnest 
# pacman -S xorg-server xorg-xinit xorg-server-utils
# pacman -S openbox
# # for java we need icedtea-web which requires some fonts: 
# nano /etc/locale.gen
# # uncomment en_US.UTF-8 UTF-8, save and exit 
# locale-gen
# echo LANG=en_US.UTF-8 &gt; /etc/locale.conf
# export LANG=en_US.UTF-8
# pacman -S ttf-dejavu
# pacman -S icedtea-web
# pacman -S firefox
# firefox
# # firefox is now running in Xnest 
# exit
# # outside chroot: 
# chroot --userspec=<i>user</i> myroot
# # inside chroot as <i>user</i>: 
$ DISPLAY=:1
$ openbox &amp;
$ HOME="/home/<i>user</i>"
$ firefox</pre>
<p><br>
</p>
<h2>
<span id="V.C3.A9ase_tambi.C3.A9n"></span><span class="mw-headline" id="Véase_también">Véase también</span>
</h2>
<ul>
<li><a href="../es/Systemd-nspawn.html" title="Systemd-nspawn (Español)">systemd-nspawn (Español)</a></li>
<li><a rel="nofollow" class="external text" href="https://help.ubuntu.com/community/BasicChroot">Basic Chroot</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../es/Category:System_recovery.html" title="Category:System recovery (Español)">System recovery (Español)</a></li>
<li><a href="../es/Category:Sandboxing.html" title="Category:Sandboxing (Español)">Sandboxing (Español)</a></li>
<li><a href="../es/Category:Commands.html" title="Category:Commands (Español)">Commands (Español)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Chroot_(Espa%C3%B1ol)&amp;oldid=638321">https://wiki.archlinux.org/index.php?title=Chroot_(Español)&amp;oldid=638321</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 14 October 2020, at 07:09.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
