<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd (Español)/User (Español) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Español_User_Español rootpage-Systemd_Español skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">systemd (Español)/User (Español)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"><span class="subpages">&lt; <a href="../es/Systemd.html" title="Systemd (Español)">Systemd (Español)</a></span></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-meta-related-articles-start">
<p>Artículos relacionados</p>
<ul>
<li><a href="../es/Systemd.html" title="Systemd (Español)">systemd (Español)</a></li>
<li><a href="../es/Getty.html#Inicio_de_sesi%C3%B3n_autom%C3%A1tico_a_la_consola_virtual" class="mw-redirect" title="Automatic login to virtual console (Español)">Automatic login to virtual console (Español)</a></li>
<li><a href="../es/Xinit.html#Inicio_autom%C3%A1tico_de_X_al_inicio_de_sesi%C3%B3n" class="mw-redirect" title="Start X at Login (Español)">Start X at Login (Español)</a></li>
</ul>
</div>
<p><a href="../es/Systemd.html" title="Systemd (Español)">systemd</a> ofrece a los usuarios la capacidad de ejecutar una instancia de <a href="../es/Systemd.html" title="Systemd (Español)">systemd</a> para gestionar la sesión y los servicios. Esto permite a los usuarios iniciar, detener, habilitar y deshabilitar las unidades que se encuentren dentro de ciertas carpetas cuando systemd se ejecuta por el usuario. Esto es conveniente para los demonios y otros servicios que normalmente se ejecutan como un usuario diferente a root o un usuario especial, como por ejemplo <a href="../en/Music_Player_Daemon.html" class="mw-redirect" title="Mpd">mpd</a>
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Configuraci%C3%B3n_desde_systemd_206"><span class="tocnumber">1</span> <span class="toctext">Configuración desde systemd 206</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#D-Bus"><span class="tocnumber">1.1</span> <span class="toctext">D-Bus</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Inicio_de_sesi%C3%B3n_autom%C3%A1tico_en_Xorg_sin_gestor_de_pantallas"><span class="tocnumber">1.2</span> <span class="toctext">Inicio de sesión automático en Xorg sin gestor de pantallas</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Puesta_en_marcha_autom%C3%A1tica_de_instancias_de_usuario_de_systemd"><span class="tocnumber">1.3</span> <span class="toctext">Puesta en marcha automática de instancias de usuario de systemd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5">
<a href="#Configuraci%C3%B3n"><span class="tocnumber">2</span> <span class="toctext">Configuración</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Utilizar_/usr/lib/systemd/systemd_--user_para_gestionar_la_propia_sesi%C3%B3n"><span class="tocnumber">2.1</span> <span class="toctext">Utilizar /usr/lib/systemd/systemd --user para gestionar la propia sesión</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Inicio_de_sesi%C3%B3n_autom%C3%A1tico"><span class="tocnumber">2.2</span> <span class="toctext">Inicio de sesión automático</span></a></li>
<li class="toclevel-2 tocsection-8">
<a href="#Otros_casos_de_uso"><span class="tocnumber">2.3</span> <span class="toctext">Otros casos de uso</span></a>
<ul>
<li class="toclevel-3 tocsection-9">
<a href="#Multiplexor_de_terminal_persistente"><span class="tocnumber">2.3.1</span> <span class="toctext">Multiplexor de terminal persistente</span></a>
<ul>
<li class="toclevel-4 tocsection-10"><a href="#Iniciar_X"><span class="tocnumber">2.3.1.1</span> <span class="toctext">Iniciar X</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-11">
<a href="#Servicios_de_ususario"><span class="tocnumber">3</span> <span class="toctext">Servicios de ususario</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Unidades_instaladas_por_los_paquetes"><span class="tocnumber">3.1</span> <span class="toctext">Unidades instaladas por los paquetes</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Ejemplo"><span class="tocnumber">3.2</span> <span class="toctext">Ejemplo</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Ejemplo_con_variables"><span class="tocnumber">3.3</span> <span class="toctext">Ejemplo con variables</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Nota_acerca_de_las_aplicaciones_X"><span class="tocnumber">3.4</span> <span class="toctext">Nota acerca de las aplicaciones X</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-16"><a href="#V%C3%A9ase_tambi%C3%A9n"><span class="tocnumber">4</span> <span class="toctext">Véase también</span></a></li>
</ul>
</div>

<h2>
<span id="Configuraci.C3.B3n_desde_systemd_206"></span><span class="mw-headline" id="Configuración_desde_systemd_206">Configuración desde systemd 206</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Las sesiones de usuario están en desarrollo, por lo que faltan algunas características, que aún no están apoyadas por los desarrolladores. Véase <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2013-July/012392.html">[1]</a> y <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2013-August/012517.html">[2]</a> para obtener más detalles sobre el estado actual del asunto.</div>
<p>Desde la versión 206, el mecanismo para instancias de usuario de systemd ha cambiado. Ahora el módulo <code>pam_systemd.so</code> lanza una instancia de usuario, por defecto, en el primer inicio de sesión de un usuario, iniciando <code>user@.service</code>. En el estado actual, existen algunas diferencias con respecto a versiones anteriores de systemd, que hay que tener en cuenta:
</p>
<ul>
<li>La instancia <code>systemd --user</code> se ejecuta fuera de cualquier sesión de usuario. Esto está bien para correr, por ejemplo <code>mpd</code>, pero puede ser molesto si uno trata de iniciar un gestor de ventanas desde la instancia de usuario de systemd. Entonces polkit evita montar usb, reinicar, etc., como un usuario normal, porque el gestor de ventanas se ha ejecutado fuera de la sesión activa.</li>
<li>Las unidades en la instancia de usuario no heredan cualquier entorno, por lo que se debe fijar manualmente.</li>
<li>
<code>user-session@.service</code> de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/user-session-units/">user-session-units</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">enlace roto</a>: package not found]</sup> está ahora obsoleto.</li>
</ul>
<p>Pasos para utilizar las unidades de instancia de usuario:
</p>
<p>
1. Asegúrese de que la instancia de usuario de systemd se inicia correctamente. Puede comprobar esto con: </p>
<pre>systemctl --user status</pre>
<p> Desde systemd 206 debe haber una instancia de usuario ejecutando systemd por defecto, que se inicia en el módulo pam <code>pam_systemd.so</code> para la primera sesión de un usuario.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> system-login necesita para comenzar de pam_systemd: este debe contener <code>-session   optional   pam_systemd.so</code>; compruebe si existe el archivo <i>.pacnew</i>.</div>
<p>2. Agregue las variables de entorno que necesita, en un párrafo en el archivo de configuración para <code>user@.service</code>. Al menos, debe contener lo siguiente:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user@.service.d/environment.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment=DISPLAY=:0
</pre>
<p>3. Ponga todas sus unidades de usuario en <code>~/.config/systemd/user</code>. Cuando inicie la instancia de usuario, lance el target predeterminado <code>~/.config/systemd/user/default.target</code>.  Después de eso, se pueden manejar las unidades de usuario con <code>systemctl --user</code>.
</p>
<h3><span class="mw-headline" id="D-Bus">D-Bus</span></h3>
<p>Para utilizar <a href="../es/D-Bus.html" title="D-Bus (Español)">dbus</a> en unidades de usuario, cree los siguientes archivos:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/user/dbus.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=D-Bus Message Bus Socket
Before=sockets.target

[Socket]
ListenStream=/run/user/%U/dbus/user_bus_socket

[Install]
WantedBy=default.target
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/user/dbus.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=D-Bus Message Bus
Requires=dbus.socket

[Service]
ExecStart=/usr/bin/dbus-daemon --session --address=systemd: --nofork --nopidfile --systemd-activation
ExecReload=/usr/bin/dbus-send --print-reply --session --type=method_call --dest=org.freedesktop.DBus / org.freedesktop.DBus.ReloadConfig
</pre>
<p>Active el socket ejecutando:
</p>
<pre># systemctl --global enable dbus.socket
</pre>
<p>La unidad <code>user@.service</code> que lanza la instancia systemd del usuario, exporta, por defecto, la siguiente ruta de bus:
</p>
<pre>DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/%I/dbus/user_bus_socket
</pre>
<p>que se propaga para los servicios que se ejecutan en esta instancia. Sin embargo, se ha sugerido que cada sesión de usuario debe tener su propia instancia de demonio dbus (lo que significa que debe usar, por ejemplo, el esqueleto <a href="../es/Xinit.html#xinitrc" class="mw-redirect" title="Xinitrc (Español)">xinitrc</a>, que inicia el demonio dbus para la sesión de Xorg ). Hay un debate en curso sobre este tema en la <a rel="nofollow" class="external text" href="https://lists.freedesktop.org/archives/systemd-devel/2013-March/009422.html">lista de correo de systemd</a>. Como la decisión final no se ha tomado todavía, no existe una solución oficial.
</p>
<h3>
<span id="Inicio_de_sesi.C3.B3n_autom.C3.A1tico_en_Xorg_sin_gestor_de_pantallas"></span><span class="mw-headline" id="Inicio_de_sesión_automático_en_Xorg_sin_gestor_de_pantallas">Inicio de sesión automático en Xorg sin gestor de pantallas</span>
</h3>
<p>Se necesita tener <a href="#D-Bus">#D-Bus</a> correctamente configurado y <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xlogin-git/">xlogin-git</a></span><sup><small>AUR</small></sup> instalado.
</p>
<p>Configure <a href="../es/Xinit.html#xinitrc" class="mw-redirect" title="Xinitrc (Español)">xinitrc</a> desde el esqueleto, para que le suministre los archivos en <code>/etc/X11/xinit/xinitrc.d/</code>. El funcionamiento de <code>~/.xinitrc</code> no debe retornar a sí mismo, por lo que o bien tiene <code>wait</code> como última orden, o añada <code>exec</code> a la última orden que es llamada y que no debe consistir en retornar (por ejemplo, llamar al gestor de ventanas).
</p>
<p>La sesión utilizará su propio demonio dbus, pero varias utilidades systemd necesitarán la instancia <code>dbus.service</code>. Una posible solución a esto es crear alias para estas órdenes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">for sd_cmd in systemctl systemd-analyze systemd-run; do
    alias $sd_cmd='DBUS_SESSION_BUS_ADDRESS="unix:path=$XDG_RUNTIME_DIR/dbus/user_bus_socket" '$sd_cmd
done
</pre>
<p>Por último, active (<b>como root</b>) el servicio <i>xlogin</i> para iniciar automáticamente sesión al arrancar:
</p>
<pre># systemctl enable xlogin@<i>nombredeusuario</i>
</pre>
<p>La sesión de usuario se desarrolla enteramente dentro de un espacio systemd y todo en la sesión de usuario debería funcionar bien.
</p>
<h3>
<span id="Puesta_en_marcha_autom.C3.A1tica_de_instancias_de_usuario_de_systemd"></span><span class="mw-headline" id="Puesta_en_marcha_automática_de_instancias_de_usuario_de_systemd">Puesta en marcha automática de instancias de usuario de systemd</span>
</h3>
<p>La instancia de usuario de systemd es, por defecto, ejecutada después del primer inicio de sesión de un usuario, pero, a veces, puede ser útil empezar aquella después del arranque. Lingering se utiliza para generar la instancia de usuario systemd en el arranque y que siga funcionando después del cierre de sesión.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Los servicios de systemd <b>no</b> son sesiones, se ejecutan fuera de <i>logind</i>. No utilice lingering para permitir el inicio de sesión automática, ya que <a href="../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">rompe la sesión</a>.</div>
<p>Utilice la siguiente orden para activar lingering para el usuario específico:
</p>
<pre># loginctl enable-linger <i>nombredeusuario</i>
</pre>
<h2>
<span id="Configuraci.C3.B3n"></span><span class="mw-headline" id="Configuración">Configuración</span>
</h2>
<div class="noprint archwiki-template-message">
<p><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a><b>This article or section is out of date.</b><a href="../File:Tango-view-refresh-red.png" class="image"><img alt="Tango-view-refresh-red.png" src="../File:Tango-view-refresh-red.png" decoding="async" width="48" height="48"></a></p>
<div>
<b>Reason:</b> After systemd 206, systemd --user mechanism has changed. (See <a rel="nofollow" class="external autonumber" href="https://bugs.freedesktop.org/show_bug.cgi?id=67471">[3]</a>, <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2013-July/012392.html">[4]</a>, <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2013-August/012517.html">[5]</a>) (Discuss in <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:Systemd_(Espa%C3%B1ol)/User_(Espa%C3%B1ol)">Talk:Systemd (Español)/User (Español)#</a>)</div>
</div>
<h3>
<span id="Utilizar_.2Fusr.2Flib.2Fsystemd.2Fsystemd_--user_para_gestionar_la_propia_sesi.C3.B3n"></span><span class="mw-headline" id="Utilizar_/usr/lib/systemd/systemd_--user_para_gestionar_la_propia_sesión">Utilizar /usr/lib/systemd/systemd --user para gestionar la propia sesión</span>
</h3>
<p>Systemd tiene muchas características sorprendentes, una de ellas es la capacidad de hacer un seguimiento de los programas utilizando cgroups (ejecutando <code>systemctl status</code>). Aunque esto es realmente útil para un sistema de init en cuyo proceso hay un <b>pid 1</b>, también es muy útil para los usuarios que quieran utilizar esta función para iniciar automáticamente los programas de los mismos, haciendo un seguimiento simultáneamente del contenido de cada cgrupo.
</p>
<p>Todas las unidades de usuario de systemd residirán en <code>$HOME/.config/systemd/user</code>. Estas unidades tienen prioridad sobre otras unidades en residentes en otros directorios de unidades de systemd.
</p>
<p>Necesitamos dos paquetes para conseguir este trabajo, por un lado, el disponible actualmente desde <a href="../es/Arch_User_Repository.html" title="Arch User Repository (Español)">AUR</a>: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/systemd-xorg-launch-helper-git/">systemd-xorg-launch-helper-git</a></span><sup><small>AUR</small></sup> y, opcionalmente, por otro lado, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/systemd-user-session-units-git/">systemd-user-session-units-git</a></span><sup><small>AUR</small></sup> si desea trabajar con autologin. 
</p>
<p>Lo siguiente será crear los targets (<i>«objetivos»</i>). Configuraremos dos: uno para el gestor de ventanas, y otro como un target por defecto. El target del gestor de ventanas debe ser similar a lo siguiente:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/wm.target</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Window manager target
Wants=xorg.target
Wants=mystuff.target
Requires=dbus.socket
AllowIsolate=true

[Install]
Alias=default.target
</pre>
<p>Este será el target de su interfaz gráfica.
</p>
<p>Crearemos un segundo target llamado <code>mystuff.target</code>. Valdrá para todos los servicios, pero debe contener el gestor de ventanas elegido en la línea <code>WantedBy</code>, bajo <code>[Install]</code>, señalando a esta unidad.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/mystuff.target</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Xinitrc Stuff
Wants=wm.target

[Install]
Alias=default.target
</pre>
<p>Crearemos un enlace simbólico de nombre <code>default.target</code>. Cuando se inicie <code>/usr/lib/systemd/systemd --user</code>, dicho target vendrá iniciado también. 
</p>
<p>Por último, nececitamos escribir varios archivos de servicios correspondientes a los servicios que deben comenzar. Para ello, asociaremos un servicio al gestor de ventanas.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/YOUR_WM.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=your window manager service
Before=mystuff.target
After=xorg.target
Requires=xorg.target

[Service]
#Environment=PATH=uncomment:to:override:your:PATH
ExecStart=/full/path/to/wm/executable
Restart=always
RestartSec=10
 
[Install]
WantedBy=wm.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> La sección <code>[Install]</code> incluye el valor 'WantedBy'. Cuando usamos <code>systemctl --user enable</code> se asocia a este como <code>$HOME/.config/systemd/user/wm.target.wants/YOUR_WM.service</code>, lo que le permite arrancarlo al iniciar sesión. Se recomienda activar este servicio, en lugar de unirlo de forma manual.</div>
<p>Se puede poblar el directorio de unidades de usuario con una gran cantidad de servicios, incluyendo, a modo de ejemplo, algunos como <b>mpd</b>, <b>gpg-agent</b>, <b>offlineimap</b>, <b>parcellite</b>, <b>pulse</b>, <b>tmux</b>, <b>urxvtd</b>, <b>xbindkeys</b> y <b>xmodmap</b>.
</p>
<p>Para salir de su sesión, utilice <code>systemctl --user exit</code>.
</p>
<h3>
<span id="Inicio_de_sesi.C3.B3n_autom.C3.A1tico"></span><span class="mw-headline" id="Inicio_de_sesión_automático">Inicio de sesión automático</span>
</h3>
<p>Si se quiere iniciar sesión automáticamente al arrancar con systemd, es posible utilizar la unidad correspondiente proporcionada por el paquete user-session-units. Considere la posibilidad de activar una pantalla locker para evitar que cualquier pueda valerse de la sesión recién iniciada. 
Añada esta línea a <code>/etc/pam.d/login</code> y a <code>/etc/pam.d/system-auth</code>:
</p>
<pre>session    required    pam_systemd.so</pre>
<p>Debido a que <code>user-session@.service</code> viene iniciado en tty1, será necesario añadir <code>Conflicts=getty@tty1.service</code> al archivo de servicio en cuestión, si no existe ya. Como alternativa, puede hacer que se ejecute en tty7 en su lugar, modificando <code>TTYPath</code> en consecuencia, así como la línea <code>ExecStart</code> en <code>xorg.service</code> (<code>cp /usr/lib/systemd/user/xorg.service /etc/systemd/user/</code> y haciendo las modificaciones allí).
</p>
<p>Una vez hecho esto, ejecute <code>systemctl --user enable</code> <code>YOUR_WM.service</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Hay que prestar atención a la tty de modo que la sesión de systemd esté marcada como activa. Systemd establece una sesión como inactiva cuando la tty activa es diferente de aquella en la cual se ha inicio sesión. Esto significa que el servidor X se debe ejecutar en la misma tty especificada en <code>user-session@.service</code>. Si la tty en <code>TTYPath</code> no coincide con el xorg lanzado, la sesión de systemd estará inactiva desde el punto de vista de las aplicaciones de X, y no será capaz de montar las unidades USB, por ejemplo.</div>
<p>Una de las cosas más importantes es añadir al propio archivo de servicio el uso de <code>Before=</code> y <code>After=</code> en la sección <code>[Unit]</code>. Esto permitirá determinar el orden de inicio de los servicios. Pongamos por caso que queremos disponer de una aplicación gráfica que se inicie al arranque, para ello será necesario añadir <code>After=xorg.target</code> a la propia sección unit. Otro caso, como por ejemplo iniciar <b>ncmpcpp</b>, el cual requiere <b>mpd</b> para funcionar, será necesario añadir <code>After=mpd.service</code> a la sección unit de ncmpcpp. El tiempo y la experiencia arrojarán luz sobre cómo gestionar el orden de inicio de las aplicaciones, o bien consultando la página de man de systemd. Comenzar con <a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">systemd.unit(5)</a> sería una buena idea.
</p>
<h3><span class="mw-headline" id="Otros_casos_de_uso">Otros casos de uso</span></h3>
<h4><span class="mw-headline" id="Multiplexor_de_terminal_persistente">Multiplexor de terminal persistente</span></h4>
<p>Es posible que quiera utilizar la propia sesión de usuario para iniciar un multiplexor de terminal como <a href="../en/GNU_Screen.html" title="GNU Screen">GNU Screen</a> o <a href="../en/Tmux.html" title="Tmux">Tmux</a>, como fondo de pantalla para conectarse, en lugar de iniciar la sesión de un gestor de ventanas. Separar el login del login gráfico es probablemente útil para los usuarios que efectuan el arranque en una TTY, en lugar de utilizar un gestor de pantallas (en cuyo caso es posible insertar todos los programas de arranque en el target myStuff.target). 
</p>
<p>Para crear este tipo de sesión de usuario, proceda como se indica anteriormente, pero en lugar de crear wm.target, cree multiplexer.target:
</p>
<pre>[Unit]
Description=Terminal multiplexer
Documentation=info:screen man:screen(1) man:tmux(1)
After=cruft.target
Wants=cruft.target

[Install]
Alias=default.target</pre>
<p>El target <code>cruft.target</code>, similar a myStuff.target, debería ocuparse de todos aquellos programas que consideremos que deberían empezar antes que tmux o screen (o que queremos iniciar al arranque independientemente del tiempo), como por ejemplo una sesión del demonio GnuPG.
</p>
<p>Para todo esto, será necesario crear un servicio para la propia sesión del multiplexor. He aquí un servicio de muestra que utiliza tmux como ejemplo y provee una sesión gpg-agent que escribe la propia información en /tmp/gpg-agent-info. Esta sesión de muestra, al tiempo que inicia X, también es capaz de hacer correr programas gráficos, desde el momento en que la variable DISPLAY es ajustada.
</p>
<pre>[Unit]
Description=tmux: A terminal multiplixer Documentation=man:tmux(1)
After=gpg-agent.service
Wants=gpg-agent.service

[Service]
Type=forking
ExecStart=/usr/bin/tmux start
ExecStop=/usr/bin/tmux kill-server
Environment=DISPLAY=:0
EnvironmentFile=/tmp/gpg-agent-info

[Install]
WantedBy=multiplexer.target</pre>
<p>Una vez hecho esto, <code>systemctl --user enable</code>, <code>tmux.service</code>, <code>multiplexer.target</code> y cualquier otro programa creado, serán ejecutados por <code>cruft.target</code>. Active <code>user-session@.service</code> como se describió antes, pero asegúrese de retirar el servicio <code>Conflicts=getty@tty1.service</code> de <code>user-session@.service</code>, puesto que la sesión de usuario no se hará cargo de una TTY. ¡Enhorabuena! ¡Ahora tiene un multiplexor de terminal en funcionamiento y otros programas útiles listos para iniciar en el arranque!
</p>
<h5><span class="mw-headline" id="Iniciar_X">Iniciar X</span></h5>
<p>Habrá podido advertir que, desde el multiplexor de terminal es ahora <code>default.target</code>. X no se iniciará automáticamente en el arranque. Para iniciar X, proceda como antes, pero no active o enlace manualmente <code>wm.target</code> a <code>default.target</code>. En su lugar, asumiendo que arranca desde un terminal, vamos a utilizar simplemente una solución temporal y enmascarar <code>/usr/bin/startx</code> con un alias de shell:
</p>
<pre>alias startx='systemctl --user start wm.target'</pre>
<h2><span class="mw-headline" id="Servicios_de_ususario">Servicios de ususario</span></h2>
<p>Ahora los usuarios pueden interactuar con las unidades ubicadas en los carpetas relacionadas más abajo, tal como lo harían con los servicios del sistema  (carpetas ordenadas por prioridad ascendente):
</p>
<ul>
<li><code>/usr/lib/systemd/user/</code></li>
<li><code>/etc/systemd/user/</code></li>
<li><code>~/.config/systemd/user/</code></li>
</ul>
<p>Para el control de la instancia de systemd, se debe utilizar la orden <code>systemctl --user</code>.
</p>
<h3><span class="mw-headline" id="Unidades_instaladas_por_los_paquetes">Unidades instaladas por los paquetes</span></h3>
<p>Una unidad proveída por un paquete está destinada a ser ejecutada por una instancia de usuario de <a href="../es/Systemd.html" title="Systemd (Español)">systemd</a> que instalará la unidad en <code>/usr/lib/systemd/user/</code>. La administración del sistema puede modificar la unidad copiándola a <code>/etc/systemd/user/</code>. Un usuario puede modificar la unidad copiándola a <code>~/.config/systemd/user/</code>.
</p>
<h3><span class="mw-headline" id="Ejemplo">Ejemplo</span></h3>
<p>El siguiente es un ejemplo de una versión de <code>mpd.service</code> realizada por el usuario:
</p>
<pre>[Unit]
Description=Music Player Daemon

[Service]
ExecStart=/usr/bin/mpd --no-daemon

[Install]
WantedBy=default.target
</pre>
<h3><span class="mw-headline" id="Ejemplo_con_variables">Ejemplo con variables</span></h3>
<p>El siguiente es un ejemplo de una versión de usuario de <code>sickbeard.service</code>, que tiene en cuenta los directorios home como variable, donde SickBeard puede encontrar ciertos archivos:
</p>
<pre>[Unit]
Description=SickBeard Daemon

[Service]
ExecStart=/usr/bin/env python2 /opt/sickbeard/SickBeard.py --config %h/.sickbeard/config.ini --datadir %h/.sickbeard

[Install]
WantedBy=default.target
</pre>
<p>Como se detalla en <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5">systemd.unit(5)</a></span>, la variable <code>%h</code> es reemplazada por la carpeta home del usuario que ejecuta el servicio. Hay otras variables en las manpages de <a href="../es/Systemd.html" title="Systemd (Español)">systemd</a> que puede tenerlas en cuenta.
</p>
<h3><span class="mw-headline" id="Nota_acerca_de_las_aplicaciones_X">Nota acerca de las aplicaciones X</span></h3>
<p>La mayoría de las aplicaciones X necesita una variable <code>DISPLAY</code> para ser iniciada (si el propio servicio no se ha iniciado, con lo cual es la primera cosa a controlar), así que hay que asegurarse de incluir lo siguiente:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/parcellite.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Parcellite clipboard manager

[Service]
ExecStart=/usr/bin/parcellite
Environment=DISPLAY=:0 # &lt;= !

[Install]
WantedBy=mystuff.target
</pre>
<p>Una manera más simple, si se utiliza <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/user-session-units/">user-session-units</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">enlace roto</a>: package not found]</sup>, es definirlo en <code>user-session@yourloginname.service</code> que lo heredará. Añada <code>Environment=DISPLAY=:0</code> a la sección <code>[Service]</code>. Otra variable de entorno útil para establecer aquí es <code>SHELL</code>.
</p>
<p>Sin embargo, será preferible <b>no</b> insertar directamente el valor de la variable DISPLAY en el servicio (especialmente si se ejecuta más de una respecto a la pantalla):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/x-app-template@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Your amazing and original description

[Service]
ExecStart=/full/path/to/the/app
Environment=DISPLAY=%i # &lt;= !

[Install]
WantedBy=mystuff.target
</pre>
<p>A continuación, se puede ejecutar con:
</p>
<pre>systemctl --user {start|enable} x-app@your-desired-display.service # &lt;= :0 in most cases
</pre>
<p>Algunas aplicaciones X pueden no ponerse en marcha porque el socket de la pantalla aún no está disponible. Esto se puede solucionarlo mediante la adición de algo así:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$HOME/.config/systemd/user/x-app-template@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
After=xorg.target
Requires=xorg.target

...
</pre>
<p>a sus unidades (el target <code>xorg.target</code> es parte del paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xorg-launch-helper/">xorg-launch-helper</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">enlace roto</a>: package not found]</sup>).
</p>
<h2>
<span id="V.C3.A9ase_tambi.C3.A9n"></span><span class="mw-headline" id="Véase_también">Véase también</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units/wiki/Home">KaiSforza's bitbucket wiki</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/zoqaeski/systemd-user-units">Zoqaeski's units on Github</a></li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/grawity/systemd-user-units">Collection of useful systemd user units</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">enlace roto</a> 2020-08-06]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units">More systemd user units</a></li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=167115">Forum thread about changes in systemd 206 user instances</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../es/Category:System_administration.html" title="Category:System administration (Español)">System administration (Español)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd_(Espa%C3%B1ol)/User_(Espa%C3%B1ol)&amp;oldid=663108">https://wiki.archlinux.org/index.php?title=Systemd_(Español)/User_(Español)&amp;oldid=663108</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 20 April 2021, at 21:22.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
