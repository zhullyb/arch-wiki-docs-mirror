<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>makepkg (Español) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.35.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="noindex,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="http://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg_Español rootpage-Makepkg_Español skin-vector action-view skin-vector-legacy">
<div id="content" class="mw-body" role="main" style="margin: 0">
	<a id="top"></a>
	<div id="siteNotice" class="mw-body-content"></div>
	<div class="mw-indicators mw-body-content">
	</div>
	<h1 id="firstHeading" class="firstHeading" lang="en">makepkg (Español)</h1>
	<div id="bodyContent" class="mw-body-content">
		<div id="siteSub" class="noprint">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
<div class="warningbox">The printable version is no longer supported and may have rendering errors. Please update your browser bookmarks and please use the default browser print function instead.</div>
<div class="mw-parser-output">
<p><span></span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Estado de la traducción:</strong> esta traducción de <a href="../en/Makepkg.html" title="Makepkg">makepkg</a> fue revisada el <b>2020-05-31</b>. Si existen <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;diff=0&amp;oldid=608612">cambios</a> puede <a href="../es/ArchWiki:f6ecee2fb17812f6654b3a6ff807d392.html" class="mw-redirect" title="ArchWiki:Translation Team/Contributing (Español)">actualizarla</a> o avisar al <a href="../es/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Español)">equipo de traducción</a>.</div>
<div class="archwiki-template-meta-related-articles-start">
<p>Artículos relacionados</p>
<ul>
<li><a href="../es/Creating_packages.html" title="Creating packages (Español)">Crear paquetes</a></li>
<li><a href="../es/PKGBUILD.html" title="PKGBUILD (Español)">PKGBUILD</a></li>
<li><a href="../es/Arch_User_Repository.html" title="Arch User Repository (Español)">Arch User Repository (Español)</a></li>
<li><a href="../es/Pacman.html" title="Pacman (Español)">Pacman</a></li>
<li><a href="../es/Official_repositories.html" title="Official repositories (Español)">Repositorios oficiales</a></li>
<li><a href="../es/Arch_Build_System.html" title="Arch Build System (Español)">Arch Build System (Español)</a></li>
</ul>
</div>
<p>makepkg es usado para compilar y construir paquetes capaces de instalar mediante <a href="../en/Pacman.html" title="Pacman">pacman</a>, el manejador de paquetes de Arch Linux. makepkg es un script que automatiza el proceso de construcción de paquetes; este puede descargar y validar archivos fuente, resolver dependencias, configurar los parámetros de tiempo de compilación, compilar las fuentes e instalarlo dentro de un root temporal.
</p>
<p>makepkg lo provee el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading">
<input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en" dir="ltr">
<h2 id="mw-toc-heading">Contents</h2>
<span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span>
</div>
<ul>
<li class="toclevel-1 tocsection-1">
<a href="#Configuraci%C3%B3n"><span class="tocnumber">1</span> <span class="toctext">Configuración</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Informaci%C3%B3n_del_empaquetador"><span class="tocnumber">1.1</span> <span class="toctext">Información del empaquetador</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Resultado_del_paquete"><span class="tocnumber">1.2</span> <span class="toctext">Resultado del paquete</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Verificaci%C3%B3n_de_firmas"><span class="tocnumber">1.3</span> <span class="toctext">Verificación de firmas</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#fakeroot"><span class="tocnumber">1.4</span> <span class="toctext">fakeroot</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Utilizaci%C3%B3n"><span class="tocnumber">2</span> <span class="toctext">Utilización</span></a></li>
<li class="toclevel-1 tocsection-7">
<a href="#Recomendaciones"><span class="tocnumber">3</span> <span class="toctext">Recomendaciones</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Construir_binarios_optimizados"><span class="tocnumber">3.1</span> <span class="toctext">Construir binarios optimizados</span></a></li>
<li class="toclevel-2 tocsection-9">
<a href="#Mejorar_tiempos_de_compilaci%C3%B3n"><span class="tocnumber">3.2</span> <span class="toctext">Mejorar tiempos de compilación</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#Compilaci%C3%B3n_paralela"><span class="tocnumber">3.2.1</span> <span class="toctext">Compilación paralela</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Construir_desde_archivos_en_memoria"><span class="tocnumber">3.2.2</span> <span class="toctext">Construir desde archivos en memoria</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Usar_cach%C3%A9_de_compilaci%C3%B3n"><span class="tocnumber">3.2.3</span> <span class="toctext">Usar caché de compilación</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="#Generar_nueva_suma_de_verificaci%C3%B3n"><span class="tocnumber">3.3</span> <span class="toctext">Generar nueva suma de verificación</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Usar_otros_algoritmos_de_compresi%C3%B3n"><span class="tocnumber">3.4</span> <span class="toctext">Usar otros algoritmos de compresión</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Uso_de_m%C3%BAltiples_n%C3%BAcleos_en_la_compresi%C3%B3n"><span class="tocnumber">3.5</span> <span class="toctext">Uso de múltiples núcleos en la compresión</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Ver_paquetes_con_un_empaquetador_espec%C3%ADfico"><span class="tocnumber">3.6</span> <span class="toctext">Ver paquetes con un empaquetador específico</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Construir_paquetes_de_32-bit_en_un_sistema_de_64-bit"><span class="tocnumber">3.7</span> <span class="toctext">Construir paquetes de 32-bit en un sistema de 64-bit</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18">
<a href="#Soluci%C3%B3n_de_problemas"><span class="tocnumber">4</span> <span class="toctext">Solución de problemas</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#CFLAGS/CXXFLAGS/LDFLAGS_en_makepkg.conf_no_funcionan_en_los_paquetes_basados_en_CMake"><span class="tocnumber">4.1</span> <span class="toctext">CFLAGS/CXXFLAGS/LDFLAGS en makepkg.conf no funcionan en los paquetes basados en CMake</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Especificar_el_directorio_de_instalaci%C3%B3n_para_los_paquetes_basados_en_QMAKE"><span class="tocnumber">4.2</span> <span class="toctext">Especificar el directorio de instalación para los paquetes basados en QMAKE</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#ADVERTENCIA:_Paquetes_que_contienen_referencias_a_%24srcdir"><span class="tocnumber">4.3</span> <span class="toctext">ADVERTENCIA: Paquetes que contienen referencias a $srcdir</span></a></li>
<li class="toclevel-2 tocsection-22">
<a href="#Makepkg_falla_al_descargar_las_dependencias_a_trav%C3%A9s_de_un_proxy"><span class="tocnumber">4.4</span> <span class="toctext">Makepkg falla al descargar las dependencias a través de un proxy</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#Habilitar_proxy_estableciendo_su_URL_en_XferCommand"><span class="tocnumber">4.4.1</span> <span class="toctext">Habilitar proxy estableciendo su URL en XferCommand</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Habilitar_proxy_via_sudoer's_env_keep"><span class="tocnumber">4.4.2</span> <span class="toctext">Habilitar proxy via sudoer's env_keep</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Makepkg_falla,_pero_el_make_termina_bien"><span class="tocnumber">4.5</span> <span class="toctext">Makepkg falla, pero el make termina bien</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#V%C3%A9ase_tambi%C3%A9n"><span class="tocnumber">5</span> <span class="toctext">Véase también</span></a></li>
</ul>
</div>

<h2>
<span id="Configuraci.C3.B3n"></span><span class="mw-headline" id="Configuración">Configuración</span>
</h2>
<p>El archivo principal de configuración de makepkg es <code>/etc/makepkg.conf</code> . la mayoría de los usuarios querrán configurar estas opciones de makepkg antes de construir cualquier paquete (por ejemplo modificar las variables <code>MAKEFLAGS</code> en sistemas con soporte SMP para <a href="#Recomendaciones">reducir tiempos de compilación</a> , o personalizar la variable  <code>PACKAGER</code> para personalizar paquetes. Lea la documentación de <code>PACKAGER</code> para más detalles
</p>
<p>Para poder instalar paquetes con makepkg sin ser usuario administrador (con <code>makepkg -s</code>, información más delante), instale <a href="../es/Sudo.html" title="Sudo (Español)">sudo</a> y agregue los usuarios con estos privilegios en el archivo to <code>/etc/sudoers</code>:
</p>
<pre>USER_NAME    ALL=(ALL)    NOPASSWD: /usr/bin/pacman
</pre>
<p>La línea de arriba eliminara la necesidad de introducir un password cada vez que utilicemos pacman. Revise la wiki de <a href="../es/Sudo.html" title="Sudo (Español)">sudo</a> para mas información
</p>
<p>Enseguida, puede configurar donde serán guardados los paquetes terminados. Este paso es meramente opcional; por definición los paquetes serán creados en el directorio donde makepkg se ejecute
Cree el directorio:
</p>
<p><br>
</p>
<pre>$ mkdir /home/$USER/packages
</pre>
<p>Luego modifique la variable <code>PKGDEST</code> en el archivo <code>/etc/makepkg.conf</code> de acuerdo a esta directorio.
</p>
<h3>
<span id="Informaci.C3.B3n_del_empaquetador"></span><span class="mw-headline" id="Información_del_empaquetador">Información del empaquetador</span>
</h3>
<p>Cada paquete es etiquetado con meta información que identifica entre otros el <i>packager</i>. Por defecto, paquetes compilados por el usuario son marcados con <code>Unknown Packager</code>. Si múltiples usuarios van a compilar paquetes en un sistema o si planea distribuir sus paquetes con otros usuarios, es conveniente proveer un contacto real. Esto se puede hacer modificando la variable <code>PACKAGER</code> en el archivo <code>makepkg.conf</code>.
</p>
<p>Para revisar esta variable en un paquete instalado ejecute:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>paquete</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Packager       : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>Para firmar sus paquete automaticamente, tambien modifique la variable <code>GPGKEY</code> en el archivo <code>makepkg.conf</code>.
</p>
<h3><span class="mw-headline" id="Resultado_del_paquete">Resultado del paquete</span></h3>
<p>Por defecto, <i>makepkg</i> crea tarballs de los paquetes en el directorio de trabajo y descarga las fuentes en el directorio <code>src/</code>. Rutas personalizadas pueden ser configuradas, por ejemplo para mantener todos los paquetes construidos en <code>~/build/packages/</code> y todas las fuentes en <code>~/build/sources/</code>.
</p>
<p>Configure las siguientes variables en <code>makepkg.conf</code>, si lo considera necesario:
</p>
<ul>
<li>
<code>PKGDEST</code> — directorio para guardar los paquetes resultantes</li>
<li>
<code>SRCDEST</code> — directorio para guardar datos <a href="../es/PKGBUILD.html#Variables" title="PKGBUILD (Español)">fuente</a>, (links simbólicos seran puestos en <code>src/</code> si la ruta es diferente)</li>
<li>
<code>SRCPKGDEST</code> — directorio para guardar las fuentes resultantes (construido con <code>makepkg -S</code>)</li>
</ul>
<h3>
<span id="Verificaci.C3.B3n_de_firmas"></span><span class="mw-headline" id="Verificación_de_firmas">Verificación de firmas</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> La implementación de verificación de firmas en <i>makepkg</i> no usa el llavero de pacman, en su lugar depende en el llavero del usuario. <a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>
</div>
<p>Si una firma de la forma <code>.sig</code> o <code>.asc</code> es parte del <a href="../es/PKGBUILD.html" title="PKGBUILD (Español)">PKGBUILD</a> en la sección <i>source</i>, <i>makepkg</i> automáticamente intentara <a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">verificarla</a>. En caso de que el llavero del usuario no contenga la clave pública para la verificación <i>makepkg</i> abortara el procedimiento con un mensaje que la clave PGP no pudo ser verificada. 
</p>
<p>Si una clave pública es necesaria, el <a href="../es/PKGBUILD.html" title="PKGBUILD (Español)">PKGBUILD</a> probablemente tendrá una sección <a href="../en/PKGBUILD.html#validpgpkeys" title="PKGBUILD">validpgpkeys</a> con las IDs requeridas. Se puede <a href="../es/GnuPG.html#Importar_una_clave" title="GnuPG (Español)">importar</a> manualmente, o la puede ubicar en un <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">keyserver</a> e importarla desde allí.
</p>
<h3><span class="mw-headline" id="fakeroot"><code>fakeroot</code></span></h3>
<p><code>fakeroot</code> permite al usuario usar los permisos necesarios de root para crear paquetes en el ambiente de construcción sin necesidad de alterar todo el sistema. Si el proceso de construcción trata de alterar archivos fuera del ambiente de construcción entonces aparecerán mensajes de error y el empaquetado habrá fallado – esto es muy útil para verificar la calidad, seguridad e integridad de los PKGBUILD para su distribución. Por default  <code>fakeroot</code> esta habilitado en el archivo de configuración <code>/etc/makepkg.conf</code>; los usuarios pueden utilizar el prefijo <code>!</code> en la variable  <code>BUILDENV</code> para deshabilitar esto.
</p>
<h2>
<span id="Utilizaci.C3.B3n"></span><span class="mw-headline" id="Utilización">Utilización</span>
</h2>
<p>Antes de continuar, asegúrese de que el grupo de paquetes <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/base-devel/">base-devel</a></span> este <a href="../es/Help:Reading.html#Instalaci.C3.B3n_de_paquetes" title="Help:Reading (Español)">instalado</a>. Los paquetes pertenecientes a este grupo no son requeridos en la lista de dependencias en los <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Asegurese de haber configurado <a href="../es/Sudo.html" title="Sudo (Español)">sudo</a> correctamente al pasar comandos a <a href="../es/Pacman.html" title="Pacman (Español)">pacman</a>.</li>
<li>Ejecutar <i>makepkg</i> como root no esta <a rel="nofollow" class="external text" href="https://lists.archlinux.org/pipermail/pacman-dev/2014-March/018911.html">permitido</a>. Debido a que un <code>PKGBUILD</code> puede incluir comandos arbitrarios, construir como root se considera peligroso.</li>
</ul>
</div>
<p>Para crear un paquete primero debe tener un <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a>, como se describe en la guía de in <a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a>, o obtenga uno del  <a href="../en/Arch_Build_System.html" title="Arch Build System">ABS tree</a>, <a href="../en/Arch_User_Repository.html" title="Arch User Repository">Arch User Repository</a>, u obténgalo de alguna otra fuente.  
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong>  solo instale paquetes de fuentes confiables.</div>
<p>Una vez en posesión de un  <code>PKGBUILD</code>, entre al directorio donde esta salvado este archivo y ejecute el siguiente comando para compilar y construir el paquete como lo fue descrito en el archivo un  <code>PKGBUILD</code>:
</p>
<pre>$ makepkg
</pre>
<p>Si no se satisfacen algunas dependencias, <i>makepkg</i> mostrara una advertencia antes de fallar, para construir el paquete e instalar sus dependencias automáticamente, simplemente se utiliza el comando:
</p>
<pre>$ makepkg -s
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong>  
<ul>
<li>Estas dependencias deben estar disponibles dentro de los repositorios disponibles para pacman, vea <a href="../es/Pacman.html#Repositorios_y_servidores_de_r%C3%A9plicas" title="Pacman (Español)">pacman (Español)#Repositorios y servidores de réplicas</a> para mayor información al respecto. También se pueden instalar las dependencias antes de construir el paquete (<code>pacman -S --asdeps dep1 dep2</code>).</li>
<li>Solo se utilizarán valores globales cuando se instalen las dependencias, por ejemplo, cualquier anulación hecha en la función de paquete dividido no sera usado.</li>
</ul>
</div>
<p>Una vez que se hayan satisfecho todas las dependencias y el paquete se construyo satisfactoriamente, un archivo con el nombre (<code>pkgname-pkgver.pkg.tar.gz</code>) será creado en el directorio de trabajo. Para instalarlo (al igual que <code>pacman -U pkgname-pkgver.pkg.tar.gz</code>) simplemente se ejecuta:
</p>
<pre>$ makepkg -i
</pre>
<p>Para despejar archivos que no son necesarios, como los existentes en <code>$srcdir</code>, agregue la opción <code>-c</code>. Este comando es útil al actualizar la version de los paquetes usando el mismo directorio. Se previene la transferencia de archivos obsoletos en la nueva construcción.
</p>
<pre>$ makepkg -c
</pre>
<p>Para mas información, mire <a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.8.html">makepkg(8)</a>.
</p>
<h2><span class="mw-headline" id="Recomendaciones">Recomendaciones</span></h2>
<h3><span class="mw-headline" id="Construir_binarios_optimizados">Construir binarios optimizados</span></h3>
<p>Una mejora de rendimiento del empaquetado de software se puede lograr habilitando optimizaciones en la máquina local. El inconveniente es que los binarios compilados para una arquitectura de procesador específico pueden no ejecutarse correctamente en otros ordenadores. En las máquinas x86_64 es raro ganar un rendimiento significativo que justifique invertir tiempo en reconstruir los paquetes oficiales.
</p>
<p>Sin embargo es muy fácil disminuir el rendimiento utilizando FLAGS de compilación "no estandar". Muchas optimizaciones son útiles solo en determinadas situaciones y no debe de aplicarse para todos los paquetes. A no haya ser que puedas verificar que algo es más rápido, es una muy buena oportunidad ¡como no! Los artículos de Gentoo <a rel="nofollow" class="external text" href="https://wiki.gentoo.org/wiki/GCC_optimization/es">Guía de optimización de compilación</a> y <a rel="nofollow" class="external text" href="https://wiki.gentoo.org/wiki/Safe_CFLAGS">CFLAGS Seguros (en ingles)</a> proporciona mas información detallada sobre optimizaciones de compilador. 
</p>
<p>Las opciones pasadas al compilador C/C++ (e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>) están controladas por <code>CFLAGS</code>, <code>CXXFLAGS</code> y <code>CPPFLAGS</code> variables de entorno. Para usarlos en el sistema de construcción de Arch, <i>makepkg</i> muestra las variables de entorno según las opciones de configuración en <code>makepkg.conf</code>. Los valores por defecto están configurados para producir binarios genéricos que pueden ser instalados en un amplio rango de máquinas.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Tener en cuenta que no todos los sistemas de construcciones utilizan las variables configuradas en <code>makepkg.conf</code>. Por ejemplo, <i>cmake</i> no tiene en cuenta las opciones de preprocesamiento <code>CPPFLAGS</code>. Consecuentemente, muchos <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> contiene métodos alternativos con opciones específicas para el sistema constructor usado por el gestor de paquetes.</li>
<li>La configuración proporcionada con el código fuente en el <code>Makefile</code> o algún argumento específico en la compilación desde la linea de comandos tiene preferencia y puede potencialmente sobrescribir el de <code>makepkg.conf</code>.</li>
</ul>
</div>
<p>GCC puede detectar automáticamente y habilitar de forma segura las optimizaciones especificas de la arquitectura. Para utilizar esta función, primero elimina cualquier <code>-march</code> y <code>-mtune</code> flags, después añade <code>-march=native</code>. Por ejemplo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe -fstack-protector-strong -fno-plt"
CXXFLAGS="${CFLAGS}"</pre>
<p>Para ver que flags estan habilitadas en tu ordenador, ejecuta:
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Si especificas un valor diferente que <code>-march=native</code>, después <code>-Q --help=target</code> <b>puede no</b> funcionar como se espera.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[2]</a> Necesitas ir por los pasos de la compilación para ver que opciones están habilitadas realmente. Mira <a rel="nofollow" class="external text" href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Find_CPU-specific_options">Find CPU-specific options</a> en la wiki de Gentoo para instrucciones.</div>
<h3>
<span id="Mejorar_tiempos_de_compilaci.C3.B3n"></span><span class="mw-headline" id="Mejorar_tiempos_de_compilación">Mejorar tiempos de compilación</span>
</h3>
<h4>
<span id="Compilaci.C3.B3n_paralela"></span><span class="mw-headline" id="Compilación_paralela">Compilación paralela</span>
</h4>
<p>El sistema de construcción <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> usa las <code>MAKEFLAGS</code> como variables de entorno para especificar opciones adicionales. Las variables también pueden ser definidas en el archivo <code>/etc/makepkg.conf</code>.
</p>
<p>Usuarios con sistemas que poseen múltiples núcleos o CPU pueden especificar el número de trabajos a ejecutar simultáneamente. Esto se puede realizar usando <i>nproc</i> para determinar el número de procesadores disponibles, v.g. modificando la línea <code>MAKEFLAGS</code> en <code>/etc/makepkg.conf</code>. 
</p>
<pre>MAKEFLAGS="<b>-j$(nproc)</b>"
</pre>
<p>Para decirle al compilador que use un número especifico de núcleos al momento de compilar, se usa el mismo parámetro <code>-j&lt;numero_de_núcleos&gt;</code>. El número recomendado es <i>n</i>+1, donde <i>n</i> es la cantidad de núcleos de tu procesador.
</p>
<p>Por ejemplo un procesador de 2 núcleos (2+1=3):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
#-- Make Flags: change this for DistCC/SMP systems
MAKEFLAGS="-j3"
...
</pre>
<p>Algunos <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> sobrescriben específicamente con <code>-j1</code>, por las condiciones en algunas versiones o porque simplemente no están soportadas en primer lugar. Paquetes que fallen la construcción por esto debe de ser <a href="../en/Bug_reporting_guidelines.html" class="mw-redirect" title="Reporting bug guidelines">reportado</a> en el bug tracker (o en su caso de los paquetes del <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>, al mantenedor del paquete) después de estar seguro que ese error lo causa su <code>MAKEFLAGS</code>.
</p>
<p>Vea <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span> para una lista completa de opciones.
</p>
<h4><span class="mw-headline" id="Construir_desde_archivos_en_memoria">Construir desde archivos en memoria</span></h4>
<p>La compilación requiere muchas operaciones I/O y manejar muchos archivos pequeños, moviendo el directorio de trabajo a <a href="../es/Tmpfs.html" title="Tmpfs (Español)">tmpfs</a> puede mejorar los tiempos de compilación.
</p>
<p>La variable <code>BUILDDIR</code> se puede exportar temporalmente a <i>makepkg</i> para establecer el directorio de trabajo a un tmpfs existente. Por ejemplo:
</p>
<p>$ BUILDDIR=/tmp/makepkg makepkg
</p>
<p>La configuración duradera se puede hacer en <code>makepkg.conf</code> descomentando la opción <code>BUILDDIR</code>, que se encuentra al final de la sección <code>BUILD ENVIRONMENT</code> en el archivo <code>/etc/makepkg.conf</code> por defecto. Estableciendo el valor en, por ejemplo, <code>BUILDDIR=/tmp/makepkg</code> hará que make use el sistema de archivos temporal <code>/tmp</code> por defecto en Arch.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Evita compilar paquetes grandes en tmpfs para prevenir que se ejecute fuera de memoria.</li>
<li>La carpeta tmpfs tiene que estar montada sin la opción <code>noexec</code>, si no evitara ejecutar la construcción de binarios.</li>
<li>Mantén en mente que los paquetes compilados en tmpfs no perdurarán en un reinicio. Considera establecer la opción <a href="#Resultado_del_paquete">PKGDEST</a> apropiada para mover el paquete construido automáticamente a un directorio persistente.</li>
</ul>
</div>
<h4>
<span id="Usar_cach.C3.A9_de_compilaci.C3.B3n"></span><span class="mw-headline" id="Usar_caché_de_compilación">Usar caché de compilación</span>
</h4>
<p>El uso de <a href="../en/Ccache.html" title="Ccache">ccache</a> puede mejorar los tiempos de compilación generando caché los resultados de las compilaciones para utilizarlos sucesivamente.
</p>
<h3>
<span id="Generar_nueva_suma_de_verificaci.C3.B3n"></span><span class="mw-headline" id="Generar_nueva_suma_de_verificación">Generar nueva suma de verificación</span>
</h3>
<p>Instala <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> y ejecute el siguiente comando en el mismo directorio que el PKBUILD para generar una nueva suma de verificación:
</p>
<pre>$ updpkgsums
</pre>
<p>Las sumas de verificación pueden también obtenerse con, por ejemplo, <code>sha256sum</code> y añadirlo al array <code>sha256sums</code> a mano.
</p>
<h3>
<span id="Usar_otros_algoritmos_de_compresi.C3.B3n"></span><span class="mw-headline" id="Usar_otros_algoritmos_de_compresión">Usar otros algoritmos de compresión</span>
</h3>
<p>Para acelerar la empaquetación y la instalación, con la desventaja de tener paquetes más grandes, cambia <code>PKGEXT</code>. Por ejemplo, lo siguiente hace que el paquete se descomprima para una sola invocación:
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>Otro ejemplo, usar el algoritmo lzop, con el paquete necesario <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzop">lzop</a></span>:
</p>
<pre>$ PKGEXT='.pkg.tar.lzo' makepkg
</pre>
<p>Para hacer estas configuraciones permanentes, establece <code>PKGEXT</code> en <code>/etc/makepkg.conf</code>.
</p>
<h3>
<span id="Uso_de_m.C3.BAltiples_n.C3.BAcleos_en_la_compresi.C3.B3n"></span><span class="mw-headline" id="Uso_de_múltiples_núcleos_en_la_compresión">Uso de múltiples núcleos en la compresión</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> es compatible con <a href="https://en.wikipedia.org/wiki/Symmetric_multiprocessing" class="extiw" title="wikipedia:Symmetric multiprocessing">Multiprocesamiento_simétrico (SMP)</a> con el párametro <code>--threads</code> para acelerar la compresión. Para permitir que <i>makepkg</i> use tantos núcleos como sea possible al comprimir paquetes, edite la linea <code>COMPRESSXZ</code> en <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSXZ=(xz -c -z - <b>--threads=0</b>)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> es una implementación paralela de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> en la que por defecto utiliza todos los núcleos de la CPU disponibles. El parámetro <code>-p/--processes</code> se puede utilizar para que utilice menos núcleos:
</p>
<p>COMPRESSGZ=(<b>pigz</b> -c -f -n)
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> en un drop-in, la implementación paralela para <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span> que también utiliza todos los nucleos CPU disponibles por defecto. El parámetro <code>-p#</code> se puede utilizar para emplear menos núcleos (Nota: no hay ningún espacio entre <code>-p</code> y el número de núcleos).
</p>
<p>COMPRESSBZ2 =(<b>pbzip2</b> -c -f)
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> soporta <a href="https://en.wikipedia.org/wiki/es:Multiprocesamiento_sim%C3%A9trico" class="extiw" title="wikipedia:es:Multiprocesamiento simétrico">multiprocesamiento simétrico (SMP)</a> a través de la bandera <code>--threads</code> para acelerar la compresión. Por ejemplo, para dejar que makepkg utilice tantos nucleos de CPU como sea posible para comprimir paquetes edite el array <code>COMPRESSZST</code> en <code>/etc/makepkg.conf</code>:
</p>
<p>COMPRESSZST=(zstd -c -z -q - <b>--threads=0</b>)
</p>
<h3>
<span id="Ver_paquetes_con_un_empaquetador_espec.C3.ADfico"></span><span class="mw-headline" id="Ver_paquetes_con_un_empaquetador_específico">Ver paquetes con un empaquetador específico</span>
</h3>
<p>Esto muestra todos los paquetes instalados en el sistema con el empaquetador <i>nombreempaqueetador</i>:
</p>
<p>$ expac "%n %p" | grep "<i>nombreempaquetador</i>" | column -t
</p>
<p>Esto muestra todos los paquetes instalados en el sistema con el empaquetador establecido en la variable <code>PACKAGER</code> en el <code>/etc/makepkg</code>. Solo muestra los paquetes que están en el repositorio definido en <code>/etc/pacman.conf</code>.
</p>
<p>$ . /etc/makepkg.conf; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</p>
<h3><span class="mw-headline" id="Construir_paquetes_de_32-bit_en_un_sistema_de_64-bit">Construir paquetes de 32-bit en un sistema de 64-bit</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Se han reportado errores cuando se utiliza este método para construir el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>.</div>
<p>Primero, habilite el repositorio <a href="../en/Official_repositories.html#multilib" class="mw-redirect" title="Multilib">multilib</a> e <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instala</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/multilib-devel/">multilib-devel</a></span>.
</p>
<p>Después crea un archivo de configuración de 32-bit.
</p>
<p><br>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.makepkg.i686.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CARCH="i686"
CHOST="i686-unknown-linux-gnu"
CFLAGS="-m32 -march=i686 -mtune=generic -O2 -pipe -fstack-protector-strong"
CXXFLAGS="${CFLAGS}"
LDFLAGS="-m32 -Wl,-O1,--sort-common,--as-needed,-z,relro"</pre>
<p>y ejecuta makepkg así
</p>
<pre>$ linux32 makepkg --config ~/.makepkg.i686.conf
</pre>
<h2>
<span id="Soluci.C3.B3n_de_problemas"></span><span class="mw-headline" id="Solución_de_problemas">Solución de problemas</span>
</h2>
<h3>
<span id="CFLAGS.2FCXXFLAGS.2FLDFLAGS_en_makepkg.conf_no_funcionan_en_los_paquetes_basados_en_CMake"></span><span class="mw-headline" id="CFLAGS/CXXFLAGS/LDFLAGS_en_makepkg.conf_no_funcionan_en_los_paquetes_basados_en_CMake">CFLAGS/CXXFLAGS/LDFLAGS en makepkg.conf no funcionan en los paquetes basados en CMake</span>
</h3>
<p>Con el fin de dejar que CMake use las variables definidas en <code>makepkg.conf</code>, simplemente no especifique la variable <code>-DCMAKE_BUILD_TYPE</code> cuando configure un proyecto cmake.<a rel="nofollow" class="external autonumber" href="https://lists.archlinux.org/pipermail/arch-dev-public/2018-March/029181.html">[3]</a>
</p>
<p>Esto causa que cmake utilice una construcción tipo <code>None</code> en la que utiliza las variables de entorno como <code>CFLAGS</code>, <code>CPPFLAGS</code>, etc.
</p>
<h3>
<span id="Especificar_el_directorio_de_instalaci.C3.B3n_para_los_paquetes_basados_en_QMAKE"></span><span class="mw-headline" id="Especificar_el_directorio_de_instalación_para_los_paquetes_basados_en_QMAKE">Especificar el directorio de instalación para los paquetes basados en QMAKE</span>
</h3>
<p>El makefile generado por "qmake" utiliza la variable de entorno <code>INSTALL_ROOT</code> para determinar dónde se va a instalar el programa. Así que esta funcion del paquete debería funcionar:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

package() {
	cd "$srcdir/${pkgname%-git}"
	make INSTALL_ROOT="$pkgdir" install
}

...
</pre>
<p>Tenga en cuenta que qmake tiene que estar configurado correctamente, por ejemplo ponga esto en su archivo ".pro":
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">YourProject.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

target.path = /usr/local/bin
INSTALLS += target

...
</pre>
<h3>
<span id="ADVERTENCIA:_Paquetes_que_contienen_referencias_a_.24srcdir"></span><span class="mw-headline" id="ADVERTENCIA:_Paquetes_que_contienen_referencias_a_$srcdir">ADVERTENCIA: Paquetes que contienen referencias a $srcdir</span>
</h3>
<p>Por alguna razón, las cadenas <code>$srcdir</code> o <code>$pkgdir</code> literales acaban en uno de los archivos de instalación en su paquete.
</p>
<p>Para identificar que archivos son, ejecute lo siguiente desde el directorio de construcción de <i>makepkg</i>:
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>Una posible causa puede ser por el uso de la macro <code>__FILE__</code> en el código C/C++ con la ruta absoluta pasada al comilador.
</p>
<h3>
<span id="Makepkg_falla_al_descargar_las_dependencias_a_trav.C3.A9s_de_un_proxy"></span><span class="mw-headline" id="Makepkg_falla_al_descargar_las_dependencias_a_través_de_un_proxy">Makepkg falla al descargar las dependencias a través de un proxy</span>
</h3>
<p>Cuando <i>makepkg</i> llama a las dependencias, llama a pacman para instalar los paquetes, que requieren permisos administrativos via <i>sudo</i>. De todas formas, <i>sudo</i> no pasa ninguna <a href="../es/Environment_variables.html" title="Environment variables (Español)">variable de entorno</a> al entorno con privilegios, incluido las variables relacionadas con el proxy <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code>, y <code>no_proxy</code>.
</p>
<p>Para tener a <i>makepkg</i> trabajando a través de un proxy tiene que seguir uno de los dos métodos.
</p>
<h4><span class="mw-headline" id="Habilitar_proxy_estableciendo_su_URL_en_XferCommand">Habilitar proxy estableciendo su URL en XferCommand</span></h4>
<p>XferCommand puede establecerse para utilizar la URL del proxy deseado en <code>/etc/pacman.conf</code>. Añade o descomenta la siguiente línea en su <code>pacman.conf</code><a rel="nofollow" class="external autonumber" href="https://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[4]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl -x http://username:password@proxy.proxyhost.com:80 -L -C - -f -o %o %u
...
</pre>
<h4>
<span id="Habilitar_proxy_via_sudoer.27s_env_keep"></span><span class="mw-headline" id="Habilitar_proxy_via_sudoer's_env_keep">Habilitar proxy via sudoer's env_keep</span>
</h4>
<p>Alternativamente, puede querer utilizar la opción <code>env_keep</code>, que habilita preservar las variables dadas al entorno privilegiado.
Vea <a href="../es/Sudo.html#Variables_de_entorno" title="Sudo (Español)">Sudo (Español)#Variables de entorno</a> para más información.
</p>
<h3>
<span id="Makepkg_falla.2C_pero_el_make_termina_bien"></span><span class="mw-headline" id="Makepkg_falla,_pero_el_make_termina_bien">Makepkg falla, pero el make termina bien</span>
</h3>
<p>Si algo se compila manualmente utilizando <i>make</i>, pero falla al utilizar <i>makepkg</i>, casi seguro que es porque el <code>/etc/makepkg.conf</code> establece la variable de compilación a algo que normalmente funciona, pero lo que usted esta compilando sea incompatible. Intente añadir estos parámetros a la linea <code>options</code> del PKGBUILD:
</p>
<p><code>!buildflags</code>, para evitar que utilice <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code>, y <code>LDFLAGS</code> dadas por defecto.
</p>
<p><code>!makeflags</code>, para evitar que utilice <code>MAKEFLAGS</code> por defecto, en caso de que se haya editado <code>/etc/makepkg.conf</code> para habilitar la compilación paralela.
</p>
<p><code>!debug</code>, para evitar que utilice <code>DEBUG_CFLAGS</code> y <code>DEBUG_CXXFLAGS</code> dadas por defecto, en caso de que su paquete sea una construcción debug.
</p>
<p>Si alguno de estos parámetros soluciona el problema, lo puede indicar reportando un bug, si usted localiza que parámetro exactamente está causando el problema.
</p>
<h2>
<span id="V.C3.A9ase_tambi.C3.A9n"></span><span class="mw-headline" id="Véase_también">Véase también</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.8.html">makepkg(8) Manual Page</a></li>
<li><a rel="nofollow" class="external text" href="https://archlinux.org/pacman/makepkg.conf.5.html">makepkg.conf(5) Manual Page</a></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">A Brief Tour of the Makepkg Process</a></li>
<li><a rel="nofollow" class="external text" href="https://projects.archlinux.org/pacman.git/tree/scripts/makepkg.sh.in">makepkg source code</a></li>
</ul>
</div>
</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../es/Category:Package_development.html" title="Category:Package development (Español)">Package development (Español)</a></li>
<li><a href="../es/Category:About_Arch.html" title="Category:About Arch (Español)">About Arch (Español)</a></li>
<li><a href="../es/Category:Commands.html" title="Category:Commands (Español)">Commands (Español)</a></li>
</ul>
</div></div>
	</div>
</div>

<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
		<li>Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg_(Espa%C3%B1ol)&amp;oldid=661848">https://wiki.archlinux.org/index.php?title=Makepkg_(Español)&amp;oldid=661848</a>"</li>
		<li id="footer-info-lastmod"> This page was last edited on 18 April 2021, at 14:20.</li>
		<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
	<br>
</ul>
	<ul id="footer-places">
		<li id="footer-places-privacy"><a href="../en/ArchWiki:Privacy_policy.html" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="footer-places-about"><a href="../en/ArchWiki:About.html" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="footer-places-disclaimer"><a href="../en/ArchWiki:General_disclaimer.html" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
	<ul id="footer-icons" class="noprint">
		<li id="footer-copyrightico">
	</ul>
	<div style="clear: both;"></div>
</footer>



</body>
</html>
